var Er=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function uf(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}/*!
 * @pixi/constants - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/constants is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Ji;(function(s){s[s.WEBGL_LEGACY=0]="WEBGL_LEGACY",s[s.WEBGL=1]="WEBGL",s[s.WEBGL2=2]="WEBGL2"})(Ji||(Ji={}));var Uo;(function(s){s[s.UNKNOWN=0]="UNKNOWN",s[s.WEBGL=1]="WEBGL",s[s.CANVAS=2]="CANVAS"})(Uo||(Uo={}));var Uu;(function(s){s[s.COLOR=16384]="COLOR",s[s.DEPTH=256]="DEPTH",s[s.STENCIL=1024]="STENCIL"})(Uu||(Uu={}));var J;(function(s){s[s.NORMAL=0]="NORMAL",s[s.ADD=1]="ADD",s[s.MULTIPLY=2]="MULTIPLY",s[s.SCREEN=3]="SCREEN",s[s.OVERLAY=4]="OVERLAY",s[s.DARKEN=5]="DARKEN",s[s.LIGHTEN=6]="LIGHTEN",s[s.COLOR_DODGE=7]="COLOR_DODGE",s[s.COLOR_BURN=8]="COLOR_BURN",s[s.HARD_LIGHT=9]="HARD_LIGHT",s[s.SOFT_LIGHT=10]="SOFT_LIGHT",s[s.DIFFERENCE=11]="DIFFERENCE",s[s.EXCLUSION=12]="EXCLUSION",s[s.HUE=13]="HUE",s[s.SATURATION=14]="SATURATION",s[s.COLOR=15]="COLOR",s[s.LUMINOSITY=16]="LUMINOSITY",s[s.NORMAL_NPM=17]="NORMAL_NPM",s[s.ADD_NPM=18]="ADD_NPM",s[s.SCREEN_NPM=19]="SCREEN_NPM",s[s.NONE=20]="NONE",s[s.SRC_OVER=0]="SRC_OVER",s[s.SRC_IN=21]="SRC_IN",s[s.SRC_OUT=22]="SRC_OUT",s[s.SRC_ATOP=23]="SRC_ATOP",s[s.DST_OVER=24]="DST_OVER",s[s.DST_IN=25]="DST_IN",s[s.DST_OUT=26]="DST_OUT",s[s.DST_ATOP=27]="DST_ATOP",s[s.ERASE=26]="ERASE",s[s.SUBTRACT=28]="SUBTRACT",s[s.XOR=29]="XOR"})(J||(J={}));var oi;(function(s){s[s.POINTS=0]="POINTS",s[s.LINES=1]="LINES",s[s.LINE_LOOP=2]="LINE_LOOP",s[s.LINE_STRIP=3]="LINE_STRIP",s[s.TRIANGLES=4]="TRIANGLES",s[s.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",s[s.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(oi||(oi={}));var W;(function(s){s[s.RGBA=6408]="RGBA",s[s.RGB=6407]="RGB",s[s.RG=33319]="RG",s[s.RED=6403]="RED",s[s.RGBA_INTEGER=36249]="RGBA_INTEGER",s[s.RGB_INTEGER=36248]="RGB_INTEGER",s[s.RG_INTEGER=33320]="RG_INTEGER",s[s.RED_INTEGER=36244]="RED_INTEGER",s[s.ALPHA=6406]="ALPHA",s[s.LUMINANCE=6409]="LUMINANCE",s[s.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",s[s.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",s[s.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(W||(W={}));var On;(function(s){s[s.TEXTURE_2D=3553]="TEXTURE_2D",s[s.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",s[s.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",s[s.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",s[s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",s[s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",s[s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(On||(On={}));var Ut;(function(s){s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",s[s.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",s[s.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",s[s.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",s[s.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",s[s.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",s[s.BYTE=5120]="BYTE",s[s.SHORT=5122]="SHORT",s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",s[s.HALF_FLOAT=36193]="HALF_FLOAT"})(Ut||(Ut={}));var xu;(function(s){s[s.FLOAT=0]="FLOAT",s[s.INT=1]="INT",s[s.UINT=2]="UINT"})(xu||(xu={}));var hs;(function(s){s[s.NEAREST=0]="NEAREST",s[s.LINEAR=1]="LINEAR"})(hs||(hs={}));var qi;(function(s){s[s.CLAMP=33071]="CLAMP",s[s.REPEAT=10497]="REPEAT",s[s.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(qi||(qi={}));var Ur;(function(s){s[s.OFF=0]="OFF",s[s.POW2=1]="POW2",s[s.ON=2]="ON",s[s.ON_MANUAL=3]="ON_MANUAL"})(Ur||(Ur={}));var xr;(function(s){s[s.NPM=0]="NPM",s[s.UNPACK=1]="UNPACK",s[s.PMA=2]="PMA",s[s.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",s[s.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",s[s.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",s[s.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"})(xr||(xr={}));var fr;(function(s){s[s.NO=0]="NO",s[s.YES=1]="YES",s[s.AUTO=2]="AUTO",s[s.BLEND=0]="BLEND",s[s.CLEAR=1]="CLEAR",s[s.BLIT=2]="BLIT"})(fr||(fr={}));var Fu;(function(s){s[s.AUTO=0]="AUTO",s[s.MANUAL=1]="MANUAL"})(Fu||(Fu={}));var Es;(function(s){s.LOW="lowp",s.MEDIUM="mediump",s.HIGH="highp"})(Es||(Es={}));var Re;(function(s){s[s.NONE=0]="NONE",s[s.SCISSOR=1]="SCISSOR",s[s.STENCIL=2]="STENCIL",s[s.SPRITE=3]="SPRITE",s[s.COLOR=4]="COLOR"})(Re||(Re={}));var mg;(function(s){s[s.RED=1]="RED",s[s.GREEN=2]="GREEN",s[s.BLUE=4]="BLUE",s[s.ALPHA=8]="ALPHA"})(mg||(mg={}));var oe;(function(s){s[s.NONE=0]="NONE",s[s.LOW=2]="LOW",s[s.MEDIUM=4]="MEDIUM",s[s.HIGH=8]="HIGH"})(oe||(oe={}));var _i;(function(s){s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"})(_i||(_i={}));/*!
 * @pixi/settings - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/settings is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Tv={createCanvas:function(s,t){var e=document.createElement("canvas");return e.width=s,e.height=t,e},getWebGLRenderingContext:function(){return WebGLRenderingContext},getNavigator:function(){return navigator},getBaseUrl:function(){var s;return(s=document.baseURI)!==null&&s!==void 0?s:window.location.href},fetch:function(s,t){return fetch(s,t)}},a_=/iPhone/i,Ig=/iPod/i,Tg=/iPad/i,Rg=/\biOS-universal(?:.+)Mac\b/i,o_=/\bAndroid(?:.+)Mobile\b/i,Og=/Android/i,kn=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Hh=/Silk/i,Ri=/Windows Phone/i,Ag=/\bWindows(?:.+)ARM\b/i,vg=/BlackBerry/i,Sg=/BB10/i,yg=/Opera Mini/i,Cg=/\b(CriOS|Chrome)(?:.+)Mobile/i,Mg=/Mobile(?:.+)Firefox\b/i,Ng=function(s){return typeof s<"u"&&s.platform==="MacIntel"&&typeof s.maxTouchPoints=="number"&&s.maxTouchPoints>1&&typeof MSStream>"u"};function Rv(s){return function(t){return t.test(s)}}function Ov(s){var t={userAgent:"",platform:"",maxTouchPoints:0};!s&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof s=="string"?t.userAgent=s:s&&s.userAgent&&(t={userAgent:s.userAgent,platform:s.platform,maxTouchPoints:s.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),i=e.split("Twitter"),typeof i[1]<"u"&&(e=i[0]);var r=Rv(e),n={apple:{phone:r(a_)&&!r(Ri),ipod:r(Ig),tablet:!r(a_)&&(r(Tg)||Ng(t))&&!r(Ri),universal:r(Rg),device:(r(a_)||r(Ig)||r(Tg)||r(Rg)||Ng(t))&&!r(Ri)},amazon:{phone:r(kn),tablet:!r(kn)&&r(Hh),device:r(kn)||r(Hh)},android:{phone:!r(Ri)&&r(kn)||!r(Ri)&&r(o_),tablet:!r(Ri)&&!r(kn)&&!r(o_)&&(r(Hh)||r(Og)),device:!r(Ri)&&(r(kn)||r(Hh)||r(o_)||r(Og))||r(/\bokhttp\b/i)},windows:{phone:r(Ri),tablet:r(Ag),device:r(Ri)||r(Ag)},other:{blackberry:r(vg),blackberry10:r(Sg),opera:r(yg),firefox:r(Mg),chrome:r(Cg),device:r(vg)||r(Sg)||r(yg)||r(Mg)||r(Cg)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}var dn=Ov(globalThis.navigator);function Av(){return!dn.apple.device}function vv(s){var t=!0;if(dn.tablet||dn.phone){if(dn.apple.device){var e=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(e){var i=parseInt(e[1],10);i<11&&(t=!1)}}if(dn.android.device){var e=navigator.userAgent.match(/Android\s([0-9.]*)/);if(e){var i=parseInt(e[1],10);i<7&&(t=!1)}}}return t?s:4}var Z={ADAPTER:Tv,MIPMAP_TEXTURES:Ur.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:oe.NONE,SPRITE_MAX_TEXTURES:vv(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:Fu.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:qi.CLAMP,SCALE_MODE:hs.LINEAR,PRECISION_VERTEX:Es.HIGH,PRECISION_FRAGMENT:dn.apple.device?Es.HIGH:Es.MEDIUM,CAN_UPLOAD_SAME_BUFFER:Av(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},Sp={exports:{}};(function(s){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function r(h,u,c){this.fn=h,this.context=u,this.once=c||!1}function n(h,u,c,l,_){if(typeof c!="function")throw new TypeError("The listener must be a function");var d=new r(c,l||h,_),g=e?e+u:u;return h._events[g]?h._events[g].fn?h._events[g]=[h._events[g],d]:h._events[g].push(d):(h._events[g]=d,h._eventsCount++),h}function a(h,u){--h._eventsCount===0?h._events=new i:delete h._events[u]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,l;if(this._eventsCount===0)return u;for(l in c=this._events)t.call(c,l)&&u.push(e?l.slice(1):l);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=e?e+u:u,l=this._events[c];if(!l)return[];if(l.fn)return[l.fn];for(var _=0,d=l.length,g=new Array(d);_<d;_++)g[_]=l[_].fn;return g},o.prototype.listenerCount=function(u){var c=e?e+u:u,l=this._events[c];return l?l.fn?1:l.length:0},o.prototype.emit=function(u,c,l,_,d,g){var m=e?e+u:u;if(!this._events[m])return!1;var p=this._events[m],T=arguments.length,A,O;if(p.fn){switch(p.once&&this.removeListener(u,p.fn,void 0,!0),T){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,c),!0;case 3:return p.fn.call(p.context,c,l),!0;case 4:return p.fn.call(p.context,c,l,_),!0;case 5:return p.fn.call(p.context,c,l,_,d),!0;case 6:return p.fn.call(p.context,c,l,_,d,g),!0}for(O=1,A=new Array(T-1);O<T;O++)A[O-1]=arguments[O];p.fn.apply(p.context,A)}else{var v=p.length,y;for(O=0;O<v;O++)switch(p[O].once&&this.removeListener(u,p[O].fn,void 0,!0),T){case 1:p[O].fn.call(p[O].context);break;case 2:p[O].fn.call(p[O].context,c);break;case 3:p[O].fn.call(p[O].context,c,l);break;case 4:p[O].fn.call(p[O].context,c,l,_);break;default:if(!A)for(y=1,A=new Array(T-1);y<T;y++)A[y-1]=arguments[y];p[O].fn.apply(p[O].context,A)}}return!0},o.prototype.on=function(u,c,l){return n(this,u,c,l,!1)},o.prototype.once=function(u,c,l){return n(this,u,c,l,!0)},o.prototype.removeListener=function(u,c,l,_){var d=e?e+u:u;if(!this._events[d])return this;if(!c)return a(this,d),this;var g=this._events[d];if(g.fn)g.fn===c&&(!_||g.once)&&(!l||g.context===l)&&a(this,d);else{for(var m=0,p=[],T=g.length;m<T;m++)(g[m].fn!==c||_&&!g[m].once||l&&g[m].context!==l)&&p.push(g[m]);p.length?this._events[d]=p.length===1?p[0]:p:a(this,d)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=e?e+u:u,this._events[c]&&a(this,c)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,s.exports=o})(Sp);var Sv=Sp.exports;const nh=uf(Sv);var lf={exports:{}};lf.exports=El;lf.exports.default=El;function El(s,t,e){e=e||2;var i=t&&t.length,r=i?t[0]*e:s.length,n=yp(s,0,r,e,!0),a=[];if(!n||n.next===n.prev)return a;var o,h,u,c,l,_,d;if(i&&(n=Pv(s,t,n,e)),s.length>80*e){o=u=s[0],h=c=s[1];for(var g=e;g<r;g+=e)l=s[g],_=s[g+1],l<o&&(o=l),_<h&&(h=_),l>u&&(u=l),_>c&&(c=_);d=Math.max(u-o,c-h),d=d!==0?32767/d:0}return xo(n,a,e,o,h,d,0),a}function yp(s,t,e,i,r){var n,a;if(r===ic(s,t,e,i)>0)for(n=t;n<e;n+=i)a=Pg(n,s[n],s[n+1],a);else for(n=e-i;n>=t;n-=i)a=Pg(n,s[n],s[n+1],a);return a&&pl(a,a.next)&&(wo(a),a=a.next),a}function Cn(s,t){if(!s)return s;t||(t=s);var e=s,i;do if(i=!1,!e.steiner&&(pl(e,e.next)||he(e.prev,e,e.next)===0)){if(wo(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function xo(s,t,e,i,r,n,a){if(s){!a&&n&&xv(s,i,r,n);for(var o=s,h,u;s.prev!==s.next;){if(h=s.prev,u=s.next,n?Cv(s,i,r,n):yv(s)){t.push(h.i/e|0),t.push(s.i/e|0),t.push(u.i/e|0),wo(s),s=u.next,o=u.next;continue}if(s=u,s===o){a?a===1?(s=Mv(Cn(s),t,e),xo(s,t,e,i,r,n,2)):a===2&&Nv(s,t,e,i,r,n):xo(Cn(s),t,e,i,r,n,1);break}}}}function yv(s){var t=s.prev,e=s,i=s.next;if(he(t,e,i)>=0)return!1;for(var r=t.x,n=e.x,a=i.x,o=t.y,h=e.y,u=i.y,c=r<n?r<a?r:a:n<a?n:a,l=o<h?o<u?o:u:h<u?h:u,_=r>n?r>a?r:a:n>a?n:a,d=o>h?o>u?o:u:h>u?h:u,g=i.next;g!==t;){if(g.x>=c&&g.x<=_&&g.y>=l&&g.y<=d&&ra(r,o,n,h,a,u,g.x,g.y)&&he(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function Cv(s,t,e,i){var r=s.prev,n=s,a=s.next;if(he(r,n,a)>=0)return!1;for(var o=r.x,h=n.x,u=a.x,c=r.y,l=n.y,_=a.y,d=o<h?o<u?o:u:h<u?h:u,g=c<l?c<_?c:_:l<_?l:_,m=o>h?o>u?o:u:h>u?h:u,p=c>l?c>_?c:_:l>_?l:_,T=ec(d,g,t,e,i),A=ec(m,p,t,e,i),O=s.prevZ,v=s.nextZ;O&&O.z>=T&&v&&v.z<=A;){if(O.x>=d&&O.x<=m&&O.y>=g&&O.y<=p&&O!==r&&O!==a&&ra(o,c,h,l,u,_,O.x,O.y)&&he(O.prev,O,O.next)>=0||(O=O.prevZ,v.x>=d&&v.x<=m&&v.y>=g&&v.y<=p&&v!==r&&v!==a&&ra(o,c,h,l,u,_,v.x,v.y)&&he(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;O&&O.z>=T;){if(O.x>=d&&O.x<=m&&O.y>=g&&O.y<=p&&O!==r&&O!==a&&ra(o,c,h,l,u,_,O.x,O.y)&&he(O.prev,O,O.next)>=0)return!1;O=O.prevZ}for(;v&&v.z<=A;){if(v.x>=d&&v.x<=m&&v.y>=g&&v.y<=p&&v!==r&&v!==a&&ra(o,c,h,l,u,_,v.x,v.y)&&he(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Mv(s,t,e){var i=s;do{var r=i.prev,n=i.next.next;!pl(r,n)&&Cp(r,i,i.next,n)&&Fo(r,n)&&Fo(n,r)&&(t.push(r.i/e|0),t.push(i.i/e|0),t.push(n.i/e|0),wo(i),wo(i.next),i=s=n),i=i.next}while(i!==s);return Cn(i)}function Nv(s,t,e,i,r,n){var a=s;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&Gv(a,o)){var h=Mp(a,o);a=Cn(a,a.next),h=Cn(h,h.next),xo(a,t,e,i,r,n,0),xo(h,t,e,i,r,n,0);return}o=o.next}a=a.next}while(a!==s)}function Pv(s,t,e,i){var r=[],n,a,o,h,u;for(n=0,a=t.length;n<a;n++)o=t[n]*i,h=n<a-1?t[n+1]*i:s.length,u=yp(s,o,h,i,!1),u===u.next&&(u.steiner=!0),r.push(wv(u));for(r.sort(bv),n=0;n<r.length;n++)e=Dv(r[n],e);return e}function bv(s,t){return s.x-t.x}function Dv(s,t){var e=Lv(s,t);if(!e)return t;var i=Mp(e,s);return Cn(i,i.next),Cn(e,e.next)}function Lv(s,t){var e=t,i=s.x,r=s.y,n=-1/0,a;do{if(r<=e.y&&r>=e.next.y&&e.next.y!==e.y){var o=e.x+(r-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(o<=i&&o>n&&(n=o,a=e.x<e.next.x?e:e.next,o===i))return a}e=e.next}while(e!==t);if(!a)return null;var h=a,u=a.x,c=a.y,l=1/0,_;e=a;do i>=e.x&&e.x>=u&&i!==e.x&&ra(r<c?i:n,r,u,c,r<c?n:i,r,e.x,e.y)&&(_=Math.abs(r-e.y)/(i-e.x),Fo(e,s)&&(_<l||_===l&&(e.x>a.x||e.x===a.x&&Uv(a,e)))&&(a=e,l=_)),e=e.next;while(e!==h);return a}function Uv(s,t){return he(s.prev,s,t.prev)<0&&he(t.next,s,s.next)<0}function xv(s,t,e,i){var r=s;do r.z===0&&(r.z=ec(r.x,r.y,t,e,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==s);r.prevZ.nextZ=null,r.prevZ=null,Fv(r)}function Fv(s){var t,e,i,r,n,a,o,h,u=1;do{for(e=s,s=null,n=null,a=0;e;){for(a++,i=e,o=0,t=0;t<u&&(o++,i=i.nextZ,!!i);t++);for(h=u;o>0||h>0&&i;)o!==0&&(h===0||!i||e.z<=i.z)?(r=e,e=e.nextZ,o--):(r=i,i=i.nextZ,h--),n?n.nextZ=r:s=r,r.prevZ=n,n=r;e=i}n.nextZ=null,u*=2}while(a>1);return s}function ec(s,t,e,i,r){return s=(s-e)*r|0,t=(t-i)*r|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,s|t<<1}function wv(s){var t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function ra(s,t,e,i,r,n,a,o){return(r-a)*(t-o)>=(s-a)*(n-o)&&(s-a)*(i-o)>=(e-a)*(t-o)&&(e-a)*(n-o)>=(r-a)*(i-o)}function Gv(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!Bv(s,t)&&(Fo(s,t)&&Fo(t,s)&&Hv(s,t)&&(he(s.prev,s,t.prev)||he(s,t.prev,t))||pl(s,t)&&he(s.prev,s,s.next)>0&&he(t.prev,t,t.next)>0)}function he(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function pl(s,t){return s.x===t.x&&s.y===t.y}function Cp(s,t,e,i){var r=kh(he(s,t,e)),n=kh(he(s,t,i)),a=kh(he(e,i,s)),o=kh(he(e,i,t));return!!(r!==n&&a!==o||r===0&&Vh(s,e,t)||n===0&&Vh(s,i,t)||a===0&&Vh(e,s,i)||o===0&&Vh(e,t,i))}function Vh(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function kh(s){return s>0?1:s<0?-1:0}function Bv(s,t){var e=s;do{if(e.i!==s.i&&e.next.i!==s.i&&e.i!==t.i&&e.next.i!==t.i&&Cp(e,e.next,s,t))return!0;e=e.next}while(e!==s);return!1}function Fo(s,t){return he(s.prev,s,s.next)<0?he(s,t,s.next)>=0&&he(s,s.prev,t)>=0:he(s,t,s.prev)<0||he(s,s.next,t)<0}function Hv(s,t){var e=s,i=!1,r=(s.x+t.x)/2,n=(s.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&r<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==s);return i}function Mp(s,t){var e=new sc(s.i,s.x,s.y),i=new sc(t.i,t.x,t.y),r=s.next,n=t.prev;return s.next=t,t.prev=s,e.next=r,r.prev=e,i.next=e,e.prev=i,n.next=i,i.prev=n,i}function Pg(s,t,e,i){var r=new sc(s,t,e);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function wo(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function sc(s,t,e){this.i=s,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}El.deviation=function(s,t,e,i){var r=t&&t.length,n=r?t[0]*e:s.length,a=Math.abs(ic(s,0,n,e));if(r)for(var o=0,h=t.length;o<h;o++){var u=t[o]*e,c=o<h-1?t[o+1]*e:s.length;a-=Math.abs(ic(s,u,c,e))}var l=0;for(o=0;o<i.length;o+=3){var _=i[o]*e,d=i[o+1]*e,g=i[o+2]*e;l+=Math.abs((s[_]-s[g])*(s[d+1]-s[_+1])-(s[_]-s[d])*(s[g+1]-s[_+1]))}return a===0&&l===0?0:Math.abs((l-a)/a)};function ic(s,t,e,i){for(var r=0,n=t,a=e-i;n<e;n+=i)r+=(s[a]-s[n])*(s[n+1]+s[a+1]),a=n;return r}El.flatten=function(s){for(var t=s[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,r=0;r<s.length;r++){for(var n=0;n<s[r].length;n++)for(var a=0;a<t;a++)e.vertices.push(s[r][n][a]);r>0&&(i+=s[r-1].length,e.holes.push(i))}return e};var Vv=lf.exports;const Np=uf(Vv);var wu={exports:{}};/*! https://mths.be/punycode v1.3.2 by @mathias */wu.exports;(function(s,t){(function(e){var i=t&&!t.nodeType&&t,r=s&&!s.nodeType&&s,n=typeof Er=="object"&&Er;(n.global===n||n.window===n||n.self===n)&&(e=n);var a,o=2147483647,h=36,u=1,c=26,l=38,_=700,d=72,g=128,m="-",p=/^xn--/,T=/[^\x20-\x7E]/,A=/[\x2E\u3002\uFF0E\uFF61]/g,O={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=h-u,y=Math.floor,C=String.fromCharCode,N;function L(X){throw RangeError(O[X])}function P(X,st){for(var gt=X.length,Et=[];gt--;)Et[gt]=st(X[gt]);return Et}function b(X,st){var gt=X.split("@"),Et="";gt.length>1&&(Et=gt[0]+"@",X=gt[1]),X=X.replace(A,".");var pt=X.split("."),Gt=P(pt,st).join(".");return Et+Gt}function w(X){for(var st=[],gt=0,Et=X.length,pt,Gt;gt<Et;)pt=X.charCodeAt(gt++),pt>=55296&&pt<=56319&&gt<Et?(Gt=X.charCodeAt(gt++),(Gt&64512)==56320?st.push(((pt&1023)<<10)+(Gt&1023)+65536):(st.push(pt),gt--)):st.push(pt);return st}function q(X){return P(X,function(st){var gt="";return st>65535&&(st-=65536,gt+=C(st>>>10&1023|55296),st=56320|st&1023),gt+=C(st),gt}).join("")}function ht(X){return X-48<10?X-22:X-65<26?X-65:X-97<26?X-97:h}function dt(X,st){return X+22+75*(X<26)-((st!=0)<<5)}function j(X,st,gt){var Et=0;for(X=gt?y(X/_):X>>1,X+=y(X/st);X>v*c>>1;Et+=h)X=y(X/v);return y(Et+(v+1)*X/(X+l))}function V(X){var st=[],gt=X.length,Et,pt=0,Gt=g,jt=d,Jt,ee,Ne,we,ie,Te,Se,Qs,Js;for(Jt=X.lastIndexOf(m),Jt<0&&(Jt=0),ee=0;ee<Jt;++ee)X.charCodeAt(ee)>=128&&L("not-basic"),st.push(X.charCodeAt(ee));for(Ne=Jt>0?Jt+1:0;Ne<gt;){for(we=pt,ie=1,Te=h;Ne>=gt&&L("invalid-input"),Se=ht(X.charCodeAt(Ne++)),(Se>=h||Se>y((o-pt)/ie))&&L("overflow"),pt+=Se*ie,Qs=Te<=jt?u:Te>=jt+c?c:Te-jt,!(Se<Qs);Te+=h)Js=h-Qs,ie>y(o/Js)&&L("overflow"),ie*=Js;Et=st.length+1,jt=j(pt-we,Et,we==0),y(pt/Et)>o-Gt&&L("overflow"),Gt+=y(pt/Et),pt%=Et,st.splice(pt++,0,Gt)}return q(st)}function Dt(X){var st,gt,Et,pt,Gt,jt,Jt,ee,Ne,we,ie,Te=[],Se,Qs,Js,Ja;for(X=w(X),Se=X.length,st=g,gt=0,Gt=d,jt=0;jt<Se;++jt)ie=X[jt],ie<128&&Te.push(C(ie));for(Et=pt=Te.length,pt&&Te.push(m);Et<Se;){for(Jt=o,jt=0;jt<Se;++jt)ie=X[jt],ie>=st&&ie<Jt&&(Jt=ie);for(Qs=Et+1,Jt-st>y((o-gt)/Qs)&&L("overflow"),gt+=(Jt-st)*Qs,st=Jt,jt=0;jt<Se;++jt)if(ie=X[jt],ie<st&&++gt>o&&L("overflow"),ie==st){for(ee=gt,Ne=h;we=Ne<=Gt?u:Ne>=Gt+c?c:Ne-Gt,!(ee<we);Ne+=h)Ja=ee-we,Js=h-we,Te.push(C(dt(we+Ja%Js,0))),ee=y(Ja/Js);Te.push(C(dt(ee,0))),Gt=j(gt,Qs,Et==pt),gt=0,++Et}++gt,++st}return Te.join("")}function Fe(X){return b(X,function(st){return p.test(st)?V(st.slice(4).toLowerCase()):st})}function qe(X){return b(X,function(st){return T.test(st)?"xn--"+Dt(st):st})}if(a={version:"1.3.2",ucs2:{decode:w,encode:q},decode:V,encode:Dt,toASCII:qe,toUnicode:Fe},i&&r)if(s.exports==i)r.exports=a;else for(N in a)a.hasOwnProperty(N)&&(i[N]=a[N]);else e.punycode=a})(Er)})(wu,wu.exports);var kv=wu.exports,jv={isString:function(s){return typeof s=="string"},isObject:function(s){return typeof s=="object"&&s!==null},isNull:function(s){return s===null},isNullOrUndefined:function(s){return s==null}},Go={};function zv(s,t){return Object.prototype.hasOwnProperty.call(s,t)}var Yv=function(s,t,e,i){t=t||"&",e=e||"=";var r={};if(typeof s!="string"||s.length===0)return r;var n=/\+/g;s=s.split(t);var a=1e3;i&&typeof i.maxKeys=="number"&&(a=i.maxKeys);var o=s.length;a>0&&o>a&&(o=a);for(var h=0;h<o;++h){var u=s[h].replace(n,"%20"),c=u.indexOf(e),l,_,d,g;c>=0?(l=u.substr(0,c),_=u.substr(c+1)):(l=u,_=""),d=decodeURIComponent(l),g=decodeURIComponent(_),zv(r,d)?Array.isArray(r[d])?r[d].push(g):r[d]=[r[d],g]:r[d]=g}return r},$a=function(s){switch(typeof s){case"string":return s;case"boolean":return s?"true":"false";case"number":return isFinite(s)?s:"";default:return""}},Wv=function(s,t,e,i){return t=t||"&",e=e||"=",s===null&&(s=void 0),typeof s=="object"?Object.keys(s).map(function(r){var n=encodeURIComponent($a(r))+e;return Array.isArray(s[r])?s[r].map(function(a){return n+encodeURIComponent($a(a))}).join(t):n+encodeURIComponent($a(s[r]))}).join(t):i?encodeURIComponent($a(i))+e+encodeURIComponent($a(s)):""};Go.decode=Go.parse=Yv;Go.encode=Go.stringify=Wv;var Xv=kv,ri=jv,Kv=ml,qv=aS,Zv=nS;function ks(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Qv=/^([a-z0-9.+-]+:)/i,Jv=/:[0-9]*$/,$v=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,tS=["<",">",'"',"`"," ","\r",`
`,"	"],eS=["{","}","|","\\","^","`"].concat(tS),rc=["'"].concat(eS),bg=["%","/","?",";","#"].concat(rc),Dg=["/","?","#"],sS=255,Lg=/^[+a-z0-9A-Z_-]{0,63}$/,iS=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,rS={javascript:!0,"javascript:":!0},nc={javascript:!0,"javascript:":!0},pa={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},ac=Go;function ml(s,t,e){if(s&&ri.isObject(s)&&s instanceof ks)return s;var i=new ks;return i.parse(s,t,e),i}ks.prototype.parse=function(s,t,e){if(!ri.isString(s))throw new TypeError("Parameter 'url' must be a string, not "+typeof s);var i=s.indexOf("?"),r=i!==-1&&i<s.indexOf("#")?"?":"#",n=s.split(r),a=/\\/g;n[0]=n[0].replace(a,"/"),s=n.join(r);var o=s;if(o=o.trim(),!e&&s.split("#").length===1){var h=$v.exec(o);if(h)return this.path=o,this.href=o,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=ac.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var u=Qv.exec(o);if(u){u=u[0];var c=u.toLowerCase();this.protocol=c,o=o.substr(u.length)}if(e||u||o.match(/^\/\/[^@\/]+@[^@\/]+/)){var l=o.substr(0,2)==="//";l&&!(u&&nc[u])&&(o=o.substr(2),this.slashes=!0)}if(!nc[u]&&(l||u&&!pa[u])){for(var _=-1,d=0;d<Dg.length;d++){var g=o.indexOf(Dg[d]);g!==-1&&(_===-1||g<_)&&(_=g)}var m,p;_===-1?p=o.lastIndexOf("@"):p=o.lastIndexOf("@",_),p!==-1&&(m=o.slice(0,p),o=o.slice(p+1),this.auth=decodeURIComponent(m)),_=-1;for(var d=0;d<bg.length;d++){var g=o.indexOf(bg[d]);g!==-1&&(_===-1||g<_)&&(_=g)}_===-1&&(_=o.length),this.host=o.slice(0,_),o=o.slice(_),this.parseHost(),this.hostname=this.hostname||"";var T=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!T)for(var A=this.hostname.split(/\./),d=0,O=A.length;d<O;d++){var v=A[d];if(v&&!v.match(Lg)){for(var y="",C=0,N=v.length;C<N;C++)v.charCodeAt(C)>127?y+="x":y+=v[C];if(!y.match(Lg)){var L=A.slice(0,d),P=A.slice(d+1),b=v.match(iS);b&&(L.push(b[1]),P.unshift(b[2])),P.length&&(o="/"+P.join(".")+o),this.hostname=L.join(".");break}}}this.hostname.length>sS?this.hostname="":this.hostname=this.hostname.toLowerCase(),T||(this.hostname=Xv.toASCII(this.hostname));var w=this.port?":"+this.port:"",q=this.hostname||"";this.host=q+w,this.href+=this.host,T&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),o[0]!=="/"&&(o="/"+o))}if(!rS[c])for(var d=0,O=rc.length;d<O;d++){var ht=rc[d];if(o.indexOf(ht)!==-1){var dt=encodeURIComponent(ht);dt===ht&&(dt=escape(ht)),o=o.split(ht).join(dt)}}var j=o.indexOf("#");j!==-1&&(this.hash=o.substr(j),o=o.slice(0,j));var V=o.indexOf("?");if(V!==-1?(this.search=o.substr(V),this.query=o.substr(V+1),t&&(this.query=ac.parse(this.query)),o=o.slice(0,V)):t&&(this.search="",this.query={}),o&&(this.pathname=o),pa[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var w=this.pathname||"",Dt=this.search||"";this.path=w+Dt}return this.href=this.format(),this};function nS(s){return ri.isString(s)&&(s=ml(s)),s instanceof ks?s.format():ks.prototype.format.call(s)}ks.prototype.format=function(){var s=this.auth||"";s&&(s=encodeURIComponent(s),s=s.replace(/%3A/i,":"),s+="@");var t=this.protocol||"",e=this.pathname||"",i=this.hash||"",r=!1,n="";this.host?r=s+this.host:this.hostname&&(r=s+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&ri.isObject(this.query)&&Object.keys(this.query).length&&(n=ac.stringify(this.query));var a=this.search||n&&"?"+n||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||pa[t])&&r!==!1?(r="//"+(r||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):r||(r=""),i&&i.charAt(0)!=="#"&&(i="#"+i),a&&a.charAt(0)!=="?"&&(a="?"+a),e=e.replace(/[?#]/g,function(o){return encodeURIComponent(o)}),a=a.replace("#","%23"),t+r+e+a+i};function aS(s,t){return ml(s,!1,!0).resolve(t)}ks.prototype.resolve=function(s){return this.resolveObject(ml(s,!1,!0)).format()};ks.prototype.resolveObject=function(s){if(ri.isString(s)){var t=new ks;t.parse(s,!1,!0),s=t}for(var e=new ks,i=Object.keys(this),r=0;r<i.length;r++){var n=i[r];e[n]=this[n]}if(e.hash=s.hash,s.href==="")return e.href=e.format(),e;if(s.slashes&&!s.protocol){for(var a=Object.keys(s),o=0;o<a.length;o++){var h=a[o];h!=="protocol"&&(e[h]=s[h])}return pa[e.protocol]&&e.hostname&&!e.pathname&&(e.path=e.pathname="/"),e.href=e.format(),e}if(s.protocol&&s.protocol!==e.protocol){if(!pa[s.protocol]){for(var u=Object.keys(s),c=0;c<u.length;c++){var l=u[c];e[l]=s[l]}return e.href=e.format(),e}if(e.protocol=s.protocol,!s.host&&!nc[s.protocol]){for(var O=(s.pathname||"").split("/");O.length&&!(s.host=O.shift()););s.host||(s.host=""),s.hostname||(s.hostname=""),O[0]!==""&&O.unshift(""),O.length<2&&O.unshift(""),e.pathname=O.join("/")}else e.pathname=s.pathname;if(e.search=s.search,e.query=s.query,e.host=s.host||"",e.auth=s.auth,e.hostname=s.hostname||s.host,e.port=s.port,e.pathname||e.search){var _=e.pathname||"",d=e.search||"";e.path=_+d}return e.slashes=e.slashes||s.slashes,e.href=e.format(),e}var g=e.pathname&&e.pathname.charAt(0)==="/",m=s.host||s.pathname&&s.pathname.charAt(0)==="/",p=m||g||e.host&&s.pathname,T=p,A=e.pathname&&e.pathname.split("/")||[],O=s.pathname&&s.pathname.split("/")||[],v=e.protocol&&!pa[e.protocol];if(v&&(e.hostname="",e.port=null,e.host&&(A[0]===""?A[0]=e.host:A.unshift(e.host)),e.host="",s.protocol&&(s.hostname=null,s.port=null,s.host&&(O[0]===""?O[0]=s.host:O.unshift(s.host)),s.host=null),p=p&&(O[0]===""||A[0]==="")),m)e.host=s.host||s.host===""?s.host:e.host,e.hostname=s.hostname||s.hostname===""?s.hostname:e.hostname,e.search=s.search,e.query=s.query,A=O;else if(O.length)A||(A=[]),A.pop(),A=A.concat(O),e.search=s.search,e.query=s.query;else if(!ri.isNullOrUndefined(s.search)){if(v){e.hostname=e.host=A.shift();var y=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;y&&(e.auth=y.shift(),e.host=e.hostname=y.shift())}return e.search=s.search,e.query=s.query,(!ri.isNull(e.pathname)||!ri.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!A.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var C=A.slice(-1)[0],N=(e.host||s.host||A.length>1)&&(C==="."||C==="..")||C==="",L=0,P=A.length;P>=0;P--)C=A[P],C==="."?A.splice(P,1):C===".."?(A.splice(P,1),L++):L&&(A.splice(P,1),L--);if(!p&&!T)for(;L--;L)A.unshift("..");p&&A[0]!==""&&(!A[0]||A[0].charAt(0)!=="/")&&A.unshift(""),N&&A.join("/").substr(-1)!=="/"&&A.push("");var b=A[0]===""||A[0]&&A[0].charAt(0)==="/";if(v){e.hostname=e.host=b?"":A.length?A.shift():"";var y=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;y&&(e.auth=y.shift(),e.host=e.hostname=y.shift())}return p=p||e.host&&A.length,p&&!b&&A.unshift(""),A.length?e.pathname=A.join("/"):(e.pathname=null,e.path=null),(!ri.isNull(e.pathname)||!ri.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=s.auth||e.auth,e.slashes=e.slashes||s.slashes,e.href=e.format(),e};ks.prototype.parseHost=function(){var s=this.host,t=Jv.exec(s);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),s=s.substr(0,s.length-t.length)),s&&(this.hostname=s)};/*!
 * @pixi/utils - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/utils is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var ao={parse:Kv,format:Zv,resolve:qv};Z.RETINA_PREFIX=/@([0-9\.]+)x/;Z.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Ug=!1,xg="6.5.9";function oS(s){var t;if(!Ug){if(Z.ADAPTER.getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){var e=[`
 %c %c %c PixiJS `+xg+" - ✰ "+s+` ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ 

`,"background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(t=globalThis.console).log.apply(t,e)}else globalThis.console&&globalThis.console.log("PixiJS "+xg+" - "+s+" - http://www.pixijs.com/");Ug=!0}}var h_;function hS(){return typeof h_>"u"&&(h_=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:Z.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Z.ADAPTER.getWebGLRenderingContext())return!1;var e=Z.ADAPTER.createCanvas(),i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),r=!!(i&&i.getContextAttributes().stencil);if(i){var n=i.getExtension("WEBGL_lose_context");n&&n.loseContext()}return i=null,r}catch{return!1}}()),h_}var uS="#f0f8ff",lS="#faebd7",_S="#00ffff",cS="#7fffd4",dS="#f0ffff",fS="#f5f5dc",gS="#ffe4c4",ES="#000000",pS="#ffebcd",mS="#0000ff",IS="#8a2be2",TS="#a52a2a",RS="#deb887",OS="#5f9ea0",AS="#7fff00",vS="#d2691e",SS="#ff7f50",yS="#6495ed",CS="#fff8dc",MS="#dc143c",NS="#00ffff",PS="#00008b",bS="#008b8b",DS="#b8860b",LS="#a9a9a9",US="#006400",xS="#a9a9a9",FS="#bdb76b",wS="#8b008b",GS="#556b2f",BS="#ff8c00",HS="#9932cc",VS="#8b0000",kS="#e9967a",jS="#8fbc8f",zS="#483d8b",YS="#2f4f4f",WS="#2f4f4f",XS="#00ced1",KS="#9400d3",qS="#ff1493",ZS="#00bfff",QS="#696969",JS="#696969",$S="#1e90ff",ty="#b22222",ey="#fffaf0",sy="#228b22",iy="#ff00ff",ry="#dcdcdc",ny="#f8f8ff",ay="#daa520",oy="#ffd700",hy="#808080",uy="#008000",ly="#adff2f",_y="#808080",cy="#f0fff0",dy="#ff69b4",fy="#cd5c5c",gy="#4b0082",Ey="#fffff0",py="#f0e68c",my="#fff0f5",Iy="#e6e6fa",Ty="#7cfc00",Ry="#fffacd",Oy="#add8e6",Ay="#f08080",vy="#e0ffff",Sy="#fafad2",yy="#d3d3d3",Cy="#90ee90",My="#d3d3d3",Ny="#ffb6c1",Py="#ffa07a",by="#20b2aa",Dy="#87cefa",Ly="#778899",Uy="#778899",xy="#b0c4de",Fy="#ffffe0",wy="#00ff00",Gy="#32cd32",By="#faf0e6",Hy="#ff00ff",Vy="#800000",ky="#66cdaa",jy="#0000cd",zy="#ba55d3",Yy="#9370db",Wy="#3cb371",Xy="#7b68ee",Ky="#00fa9a",qy="#48d1cc",Zy="#c71585",Qy="#191970",Jy="#f5fffa",$y="#ffe4e1",t0="#ffe4b5",e0="#ffdead",s0="#000080",i0="#fdf5e6",r0="#808000",n0="#6b8e23",a0="#ffa500",o0="#ff4500",h0="#da70d6",u0="#eee8aa",l0="#98fb98",_0="#afeeee",c0="#db7093",d0="#ffefd5",f0="#ffdab9",g0="#cd853f",E0="#ffc0cb",p0="#dda0dd",m0="#b0e0e6",I0="#800080",T0="#663399",R0="#ff0000",O0="#bc8f8f",A0="#4169e1",v0="#8b4513",S0="#fa8072",y0="#f4a460",C0="#2e8b57",M0="#fff5ee",N0="#a0522d",P0="#c0c0c0",b0="#87ceeb",D0="#6a5acd",L0="#708090",U0="#708090",x0="#fffafa",F0="#00ff7f",w0="#4682b4",G0="#d2b48c",B0="#008080",H0="#d8bfd8",V0="#ff6347",k0="#40e0d0",j0="#ee82ee",z0="#f5deb3",Y0="#ffffff",W0="#f5f5f5",X0="#ffff00",K0="#9acd32",q0={aliceblue:uS,antiquewhite:lS,aqua:_S,aquamarine:cS,azure:dS,beige:fS,bisque:gS,black:ES,blanchedalmond:pS,blue:mS,blueviolet:IS,brown:TS,burlywood:RS,cadetblue:OS,chartreuse:AS,chocolate:vS,coral:SS,cornflowerblue:yS,cornsilk:CS,crimson:MS,cyan:NS,darkblue:PS,darkcyan:bS,darkgoldenrod:DS,darkgray:LS,darkgreen:US,darkgrey:xS,darkkhaki:FS,darkmagenta:wS,darkolivegreen:GS,darkorange:BS,darkorchid:HS,darkred:VS,darksalmon:kS,darkseagreen:jS,darkslateblue:zS,darkslategray:YS,darkslategrey:WS,darkturquoise:XS,darkviolet:KS,deeppink:qS,deepskyblue:ZS,dimgray:QS,dimgrey:JS,dodgerblue:$S,firebrick:ty,floralwhite:ey,forestgreen:sy,fuchsia:iy,gainsboro:ry,ghostwhite:ny,goldenrod:ay,gold:oy,gray:hy,green:uy,greenyellow:ly,grey:_y,honeydew:cy,hotpink:dy,indianred:fy,indigo:gy,ivory:Ey,khaki:py,lavenderblush:my,lavender:Iy,lawngreen:Ty,lemonchiffon:Ry,lightblue:Oy,lightcoral:Ay,lightcyan:vy,lightgoldenrodyellow:Sy,lightgray:yy,lightgreen:Cy,lightgrey:My,lightpink:Ny,lightsalmon:Py,lightseagreen:by,lightskyblue:Dy,lightslategray:Ly,lightslategrey:Uy,lightsteelblue:xy,lightyellow:Fy,lime:wy,limegreen:Gy,linen:By,magenta:Hy,maroon:Vy,mediumaquamarine:ky,mediumblue:jy,mediumorchid:zy,mediumpurple:Yy,mediumseagreen:Wy,mediumslateblue:Xy,mediumspringgreen:Ky,mediumturquoise:qy,mediumvioletred:Zy,midnightblue:Qy,mintcream:Jy,mistyrose:$y,moccasin:t0,navajowhite:e0,navy:s0,oldlace:i0,olive:r0,olivedrab:n0,orange:a0,orangered:o0,orchid:h0,palegoldenrod:u0,palegreen:l0,paleturquoise:_0,palevioletred:c0,papayawhip:d0,peachpuff:f0,peru:g0,pink:E0,plum:p0,powderblue:m0,purple:I0,rebeccapurple:T0,red:R0,rosybrown:O0,royalblue:A0,saddlebrown:v0,salmon:S0,sandybrown:y0,seagreen:C0,seashell:M0,sienna:N0,silver:P0,skyblue:b0,slateblue:D0,slategray:L0,slategrey:U0,snow:x0,springgreen:F0,steelblue:w0,tan:G0,teal:B0,thistle:H0,tomato:V0,turquoise:k0,violet:j0,wheat:z0,white:Y0,whitesmoke:W0,yellow:X0,yellowgreen:K0};function Gu(s,t){return t===void 0&&(t=[]),t[0]=(s>>16&255)/255,t[1]=(s>>8&255)/255,t[2]=(s&255)/255,t}function Pp(s){var t=s.toString(16);return t="000000".substring(0,6-t.length)+t,"#"+t}function Z0(s){return typeof s=="string"&&(s=q0[s.toLowerCase()]||s,s[0]==="#"&&(s=s.slice(1))),parseInt(s,16)}function Q0(){for(var s=[],t=[],e=0;e<32;e++)s[e]=e,t[e]=e;s[J.NORMAL_NPM]=J.NORMAL,s[J.ADD_NPM]=J.ADD,s[J.SCREEN_NPM]=J.SCREEN,t[J.NORMAL]=J.NORMAL_NPM,t[J.ADD]=J.ADD_NPM,t[J.SCREEN]=J.SCREEN_NPM;var i=[];return i.push(t),i.push(s),i}var bp=Q0();function J0(s,t){return bp[t?1:0][s]}function Dp(s,t){if(t===1)return(t*255<<24)+s;if(t===0)return 0;var e=s>>16&255,i=s>>8&255,r=s&255;return e=e*t+.5|0,i=i*t+.5|0,r=r*t+.5|0,(t*255<<24)+(e<<16)+(i<<8)+r}function $0(s,t,e,i){return e=e||new Float32Array(4),e[0]=(s>>16&255)/255,e[1]=(s>>8&255)/255,e[2]=(s&255)/255,(i||i===void 0)&&(e[0]*=t,e[1]*=t,e[2]*=t),e[3]=t,e}function tC(s,t){t===void 0&&(t=null);var e=s*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error("Out buffer length is incorrect, got "+t.length+" and expected "+e);for(var i=0,r=0;i<e;i+=6,r+=4)t[i+0]=r+0,t[i+1]=r+1,t[i+2]=r+2,t[i+3]=r+0,t[i+4]=r+2,t[i+5]=r+3;return t}function Lp(s){if(s.BYTES_PER_ELEMENT===4)return s instanceof Float32Array?"Float32Array":s instanceof Uint32Array?"Uint32Array":"Int32Array";if(s.BYTES_PER_ELEMENT===2){if(s instanceof Uint16Array)return"Uint16Array"}else if(s.BYTES_PER_ELEMENT===1&&s instanceof Uint8Array)return"Uint8Array";return null}function Bu(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function Fg(s){return!(s&s-1)&&!!s}function wg(s){var t=(s>65535?1:0)<<4;s>>>=t;var e=(s>255?1:0)<<3;return s>>>=e,t|=e,e=(s>15?1:0)<<2,s>>>=e,t|=e,e=(s>3?1:0)<<1,s>>>=e,t|=e,t|s>>1}function cu(s,t,e){var i=s.length,r;if(!(t>=i||e===0)){e=t+e>i?i-t:e;var n=i-e;for(r=t;r<n;++r)s[r]=s[r+e];s.length=n}}function na(s){return s===0?0:s<0?-1:1}var eC=0;function Mn(){return++eC}var Gg={};function ci(s,t,e){if(e===void 0&&(e=3),!Gg[t]){var i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",t+`
Deprecated since v`+s):(i=i.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",t+`
Deprecated since v`+s),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",t+`
Deprecated since v`+s),console.warn(i))),Gg[t]=!0}}var Bg={},Ai=Object.create(null),Kr=Object.create(null),Hg=function(){function s(t,e,i){this.canvas=Z.ADAPTER.createCanvas(),this.context=this.canvas.getContext("2d"),this.resolution=i||Z.RESOLUTION,this.resize(t,e)}return s.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},s.prototype.resize=function(t,e){this.canvas.width=Math.round(t*this.resolution),this.canvas.height=Math.round(e*this.resolution)},s.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(s.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=Math.round(t)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=Math.round(t)},enumerable:!1,configurable:!0}),s}();function sC(s){var t=s.width,e=s.height,i=s.getContext("2d",{willReadFrequently:!0}),r=i.getImageData(0,0,t,e),n=r.data,a=n.length,o={top:null,left:null,right:null,bottom:null},h=null,u,c,l;for(u=0;u<a;u+=4)n[u+3]!==0&&(c=u/4%t,l=~~(u/4/t),o.top===null&&(o.top=l),(o.left===null||c<o.left)&&(o.left=c),(o.right===null||o.right<c)&&(o.right=c+1),(o.bottom===null||o.bottom<l)&&(o.bottom=l));return o.top!==null&&(t=o.right-o.left,e=o.bottom-o.top+1,h=i.getImageData(o.left,o.top,t,e)),{height:e,width:t,data:h}}var jh;function iC(s,t){if(t===void 0&&(t=globalThis.location),s.indexOf("data:")===0)return"";t=t||globalThis.location,jh||(jh=document.createElement("a")),jh.href=s;var e=ao.parse(jh.href),i=!e.port&&t.port===""||e.port===t.port;return e.hostname!==t.hostname||!i||e.protocol!==t.protocol?"anonymous":""}function oc(s,t){var e=Z.RETINA_PREFIX.exec(s);return e?parseFloat(e[1]):t!==void 0?t:1}/*!
 * @pixi/extensions - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/extensions is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var yo=function(){return yo=Object.assign||function(t){for(var e=arguments,i,r=1,n=arguments.length;r<n;r++){i=e[r];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t},yo.apply(this,arguments)},ve;(function(s){s.Application="application",s.RendererPlugin="renderer-webgl-plugin",s.CanvasRendererPlugin="renderer-canvas-plugin",s.Loader="loader",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser"})(ve||(ve={}));var Vg=function(s){if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");var t=typeof s.extension!="object"?{type:s.extension}:s.extension;s=yo(yo({},t),{ref:s})}if(typeof s=="object")s=yo({},s);else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},er={_addHandlers:null,_removeHandlers:null,_queue:{},remove:function(){for(var s=arguments,t=this,e=[],i=0;i<arguments.length;i++)e[i]=s[i];return e.map(Vg).forEach(function(r){r.type.forEach(function(n){var a,o;return(o=(a=t._removeHandlers)[n])===null||o===void 0?void 0:o.call(a,r)})}),this},add:function(){for(var s=arguments,t=this,e=[],i=0;i<arguments.length;i++)e[i]=s[i];return e.map(Vg).forEach(function(r){r.type.forEach(function(n){var a=t._addHandlers,o=t._queue;a[n]?a[n](r):(o[n]=o[n]||[],o[n].push(r))})}),this},handle:function(s,t,e){var i=this._addHandlers=this._addHandlers||{},r=this._removeHandlers=this._removeHandlers||{};if(i[s]||r[s])throw new Error("Extension type "+s+" already has a handler");i[s]=t,r[s]=e;var n=this._queue;return n[s]&&(n[s].forEach(function(a){return t(a)}),delete n[s]),this},handleByMap:function(s,t){return this.handle(s,function(e){t[e.name]=e.ref},function(e){delete t[e.name]})},handleByList:function(s,t){return this.handle(s,function(e){var i,r;t.includes(e.ref)||(t.push(e.ref),s===ve.Loader&&((r=(i=e.ref).add)===null||r===void 0||r.call(i)))},function(e){var i=t.indexOf(e.ref);i!==-1&&t.splice(i,1)})}};/*!
 * @pixi/runner - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/runner is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var ke=function(){function s(t){this.items=[],this._name=t,this._aliasCount=0}return s.prototype.emit=function(t,e,i,r,n,a,o,h){if(arguments.length>8)throw new Error("max arguments reached");var u=this,c=u.name,l=u.items;this._aliasCount++;for(var _=0,d=l.length;_<d;_++)l[_][c](t,e,i,r,n,a,o,h);return l===this.items&&this._aliasCount--,this},s.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},s.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},s.prototype.remove=function(t){var e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},s.prototype.contains=function(t){return this.items.indexOf(t)!==-1},s.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},s.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(s.prototype,"empty",{get:function(){return this.items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),s}();Object.defineProperties(ke.prototype,{dispatch:{value:ke.prototype.emit},run:{value:ke.prototype.emit}});/*!
 * @pixi/ticker - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/ticker is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */Z.TARGET_FPMS=.06;var Aa;(function(s){s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY"})(Aa||(Aa={}));var u_=function(){function s(t,e,i,r){e===void 0&&(e=null),i===void 0&&(i=0),r===void 0&&(r=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=r}return s.prototype.match=function(t,e){return e===void 0&&(e=null),this.fn===t&&this.context===e},s.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},s.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},s.prototype.destroy=function(t){t===void 0&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},s}(),ni=function(){function s(){var t=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new u_(null,null,1/0),this.deltaMS=1/Z.TARGET_FPMS,this.elapsedMS=1/Z.TARGET_FPMS,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&t._requestId===null&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return s.prototype._requestIfNeeded=function(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},s.prototype._cancelIfNeeded=function(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)},s.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},s.prototype.add=function(t,e,i){return i===void 0&&(i=Aa.NORMAL),this._addListener(new u_(t,e,i))},s.prototype.addOnce=function(t,e,i){return i===void 0&&(i=Aa.NORMAL),this._addListener(new u_(t,e,i,!0))},s.prototype._addListener=function(t){var e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this},s.prototype.remove=function(t,e){for(var i=this._head.next;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(s.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!1,configurable:!0}),s.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},s.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},s.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},s.prototype.update=function(t){t===void 0&&(t=performance.now());var e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var i=t-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=t-i%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Z.TARGET_FPMS;for(var r=this._head,n=r.next;n;)n=n.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(s.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,Z.TARGET_FPMS);this._maxElapsedMS=1/i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(t===0)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(s,"shared",{get:function(){if(!s._shared){var t=s._shared=new s;t.autoStart=!0,t._protected=!0}return s._shared},enumerable:!1,configurable:!0}),Object.defineProperty(s,"system",{get:function(){if(!s._system){var t=s._system=new s;t.autoStart=!0,t._protected=!0}return s._system},enumerable:!1,configurable:!0}),s}(),rC=function(){function s(){}return s.init=function(t){var e=this;t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set:function(i){this._ticker&&this._ticker.remove(this.render,this),this._ticker=i,i&&i.add(this.render,this,Aa.LOW)},get:function(){return this._ticker}}),this.stop=function(){e._ticker.stop()},this.start=function(){e._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?ni.shared:new ni,t.autoStart&&this.start()},s.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},s.extension=ve.Application,s}();/*!
 * @pixi/math - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/math is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Bo=Math.PI*2,nC=180/Math.PI,aC=Math.PI/180,Le;(function(s){s[s.POLY=0]="POLY",s[s.RECT=1]="RECT",s[s.CIRC=2]="CIRC",s[s.ELIP=3]="ELIP",s[s.RREC=4]="RREC"})(Le||(Le={}));var H=function(){function s(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return s.prototype.clone=function(){return new s(this.x,this.y)},s.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},s.prototype.copyTo=function(t){return t.set(this.x,this.y),t},s.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},s.prototype.set=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),this.x=t,this.y=e,this},s.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},s}(),zh=[new H,new H,new H,new H],et=function(){function s(t,e,i,r){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),r===void 0&&(r=0),this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(r),this.type=Le.RECT}return Object.defineProperty(s.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(s,"EMPTY",{get:function(){return new s(0,0,0,0)},enumerable:!1,configurable:!0}),s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height)},s.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},s.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},s.prototype.contains=function(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height},s.prototype.intersects=function(t,e){if(!e){var i=this.x<t.x?t.x:this.x,r=this.right>t.right?t.right:this.right;if(r<=i)return!1;var n=this.y<t.y?t.y:this.y,a=this.bottom>t.bottom?t.bottom:this.bottom;return a>n}var o=this.left,h=this.right,u=this.top,c=this.bottom;if(h<=o||c<=u)return!1;var l=zh[0].set(t.left,t.top),_=zh[1].set(t.left,t.bottom),d=zh[2].set(t.right,t.top),g=zh[3].set(t.right,t.bottom);if(d.x<=l.x||_.y<=l.y)return!1;var m=Math.sign(e.a*e.d-e.b*e.c);if(m===0||(e.apply(l,l),e.apply(_,_),e.apply(d,d),e.apply(g,g),Math.max(l.x,_.x,d.x,g.x)<=o||Math.min(l.x,_.x,d.x,g.x)>=h||Math.max(l.y,_.y,d.y,g.y)<=u||Math.min(l.y,_.y,d.y,g.y)>=c))return!1;var p=m*(_.y-l.y),T=m*(l.x-_.x),A=p*o+T*u,O=p*h+T*u,v=p*o+T*c,y=p*h+T*c;if(Math.max(A,O,v,y)<=p*l.x+T*l.y||Math.min(A,O,v,y)>=p*g.x+T*g.y)return!1;var C=m*(l.y-d.y),N=m*(d.x-l.x),L=C*o+N*u,P=C*h+N*u,b=C*o+N*c,w=C*h+N*c;return!(Math.max(L,P,b,w)<=C*l.x+N*l.y||Math.min(L,P,b,w)>=C*g.x+N*g.y)},s.prototype.pad=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this},s.prototype.fit=function(t){var e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=r,this.height=Math.max(n-r,0),this},s.prototype.ceil=function(t,e){t===void 0&&(t=1),e===void 0&&(e=.001);var i=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=r-this.y,this},s.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=r,this.height=n-r,this},s.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},s}(),oC=function(){function s(t,e,i){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),this.x=t,this.y=e,this.radius=i,this.type=Le.CIRC}return s.prototype.clone=function(){return new s(this.x,this.y,this.radius)},s.prototype.contains=function(t,e){if(this.radius<=0)return!1;var i=this.radius*this.radius,r=this.x-t,n=this.y-e;return r*=r,n*=n,r+n<=i},s.prototype.getBounds=function(){return new et(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)},s.prototype.toString=function(){return"[@pixi/math:Circle x="+this.x+" y="+this.y+" radius="+this.radius+"]"},s}(),hC=function(){function s(t,e,i,r){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),r===void 0&&(r=0),this.x=t,this.y=e,this.width=i,this.height=r,this.type=Le.ELIP}return s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height)},s.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width,r=(e-this.y)/this.height;return i*=i,r*=r,i+r<=1},s.prototype.getBounds=function(){return new et(this.x-this.width,this.y-this.height,this.width,this.height)},s.prototype.toString=function(){return"[@pixi/math:Ellipse x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},s}(),du=function(){function s(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];var r=Array.isArray(e[0])?e[0]:e;if(typeof r[0]!="number"){for(var n=[],a=0,o=r.length;a<o;a++)n.push(r[a].x,r[a].y);r=n}this.points=r,this.type=Le.POLY,this.closeStroke=!0}return s.prototype.clone=function(){var t=this.points.slice(),e=new s(t);return e.closeStroke=this.closeStroke,e},s.prototype.contains=function(t,e){for(var i=!1,r=this.points.length/2,n=0,a=r-1;n<r;a=n++){var o=this.points[n*2],h=this.points[n*2+1],u=this.points[a*2],c=this.points[a*2+1],l=h>e!=c>e&&t<(u-o)*((e-h)/(c-h))+o;l&&(i=!i)}return i},s.prototype.toString=function(){return"[@pixi/math:Polygon"+("closeStroke="+this.closeStroke)+("points="+this.points.reduce(function(t,e){return t+", "+e},"")+"]")},s}(),uC=function(){function s(t,e,i,r,n){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),r===void 0&&(r=0),n===void 0&&(n=20),this.x=t,this.y=e,this.width=i,this.height=r,this.radius=n,this.type=Le.RREC}return s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.radius)},s.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){var i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;var r=t-(this.x+i),n=e-(this.y+i),a=i*i;if(r*r+n*n<=a||(r=t-(this.x+this.width-i),r*r+n*n<=a)||(n=e-(this.y+this.height-i),r*r+n*n<=a)||(r=t-(this.x+i),r*r+n*n<=a))return!0}return!1},s.prototype.toString=function(){return"[@pixi/math:RoundedRectangle x="+this.x+" y="+this.y+("width="+this.width+" height="+this.height+" radius="+this.radius+"]")},s}(),aa=function(){function s(t,e,i,r){i===void 0&&(i=0),r===void 0&&(r=0),this._x=i,this._y=r,this.cb=t,this.scope=e}return s.prototype.clone=function(t,e){return t===void 0&&(t=this.cb),e===void 0&&(e=this.scope),new s(t,e,this._x,this._y)},s.prototype.set=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this},s.prototype.copyFrom=function(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},s.prototype.copyTo=function(t){return t.set(this._x,this._y),t},s.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},s.prototype.toString=function(){return"[@pixi/math:ObservablePoint x=0 y=0 scope="+this.scope+"]"},Object.defineProperty(s.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),s}(),wt=function(){function s(t,e,i,r,n,a){t===void 0&&(t=1),e===void 0&&(e=0),i===void 0&&(i=0),r===void 0&&(r=1),n===void 0&&(n=0),a===void 0&&(a=0),this.array=null,this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=a}return s.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},s.prototype.set=function(t,e,i,r,n,a){return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=a,this},s.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},s.prototype.apply=function(t,e){e=e||new H;var i=t.x,r=t.y;return e.x=this.a*i+this.c*r+this.tx,e.y=this.b*i+this.d*r+this.ty,e},s.prototype.applyInverse=function(t,e){e=e||new H;var i=1/(this.a*this.d+this.c*-this.b),r=t.x,n=t.y;return e.x=this.d*i*r+-this.c*i*n+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*n+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i,e},s.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},s.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},s.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=this.a,n=this.c,a=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=a*e-this.ty*i,this.ty=a*i+this.ty*e,this},s.prototype.append=function(t){var e=this.a,i=this.b,r=this.c,n=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*n,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*n,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*n+this.ty,this},s.prototype.setTransform=function(t,e,i,r,n,a,o,h,u){return this.a=Math.cos(o+u)*n,this.b=Math.sin(o+u)*n,this.c=-Math.sin(o-h)*a,this.d=Math.cos(o-h)*a,this.tx=t-(i*this.a+r*this.c),this.ty=e-(i*this.b+r*this.d),this},s.prototype.prepend=function(t){var e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){var i=this.a,r=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},s.prototype.decompose=function(t){var e=this.a,i=this.b,r=this.c,n=this.d,a=t.pivot,o=-Math.atan2(-r,n),h=Math.atan2(i,e),u=Math.abs(o+h);return u<1e-5||Math.abs(Bo-u)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=h),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(r*r+n*n),t.position.x=this.tx+(a.x*e+a.y*r),t.position.y=this.ty+(a.x*i+a.y*n),t},s.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,r=this.d,n=this.tx,a=t*r-e*i;return this.a=r/a,this.b=-e/a,this.c=-i/a,this.d=t/a,this.tx=(i*this.ty-r*n)/a,this.ty=-(t*this.ty-e*n)/a,this},s.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},s.prototype.clone=function(){var t=new s;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},s.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},s.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},s.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(s,"IDENTITY",{get:function(){return new s},enumerable:!1,configurable:!0}),Object.defineProperty(s,"TEMP_MATRIX",{get:function(){return new s},enumerable:!1,configurable:!0}),s}(),$r=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],tn=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],en=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],sn=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],hc=[],Up=[],Yh=Math.sign;function lC(){for(var s=0;s<16;s++){var t=[];hc.push(t);for(var e=0;e<16;e++)for(var i=Yh($r[s]*$r[e]+en[s]*tn[e]),r=Yh(tn[s]*$r[e]+sn[s]*tn[e]),n=Yh($r[s]*en[e]+en[s]*sn[e]),a=Yh(tn[s]*en[e]+sn[s]*sn[e]),o=0;o<16;o++)if($r[o]===i&&tn[o]===r&&en[o]===n&&sn[o]===a){t.push(o);break}}for(var s=0;s<16;s++){var h=new wt;h.set($r[s],tn[s],en[s],sn[s],0,0),Up.push(h)}}lC();var Nt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(s){return $r[s]},uY:function(s){return tn[s]},vX:function(s){return en[s]},vY:function(s){return sn[s]},inv:function(s){return s&8?s&15:-s&7},add:function(s,t){return hc[s][t]},sub:function(s,t){return hc[s][Nt.inv(t)]},rotate180:function(s){return s^4},isVertical:function(s){return(s&3)===2},byDirection:function(s,t){return Math.abs(s)*2<=Math.abs(t)?t>=0?Nt.S:Nt.N:Math.abs(t)*2<=Math.abs(s)?s>0?Nt.E:Nt.W:t>0?s>0?Nt.SE:Nt.SW:s>0?Nt.NE:Nt.NW},matrixAppendRotationInv:function(s,t,e,i){e===void 0&&(e=0),i===void 0&&(i=0);var r=Up[Nt.inv(t)];r.tx=e,r.ty=i,s.append(r)}},xp=function(){function s(){this.worldTransform=new wt,this.localTransform=new wt,this.position=new aa(this.onChange,this,0,0),this.scale=new aa(this.onChange,this,1,1),this.pivot=new aa(this.onChange,this,0,0),this.skew=new aa(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return s.prototype.onChange=function(){this._localID++},s.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},s.prototype.toString=function(){return"[@pixi/math:Transform "+("position=("+this.position.x+", "+this.position.y+") ")+("rotation="+this.rotation+" ")+("scale=("+this.scale.x+", "+this.scale.y+") ")+("skew=("+this.skew.x+", "+this.skew.y+") ")+"]"},s.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},s.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var i=t.worldTransform,r=this.worldTransform;r.a=e.a*i.a+e.b*i.c,r.b=e.a*i.b+e.b*i.d,r.c=e.c*i.a+e.d*i.c,r.d=e.c*i.b+e.d*i.d,r.tx=e.tx*i.a+e.ty*i.c+i.tx,r.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}},s.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(s.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!1,configurable:!0}),s.IDENTITY=new s,s}();/*!
 * @pixi/core - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/core is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */Z.PREFER_ENV=dn.any?Ji.WEBGL:Ji.WEBGL2;Z.STRICT_TEXTURE_CACHE=!1;var uc=[];function Fp(s,t){if(!s)return null;var e="";if(typeof s=="string"){var i=/\.(\w{3,4})(?:$|\?|#)/i.exec(s);i&&(e=i[1].toLowerCase())}for(var r=uc.length-1;r>=0;--r){var n=uc[r];if(n.test&&n.test(s,e))return new n(s,t)}throw new Error("Unrecognized source type to auto-detect Resource")}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var lc=function(s,t){return lc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])},lc(s,t)};function te(s,t){lc(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var _c=function(){return _c=Object.assign||function(t){for(var e=arguments,i,r=1,n=arguments.length;r<n;r++){i=e[r];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t},_c.apply(this,arguments)};function _C(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(s);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(s,i[r])&&(e[i[r]]=s[i[r]]);return e}var Ho=function(){function s(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new ke("setRealSize"),this.onUpdate=new ke("update"),this.onError=new ke("onError")}return s.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},s.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},s.prototype.resize=function(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))},Object.defineProperty(s.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),s.prototype.update=function(){this.destroyed||this.onUpdate.emit()},s.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(s.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),s.prototype.style=function(t,e,i){return!1},s.prototype.dispose=function(){},s.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},s.test=function(t,e){return!1},s}(),_f=function(s){te(t,s);function t(e,i){var r=this,n=i||{},a=n.width,o=n.height;if(!a||!o)throw new Error("BufferResource width or height invalid");return r=s.call(this,a,o)||this,r.data=e,r}return t.prototype.upload=function(e,i,r){var n=e.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===xr.UNPACK);var a=i.realWidth,o=i.realHeight;return r.width===a&&r.height===o?n.texSubImage2D(i.target,0,0,0,a,o,i.format,r.type,this.data):(r.width=a,r.height=o,n.texImage2D(i.target,0,r.internalFormat,a,o,0,i.format,r.type,this.data)),!0},t.prototype.dispose=function(){this.data=null},t.test=function(e){return e instanceof Float32Array||e instanceof Uint8Array||e instanceof Uint32Array},t}(Ho),cC={scaleMode:hs.NEAREST,format:W.RGBA,alphaMode:xr.NPM},Yt=function(s){te(t,s);function t(e,i){e===void 0&&(e=null),i===void 0&&(i=null);var r=s.call(this)||this;i=i||{};var n=i.alphaMode,a=i.mipmap,o=i.anisotropicLevel,h=i.scaleMode,u=i.width,c=i.height,l=i.wrapMode,_=i.format,d=i.type,g=i.target,m=i.resolution,p=i.resourceOptions;return e&&!(e instanceof Ho)&&(e=Fp(e,p),e.internal=!0),r.resolution=m||Z.RESOLUTION,r.width=Math.round((u||0)*r.resolution)/r.resolution,r.height=Math.round((c||0)*r.resolution)/r.resolution,r._mipmap=a!==void 0?a:Z.MIPMAP_TEXTURES,r.anisotropicLevel=o!==void 0?o:Z.ANISOTROPIC_LEVEL,r._wrapMode=l||Z.WRAP_MODE,r._scaleMode=h!==void 0?h:Z.SCALE_MODE,r.format=_||W.RGBA,r.type=d||Ut.UNSIGNED_BYTE,r.target=g||On.TEXTURE_2D,r.alphaMode=n!==void 0?n:xr.UNPACK,r.uid=Mn(),r.touched=0,r.isPowerOfTwo=!1,r._refreshPOT(),r._glTextures={},r.dirtyId=0,r.dirtyStyleId=0,r.cacheId=null,r.valid=u>0&&c>0,r.textureCacheIds=[],r.destroyed=!1,r.resource=null,r._batchEnabled=0,r._batchLocation=0,r.parentTextureArray=null,r.setResource(e),r}return Object.defineProperty(t.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mipmap",{get:function(){return this._mipmap},set:function(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),t.prototype.setStyle=function(e,i){var r;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,r=!0),i!==void 0&&i!==this.mipmap&&(this.mipmap=i,r=!0),r&&this.dirtyStyleId++,this},t.prototype.setSize=function(e,i,r){return r=r||this.resolution,this.setRealSize(e*r,i*r,r)},t.prototype.setRealSize=function(e,i,r){return this.resolution=r||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(i)/this.resolution,this._refreshPOT(),this.update(),this},t.prototype._refreshPOT=function(){this.isPowerOfTwo=Fg(this.realWidth)&&Fg(this.realHeight)},t.prototype.setResolution=function(e){var i=this.resolution;return i===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*i)/e,this.height=Math.round(this.height*i)/e,this.emit("update",this)),this._refreshPOT(),this)},t.prototype.setResource=function(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this},t.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},t.prototype.onError=function(e){this.emit("error",this,e)},t.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Kr[this.cacheId],delete Ai[this.cacheId],this.cacheId=null),this.dispose(),t.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},t.prototype.dispose=function(){this.emit("dispose",this)},t.prototype.castToBaseTexture=function(){return this},t.from=function(e,i,r){r===void 0&&(r=Z.STRICT_TEXTURE_CACHE);var n=typeof e=="string",a=null;if(n)a=e;else{if(!e._pixiId){var o=i&&i.pixiIdPrefix||"pixiid";e._pixiId=o+"_"+Mn()}a=e._pixiId}var h=Kr[a];if(n&&r&&!h)throw new Error('The cacheId "'+a+'" does not exist in BaseTextureCache.');return h||(h=new t(e,i),h.cacheId=a,t.addToCache(h,a)),h},t.fromBuffer=function(e,i,r,n){e=e||new Float32Array(i*r*4);var a=new _f(e,{width:i,height:r}),o=e instanceof Float32Array?Ut.FLOAT:Ut.UNSIGNED_BYTE;return new t(a,Object.assign({},cC,n||{width:i,height:r,type:o}))},t.addToCache=function(e,i){i&&(e.textureCacheIds.indexOf(i)===-1&&e.textureCacheIds.push(i),Kr[i]&&console.warn("BaseTexture added to the cache with an id ["+i+"] that already had an entry"),Kr[i]=e)},t.removeFromCache=function(e){if(typeof e=="string"){var i=Kr[e];if(i){var r=i.textureCacheIds.indexOf(e);return r>-1&&i.textureCacheIds.splice(r,1),delete Kr[e],i}}else if(e&&e.textureCacheIds){for(var n=0;n<e.textureCacheIds.length;++n)delete Kr[e.textureCacheIds[n]];return e.textureCacheIds.length=0,e}return null},t._globalBatch=0,t}(nh),wp=function(s){te(t,s);function t(e,i){var r=this,n=i||{},a=n.width,o=n.height;r=s.call(this,a,o)||this,r.items=[],r.itemDirtyIds=[];for(var h=0;h<e;h++){var u=new Yt;r.items.push(u),r.itemDirtyIds.push(-2)}return r.length=e,r._load=null,r.baseTexture=null,r}return t.prototype.initFromArray=function(e,i){for(var r=0;r<this.length;r++)e[r]&&(e[r].castToBaseTexture?this.addBaseTextureAt(e[r].castToBaseTexture(),r):e[r]instanceof Ho?this.addResourceAt(e[r],r):this.addResourceAt(Fp(e[r],i),r))},t.prototype.dispose=function(){for(var e=0,i=this.length;e<i;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},t.prototype.addResourceAt=function(e,i){if(!this.items[i])throw new Error("Index "+i+" is out of bounds");return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[i].setResource(e),this},t.prototype.bind=function(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");s.prototype.bind.call(this,e);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=e,this.items[i].on("update",e.update,e)},t.prototype.unbind=function(e){s.prototype.unbind.call(this,e);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",e.update,e)},t.prototype.load=function(){var e=this;if(this._load)return this._load;var i=this.items.map(function(n){return n.resource}).filter(function(n){return n}),r=i.map(function(n){return n.load()});return this._load=Promise.all(r).then(function(){var n=e.items[0],a=n.realWidth,o=n.realHeight;return e.resize(a,o),Promise.resolve(e)}),this._load},t}(Ho),dC=function(s){te(t,s);function t(e,i){var r=this,n=i||{},a=n.width,o=n.height,h,u;return Array.isArray(e)?(h=e,u=e.length):u=e,r=s.call(this,u,{width:a,height:o})||this,h&&r.initFromArray(h,i),r}return t.prototype.addBaseTextureAt=function(e,i){if(e.resource)this.addResourceAt(e.resource,i);else throw new Error("ArrayResource does not support RenderTexture");return this},t.prototype.bind=function(e){s.prototype.bind.call(this,e),e.target=On.TEXTURE_2D_ARRAY},t.prototype.upload=function(e,i,r){var n=this,a=n.length,o=n.itemDirtyIds,h=n.items,u=e.gl;r.dirtyId<0&&u.texImage3D(u.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,a,0,i.format,r.type,null);for(var c=0;c<a;c++){var l=h[c];o[c]<l.dirtyId&&(o[c]=l.dirtyId,l.valid&&u.texSubImage3D(u.TEXTURE_2D_ARRAY,0,0,0,c,l.resource.width,l.resource.height,1,i.format,r.type,l.resource.source))}return!0},t}(wp),Fr=function(s){te(t,s);function t(e){var i=this,r=e,n=r.naturalWidth||r.videoWidth||r.width,a=r.naturalHeight||r.videoHeight||r.height;return i=s.call(this,n,a)||this,i.source=e,i.noSubImage=!1,i}return t.crossOrigin=function(e,i,r){r===void 0&&i.indexOf("data:")!==0?e.crossOrigin=iC(i):r!==!1&&(e.crossOrigin=typeof r=="string"?r:"anonymous")},t.prototype.upload=function(e,i,r,n){var a=e.gl,o=i.realWidth,h=i.realHeight;if(n=n||this.source,n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(n instanceof HTMLVideoElement&&n.readyState<=1)return!1;return a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===xr.UNPACK),!this.noSubImage&&i.target===a.TEXTURE_2D&&r.width===o&&r.height===h?a.texSubImage2D(a.TEXTURE_2D,0,0,0,i.format,r.type,n):(r.width=o,r.height=h,a.texImage2D(i.target,0,r.internalFormat,i.format,r.type,n)),!0},t.prototype.update=function(){if(!this.destroyed){var e=this.source,i=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;this.resize(i,r),s.prototype.update.call(this)}},t.prototype.dispose=function(){this.source=null},t}(Ho),fC=function(s){te(t,s);function t(e){return s.call(this,e)||this}return t.test=function(e){var i=globalThis.OffscreenCanvas;return i&&e instanceof i?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement},t}(Fr),gC=function(s){te(t,s);function t(e,i){var r=this,n=i||{},a=n.width,o=n.height,h=n.autoLoad,u=n.linkBaseTexture;if(e&&e.length!==t.SIDES)throw new Error("Invalid length. Got "+e.length+", expected 6");r=s.call(this,6,{width:a,height:o})||this;for(var c=0;c<t.SIDES;c++)r.items[c].target=On.TEXTURE_CUBE_MAP_POSITIVE_X+c;return r.linkBaseTexture=u!==!1,e&&r.initFromArray(e,i),h!==!1&&r.load(),r}return t.prototype.bind=function(e){s.prototype.bind.call(this,e),e.target=On.TEXTURE_CUBE_MAP},t.prototype.addBaseTextureAt=function(e,i,r){if(!this.items[i])throw new Error("Index "+i+" is out of bounds");if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,i);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=On.TEXTURE_CUBE_MAP_POSITIVE_X+i,e.parentTextureArray=this.baseTexture,this.items[i]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[i]=e,this},t.prototype.upload=function(e,i,r){for(var n=this.itemDirtyIds,a=0;a<t.SIDES;a++){var o=this.items[a];(n[a]<o.dirtyId||r.dirtyId<i.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(e,o,r),n[a]=o.dirtyId):n[a]<-1&&(e.gl.texImage2D(o.target,0,r.internalFormat,i.realWidth,i.realHeight,0,i.format,r.type,null),n[a]=-1))}return!0},t.test=function(e){return Array.isArray(e)&&e.length===t.SIDES},t.SIDES=6,t}(wp),Gp=function(s){te(t,s);function t(e,i){var r=this;if(i=i||{},!(e instanceof HTMLImageElement)){var n=new Image;Fr.crossOrigin(n,e,i.crossorigin),n.src=e,e=n}return r=s.call(this,e)||this,!e.complete&&r._width&&r._height&&(r._width=0,r._height=0),r.url=e.src,r._process=null,r.preserveBitmap=!1,r.createBitmap=(i.createBitmap!==void 0?i.createBitmap:Z.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,r.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,r.bitmap=null,r._load=null,i.autoLoad!==!1&&r.load(),r}return t.prototype.load=function(e){var i=this;return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise(function(r,n){var a=i.source;i.url=a.src;var o=function(){i.destroyed||(a.onload=null,a.onerror=null,i.resize(a.width,a.height),i._load=null,i.createBitmap?r(i.process()):r(i))};a.complete&&a.src?o():(a.onload=o,a.onerror=function(h){n(h),i.onError.emit(h)})}),this._load)},t.prototype.process=function(){var e=this,i=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);var r=globalThis.createImageBitmap,n=!i.crossOrigin||i.crossOrigin==="anonymous";return this._process=fetch(i.src,{mode:n?"cors":"no-cors"}).then(function(a){return a.blob()}).then(function(a){return r(a,0,0,i.width,i.height,{premultiplyAlpha:e.alphaMode===null||e.alphaMode===xr.UNPACK?"premultiply":"none"})}).then(function(a){return e.destroyed?Promise.reject():(e.bitmap=a,e.update(),e._process=null,Promise.resolve(e))}),this._process},t.prototype.upload=function(e,i,r){if(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),!this.createBitmap)return s.prototype.upload.call(this,e,i,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(s.prototype.upload.call(this,e,i,r,this.bitmap),!this.preserveBitmap){var n=!0,a=i._glTextures;for(var o in a){var h=a[o];if(h!==r&&h.dirtyId!==i.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},t.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,s.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},t.test=function(e){return typeof e=="string"||e instanceof HTMLImageElement},t}(Fr),EC=function(s){te(t,s);function t(e,i){var r=this;return i=i||{},r=s.call(this,Z.ADAPTER.createCanvas())||this,r._width=0,r._height=0,r.svg=e,r.scale=i.scale||1,r._overrideWidth=i.width,r._overrideHeight=i.height,r._resolve=null,r._crossorigin=i.crossorigin,r._load=null,i.autoLoad!==!1&&r.load(),r}return t.prototype.load=function(){var e=this;return this._load?this._load:(this._load=new Promise(function(i){if(e._resolve=function(){e.resize(e.source.width,e.source.height),i(e)},t.SVG_XML.test(e.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");e.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e.svg)))}e._loadSvg()}),this._load)},t.prototype._loadSvg=function(){var e=this,i=new Image;Fr.crossOrigin(i,this.svg,this._crossorigin),i.src=this.svg,i.onerror=function(r){e._resolve&&(i.onerror=null,e.onError.emit(r))},i.onload=function(){if(e._resolve){var r=i.width,n=i.height;if(!r||!n)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var a=r*e.scale,o=n*e.scale;(e._overrideWidth||e._overrideHeight)&&(a=e._overrideWidth||e._overrideHeight/n*r,o=e._overrideHeight||e._overrideWidth/r*n),a=Math.round(a),o=Math.round(o);var h=e.source;h.width=a,h.height=o,h._pixiId="canvas_"+Mn(),h.getContext("2d").drawImage(i,0,0,r,n,0,0,a,o),e._resolve(),e._resolve=null}}},t.getSize=function(e){var i=t.SVG_SIZE.exec(e),r={};return i&&(r[i[1]]=Math.round(parseFloat(i[3])),r[i[5]]=Math.round(parseFloat(i[7]))),r},t.prototype.dispose=function(){s.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},t.test=function(e,i){return i==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&t.SVG_XML.test(e)},t.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,t.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,t}(Fr),pC=function(s){te(t,s);function t(e,i){var r=this;if(i=i||{},!(e instanceof HTMLVideoElement)){var n=document.createElement("video");n.setAttribute("preload","auto"),n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline",""),typeof e=="string"&&(e=[e]);var a=e[0].src||e[0];Fr.crossOrigin(n,a,i.crossorigin);for(var o=0;o<e.length;++o){var h=document.createElement("source"),u=e[o],c=u.src,l=u.mime;c=c||e[o];var _=c.split("?").shift().toLowerCase(),d=_.slice(_.lastIndexOf(".")+1);l=l||t.MIME_TYPES[d]||"video/"+d,h.src=c,h.type=l,n.appendChild(h)}e=n}return r=s.call(this,e)||this,r.noSubImage=!0,r._autoUpdate=!0,r._isConnectedToTicker=!1,r._updateFPS=i.updateFPS||0,r._msToNextUpdate=0,r.autoPlay=i.autoPlay!==!1,r._load=null,r._resolve=null,r._onCanPlay=r._onCanPlay.bind(r),r._onError=r._onError.bind(r),i.autoLoad!==!1&&r.load(),r}return t.prototype.update=function(e){if(!this.destroyed){var i=ni.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-i),(!this._updateFPS||this._msToNextUpdate<=0)&&(s.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},t.prototype.load=function(){var e=this;if(this._load)return this._load;var i=this.source;return(i.readyState===i.HAVE_ENOUGH_DATA||i.readyState===i.HAVE_FUTURE_DATA)&&i.width&&i.height&&(i.complete=!0),i.addEventListener("play",this._onPlayStart.bind(this)),i.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(i.addEventListener("canplay",this._onCanPlay),i.addEventListener("canplaythrough",this._onCanPlay),i.addEventListener("error",this._onError,!0)),this._load=new Promise(function(r){e.valid?r(e):(e._resolve=r,i.load())}),this._load},t.prototype._onError=function(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e)},t.prototype._isSourcePlaying=function(){var e=this.source;return!e.paused&&!e.ended&&this._isSourceReady()},t.prototype._isSourceReady=function(){var e=this.source;return e.readyState>2},t.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(ni.shared.add(this.update,this),this._isConnectedToTicker=!0)},t.prototype._onPlayStop=function(){this._isConnectedToTicker&&(ni.shared.remove(this.update,this),this._isConnectedToTicker=!1)},t.prototype._onCanPlay=function(){var e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);var i=this.valid;this.resize(e.videoWidth,e.videoHeight),!i&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()},t.prototype.dispose=function(){this._isConnectedToTicker&&(ni.shared.remove(this.update,this),this._isConnectedToTicker=!1);var e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),s.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(ni.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(ni.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(e){e!==this._updateFPS&&(this._updateFPS=e)},enumerable:!1,configurable:!0}),t.test=function(e,i){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||t.TYPES.indexOf(i)>-1},t.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],t.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},t}(Fr),mC=function(s){te(t,s);function t(e){return s.call(this,e)||this}return t.test=function(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&e instanceof ImageBitmap},t}(Fr);uc.push(Gp,mC,fC,pC,EC,_f,gC,dC);var IC=function(s){te(t,s);function t(){return s!==null&&s.apply(this,arguments)||this}return t.prototype.upload=function(e,i,r){var n=e.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===xr.UNPACK);var a=i.realWidth,o=i.realHeight;return r.width===a&&r.height===o?n.texSubImage2D(i.target,0,0,0,a,o,i.format,r.type,this.data):(r.width=a,r.height=o,n.texImage2D(i.target,0,r.internalFormat,a,o,0,i.format,r.type,this.data)),!0},t}(_f),cc=function(){function s(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new ke("disposeFramebuffer"),this.multisample=oe.NONE}return Object.defineProperty(s.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),s.prototype.addColorTexture=function(t,e){return t===void 0&&(t=0),this.colorTextures[t]=e||new Yt(null,{scaleMode:hs.NEAREST,resolution:1,mipmap:Ur.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},s.prototype.addDepthTexture=function(t){return this.depthTexture=t||new Yt(new IC(null,{width:this.width,height:this.height}),{scaleMode:hs.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Ur.OFF,format:W.DEPTH_COMPONENT,type:Ut.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},s.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},s.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},s.prototype.resize=function(t,e){if(t=Math.round(t),e=Math.round(e),!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var r=this.colorTextures[i],n=r.resolution;r.setSize(t/n,e/n)}if(this.depthTexture){var n=this.depthTexture.resolution;this.depthTexture.setSize(t/n,e/n)}}},s.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},s.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},s}(),Bp=function(s){te(t,s);function t(e){e===void 0&&(e={});var i=this;if(typeof e=="number"){var r=arguments[0],n=arguments[1],a=arguments[2],o=arguments[3];e={width:r,height:n,scaleMode:a,resolution:o}}return e.width=e.width||100,e.height=e.height||100,e.multisample=e.multisample!==void 0?e.multisample:oe.NONE,i=s.call(this,null,e)||this,i.mipmap=Ur.OFF,i.valid=!0,i.clearColor=[0,0,0,0],i.framebuffer=new cc(i.realWidth,i.realHeight).addColorTexture(0,i),i.framebuffer.multisample=e.multisample,i.maskStack=[],i.filterStack=[{}],i}return t.prototype.resize=function(e,i){this.framebuffer.resize(e*this.resolution,i*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},t.prototype.dispose=function(){this.framebuffer.dispose(),s.prototype.dispose.call(this)},t.prototype.destroy=function(){s.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},t}(Yt),Hp=function(){function s(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return s.prototype.set=function(t,e,i){var r=e.width,n=e.height;if(i){var a=t.width/2/r,o=t.height/2/n,h=t.x/r+a,u=t.y/n+o;i=Nt.add(i,Nt.NW),this.x0=h+a*Nt.uX(i),this.y0=u+o*Nt.uY(i),i=Nt.add(i,2),this.x1=h+a*Nt.uX(i),this.y1=u+o*Nt.uY(i),i=Nt.add(i,2),this.x2=h+a*Nt.uX(i),this.y2=u+o*Nt.uY(i),i=Nt.add(i,2),this.x3=h+a*Nt.uX(i),this.y3=u+o*Nt.uY(i)}else this.x0=t.x/r,this.y0=t.y/n,this.x1=(t.x+t.width)/r,this.y1=t.y/n,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/n,this.x3=t.x/r,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},s.prototype.toString=function(){return"[@pixi/core:TextureUvs "+("x0="+this.x0+" y0="+this.y0+" ")+("x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" ")+("y2="+this.y2+" x3="+this.x3+" y3="+this.y3)+"]"},s}(),kg=new Hp;function Wh(s){s.destroy=function(){},s.on=function(){},s.once=function(){},s.emit=function(){}}var ut=function(s){te(t,s);function t(e,i,r,n,a,o){var h=s.call(this)||this;if(h.noFrame=!1,i||(h.noFrame=!0,i=new et(0,0,1,1)),e instanceof t&&(e=e.baseTexture),h.baseTexture=e,h._frame=i,h.trim=n,h.valid=!1,h._uvs=kg,h.uvMatrix=null,h.orig=r||i,h._rotate=Number(a||0),a===!0)h._rotate=2;else if(h._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return h.defaultAnchor=o?new H(o.x,o.y):new H(0,0),h._updateID=0,h.textureCacheIds=[],e.valid?h.noFrame?e.valid&&h.onBaseTextureUpdated(e):h.frame=i:e.once("loaded",h.onBaseTextureUpdated,h),h.noFrame&&e.on("update",h.onBaseTextureUpdated,h),h}return t.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},t.prototype.onBaseTextureUpdated=function(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},t.prototype.destroy=function(e){if(this.baseTexture){if(e){var i=this.baseTexture.resource;i&&i.url&&Ai[i.url]&&t.removeFromCache(i.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,t.removeFromCache(this),this.textureCacheIds=null},t.prototype.clone=function(){var e=this._frame.clone(),i=this._frame===this.orig?e:this.orig.clone(),r=new t(this.baseTexture,!this.noFrame&&e,i,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(r._frame=e),r},t.prototype.updateUvs=function(){this._uvs===kg&&(this._uvs=new Hp),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},t.from=function(e,i,r){i===void 0&&(i={}),r===void 0&&(r=Z.STRICT_TEXTURE_CACHE);var n=typeof e=="string",a=null;if(n)a=e;else if(e instanceof Yt){if(!e.cacheId){var o=i&&i.pixiIdPrefix||"pixiid";e.cacheId=o+"-"+Mn(),Yt.addToCache(e,e.cacheId)}a=e.cacheId}else{if(!e._pixiId){var o=i&&i.pixiIdPrefix||"pixiid";e._pixiId=o+"_"+Mn()}a=e._pixiId}var h=Ai[a];if(n&&r&&!h)throw new Error('The cacheId "'+a+'" does not exist in TextureCache.');return!h&&!(e instanceof Yt)?(i.resolution||(i.resolution=oc(e)),h=new t(new Yt(e,i)),h.baseTexture.cacheId=a,Yt.addToCache(h.baseTexture,a),t.addToCache(h,a)):!h&&e instanceof Yt&&(h=new t(e),t.addToCache(h,a)),h},t.fromURL=function(e,i){var r=Object.assign({autoLoad:!1},i==null?void 0:i.resourceOptions),n=t.from(e,Object.assign({resourceOptions:r},i),!1),a=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):a.load().then(function(){return Promise.resolve(n)})},t.fromBuffer=function(e,i,r,n){return new t(Yt.fromBuffer(e,i,r,n))},t.fromLoader=function(e,i,r,n){var a=new Yt(e,Object.assign({scaleMode:Z.SCALE_MODE,resolution:oc(i)},n)),o=a.resource;o instanceof Gp&&(o.url=i);var h=new t(a);return r||(r=i),Yt.addToCache(h.baseTexture,r),t.addToCache(h,r),r!==i&&(Yt.addToCache(h.baseTexture,i),t.addToCache(h,i)),h.baseTexture.valid?Promise.resolve(h):new Promise(function(u){h.baseTexture.once("loaded",function(){return u(h)})})},t.addToCache=function(e,i){i&&(e.textureCacheIds.indexOf(i)===-1&&e.textureCacheIds.push(i),Ai[i]&&console.warn("Texture added to the cache with an id ["+i+"] that already had an entry"),Ai[i]=e)},t.removeFromCache=function(e){if(typeof e=="string"){var i=Ai[e];if(i){var r=i.textureCacheIds.indexOf(e);return r>-1&&i.textureCacheIds.splice(r,1),delete Ai[e],i}}else if(e&&e.textureCacheIds){for(var n=0;n<e.textureCacheIds.length;++n)Ai[e.textureCacheIds[n]]===e&&delete Ai[e.textureCacheIds[n]];return e.textureCacheIds.length=0,e}return null},Object.defineProperty(t.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frame",{get:function(){return this._frame},set:function(e){this._frame=e,this.noFrame=!1;var i=e.x,r=e.y,n=e.width,a=e.height,o=i+n>this.baseTexture.width,h=r+a>this.baseTexture.height;if(o||h){var u=o&&h?"and":"or",c="X: "+i+" + "+n+" = "+(i+n)+" > "+this.baseTexture.width,l="Y: "+r+" + "+a+" = "+(r+a)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+(c+" "+u+" "+l))}this.valid=n&&a&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),t.prototype.castToBaseTexture=function(){return this.baseTexture},Object.defineProperty(t,"EMPTY",{get:function(){return t._EMPTY||(t._EMPTY=new t(new Yt),Wh(t._EMPTY),Wh(t._EMPTY.baseTexture)),t._EMPTY},enumerable:!1,configurable:!0}),Object.defineProperty(t,"WHITE",{get:function(){if(!t._WHITE){var e=Z.ADAPTER.createCanvas(16,16),i=e.getContext("2d");e.width=16,e.height=16,i.fillStyle="white",i.fillRect(0,0,16,16),t._WHITE=new t(Yt.from(e)),Wh(t._WHITE),Wh(t._WHITE.baseTexture)}return t._WHITE},enumerable:!1,configurable:!0}),t}(nh),xe=function(s){te(t,s);function t(e,i){var r=s.call(this,e,i)||this;return r.valid=!0,r.filterFrame=null,r.filterPoolKey=null,r.updateUvs(),r}return Object.defineProperty(t.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(e){this.framebuffer.multisample=e},enumerable:!1,configurable:!0}),t.prototype.resize=function(e,i,r){r===void 0&&(r=!0);var n=this.baseTexture.resolution,a=Math.round(e*n)/n,o=Math.round(i*n)/n;this.valid=a>0&&o>0,this._frame.width=this.orig.width=a,this._frame.height=this.orig.height=o,r&&this.baseTexture.resize(a,o),this.updateUvs()},t.prototype.setResolution=function(e){var i=this.baseTexture;i.resolution!==e&&(i.setResolution(e),this.resize(i.width,i.height,!1))},t.create=function(e){for(var i=arguments,r=[],n=1;n<arguments.length;n++)r[n-1]=i[n];return typeof e=="number"&&(ci("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),e={width:e,height:r[0],scaleMode:r[1],resolution:r[2]}),new t(new Bp(e))},t}(ut),TC=function(){function s(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return s.prototype.createTexture=function(t,e,i){i===void 0&&(i=oe.NONE);var r=new Bp(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new xe(r)},s.prototype.getOptimalTexture=function(t,e,i,r){i===void 0&&(i=1),r===void 0&&(r=oe.NONE);var n;t=Math.ceil(t*i-1e-6),e=Math.ceil(e*i-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=Bu(t),e=Bu(e),n=((t&65535)<<16|e&65535)>>>0,r>1&&(n+=r*4294967296)):n=r>1?-r:-1,this.texturePool[n]||(this.texturePool[n]=[]);var a=this.texturePool[n].pop();return a||(a=this.createTexture(t,e,r)),a.filterPoolKey=n,a.setResolution(i),a},s.prototype.getFilterTexture=function(t,e,i){var r=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||oe.NONE);return r.filterFrame=t.filterFrame,r},s.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},s.prototype.returnFilterTexture=function(t){this.returnTexture(t)},s.prototype.clear=function(t){if(t=t!==!1,t)for(var e in this.texturePool){var i=this.texturePool[e];if(i)for(var r=0;r<i.length;r++)i[r].destroy(!0)}this.texturePool={}},s.prototype.setScreenSize=function(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(var e in this.texturePool)if(Number(e)<0){var i=this.texturePool[e];if(i)for(var r=0;r<i.length;r++)i[r].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}},s.SCREEN_KEY=-1,s}(),jg=function(){function s(t,e,i,r,n,a,o){e===void 0&&(e=0),i===void 0&&(i=!1),r===void 0&&(r=Ut.FLOAT),this.buffer=t,this.size=e,this.normalized=i,this.type=r,this.stride=n,this.start=a,this.instance=o}return s.prototype.destroy=function(){this.buffer=null},s.from=function(t,e,i,r,n){return new s(t,e,i,r,n)},s}(),RC=0,ts=function(){function s(t,e,i){e===void 0&&(e=!0),i===void 0&&(i=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=RC++,this.disposeRunner=new ke("disposeBuffer")}return s.prototype.update=function(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++},s.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},s.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(s.prototype,"index",{get:function(){return this.type===_i.ELEMENT_ARRAY_BUFFER},set:function(t){this.type=t?_i.ELEMENT_ARRAY_BUFFER:_i.ARRAY_BUFFER},enumerable:!1,configurable:!0}),s.from=function(t){return t instanceof Array&&(t=new Float32Array(t)),new s(t)},s}(),OC={Float32Array,Uint32Array,Int32Array,Uint8Array};function AC(s,t){for(var e=0,i=0,r={},n=0;n<s.length;n++)i+=t[n],e+=s[n].length;for(var a=new ArrayBuffer(e*4),o=null,h=0,n=0;n<s.length;n++){var u=t[n],c=s[n],l=Lp(c);r[l]||(r[l]=new OC[l](a)),o=r[l];for(var _=0;_<c.length;_++){var d=(_/u|0)*i+h,g=_%u;o[d+g]=c[_]}h+=u}return new Float32Array(a)}var zg={5126:4,5123:2,5121:1},vC=0,SC={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},Il=function(){function s(t,e){t===void 0&&(t=[]),e===void 0&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=vC++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new ke("disposeGeometry"),this.refCount=0}return s.prototype.addAttribute=function(t,e,i,r,n,a,o,h){if(i===void 0&&(i=0),r===void 0&&(r=!1),h===void 0&&(h=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof ts||(e instanceof Array&&(e=new Float32Array(e)),e=new ts(e));var u=t.split("|");if(u.length>1){for(var c=0;c<u.length;c++)this.addAttribute(u[c],e,i,r,n);return this}var l=this.buffers.indexOf(e);return l===-1&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new jg(l,i,r,n,a,o,h),this.instanced=this.instanced||h,this},s.prototype.getAttribute=function(t){return this.attributes[t]},s.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},s.prototype.addIndex=function(t){return t instanceof ts||(t instanceof Array&&(t=new Uint16Array(t)),t=new ts(t)),t.type=_i.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.indexOf(t)===-1&&this.buffers.push(t),this},s.prototype.getIndex=function(){return this.indexBuffer},s.prototype.interleave=function(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;var t=[],e=[],i=new ts,r;for(r in this.attributes){var n=this.attributes[r],a=this.buffers[n.buffer];t.push(a.data),e.push(n.size*zg[n.type]/4),n.buffer=0}for(i.data=AC(t,e),r=0;r<this.buffers.length;r++)this.buffers[r]!==this.indexBuffer&&this.buffers[r].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},s.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t],i=this.buffers[e.buffer];return i.data.length/(e.stride/4||e.size)}return 0},s.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},s.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},s.prototype.clone=function(){for(var t=new s,e=0;e<this.buffers.length;e++)t.buffers[e]=new ts(this.buffers[e].data.slice(0));for(var e in this.attributes){var i=this.attributes[e];t.attributes[e]=new jg(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=_i.ELEMENT_ARRAY_BUFFER),t},s.merge=function(t){for(var e=new s,i=[],r=[],n=[],a,o=0;o<t.length;o++){a=t[o];for(var h=0;h<a.buffers.length;h++)r[h]=r[h]||0,r[h]+=a.buffers[h].data.length,n[h]=0}for(var o=0;o<a.buffers.length;o++)i[o]=new SC[Lp(a.buffers[o].data)](r[o]),e.buffers[o]=new ts(i[o]);for(var o=0;o<t.length;o++){a=t[o];for(var h=0;h<a.buffers.length;h++)i[h].set(a.buffers[h].data,n[h]),n[h]+=a.buffers[h].data.length}if(e.attributes=a.attributes,a.indexBuffer){e.indexBuffer=e.buffers[a.buffers.indexOf(a.indexBuffer)],e.indexBuffer.type=_i.ELEMENT_ARRAY_BUFFER;for(var u=0,c=0,l=0,_=0,o=0;o<a.buffers.length;o++)if(a.buffers[o]!==a.indexBuffer){_=o;break}for(var o in a.attributes){var d=a.attributes[o];(d.buffer|0)===_&&(c+=d.size*zg[d.type]/4)}for(var o=0;o<t.length;o++){for(var g=t[o].indexBuffer.data,h=0;h<g.length;h++)e.indexBuffer.data[h+l]+=u;u+=t[o].buffers[_].data.length/c,l+=g.length}}return e},s}(),yC=function(s){te(t,s);function t(){var e=s.call(this)||this;return e.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),e}return t}(Il),Vp=function(s){te(t,s);function t(){var e=s.call(this)||this;return e.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.vertexBuffer=new ts(e.vertices),e.uvBuffer=new ts(e.uvs),e.addAttribute("aVertexPosition",e.vertexBuffer).addAttribute("aTextureCoord",e.uvBuffer).addIndex([0,1,2,0,2,3]),e}return t.prototype.map=function(e,i){var r=0,n=0;return this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=r+i.width/e.width,this.uvs[3]=n,this.uvs[4]=r+i.width/e.width,this.uvs[5]=n+i.height/e.height,this.uvs[6]=r,this.uvs[7]=n+i.height/e.height,r=i.x,n=i.y,this.vertices[0]=r,this.vertices[1]=n,this.vertices[2]=r+i.width,this.vertices[3]=n,this.vertices[4]=r+i.width,this.vertices[5]=n+i.height,this.vertices[6]=r,this.vertices[7]=n+i.height,this.invalidate(),this},t.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},t}(Il),CC=0,An=function(){function s(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=CC++,this.static=!!e,this.ubo=!!i,t instanceof ts?(this.buffer=t,this.buffer.type=_i.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new ts(new Float32Array(1)),this.buffer.type=_i.UNIFORM_BUFFER,this.autoManage=!0))}return s.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},s.prototype.add=function(t,e,i){if(!this.ubo)this.uniforms[t]=new s(e,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")},s.from=function(t,e,i){return new s(t,e,i)},s.uboFrom=function(t,e){return new s(t,e??!0,!0)},s}(),MC=function(){function s(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=oe.NONE,this.sourceFrame=new et,this.destinationFrame=new et,this.bindingSourceFrame=new et,this.bindingDestinationFrame=new et,this.filters=[],this.transform=null}return s.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},s}(),Xh=[new H,new H,new H,new H],l_=new wt,NC=function(){function s(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new TC,this.texturePool.setScreenSize(t.view),this.statePool=[],this.quad=new yC,this.quadUv=new Vp,this.tempRect=new et,this.activeState={},this.globalUniforms=new An({outputFrame:new et,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}return s.prototype.push=function(t,e){for(var i,r,n=this.renderer,a=this.defaultFilterStack,o=this.statePool.pop()||new MC,h=this.renderer.renderTexture,u=e[0].resolution,c=e[0].multisample,l=e[0].padding,_=e[0].autoFit,d=(i=e[0].legacy)!==null&&i!==void 0?i:!0,g=1;g<e.length;g++){var m=e[g];u=Math.min(u,m.resolution),c=Math.min(c,m.multisample),l=this.useMaxPadding?Math.max(l,m.padding):l+m.padding,_=_&&m.autoFit,d=d||((r=m.legacy)!==null&&r!==void 0?r:!0)}a.length===1&&(this.defaultFilterStack[0].renderTexture=h.current),a.push(o),o.resolution=u,o.multisample=c,o.legacy=d,o.target=t,o.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),o.sourceFrame.pad(l);var p=this.tempRect.copyFrom(h.sourceFrame);n.projection.transform&&this.transformAABB(l_.copyFrom(n.projection.transform).invert(),p),_?(o.sourceFrame.fit(p),(o.sourceFrame.width<=0||o.sourceFrame.height<=0)&&(o.sourceFrame.width=0,o.sourceFrame.height=0)):o.sourceFrame.intersects(p)||(o.sourceFrame.width=0,o.sourceFrame.height=0),this.roundFrame(o.sourceFrame,h.current?h.current.resolution:n.resolution,h.sourceFrame,h.destinationFrame,n.projection.transform),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,u,c),o.filters=e,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;var T=this.tempRect;T.x=0,T.y=0,T.width=o.sourceFrame.width,T.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,o.bindingSourceFrame.copyFrom(h.sourceFrame),o.bindingDestinationFrame.copyFrom(h.destinationFrame),o.transform=n.projection.transform,n.projection.transform=null,h.bind(o.renderTexture,o.sourceFrame,T),n.framebuffer.clear(0,0,0,0)},s.prototype.pop=function(){var t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;var r=this.globalUniforms.uniforms;r.outputFrame=e.sourceFrame,r.resolution=e.resolution;var n=r.inputSize,a=r.inputPixel,o=r.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],a[0]=Math.round(n[0]*e.resolution),a[1]=Math.round(n[1]*e.resolution),a[2]=1/a[0],a[3]=1/a[1],o[0]=.5*a[2],o[1]=.5*a[3],o[2]=e.sourceFrame.width*n[2]-.5*a[2],o[3]=e.sourceFrame.height*n[3]-.5*a[3],e.legacy){var h=r.filterArea;h[0]=e.destinationFrame.width,h[1]=e.destinationFrame.height,h[2]=e.sourceFrame.x,h[3]=e.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();var u=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,e.renderTexture,u.renderTexture,fr.BLEND,e),this.returnFilterTexture(e.renderTexture);else{var c=e.renderTexture,l=this.getOptimalFilterTexture(c.width,c.height,e.resolution);l.filterFrame=c.filterFrame;var _=0;for(_=0;_<i.length-1;++_){_===1&&e.multisample>1&&(l=this.getOptimalFilterTexture(c.width,c.height,e.resolution),l.filterFrame=c.filterFrame),i[_].apply(this,c,l,fr.CLEAR,e);var d=c;c=l,l=d}i[_].apply(this,c,u.renderTexture,fr.BLEND,e),_>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(c),this.returnFilterTexture(l)}e.clear(),this.statePool.push(e)},s.prototype.bindAndClear=function(t,e){e===void 0&&(e=fr.CLEAR);var i=this.renderer,r=i.renderTexture,n=i.state;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t&&t.filterFrame){var a=this.tempRect;a.x=0,a.y=0,a.width=t.filterFrame.width,a.height=t.filterFrame.height,r.bind(t,t.filterFrame,a)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var o=n.stateId&1||this.forceClear;(e===fr.CLEAR||e===fr.BLIT&&o)&&this.renderer.framebuffer.clear(0,0,0,0)},s.prototype.applyFilter=function(t,e,i,r){var n=this.renderer;n.state.set(t.state),this.bindAndClear(i,r),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(oi.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(oi.TRIANGLE_STRIP))},s.prototype.calculateSpriteMatrix=function(t,e){var i=this.activeState,r=i.sourceFrame,n=i.destinationFrame,a=e._texture.orig,o=t.set(n.width,0,0,n.height,r.x,r.y),h=e.worldTransform.copyTo(wt.TEMP_MATRIX);return h.invert(),o.prepend(h),o.scale(1/a.width,1/a.height),o.translate(e.anchor.x,e.anchor.y),o},s.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},s.prototype.getOptimalFilterTexture=function(t,e,i,r){return i===void 0&&(i=1),r===void 0&&(r=oe.NONE),this.texturePool.getOptimalTexture(t,e,i,r)},s.prototype.getFilterTexture=function(t,e,i){if(typeof t=="number"){var r=t;t=e,e=r}t=t||this.activeState.renderTexture;var n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||oe.NONE);return n.filterFrame=t.filterFrame,n},s.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},s.prototype.emptyPool=function(){this.texturePool.clear(!0)},s.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},s.prototype.transformAABB=function(t,e){var i=Xh[0],r=Xh[1],n=Xh[2],a=Xh[3];i.set(e.left,e.top),r.set(e.left,e.bottom),n.set(e.right,e.top),a.set(e.right,e.bottom),t.apply(i,i),t.apply(r,r),t.apply(n,n),t.apply(a,a);var o=Math.min(i.x,r.x,n.x,a.x),h=Math.min(i.y,r.y,n.y,a.y),u=Math.max(i.x,r.x,n.x,a.x),c=Math.max(i.y,r.y,n.y,a.y);e.x=o,e.y=h,e.width=u-o,e.height=c-h},s.prototype.roundFrame=function(t,e,i,r,n){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(n){var a=n.a,o=n.b,h=n.c,u=n.d;if((Math.abs(o)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(u)>1e-4))return}n=n?l_.copyFrom(n):l_.identity(),n.translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)}},s}(),Tl=function(){function s(t){this.renderer=t}return s.prototype.flush=function(){},s.prototype.destroy=function(){this.renderer=null},s.prototype.start=function(){},s.prototype.stop=function(){this.flush()},s.prototype.render=function(t){},s}(),PC=function(){function s(t){this.renderer=t,this.emptyRenderer=new Tl(t),this.currentRenderer=this.emptyRenderer}return s.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},s.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},s.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},s.prototype.copyBoundTextures=function(t,e){for(var i=this.renderer.texture.boundTextures,r=e-1;r>=0;--r)t[r]=i[r]||null,t[r]&&(t[r]._batchLocation=r)},s.prototype.boundArray=function(t,e,i,r){for(var n=t.elements,a=t.ids,o=t.count,h=0,u=0;u<o;u++){var c=n[u],l=c._batchLocation;if(l>=0&&l<r&&e[l]===c){a[u]=l;continue}for(;h<r;){var _=e[h];if(_&&_._batchEnabled===i&&_._batchLocation===h){h++;continue}a[u]=h,c._batchLocation=h,e[h]=c;break}}},s.prototype.destroy=function(){this.renderer=null},s}(),Yg=0,bC=function(){function s(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),t.view.addEventListener("webglcontextlost",this.handleContextLost,!1),t.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}return Object.defineProperty(s.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),s.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Yg++},s.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Yg++,this.renderer.runners.contextChange.emit(t)},s.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},s.prototype.createContext=function(t,e){var i;if(Z.PREFER_ENV>=Ji.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl},s.prototype.getExtensions=function(){var t=this.gl,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})},s.prototype.handleContextLost=function(t){var e=this;t.preventDefault(),setTimeout(function(){e.gl.isContextLost()&&e.extensions.loseContext&&e.extensions.loseContext.restoreContext()},0)},s.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},s.prototype.destroy=function(){var t=this.renderer.view;this.renderer=null,t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},s.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},s.prototype.validateContext=function(t){var e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var r=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},s}(),DC=function(){function s(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=oe.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}return s}(),LC=new et,UC=function(){function s(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new cc(10,10),this.msaaSamples=null}return s.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new et,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){var e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;Z.PREFER_ENV===Ji.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=function(r){return e.drawBuffersWEBGL(r)}:(this.hasMRT=!1,t.drawBuffers=function(){}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)},s.prototype.bind=function(t,e,i){i===void 0&&(i=0);var r=this.gl;if(t){var n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,r.bindFramebuffer(r.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=i),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var a=0;a<t.colorTextures.length;a++){var o=t.colorTextures[a];this.renderer.texture.unbind(o.parentTextureArray||o)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){var h=e.width>>i,u=e.height>>i,c=h/e.width;this.setViewport(e.x*c,e.y*c,h,u)}else{var h=t.width>>i,u=t.height>>i;this.setViewport(0,0,h,u)}}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},s.prototype.setViewport=function(t,e,i,r){var n=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),r=Math.round(r),(n.width!==i||n.height!==r||n.x!==t||n.y!==e)&&(n.x=t,n.y=e,n.width=i,n.height=r,this.gl.viewport(t,e,i,r))},Object.defineProperty(s.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),s.prototype.clear=function(t,e,i,r,n){n===void 0&&(n=Uu.COLOR|Uu.DEPTH);var a=this.gl;a.clearColor(t,e,i,r),a.clear(n)},s.prototype.initFramebuffer=function(t){var e=this.gl,i=new DC(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i},s.prototype.resizeFramebuffer=function(t){var e=this.gl,i=t.glFramebuffers[this.CONTEXT_UID];i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.RGBA8,t.width,t.height)),i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));var r=t.colorTextures,n=r.length;e.drawBuffers||(n=Math.min(n,1));for(var a=0;a<n;a++){var o=r[a],h=o.parentTextureArray||o;this.renderer.texture.bind(h,0)}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)},s.prototype.updateFramebuffer=function(t,e){var i=this.gl,r=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures,a=n.length;i.drawBuffers||(a=Math.min(a,1)),r.multisample>1&&this.canMultisampleFramebuffer(t)?(r.msaaBuffer=r.msaaBuffer||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,r.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.RGBA8,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,r.msaaBuffer)):r.msaaBuffer&&(i.deleteRenderbuffer(r.msaaBuffer),r.msaaBuffer=null,r.blitFramebuffer&&(r.blitFramebuffer.dispose(),r.blitFramebuffer=null));for(var o=[],h=0;h<a;h++){var u=n[h],c=u.parentTextureArray||u;this.renderer.texture.bind(c,0),!(h===0&&r.msaaBuffer)&&(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+h,u.target,c._glTextures[this.CONTEXT_UID].texture,e),o.push(i.COLOR_ATTACHMENT0+h))}if(o.length>1&&i.drawBuffers(o),t.depthTexture){var l=this.writeDepthTexture;if(l){var _=t.depthTexture;this.renderer.texture.bind(_,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,_._glTextures[this.CONTEXT_UID].texture,e)}}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(r.stencil=r.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,r.stencil),r.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,r.stencil)):r.stencil&&(i.deleteRenderbuffer(r.stencil),r.stencil=null)},s.prototype.canMultisampleFramebuffer=function(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture},s.prototype.detectSamples=function(t){var e=this.msaaSamples,i=oe.NONE;if(t<=1||e===null)return i;for(var r=0;r<e.length;r++)if(e[r]<=t){i=e[r];break}return i===1&&(i=oe.NONE),i},s.prototype.blit=function(t,e,i){var r=this,n=r.current,a=r.renderer,o=r.gl,h=r.CONTEXT_UID;if(a.context.webGLVersion===2&&n){var u=n.glFramebuffers[h];if(u){if(!t){if(!u.msaaBuffer)return;var c=n.colorTextures[0];if(!c)return;u.blitFramebuffer||(u.blitFramebuffer=new cc(n.width,n.height),u.blitFramebuffer.addColorTexture(0,c)),t=u.blitFramebuffer,t.colorTextures[0]!==c&&(t.colorTextures[0]=c,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||(e=LC,e.width=n.width,e.height=n.height),i||(i=e);var l=e.width===i.width&&e.height===i.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,u.framebuffer),o.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,o.COLOR_BUFFER_BIT,l?o.NEAREST:o.LINEAR)}}},s.prototype.disposeFramebuffer=function(t,e){var i=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(i){delete t.glFramebuffers[this.CONTEXT_UID];var n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(r.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&r.deleteRenderbuffer(i.msaaBuffer),i.stencil&&r.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&i.blitFramebuffer.dispose()}},s.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)},s.prototype.forceStencil=function(){var t=this.current;if(t){var e=t.glFramebuffers[this.CONTEXT_UID];if(!(!e||e.stencil)){t.stencil=!0;var i=t.width,r=t.height,n=this.gl,a=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,a),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,n.DEPTH24_STENCIL8,i,r):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,i,r),e.stencil=a,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,a)}}},s.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new et},s.prototype.destroy=function(){this.renderer=null},s}(),__={5126:4,5123:2,5121:1},xC=function(){function s(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}return s.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){var i=this.renderer.context.extensions.vertexArrayObject;Z.PREFER_ENV===Ji.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=function(){return i.createVertexArrayOES()},t.bindVertexArray=function(n){return i.bindVertexArrayOES(n)},t.deleteVertexArray=function(n){return i.deleteVertexArrayOES(n)}):(this.hasVao=!1,t.createVertexArray=function(){return null},t.bindVertexArray=function(){return null},t.deleteVertexArray=function(){return null})}if(e.webGLVersion!==2){var r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=function(n,a){return r.vertexAttribDivisorANGLE(n,a)},t.drawElementsInstanced=function(n,a,o,h,u){return r.drawElementsInstancedANGLE(n,a,o,h,u)},t.drawArraysInstanced=function(n,a,o,h){return r.drawArraysInstancedANGLE(n,a,o,h)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex},s.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var i=this.gl,r=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={},n=!0);var a=r[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?i.bindVertexArray(a):this.activateVao(t,e.program)),this.updateBuffers()},s.prototype.reset=function(){this.unbind()},s.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.renderer.buffer,i=0;i<t.buffers.length;i++){var r=t.buffers[i];e.update(r)}},s.prototype.checkCompatibility=function(t,e){var i=t.attributes,r=e.attributeData;for(var n in r)if(!i[n])throw new Error('shader and geometry incompatible, geometry missing the "'+n+'" attribute')},s.prototype.getSignature=function(t,e){var i=t.attributes,r=e.attributeData,n=["g",t.id];for(var a in i)r[a]&&n.push(a,r[a].location);return n.join("-")},s.prototype.initGeometryVao=function(t,e,i){i===void 0&&(i=!0);var r=this.gl,n=this.CONTEXT_UID,a=this.renderer.buffer,o=e.program;o.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);var h=this.getSignature(t,o),u=t.glVertexArrayObjects[this.CONTEXT_UID],c=u[h];if(c)return u[o.id]=c,c;var l=t.buffers,_=t.attributes,d={},g={};for(var m in l)d[m]=0,g[m]=0;for(var m in _)!_[m].size&&o.attributeData[m]?_[m].size=o.attributeData[m].size:_[m].size||console.warn("PIXI Geometry attribute '"+m+"' size cannot be determined (likely the bound shader does not have the attribute)"),d[_[m].buffer]+=_[m].size*__[_[m].type];for(var m in _){var p=_[m],T=p.size;p.stride===void 0&&(d[p.buffer]===T*__[p.type]?p.stride=0:p.stride=d[p.buffer]),p.start===void 0&&(p.start=g[p.buffer],g[p.buffer]+=T*__[p.type])}c=r.createVertexArray(),r.bindVertexArray(c);for(var A=0;A<l.length;A++){var O=l[A];a.bind(O),i&&O._glBuffers[n].refCount++}return this.activateVao(t,o),this._activeVao=c,u[o.id]=c,u[h]=c,c},s.prototype.disposeGeometry=function(t,e){var i;if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var r=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,a=t.buffers,o=(i=this.renderer)===null||i===void 0?void 0:i.buffer;if(t.disposeRunner.remove(this),!!r){if(o)for(var h=0;h<a.length;h++){var u=a[h]._glBuffers[this.CONTEXT_UID];u&&(u.refCount--,u.refCount===0&&!e&&o.dispose(a[h],e))}if(!e){for(var c in r)if(c[0]==="g"){var l=r[c];this._activeVao===l&&this.unbind(),n.deleteVertexArray(l)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},s.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)},s.prototype.activateVao=function(t,e){var i=this.gl,r=this.CONTEXT_UID,n=this.renderer.buffer,a=t.buffers,o=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);var h=null;for(var u in o){var c=o[u],l=a[c.buffer],_=l._glBuffers[r];if(e.attributeData[u]){h!==_&&(n.bind(l),h=_);var d=e.attributeData[u].location;if(i.enableVertexAttribArray(d),i.vertexAttribPointer(d,c.size,c.type||i.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)i.vertexAttribDivisor(d,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}},s.prototype.draw=function(t,e,i,r){var n=this.gl,a=this._activeGeometry;if(a.indexBuffer){var o=a.indexBuffer.data.BYTES_PER_ELEMENT,h=o===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;o===2||o===4&&this.canUseUInt32ElementIndex?a.instanced?n.drawElementsInstanced(t,e||a.indexBuffer.data.length,h,(i||0)*o,r||1):n.drawElements(t,e||a.indexBuffer.data.length,h,(i||0)*o):console.warn("unsupported index buffer type: uint32")}else a.instanced?n.drawArraysInstanced(t,i,e||a.getSize(),r||1):n.drawArrays(t,i,e||a.getSize());return this},s.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},s.prototype.destroy=function(){this.renderer=null},s}(),FC=function(){function s(t){t===void 0&&(t=null),this.type=Re.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Z.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}return Object.defineProperty(s.prototype,"filter",{get:function(){return this._filters?this._filters[0]:null},set:function(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null},enumerable:!1,configurable:!0}),s.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=Re.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null},s.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},s}();function Wg(s,t,e){var i=s.createShader(t);return s.shaderSource(i,e),s.compileShader(i),i}function Xg(s,t){var e=s.getShaderSource(t).split(`
`).map(function(u,c){return c+": "+u}),i=s.getShaderInfoLog(t),r=i.split(`
`),n={},a=r.map(function(u){return parseFloat(u.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))}).filter(function(u){return u&&!n[u]?(n[u]=!0,!0):!1}),o=[""];a.forEach(function(u){e[u-1]="%c"+e[u-1]+"%c",o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});var h=e.join(`
`);o[0]=h,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn.apply(console,o),console.groupEnd()}function wC(s,t,e,i){s.getProgramParameter(t,s.LINK_STATUS)||(s.getShaderParameter(e,s.COMPILE_STATUS)||Xg(s,e),s.getShaderParameter(i,s.COMPILE_STATUS)||Xg(s,i),console.error("PixiJS Error: Could not initialize shader."),s.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",s.getProgramInfoLog(t)))}function c_(s){for(var t=new Array(s),e=0;e<t.length;e++)t[e]=!1;return t}function kp(s,t){switch(s){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return c_(2*t);case"bvec3":return c_(3*t);case"bvec4":return c_(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var jp={},to=jp;function GC(){if(to===jp||to&&to.isContextLost()){var s=Z.ADAPTER.createCanvas(),t=void 0;Z.PREFER_ENV>=Ji.WEBGL2&&(t=s.getContext("webgl2",{})),t||(t=s.getContext("webgl",{})||s.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),to=t}return to}var Kh;function BC(){if(!Kh){Kh=Es.MEDIUM;var s=GC();if(s&&s.getShaderPrecisionFormat){var t=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT);Kh=t.precision?Es.HIGH:Es.MEDIUM}}return Kh}function Kg(s,t,e){if(s.substring(0,9)!=="precision"){var i=t;return t===Es.HIGH&&e!==Es.HIGH&&(i=Es.MEDIUM),"precision "+i+` float;
`+s}else if(e!==Es.HIGH&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}var HC={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function zp(s){return HC[s]}var qh=null,qg={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Yp(s,t){if(!qh){var e=Object.keys(qg);qh={};for(var i=0;i<e.length;++i){var r=e[i];qh[s[r]]=qg[r]}}return qh[t]}var ma=[{test:function(s){return s.type==="float"&&s.size===1&&!s.isArray},code:function(s){return`
            if(uv["`+s+'"] !== ud["'+s+`"].value)
            {
                ud["`+s+'"].value = uv["'+s+`"]
                gl.uniform1f(ud["`+s+'"].location, uv["'+s+`"])
            }
            `}},{test:function(s,t){return(s.type==="sampler2D"||s.type==="samplerCube"||s.type==="sampler2DArray")&&s.size===1&&!s.isArray&&(t==null||t.castToBaseTexture!==void 0)},code:function(s){return`t = syncData.textureCount++;

            renderer.texture.bind(uv["`+s+`"], t);

            if(ud["`+s+`"].value !== t)
            {
                ud["`+s+`"].value = t;
                gl.uniform1i(ud["`+s+`"].location, t);
; // eslint-disable-line max-len
            }`}},{test:function(s,t){return s.type==="mat3"&&s.size===1&&!s.isArray&&t.a!==void 0},code:function(s){return`
            gl.uniformMatrix3fv(ud["`+s+'"].location, false, uv["'+s+`"].toArray(true));
            `},codeUbo:function(s){return`
                var `+s+"_matrix = uv."+s+`.toArray(true);

                data[offset] = `+s+`_matrix[0];
                data[offset+1] = `+s+`_matrix[1];
                data[offset+2] = `+s+`_matrix[2];
        
                data[offset + 4] = `+s+`_matrix[3];
                data[offset + 5] = `+s+`_matrix[4];
                data[offset + 6] = `+s+`_matrix[5];
        
                data[offset + 8] = `+s+`_matrix[6];
                data[offset + 9] = `+s+`_matrix[7];
                data[offset + 10] = `+s+`_matrix[8];
            `}},{test:function(s,t){return s.type==="vec2"&&s.size===1&&!s.isArray&&t.x!==void 0},code:function(s){return`
                cv = ud["`+s+`"].value;
                v = uv["`+s+`"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["`+s+`"].location, v.x, v.y);
                }`},codeUbo:function(s){return`
                v = uv.`+s+`;

                data[offset] = v.x;
                data[offset+1] = v.y;
            `}},{test:function(s){return s.type==="vec2"&&s.size===1&&!s.isArray},code:function(s){return`
                cv = ud["`+s+`"].value;
                v = uv["`+s+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["`+s+`"].location, v[0], v[1]);
                }
            `}},{test:function(s,t){return s.type==="vec4"&&s.size===1&&!s.isArray&&t.width!==void 0},code:function(s){return`
                cv = ud["`+s+`"].value;
                v = uv["`+s+`"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["`+s+`"].location, v.x, v.y, v.width, v.height)
                }`},codeUbo:function(s){return`
                    v = uv.`+s+`;

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `}},{test:function(s){return s.type==="vec4"&&s.size===1&&!s.isArray},code:function(s){return`
                cv = ud["`+s+`"].value;
                v = uv["`+s+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["`+s+`"].location, v[0], v[1], v[2], v[3])
                }`}}],VC={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},kC={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function jC(s,t){var e,i=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(var r in s.uniforms){var n=t[r];if(!n){!((e=s.uniforms[r])===null||e===void 0)&&e.group&&(s.uniforms[r].ubo?i.push(`
                        renderer.shader.syncUniformBufferGroup(uv.`+r+", '"+r+`');
                    `):i.push(`
                        renderer.shader.syncUniformGroup(uv.`+r+`, syncData);
                    `));continue}for(var a=s.uniforms[r],o=!1,h=0;h<ma.length;h++)if(ma[h].test(n,a)){i.push(ma[h].code(r,a)),o=!0;break}if(!o){var u=n.size===1&&!n.isArray?VC:kC,c=u[n.type].replace("location",'ud["'+r+'"].location');i.push(`
            cu = ud["`+r+`"];
            cv = cu.value;
            v = uv["`+r+`"];
            `+c+";")}}return new Function("ud","uv","renderer","syncData",i.join(`
`))}var zC=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function YC(s){for(var t="",e=0;e<s;++e)e>0&&(t+=`
else `),e<s-1&&(t+="if(test == "+e+".0){}");return t}function WC(s,t){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var e=t.createShader(t.FRAGMENT_SHADER);;){var i=zC.replace(/%forloop%/gi,YC(s));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))s=s/2|0;else break}return s}var eo;function XC(){if(typeof eo=="boolean")return eo;try{var s=new Function("param1","param2","param3","return param1[param2] === param3;");eo=s({a:"b"},"a","b")===!0}catch{eo=!1}return eo}var KC=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,qC=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`,ZC=0,Zh={},Rl=function(){function s(t,e,i){i===void 0&&(i="pixi-shader"),this.id=ZC++,this.vertexSrc=t||s.defaultVertexSrc,this.fragmentSrc=e||s.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),Zh[i]?(Zh[i]++,i+="-"+Zh[i]):Zh[i]=1,this.vertexSrc="#define SHADER_NAME "+i+`
`+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+i+`
`+this.fragmentSrc,this.vertexSrc=Kg(this.vertexSrc,Z.PRECISION_VERTEX,Es.HIGH),this.fragmentSrc=Kg(this.fragmentSrc,Z.PRECISION_FRAGMENT,BC())),this.glPrograms={},this.syncUniforms=null}return Object.defineProperty(s,"defaultVertexSrc",{get:function(){return qC},enumerable:!1,configurable:!0}),Object.defineProperty(s,"defaultFragmentSrc",{get:function(){return KC},enumerable:!1,configurable:!0}),s.from=function(t,e,i){var r=t+e,n=Bg[r];return n||(Bg[r]=n=new s(t,e,i)),n},s}(),vn=function(){function s(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof An?this.uniformGroup=e:this.uniformGroup=new An(e):this.uniformGroup=new An({}),this.disposeRunner=new ke("disposeShader")}return s.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var i in e.uniforms){var r=e.uniforms[i];if(r.group&&this.checkUniformExists(t,r))return!0}return!1},s.prototype.destroy=function(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()},Object.defineProperty(s.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),s.from=function(t,e,i){var r=Rl.from(t,e);return new s(r,i)},s}(),d_=0,f_=1,g_=2,E_=3,p_=4,m_=5,ah=function(){function s(){this.data=0,this.blendMode=J.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(s.prototype,"blend",{get:function(){return!!(this.data&1<<d_)},set:function(t){!!(this.data&1<<d_)!==t&&(this.data^=1<<d_)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"offsets",{get:function(){return!!(this.data&1<<f_)},set:function(t){!!(this.data&1<<f_)!==t&&(this.data^=1<<f_)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"culling",{get:function(){return!!(this.data&1<<g_)},set:function(t){!!(this.data&1<<g_)!==t&&(this.data^=1<<g_)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"depthTest",{get:function(){return!!(this.data&1<<E_)},set:function(t){!!(this.data&1<<E_)!==t&&(this.data^=1<<E_)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"depthMask",{get:function(){return!!(this.data&1<<m_)},set:function(t){!!(this.data&1<<m_)!==t&&(this.data^=1<<m_)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"clockwiseFrontFace",{get:function(){return!!(this.data&1<<p_)},set:function(t){!!(this.data&1<<p_)!==t&&(this.data^=1<<p_)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){this.blend=t!==J.NONE,this._blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(t){this.offsets=!!t,this._polygonOffset=t},enumerable:!1,configurable:!0}),s.prototype.toString=function(){return"[@pixi/core:State "+("blendMode="+this.blendMode+" ")+("clockwiseFrontFace="+this.clockwiseFrontFace+" ")+("culling="+this.culling+" ")+("depthMask="+this.depthMask+" ")+("polygonOffset="+this.polygonOffset)+"]"},s.for2d=function(){var t=new s;return t.depthTest=!1,t.blend=!0,t},s}(),QC=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,JC=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,Ua=function(s){te(t,s);function t(e,i,r){var n=this,a=Rl.from(e||t.defaultVertexSrc,i||t.defaultFragmentSrc);return n=s.call(this,a,r)||this,n.padding=0,n.resolution=Z.FILTER_RESOLUTION,n.multisample=Z.FILTER_MULTISAMPLE,n.enabled=!0,n.autoFit=!0,n.state=new ah,n}return t.prototype.apply=function(e,i,r,n,a){e.applyFilter(this,i,r,n)},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(e){this.state.blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolution",{get:function(){return this._resolution},set:function(e){this._resolution=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultVertexSrc",{get:function(){return JC},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentSrc",{get:function(){return QC},enumerable:!1,configurable:!0}),t}(vn),$C=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,tM=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,Zg=new wt,Wp=function(){function s(t,e){this._texture=t,this.mapCoord=new wt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}return Object.defineProperty(s.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._textureID=-1},enumerable:!1,configurable:!0}),s.prototype.multiplyUvs=function(t,e){e===void 0&&(e=t);for(var i=this.mapCoord,r=0;r<t.length;r+=2){var n=t[r],a=t[r+1];e[r]=n*i.a+a*i.c+i.tx,e[r+1]=n*i.b+a*i.d+i.ty}return e},s.prototype.update=function(t){var e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;var i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);var r=e.orig,n=e.trim;n&&(Zg.set(r.width/n.width,0,0,r.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Zg));var a=e.baseTexture,o=this.uClampFrame,h=this.clampMargin/a.resolution,u=this.clampOffset;return o[0]=(e._frame.x+h+u)/a.width,o[1]=(e._frame.y+h+u)/a.height,o[2]=(e._frame.x+e._frame.width-h+u)/a.width,o[3]=(e._frame.y+e._frame.height-h+u)/a.height,this.uClampOffset[0]=u/a.realWidth,this.uClampOffset[1]=u/a.realHeight,this.isSimple=e._frame.width===a.width&&e._frame.height===a.height&&e.rotate===0,!0},s}(),eM=function(s){te(t,s);function t(e,i,r){var n=this,a=null;return typeof e!="string"&&i===void 0&&r===void 0&&(a=e,e=void 0,i=void 0,r=void 0),n=s.call(this,e||$C,i||tM,r)||this,n.maskSprite=a,n.maskMatrix=new wt,n}return Object.defineProperty(t.prototype,"maskSprite",{get:function(){return this._maskSprite},set:function(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)},enumerable:!1,configurable:!0}),t.prototype.apply=function(e,i,r,n){var a=this._maskSprite,o=a._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new Wp(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,a).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=a.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,e.applyFilter(this,i,r,n))},t}(Ua),sM=function(){function s(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return s.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},s.prototype.push=function(t,e){var i=e;if(!i.isMaskData){var r=this.maskDataPool.pop()||new FC;r.pooled=!0,r.maskObject=e,i=r}var n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(n),i._colorMask=n?n._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==Re.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case Re.SCISSOR:this.renderer.scissor.push(i);break;case Re.STENCIL:this.renderer.stencil.push(i);break;case Re.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case Re.COLOR:this.pushColorMask(i);break}i.type===Re.SPRITE&&this.maskStack.push(i)},s.prototype.pop=function(t){var e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case Re.SCISSOR:this.renderer.scissor.pop(e);break;case Re.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case Re.SPRITE:this.popSpriteMask(e);break;case Re.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){var i=this.maskStack[this.maskStack.length-1];i.type===Re.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}},s.prototype.detect=function(t){var e=t.maskObject;e?e.isSprite?t.type=Re.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=Re.SCISSOR:t.type=Re.STENCIL:t.type=Re.COLOR},s.prototype.pushSpriteMask=function(t){var e,i,r=t.maskObject,n=t._target,a=t._filters;a||(a=this.alphaMaskPool[this.alphaMaskIndex],a||(a=this.alphaMaskPool[this.alphaMaskIndex]=[new eM]));var o=this.renderer,h=o.renderTexture,u,c;if(h.current){var l=h.current;u=t.resolution||l.resolution,c=(e=t.multisample)!==null&&e!==void 0?e:l.multisample}else u=t.resolution||o.resolution,c=(i=t.multisample)!==null&&i!==void 0?i:o.multisample;a[0].resolution=u,a[0].multisample=c,a[0].maskSprite=r;var _=n.filterArea;n.filterArea=r.getBounds(!0),o.filter.push(n,a),n.filterArea=_,t._filters||this.alphaMaskIndex++},s.prototype.popSpriteMask=function(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)},s.prototype.pushColorMask=function(t){var e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)},s.prototype.popColorMask=function(t){var e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)},s.prototype.destroy=function(){this.renderer=null},s}(),Xp=function(){function s(t){this.renderer=t,this.maskStack=[],this.glConst=0}return s.prototype.getStackLength=function(){return this.maskStack.length},s.prototype.setMaskStack=function(t){var e=this.renderer.gl,i=this.getStackLength();this.maskStack=t;var r=this.getStackLength();r!==i&&(r===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))},s.prototype._useCurrent=function(){},s.prototype.destroy=function(){this.renderer=null,this.maskStack=null},s}(),Qg=new wt,Jg=[],iM=function(s){te(t,s);function t(e){var i=s.call(this,e)||this;return i.glConst=Z.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST,i}return t.prototype.getStackLength=function(){var e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0},t.prototype.calcScissorRect=function(e){var i;if(!e._scissorRectLocal){var r=e._scissorRect,n=e.maskObject,a=this.renderer,o=a.renderTexture,h=n.getBounds(!0,(i=Jg.pop())!==null&&i!==void 0?i:new et);this.roundFrameToPixels(h,o.current?o.current.resolution:a.resolution,o.sourceFrame,o.destinationFrame,a.projection.transform),r&&h.fit(r),e._scissorRectLocal=h}},t.isMatrixRotated=function(e){if(!e)return!1;var i=e.a,r=e.b,n=e.c,a=e.d;return(Math.abs(r)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(i)>1e-4||Math.abs(a)>1e-4)},t.prototype.testScissor=function(e){var i=e.maskObject;if(!i.isFastRect||!i.isFastRect()||t.isMatrixRotated(i.worldTransform)||t.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);var r=e._scissorRectLocal;return r.width>0&&r.height>0},t.prototype.roundFrameToPixels=function(e,i,r,n,a){t.isMatrixRotated(a)||(a=a?Qg.copyFrom(a):Qg.identity(),a.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.renderer.filter.transformAABB(a,e),e.fit(n),e.x=Math.round(e.x*i),e.y=Math.round(e.y*i),e.width=Math.round(e.width*i),e.height=Math.round(e.height*i))},t.prototype.push=function(e){e._scissorRectLocal||this.calcScissorRect(e);var i=this.renderer.gl;e._scissorRect||i.enable(i.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()},t.prototype.pop=function(e){var i=this.renderer.gl;e&&Jg.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():i.disable(i.SCISSOR_TEST)},t.prototype._useCurrent=function(){var e=this.maskStack[this.maskStack.length-1]._scissorRect,i;this.renderer.renderTexture.current?i=e.y:i=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,i,e.width,e.height)},t}(Xp),rM=function(s){te(t,s);function t(e){var i=s.call(this,e)||this;return i.glConst=Z.ADAPTER.getWebGLRenderingContext().STENCIL_TEST,i}return t.prototype.getStackLength=function(){var e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0},t.prototype.push=function(e){var i=e.maskObject,r=this.renderer.gl,n=e._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),e._stencilCounter++;var a=e._colorMask;a!==0&&(e._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,n,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),i.renderable=!0,i.render(this.renderer),this.renderer.batch.flush(),i.renderable=!1,a!==0&&(e._colorMask=a,r.colorMask((a&1)!==0,(a&2)!==0,(a&4)!==0,(a&8)!==0)),this._useCurrent()},t.prototype.pop=function(e){var i=this.renderer.gl;if(this.getStackLength()===0)i.disable(i.STENCIL_TEST);else{var r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=r?r._colorMask:15;n!==0&&(r._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilOp(i.KEEP,i.KEEP,i.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(r._colorMask=n,i.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}},t.prototype._useCurrent=function(){var e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)},t}(Xp),nM=function(){function s(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new wt,this.transform=null}return s.prototype.update=function(t,e,i,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,r),this.transform&&this.projectionMatrix.append(this.transform);var n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)},s.prototype.calculateProjection=function(t,e,i,r){var n=this.projectionMatrix,a=r?-1:1;n.identity(),n.a=1/e.width*2,n.d=a*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-a-e.y*n.d},s.prototype.setTransform=function(t){},s.prototype.destroy=function(){this.renderer=null},s}(),qr=new et,so=new et,aM=function(){function s(t){this.renderer=t,this.clearColor=t._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new et,this.destinationFrame=new et,this.viewportFrame=new et}return s.prototype.bind=function(t,e,i){t===void 0&&(t=null);var r=this.renderer;this.current=t;var n,a,o;t?(n=t.baseTexture,o=n.resolution,e||(qr.width=t.frame.width,qr.height=t.frame.height,e=qr),i||(so.x=t.frame.x,so.y=t.frame.y,so.width=e.width,so.height=e.height,i=so),a=n.framebuffer):(o=r.resolution,e||(qr.width=r.screen.width,qr.height=r.screen.height,e=qr),i||(i=qr,i.width=e.width,i.height=e.height));var h=this.viewportFrame;h.x=i.x*o,h.y=i.y*o,h.width=i.width*o,h.height=i.height*o,t||(h.y=r.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(a,h),this.renderer.projection.update(i,e,o,!a),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)},s.prototype.clear=function(t,e){this.current?t=t||this.current.baseTexture.clearColor:t=t||this.clearColor;var i=this.destinationFrame,r=this.current?this.current.baseTexture:this.renderer.screen,n=i.width!==r.width||i.height!==r.height;if(n){var a=this.viewportFrame,o=a.x,h=a.y,u=a.width,c=a.height;o=Math.round(o),h=Math.round(h),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(o,h,u,c)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),n&&this.renderer.scissor.pop()},s.prototype.resize=function(){this.bind(null)},s.prototype.reset=function(){this.bind(null)},s.prototype.destroy=function(){this.renderer=null},s}();function oM(s,t,e,i,r){e.buffer.update(r)}var hM={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Kp={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function uM(s){for(var t=s.map(function(h){return{data:h,offset:0,dataLen:0,dirty:0}}),e=0,i=0,r=0,n=0;n<t.length;n++){var a=t[n];if(e=Kp[a.data.type],a.data.size>1&&(e=Math.max(e,16)*a.data.size),a.dataLen=e,i%e!==0&&i<16){var o=i%e%16;i+=o,r+=o}i+e>16?(r=Math.ceil(r/16)*16,a.offset=r,r+=e,i=e):(a.offset=r,i+=e,r+=e)}return r=Math.ceil(r/16)*16,{uboElements:t,size:r}}function lM(s,t){var e=[];for(var i in s)t[i]&&e.push(t[i]);return e.sort(function(r,n){return r.index-n.index}),e}function _M(s,t){if(!s.autoManage)return{size:0,syncFunc:oM};for(var e=lM(s.uniforms,t),i=uM(e),r=i.uboElements,n=i.size,a=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `],o=0;o<r.length;o++){for(var h=r[o],u=s.uniforms[h.data.name],c=h.data.name,l=!1,_=0;_<ma.length;_++){var d=ma[_];if(d.codeUbo&&d.test(h.data,u)){a.push("offset = "+h.offset/4+";",ma[_].codeUbo(h.data.name,u)),l=!0;break}}if(!l)if(h.data.size>1){var g=zp(h.data.type),m=Math.max(Kp[h.data.type]/16,1),p=g/m,T=(4-p%4)%4;a.push(`
                cv = ud.`+c+`.value;
                v = uv.`+c+`;
                offset = `+h.offset/4+`;

                t = 0;

                for(var i=0; i < `+h.data.size*m+`; i++)
                {
                    for(var j = 0; j < `+p+`; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += `+T+`;
                }

                `)}else{var A=hM[h.data.type];a.push(`
                cv = ud.`+c+`.value;
                v = uv.`+c+`;
                offset = `+h.offset/4+`;
                `+A+`;
                `)}}return a.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",a.join(`
`))}}var cM=function(){function s(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}return s.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},s}();function dM(s,t){for(var e={},i=t.getProgramParameter(s,t.ACTIVE_ATTRIBUTES),r=0;r<i;r++){var n=t.getActiveAttrib(s,r);if(n.name.indexOf("gl_")!==0){var a=Yp(t,n.type),o={type:a,name:n.name,size:zp(a),location:t.getAttribLocation(s,n.name)};e[n.name]=o}}return e}function fM(s,t){for(var e={},i=t.getProgramParameter(s,t.ACTIVE_UNIFORMS),r=0;r<i;r++){var n=t.getActiveUniform(s,r),a=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),h=Yp(t,n.type);e[a]={name:a,index:r,type:h,size:n.size,isArray:o,value:kp(h,n.size)}}return e}function gM(s,t){var e=Wg(s,s.VERTEX_SHADER,t.vertexSrc),i=Wg(s,s.FRAGMENT_SHADER,t.fragmentSrc),r=s.createProgram();if(s.attachShader(r,e),s.attachShader(r,i),s.linkProgram(r),s.getProgramParameter(r,s.LINK_STATUS)||wC(s,r,e,i),t.attributeData=dM(r,s),t.uniformData=fM(r,s),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){var n=Object.keys(t.attributeData);n.sort(function(c,l){return c>l?1:-1});for(var a=0;a<n.length;a++)t.attributeData[n[a]].location=a,s.bindAttribLocation(r,a,n[a]);s.linkProgram(r)}s.deleteShader(e),s.deleteShader(i);var o={};for(var a in t.uniformData){var h=t.uniformData[a];o[a]={location:s.getUniformLocation(r,a),value:kp(h.type,h.size)}}var u=new cM(r,o);return u}var EM=0,Qh={textureCount:0,uboCount:0},pM=function(){function s(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=EM++}return s.prototype.systemCheck=function(){if(!XC())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},s.prototype.contextChange=function(t){this.gl=t,this.reset()},s.prototype.bind=function(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;var i=t.program,r=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(r.program)),e||(Qh.textureCount=0,Qh.uboCount=0,this.syncUniformGroup(t.uniformGroup,Qh)),r},s.prototype.setUniforms=function(t){var e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)},s.prototype.syncUniformGroup=function(t,e){var i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))},s.prototype.syncUniforms=function(t,e,i){var r=t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t);r(e.uniformData,t.uniforms,this.renderer,i)},s.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=jC(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},s.prototype.syncUniformBufferGroup=function(t,e){var i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;var r=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),r(i.uniformData,t.uniforms,this.renderer,Qh,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])},s.prototype.createSyncBufferGroup=function(t,e,i){var r=this.renderer.gl;this.renderer.buffer.bind(t.buffer);var n=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,r.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;var a=this.getSignature(t,this.shader.program.uniformData,"ubo"),o=this._uboCache[a];if(o||(o=this._uboCache[a]=_M(t,this.shader.program.uniformData)),t.autoManage){var h=new Float32Array(o.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]},s.prototype.getSignature=function(t,e,i){var r=t.uniforms,n=[i+"-"];for(var a in r)n.push(a),e[a]&&n.push(e[a].type);return n.join("-")},s.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},s.prototype.generateProgram=function(t){var e=this.gl,i=t.program,r=gM(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=r,r},s.prototype.reset=function(){this.program=null,this.shader=null},s.prototype.disposeShader=function(t){this.shader===t&&(this.shader=null)},s.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},s}();function mM(s,t){return t===void 0&&(t=[]),t[J.NORMAL]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.ADD]=[s.ONE,s.ONE],t[J.MULTIPLY]=[s.DST_COLOR,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.SCREEN]=[s.ONE,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.OVERLAY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.DARKEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.LIGHTEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.COLOR_DODGE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.COLOR_BURN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.HARD_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.SOFT_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.DIFFERENCE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.EXCLUSION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.HUE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.SATURATION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.COLOR]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.LUMINOSITY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.NONE]=[0,0],t[J.NORMAL_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.ADD_NPM]=[s.SRC_ALPHA,s.ONE,s.ONE,s.ONE],t[J.SCREEN_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[J.SRC_IN]=[s.DST_ALPHA,s.ZERO],t[J.SRC_OUT]=[s.ONE_MINUS_DST_ALPHA,s.ZERO],t[J.SRC_ATOP]=[s.DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],t[J.DST_OVER]=[s.ONE_MINUS_DST_ALPHA,s.ONE],t[J.DST_IN]=[s.ZERO,s.SRC_ALPHA],t[J.DST_OUT]=[s.ZERO,s.ONE_MINUS_SRC_ALPHA],t[J.DST_ATOP]=[s.ONE_MINUS_DST_ALPHA,s.SRC_ALPHA],t[J.XOR]=[s.ONE_MINUS_DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],t[J.SUBTRACT]=[s.ONE,s.ONE,s.ONE,s.ONE,s.FUNC_REVERSE_SUBTRACT,s.FUNC_ADD],t}var IM=0,TM=1,RM=2,OM=3,AM=4,vM=5,SM=function(){function s(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=J.NONE,this._blendEq=!1,this.map=[],this.map[IM]=this.setBlend,this.map[TM]=this.setOffset,this.map[RM]=this.setCullFace,this.map[OM]=this.setDepthTest,this.map[AM]=this.setFrontFace,this.map[vM]=this.setDepthMask,this.checks=[],this.defaultState=new ah,this.defaultState.blend=!0}return s.prototype.contextChange=function(t){this.gl=t,this.blendModes=mM(t),this.set(this.defaultState),this.reset()},s.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var e=this.stateId^t.data,i=0;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data}for(var i=0;i<this.checks.length;i++)this.checks[i](this,t)},s.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(var e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data},s.prototype.setBlend=function(t){this.updateCheck(s.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},s.prototype.setOffset=function(t){this.updateCheck(s.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},s.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},s.prototype.setDepthMask=function(t){this.gl.depthMask(t)},s.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},s.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},s.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}},s.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},s.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},s.prototype.updateCheck=function(t,e){var i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1)},s.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},s.checkPolygonOffset=function(t,e){t.setPolygonOffset(1,e.polygonOffset)},s.prototype.destroy=function(){this.gl=null},s}(),yM=function(){function s(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Z.GC_MAX_IDLE,this.checkCountMax=Z.GC_MAX_CHECK_COUNT,this.mode=Z.GC_MODE}return s.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==Fu.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},s.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,i=!1,r=0;r<e.length;r++){var n=e[r];!n.framebuffer&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[r]=null,i=!0)}if(i){for(var a=0,r=0;r<e.length;r++)e[r]!==null&&(e[a++]=e[r]);e.length=a}},s.prototype.unload=function(t){var e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(var r=t.children.length-1;r>=0;r--)this.unload(t.children[r])},s.prototype.destroy=function(){this.renderer=null},s}();function CM(s){var t,e,i,r,n,a,o,h,u,c,l,_,d,g,m,p,T,A,O,v,y,C,N;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?N=(t={},t[Ut.UNSIGNED_BYTE]=(e={},e[W.RGBA]=s.RGBA8,e[W.RGB]=s.RGB8,e[W.RG]=s.RG8,e[W.RED]=s.R8,e[W.RGBA_INTEGER]=s.RGBA8UI,e[W.RGB_INTEGER]=s.RGB8UI,e[W.RG_INTEGER]=s.RG8UI,e[W.RED_INTEGER]=s.R8UI,e[W.ALPHA]=s.ALPHA,e[W.LUMINANCE]=s.LUMINANCE,e[W.LUMINANCE_ALPHA]=s.LUMINANCE_ALPHA,e),t[Ut.BYTE]=(i={},i[W.RGBA]=s.RGBA8_SNORM,i[W.RGB]=s.RGB8_SNORM,i[W.RG]=s.RG8_SNORM,i[W.RED]=s.R8_SNORM,i[W.RGBA_INTEGER]=s.RGBA8I,i[W.RGB_INTEGER]=s.RGB8I,i[W.RG_INTEGER]=s.RG8I,i[W.RED_INTEGER]=s.R8I,i),t[Ut.UNSIGNED_SHORT]=(r={},r[W.RGBA_INTEGER]=s.RGBA16UI,r[W.RGB_INTEGER]=s.RGB16UI,r[W.RG_INTEGER]=s.RG16UI,r[W.RED_INTEGER]=s.R16UI,r[W.DEPTH_COMPONENT]=s.DEPTH_COMPONENT16,r),t[Ut.SHORT]=(n={},n[W.RGBA_INTEGER]=s.RGBA16I,n[W.RGB_INTEGER]=s.RGB16I,n[W.RG_INTEGER]=s.RG16I,n[W.RED_INTEGER]=s.R16I,n),t[Ut.UNSIGNED_INT]=(a={},a[W.RGBA_INTEGER]=s.RGBA32UI,a[W.RGB_INTEGER]=s.RGB32UI,a[W.RG_INTEGER]=s.RG32UI,a[W.RED_INTEGER]=s.R32UI,a[W.DEPTH_COMPONENT]=s.DEPTH_COMPONENT24,a),t[Ut.INT]=(o={},o[W.RGBA_INTEGER]=s.RGBA32I,o[W.RGB_INTEGER]=s.RGB32I,o[W.RG_INTEGER]=s.RG32I,o[W.RED_INTEGER]=s.R32I,o),t[Ut.FLOAT]=(h={},h[W.RGBA]=s.RGBA32F,h[W.RGB]=s.RGB32F,h[W.RG]=s.RG32F,h[W.RED]=s.R32F,h[W.DEPTH_COMPONENT]=s.DEPTH_COMPONENT32F,h),t[Ut.HALF_FLOAT]=(u={},u[W.RGBA]=s.RGBA16F,u[W.RGB]=s.RGB16F,u[W.RG]=s.RG16F,u[W.RED]=s.R16F,u),t[Ut.UNSIGNED_SHORT_5_6_5]=(c={},c[W.RGB]=s.RGB565,c),t[Ut.UNSIGNED_SHORT_4_4_4_4]=(l={},l[W.RGBA]=s.RGBA4,l),t[Ut.UNSIGNED_SHORT_5_5_5_1]=(_={},_[W.RGBA]=s.RGB5_A1,_),t[Ut.UNSIGNED_INT_2_10_10_10_REV]=(d={},d[W.RGBA]=s.RGB10_A2,d[W.RGBA_INTEGER]=s.RGB10_A2UI,d),t[Ut.UNSIGNED_INT_10F_11F_11F_REV]=(g={},g[W.RGB]=s.R11F_G11F_B10F,g),t[Ut.UNSIGNED_INT_5_9_9_9_REV]=(m={},m[W.RGB]=s.RGB9_E5,m),t[Ut.UNSIGNED_INT_24_8]=(p={},p[W.DEPTH_STENCIL]=s.DEPTH24_STENCIL8,p),t[Ut.FLOAT_32_UNSIGNED_INT_24_8_REV]=(T={},T[W.DEPTH_STENCIL]=s.DEPTH32F_STENCIL8,T),t):N=(A={},A[Ut.UNSIGNED_BYTE]=(O={},O[W.RGBA]=s.RGBA,O[W.RGB]=s.RGB,O[W.ALPHA]=s.ALPHA,O[W.LUMINANCE]=s.LUMINANCE,O[W.LUMINANCE_ALPHA]=s.LUMINANCE_ALPHA,O),A[Ut.UNSIGNED_SHORT_5_6_5]=(v={},v[W.RGB]=s.RGB,v),A[Ut.UNSIGNED_SHORT_4_4_4_4]=(y={},y[W.RGBA]=s.RGBA,y),A[Ut.UNSIGNED_SHORT_5_5_5_1]=(C={},C[W.RGBA]=s.RGBA,C),A),N}var I_=function(){function s(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=Ut.UNSIGNED_BYTE,this.internalFormat=W.RGBA,this.samplerType=0}return s}(),MM=function(){function s(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Yt,this.hasIntegerTextures=!1}return s.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=CM(t);var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(var i=0;i<e;i++)this.boundTextures[i]=null;this.emptyTextures={};var r=new I_(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new I_(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(var i=0;i<6;i++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(var i=0;i<this.boundTextures.length;i++)this.bind(null,i)},s.prototype.bind=function(t,e){e===void 0&&(e=0);var i=this.gl;if(t=t==null?void 0:t.castToBaseTexture(),t&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;var r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):r.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null},s.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},s.prototype.unbind=function(t){var e=this,i=e.gl,r=e.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var n=0;n<r.length;n++)r[n]===this.unknownTexture&&this.bind(null,n)}for(var n=0;n<r.length;n++)r[n]===t&&(this.currentLocation!==n&&(i.activeTexture(i.TEXTURE0+n),this.currentLocation=n),i.bindTexture(t.target,this.emptyTextures[t.target].texture),r[n]=null)},s.prototype.ensureSamplerType=function(t){var e=this,i=e.boundTextures,r=e.hasIntegerTextures,n=e.CONTEXT_UID;if(r)for(var a=t-1;a>=0;--a){var o=i[a];if(o){var h=o._glTextures[n];h.samplerType!==xu.FLOAT&&this.renderer.texture.unbind(o)}}},s.prototype.initTexture=function(t){var e=new I_(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},s.prototype.initTextureType=function(t,e){var i,r;e.internalFormat=(r=(i=this.internalFormats[t.type])===null||i===void 0?void 0:i[t.format])!==null&&r!==void 0?r:t.format,this.webGLVersion===2&&t.type===Ut.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type},s.prototype.updateTexture=function(t){var e=t._glTextures[this.CONTEXT_UID];if(e){var i=this.renderer;if(this.initTextureType(t,e),t.resource&&t.resource.upload(i,t,e))e.samplerType!==xu.FLOAT&&(this.hasIntegerTextures=!0);else{var r=t.realWidth,n=t.realHeight,a=i.gl;(e.width!==r||e.height!==n||e.dirtyId<0)&&(e.width=r,e.height=n,a.texImage2D(t.target,0,e.internalFormat,r,n,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}},s.prototype.destroyTexture=function(t,e){var i=this.gl;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var r=this.managedTextures.indexOf(t);r!==-1&&cu(this.managedTextures,r,1)}},s.prototype.updateTextureStyle=function(t){var e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===Ur.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=qi.CLAMP:e.wrapMode=t.wrapMode,t.resource&&t.resource.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)},s.prototype.setStyle=function(t,e){var i=this.gl;if(e.mipmap&&t.mipmap!==Ur.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===hs.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);var r=this.renderer.context.extensions.anisotropicFiltering;if(r&&t.anisotropicLevel>0&&t.scaleMode===hs.LINEAR){var n=Math.min(t.anisotropicLevel,i.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===hs.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===hs.LINEAR?i.LINEAR:i.NEAREST)},s.prototype.destroy=function(){this.renderer=null},s}(),T_=new wt,NM=function(s){te(t,s);function t(e,i){e===void 0&&(e=Uo.UNKNOWN);var r=s.call(this)||this;return i=Object.assign({},Z.RENDER_OPTIONS,i),r.options=i,r.type=e,r.screen=new et(0,0,i.width,i.height),r.view=i.view||Z.ADAPTER.createCanvas(),r.resolution=i.resolution||Z.RESOLUTION,r.useContextAlpha=i.useContextAlpha,r.autoDensity=!!i.autoDensity,r.preserveDrawingBuffer=i.preserveDrawingBuffer,r.clearBeforeRender=i.clearBeforeRender,r._backgroundColor=0,r._backgroundColorRgba=[0,0,0,1],r._backgroundColorString="#000000",r.backgroundColor=i.backgroundColor||r._backgroundColor,r.backgroundAlpha=i.backgroundAlpha,i.transparent!==void 0&&(ci("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),r.useContextAlpha=i.transparent,r.backgroundAlpha=i.transparent?0:1),r._lastObjectRendered=null,r.plugins={},r}return t.prototype.initPlugins=function(e){for(var i in e)this.plugins[i]=new e[i](this)},Object.defineProperty(t.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),t.prototype.resize=function(e,i){this.view.width=Math.round(e*this.resolution),this.view.height=Math.round(i*this.resolution);var r=this.view.width/this.resolution,n=this.view.height/this.resolution;this.screen.width=r,this.screen.height=n,this.autoDensity&&(this.view.style.width=r+"px",this.view.style.height=n+"px"),this.emit("resize",r,n)},t.prototype.generateTexture=function(e,i,r,n){i===void 0&&(i={}),typeof i=="number"&&(ci("6.1.0","generateTexture options (scaleMode, resolution, region) are now object options."),i={scaleMode:i,resolution:r,region:n});var a=i.region,o=_C(i,["region"]);n=a||e.getLocalBounds(null,!0),n.width===0&&(n.width=1),n.height===0&&(n.height=1);var h=xe.create(_c({width:n.width,height:n.height},o));return T_.tx=-n.x,T_.ty=-n.y,this.render(e,{renderTexture:h,clear:!1,transform:T_,skipUpdateTransform:!!e.parent}),h},t.prototype.destroy=function(e){for(var i in this.plugins)this.plugins[i].destroy(),this.plugins[i]=null;e&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var r=this;r.plugins=null,r.type=Uo.UNKNOWN,r.view=null,r.screen=null,r._tempDisplayObjectParent=null,r.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(t.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=e,this._backgroundColorString=Pp(e),Gu(e,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(e){this._backgroundColorRgba[3]=e},enumerable:!1,configurable:!0}),t}(nh),PM=function(){function s(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}return s}(),bM=function(){function s(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}return s.prototype.destroy=function(){this.renderer=null},s.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},s.prototype.bind=function(t){var e=this,i=e.gl,r=e.CONTEXT_UID,n=t._glBuffers[r]||this.createGLBuffer(t);i.bindBuffer(t.type,n.buffer)},s.prototype.bindBufferBase=function(t,e){var i=this,r=i.gl,n=i.CONTEXT_UID;if(this.boundBufferBases[e]!==t){var a=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,a.buffer)}},s.prototype.bindBufferRange=function(t,e,i){var r=this,n=r.gl,a=r.CONTEXT_UID;i=i||0;var o=t._glBuffers[a]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,o.buffer,i*256,256)},s.prototype.update=function(t){var e=this,i=e.gl,r=e.CONTEXT_UID,n=t._glBuffers[r];if(t._updateID!==n.updateID)if(n.updateID=t._updateID,i.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)i.bufferSubData(t.type,0,t.data);else{var a=t.static?i.STATIC_DRAW:i.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,i.bufferData(t.type,t.data,a)}},s.prototype.dispose=function(t,e){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var i=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),i&&(e||r.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}},s.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedBuffers),i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)},s.prototype.createGLBuffer=function(t){var e=this,i=e.CONTEXT_UID,r=e.gl;return t._glBuffers[i]=new PM(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[i]},s}(),cf=function(s){te(t,s);function t(e){var i=s.call(this,Uo.WEBGL,e)||this;return e=i.options,i.gl=null,i.CONTEXT_UID=0,i.runners={destroy:new ke("destroy"),contextChange:new ke("contextChange"),reset:new ke("reset"),update:new ke("update"),postrender:new ke("postrender"),prerender:new ke("prerender"),resize:new ke("resize")},i.runners.contextChange.add(i),i.globalUniforms=new An({projectionMatrix:new wt},!0),i.addSystem(sM,"mask").addSystem(bC,"context").addSystem(SM,"state").addSystem(pM,"shader").addSystem(MM,"texture").addSystem(bM,"buffer").addSystem(xC,"geometry").addSystem(UC,"framebuffer").addSystem(iM,"scissor").addSystem(rM,"stencil").addSystem(nM,"projection").addSystem(yM,"textureGC").addSystem(NC,"filter").addSystem(aM,"renderTexture").addSystem(PC,"batch"),i.initPlugins(t.__plugins),i.multisample=void 0,e.context?i.context.initFromContext(e.context):i.context.initFromOptions({alpha:!!i.useContextAlpha,antialias:e.antialias,premultipliedAlpha:i.useContextAlpha&&i.useContextAlpha!=="notMultiplied",stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:i.options.powerPreference}),i.renderingToScreen=!0,oS(i.context.webGLVersion===2?"WebGL 2":"WebGL 1"),i.resize(i.options.width,i.options.height),i}return t.create=function(e){if(hS())return new t(e);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},t.prototype.contextChange=function(){var e=this.gl,i;if(this.context.webGLVersion===1){var r=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),i=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,r)}else{var r=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),i=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,r)}i>=oe.HIGH?this.multisample=oe.HIGH:i>=oe.MEDIUM?this.multisample=oe.MEDIUM:i>=oe.LOW?this.multisample=oe.LOW:this.multisample=oe.NONE},t.prototype.addSystem=function(e,i){var r=new e(this);if(this[i])throw new Error('Whoops! The name "'+i+'" is already in use');this[i]=r;for(var n in this.runners)this.runners[n].add(r);return this},t.prototype.render=function(e,i){var r,n,a,o;if(i&&(i instanceof xe?(ci("6.0.0","Renderer#render arguments changed, use options instead."),r=i,n=arguments[2],a=arguments[3],o=arguments[4]):(r=i.renderTexture,n=i.clear,a=i.transform,o=i.skipUpdateTransform)),this.renderingToScreen=!r,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=a,!this.context.isLost){if(r||(this._lastObjectRendered=e),!o){var h=e.enableTempParent();e.updateTransform(),e.disableTempParent(h)}this.renderTexture.bind(r),this.batch.currentRenderer.start(),(n!==void 0?n:this.clearBeforeRender)&&this.renderTexture.clear(),e.render(this),this.batch.currentRenderer.flush(),r&&r.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},t.prototype.generateTexture=function(e,i,r,n){i===void 0&&(i={});var a=s.prototype.generateTexture.call(this,e,i,r,n);return this.framebuffer.blit(),a},t.prototype.resize=function(e,i){s.prototype.resize.call(this,e,i),this.runners.resize.emit(this.screen.height,this.screen.width)},t.prototype.reset=function(){return this.runners.reset.emit(),this},t.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},t.prototype.destroy=function(e){this.runners.destroy.emit();for(var i in this.runners)this.runners[i].destroy();s.prototype.destroy.call(this,e),this.gl=null},Object.defineProperty(t.prototype,"extract",{get:function(){return ci("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),t.registerPlugin=function(e,i){ci("6.5.0","Renderer.registerPlugin() has been deprecated, please use extensions.add() instead."),er.add({name:e,type:ve.RendererPlugin,ref:i})},t.__plugins={},t}(NM);er.handleByMap(ve.RendererPlugin,cf.__plugins);function DM(s){return cf.create(s)}var LM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,UM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,xM=LM,FM=UM,dc=function(){function s(){this.texArray=null,this.blend=0,this.type=oi.TRIANGLES,this.start=0,this.size=0,this.data=null}return s}(),fc=function(){function s(){this.elements=[],this.ids=[],this.count=0}return s.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0},s}(),wM=function(){function s(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(s.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),s.prototype.view=function(t){return this[t+"View"]},s.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},s.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},s}(),GM=function(s){te(t,s);function t(e){var i=s.call(this,e)||this;return i.shaderGenerator=null,i.geometryClass=null,i.vertexSize=null,i.state=ah.for2d(),i.size=Z.SPRITE_BATCH_SIZE*4,i._vertexCount=0,i._indexCount=0,i._bufferedElements=[],i._bufferedTextures=[],i._bufferSize=0,i._shader=null,i._packedGeometries=[],i._packedGeometryPoolSize=2,i._flushId=0,i._aBuffers={},i._iBuffers={},i.MAX_TEXTURES=1,i.renderer.on("prerender",i.onPrerender,i),e.runners.contextChange.add(i),i._dcIndex=0,i._aIndex=0,i._iIndex=0,i._attributeBuffer=null,i._indexBuffer=null,i._tempBoundTextures=[],i}return t.prototype.contextChange=function(){var e=this.renderer.gl;Z.PREFER_ENV===Ji.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),Z.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=WC(this.MAX_TEXTURES,e)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]=new this.geometryClass;this.initFlushBuffers()},t.prototype.initFlushBuffers=function(){for(var e=t._drawCallPool,i=t._textureArrayPool,r=this.size/4,n=Math.floor(r/this.MAX_TEXTURES)+1;e.length<r;)e.push(new dc);for(;i.length<n;)i.push(new fc);for(var a=0;a<this.MAX_TEXTURES;a++)this._tempBoundTextures[a]=null},t.prototype.onPrerender=function(){this._flushId=0},t.prototype.render=function(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)},t.prototype.buildTexturesAndDrawCalls=function(){var e=this,i=e._bufferedTextures,r=e.MAX_TEXTURES,n=t._textureArrayPool,a=this.renderer.batch,o=this._tempBoundTextures,h=this.renderer.textureGC.count,u=++Yt._globalBatch,c=0,l=n[0],_=0;a.copyBoundTextures(o,r);for(var d=0;d<this._bufferSize;++d){var g=i[d];i[d]=null,g._batchEnabled!==u&&(l.count>=r&&(a.boundArray(l,o,u,r),this.buildDrawCalls(l,_,d),_=d,l=n[++c],++u),g._batchEnabled=u,g.touched=h,l.elements[l.count++]=g)}l.count>0&&(a.boundArray(l,o,u,r),this.buildDrawCalls(l,_,this._bufferSize),++c,++u);for(var d=0;d<o.length;d++)o[d]=null;Yt._globalBatch=u},t.prototype.buildDrawCalls=function(e,i,r){var n=this,a=n._bufferedElements,o=n._attributeBuffer,h=n._indexBuffer,u=n.vertexSize,c=t._drawCallPool,l=this._dcIndex,_=this._aIndex,d=this._iIndex,g=c[l];g.start=this._iIndex,g.texArray=e;for(var m=i;m<r;++m){var p=a[m],T=p._texture.baseTexture,A=bp[T.alphaMode?1:0][p.blendMode];a[m]=null,i<m&&g.blend!==A&&(g.size=d-g.start,i=m,g=c[++l],g.texArray=e,g.start=d),this.packInterleavedGeometry(p,o,h,_,d),_+=p.vertexData.length/2*u,d+=p.indices.length,g.blend=A}i<r&&(g.size=d-g.start,++l),this._dcIndex=l,this._aIndex=_,this._iIndex=d},t.prototype.bindAndClearTexArray=function(e){for(var i=this.renderer.texture,r=0;r<e.count;r++)i.bind(e.elements[r],e.ids[r]),e.elements[r]=null;e.count=0},t.prototype.updateGeometry=function(){var e=this,i=e._packedGeometries,r=e._attributeBuffer,n=e._indexBuffer;Z.CAN_UPLOAD_SAME_BUFFER?(i[this._flushId]._buffer.update(r.rawBinaryData),i[this._flushId]._indexBuffer.update(n),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,i[this._flushId]=new this.geometryClass),i[this._flushId]._buffer.update(r.rawBinaryData),i[this._flushId]._indexBuffer.update(n),this.renderer.geometry.bind(i[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},t.prototype.drawBatches=function(){for(var e=this._dcIndex,i=this.renderer,r=i.gl,n=i.state,a=t._drawCallPool,o=null,h=0;h<e;h++){var u=a[h],c=u.texArray,l=u.type,_=u.size,d=u.start,g=u.blend;o!==c&&(o=c,this.bindAndClearTexArray(c)),this.state.blendMode=g,n.set(this.state),r.drawElements(l,_,r.UNSIGNED_SHORT,d*2)}},t.prototype.flush=function(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},t.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),Z.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},t.prototype.stop=function(){this.flush()},t.prototype.destroy=function(){for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),s.prototype.destroy.call(this)},t.prototype.getAttributeBuffer=function(e){var i=Bu(Math.ceil(e/8)),r=wg(i),n=i*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);var a=this._aBuffers[n];return a||(this._aBuffers[n]=a=new wM(n*this.vertexSize*4)),a},t.prototype.getIndexBuffer=function(e){var i=Bu(Math.ceil(e/12)),r=wg(i),n=i*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);var a=this._iBuffers[r];return a||(this._iBuffers[r]=a=new Uint16Array(n)),a},t.prototype.packInterleavedGeometry=function(e,i,r,n,a){for(var o=i.uint32View,h=i.float32View,u=n/this.vertexSize,c=e.uvs,l=e.indices,_=e.vertexData,d=e._texture.baseTexture._batchLocation,g=Math.min(e.worldAlpha,1),m=g<1&&e._texture.baseTexture.alphaMode?Dp(e._tintRGB,g):e._tintRGB+(g*255<<24),p=0;p<_.length;p+=2)h[n++]=_[p],h[n++]=_[p+1],h[n++]=c[p],h[n++]=c[p+1],o[n++]=m,h[n++]=d;for(var p=0;p<l.length;p++)r[a++]=u+l[p]},t._drawCallPool=[],t._textureArrayPool=[],t}(Tl),BM=function(){function s(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return s.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),i=0;i<t;i++)e[i]=i;this.defaultGroupCache[t]=An.from({uSamplers:e},!0);var r=this.fragTemplate;r=r.replace(/%count%/gi,""+t),r=r.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Rl(this.vertexSrc,r)}var n={tint:new Float32Array([1,1,1,1]),translationMatrix:new wt,default:this.defaultGroupCache[t]};return new vn(this.programCache[t],n)},s.prototype.generateSampleSrc=function(t){var e="";e+=`
`,e+=`
`;for(var i=0;i<t;i++)i>0&&(e+=`
else `),i<t-1&&(e+="if(vTextureId < "+i+".5)"),e+=`
{`,e+=`
	color = texture2D(uSamplers[`+i+"], vTextureCoord);",e+=`
}`;return e+=`
`,e+=`
`,e},s}(),qp=function(s){te(t,s);function t(e){e===void 0&&(e=!1);var i=s.call(this)||this;return i._buffer=new ts(null,e,!1),i._indexBuffer=new ts(null,e,!0),i.addAttribute("aVertexPosition",i._buffer,2,!1,Ut.FLOAT).addAttribute("aTextureCoord",i._buffer,2,!1,Ut.FLOAT).addAttribute("aColor",i._buffer,4,!0,Ut.UNSIGNED_BYTE).addAttribute("aTextureId",i._buffer,1,!0,Ut.FLOAT).addIndex(i._indexBuffer),i}return t}(Il),$g=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,tE=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,HM=function(){function s(){}return s.create=function(t){var e=Object.assign({vertex:$g,fragment:tE,geometryClass:qp,vertexSize:6},t),i=e.vertex,r=e.fragment,n=e.vertexSize,a=e.geometryClass;return function(o){te(h,o);function h(u){var c=o.call(this,u)||this;return c.shaderGenerator=new BM(i,r),c.geometryClass=a,c.vertexSize=n,c}return h}(GM)},Object.defineProperty(s,"defaultVertexSrc",{get:function(){return $g},enumerable:!1,configurable:!0}),Object.defineProperty(s,"defaultFragmentTemplate",{get:function(){return tE},enumerable:!1,configurable:!0}),s}(),Zp=HM.create();Object.assign(Zp,{extension:{name:"batch",type:ve.RendererPlugin}});/*!
 * @pixi/loaders - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/loaders is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Jh=function(){function s(t,e,i){e===void 0&&(e=!1),this._fn=t,this._once=e,this._thisArg=i,this._next=this._prev=this._owner=null}return s.prototype.detach=function(){return this._owner===null?!1:(this._owner.detach(this),!0)},s}();function eE(s,t){return s._head?(s._tail._next=t,t._prev=s._tail,s._tail=t):(s._head=t,s._tail=t),t._owner=s,t}var Gi=function(){function s(){this._head=this._tail=void 0}return s.prototype.handlers=function(t){t===void 0&&(t=!1);var e=this._head;if(t)return!!e;for(var i=[];e;)i.push(e),e=e._next;return i},s.prototype.has=function(t){if(!(t instanceof Jh))throw new Error("MiniSignal#has(): First arg must be a SignalBinding object.");return t._owner===this},s.prototype.dispatch=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];var r=this._head;if(!r)return!1;for(;r;)r._once&&this.detach(r),r._fn.apply(r._thisArg,e),r=r._next;return!0},s.prototype.add=function(t,e){if(e===void 0&&(e=null),typeof t!="function")throw new Error("MiniSignal#add(): First arg must be a Function.");return eE(this,new Jh(t,!1,e))},s.prototype.once=function(t,e){if(e===void 0&&(e=null),typeof t!="function")throw new Error("MiniSignal#once(): First arg must be a Function.");return eE(this,new Jh(t,!0,e))},s.prototype.detach=function(t){if(!(t instanceof Jh))throw new Error("MiniSignal#detach(): First arg must be a SignalBinding object.");return t._owner!==this?this:(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,t._next===null&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null,this)},s.prototype.detachAll=function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this},s}();function Qp(s,t){t=t||{};for(var e={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},i=e.parser[t.strictMode?"strict":"loose"].exec(s),r={},n=14;n--;)r[e.key[n]]=i[n]||"";return r[e.q.name]={},r[e.key[12]].replace(e.q.parser,function(a,o,h){o&&(r[e.q.name][o]=h)}),r}var R_,$h=null,VM=0,sE=200,kM=204,jM=1223,zM=2;function iE(){}function rE(s,t,e){t&&t.indexOf(".")===0&&(t=t.substring(1)),t&&(s[t]=e)}function O_(s){return s.toString().replace("object ","")}var os=function(){function s(t,e,i){if(this._dequeue=iE,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=null,this._boundOnError=null,this._boundOnProgress=null,this._boundOnTimeout=null,this._boundXhrOnError=null,this._boundXhrOnTimeout=null,this._boundXhrOnAbort=null,this._boundXhrOnLoad=null,typeof t!="string"||typeof e!="string")throw new Error("Both name and url are required for constructing a resource.");i=i||{},this._flags=0,this._setFlag(s.STATUS_FLAGS.DATA_URL,e.indexOf("data:")===0),this.name=t,this.url=e,this.extension=this._getExtension(),this.data=null,this.crossOrigin=i.crossOrigin===!0?"anonymous":i.crossOrigin,this.timeout=i.timeout||0,this.loadType=i.loadType||this._determineLoadType(),this.xhrType=i.xhrType,this.metadata=i.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=s.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=iE,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new Gi,this.onProgress=new Gi,this.onComplete=new Gi,this.onAfterMiddleware=new Gi}return s.setExtensionLoadType=function(t,e){rE(s._loadTypeMap,t,e)},s.setExtensionXhrType=function(t,e){rE(s._xhrTypeMap,t,e)},Object.defineProperty(s.prototype,"isDataUrl",{get:function(){return this._hasFlag(s.STATUS_FLAGS.DATA_URL)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isComplete",{get:function(){return this._hasFlag(s.STATUS_FLAGS.COMPLETE)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isLoading",{get:function(){return this._hasFlag(s.STATUS_FLAGS.LOADING)},enumerable:!1,configurable:!0}),s.prototype.complete=function(){this._clearEvents(),this._finish()},s.prototype.abort=function(t){if(!this.error){if(this.error=new Error(t),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=s.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},s.prototype.load=function(t){var e=this;if(!this.isLoading){if(this.isComplete){t&&setTimeout(function(){return t(e)},1);return}else t&&this.onComplete.once(t);switch(this._setFlag(s.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),(this.crossOrigin===!1||typeof this.crossOrigin!="string")&&(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case s.LOAD_TYPE.IMAGE:this.type=s.TYPE.IMAGE,this._loadElement("image");break;case s.LOAD_TYPE.AUDIO:this.type=s.TYPE.AUDIO,this._loadSourceElement("audio");break;case s.LOAD_TYPE.VIDEO:this.type=s.TYPE.VIDEO,this._loadSourceElement("video");break;case s.LOAD_TYPE.XHR:default:typeof R_>"u"&&(R_=!!(globalThis.XDomainRequest&&!("withCredentials"in new XMLHttpRequest))),R_&&this.crossOrigin?this._loadXdr():this._loadXhr();break}}},s.prototype._hasFlag=function(t){return(this._flags&t)!==0},s.prototype._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},s.prototype._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},s.prototype._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(s.STATUS_FLAGS.COMPLETE,!0),this._setFlag(s.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},s.prototype._loadElement=function(t){this.metadata.loadElement?this.data=this.metadata.loadElement:t==="image"&&typeof globalThis.Image<"u"?this.data=new Image:this.data=document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},s.prototype._loadSourceElement=function(t){if(this.metadata.loadElement?this.data=this.metadata.loadElement:t==="audio"&&typeof globalThis.Audio<"u"?this.data=new Audio:this.data=document.createElement(t),this.data===null){this.abort("Unsupported element: "+t);return}if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,i=0;i<this.url.length;++i)this.data.appendChild(this._createSource(t,this.url[i],Array.isArray(e)?e[i]:e));else{var e=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(e)?e[0]:e))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},s.prototype._loadXhr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XMLHttpRequest;this.crossOrigin==="use-credentials"&&(t.withCredentials=!0),t.open("GET",this.url,!0),t.timeout=this.timeout,this.xhrType===s.XHR_RESPONSE_TYPE.JSON||this.xhrType===s.XHR_RESPONSE_TYPE.DOCUMENT?t.responseType=s.XHR_RESPONSE_TYPE.TEXT:t.responseType=this.xhrType,t.addEventListener("error",this._boundXhrOnError,!1),t.addEventListener("timeout",this._boundXhrOnTimeout,!1),t.addEventListener("abort",this._boundXhrOnAbort,!1),t.addEventListener("progress",this._boundOnProgress,!1),t.addEventListener("load",this._boundXhrOnLoad,!1),t.send()},s.prototype._loadXdr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var t=this.xhr=new globalThis.XDomainRequest;t.timeout=this.timeout||5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXhrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout(function(){return t.send()},1)},s.prototype._createSource=function(t,e,i){i||(i=t+"/"+this._getExtension(e));var r=document.createElement("source");return r.src=e,r.type=i,r},s.prototype._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},s.prototype._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},s.prototype._onTimeout=function(){this.abort("Load timed out.")},s.prototype._xhrOnError=function(){var t=this.xhr;this.abort(O_(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},s.prototype._xhrOnTimeout=function(){var t=this.xhr;this.abort(O_(t)+" Request timed out.")},s.prototype._xhrOnAbort=function(){var t=this.xhr;this.abort(O_(t)+" Request was aborted by the user.")},s.prototype._xhrOnLoad=function(){var t=this.xhr,e="",i=typeof t.status>"u"?sE:t.status;(t.responseType===""||t.responseType==="text"||typeof t.responseType>"u")&&(e=t.responseText),i===VM&&(e.length>0||t.responseType===s.XHR_RESPONSE_TYPE.BUFFER)?i=sE:i===jM&&(i=kM);var r=i/100|0;if(r===zM)if(this.xhrType===s.XHR_RESPONSE_TYPE.TEXT)this.data=e,this.type=s.TYPE.TEXT;else if(this.xhrType===s.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(e),this.type=s.TYPE.JSON}catch(o){this.abort("Error trying to parse loaded json: "+o);return}else if(this.xhrType===s.XHR_RESPONSE_TYPE.DOCUMENT)try{if(globalThis.DOMParser){var n=new DOMParser;this.data=n.parseFromString(e,"text/xml")}else{var a=document.createElement("div");a.innerHTML=e,this.data=a}this.type=s.TYPE.XML}catch(o){this.abort("Error trying to parse loaded xml: "+o);return}else this.data=t.response||e;else{this.abort("["+t.status+"] "+t.statusText+": "+t.responseURL);return}this.complete()},s.prototype._determineCrossOrigin=function(t,e){if(t.indexOf("data:")===0)return"";if(globalThis.origin!==globalThis.location.origin)return"anonymous";e=e||globalThis.location,$h||($h=document.createElement("a")),$h.href=t;var i=Qp($h.href,{strictMode:!0}),r=!i.port&&e.port===""||i.port===e.port,n=i.protocol?i.protocol+":":"";return i.host!==e.hostname||!r||n!==e.protocol?"anonymous":""},s.prototype._determineXhrType=function(){return s._xhrTypeMap[this.extension]||s.XHR_RESPONSE_TYPE.TEXT},s.prototype._determineLoadType=function(){return s._loadTypeMap[this.extension]||s.LOAD_TYPE.XHR},s.prototype._getExtension=function(t){t===void 0&&(t=this.url);var e="";if(this.isDataUrl){var i=t.indexOf("/");e=t.substring(i+1,t.indexOf(";",i))}else{var r=t.indexOf("?"),n=t.indexOf("#"),a=Math.min(r>-1?r:t.length,n>-1?n:t.length);t=t.substring(0,a),e=t.substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},s.prototype._getMimeFromXhrType=function(t){switch(t){case s.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case s.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case s.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case s.XHR_RESPONSE_TYPE.JSON:return"application/json";case s.XHR_RESPONSE_TYPE.DEFAULT:case s.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},s}();(function(s){(function(t){t[t.NONE=0]="NONE",t[t.DATA_URL=1]="DATA_URL",t[t.COMPLETE=2]="COMPLETE",t[t.LOADING=4]="LOADING"})(s.STATUS_FLAGS||(s.STATUS_FLAGS={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.JSON=1]="JSON",t[t.XML=2]="XML",t[t.IMAGE=3]="IMAGE",t[t.AUDIO=4]="AUDIO",t[t.VIDEO=5]="VIDEO",t[t.TEXT=6]="TEXT"}(s.TYPE||(s.TYPE={})),function(t){t[t.XHR=1]="XHR",t[t.IMAGE=2]="IMAGE",t[t.AUDIO=3]="AUDIO",t[t.VIDEO=4]="VIDEO"}(s.LOAD_TYPE||(s.LOAD_TYPE={})),function(t){t.DEFAULT="text",t.BUFFER="arraybuffer",t.BLOB="blob",t.DOCUMENT="document",t.JSON="json",t.TEXT="text"}(s.XHR_RESPONSE_TYPE||(s.XHR_RESPONSE_TYPE={})),s._loadTypeMap={gif:s.LOAD_TYPE.IMAGE,png:s.LOAD_TYPE.IMAGE,bmp:s.LOAD_TYPE.IMAGE,jpg:s.LOAD_TYPE.IMAGE,jpeg:s.LOAD_TYPE.IMAGE,tif:s.LOAD_TYPE.IMAGE,tiff:s.LOAD_TYPE.IMAGE,webp:s.LOAD_TYPE.IMAGE,tga:s.LOAD_TYPE.IMAGE,avif:s.LOAD_TYPE.IMAGE,svg:s.LOAD_TYPE.IMAGE,"svg+xml":s.LOAD_TYPE.IMAGE,mp3:s.LOAD_TYPE.AUDIO,ogg:s.LOAD_TYPE.AUDIO,wav:s.LOAD_TYPE.AUDIO,mp4:s.LOAD_TYPE.VIDEO,webm:s.LOAD_TYPE.VIDEO},s._xhrTypeMap={xhtml:s.XHR_RESPONSE_TYPE.DOCUMENT,html:s.XHR_RESPONSE_TYPE.DOCUMENT,htm:s.XHR_RESPONSE_TYPE.DOCUMENT,xml:s.XHR_RESPONSE_TYPE.DOCUMENT,tmx:s.XHR_RESPONSE_TYPE.DOCUMENT,svg:s.XHR_RESPONSE_TYPE.DOCUMENT,tsx:s.XHR_RESPONSE_TYPE.DOCUMENT,gif:s.XHR_RESPONSE_TYPE.BLOB,png:s.XHR_RESPONSE_TYPE.BLOB,bmp:s.XHR_RESPONSE_TYPE.BLOB,jpg:s.XHR_RESPONSE_TYPE.BLOB,jpeg:s.XHR_RESPONSE_TYPE.BLOB,tif:s.XHR_RESPONSE_TYPE.BLOB,tiff:s.XHR_RESPONSE_TYPE.BLOB,webp:s.XHR_RESPONSE_TYPE.BLOB,tga:s.XHR_RESPONSE_TYPE.BLOB,avif:s.XHR_RESPONSE_TYPE.BLOB,json:s.XHR_RESPONSE_TYPE.JSON,text:s.XHR_RESPONSE_TYPE.TEXT,txt:s.XHR_RESPONSE_TYPE.TEXT,ttf:s.XHR_RESPONSE_TYPE.BUFFER,otf:s.XHR_RESPONSE_TYPE.BUFFER},s.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="})(os||(os={}));function Zr(){}function YM(s){return function(){for(var e=arguments,i=[],r=0;r<arguments.length;r++)i[r]=e[r];if(s===null)throw new Error("Callback was already called.");var n=s;s=null,n.apply(this,i)}}var WM=function(){function s(t,e){this.data=t,this.callback=e}return s}(),A_=function(){function s(t,e){var i=this;if(e===void 0&&(e=1),this.workers=0,this.saturated=Zr,this.unsaturated=Zr,this.empty=Zr,this.drain=Zr,this.error=Zr,this.started=!1,this.paused=!1,this._tasks=[],this._insert=function(r,n,a){if(a&&typeof a!="function")throw new Error("task callback must be a function");if(i.started=!0,r==null&&i.idle()){setTimeout(function(){return i.drain()},1);return}var o=new WM(r,typeof a=="function"?a:Zr);n?i._tasks.unshift(o):i._tasks.push(o),setTimeout(i.process,1)},this.process=function(){for(;!i.paused&&i.workers<i.concurrency&&i._tasks.length;){var r=i._tasks.shift();i._tasks.length===0&&i.empty(),i.workers+=1,i.workers===i.concurrency&&i.saturated(),i._worker(r.data,YM(i._next(r)))}},this._worker=t,e===0)throw new Error("Concurrency must not be zero");this.concurrency=e,this.buffer=e/4}return s.prototype._next=function(t){var e=this;return function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];e.workers-=1,t.callback.apply(t,r),r[0]!=null&&e.error(r[0],t.data),e.workers<=e.concurrency-e.buffer&&e.unsaturated(),e.idle()&&e.drain(),e.process()}},s.prototype.push=function(t,e){this._insert(t,!1,e)},s.prototype.kill=function(){this.workers=0,this.drain=Zr,this.started=!1,this._tasks=[]},s.prototype.unshift=function(t,e){this._insert(t,!0,e)},s.prototype.length=function(){return this._tasks.length},s.prototype.running=function(){return this.workers},s.prototype.idle=function(){return this._tasks.length+this.workers===0},s.prototype.pause=function(){this.paused!==!0&&(this.paused=!0)},s.prototype.resume=function(){if(this.paused!==!1){this.paused=!1;for(var t=1;t<=this.concurrency;t++)this.process()}},s.eachSeries=function(t,e,i,r){var n=0,a=t.length;function o(h){if(h||n===a){i&&i(h);return}r?setTimeout(function(){e(t[n++],o)},1):e(t[n++],o)}o()},s.queue=function(t,e){return new s(t,e)},s}(),v_=100,XM=/(#[\w-]+)?$/,Hu=function(){function s(t,e){var i=this;t===void 0&&(t=""),e===void 0&&(e=10),this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(h,u){return i._loadResource(h,u)},this.resources={},this.baseUrl=t,this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(h,u){return i._loadResource(h,u)},this._queue=A_.queue(this._boundLoadResource,e),this._queue.pause(),this.resources={},this.onProgress=new Gi,this.onError=new Gi,this.onLoad=new Gi,this.onStart=new Gi,this.onComplete=new Gi;for(var r=0;r<s._plugins.length;++r){var n=s._plugins[r],a=n.pre,o=n.use;a&&this.pre(a),o&&this.use(o)}this._protected=!1}return s.prototype._add=function(t,e,i,r){if(this.loading&&(!i||!i.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(e=this._prepareUrl(e),this.resources[t]=new os(t,e,i),typeof r=="function"&&this.resources[t].onAfterMiddleware.once(r),this.loading){for(var n=i.parentResource,a=[],o=0;o<n.children.length;++o)n.children[o].isComplete||a.push(n.children[o]);var h=n.progressChunk*(a.length+1),u=h/(a.length+2);n.children.push(this.resources[t]),n.progressChunk=u;for(var o=0;o<a.length;++o)a[o].progressChunk=u;this.resources[t].progressChunk=u}return this._queue.push(this.resources[t]),this},s.prototype.pre=function(t){return this._beforeMiddleware.push(t),this},s.prototype.use=function(t){return this._afterMiddleware.push(t),this},s.prototype.reset=function(){this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause();for(var t in this.resources){var e=this.resources[t];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort("loader reset")}return this.resources={},this},s.prototype.load=function(t){if(ci("6.5.0","@pixi/loaders is being replaced with @pixi/assets in the next major release."),typeof t=="function"&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=this._queue._tasks.length,i=v_/e,r=0;r<this._queue._tasks.length;++r)this._queue._tasks[r].data.progressChunk=i;this._onStart(),this._queue.resume()}return this},Object.defineProperty(s.prototype,"concurrency",{get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t},enumerable:!1,configurable:!0}),s.prototype._prepareUrl=function(t){var e=Qp(t,{strictMode:!0}),i;if(e.protocol||!e.path||t.indexOf("//")===0?i=t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&t.charAt(0)!=="/"?i=this.baseUrl+"/"+t:i=this.baseUrl+t,this.defaultQueryString){var r=XM.exec(i)[0];i=i.slice(0,i.length-r.length),i.indexOf("?")!==-1?i+="&"+this.defaultQueryString:i+="?"+this.defaultQueryString,i+=r}return i},s.prototype._loadResource=function(t,e){var i=this;t._dequeue=e,A_.eachSeries(this._beforeMiddleware,function(r,n){r.call(i,t,function(){n(t.isComplete?{}:null)})},function(){t.isComplete?i._onLoad(t):(t._onLoadBinding=t.onComplete.once(i._onLoad,i),t.load())},!0)},s.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},s.prototype._onComplete=function(){this.progress=v_,this.loading=!1,this.onComplete.dispatch(this,this.resources)},s.prototype._onLoad=function(t){var e=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),A_.eachSeries(this._afterMiddleware,function(i,r){i.call(e,t,r)},function(){t.onAfterMiddleware.dispatch(t),e.progress=Math.min(v_,e.progress+t.progressChunk),e.onProgress.dispatch(e,t),t.error?e.onError.dispatch(t.error,e,t):e.onLoad.dispatch(e,t),e._resourcesParsing.splice(e._resourcesParsing.indexOf(t),1),e._queue.idle()&&e._resourcesParsing.length===0&&e._onComplete()},!0)},s.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(s,"shared",{get:function(){var t=s._shared;return t||(t=new s,t._protected=!0,s._shared=t),t},enumerable:!1,configurable:!0}),s.registerPlugin=function(t){return ci("6.5.0","Loader.registerPlugin() is deprecated, use extensions.add() instead."),er.add({type:ve.Loader,ref:t}),s},s._plugins=[],s}();er.handleByList(ve.Loader,Hu._plugins);Hu.prototype.add=function(t,e,i,r){if(Array.isArray(t)){for(var n=0;n<t.length;++n)this.add(t[n]);return this}if(typeof t=="object"&&(i=t,r=e||i.callback||i.onComplete,e=i.url,t=i.name||i.key||i.url),typeof e!="string"&&(r=i,i=e,e=t),typeof e!="string")throw new Error("No url passed to add resource to loader.");return typeof i=="function"&&(r=i,i=null),this._add(t,e,i,r)};var KM=function(){function s(){}return s.init=function(t){t=Object.assign({sharedLoader:!1},t),this.loader=t.sharedLoader?Hu.shared:new Hu},s.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},s.extension=ve.Application,s}(),qM=function(){function s(){}return s.add=function(){os.setExtensionLoadType("svg",os.LOAD_TYPE.XHR),os.setExtensionXhrType("svg",os.XHR_RESPONSE_TYPE.TEXT)},s.use=function(t,e){if(t.data&&(t.type===os.TYPE.IMAGE||t.extension==="svg")){var i=t.data,r=t.url,n=t.name,a=t.metadata;ut.fromLoader(i,r,n,a).then(function(o){t.texture=o,e()}).catch(e)}else e()},s.extension=ve.Loader,s}(),ZM="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function QM(s){for(var t="",e=0;e<s.length;){for(var i=[0,0,0],r=[0,0,0,0],n=0;n<i.length;++n)e<s.length?i[n]=s.charCodeAt(e++)&255:i[n]=0;r[0]=i[0]>>2,r[1]=(i[0]&3)<<4|i[1]>>4,r[2]=(i[1]&15)<<2|i[2]>>6,r[3]=i[2]&63;var a=e-(s.length-1);switch(a){case 2:r[3]=64,r[2]=64;break;case 1:r[3]=64;break}for(var n=0;n<r.length;++n)t+=ZM.charAt(r[n])}return t}function JM(s,t){if(!s.data){t();return}if(s.xhr&&s.xhrType===os.XHR_RESPONSE_TYPE.BLOB){if(!self.Blob||typeof s.data=="string"){var e=s.xhr.getResponseHeader("content-type");if(e&&e.indexOf("image")===0){s.data=new Image,s.data.src="data:"+e+";base64,"+QM(s.xhr.responseText),s.type=os.TYPE.IMAGE,s.data.onload=function(){s.data.onload=null,t()};return}}else if(s.data.type.indexOf("image")===0){var i=globalThis.URL||globalThis.webkitURL,r=i.createObjectURL(s.data);s.blob=s.data,s.data=new Image,s.data.src=r,s.type=os.TYPE.IMAGE,s.data.onload=function(){i.revokeObjectURL(r),s.data.onload=null,t()};return}}t()}var $M=function(){function s(){}return s.extension=ve.Loader,s.use=JM,s}();er.add(qM,$M);/*!
 * @pixi/spritesheet - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/spritesheet is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var df=function(){function s(t,e,i){i===void 0&&(i=null),this.linkedSheets=[],this._texture=t instanceof ut?t:null,this.baseTexture=t instanceof Yt?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;var r=this.baseTexture.resource;this.resolution=this._updateResolution(i||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return s.prototype._updateResolution=function(t){t===void 0&&(t=null);var e=this.data.meta.scale,i=oc(t,null);return i===null&&(i=e!==void 0?parseFloat(e):1),i!==1&&this.baseTexture.setResolution(i),i},s.prototype.parse=function(t){var e=this;return t&&ci("6.5.0","Spritesheet.parse callback is deprecated, use the return Promise instead."),new Promise(function(i){e._callback=function(r){t==null||t(r),i(r)},e._batchIndex=0,e._frameKeys.length<=s.BATCH_SIZE?(e._processFrames(0),e._processAnimations(),e._parseComplete()):e._nextBatch()})},s.prototype._processFrames=function(t){for(var e=t,i=s.BATCH_SIZE;e-t<i&&e<this._frameKeys.length;){var r=this._frameKeys[e],n=this._frames[r],a=n.frame;if(a){var o=null,h=null,u=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,c=new et(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);n.rotated?o=new et(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):o=new et(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(h=new et(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[r]=new ut(this.baseTexture,o,c,h,n.rotated?2:0,n.anchor),ut.addToCache(this.textures[r],r)}e++}},s.prototype._processAnimations=function(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];for(var i=0;i<t[e].length;i++){var r=t[e][i];this.animations[e].push(this.textures[r])}}},s.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},s.prototype._nextBatch=function(){var t=this;this._processFrames(this._batchIndex*s.BATCH_SIZE),this._batchIndex++,setTimeout(function(){t._batchIndex*s.BATCH_SIZE<t._frameKeys.length?t._nextBatch():(t._processAnimations(),t._parseComplete())},0)},s.prototype.destroy=function(t){var e;t===void 0&&(t=!1);for(var i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)===null||e===void 0||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]},s.BATCH_SIZE=1e3,s}(),tN=function(){function s(){}return s.use=function(t,e){var i,r,n=this,a=t.name+"_image";if(!t.data||t.type!==os.TYPE.JSON||!t.data.frames||n.resources[a]){e();return}var o=(r=(i=t.data)===null||i===void 0?void 0:i.meta)===null||r===void 0?void 0:r.related_multi_packs;if(Array.isArray(o))for(var h=function(g){if(typeof g!="string")return"continue";var m=g.replace(".json",""),p=ao.resolve(t.url.replace(n.baseUrl,""),g);if(n.resources[m]||Object.values(n.resources).some(function(A){return ao.format(ao.parse(A.url))===p}))return"continue";var T={crossOrigin:t.crossOrigin,loadType:os.LOAD_TYPE.XHR,xhrType:os.XHR_RESPONSE_TYPE.JSON,parentResource:t,metadata:t.metadata};n.add(m,p,T)},u=0,c=o;u<c.length;u++){var l=c[u];h(l)}var _={crossOrigin:t.crossOrigin,metadata:t.metadata.imageMetadata,parentResource:t},d=s.getResourcePath(t,n.baseUrl);n.add(a,d,_,function(m){if(m.error){e(m.error);return}var p=new df(m.texture,t.data,t.url);p.parse().then(function(){t.spritesheet=p,t.textures=p.textures,e()})})},s.getResourcePath=function(t,e){return t.isDataUrl?t.data.meta.image:ao.resolve(t.url.replace(e,""),t.data.meta.image)},s.extension=ve.Loader,s}();class Y{static log(...t){this.LOG_DEBUG&&console.log(this.logPrefix(),...t)}static warn(...t){this.LOG_WARN&&console.warn(this.logPrefix(),...t)}static error(...t){this.LOG_ERROR&&console.error(this.logPrefix(),...t)}static events(...t){this.LOG_EVENTS&&console.log(this.logPrefix(),...t)}static packets(...t){this.LOG_PACKETS&&console.log(this.logPrefix(),...t)}static logPrefix(){return"[Nitro]"}}Y.LOG_DEBUG=!1;Y.LOG_WARN=!1;Y.LOG_ERROR=!1;Y.LOG_EVENTS=!1;Y.LOG_PACKETS=!1;class Ee{constructor(t=null){if(this._length=0,this._dictionary=new Map,this._array=[],this._keys=[],t)for(const[e,i]of t.entries())this.add(e,i)}get length(){return this._length}get disposed(){return!this._dictionary}dispose(){if(!this._dictionary){for(const t of this._dictionary.keys())this._dictionary.delete(t);this._dictionary=null}this._length=0,this._array=null,this._keys=null}reset(){for(const t of this._dictionary.keys())this._dictionary.delete(t);this._length=0,this._array=[],this._keys=[]}unshift(t,e){return this._dictionary.get(t)!==null?!1:(this._dictionary.set(t,e),this._array.unshift(e),this._keys.unshift(t),this._length++,!0)}add(t,e){return this._dictionary.get(t)!==void 0?!1:(this._dictionary.set(t,e),this._array[this._length]=e,this._keys[this._length]=t,this._length++,!0)}remove(t){const e=this._dictionary.get(t);if(!e)return null;const i=this._array.indexOf(e);return i>=0&&(this._array.splice(i,1),this._keys.splice(i,1),this._length--),this._dictionary.delete(t),e}getWithIndex(t){return t<0||t>=this._length?null:this._array[t]}getKey(t){return t<0||t>=this._length?null:this._keys[t]}getKeys(){return this._keys.slice()}hasKey(t){return this._keys.indexOf(t)>-1}getValue(t){return this._dictionary.get(t)}getValues(){return this._array.slice()}hasValue(t){return this._array.indexOf(t)>-1}indexOf(t){return this._array.indexOf(t)}concatenate(t){for(const e of t._keys)this.add(e,t.getValue(e))}clone(){const t=new Ee;return t.concatenate(this),t}}const Jp=s=>{let t="";const e=new Uint8Array(s),i=e.byteLength;for(let r=0;r<i;r++)t+=String.fromCharCode(e[r]);return window.btoa(t)};class Ol{constructor(t){this._position=0,this._dataView=new DataView(t)}readBytes(t){const e=new Ol(this._dataView.buffer.slice(this._position,this._position+t));return this._position+=t,e}readByte(){const t=this._dataView.getInt8(this._position);return this._position++,t}readShort(){const t=this._dataView.getInt16(this._position);return this._position+=2,t}readInt(){const t=this._dataView.getInt32(this._position);return this._position+=4,t}readFloat(){const t=this._dataView.getFloat32(this._position);return this._position+=4,t}readDouble(){const t=this._dataView.getFloat64(this._position);return this._position+=8,t}remaining(){return this._dataView.byteLength-this._position}toString(t){return new TextDecoder().decode(this._dataView.buffer)}toArrayBuffer(){return this._dataView.buffer}}class nE{constructor(){this._buffer=new Uint8Array,this._position=0}writeByte(t){const e=new Uint8Array(1);return e[0]=t,this.appendArray(e),this}writeBytes(t){const e=new Uint8Array(t);return this.appendArray(e),this}writeShort(t){const e=new Uint8Array(2);return e[0]=t>>8,e[1]=t&255,this.appendArray(e),this}writeInt(t){const e=new Uint8Array(4);return e[0]=t>>24,e[1]=t>>16,e[2]=t>>8,e[3]=t&255,this.appendArray(e),this}writeString(t,e=!0){const i=new TextEncoder().encode(t);return e?(this.writeShort(i.length),this.appendArray(i)):this.appendArray(i),this}appendArray(t){if(!t)return;const e=new Uint8Array(this.position+t.length>this._buffer.length?this.position+t.length:this._buffer.length);e.set(this._buffer),e.set(t,this.position),this._buffer=e,this.position+=t.length}getBuffer(){return this._buffer.buffer}get position(){return this._position}set position(t){this._position=t}toString(t){return new TextDecoder(t).decode(this._buffer)}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const eN=4,aE=0,oE=1,sN=2;function xa(s){let t=s.length;for(;--t>=0;)s[t]=0}const iN=0,$p=1,rN=2,nN=3,aN=258,ff=29,oh=256,Vo=oh+1+ff,Ia=30,gf=19,tm=2*Vo+1,fn=15,S_=16,oN=7,Ef=256,em=16,sm=17,im=18,gc=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),fu=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),hN=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),rm=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),uN=512,Ui=new Array((Vo+2)*2);xa(Ui);const Co=new Array(Ia*2);xa(Co);const ko=new Array(uN);xa(ko);const jo=new Array(aN-nN+1);xa(jo);const pf=new Array(ff);xa(pf);const Vu=new Array(Ia);xa(Vu);function y_(s,t,e,i,r){this.static_tree=s,this.extra_bits=t,this.extra_base=e,this.elems=i,this.max_length=r,this.has_stree=s&&s.length}let nm,am,om;function C_(s,t){this.dyn_tree=s,this.max_code=0,this.stat_desc=t}const hm=s=>s<256?ko[s]:ko[256+(s>>>7)],zo=(s,t)=>{s.pending_buf[s.pending++]=t&255,s.pending_buf[s.pending++]=t>>>8&255},us=(s,t,e)=>{s.bi_valid>S_-e?(s.bi_buf|=t<<s.bi_valid&65535,zo(s,s.bi_buf),s.bi_buf=t>>S_-s.bi_valid,s.bi_valid+=e-S_):(s.bi_buf|=t<<s.bi_valid&65535,s.bi_valid+=e)},ai=(s,t,e)=>{us(s,e[t*2],e[t*2+1])},um=(s,t)=>{let e=0;do e|=s&1,s>>>=1,e<<=1;while(--t>0);return e>>>1},lN=s=>{s.bi_valid===16?(zo(s,s.bi_buf),s.bi_buf=0,s.bi_valid=0):s.bi_valid>=8&&(s.pending_buf[s.pending++]=s.bi_buf&255,s.bi_buf>>=8,s.bi_valid-=8)},_N=(s,t)=>{const e=t.dyn_tree,i=t.max_code,r=t.stat_desc.static_tree,n=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,h=t.stat_desc.max_length;let u,c,l,_,d,g,m=0;for(_=0;_<=fn;_++)s.bl_count[_]=0;for(e[s.heap[s.heap_max]*2+1]=0,u=s.heap_max+1;u<tm;u++)c=s.heap[u],_=e[e[c*2+1]*2+1]+1,_>h&&(_=h,m++),e[c*2+1]=_,!(c>i)&&(s.bl_count[_]++,d=0,c>=o&&(d=a[c-o]),g=e[c*2],s.opt_len+=g*(_+d),n&&(s.static_len+=g*(r[c*2+1]+d)));if(m!==0){do{for(_=h-1;s.bl_count[_]===0;)_--;s.bl_count[_]--,s.bl_count[_+1]+=2,s.bl_count[h]--,m-=2}while(m>0);for(_=h;_!==0;_--)for(c=s.bl_count[_];c!==0;)l=s.heap[--u],!(l>i)&&(e[l*2+1]!==_&&(s.opt_len+=(_-e[l*2+1])*e[l*2],e[l*2+1]=_),c--)}},lm=(s,t,e)=>{const i=new Array(fn+1);let r=0,n,a;for(n=1;n<=fn;n++)r=r+e[n-1]<<1,i[n]=r;for(a=0;a<=t;a++){let o=s[a*2+1];o!==0&&(s[a*2]=um(i[o]++,o))}},cN=()=>{let s,t,e,i,r;const n=new Array(fn+1);for(e=0,i=0;i<ff-1;i++)for(pf[i]=e,s=0;s<1<<gc[i];s++)jo[e++]=i;for(jo[e-1]=i,r=0,i=0;i<16;i++)for(Vu[i]=r,s=0;s<1<<fu[i];s++)ko[r++]=i;for(r>>=7;i<Ia;i++)for(Vu[i]=r<<7,s=0;s<1<<fu[i]-7;s++)ko[256+r++]=i;for(t=0;t<=fn;t++)n[t]=0;for(s=0;s<=143;)Ui[s*2+1]=8,s++,n[8]++;for(;s<=255;)Ui[s*2+1]=9,s++,n[9]++;for(;s<=279;)Ui[s*2+1]=7,s++,n[7]++;for(;s<=287;)Ui[s*2+1]=8,s++,n[8]++;for(lm(Ui,Vo+1,n),s=0;s<Ia;s++)Co[s*2+1]=5,Co[s*2]=um(s,5);nm=new y_(Ui,gc,oh+1,Vo,fn),am=new y_(Co,fu,0,Ia,fn),om=new y_(new Array(0),hN,0,gf,oN)},_m=s=>{let t;for(t=0;t<Vo;t++)s.dyn_ltree[t*2]=0;for(t=0;t<Ia;t++)s.dyn_dtree[t*2]=0;for(t=0;t<gf;t++)s.bl_tree[t*2]=0;s.dyn_ltree[Ef*2]=1,s.opt_len=s.static_len=0,s.sym_next=s.matches=0},cm=s=>{s.bi_valid>8?zo(s,s.bi_buf):s.bi_valid>0&&(s.pending_buf[s.pending++]=s.bi_buf),s.bi_buf=0,s.bi_valid=0},hE=(s,t,e,i)=>{const r=t*2,n=e*2;return s[r]<s[n]||s[r]===s[n]&&i[t]<=i[e]},M_=(s,t,e)=>{const i=s.heap[e];let r=e<<1;for(;r<=s.heap_len&&(r<s.heap_len&&hE(t,s.heap[r+1],s.heap[r],s.depth)&&r++,!hE(t,i,s.heap[r],s.depth));)s.heap[e]=s.heap[r],e=r,r<<=1;s.heap[e]=i},uE=(s,t,e)=>{let i,r,n=0,a,o;if(s.sym_next!==0)do i=s.pending_buf[s.sym_buf+n++]&255,i+=(s.pending_buf[s.sym_buf+n++]&255)<<8,r=s.pending_buf[s.sym_buf+n++],i===0?ai(s,r,t):(a=jo[r],ai(s,a+oh+1,t),o=gc[a],o!==0&&(r-=pf[a],us(s,r,o)),i--,a=hm(i),ai(s,a,e),o=fu[a],o!==0&&(i-=Vu[a],us(s,i,o)));while(n<s.sym_next);ai(s,Ef,t)},Ec=(s,t)=>{const e=t.dyn_tree,i=t.stat_desc.static_tree,r=t.stat_desc.has_stree,n=t.stat_desc.elems;let a,o,h=-1,u;for(s.heap_len=0,s.heap_max=tm,a=0;a<n;a++)e[a*2]!==0?(s.heap[++s.heap_len]=h=a,s.depth[a]=0):e[a*2+1]=0;for(;s.heap_len<2;)u=s.heap[++s.heap_len]=h<2?++h:0,e[u*2]=1,s.depth[u]=0,s.opt_len--,r&&(s.static_len-=i[u*2+1]);for(t.max_code=h,a=s.heap_len>>1;a>=1;a--)M_(s,e,a);u=n;do a=s.heap[1],s.heap[1]=s.heap[s.heap_len--],M_(s,e,1),o=s.heap[1],s.heap[--s.heap_max]=a,s.heap[--s.heap_max]=o,e[u*2]=e[a*2]+e[o*2],s.depth[u]=(s.depth[a]>=s.depth[o]?s.depth[a]:s.depth[o])+1,e[a*2+1]=e[o*2+1]=u,s.heap[1]=u++,M_(s,e,1);while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1],_N(s,t),lm(e,h,s.bl_count)},lE=(s,t,e)=>{let i,r=-1,n,a=t[0*2+1],o=0,h=7,u=4;for(a===0&&(h=138,u=3),t[(e+1)*2+1]=65535,i=0;i<=e;i++)n=a,a=t[(i+1)*2+1],!(++o<h&&n===a)&&(o<u?s.bl_tree[n*2]+=o:n!==0?(n!==r&&s.bl_tree[n*2]++,s.bl_tree[em*2]++):o<=10?s.bl_tree[sm*2]++:s.bl_tree[im*2]++,o=0,r=n,a===0?(h=138,u=3):n===a?(h=6,u=3):(h=7,u=4))},_E=(s,t,e)=>{let i,r=-1,n,a=t[0*2+1],o=0,h=7,u=4;for(a===0&&(h=138,u=3),i=0;i<=e;i++)if(n=a,a=t[(i+1)*2+1],!(++o<h&&n===a)){if(o<u)do ai(s,n,s.bl_tree);while(--o!==0);else n!==0?(n!==r&&(ai(s,n,s.bl_tree),o--),ai(s,em,s.bl_tree),us(s,o-3,2)):o<=10?(ai(s,sm,s.bl_tree),us(s,o-3,3)):(ai(s,im,s.bl_tree),us(s,o-11,7));o=0,r=n,a===0?(h=138,u=3):n===a?(h=6,u=3):(h=7,u=4)}},dN=s=>{let t;for(lE(s,s.dyn_ltree,s.l_desc.max_code),lE(s,s.dyn_dtree,s.d_desc.max_code),Ec(s,s.bl_desc),t=gf-1;t>=3&&s.bl_tree[rm[t]*2+1]===0;t--);return s.opt_len+=3*(t+1)+5+5+4,t},fN=(s,t,e,i)=>{let r;for(us(s,t-257,5),us(s,e-1,5),us(s,i-4,4),r=0;r<i;r++)us(s,s.bl_tree[rm[r]*2+1],3);_E(s,s.dyn_ltree,t-1),_E(s,s.dyn_dtree,e-1)},gN=s=>{let t=4093624447,e;for(e=0;e<=31;e++,t>>>=1)if(t&1&&s.dyn_ltree[e*2]!==0)return aE;if(s.dyn_ltree[9*2]!==0||s.dyn_ltree[10*2]!==0||s.dyn_ltree[13*2]!==0)return oE;for(e=32;e<oh;e++)if(s.dyn_ltree[e*2]!==0)return oE;return aE};let cE=!1;const EN=s=>{cE||(cN(),cE=!0),s.l_desc=new C_(s.dyn_ltree,nm),s.d_desc=new C_(s.dyn_dtree,am),s.bl_desc=new C_(s.bl_tree,om),s.bi_buf=0,s.bi_valid=0,_m(s)},dm=(s,t,e,i)=>{us(s,(iN<<1)+(i?1:0),3),cm(s),zo(s,e),zo(s,~e),e&&s.pending_buf.set(s.window.subarray(t,t+e),s.pending),s.pending+=e},pN=s=>{us(s,$p<<1,3),ai(s,Ef,Ui),lN(s)},mN=(s,t,e,i)=>{let r,n,a=0;s.level>0?(s.strm.data_type===sN&&(s.strm.data_type=gN(s)),Ec(s,s.l_desc),Ec(s,s.d_desc),a=dN(s),r=s.opt_len+3+7>>>3,n=s.static_len+3+7>>>3,n<=r&&(r=n)):r=n=e+5,e+4<=r&&t!==-1?dm(s,t,e,i):s.strategy===eN||n===r?(us(s,($p<<1)+(i?1:0),3),uE(s,Ui,Co)):(us(s,(rN<<1)+(i?1:0),3),fN(s,s.l_desc.max_code+1,s.d_desc.max_code+1,a+1),uE(s,s.dyn_ltree,s.dyn_dtree)),_m(s),i&&cm(s)},IN=(s,t,e)=>(s.pending_buf[s.sym_buf+s.sym_next++]=t,s.pending_buf[s.sym_buf+s.sym_next++]=t>>8,s.pending_buf[s.sym_buf+s.sym_next++]=e,t===0?s.dyn_ltree[e*2]++:(s.matches++,t--,s.dyn_ltree[(jo[e]+oh+1)*2]++,s.dyn_dtree[hm(t)*2]++),s.sym_next===s.sym_end);var TN=EN,RN=dm,ON=mN,AN=IN,vN=pN,SN={_tr_init:TN,_tr_stored_block:RN,_tr_flush_block:ON,_tr_tally:AN,_tr_align:vN};const yN=(s,t,e,i)=>{let r=s&65535|0,n=s>>>16&65535|0,a=0;for(;e!==0;){a=e>2e3?2e3:e,e-=a;do r=r+t[i++]|0,n=n+r|0;while(--a);r%=65521,n%=65521}return r|n<<16|0};var Yo=yN;const CN=()=>{let s,t=[];for(var e=0;e<256;e++){s=e;for(var i=0;i<8;i++)s=s&1?3988292384^s>>>1:s>>>1;t[e]=s}return t},MN=new Uint32Array(CN()),NN=(s,t,e,i)=>{const r=MN,n=i+e;s^=-1;for(let a=i;a<n;a++)s=s>>>8^r[(s^t[a])&255];return s^-1};var De=NN,va={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},hh={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:PN,_tr_stored_block:pc,_tr_flush_block:bN,_tr_tally:Cr,_tr_align:DN}=SN,{Z_NO_FLUSH:Mr,Z_PARTIAL_FLUSH:LN,Z_FULL_FLUSH:UN,Z_FINISH:Ss,Z_BLOCK:dE,Z_OK:He,Z_STREAM_END:fE,Z_STREAM_ERROR:di,Z_DATA_ERROR:xN,Z_BUF_ERROR:N_,Z_DEFAULT_COMPRESSION:FN,Z_FILTERED:wN,Z_HUFFMAN_ONLY:tu,Z_RLE:GN,Z_FIXED:BN,Z_DEFAULT_STRATEGY:HN,Z_UNKNOWN:VN,Z_DEFLATED:Al}=hh,kN=9,jN=15,zN=8,YN=29,WN=256,mc=WN+1+YN,XN=30,KN=19,qN=2*mc+1,ZN=15,bt=3,Ar=258,fi=Ar+bt+1,QN=32,Sa=42,mf=57,Ic=69,Tc=73,Rc=91,Oc=103,gn=113,oo=666,ss=1,Fa=2,Nn=3,wa=4,JN=3,En=(s,t)=>(s.msg=va[t],t),gE=s=>s*2-(s>4?9:0),pr=s=>{let t=s.length;for(;--t>=0;)s[t]=0},$N=s=>{let t,e,i,r=s.w_size;t=s.hash_size,i=t;do e=s.head[--i],s.head[i]=e>=r?e-r:0;while(--t);t=r,i=t;do e=s.prev[--i],s.prev[i]=e>=r?e-r:0;while(--t)};let tP=(s,t,e)=>(t<<s.hash_shift^e)&s.hash_mask,Nr=tP;const gs=s=>{const t=s.state;let e=t.pending;e>s.avail_out&&(e=s.avail_out),e!==0&&(s.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+e),s.next_out),s.next_out+=e,t.pending_out+=e,s.total_out+=e,s.avail_out-=e,t.pending-=e,t.pending===0&&(t.pending_out=0))},ps=(s,t)=>{bN(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,t),s.block_start=s.strstart,gs(s.strm)},Bt=(s,t)=>{s.pending_buf[s.pending++]=t},io=(s,t)=>{s.pending_buf[s.pending++]=t>>>8&255,s.pending_buf[s.pending++]=t&255},Ac=(s,t,e,i)=>{let r=s.avail_in;return r>i&&(r=i),r===0?0:(s.avail_in-=r,t.set(s.input.subarray(s.next_in,s.next_in+r),e),s.state.wrap===1?s.adler=Yo(s.adler,t,r,e):s.state.wrap===2&&(s.adler=De(s.adler,t,r,e)),s.next_in+=r,s.total_in+=r,r)},fm=(s,t)=>{let e=s.max_chain_length,i=s.strstart,r,n,a=s.prev_length,o=s.nice_match;const h=s.strstart>s.w_size-fi?s.strstart-(s.w_size-fi):0,u=s.window,c=s.w_mask,l=s.prev,_=s.strstart+Ar;let d=u[i+a-1],g=u[i+a];s.prev_length>=s.good_match&&(e>>=2),o>s.lookahead&&(o=s.lookahead);do if(r=t,!(u[r+a]!==g||u[r+a-1]!==d||u[r]!==u[i]||u[++r]!==u[i+1])){i+=2,r++;do;while(u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&i<_);if(n=Ar-(_-i),i=_-Ar,n>a){if(s.match_start=t,a=n,n>=o)break;d=u[i+a-1],g=u[i+a]}}while((t=l[t&c])>h&&--e!==0);return a<=s.lookahead?a:s.lookahead},ya=s=>{const t=s.w_size;let e,i,r;do{if(i=s.window_size-s.lookahead-s.strstart,s.strstart>=t+(t-fi)&&(s.window.set(s.window.subarray(t,t+t-i),0),s.match_start-=t,s.strstart-=t,s.block_start-=t,s.insert>s.strstart&&(s.insert=s.strstart),$N(s),i+=t),s.strm.avail_in===0)break;if(e=Ac(s.strm,s.window,s.strstart+s.lookahead,i),s.lookahead+=e,s.lookahead+s.insert>=bt)for(r=s.strstart-s.insert,s.ins_h=s.window[r],s.ins_h=Nr(s,s.ins_h,s.window[r+1]);s.insert&&(s.ins_h=Nr(s,s.ins_h,s.window[r+bt-1]),s.prev[r&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=r,r++,s.insert--,!(s.lookahead+s.insert<bt)););}while(s.lookahead<fi&&s.strm.avail_in!==0)},gm=(s,t)=>{let e=s.pending_buf_size-5>s.w_size?s.w_size:s.pending_buf_size-5,i,r,n,a=0,o=s.strm.avail_in;do{if(i=65535,n=s.bi_valid+42>>3,s.strm.avail_out<n||(n=s.strm.avail_out-n,r=s.strstart-s.block_start,i>r+s.strm.avail_in&&(i=r+s.strm.avail_in),i>n&&(i=n),i<e&&(i===0&&t!==Ss||t===Mr||i!==r+s.strm.avail_in)))break;a=t===Ss&&i===r+s.strm.avail_in?1:0,pc(s,0,0,a),s.pending_buf[s.pending-4]=i,s.pending_buf[s.pending-3]=i>>8,s.pending_buf[s.pending-2]=~i,s.pending_buf[s.pending-1]=~i>>8,gs(s.strm),r&&(r>i&&(r=i),s.strm.output.set(s.window.subarray(s.block_start,s.block_start+r),s.strm.next_out),s.strm.next_out+=r,s.strm.avail_out-=r,s.strm.total_out+=r,s.block_start+=r,i-=r),i&&(Ac(s.strm,s.strm.output,s.strm.next_out,i),s.strm.next_out+=i,s.strm.avail_out-=i,s.strm.total_out+=i)}while(a===0);return o-=s.strm.avail_in,o&&(o>=s.w_size?(s.matches=2,s.window.set(s.strm.input.subarray(s.strm.next_in-s.w_size,s.strm.next_in),0),s.strstart=s.w_size,s.insert=s.strstart):(s.window_size-s.strstart<=o&&(s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,s.insert>s.strstart&&(s.insert=s.strstart)),s.window.set(s.strm.input.subarray(s.strm.next_in-o,s.strm.next_in),s.strstart),s.strstart+=o,s.insert+=o>s.w_size-s.insert?s.w_size-s.insert:o),s.block_start=s.strstart),s.high_water<s.strstart&&(s.high_water=s.strstart),a?wa:t!==Mr&&t!==Ss&&s.strm.avail_in===0&&s.strstart===s.block_start?Fa:(n=s.window_size-s.strstart,s.strm.avail_in>n&&s.block_start>=s.w_size&&(s.block_start-=s.w_size,s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,n+=s.w_size,s.insert>s.strstart&&(s.insert=s.strstart)),n>s.strm.avail_in&&(n=s.strm.avail_in),n&&(Ac(s.strm,s.window,s.strstart,n),s.strstart+=n,s.insert+=n>s.w_size-s.insert?s.w_size-s.insert:n),s.high_water<s.strstart&&(s.high_water=s.strstart),n=s.bi_valid+42>>3,n=s.pending_buf_size-n>65535?65535:s.pending_buf_size-n,e=n>s.w_size?s.w_size:n,r=s.strstart-s.block_start,(r>=e||(r||t===Ss)&&t!==Mr&&s.strm.avail_in===0&&r<=n)&&(i=r>n?n:r,a=t===Ss&&s.strm.avail_in===0&&i===r?1:0,pc(s,s.block_start,i,a),s.block_start+=i,gs(s.strm)),a?Nn:ss)},P_=(s,t)=>{let e,i;for(;;){if(s.lookahead<fi){if(ya(s),s.lookahead<fi&&t===Mr)return ss;if(s.lookahead===0)break}if(e=0,s.lookahead>=bt&&(s.ins_h=Nr(s,s.ins_h,s.window[s.strstart+bt-1]),e=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),e!==0&&s.strstart-e<=s.w_size-fi&&(s.match_length=fm(s,e)),s.match_length>=bt)if(i=Cr(s,s.strstart-s.match_start,s.match_length-bt),s.lookahead-=s.match_length,s.match_length<=s.max_lazy_match&&s.lookahead>=bt){s.match_length--;do s.strstart++,s.ins_h=Nr(s,s.ins_h,s.window[s.strstart+bt-1]),e=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart;while(--s.match_length!==0);s.strstart++}else s.strstart+=s.match_length,s.match_length=0,s.ins_h=s.window[s.strstart],s.ins_h=Nr(s,s.ins_h,s.window[s.strstart+1]);else i=Cr(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++;if(i&&(ps(s,!1),s.strm.avail_out===0))return ss}return s.insert=s.strstart<bt-1?s.strstart:bt-1,t===Ss?(ps(s,!0),s.strm.avail_out===0?Nn:wa):s.sym_next&&(ps(s,!1),s.strm.avail_out===0)?ss:Fa},jn=(s,t)=>{let e,i,r;for(;;){if(s.lookahead<fi){if(ya(s),s.lookahead<fi&&t===Mr)return ss;if(s.lookahead===0)break}if(e=0,s.lookahead>=bt&&(s.ins_h=Nr(s,s.ins_h,s.window[s.strstart+bt-1]),e=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),s.prev_length=s.match_length,s.prev_match=s.match_start,s.match_length=bt-1,e!==0&&s.prev_length<s.max_lazy_match&&s.strstart-e<=s.w_size-fi&&(s.match_length=fm(s,e),s.match_length<=5&&(s.strategy===wN||s.match_length===bt&&s.strstart-s.match_start>4096)&&(s.match_length=bt-1)),s.prev_length>=bt&&s.match_length<=s.prev_length){r=s.strstart+s.lookahead-bt,i=Cr(s,s.strstart-1-s.prev_match,s.prev_length-bt),s.lookahead-=s.prev_length-1,s.prev_length-=2;do++s.strstart<=r&&(s.ins_h=Nr(s,s.ins_h,s.window[s.strstart+bt-1]),e=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart);while(--s.prev_length!==0);if(s.match_available=0,s.match_length=bt-1,s.strstart++,i&&(ps(s,!1),s.strm.avail_out===0))return ss}else if(s.match_available){if(i=Cr(s,0,s.window[s.strstart-1]),i&&ps(s,!1),s.strstart++,s.lookahead--,s.strm.avail_out===0)return ss}else s.match_available=1,s.strstart++,s.lookahead--}return s.match_available&&(i=Cr(s,0,s.window[s.strstart-1]),s.match_available=0),s.insert=s.strstart<bt-1?s.strstart:bt-1,t===Ss?(ps(s,!0),s.strm.avail_out===0?Nn:wa):s.sym_next&&(ps(s,!1),s.strm.avail_out===0)?ss:Fa},eP=(s,t)=>{let e,i,r,n;const a=s.window;for(;;){if(s.lookahead<=Ar){if(ya(s),s.lookahead<=Ar&&t===Mr)return ss;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=bt&&s.strstart>0&&(r=s.strstart-1,i=a[r],i===a[++r]&&i===a[++r]&&i===a[++r])){n=s.strstart+Ar;do;while(i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&r<n);s.match_length=Ar-(n-r),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=bt?(e=Cr(s,1,s.match_length-bt),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(e=Cr(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),e&&(ps(s,!1),s.strm.avail_out===0))return ss}return s.insert=0,t===Ss?(ps(s,!0),s.strm.avail_out===0?Nn:wa):s.sym_next&&(ps(s,!1),s.strm.avail_out===0)?ss:Fa},sP=(s,t)=>{let e;for(;;){if(s.lookahead===0&&(ya(s),s.lookahead===0)){if(t===Mr)return ss;break}if(s.match_length=0,e=Cr(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,e&&(ps(s,!1),s.strm.avail_out===0))return ss}return s.insert=0,t===Ss?(ps(s,!0),s.strm.avail_out===0?Nn:wa):s.sym_next&&(ps(s,!1),s.strm.avail_out===0)?ss:Fa};function $s(s,t,e,i,r){this.good_length=s,this.max_lazy=t,this.nice_length=e,this.max_chain=i,this.func=r}const ho=[new $s(0,0,0,0,gm),new $s(4,4,8,4,P_),new $s(4,5,16,8,P_),new $s(4,6,32,32,P_),new $s(4,4,16,16,jn),new $s(8,16,32,32,jn),new $s(8,16,128,128,jn),new $s(8,32,128,256,jn),new $s(32,128,258,1024,jn),new $s(32,258,258,4096,jn)],iP=s=>{s.window_size=2*s.w_size,pr(s.head),s.max_lazy_match=ho[s.level].max_lazy,s.good_match=ho[s.level].good_length,s.nice_match=ho[s.level].nice_length,s.max_chain_length=ho[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=bt-1,s.match_available=0,s.ins_h=0};function rP(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Al,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(qN*2),this.dyn_dtree=new Uint16Array((2*XN+1)*2),this.bl_tree=new Uint16Array((2*KN+1)*2),pr(this.dyn_ltree),pr(this.dyn_dtree),pr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(ZN+1),this.heap=new Uint16Array(2*mc+1),pr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*mc+1),pr(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const uh=s=>{if(!s)return 1;const t=s.state;return!t||t.strm!==s||t.status!==Sa&&t.status!==mf&&t.status!==Ic&&t.status!==Tc&&t.status!==Rc&&t.status!==Oc&&t.status!==gn&&t.status!==oo?1:0},Em=s=>{if(uh(s))return En(s,di);s.total_in=s.total_out=0,s.data_type=VN;const t=s.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?mf:t.wrap?Sa:gn,s.adler=t.wrap===2?0:1,t.last_flush=-2,PN(t),He},pm=s=>{const t=Em(s);return t===He&&iP(s.state),t},nP=(s,t)=>uh(s)||s.state.wrap!==2?di:(s.state.gzhead=t,He),mm=(s,t,e,i,r,n)=>{if(!s)return di;let a=1;if(t===FN&&(t=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),r<1||r>kN||e!==Al||i<8||i>15||t<0||t>9||n<0||n>BN||i===8&&a!==1)return En(s,di);i===8&&(i=9);const o=new rP;return s.state=o,o.strm=s,o.status=Sa,o.wrap=a,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=r+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+bt-1)/bt),o.window=new Uint8Array(o.w_size*2),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<r+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=(o.lit_bufsize-1)*3,o.level=t,o.strategy=n,o.method=e,pm(s)},aP=(s,t)=>mm(s,t,Al,jN,zN,HN),oP=(s,t)=>{if(uh(s)||t>dE||t<0)return s?En(s,di):di;const e=s.state;if(!s.output||s.avail_in!==0&&!s.input||e.status===oo&&t!==Ss)return En(s,s.avail_out===0?N_:di);const i=e.last_flush;if(e.last_flush=t,e.pending!==0){if(gs(s),s.avail_out===0)return e.last_flush=-1,He}else if(s.avail_in===0&&gE(t)<=gE(i)&&t!==Ss)return En(s,N_);if(e.status===oo&&s.avail_in!==0)return En(s,N_);if(e.status===Sa&&e.wrap===0&&(e.status=gn),e.status===Sa){let r=Al+(e.w_bits-8<<4)<<8,n=-1;if(e.strategy>=tu||e.level<2?n=0:e.level<6?n=1:e.level===6?n=2:n=3,r|=n<<6,e.strstart!==0&&(r|=QN),r+=31-r%31,io(e,r),e.strstart!==0&&(io(e,s.adler>>>16),io(e,s.adler&65535)),s.adler=1,e.status=gn,gs(s),e.pending!==0)return e.last_flush=-1,He}if(e.status===mf){if(s.adler=0,Bt(e,31),Bt(e,139),Bt(e,8),e.gzhead)Bt(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),Bt(e,e.gzhead.time&255),Bt(e,e.gzhead.time>>8&255),Bt(e,e.gzhead.time>>16&255),Bt(e,e.gzhead.time>>24&255),Bt(e,e.level===9?2:e.strategy>=tu||e.level<2?4:0),Bt(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(Bt(e,e.gzhead.extra.length&255),Bt(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(s.adler=De(s.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=Ic;else if(Bt(e,0),Bt(e,0),Bt(e,0),Bt(e,0),Bt(e,0),Bt(e,e.level===9?2:e.strategy>=tu||e.level<2?4:0),Bt(e,JN),e.status=gn,gs(s),e.pending!==0)return e.last_flush=-1,He}if(e.status===Ic){if(e.gzhead.extra){let r=e.pending,n=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+n>e.pending_buf_size;){let o=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+o),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>r&&(s.adler=De(s.adler,e.pending_buf,e.pending-r,r)),e.gzindex+=o,gs(s),e.pending!==0)return e.last_flush=-1,He;r=0,n-=o}let a=new Uint8Array(e.gzhead.extra);e.pending_buf.set(a.subarray(e.gzindex,e.gzindex+n),e.pending),e.pending+=n,e.gzhead.hcrc&&e.pending>r&&(s.adler=De(s.adler,e.pending_buf,e.pending-r,r)),e.gzindex=0}e.status=Tc}if(e.status===Tc){if(e.gzhead.name){let r=e.pending,n;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>r&&(s.adler=De(s.adler,e.pending_buf,e.pending-r,r)),gs(s),e.pending!==0)return e.last_flush=-1,He;r=0}e.gzindex<e.gzhead.name.length?n=e.gzhead.name.charCodeAt(e.gzindex++)&255:n=0,Bt(e,n)}while(n!==0);e.gzhead.hcrc&&e.pending>r&&(s.adler=De(s.adler,e.pending_buf,e.pending-r,r)),e.gzindex=0}e.status=Rc}if(e.status===Rc){if(e.gzhead.comment){let r=e.pending,n;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>r&&(s.adler=De(s.adler,e.pending_buf,e.pending-r,r)),gs(s),e.pending!==0)return e.last_flush=-1,He;r=0}e.gzindex<e.gzhead.comment.length?n=e.gzhead.comment.charCodeAt(e.gzindex++)&255:n=0,Bt(e,n)}while(n!==0);e.gzhead.hcrc&&e.pending>r&&(s.adler=De(s.adler,e.pending_buf,e.pending-r,r))}e.status=Oc}if(e.status===Oc){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(gs(s),e.pending!==0))return e.last_flush=-1,He;Bt(e,s.adler&255),Bt(e,s.adler>>8&255),s.adler=0}if(e.status=gn,gs(s),e.pending!==0)return e.last_flush=-1,He}if(s.avail_in!==0||e.lookahead!==0||t!==Mr&&e.status!==oo){let r=e.level===0?gm(e,t):e.strategy===tu?sP(e,t):e.strategy===GN?eP(e,t):ho[e.level].func(e,t);if((r===Nn||r===wa)&&(e.status=oo),r===ss||r===Nn)return s.avail_out===0&&(e.last_flush=-1),He;if(r===Fa&&(t===LN?DN(e):t!==dE&&(pc(e,0,0,!1),t===UN&&(pr(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),gs(s),s.avail_out===0))return e.last_flush=-1,He}return t!==Ss?He:e.wrap<=0?fE:(e.wrap===2?(Bt(e,s.adler&255),Bt(e,s.adler>>8&255),Bt(e,s.adler>>16&255),Bt(e,s.adler>>24&255),Bt(e,s.total_in&255),Bt(e,s.total_in>>8&255),Bt(e,s.total_in>>16&255),Bt(e,s.total_in>>24&255)):(io(e,s.adler>>>16),io(e,s.adler&65535)),gs(s),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?He:fE)},hP=s=>{if(uh(s))return di;const t=s.state.status;return s.state=null,t===gn?En(s,xN):He},uP=(s,t)=>{let e=t.length;if(uh(s))return di;const i=s.state,r=i.wrap;if(r===2||r===1&&i.status!==Sa||i.lookahead)return di;if(r===1&&(s.adler=Yo(s.adler,t,e,0)),i.wrap=0,e>=i.w_size){r===0&&(pr(i.head),i.strstart=0,i.block_start=0,i.insert=0);let h=new Uint8Array(i.w_size);h.set(t.subarray(e-i.w_size,e),0),t=h,e=i.w_size}const n=s.avail_in,a=s.next_in,o=s.input;for(s.avail_in=e,s.next_in=0,s.input=t,ya(i);i.lookahead>=bt;){let h=i.strstart,u=i.lookahead-(bt-1);do i.ins_h=Nr(i,i.ins_h,i.window[h+bt-1]),i.prev[h&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=h,h++;while(--u);i.strstart=h,i.lookahead=bt-1,ya(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=bt-1,i.match_available=0,s.next_in=a,s.input=o,s.avail_in=n,i.wrap=r,He};var lP=aP,_P=mm,cP=pm,dP=Em,fP=nP,gP=oP,EP=hP,pP=uP,mP="pako deflate (from Nodeca project)",Mo={deflateInit:lP,deflateInit2:_P,deflateReset:cP,deflateResetKeep:dP,deflateSetHeader:fP,deflate:gP,deflateEnd:EP,deflateSetDictionary:pP,deflateInfo:mP};const IP=(s,t)=>Object.prototype.hasOwnProperty.call(s,t);var TP=function(s){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const i in e)IP(e,i)&&(s[i]=e[i])}}return s},RP=s=>{let t=0;for(let i=0,r=s.length;i<r;i++)t+=s[i].length;const e=new Uint8Array(t);for(let i=0,r=0,n=s.length;i<n;i++){let a=s[i];e.set(a,r),r+=a.length}return e},vl={assign:TP,flattenChunks:RP};let Im=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Im=!1}const Wo=new Uint8Array(256);for(let s=0;s<256;s++)Wo[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;Wo[254]=Wo[254]=1;var OP=s=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(s);let t,e,i,r,n,a=s.length,o=0;for(r=0;r<a;r++)e=s.charCodeAt(r),(e&64512)===55296&&r+1<a&&(i=s.charCodeAt(r+1),(i&64512)===56320&&(e=65536+(e-55296<<10)+(i-56320),r++)),o+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(o),n=0,r=0;n<o;r++)e=s.charCodeAt(r),(e&64512)===55296&&r+1<a&&(i=s.charCodeAt(r+1),(i&64512)===56320&&(e=65536+(e-55296<<10)+(i-56320),r++)),e<128?t[n++]=e:e<2048?(t[n++]=192|e>>>6,t[n++]=128|e&63):e<65536?(t[n++]=224|e>>>12,t[n++]=128|e>>>6&63,t[n++]=128|e&63):(t[n++]=240|e>>>18,t[n++]=128|e>>>12&63,t[n++]=128|e>>>6&63,t[n++]=128|e&63);return t};const AP=(s,t)=>{if(t<65534&&s.subarray&&Im)return String.fromCharCode.apply(null,s.length===t?s:s.subarray(0,t));let e="";for(let i=0;i<t;i++)e+=String.fromCharCode(s[i]);return e};var vP=(s,t)=>{const e=t||s.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(s.subarray(0,t));let i,r;const n=new Array(e*2);for(r=0,i=0;i<e;){let a=s[i++];if(a<128){n[r++]=a;continue}let o=Wo[a];if(o>4){n[r++]=65533,i+=o-1;continue}for(a&=o===2?31:o===3?15:7;o>1&&i<e;)a=a<<6|s[i++]&63,o--;if(o>1){n[r++]=65533;continue}a<65536?n[r++]=a:(a-=65536,n[r++]=55296|a>>10&1023,n[r++]=56320|a&1023)}return AP(n,r)},SP=(s,t)=>{t=t||s.length,t>s.length&&(t=s.length);let e=t-1;for(;e>=0&&(s[e]&192)===128;)e--;return e<0||e===0?t:e+Wo[s[e]]>t?e:t},Xo={string2buf:OP,buf2string:vP,utf8border:SP};function yP(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Tm=yP;const Rm=Object.prototype.toString,{Z_NO_FLUSH:CP,Z_SYNC_FLUSH:MP,Z_FULL_FLUSH:NP,Z_FINISH:PP,Z_OK:ku,Z_STREAM_END:bP,Z_DEFAULT_COMPRESSION:DP,Z_DEFAULT_STRATEGY:LP,Z_DEFLATED:UP}=hh;function If(s){this.options=vl.assign({level:DP,method:UP,chunkSize:16384,windowBits:15,memLevel:8,strategy:LP},s||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Tm,this.strm.avail_out=0;let e=Mo.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==ku)throw new Error(va[e]);if(t.header&&Mo.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(typeof t.dictionary=="string"?i=Xo.string2buf(t.dictionary):Rm.call(t.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(t.dictionary):i=t.dictionary,e=Mo.deflateSetDictionary(this.strm,i),e!==ku)throw new Error(va[e]);this._dict_set=!0}}If.prototype.push=function(s,t){const e=this.strm,i=this.options.chunkSize;let r,n;if(this.ended)return!1;for(t===~~t?n=t:n=t===!0?PP:CP,typeof s=="string"?e.input=Xo.string2buf(s):Rm.call(s)==="[object ArrayBuffer]"?e.input=new Uint8Array(s):e.input=s,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),(n===MP||n===NP)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(r=Mo.deflate(e,n),r===bP)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),r=Mo.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===ku;if(e.avail_out===0){this.onData(e.output);continue}if(n>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};If.prototype.onData=function(s){this.chunks.push(s)};If.prototype.onEnd=function(s){s===ku&&(this.result=vl.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};const eu=16209,xP=16191;var FP=function(t,e){let i,r,n,a,o,h,u,c,l,_,d,g,m,p,T,A,O,v,y,C,N,L,P,b;const w=t.state;i=t.next_in,P=t.input,r=i+(t.avail_in-5),n=t.next_out,b=t.output,a=n-(e-t.avail_out),o=n+(t.avail_out-257),h=w.dmax,u=w.wsize,c=w.whave,l=w.wnext,_=w.window,d=w.hold,g=w.bits,m=w.lencode,p=w.distcode,T=(1<<w.lenbits)-1,A=(1<<w.distbits)-1;t:do{g<15&&(d+=P[i++]<<g,g+=8,d+=P[i++]<<g,g+=8),O=m[d&T];e:for(;;){if(v=O>>>24,d>>>=v,g-=v,v=O>>>16&255,v===0)b[n++]=O&65535;else if(v&16){y=O&65535,v&=15,v&&(g<v&&(d+=P[i++]<<g,g+=8),y+=d&(1<<v)-1,d>>>=v,g-=v),g<15&&(d+=P[i++]<<g,g+=8,d+=P[i++]<<g,g+=8),O=p[d&A];s:for(;;){if(v=O>>>24,d>>>=v,g-=v,v=O>>>16&255,v&16){if(C=O&65535,v&=15,g<v&&(d+=P[i++]<<g,g+=8,g<v&&(d+=P[i++]<<g,g+=8)),C+=d&(1<<v)-1,C>h){t.msg="invalid distance too far back",w.mode=eu;break t}if(d>>>=v,g-=v,v=n-a,C>v){if(v=C-v,v>c&&w.sane){t.msg="invalid distance too far back",w.mode=eu;break t}if(N=0,L=_,l===0){if(N+=u-v,v<y){y-=v;do b[n++]=_[N++];while(--v);N=n-C,L=b}}else if(l<v){if(N+=u+l-v,v-=l,v<y){y-=v;do b[n++]=_[N++];while(--v);if(N=0,l<y){v=l,y-=v;do b[n++]=_[N++];while(--v);N=n-C,L=b}}}else if(N+=l-v,v<y){y-=v;do b[n++]=_[N++];while(--v);N=n-C,L=b}for(;y>2;)b[n++]=L[N++],b[n++]=L[N++],b[n++]=L[N++],y-=3;y&&(b[n++]=L[N++],y>1&&(b[n++]=L[N++]))}else{N=n-C;do b[n++]=b[N++],b[n++]=b[N++],b[n++]=b[N++],y-=3;while(y>2);y&&(b[n++]=b[N++],y>1&&(b[n++]=b[N++]))}}else if(v&64){t.msg="invalid distance code",w.mode=eu;break t}else{O=p[(O&65535)+(d&(1<<v)-1)];continue s}break}}else if(v&64)if(v&32){w.mode=xP;break t}else{t.msg="invalid literal/length code",w.mode=eu;break t}else{O=m[(O&65535)+(d&(1<<v)-1)];continue e}break}}while(i<r&&n<o);y=g>>3,i-=y,g-=y<<3,d&=(1<<g)-1,t.next_in=i,t.next_out=n,t.avail_in=i<r?5+(r-i):5-(i-r),t.avail_out=n<o?257+(o-n):257-(n-o),w.hold=d,w.bits=g};const zn=15,EE=852,pE=592,mE=0,b_=1,IE=2,wP=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),GP=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),BP=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),HP=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),VP=(s,t,e,i,r,n,a,o)=>{const h=o.bits;let u=0,c=0,l=0,_=0,d=0,g=0,m=0,p=0,T=0,A=0,O,v,y,C,N,L=null,P;const b=new Uint16Array(zn+1),w=new Uint16Array(zn+1);let q=null,ht,dt,j;for(u=0;u<=zn;u++)b[u]=0;for(c=0;c<i;c++)b[t[e+c]]++;for(d=h,_=zn;_>=1&&b[_]===0;_--);if(d>_&&(d=_),_===0)return r[n++]=1<<24|64<<16|0,r[n++]=1<<24|64<<16|0,o.bits=1,0;for(l=1;l<_&&b[l]===0;l++);for(d<l&&(d=l),p=1,u=1;u<=zn;u++)if(p<<=1,p-=b[u],p<0)return-1;if(p>0&&(s===mE||_!==1))return-1;for(w[1]=0,u=1;u<zn;u++)w[u+1]=w[u]+b[u];for(c=0;c<i;c++)t[e+c]!==0&&(a[w[t[e+c]]++]=c);if(s===mE?(L=q=a,P=20):s===b_?(L=wP,q=GP,P=257):(L=BP,q=HP,P=0),A=0,c=0,u=l,N=n,g=d,m=0,y=-1,T=1<<d,C=T-1,s===b_&&T>EE||s===IE&&T>pE)return 1;for(;;){ht=u-m,a[c]+1<P?(dt=0,j=a[c]):a[c]>=P?(dt=q[a[c]-P],j=L[a[c]-P]):(dt=32+64,j=0),O=1<<u-m,v=1<<g,l=v;do v-=O,r[N+(A>>m)+v]=ht<<24|dt<<16|j|0;while(v!==0);for(O=1<<u-1;A&O;)O>>=1;if(O!==0?(A&=O-1,A+=O):A=0,c++,--b[u]===0){if(u===_)break;u=t[e+a[c]]}if(u>d&&(A&C)!==y){for(m===0&&(m=d),N+=l,g=u-m,p=1<<g;g+m<_&&(p-=b[g+m],!(p<=0));)g++,p<<=1;if(T+=1<<g,s===b_&&T>EE||s===IE&&T>pE)return 1;y=A&C,r[y]=d<<24|g<<16|N-n|0}}return A!==0&&(r[N+A]=u-m<<24|64<<16|0),o.bits=d,0};var No=VP;const kP=0,Om=1,Am=2,{Z_FINISH:TE,Z_BLOCK:jP,Z_TREES:su,Z_OK:Pn,Z_STREAM_END:zP,Z_NEED_DICT:YP,Z_STREAM_ERROR:Ps,Z_DATA_ERROR:vm,Z_MEM_ERROR:Sm,Z_BUF_ERROR:WP,Z_DEFLATED:RE}=hh,Sl=16180,OE=16181,AE=16182,vE=16183,SE=16184,yE=16185,CE=16186,ME=16187,NE=16188,PE=16189,ju=16190,Oi=16191,D_=16192,bE=16193,L_=16194,DE=16195,LE=16196,UE=16197,xE=16198,iu=16199,ru=16200,FE=16201,wE=16202,GE=16203,BE=16204,HE=16205,U_=16206,VE=16207,kE=16208,re=16209,ym=16210,Cm=16211,XP=852,KP=592,qP=15,ZP=qP,jE=s=>(s>>>24&255)+(s>>>8&65280)+((s&65280)<<8)+((s&255)<<24);function QP(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Un=s=>{if(!s)return 1;const t=s.state;return!t||t.strm!==s||t.mode<Sl||t.mode>Cm?1:0},Mm=s=>{if(Un(s))return Ps;const t=s.state;return s.total_in=s.total_out=t.total=0,s.msg="",t.wrap&&(s.adler=t.wrap&1),t.mode=Sl,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(XP),t.distcode=t.distdyn=new Int32Array(KP),t.sane=1,t.back=-1,Pn},Nm=s=>{if(Un(s))return Ps;const t=s.state;return t.wsize=0,t.whave=0,t.wnext=0,Mm(s)},Pm=(s,t)=>{let e;if(Un(s))return Ps;const i=s.state;return t<0?(e=0,t=-t):(e=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?Ps:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=e,i.wbits=t,Nm(s))},bm=(s,t)=>{if(!s)return Ps;const e=new QP;s.state=e,e.strm=s,e.window=null,e.mode=Sl;const i=Pm(s,t);return i!==Pn&&(s.state=null),i},JP=s=>bm(s,ZP);let zE=!0,x_,F_;const $P=s=>{if(zE){x_=new Int32Array(512),F_=new Int32Array(32);let t=0;for(;t<144;)s.lens[t++]=8;for(;t<256;)s.lens[t++]=9;for(;t<280;)s.lens[t++]=7;for(;t<288;)s.lens[t++]=8;for(No(Om,s.lens,0,288,x_,0,s.work,{bits:9}),t=0;t<32;)s.lens[t++]=5;No(Am,s.lens,0,32,F_,0,s.work,{bits:5}),zE=!1}s.lencode=x_,s.lenbits=9,s.distcode=F_,s.distbits=5},Dm=(s,t,e,i)=>{let r;const n=s.state;return n.window===null&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),i>=n.wsize?(n.window.set(t.subarray(e-n.wsize,e),0),n.wnext=0,n.whave=n.wsize):(r=n.wsize-n.wnext,r>i&&(r=i),n.window.set(t.subarray(e-i,e-i+r),n.wnext),i-=r,i?(n.window.set(t.subarray(e-i,e),0),n.wnext=i,n.whave=n.wsize):(n.wnext+=r,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=r))),0},tb=(s,t)=>{let e,i,r,n,a,o,h,u,c,l,_,d,g,m,p=0,T,A,O,v,y,C,N,L;const P=new Uint8Array(4);let b,w;const q=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Un(s)||!s.output||!s.input&&s.avail_in!==0)return Ps;e=s.state,e.mode===Oi&&(e.mode=D_),a=s.next_out,r=s.output,h=s.avail_out,n=s.next_in,i=s.input,o=s.avail_in,u=e.hold,c=e.bits,l=o,_=h,L=Pn;t:for(;;)switch(e.mode){case Sl:if(e.wrap===0){e.mode=D_;break}for(;c<16;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}if(e.wrap&2&&u===35615){e.wbits===0&&(e.wbits=15),e.check=0,P[0]=u&255,P[1]=u>>>8&255,e.check=De(e.check,P,2,0),u=0,c=0,e.mode=OE;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((u&255)<<8)+(u>>8))%31){s.msg="incorrect header check",e.mode=re;break}if((u&15)!==RE){s.msg="unknown compression method",e.mode=re;break}if(u>>>=4,c-=4,N=(u&15)+8,e.wbits===0&&(e.wbits=N),N>15||N>e.wbits){s.msg="invalid window size",e.mode=re;break}e.dmax=1<<e.wbits,e.flags=0,s.adler=e.check=1,e.mode=u&512?PE:Oi,u=0,c=0;break;case OE:for(;c<16;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}if(e.flags=u,(e.flags&255)!==RE){s.msg="unknown compression method",e.mode=re;break}if(e.flags&57344){s.msg="unknown header flags set",e.mode=re;break}e.head&&(e.head.text=u>>8&1),e.flags&512&&e.wrap&4&&(P[0]=u&255,P[1]=u>>>8&255,e.check=De(e.check,P,2,0)),u=0,c=0,e.mode=AE;case AE:for(;c<32;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}e.head&&(e.head.time=u),e.flags&512&&e.wrap&4&&(P[0]=u&255,P[1]=u>>>8&255,P[2]=u>>>16&255,P[3]=u>>>24&255,e.check=De(e.check,P,4,0)),u=0,c=0,e.mode=vE;case vE:for(;c<16;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}e.head&&(e.head.xflags=u&255,e.head.os=u>>8),e.flags&512&&e.wrap&4&&(P[0]=u&255,P[1]=u>>>8&255,e.check=De(e.check,P,2,0)),u=0,c=0,e.mode=SE;case SE:if(e.flags&1024){for(;c<16;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}e.length=u,e.head&&(e.head.extra_len=u),e.flags&512&&e.wrap&4&&(P[0]=u&255,P[1]=u>>>8&255,e.check=De(e.check,P,2,0)),u=0,c=0}else e.head&&(e.head.extra=null);e.mode=yE;case yE:if(e.flags&1024&&(d=e.length,d>o&&(d=o),d&&(e.head&&(N=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(i.subarray(n,n+d),N)),e.flags&512&&e.wrap&4&&(e.check=De(e.check,i,d,n)),o-=d,n+=d,e.length-=d),e.length))break t;e.length=0,e.mode=CE;case CE:if(e.flags&2048){if(o===0)break t;d=0;do N=i[n+d++],e.head&&N&&e.length<65536&&(e.head.name+=String.fromCharCode(N));while(N&&d<o);if(e.flags&512&&e.wrap&4&&(e.check=De(e.check,i,d,n)),o-=d,n+=d,N)break t}else e.head&&(e.head.name=null);e.length=0,e.mode=ME;case ME:if(e.flags&4096){if(o===0)break t;d=0;do N=i[n+d++],e.head&&N&&e.length<65536&&(e.head.comment+=String.fromCharCode(N));while(N&&d<o);if(e.flags&512&&e.wrap&4&&(e.check=De(e.check,i,d,n)),o-=d,n+=d,N)break t}else e.head&&(e.head.comment=null);e.mode=NE;case NE:if(e.flags&512){for(;c<16;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}if(e.wrap&4&&u!==(e.check&65535)){s.msg="header crc mismatch",e.mode=re;break}u=0,c=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),s.adler=e.check=0,e.mode=Oi;break;case PE:for(;c<32;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}s.adler=e.check=jE(u),u=0,c=0,e.mode=ju;case ju:if(e.havedict===0)return s.next_out=a,s.avail_out=h,s.next_in=n,s.avail_in=o,e.hold=u,e.bits=c,YP;s.adler=e.check=1,e.mode=Oi;case Oi:if(t===jP||t===su)break t;case D_:if(e.last){u>>>=c&7,c-=c&7,e.mode=U_;break}for(;c<3;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}switch(e.last=u&1,u>>>=1,c-=1,u&3){case 0:e.mode=bE;break;case 1:if($P(e),e.mode=iu,t===su){u>>>=2,c-=2;break t}break;case 2:e.mode=LE;break;case 3:s.msg="invalid block type",e.mode=re}u>>>=2,c-=2;break;case bE:for(u>>>=c&7,c-=c&7;c<32;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}if((u&65535)!==(u>>>16^65535)){s.msg="invalid stored block lengths",e.mode=re;break}if(e.length=u&65535,u=0,c=0,e.mode=L_,t===su)break t;case L_:e.mode=DE;case DE:if(d=e.length,d){if(d>o&&(d=o),d>h&&(d=h),d===0)break t;r.set(i.subarray(n,n+d),a),o-=d,n+=d,h-=d,a+=d,e.length-=d;break}e.mode=Oi;break;case LE:for(;c<14;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}if(e.nlen=(u&31)+257,u>>>=5,c-=5,e.ndist=(u&31)+1,u>>>=5,c-=5,e.ncode=(u&15)+4,u>>>=4,c-=4,e.nlen>286||e.ndist>30){s.msg="too many length or distance symbols",e.mode=re;break}e.have=0,e.mode=UE;case UE:for(;e.have<e.ncode;){for(;c<3;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}e.lens[q[e.have++]]=u&7,u>>>=3,c-=3}for(;e.have<19;)e.lens[q[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,b={bits:e.lenbits},L=No(kP,e.lens,0,19,e.lencode,0,e.work,b),e.lenbits=b.bits,L){s.msg="invalid code lengths set",e.mode=re;break}e.have=0,e.mode=xE;case xE:for(;e.have<e.nlen+e.ndist;){for(;p=e.lencode[u&(1<<e.lenbits)-1],T=p>>>24,A=p>>>16&255,O=p&65535,!(T<=c);){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}if(O<16)u>>>=T,c-=T,e.lens[e.have++]=O;else{if(O===16){for(w=T+2;c<w;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}if(u>>>=T,c-=T,e.have===0){s.msg="invalid bit length repeat",e.mode=re;break}N=e.lens[e.have-1],d=3+(u&3),u>>>=2,c-=2}else if(O===17){for(w=T+3;c<w;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}u>>>=T,c-=T,N=0,d=3+(u&7),u>>>=3,c-=3}else{for(w=T+7;c<w;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}u>>>=T,c-=T,N=0,d=11+(u&127),u>>>=7,c-=7}if(e.have+d>e.nlen+e.ndist){s.msg="invalid bit length repeat",e.mode=re;break}for(;d--;)e.lens[e.have++]=N}}if(e.mode===re)break;if(e.lens[256]===0){s.msg="invalid code -- missing end-of-block",e.mode=re;break}if(e.lenbits=9,b={bits:e.lenbits},L=No(Om,e.lens,0,e.nlen,e.lencode,0,e.work,b),e.lenbits=b.bits,L){s.msg="invalid literal/lengths set",e.mode=re;break}if(e.distbits=6,e.distcode=e.distdyn,b={bits:e.distbits},L=No(Am,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,b),e.distbits=b.bits,L){s.msg="invalid distances set",e.mode=re;break}if(e.mode=iu,t===su)break t;case iu:e.mode=ru;case ru:if(o>=6&&h>=258){s.next_out=a,s.avail_out=h,s.next_in=n,s.avail_in=o,e.hold=u,e.bits=c,FP(s,_),a=s.next_out,r=s.output,h=s.avail_out,n=s.next_in,i=s.input,o=s.avail_in,u=e.hold,c=e.bits,e.mode===Oi&&(e.back=-1);break}for(e.back=0;p=e.lencode[u&(1<<e.lenbits)-1],T=p>>>24,A=p>>>16&255,O=p&65535,!(T<=c);){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}if(A&&!(A&240)){for(v=T,y=A,C=O;p=e.lencode[C+((u&(1<<v+y)-1)>>v)],T=p>>>24,A=p>>>16&255,O=p&65535,!(v+T<=c);){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}u>>>=v,c-=v,e.back+=v}if(u>>>=T,c-=T,e.back+=T,e.length=O,A===0){e.mode=HE;break}if(A&32){e.back=-1,e.mode=Oi;break}if(A&64){s.msg="invalid literal/length code",e.mode=re;break}e.extra=A&15,e.mode=FE;case FE:if(e.extra){for(w=e.extra;c<w;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}e.length+=u&(1<<e.extra)-1,u>>>=e.extra,c-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=wE;case wE:for(;p=e.distcode[u&(1<<e.distbits)-1],T=p>>>24,A=p>>>16&255,O=p&65535,!(T<=c);){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}if(!(A&240)){for(v=T,y=A,C=O;p=e.distcode[C+((u&(1<<v+y)-1)>>v)],T=p>>>24,A=p>>>16&255,O=p&65535,!(v+T<=c);){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}u>>>=v,c-=v,e.back+=v}if(u>>>=T,c-=T,e.back+=T,A&64){s.msg="invalid distance code",e.mode=re;break}e.offset=O,e.extra=A&15,e.mode=GE;case GE:if(e.extra){for(w=e.extra;c<w;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}e.offset+=u&(1<<e.extra)-1,u>>>=e.extra,c-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){s.msg="invalid distance too far back",e.mode=re;break}e.mode=BE;case BE:if(h===0)break t;if(d=_-h,e.offset>d){if(d=e.offset-d,d>e.whave&&e.sane){s.msg="invalid distance too far back",e.mode=re;break}d>e.wnext?(d-=e.wnext,g=e.wsize-d):g=e.wnext-d,d>e.length&&(d=e.length),m=e.window}else m=r,g=a-e.offset,d=e.length;d>h&&(d=h),h-=d,e.length-=d;do r[a++]=m[g++];while(--d);e.length===0&&(e.mode=ru);break;case HE:if(h===0)break t;r[a++]=e.length,h--,e.mode=ru;break;case U_:if(e.wrap){for(;c<32;){if(o===0)break t;o--,u|=i[n++]<<c,c+=8}if(_-=h,s.total_out+=_,e.total+=_,e.wrap&4&&_&&(s.adler=e.check=e.flags?De(e.check,r,_,a-_):Yo(e.check,r,_,a-_)),_=h,e.wrap&4&&(e.flags?u:jE(u))!==e.check){s.msg="incorrect data check",e.mode=re;break}u=0,c=0}e.mode=VE;case VE:if(e.wrap&&e.flags){for(;c<32;){if(o===0)break t;o--,u+=i[n++]<<c,c+=8}if(e.wrap&4&&u!==(e.total&4294967295)){s.msg="incorrect length check",e.mode=re;break}u=0,c=0}e.mode=kE;case kE:L=zP;break t;case re:L=vm;break t;case ym:return Sm;case Cm:default:return Ps}return s.next_out=a,s.avail_out=h,s.next_in=n,s.avail_in=o,e.hold=u,e.bits=c,(e.wsize||_!==s.avail_out&&e.mode<re&&(e.mode<U_||t!==TE))&&Dm(s,s.output,s.next_out,_-s.avail_out),l-=s.avail_in,_-=s.avail_out,s.total_in+=l,s.total_out+=_,e.total+=_,e.wrap&4&&_&&(s.adler=e.check=e.flags?De(e.check,r,_,s.next_out-_):Yo(e.check,r,_,s.next_out-_)),s.data_type=e.bits+(e.last?64:0)+(e.mode===Oi?128:0)+(e.mode===iu||e.mode===L_?256:0),(l===0&&_===0||t===TE)&&L===Pn&&(L=WP),L},eb=s=>{if(Un(s))return Ps;let t=s.state;return t.window&&(t.window=null),s.state=null,Pn},sb=(s,t)=>{if(Un(s))return Ps;const e=s.state;return e.wrap&2?(e.head=t,t.done=!1,Pn):Ps},ib=(s,t)=>{const e=t.length;let i,r,n;return Un(s)||(i=s.state,i.wrap!==0&&i.mode!==ju)?Ps:i.mode===ju&&(r=1,r=Yo(r,t,e,0),r!==i.check)?vm:(n=Dm(s,t,e,e),n?(i.mode=ym,Sm):(i.havedict=1,Pn))};var rb=Nm,nb=Pm,ab=Mm,ob=JP,hb=bm,ub=tb,lb=eb,_b=sb,cb=ib,db="pako inflate (from Nodeca project)",xi={inflateReset:rb,inflateReset2:nb,inflateResetKeep:ab,inflateInit:ob,inflateInit2:hb,inflate:ub,inflateEnd:lb,inflateGetHeader:_b,inflateSetDictionary:cb,inflateInfo:db};function fb(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gb=fb;const Lm=Object.prototype.toString,{Z_NO_FLUSH:Eb,Z_FINISH:pb,Z_OK:Ko,Z_STREAM_END:w_,Z_NEED_DICT:G_,Z_STREAM_ERROR:mb,Z_DATA_ERROR:YE,Z_MEM_ERROR:Ib}=hh;function lh(s){this.options=vl.assign({chunkSize:1024*64,windowBits:15,to:""},s||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(s&&s.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Tm,this.strm.avail_out=0;let e=xi.inflateInit2(this.strm,t.windowBits);if(e!==Ko)throw new Error(va[e]);if(this.header=new gb,xi.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Xo.string2buf(t.dictionary):Lm.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=xi.inflateSetDictionary(this.strm,t.dictionary),e!==Ko)))throw new Error(va[e])}lh.prototype.push=function(s,t){const e=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let n,a,o;if(this.ended)return!1;for(t===~~t?a=t:a=t===!0?pb:Eb,Lm.call(s)==="[object ArrayBuffer]"?e.input=new Uint8Array(s):e.input=s,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),n=xi.inflate(e,a),n===G_&&r&&(n=xi.inflateSetDictionary(e,r),n===Ko?n=xi.inflate(e,a):n===YE&&(n=G_));e.avail_in>0&&n===w_&&e.state.wrap>0&&s[e.next_in]!==0;)xi.inflateReset(e),n=xi.inflate(e,a);switch(n){case mb:case YE:case G_:case Ib:return this.onEnd(n),this.ended=!0,!1}if(o=e.avail_out,e.next_out&&(e.avail_out===0||n===w_))if(this.options.to==="string"){let h=Xo.utf8border(e.output,e.next_out),u=e.next_out-h,c=Xo.buf2string(e.output,h);e.next_out=u,e.avail_out=i-u,u&&e.output.set(e.output.subarray(h,h+u),0),this.onData(c)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(n===Ko&&o===0)){if(n===w_)return n=xi.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};lh.prototype.onData=function(s){this.chunks.push(s)};lh.prototype.onEnd=function(s){s===Ko&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=vl.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};function Tf(s,t){const e=new lh(t);if(e.push(s),e.err)throw e.msg||va[e.err];return e.result}function Tb(s,t){return t=t||{},t.raw=!0,Tf(s,t)}var Rb=lh,Ob=Tf,Ab=Tb,vb=Tf,Sb=hh,yb={Inflate:Rb,inflate:Ob,inflateRaw:Ab,ungzip:vb,constants:Sb};const{Inflate:jq,inflate:Cb,inflateRaw:zq,ungzip:Yq}=yb;var WE=Cb;const Um=class{constructor(s){this._jsonFile=null,this._image=null,this._imageData=null,this._baseTexture=null,this.parse(s)}parse(s){const t=new Ol(s);let e=t.readShort();for(;e>0;){const i=t.readShort(),r=t.readBytes(i).toString(),n=t.readInt(),a=t.readBytes(n);if(r.endsWith(".json")){const o=WE(a.toArrayBuffer());this._jsonFile=JSON.parse(Um.TEXT_DECODER.decode(o))}else{const o=WE(a.toArrayBuffer()),h=Jp(o);this._baseTexture=new Yt("data:image/png;base64,"+h)}e--}}get jsonFile(){return this._jsonFile}get baseTexture(){return this._baseTexture}};let Rf=Um;Rf.TEXT_DECODER=new TextDecoder("utf-8");/*!
 * @pixi/display - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/display is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */Z.SORTABLE_CHILDREN=!1;var qo=function(){function s(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return s.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},s.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},s.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?et.EMPTY:(t=t||new et(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},s.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},s.prototype.addPointMatrix=function(t,e){var i=t.a,r=t.b,n=t.c,a=t.d,o=t.tx,h=t.ty,u=i*e.x+n*e.y+o,c=r*e.x+a*e.y+h;this.minX=Math.min(this.minX,u),this.maxX=Math.max(this.maxX,u),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)},s.prototype.addQuad=function(t){var e=this.minX,i=this.minY,r=this.maxX,n=this.maxY,a=t[0],o=t[1];e=a<e?a:e,i=o<i?o:i,r=a>r?a:r,n=o>n?o:n,a=t[2],o=t[3],e=a<e?a:e,i=o<i?o:i,r=a>r?a:r,n=o>n?o:n,a=t[4],o=t[5],e=a<e?a:e,i=o<i?o:i,r=a>r?a:r,n=o>n?o:n,a=t[6],o=t[7],e=a<e?a:e,i=o<i?o:i,r=a>r?a:r,n=o>n?o:n,this.minX=e,this.minY=i,this.maxX=r,this.maxY=n},s.prototype.addFrame=function(t,e,i,r,n){this.addFrameMatrix(t.worldTransform,e,i,r,n)},s.prototype.addFrameMatrix=function(t,e,i,r,n){var a=t.a,o=t.b,h=t.c,u=t.d,c=t.tx,l=t.ty,_=this.minX,d=this.minY,g=this.maxX,m=this.maxY,p=a*e+h*i+c,T=o*e+u*i+l;_=p<_?p:_,d=T<d?T:d,g=p>g?p:g,m=T>m?T:m,p=a*r+h*i+c,T=o*r+u*i+l,_=p<_?p:_,d=T<d?T:d,g=p>g?p:g,m=T>m?T:m,p=a*e+h*n+c,T=o*e+u*n+l,_=p<_?p:_,d=T<d?T:d,g=p>g?p:g,m=T>m?T:m,p=a*r+h*n+c,T=o*r+u*n+l,_=p<_?p:_,d=T<d?T:d,g=p>g?p:g,m=T>m?T:m,this.minX=_,this.minY=d,this.maxX=g,this.maxY=m},s.prototype.addVertexData=function(t,e,i){for(var r=this.minX,n=this.minY,a=this.maxX,o=this.maxY,h=e;h<i;h+=2){var u=t[h],c=t[h+1];r=u<r?u:r,n=c<n?c:n,a=u>a?u:a,o=c>o?c:o}this.minX=r,this.minY=n,this.maxX=a,this.maxY=o},s.prototype.addVertices=function(t,e,i,r){this.addVerticesMatrix(t.worldTransform,e,i,r)},s.prototype.addVerticesMatrix=function(t,e,i,r,n,a){n===void 0&&(n=0),a===void 0&&(a=n);for(var o=t.a,h=t.b,u=t.c,c=t.d,l=t.tx,_=t.ty,d=this.minX,g=this.minY,m=this.maxX,p=this.maxY,T=i;T<r;T+=2){var A=e[T],O=e[T+1],v=o*A+u*O+l,y=c*O+h*A+_;d=Math.min(d,v-n),m=Math.max(m,v+n),g=Math.min(g,y-a),p=Math.max(p,y+a)}this.minX=d,this.minY=g,this.maxX=m,this.maxY=p},s.prototype.addBounds=function(t){var e=this.minX,i=this.minY,r=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>n?t.maxY:n},s.prototype.addBoundsMask=function(t,e){var i=t.minX>e.minX?t.minX:e.minX,r=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,a=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=n&&r<=a){var o=this.minX,h=this.minY,u=this.maxX,c=this.maxY;this.minX=i<o?i:o,this.minY=r<h?r:h,this.maxX=n>u?n:u,this.maxY=a>c?a:c}},s.prototype.addBoundsMatrix=function(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)},s.prototype.addBoundsArea=function(t,e){var i=t.minX>e.x?t.minX:e.x,r=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,a=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=n&&r<=a){var o=this.minX,h=this.minY,u=this.maxX,c=this.maxY;this.minX=i<o?i:o,this.minY=r<h?r:h,this.maxX=n>u?n:u,this.maxY=a>c?a:c}},s.prototype.pad=function(t,e){t===void 0&&(t=0),e===void 0&&(e=t),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)},s.prototype.addFramePad=function(t,e,i,r,n,a){t-=n,e-=a,i+=n,r+=a,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>r?this.maxY:r},s}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var vc=function(s,t){return vc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])},vc(s,t)};function Of(s,t){vc(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var pe=function(s){Of(t,s);function t(){var e=s.call(this)||this;return e.tempDisplayObjectParent=null,e.transform=new xp,e.alpha=1,e.visible=!0,e.renderable=!0,e.cullable=!1,e.cullArea=null,e.parent=null,e.worldAlpha=1,e._lastSortedIndex=0,e._zIndex=0,e.filterArea=null,e.filters=null,e._enabledFilters=null,e._bounds=new qo,e._localBounds=null,e._boundsID=0,e._boundsRect=null,e._localBoundsRect=null,e._mask=null,e._maskRefCount=0,e._destroyed=!1,e.isSprite=!1,e.isMask=!1,e}return t.mixin=function(e){for(var i=Object.keys(e),r=0;r<i.length;++r){var n=i[r];Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(e,n))}},Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),t.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},t.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},t.prototype.getBounds=function(e,i){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),i||(this._boundsRect||(this._boundsRect=new et),i=this._boundsRect),this._bounds.getRectangle(i)},t.prototype.getLocalBounds=function(e){e||(this._localBoundsRect||(this._localBoundsRect=new et),e=this._localBoundsRect),this._localBounds||(this._localBounds=new qo);var i=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var n=this._bounds,a=this._boundsID;this._bounds=this._localBounds;var o=this.getBounds(!1,e);return this.parent=r,this.transform=i,this._bounds=n,this._bounds.updateID+=this._boundsID-a,o},t.prototype.toGlobal=function(e,i,r){return r===void 0&&(r=!1),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,i)},t.prototype.toLocal=function(e,i,r,n){return i&&(e=i.toGlobal(e,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,r)},t.prototype.setParent=function(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e},t.prototype.setTransform=function(e,i,r,n,a,o,h,u,c){return e===void 0&&(e=0),i===void 0&&(i=0),r===void 0&&(r=1),n===void 0&&(n=1),a===void 0&&(a=0),o===void 0&&(o=0),h===void 0&&(h=0),u===void 0&&(u=0),c===void 0&&(c=0),this.position.x=e,this.position.y=i,this.scale.x=r||1,this.scale.y=n||1,this.rotation=a,this.skew.x=o,this.skew.y=h,this.pivot.x=u,this.pivot.y=c,this},t.prototype.destroy=function(e){this.parent&&this.parent.removeChild(this),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()},Object.defineProperty(t.prototype,"_tempDisplayObjectParent",{get:function(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new xm),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),t.prototype.enableTempParent=function(){var e=this.parent;return this.parent=this._tempDisplayObjectParent,e},t.prototype.disableTempParent=function(e){this.parent=e},Object.defineProperty(t.prototype,"x",{get:function(){return this.position.x},set:function(e){this.transform.position.x=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.position.y},set:function(e){this.transform.position.y=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.transform.position},set:function(e){this.transform.position.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.transform.scale},set:function(e){this.transform.scale.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(e){this.transform.pivot.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skew",{get:function(){return this.transform.skew},set:function(e){this.transform.skew.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(e){this.transform.rotation=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this.transform.rotation*nC},set:function(e){this.transform.rotation=e*aC},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{get:function(){return this._zIndex},set:function(e){this._zIndex=e,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldVisible",{get:function(){var e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(e){if(this._mask!==e){if(this._mask){var i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount--,i._maskRefCount===0&&(i.renderable=!0,i.isMask=!1))}if(this._mask=e,this._mask){var i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount===0&&(i.renderable=!1,i.isMask=!0),i._maskRefCount++)}}},enumerable:!1,configurable:!0}),t}(nh),xm=function(s){Of(t,s);function t(){var e=s!==null&&s.apply(this,arguments)||this;return e.sortDirty=null,e}return t}(pe);pe.prototype.displayObjectUpdateTransform=pe.prototype.updateTransform;function Mb(s,t){return s.zIndex===t.zIndex?s._lastSortedIndex-t._lastSortedIndex:s.zIndex-t.zIndex}var pi=function(s){Of(t,s);function t(){var e=s.call(this)||this;return e.children=[],e.sortableChildren=Z.SORTABLE_CHILDREN,e.sortDirty=!1,e}return t.prototype.onChildrenChange=function(e){},t.prototype.addChild=function(){for(var e=arguments,i=[],r=0;r<arguments.length;r++)i[r]=e[r];if(i.length>1)for(var n=0;n<i.length;n++)this.addChild(i[n]);else{var a=i[0];a.parent&&a.parent.removeChild(a),a.parent=this,this.sortDirty=!0,a.transform._parentID=-1,this.children.push(a),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",a,this,this.children.length-1),a.emit("added",this)}return i[0]},t.prototype.addChildAt=function(e,i){if(i<0||i>this.children.length)throw new Error(e+"addChildAt: The index "+i+" supplied is out of bounds "+this.children.length);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(i,0,e),this._boundsID++,this.onChildrenChange(i),e.emit("added",this),this.emit("childAdded",e,this,i),e},t.prototype.swapChildren=function(e,i){if(e!==i){var r=this.getChildIndex(e),n=this.getChildIndex(i);this.children[r]=i,this.children[n]=e,this.onChildrenChange(r<n?r:n)}},t.prototype.getChildIndex=function(e){var i=this.children.indexOf(e);if(i===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return i},t.prototype.setChildIndex=function(e,i){if(i<0||i>=this.children.length)throw new Error("The index "+i+" supplied is out of bounds "+this.children.length);var r=this.getChildIndex(e);cu(this.children,r,1),this.children.splice(i,0,e),this.onChildrenChange(i)},t.prototype.getChildAt=function(e){if(e<0||e>=this.children.length)throw new Error("getChildAt: Index ("+e+") does not exist.");return this.children[e]},t.prototype.removeChild=function(){for(var e=arguments,i=[],r=0;r<arguments.length;r++)i[r]=e[r];if(i.length>1)for(var n=0;n<i.length;n++)this.removeChild(i[n]);else{var a=i[0],o=this.children.indexOf(a);if(o===-1)return null;a.parent=null,a.transform._parentID=-1,cu(this.children,o,1),this._boundsID++,this.onChildrenChange(o),a.emit("removed",this),this.emit("childRemoved",a,this,o)}return i[0]},t.prototype.removeChildAt=function(e){var i=this.getChildAt(e);return i.parent=null,i.transform._parentID=-1,cu(this.children,e,1),this._boundsID++,this.onChildrenChange(e),i.emit("removed",this),this.emit("childRemoved",i,this,e),i},t.prototype.removeChildren=function(e,i){e===void 0&&(e=0),i===void 0&&(i=this.children.length);var r=e,n=i,a=n-r,o;if(a>0&&a<=n){o=this.children.splice(r,a);for(var h=0;h<o.length;++h)o[h].parent=null,o[h].transform&&(o[h].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(var h=0;h<o.length;++h)o[h].emit("removed",this),this.emit("childRemoved",o[h],this,h);return o}else if(a===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},t.prototype.sortChildren=function(){for(var e=!1,i=0,r=this.children.length;i<r;++i){var n=this.children[i];n._lastSortedIndex=i,!e&&n.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(Mb),this.sortDirty=!1},t.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var e=0,i=this.children.length;e<i;++e){var r=this.children[e];r.visible&&r.updateTransform()}},t.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var e=0;e<this.children.length;e++){var i=this.children[e];if(!(!i.visible||!i.renderable))if(i.calculateBounds(),i._mask){var r=i._mask.isMaskData?i._mask.maskObject:i._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(i._bounds,r._bounds)):this._bounds.addBounds(i._bounds)}else i.filterArea?this._bounds.addBoundsArea(i._bounds,i.filterArea):this._bounds.addBounds(i._bounds)}this._bounds.updateID=this._boundsID},t.prototype.getLocalBounds=function(e,i){i===void 0&&(i=!1);var r=s.prototype.getLocalBounds.call(this,e);if(!i)for(var n=0,a=this.children.length;n<a;++n){var o=this.children[n];o.visible&&o.updateTransform()}return r},t.prototype._calculateBounds=function(){},t.prototype._renderWithCulling=function(e){var i=e.renderTexture.sourceFrame;if(i.width>0&&i.height>0){var r,n;if(this.cullArea?(r=this.cullArea,n=this.worldTransform):this._render!==t.prototype._render&&(r=this.getBounds(!0)),r&&i.intersects(r,n))this._render(e);else if(this.cullArea)return;for(var a=0,o=this.children.length;a<o;++a){var h=this.children[a],u=h.cullable;h.cullable=u||!this.cullArea,h.render(e),h.cullable=u}}},t.prototype.render=function(e){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(var i=0,r=this.children.length;i<r;++i)this.children[i].render(e)}},t.prototype.renderAdvanced=function(e){var i=this.filters,r=this._mask;if(i){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var n=0;n<i.length;n++)i[n].enabled&&this._enabledFilters.push(i[n])}var a=i&&this._enabledFilters&&this._enabledFilters.length||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==Re.NONE));if(a&&e.batch.flush(),i&&this._enabledFilters&&this._enabledFilters.length&&e.filter.push(this,this._enabledFilters),r&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(var n=0,o=this.children.length;n<o;++n)this.children[n].render(e)}a&&e.batch.flush(),r&&e.mask.pop(this),i&&this._enabledFilters&&this._enabledFilters.length&&e.filter.pop()},t.prototype._render=function(e){},t.prototype.destroy=function(e){s.prototype.destroy.call(this),this.sortDirty=!1;var i=typeof e=="boolean"?e:e&&e.children,r=this.removeChildren(0,this.children.length);if(i)for(var n=0;n<r.length;++n)r[n].destroy(e)},Object.defineProperty(t.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(e){var i=this.getLocalBounds().width;i!==0?this.scale.x=e/i:this.scale.x=1,this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(e){var i=this.getLocalBounds().height;i!==0?this.scale.y=e/i:this.scale.y=1,this._height=e},enumerable:!1,configurable:!0}),t}(pe);pi.prototype.containerUpdateTransform=pi.prototype.updateTransform;class Po{__init(){this.tileAnim=[0,0]}__init2(){this.dontUseTransform=!1}constructor(t){Po.prototype.__init.call(this),Po.prototype.__init2.call(this),this.renderer=t,this.tileAnim=[0,0]}static getInstance(t){return t.plugins.tilemap||(t.plugins.tilemap=new Po(t)),t.plugins.tilemap}}const B_={TEXTURES_PER_TILEMAP:16,TEXTILE_DIMEN:1024,TEXTILE_UNITS:1,TEXTILE_SCALE_MODE:hs.LINEAR,use32bitIndex:!1,DO_CLEAR:!0,get maxTextures(){return this.MAX_TEXTURES},set maxTextures(s){this.MAX_TEXTURES=s},get boundSize(){return this.TEXTURE_TILE_DIMEN},set boundSize(s){this.TILE_TEXTURE_DIMEN=s},get boundCountPerBuffer(){return this.TEXTILE_UNITS},set boundCountPerBuffer(s){this.TEXTILE_UNITS=s}};function nu(s,t){return s??t()}var Lt;(function(s){s[s.U=0]="U";const e=0+1;s[s.V=e]="V";const i=e+1;s[s.X=i]="X";const r=i+1;s[s.Y=r]="Y";const n=r+1;s[s.TILE_WIDTH=n]="TILE_WIDTH";const a=n+1;s[s.TILE_HEIGHT=a]="TILE_HEIGHT";const o=a+1;s[s.ROTATE=o]="ROTATE";const h=o+1;s[s.ANIM_X=h]="ANIM_X";const u=h+1;s[s.ANIM_Y=u]="ANIM_Y";const c=u+1;s[s.TEXTURE_INDEX=c]="TEXTURE_INDEX";const l=c+1;s[s.ANIM_COUNT_X=l]="ANIM_COUNT_X";const _=l+1;s[s.ANIM_COUNT_Y=_]="ANIM_COUNT_Y";const d=_+1;s[s.ANIM_DIVISOR=d]="ANIM_DIVISOR";const g=d+1;s[s.ALPHA=g]="ALPHA"})(Lt||(Lt={}));const ti=Object.keys(Lt).length/2;class be extends pi{__init(){this.shadowColor=new Float32Array([0,0,0,.5])}__init2(){this._globalMat=null}__init3(){this.tileAnim=null}__init4(){this.modificationMarker=0}__init5(){this.offsetX=0}__init6(){this.offsetY=0}__init7(){this.compositeParent=!1}__init8(){this.tilemapBounds=new qo}__init9(){this.hasAnimatedTile=!1}__init10(){this.pointsBuf=[]}constructor(t){super(),be.prototype.__init.call(this),be.prototype.__init2.call(this),be.prototype.__init3.call(this),be.prototype.__init4.call(this),be.prototype.__init5.call(this),be.prototype.__init6.call(this),be.prototype.__init7.call(this),be.prototype.__init8.call(this),be.prototype.__init9.call(this),be.prototype.__init10.call(this),be.prototype.__init11.call(this),be.prototype.__init12.call(this),be.prototype.__init13.call(this),be.prototype.__init14.call(this),be.prototype.__init15.call(this),be.prototype.__init16.call(this),this.setTileset(t)}getTileset(){return this.tileset}setTileset(t=[]){Array.isArray(t)||(t=[t]);for(let e=0;e<t.length;e++)t[e].baseTexture&&(t[e]=t[e].baseTexture);return this.tileset=t,this}clear(){return this.pointsBuf.length=0,this.modificationMarker=0,this.tilemapBounds.clear(),this.hasAnimatedTile=!1,this}tile(t,e,i,r={}){let n,a=-1;if(typeof t=="number")a=t,n=this.tileset[a];else{let O;typeof t=="string"?O=ut.from(t):O=t;const v=this.tileset;for(let y=0;y<v.length;y++)if(v[y]===O.castToBaseTexture()){a=y;break}"baseTexture"in O&&(r.u=nu(r.u,()=>O.frame.x),r.v=nu(r.v,()=>O.frame.y),r.tileWidth=nu(r.tileWidth,()=>O.orig.width),r.tileHeight=nu(r.tileHeight,()=>O.orig.height)),n=O.castToBaseTexture()}if(!n||a<0)return console.error("The tile texture was not found in the tilemap tileset."),this;const{u:o=0,v:h=0,tileWidth:u=n.realWidth,tileHeight:c=n.realHeight,animX:l=0,animY:_=0,rotate:d=0,animCountX:g=1024,animCountY:m=1024,animDivisor:p=1,alpha:T=1}=r,A=this.pointsBuf;return this.hasAnimatedTile=this.hasAnimatedTile||l>0||_>0,A.push(o),A.push(h),A.push(e),A.push(i),A.push(u),A.push(c),A.push(d),A.push(l|0),A.push(_|0),A.push(a),A.push(g),A.push(m),A.push(p),A.push(T),this.tilemapBounds.addFramePad(e,i,e+u,i+c,0,0),this}tileRotate(t){const e=this.pointsBuf;e[e.length-(ti-Lt.TEXTURE_INDEX)]=t}tileAnimX(t,e){const i=this.pointsBuf;i[i.length-(ti-Lt.ANIM_X)]=t,i[i.length-(ti-Lt.ANIM_COUNT_X)]=e}tileAnimY(t,e){const i=this.pointsBuf;i[i.length-(ti-Lt.ANIM_Y)]=t,i[i.length-(ti-Lt.ANIM_COUNT_Y)]=e}tileAnimDivisor(t){const e=this.pointsBuf;e[e.length-(ti-Lt.ANIM_DIVISOR)]=t}tileAlpha(t){const e=this.pointsBuf;e[e.length-(ti-Lt.ALPHA)]=t}__init11(){this.renderCanvas=t=>{const e=Po.getInstance(t);if(e&&!e.dontUseTransform){const i=this.worldTransform;t.context.setTransform(i.a,i.b,i.c,i.d,i.tx*t.resolution,i.ty*t.resolution)}this.renderCanvasCore(t)}}renderCanvasCore(t){if(this.tileset.length===0)return;const e=this.pointsBuf,i=this.tileAnim||t.plugins.tilemap&&t.plugins.tilemap.tileAnim;t.context.fillStyle="#000000";for(let r=0,n=e.length;r<n;r+=ti){let a=e[r+Lt.U],o=e[r+Lt.V];const h=e[r+Lt.X],u=e[r+Lt.Y],c=e[r+Lt.TILE_WIDTH],l=e[r+Lt.TILE_HEIGHT];a+=e[r+Lt.ANIM_X]*i[0],o+=e[r+Lt.ANIM_Y]*i[1];const _=e[r+Lt.TEXTURE_INDEX],d=e[r+Lt.ALPHA];_>=0&&this.tileset[_]?(t.context.globalAlpha=d,t.context.drawImage(this.tileset[_].getDrawableSource(),a,o,c,l,h,u,c,l)):(t.context.globalAlpha=.5,t.context.fillRect(h,u,c,l)),t.context.globalAlpha=1}}__init12(){this.vbId=0}__init13(){this.vb=null}__init14(){this.vbBuffer=null}__init15(){this.vbArray=null}__init16(){this.vbInts=null}destroyVb(){this.vb&&(this.vb.destroy(),this.vb=null)}render(t){const e=t.plugins.tilemap,i=e.getShader();t.batch.setObjectRenderer(e),this._globalMat=i.uniforms.projTransMatrix,t.globalUniforms.uniforms.projectionMatrix.copyTo(this._globalMat).append(this.worldTransform),i.uniforms.shadowColor=this.shadowColor,i.uniforms.animationFrame=this.tileAnim||e.tileAnim,this.renderWebGLCore(t,e)}renderWebGLCore(t,e){const i=this.pointsBuf;if(i.length===0)return;const r=i.length/ti,n=e.getShader(),a=this.tileset;if(a.length===0)return;e.bindTileTextures(t,a),t.shader.bind(n,!1);let o=this.vb;o||(o=e.createVb(),this.vb=o,this.vbId=o.id,this.vbBuffer=null,this.modificationMarker=0),e.checkIndexBuffer(r,o);const h=o.getBuffer("aVertexPosition"),u=r*o.vertPerQuad;if(u!==0){if(this.modificationMarker!==u){this.modificationMarker=u;const c=o.stride*u;if(!this.vbBuffer||this.vbBuffer.byteLength<c){let p=o.stride;for(;p<c;)p*=2;this.vbBuffer=new ArrayBuffer(p),this.vbArray=new Float32Array(this.vbBuffer),this.vbInts=new Uint32Array(this.vbBuffer),h.update(this.vbBuffer)}const l=this.vbArray;let _=0,d=0,g=this.offsetX,m=this.offsetY;for(let p=0;p<i.length;p+=ti){this.compositeParent&&(d=i[p+Lt.TEXTURE_INDEX],g=0,m=0);const A=i[p+Lt.X],O=i[p+Lt.Y],v=i[p+Lt.TILE_WIDTH],y=i[p+Lt.TILE_HEIGHT],C=i[p+Lt.U]+g,N=i[p+Lt.V]+m;let L=i[p+Lt.ROTATE];const P=i[p+Lt.ANIM_X],b=i[p+Lt.ANIM_Y],w=i[p+Lt.ANIM_COUNT_X]||1024,q=i[p+Lt.ANIM_COUNT_Y]||1024,ht=P+w*2048,dt=b+q*2048,j=i[p+Lt.ANIM_DIVISOR],V=i[p+Lt.ALPHA];let Dt,Fe,qe,X,st,gt,Et,pt;if(L===0)Dt=C,Fe=N,qe=C+v,X=N,st=C+v,gt=N+y,Et=C,pt=N+y;else{let Gt=v/2,jt=y/2;L%4!==0&&(Gt=y/2,jt=v/2);const Jt=C+Gt,ee=N+jt;L=Nt.add(L,Nt.NW),Dt=Jt+Gt*Nt.uX(L),Fe=ee+jt*Nt.uY(L),L=Nt.add(L,2),qe=Jt+Gt*Nt.uX(L),X=ee+jt*Nt.uY(L),L=Nt.add(L,2),st=Jt+Gt*Nt.uX(L),gt=ee+jt*Nt.uY(L),L=Nt.add(L,2),Et=Jt+Gt*Nt.uX(L),pt=ee+jt*Nt.uY(L)}l[_++]=A,l[_++]=O,l[_++]=Dt,l[_++]=Fe,l[_++]=C+.5,l[_++]=N+.5,l[_++]=C+v-.5,l[_++]=N+y-.5,l[_++]=ht,l[_++]=dt,l[_++]=d,l[_++]=j,l[_++]=V,l[_++]=A+v,l[_++]=O,l[_++]=qe,l[_++]=X,l[_++]=C+.5,l[_++]=N+.5,l[_++]=C+v-.5,l[_++]=N+y-.5,l[_++]=ht,l[_++]=dt,l[_++]=d,l[_++]=j,l[_++]=V,l[_++]=A+v,l[_++]=O+y,l[_++]=st,l[_++]=gt,l[_++]=C+.5,l[_++]=N+.5,l[_++]=C+v-.5,l[_++]=N+y-.5,l[_++]=ht,l[_++]=dt,l[_++]=d,l[_++]=j,l[_++]=V,l[_++]=A,l[_++]=O+y,l[_++]=Et,l[_++]=pt,l[_++]=C+.5,l[_++]=N+.5,l[_++]=C+v-.5,l[_++]=N+y-.5,l[_++]=ht,l[_++]=dt,l[_++]=d,l[_++]=j,l[_++]=V}h.update(l)}t.geometry.bind(o,n),t.geometry.draw(oi.TRIANGLES,r*6,0)}}isModified(t){return!!(this.modificationMarker!==this.pointsBuf.length||t&&this.hasAnimatedTile)}clearModify(){this.modificationMarker=this.pointsBuf.length}_calculateBounds(){const{minX:t,minY:e,maxX:i,maxY:r}=this.tilemapBounds;this._bounds.addFrame(this.transform,t,e,i,r)}getLocalBounds(t){return this.children.length===0?this.tilemapBounds.getRectangle(t):super.getLocalBounds.call(this,t)}destroy(t){super.destroy(t),this.destroyVb()}addFrame(t,e,i,r,n){return this.tile(t,e,i,{animX:r,animY:n}),!0}addRect(t,e,i,r,n,a,o,h=0,u=0,c=0,l=1024,_=1024,d=1,g=1){return this.tile(t,r,n,{u:e,v:i,tileWidth:a,tileHeight:o,animX:h,animY:u,rotate:c,animCountX:l,animCountY:_,animDivisor:d,alpha:g})}}function Nb(s){let t="";t+=`
`,t+=`
`,t+="if(vTextureId <= -1.0) {",t+=`
	color = shadowColor;`,t+=`
}`;for(let e=0;e<s;e++)t+=`
else `,e<s-1&&(t+=`if(textureId == ${e}.0)`),t+=`
{`,t+=`
	color = texture2D(uSamplers[${e}], textureCoord * uSamplerSize[${e}]);`,t+=`
}`;return t+=`
`,t+=`
`,t}function Pb(s,t){const e=[];for(let r=0;r<t;r++)e[r]=r;s.uniforms.uSamplers=e;const i=[];for(let r=0;r<t;r++)i.push(1/2048),i.push(1/2048);s.uniforms.uSamplerSize=i}function bb(s,t){return t.replace(/%count%/gi,`${s}`).replace(/%forloop%/gi,Nb(s))}const Db=`#version 100
precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aFrame;
attribute vec2 aAnim;
attribute float aAnimDivisor;
attribute float aTextureId;
attribute float aAlpha;

uniform mat3 projTransMatrix;
uniform vec2 animationFrame;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vFrame;
varying float vAlpha;

void main(void)
{
   gl_Position = vec4((projTransMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vec2 animCount = floor((aAnim + 0.5) / 2048.0);
   vec2 animFrameOffset = aAnim - animCount * 2048.0;
   vec2 currentFrame = floor(animationFrame / aAnimDivisor);
   vec2 animOffset = animFrameOffset * floor(mod(currentFrame + 0.5, animCount));

   vTextureCoord = aTextureCoord + animOffset;
   vFrame = aFrame + vec4(animOffset, animOffset);
   vTextureId = aTextureId;
   vAlpha = aAlpha;
}
`,Lb=`#version 100
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
varying vec2 vTextureCoord;
varying vec4 vFrame;
varying float vTextureId;
varying float vAlpha;
uniform vec4 shadowColor;
uniform sampler2D uSamplers[%count%];
uniform vec2 uSamplerSize[%count%];

void main(void)
{
   vec2 textureCoord = clamp(vTextureCoord, vFrame.xy, vFrame.zw);
   float textureId = floor(vTextureId + 0.5);

   vec4 color;
   %forloop%
   gl_FragColor = color * vAlpha;
}
`;class Af extends vn{__init(){this.maxTextures=0}constructor(t){super(new Rl(Db,bb(t,Lb)),{animationFrame:new Float32Array(2),uSamplers:[],uSamplerSize:[],projTransMatrix:new wt}),Af.prototype.__init.call(this),this.maxTextures=t,Pb(this,this.maxTextures)}}class oa extends Il{__init2(){this.vertSize=13}__init3(){this.vertPerQuad=4}__init4(){this.stride=this.vertSize*4}__init5(){this.lastTimeAccess=0}constructor(){super(),oa.prototype.__init2.call(this),oa.prototype.__init3.call(this),oa.prototype.__init4.call(this),oa.prototype.__init5.call(this);const t=this.buf=new ts(new Float32Array(2),!0,!1);this.addAttribute("aVertexPosition",t,0,!1,0,this.stride,0).addAttribute("aTextureCoord",t,0,!1,0,this.stride,2*4).addAttribute("aFrame",t,0,!1,0,this.stride,4*4).addAttribute("aAnim",t,0,!1,0,this.stride,8*4).addAttribute("aTextureId",t,0,!1,0,this.stride,10*4).addAttribute("aAnimDivisor",t,0,!1,0,this.stride,11*4).addAttribute("aAlpha",t,0,!1,0,this.stride,12*4)}}class ha extends Tl{__init(){this.tileAnim=[0,0]}__init2(){this.ibLen=0}__init3(){this.indexBuffer=null}__init4(){this.textiles=[]}constructor(t){super(t),ha.prototype.__init.call(this),ha.prototype.__init2.call(this),ha.prototype.__init3.call(this),ha.prototype.__init4.call(this),this.shader=new Af(B_.TEXTURES_PER_TILEMAP),this.indexBuffer=new ts(void 0,!0,!0),this.checkIndexBuffer(2e3),this.makeTextiles()}bindTileTextures(t,e){const i=e.length,r=this.shader,n=B_.TEXTURES_PER_TILEMAP,a=r.uniforms.uSamplerSize;if(!(i>B_.TEXTILE_UNITS*n)){for(let o=0;o<e.length;o++){const h=e[o];if(!h||!h.valid)return;t.texture.bind(e[o],o),a[o*2]=1/e[o].realWidth,a[o*2+1]=1/e[o].realHeight}r.uniforms.uSamplerSize=a}}start(){}createVb(){const t=new oa;return t.addIndex(this.indexBuffer),t.lastTimeAccess=Date.now(),t}getShader(){return this.shader}destroy(){super.destroy(),this.shader=null}checkIndexBuffer(t,e=null){const i=t*6;i<=this.ibLen||(this.ibLen=i,this.indexBuffer.update(tC(t,void 0)))}makeTextiles(){}}cf.registerPlugin("tilemap",ha);class Ub extends Ua{constructor(t){super(`attribute vec2 aVertexPosition;
            attribute vec2 aTextureCoord;
            
            uniform mat3 projectionMatrix;
            
            varying vec2 vTextureCoord;
            
            void main(void)
            {
                gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
                vTextureCoord = aTextureCoord;
            }`,`varying vec2 vTextureCoord;
            uniform sampler2D uSampler;
            
            uniform float gamma;
            uniform float contrast;
            uniform float saturation;
            uniform float brightness;
            uniform float red;
            uniform float green;
            uniform float blue;
            uniform float alpha;
            
            void main(void)
            {
                vec4 c = texture2D(uSampler, vTextureCoord);
            
                if (c.a > 0.0) {
                    c.rgb /= c.a;
            
                    vec3 rgb = pow(c.rgb, vec3(1. / gamma));
                    rgb = mix(vec3(.5), mix(vec3(dot(vec3(.2125, .7154, .0721), rgb)), rgb, saturation), contrast);
                    rgb.r *= red;
                    rgb.g *= green;
                    rgb.b *= blue;
                    c.rgb = rgb * brightness;
            
                    c.rgb *= c.a;
                }
            
                gl_FragColor = c * alpha;
            }`),this.gamma=1,this.saturation=1,this.contrast=1,this.brightness=1,this.red=1,this.green=1,this.blue=1,this.alpha=1,Object.assign(this,t)}apply(t,e,i,r){this.uniforms.gamma=Math.max(this.gamma,1e-4),this.uniforms.saturation=this.saturation,this.uniforms.contrast=this.contrast,this.uniforms.brightness=this.brightness,this.uniforms.red=this.red,this.uniforms.green=this.green,this.uniforms.blue=this.blue,this.uniforms.alpha=this.alpha,t.applyFilter(this,e,i,r)}}const xb=`
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
uniform mat3 projectionMatrix;
varying vec2 vTextureCoord;
void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Fb=`
varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform sampler2D mask;
uniform int fromChannel;
uniform int toChannel;

void main(void) {
    vec4 maskColor = texture2D(mask, vTextureCoord);
    vec4 currentColor = texture2D(uSampler, vTextureCoord);
    vec4 adjusted = currentColor;

    if(maskColor.r == 0.0 && maskColor.g == 0.0 && maskColor.b == 0.0)
    {
        adjusted.a = 0.0;
    }

    gl_FragColor = vec4(adjusted.r, adjusted.g, adjusted.b, adjusted.a);
}`;class yl extends Ua{constructor(t,e,i){super(xb,Fb,{mask:t.castToBaseTexture(),fromChannel:e,toChannel:i})}}yl.CHANNEL_RED=0;yl.CHANNEL_GREEN=1;yl.CHANNEL_BLUE=2;yl.CHANNEL_ALPHA=3;/*!
 * @pixi/app - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/app is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var wb=function(){function s(){}return s.init=function(t){var e=this;Object.defineProperty(this,"resizeTo",{set:function(i){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=i,i&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){e._resizeTo&&(e.cancelResize(),e._resizeId=requestAnimationFrame(function(){return e.resize()}))},this.cancelResize=function(){e._resizeId&&(cancelAnimationFrame(e._resizeId),e._resizeId=null)},this.resize=function(){if(e._resizeTo){e.cancelResize();var i,r;if(e._resizeTo===globalThis.window)i=globalThis.innerWidth,r=globalThis.innerHeight;else{var n=e._resizeTo,a=n.clientWidth,o=n.clientHeight;i=a,r=o}e.renderer.resize(i,r)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null},s.destroy=function(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},s.extension=ve.Application,s}(),Fm=function(){function s(t){var e=this;this.stage=new pi,t=Object.assign({forceCanvas:!1},t),this.renderer=DM(t),s._plugins.forEach(function(i){i.init.call(e,t)})}return s.registerPlugin=function(t){ci("6.5.0","Application.registerPlugin() is deprecated, use extensions.add()"),er.add({type:ve.Application,ref:t})},s.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(s.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),s.prototype.destroy=function(t,e){var i=this,r=s._plugins.slice(0);r.reverse(),r.forEach(function(n){n.destroy.call(i)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null},s._plugins=[],s}();er.handleByList(ve.Application,Fm._plugins);er.add(wb);const Sc=class extends Fm{constructor(s){super(s),Sc.INSTANCE||(Sc.INSTANCE=this)}static get instance(){return this.INSTANCE||null}};let Ae=Sc;Ae.INSTANCE=null;const Bi=()=>{var s;return((s=Ae.instance)==null?void 0:s.ticker)||null},Gb=()=>{var s;return((s=Bi())==null?void 0:s.FPS)||0},_t=()=>{var s;return((s=Bi())==null?void 0:s.lastTime)||0};/*!
 * @pixi/filter-alpha - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/filter-alpha is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var yc=function(s,t){return yc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])},yc(s,t)};function Bb(s,t){yc(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Hb=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`,Cc=function(s){Bb(t,s);function t(e){e===void 0&&(e=1);var i=s.call(this,xM,Hb,{uAlpha:1})||this;return i.alpha=e,i}return Object.defineProperty(t.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(e){this.uniforms.uAlpha=e},enumerable:!1,configurable:!0}),t}(Ua);class Wq extends Cc{}class Vb extends Yt{}class Hs extends pi{}class kb extends Ua{}class zu extends H{}class Xq extends et{}/*!
 * @pixi/sprite - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/sprite is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Mc=function(s,t){return Mc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])},Mc(s,t)};function jb(s,t){Mc(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var ro=new H,zb=new Uint16Array([0,1,2,0,2,3]),Wt=function(s){jb(t,s);function t(e){var i=s.call(this)||this;return i._anchor=new aa(i._onAnchorUpdate,i,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),i._texture=null,i._width=0,i._height=0,i._tint=null,i._tintRGB=null,i.tint=16777215,i.blendMode=J.NORMAL,i._cachedTint=16777215,i.uvs=null,i.texture=e||ut.EMPTY,i.vertexData=new Float32Array(8),i.vertexTrimmedData=null,i._transformID=-1,i._textureID=-1,i._transformTrimmedID=-1,i._textureTrimmedID=-1,i.indices=zb,i.pluginName="batch",i.isSprite=!0,i._roundPixels=Z.ROUND_PIXELS,i}return t.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=na(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=na(this.scale.y)*this._height/this._texture.orig.height)},t.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},t.prototype.calculateVertices=function(){var e=this._texture;if(!(this._transformID===this.transform._worldID&&this._textureID===e._updateID)){this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;var i=this.transform.worldTransform,r=i.a,n=i.b,a=i.c,o=i.d,h=i.tx,u=i.ty,c=this.vertexData,l=e.trim,_=e.orig,d=this._anchor,g=0,m=0,p=0,T=0;if(l?(m=l.x-d._x*_.width,g=m+l.width,T=l.y-d._y*_.height,p=T+l.height):(m=-d._x*_.width,g=m+_.width,T=-d._y*_.height,p=T+_.height),c[0]=r*m+a*T+h,c[1]=o*T+n*m+u,c[2]=r*g+a*T+h,c[3]=o*T+n*g+u,c[4]=r*g+a*p+h,c[5]=o*p+n*g+u,c[6]=r*m+a*p+h,c[7]=o*p+n*m+u,this._roundPixels)for(var A=Z.RESOLUTION,O=0;O<c.length;++O)c[O]=Math.round((c[O]*A|0)/A)}},t.prototype.calculateTrimmedVertices=function(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var e=this._texture,i=this.vertexTrimmedData,r=e.orig,n=this._anchor,a=this.transform.worldTransform,o=a.a,h=a.b,u=a.c,c=a.d,l=a.tx,_=a.ty,d=-n._x*r.width,g=d+r.width,m=-n._y*r.height,p=m+r.height;i[0]=o*d+u*m+l,i[1]=c*m+h*d+_,i[2]=o*g+u*m+l,i[3]=c*m+h*g+_,i[4]=o*g+u*p+l,i[5]=c*p+h*g+_,i[6]=o*d+u*p+l,i[7]=c*p+h*d+_},t.prototype._render=function(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)},t.prototype._calculateBounds=function(){var e=this._texture.trim,i=this._texture.orig;!e||e.width===i.width&&e.height===i.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},t.prototype.getLocalBounds=function(e){return this.children.length===0?(this._localBounds||(this._localBounds=new qo),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new et),e=this._localBoundsRect),this._localBounds.getRectangle(e)):s.prototype.getLocalBounds.call(this,e)},t.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,ro);var i=this._texture.orig.width,r=this._texture.orig.height,n=-i*this.anchor.x,a=0;return ro.x>=n&&ro.x<n+i&&(a=-r*this.anchor.y,ro.y>=a&&ro.y<a+r)},t.prototype.destroy=function(e){s.prototype.destroy.call(this,e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null;var i=typeof e=="boolean"?e:e&&e.texture;if(i){var r=typeof e=="boolean"?e:e&&e.baseTexture;this._texture.destroy(!!r)}this._texture=null},t.from=function(e,i){var r=e instanceof ut?e:ut.from(e,i);return new t(r)},Object.defineProperty(t.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(e){var i=na(this.scale.x)||1;this.scale.x=i*e/this._texture.orig.width,this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(e){var i=na(this.scale.y)||1;this.scale.y=i*e/this._texture.orig.height,this._height=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anchor",{get:function(){return this._anchor},set:function(e){this._anchor.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tint",{get:function(){return this._tint},set:function(e){this._tint=e,this._tintRGB=(e>>16)+(e&65280)+((e&255)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||ut.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),t}(pi);class se extends Wt{}class wm extends ut{}class Kq extends be{}const Yb=`
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
uniform mat3 projectionMatrix;
varying vec2 vTextureCoord;
void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Wb=`
varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform sampler2D lut;
uniform int channel;

void main(void) {
    vec4 currentColor = texture2D(uSampler, vTextureCoord);
    vec4 adjusted = currentColor;

    if(currentColor.a > 0.0)
    {
        if(channel == 0)
        {
            adjusted = texture2D(lut, vec2((currentColor.r * 255.0 + 0.5) / 256.0, 0.5));
        } else if(channel == 1) {
            adjusted = texture2D(lut, vec2((currentColor.g * 255.0 + 0.5) / 256.0, 0.5));
        } else if(channel == 2) {
            adjusted = texture2D(lut, vec2((currentColor.b * 255.0 + 0.5) / 256.0, 0.5));
        } else if(channel == 3) {
            adjusted = texture2D(lut, vec2((currentColor.a * 255.0 + 0.5) / 256.0, 0.5));
        }
    }

    gl_FragColor = vec4(adjusted.r, adjusted.g, adjusted.b, currentColor.a);
}`,Xn=class extends kb{constructor(s,t=Xn.CHANNEL_RED){super(Yb,Wb),this._channel=t;let e=[];e=this.getLutForPalette(s),this._lut=Vb.fromBuffer(Uint8Array.from(e),e.length/4,1,{mipmap:0,scaleMode:0}),this.uniforms.lut=this._lut,this.uniforms.channel=this._channel}getLutForPalette(s){const t=[];for(let e=0;e<s.length;e++)t[e*4+Xn.CHANNEL_RED]=s[e]>>16&255,t[e*4+Xn.CHANNEL_GREEN]=s[e]>>8&255,t[e*4+Xn.CHANNEL_BLUE]=s[e]&255,t[e*4+Xn.CHANNEL_ALPHA]=s[e]>>24&255;return t}get lut(){return this._lut}get channel(){return this._channel}};let Ca=Xn;Ca.CHANNEL_RED=0;Ca.CHANNEL_GREEN=1;Ca.CHANNEL_BLUE=2;Ca.CHANNEL_ALPHA=3;/*!
 * @pixi/interaction - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/interaction is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var XE=function(){function s(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new H,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(s.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),s.prototype.getLocalPosition=function(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)},s.prototype.copyEvent=function(t){"isPrimary"in t&&t.isPrimary&&(this.isPrimary=!0),this.button="button"in t&&t.button;var e="buttons"in t&&t.buttons;this.buttons=Number.isInteger(e)?e:"which"in t&&t.which,this.width="width"in t&&t.width,this.height="height"in t&&t.height,this.tiltX="tiltX"in t&&t.tiltX,this.tiltY="tiltY"in t&&t.tiltY,this.pointerType="pointerType"in t&&t.pointerType,this.pressure="pressure"in t&&t.pressure,this.rotationAngle="rotationAngle"in t&&t.rotationAngle,this.twist="twist"in t&&t.twist||0,this.tangentialPressure="tangentialPressure"in t&&t.tangentialPressure||0},s.prototype.reset=function(){this.isPrimary=!1},s}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Nc=function(s,t){return Nc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])},Nc(s,t)};function Xb(s,t){Nc(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Kb=function(){function s(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return s.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},s.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},s}(),H_=function(){function s(t){this._pointerId=t,this._flags=s.FLAGS.NONE}return s.prototype._doSet=function(t,e){e?this._flags=this._flags|t:this._flags=this._flags&~t},Object.defineProperty(s.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"flags",{get:function(){return this._flags},set:function(t){this._flags=t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"none",{get:function(){return this._flags===s.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"over",{get:function(){return(this._flags&s.FLAGS.OVER)!==0},set:function(t){this._doSet(s.FLAGS.OVER,t)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"rightDown",{get:function(){return(this._flags&s.FLAGS.RIGHT_DOWN)!==0},set:function(t){this._doSet(s.FLAGS.RIGHT_DOWN,t)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"leftDown",{get:function(){return(this._flags&s.FLAGS.LEFT_DOWN)!==0},set:function(t){this._doSet(s.FLAGS.LEFT_DOWN,t)},enumerable:!1,configurable:!0}),s.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),s}(),qb=function(){function s(){this._tempPoint=new H}return s.prototype.recursiveFindHit=function(t,e,i,r,n){var a;if(!e||!e.visible)return!1;var o=t.data.global;n=e.interactive||n;var h=!1,u=n,c=!0;if(e.hitArea)r&&(e.worldTransform.applyInverse(o,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?h=!0:(r=!1,c=!1)),u=!1;else if(e._mask&&r){var l=e._mask.isMaskData?e._mask.maskObject:e._mask;l&&!(!((a=l.containsPoint)===null||a===void 0)&&a.call(l,o))&&(r=!1)}if(c&&e.interactiveChildren&&e.children)for(var _=e.children,d=_.length-1;d>=0;d--){var g=_[d],m=this.recursiveFindHit(t,g,i,r,u);if(m){if(!g.parent)continue;u=!1,m&&(t.target&&(r=!1),h=!0)}}return n&&(r&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(o)&&(h=!0),e.interactive&&(h&&!t.target&&(t.target=e),i&&i(t,e,!!h))),h},s.prototype.findHit=function(t,e,i,r){this.recursiveFindHit(t,e,i,r,!1)},s}(),Zb={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return this.cursor==="pointer"},set buttonMode(s){s?this.cursor="pointer":this.cursor==="pointer"&&(this.cursor=null)},cursor:null,get trackedPointers(){return this._trackedPointers===void 0&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};pe.mixin(Zb);var au=1,ou={target:null,data:{global:null}},Qb=function(s){Xb(t,s);function t(e,i){var r=s.call(this)||this;return i=i||{},r.renderer=e,r.autoPreventDefault=i.autoPreventDefault!==void 0?i.autoPreventDefault:!0,r.interactionFrequency=i.interactionFrequency||10,r.mouse=new XE,r.mouse.identifier=au,r.mouse.global.set(-999999),r.activeInteractionData={},r.activeInteractionData[au]=r.mouse,r.interactionDataPool=[],r.eventData=new Kb,r.interactionDOMElement=null,r.moveWhenInside=!1,r.eventsAdded=!1,r.tickerAdded=!1,r.mouseOverRenderer=!("PointerEvent"in globalThis),r.supportsTouchEvents="ontouchstart"in globalThis,r.supportsPointerEvents=!!globalThis.PointerEvent,r.onPointerUp=r.onPointerUp.bind(r),r.processPointerUp=r.processPointerUp.bind(r),r.onPointerCancel=r.onPointerCancel.bind(r),r.processPointerCancel=r.processPointerCancel.bind(r),r.onPointerDown=r.onPointerDown.bind(r),r.processPointerDown=r.processPointerDown.bind(r),r.onPointerMove=r.onPointerMove.bind(r),r.processPointerMove=r.processPointerMove.bind(r),r.onPointerOut=r.onPointerOut.bind(r),r.processPointerOverOut=r.processPointerOverOut.bind(r),r.onPointerOver=r.onPointerOver.bind(r),r.cursorStyles={default:"inherit",pointer:"pointer"},r.currentCursorMode=null,r.cursor=null,r.resolution=1,r.delayedEvents=[],r.search=new qb,r._tempDisplayObject=new xm,r._eventListenerOptions={capture:!0,passive:!1},r._useSystemTicker=i.useSystemTicker!==void 0?i.useSystemTicker:!0,r.setTargetElement(r.renderer.view,r.renderer.resolution),r}return Object.defineProperty(t.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(e){this._useSystemTicker=e,e?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),t.prototype.hitTest=function(e,i){return ou.target=null,ou.data.global=e,i||(i=this.lastObjectRendered),this.processInteractive(ou,i,null,!0),ou.target},t.prototype.setTargetElement=function(e,i){i===void 0&&(i=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=e,this.resolution=i,this.addEvents(),this.addTickerListener()},t.prototype.addTickerListener=function(){this.tickerAdded||!this.interactionDOMElement||!this._useSystemTicker||(ni.system.add(this.tickerUpdate,this,Aa.INTERACTION),this.tickerAdded=!0)},t.prototype.removeTickerListener=function(){this.tickerAdded&&(ni.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},t.prototype.addEvents=function(){if(!(this.eventsAdded||!this.interactionDOMElement)){var e=this.interactionDOMElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none"),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),globalThis.addEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),globalThis.addEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),globalThis.addEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.eventsAdded=!0}},t.prototype.removeEvents=function(){if(!(!this.eventsAdded||!this.interactionDOMElement)){var e=this.interactionDOMElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),globalThis.removeEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),globalThis.removeEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),globalThis.removeEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.interactionDOMElement=null,this.eventsAdded=!1}},t.prototype.tickerUpdate=function(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())},t.prototype.update=function(){if(this.interactionDOMElement){if(this._didMove){this._didMove=!1;return}this.cursor=null;for(var e in this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(e)){var i=this.activeInteractionData[e];if(i.originalEvent&&i.pointerType!=="touch"){var r=this.configureInteractionEventForDOMEvent(this.eventData,i.originalEvent,i);this.processInteractive(r,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},t.prototype.setCursorMode=function(e){e=e||"default";var i=!0;if(globalThis.OffscreenCanvas&&this.interactionDOMElement instanceof OffscreenCanvas&&(i=!1),this.currentCursorMode!==e){this.currentCursorMode=e;var r=this.cursorStyles[e];if(r)switch(typeof r){case"string":i&&(this.interactionDOMElement.style.cursor=r);break;case"function":r(e);break;case"object":i&&Object.assign(this.interactionDOMElement.style,r);break}else i&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.interactionDOMElement.style.cursor=e)}},t.prototype.dispatchEvent=function(e,i,r){(!r.stopPropagationHint||e===r.stopsPropagatingAt)&&(r.currentTarget=e,r.type=i,e.emit(i,r),e[i]&&e[i](r))},t.prototype.delayDispatchEvent=function(e,i,r){this.delayedEvents.push({displayObject:e,eventString:i,eventData:r})},t.prototype.mapPositionToPoint=function(e,i,r){var n;this.interactionDOMElement.parentElement?n=this.interactionDOMElement.getBoundingClientRect():n={x:0,y:0,width:this.interactionDOMElement.width,height:this.interactionDOMElement.height,left:0,top:0};var a=1/this.resolution;e.x=(i-n.left)*(this.interactionDOMElement.width/n.width)*a,e.y=(r-n.top)*(this.interactionDOMElement.height/n.height)*a},t.prototype.processInteractive=function(e,i,r,n){var a=this.search.findHit(e,i,r,n),o=this.delayedEvents;if(!o.length)return a;e.stopPropagationHint=!1;var h=o.length;this.delayedEvents=[];for(var u=0;u<h;u++){var c=o[u],l=c.displayObject,_=c.eventString,d=c.eventData;d.stopsPropagatingAt===l&&(d.stopPropagationHint=!0),this.dispatchEvent(l,_,d)}return a},t.prototype.onPointerDown=function(e){if(!(this.supportsTouchEvents&&e.pointerType==="touch")){var i=this.normalizeToPointerData(e);if(this.autoPreventDefault&&i[0].isNormalized){var r=e.cancelable||!("cancelable"in e);r&&e.preventDefault()}for(var n=i.length,a=0;a<n;a++){var o=i[a],h=this.getInteractionDataForPointerId(o),u=this.configureInteractionEventForDOMEvent(this.eventData,o,h);if(u.data.originalEvent=e,this.processInteractive(u,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",u),o.pointerType==="touch")this.emit("touchstart",u);else if(o.pointerType==="mouse"||o.pointerType==="pen"){var c=o.button===2;this.emit(c?"rightdown":"mousedown",this.eventData)}}}},t.prototype.processPointerDown=function(e,i,r){var n=e.data,a=e.data.identifier;if(r){if(i.trackedPointers[a]||(i.trackedPointers[a]=new H_(a)),this.dispatchEvent(i,"pointerdown",e),n.pointerType==="touch")this.dispatchEvent(i,"touchstart",e);else if(n.pointerType==="mouse"||n.pointerType==="pen"){var o=n.button===2;o?i.trackedPointers[a].rightDown=!0:i.trackedPointers[a].leftDown=!0,this.dispatchEvent(i,o?"rightdown":"mousedown",e)}}},t.prototype.onPointerComplete=function(e,i,r){var n=this.normalizeToPointerData(e),a=n.length,o=e.target;e.composedPath&&e.composedPath().length>0&&(o=e.composedPath()[0]);for(var h=o!==this.interactionDOMElement?"outside":"",u=0;u<a;u++){var c=n[u],l=this.getInteractionDataForPointerId(c),_=this.configureInteractionEventForDOMEvent(this.eventData,c,l);if(_.data.originalEvent=e,this.processInteractive(_,this.lastObjectRendered,r,i||!h),this.emit(i?"pointercancel":"pointerup"+h,_),c.pointerType==="mouse"||c.pointerType==="pen"){var d=c.button===2;this.emit(d?"rightup"+h:"mouseup"+h,_)}else c.pointerType==="touch"&&(this.emit(i?"touchcancel":"touchend"+h,_),this.releaseInteractionDataForPointerId(c.pointerId))}},t.prototype.onPointerCancel=function(e){this.supportsTouchEvents&&e.pointerType==="touch"||this.onPointerComplete(e,!0,this.processPointerCancel)},t.prototype.processPointerCancel=function(e,i){var r=e.data,n=e.data.identifier;i.trackedPointers[n]!==void 0&&(delete i.trackedPointers[n],this.dispatchEvent(i,"pointercancel",e),r.pointerType==="touch"&&this.dispatchEvent(i,"touchcancel",e))},t.prototype.onPointerUp=function(e){this.supportsTouchEvents&&e.pointerType==="touch"||this.onPointerComplete(e,!1,this.processPointerUp)},t.prototype.processPointerUp=function(e,i,r){var n=e.data,a=e.data.identifier,o=i.trackedPointers[a],h=n.pointerType==="touch",u=n.pointerType==="mouse"||n.pointerType==="pen",c=!1;if(u){var l=n.button===2,_=H_.FLAGS,d=l?_.RIGHT_DOWN:_.LEFT_DOWN,g=o!==void 0&&o.flags&d;r?(this.dispatchEvent(i,l?"rightup":"mouseup",e),g&&(this.dispatchEvent(i,l?"rightclick":"click",e),c=!0)):g&&this.dispatchEvent(i,l?"rightupoutside":"mouseupoutside",e),o&&(l?o.rightDown=!1:o.leftDown=!1)}r?(this.dispatchEvent(i,"pointerup",e),h&&this.dispatchEvent(i,"touchend",e),o&&((!u||c)&&this.dispatchEvent(i,"pointertap",e),h&&(this.dispatchEvent(i,"tap",e),o.over=!1))):o&&(this.dispatchEvent(i,"pointerupoutside",e),h&&this.dispatchEvent(i,"touchendoutside",e)),o&&o.none&&delete i.trackedPointers[a]},t.prototype.onPointerMove=function(e){if(!(this.supportsTouchEvents&&e.pointerType==="touch")){var i=this.normalizeToPointerData(e);(i[0].pointerType==="mouse"||i[0].pointerType==="pen")&&(this._didMove=!0,this.cursor=null);for(var r=i.length,n=0;n<r;n++){var a=i[n],o=this.getInteractionDataForPointerId(a),h=this.configureInteractionEventForDOMEvent(this.eventData,a,o);h.data.originalEvent=e,this.processInteractive(h,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",h),a.pointerType==="touch"&&this.emit("touchmove",h),(a.pointerType==="mouse"||a.pointerType==="pen")&&this.emit("mousemove",h)}i[0].pointerType==="mouse"&&this.setCursorMode(this.cursor)}},t.prototype.processPointerMove=function(e,i,r){var n=e.data,a=n.pointerType==="touch",o=n.pointerType==="mouse"||n.pointerType==="pen";o&&this.processPointerOverOut(e,i,r),(!this.moveWhenInside||r)&&(this.dispatchEvent(i,"pointermove",e),a&&this.dispatchEvent(i,"touchmove",e),o&&this.dispatchEvent(i,"mousemove",e))},t.prototype.onPointerOut=function(e){if(!(this.supportsTouchEvents&&e.pointerType==="touch")){var i=this.normalizeToPointerData(e),r=i[0];r.pointerType==="mouse"&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var n=this.getInteractionDataForPointerId(r),a=this.configureInteractionEventForDOMEvent(this.eventData,r,n);a.data.originalEvent=r,this.processInteractive(a,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",a),r.pointerType==="mouse"||r.pointerType==="pen"?this.emit("mouseout",a):this.releaseInteractionDataForPointerId(n.identifier)}},t.prototype.processPointerOverOut=function(e,i,r){var n=e.data,a=e.data.identifier,o=n.pointerType==="mouse"||n.pointerType==="pen",h=i.trackedPointers[a];r&&!h&&(h=i.trackedPointers[a]=new H_(a)),h!==void 0&&(r&&this.mouseOverRenderer?(h.over||(h.over=!0,this.delayDispatchEvent(i,"pointerover",e),o&&this.delayDispatchEvent(i,"mouseover",e)),o&&this.cursor===null&&(this.cursor=i.cursor)):h.over&&(h.over=!1,this.dispatchEvent(i,"pointerout",this.eventData),o&&this.dispatchEvent(i,"mouseout",e),h.none&&delete i.trackedPointers[a]))},t.prototype.onPointerOver=function(e){if(!(this.supportsTouchEvents&&e.pointerType==="touch")){var i=this.normalizeToPointerData(e),r=i[0],n=this.getInteractionDataForPointerId(r),a=this.configureInteractionEventForDOMEvent(this.eventData,r,n);a.data.originalEvent=r,r.pointerType==="mouse"&&(this.mouseOverRenderer=!0),this.emit("pointerover",a),(r.pointerType==="mouse"||r.pointerType==="pen")&&this.emit("mouseover",a)}},t.prototype.getInteractionDataForPointerId=function(e){var i=e.pointerId,r;return i===au||e.pointerType==="mouse"?r=this.mouse:this.activeInteractionData[i]?r=this.activeInteractionData[i]:(r=this.interactionDataPool.pop()||new XE,r.identifier=i,this.activeInteractionData[i]=r),r.copyEvent(e),r},t.prototype.releaseInteractionDataForPointerId=function(e){var i=this.activeInteractionData[e];i&&(delete this.activeInteractionData[e],i.reset(),this.interactionDataPool.push(i))},t.prototype.configureInteractionEventForDOMEvent=function(e,i,r){return e.data=r,this.mapPositionToPoint(r.global,i.clientX,i.clientY),i.pointerType==="touch"&&(i.globalX=r.global.x,i.globalY=r.global.y),r.originalEvent=i,e.reset(),e},t.prototype.normalizeToPointerData=function(e){var i=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(var r=0,n=e.changedTouches.length;r<n;r++){var a=e.changedTouches[r];typeof a.button>"u"&&(a.button=e.touches.length?1:0),typeof a.buttons>"u"&&(a.buttons=e.touches.length?1:0),typeof a.isPrimary>"u"&&(a.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof a.width>"u"&&(a.width=a.radiusX||1),typeof a.height>"u"&&(a.height=a.radiusY||1),typeof a.tiltX>"u"&&(a.tiltX=0),typeof a.tiltY>"u"&&(a.tiltY=0),typeof a.pointerType>"u"&&(a.pointerType="touch"),typeof a.pointerId>"u"&&(a.pointerId=a.identifier||0),typeof a.pressure>"u"&&(a.pressure=a.force||.5),typeof a.twist>"u"&&(a.twist=0),typeof a.tangentialPressure>"u"&&(a.tangentialPressure=0),typeof a.layerX>"u"&&(a.layerX=a.offsetX=a.clientX),typeof a.layerY>"u"&&(a.layerY=a.offsetY=a.clientY),a.isNormalized=!0,i.push(a)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){var o=e;typeof o.isPrimary>"u"&&(o.isPrimary=!0),typeof o.width>"u"&&(o.width=1),typeof o.height>"u"&&(o.height=1),typeof o.tiltX>"u"&&(o.tiltX=0),typeof o.tiltY>"u"&&(o.tiltY=0),typeof o.pointerType>"u"&&(o.pointerType="mouse"),typeof o.pointerId>"u"&&(o.pointerId=au),typeof o.pressure>"u"&&(o.pressure=.5),typeof o.twist>"u"&&(o.twist=0),typeof o.tangentialPressure>"u"&&(o.tangentialPressure=0),o.isNormalized=!0,i.push(o)}else i.push(e);return i},t.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},t.extension={name:"interaction",type:[ve.RendererPlugin,ve.CanvasRendererPlugin]},t}(nh);const Gm=class{constructor(){this.RENDER_TEXTURE_POOL=new Map,this.RENDER_TEXTURE_CACHE=[]}clearCache(){this.RENDER_TEXTURE_POOL.forEach(s=>s==null?void 0:s.destroy(!0)),this.RENDER_TEXTURE_POOL.clear(),this.RENDER_TEXTURE_CACHE=[]}clearRenderTexture(s){return s?this.writeToRenderTexture(new Wt(ut.EMPTY),s):null}getTextureIdentifier(s,t,e){return`${e??Gm.DEFAULT_PLANE_ID}:${s}:${t}`}createRenderTexture(s,t,e=null){if(s<0||t<0)return null;if(!e){const r=xe.create({width:s,height:t});return this.RENDER_TEXTURE_CACHE.push(r),r}e=this.getTextureIdentifier(s,t,e);let i=this.RENDER_TEXTURE_POOL.get(e);return i||(i=xe.create({width:s,height:t}),this.RENDER_TEXTURE_CACHE.push(i),this.RENDER_TEXTURE_POOL.set(e,i)),i}createAndFillRenderTexture(s,t,e=null,i=16777215){if(s<0||t<0)return null;const r=this.createRenderTexture(s,t,e);return this.clearAndFillRenderTexture(r,i)}createAndWriteRenderTexture(s,t,e,i=null,r=null){if(s<0||t<0)return null;const n=this.createRenderTexture(s,t,i);return this.writeToRenderTexture(e,n,!0,r)}clearAndFillRenderTexture(s,t=16777215){if(!s)return null;const e=new Wt(ut.WHITE);return e.tint=t,e.width=s.width,e.height=s.height,this.writeToRenderTexture(e,s)}writeToRenderTexture(s,t,e=!0,i=null){return!s||!t?null:(this.getRenderer().render(s,{renderTexture:t,clear:e,transform:i}),t)}getPixels(s,t=null){return this.getExtractor().pixels(s)}getRenderer(){return Ae.instance.renderer}getExtractor(){return this.getRenderer().plugins.extract}};let Bm=Gm;Bm.DEFAULT_PLANE_ID="DEFAULT";class qt{static generateTexture(t,e=null,i=null,r=1){return t?(i===null&&(i=Z.SCALE_MODE),this.getRenderer().generateTexture(t,{scaleMode:i,resolution:r,region:e})):null}static generateTextureFromImage(t){return t?ut.from(t):null}static generateImage(t){return t?this.getExtractor().image(t):null}static generateImageUrl(t){return t?this.getExtractor().base64(t):null}static generateCanvas(t){return t?this.getExtractor().canvas(t):null}static clearRenderTexture(t){return t?this.writeToRenderTexture(new Wt(ut.EMPTY),t):null}static createRenderTexture(t,e){return t<0||e<0?null:xe.create({width:t,height:e})}static createAndFillRenderTexture(t,e,i=16777215){if(t<0||e<0)return null;const r=this.createRenderTexture(t,e);return this.clearAndFillRenderTexture(r,i)}static createAndWriteRenderTexture(t,e,i,r=null){if(t<0||e<0)return null;const n=this.createRenderTexture(t,e);return this.writeToRenderTexture(i,n,!0,r)}static clearAndFillRenderTexture(t,e=16777215){if(!t)return null;const i=new Wt(ut.WHITE);return i.tint=e,i.width=t.width,i.height=t.height,this.writeToRenderTexture(i,t)}static writeToRenderTexture(t,e,i=!0,r=null){return!t||!e?null:(this.getRenderer().render(t,{renderTexture:e,clear:i,transform:r}),e)}static getPixels(t,e=null){return this.getExtractor().pixels(t)}static getRenderer(){return Ae.instance.renderer}static getExtractor(){return this.getRenderer().plugins.extract}}const uo=class{static createAsset(s,t,e,i,r,n=!1,a=!1,o=!1){const h=uo.GRAPHIC_POOL.length?uo.GRAPHIC_POOL.pop():new uo;return h._name=s,h._source=t||null,e?(h._texture=e,h._initialized=!1):(h._texture=null,h._initialized=!0),h._usesPalette=o,h._x=i,h._y=r,h._flipH=n,h._flipV=a,h._rectangle=null,h}recycle(){this._texture=null,uo.GRAPHIC_POOL.push(this)}initialize(){this._initialized||!this._texture||(this._width=this._texture.width,this._height=this._texture.height,this._initialized=!0)}getImageUrl(){return qt.generateImageUrl(new Wt(this._texture))}get name(){return this._name}get source(){return this._source}get texture(){return this._texture}get usesPalette(){return this._usesPalette}get x(){return this._x}get y(){return this._y}get width(){return this.initialize(),this._width}get height(){return this.initialize(),this._height}get offsetX(){return this._flipH?-this._x:this._x}get offsetY(){return this._flipV?-this._y:this._y}get flipH(){return this._flipH}get flipV(){return this._flipV}get rectangle(){return this._rectangle||(this._rectangle=new et(0,0,this.width,this.height)),this._rectangle}};let Hm=uo;Hm.GRAPHIC_POOL=[];class Jb{constructor(t,e,i){for(this._palette=t;this._palette.length<256;)this._palette.push([0,0,0]);this._primaryColor=e,this._secondaryColor=i}dispose(){}applyPalette(t){var a,o;const e=qt.createAndWriteRenderTexture(t.width,t.height,new Wt(t)),i=qt.getPixels(e);for(let h=0;h<i.length;h+=4){let u=this._palette[i[h+1]];u===void 0&&(u=[0,0,0]),i[h]=u[0],i[h+1]=u[1],i[h+2]=u[2]}const r=(a=e.baseTexture._glTextures[1])==null?void 0:a.texture,n=(o=Ae.instance.renderer)==null?void 0:o.gl;return n.bindTexture(n.TEXTURE_2D,r),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e.width,e.height,0,n.RGBA,n.UNSIGNED_BYTE,i),n.bindTexture(n.TEXTURE_2D,null),e}get primaryColor(){return this._primaryColor}get secondaryColor(){return this._secondaryColor}}const Pc=class{constructor(s,t){if(!s)throw new Error("invalid_collection");this._name=s.name,this._baseTexture=t&&t.baseTexture||null,this._data=s,this._textures=new Map,this._assets=new Map,this._palettes=new Map,this._paletteAssetNames=[],t&&this.addLibraryAsset(t.textures),this.define(s)}static removeFileExtension(s){return s.substring(0,s.lastIndexOf("."))||s}dispose(){if(this._palettes){for(const s of this._palettes.values())s.dispose();this._palettes.clear()}if(this._paletteAssetNames&&(this.disposePaletteAssets(),this._paletteAssetNames=null),this._assets){for(const s of this._assets.values())s.recycle();this._assets.clear()}}addReference(){this._referenceCount++,this._referenceTimestamp=_t()}removeReference(){this._referenceCount--,this._referenceCount<=0&&(this._referenceCount=0,this._referenceTimestamp=_t(),this.disposePaletteAssets(!1))}define(s){const t=s.assets,e=s.palettes;t&&this.defineAssets(t),e&&this.definePalettes(e)}defineAssets(s){if(s)for(const t in s){const e=s[t];if(!e)continue;const i=-e.x||0,r=-e.y||0;let n=!1;const a=!1,o=e.usesPalette||!1;let h=e.source||"";e.flipH&&h.length&&(n=!0),h.length||(h=t);const u=this.getLibraryAsset(h);if(!u)continue;let c=this.createAsset(t,h,u,n,a,i,r,o);if(!c){const l=this.getAsset(t);l&&l.name!==l.source&&(c=this.replaceAsset(t,h,u,n,a,i,r,o))}}}definePalettes(s){if(s)for(const t in s){const e=s[t];if(!e)continue;const i=e.id.toString();if(this._palettes.get(i))continue;let r=16777215,n=16777215,a=e.color1;a&&a.length>0&&(r=parseInt(a,16)),a=e.color2,a&&a.length>0&&(n=parseInt(a,16)),this._palettes.set(i,new Jb(e.rgb,r,n))}}createAsset(s,t,e,i,r,n,a,o){if(this._assets.get(s))return!1;const h=Hm.createAsset(s,t,e,n,a,i,r,o);return this._assets.set(s,h),!0}replaceAsset(s,t,e,i,r,n,a,o){const h=this._assets.get(s);return h&&(this._assets.delete(s),h.recycle()),this.createAsset(s,t,e,i,r,n,a,o)}getAsset(s){if(!s)return null;const t=this._assets.get(s);return t||null}getAssetWithPalette(s,t){const e=s+"@"+t;let i=this.getAsset(e);if(!i){if(i=this.getAsset(s),!i||!i.usesPalette)return i;const r=this.getPalette(t);if(r){const n=r.applyPalette(i.texture);n&&(this._paletteAssetNames.push(e),this.createAsset(e,i.source+"@"+t,n,i.flipH,i.flipV,i.x,i.y,!1),i=this.getAsset(e))}}return i}getTexture(s){return this._textures.get(s)}getPaletteNames(){return Array.from(this._palettes.keys())}getPaletteColors(s){const t=this.getPalette(s);return t?[t.primaryColor,t.secondaryColor]:null}getPalette(s){if(!s)return null;const t=this._palettes.get(s);return t||null}addAsset(s,t,e,i=0,r=0,n=!1,a=!1){if(!s||!t)return!1;const o=this.getLibraryAsset(s);return o?e?(o.baseTexture=t.baseTexture,o.frame=t.frame,o.trim=t.trim,o.updateUvs(),!0):!1:(this._textures.set(s,t),this.createAsset(s,s,t,n,a,i,r,!1))}disposeAsset(s){const t=this._assets.get(s);if(!t)return;this._assets.delete(s);const e=this.getLibraryAsset(t.source);e&&(this._textures.delete(t.source),e.destroy(!0)),t.recycle()}getLibraryAsset(s){if(!s)return null;s=this._name+"_"+s;const t=this._textures.get(s);return t||null}addLibraryAsset(s){if(s)for(const t in s){const e=s[t];e&&this._textures.set(Pc.removeFileExtension(t),e)}}disposePaletteAssets(s=!0){if(this._paletteAssetNames&&(s||this._paletteAssetNames.length>Pc.PALETTE_ASSET_DISPOSE_THRESHOLD)){for(const t of this._paletteAssetNames)this.disposeAsset(t);this._paletteAssetNames=[]}}get referenceCount(){return this._referenceCount}get referenceTimestamp(){return this._referenceTimestamp}get name(){return this._name}get baseTexture(){return this._baseTexture}get data(){return this._data}get textures(){return this._textures}get assets(){return this._assets}};let vf=Pc;vf.PALETTE_ASSET_DISPOSE_THRESHOLD=10;const Vm=class{constructor(){this._textures=new Map,this._collections=new Map}getTexture(s){if(!s)return null;const t=this._textures.get(s);return t||null}setTexture(s,t){!s||!t||this._textures.set(s,t)}getAsset(s){if(!s)return null;for(const t of this._collections.values()){if(!t)continue;const e=t.getAsset(s);if(e)return e}return null}getCollection(s){if(!s)return null;const t=this._collections.get(s);return t||null}createCollection(s,t){if(!s)return null;const e=new vf(s,t);if(e){for(const[i,r]of e.textures.entries())this.setTexture(i,r);this._collections.set(e.name,e)}return e}async downloadAsset(s){return await this.downloadAssets([s])}async downloadAssets(s){if(!s||!s.length)return Promise.resolve(!0);try{for(const t of s){const e=await fetch(t);if(e.status!==200)continue;let i="application/octet-stream";switch(e.headers.has("Content-Type")&&(i=e.headers.get("Content-Type")),i){case"application/octet-stream":{const r=await e.arrayBuffer(),n=new Rf(r);await this.processAsset(n.baseTexture,n.jsonFile);break}case"image/png":case"image/jpeg":case"image/gif":{const r=await e.arrayBuffer(),n=Jp(r),a=Yt.from(`data:${i};base64,${n}`),o=async()=>{const h=new ut(a);this.setTexture(t,h)};a.valid?await o():await new Promise((h,u)=>{a.once("update",async()=>(await o(),h()))});break}}}return Promise.resolve(!0)}catch(t){return Y.error(t),Promise.resolve(!1)}}async processAsset(s,t){const e=t.spritesheet;if(!s||!e||!Object.keys(e).length){this.createCollection(t,null);return}const i=async()=>{const r=new df(s,e);await r.parse(),this.createCollection(t,r)};s.valid?await i():await new Promise((r,n)=>{s.once("update",async()=>(await i(),r()))})}get collections(){return this._collections}};let km=Vm;km._INSTANCE=new Vm;const ys=()=>km._INSTANCE;class $b{constructor(t,e,i){this.name=t,this.textures=e,this.durations=i}}class Sf{}Sf.UNKNOWN=0;Sf.BROWSER=1;class Cl{}Cl.UNKNOWN=0;Cl.FLASH=1;Cl.HTML5=2;class vs{}vs.CONNECTION_OPENED="open";vs.CONNECTION_CLOSED="close";vs.CONNECTION_ERROR="error";vs.CONNECTION_MESSAGE="message";class rt{static parseConfiguration(t,e=!1){if(!t)return!1;try{const i=new RegExp(/\${(.*?)}/g);for(const r in t){let n=t[r];typeof n=="string"&&(n=this.interpolate(n,i)),this._definitions.has(r)?e&&this.setValue(r,n):this.setValue(r,n)}return!0}catch(i){return Y.error(i.stack),!1}}static interpolate(t,e=null){e||(e=new RegExp(/\${(.*?)}/g));const i=t.match(e);if(i&&i.length)for(const r of i){const n=this._definitions.get(this.removeInterpolateKey(r));n&&(t=t.replace(r,n))}return t}static removeInterpolateKey(t){return t.replace("${","").replace("}","")}static getValue(t,e=null){let i=this._definitions.get(t);if(i===void 0){if(this._missingKeys.indexOf(t)>=0)return e;this._missingKeys.push(t),Y.warn(`Missing configuration key: ${t}`),i=e}return i}static setValue(t,e){const i=t.split(".");let r=this._config;for(let n=0;n<i.length;n++){const a=i[n].toString();if(n!==i.length-1){r[a]||(r[a]={}),r=r[a];continue}r[a]=e}this._definitions.set(t,e)}static get definitions(){return this._definitions}}rt._definitions=new Map;rt._config={};rt._missingKeys=[];const Qt=class{static getExpressionTimeout(s){switch(s=parseInt(s),s){case 1:return 5e3;case 2:return 1400;case 3:return 2e3;case 4:return 2e3;case 5:return 0;case 6:return 700;case 7:return 2e3;case 8:return 1500;case 9:return 1500;case 10:return 1500;default:return 0}}static getExpressionId(s){return Qt.EXPRESSION_MAP.indexOf(s)}static getExpression(s){return s>Qt.EXPRESSION_MAP.length?null:Qt.EXPRESSION_MAP[s]}static getGestureId(s){return Qt.GESTURE_MAP.indexOf(s)}static getGesture(s){return s>Qt.GESTURE_MAP.length?null:Qt.GESTURE_MAP[s]}static idToAvatarActionState(s){return s==="Lay"?"lay":s==="Float"?"float":s==="Swim"?"swim":s==="Sit"?"sit":s==="Respect"?"respect":s==="Wave"?"wave":s==="Idle"?"idle":s==="Dance"?"dance":s==="UseItem"?"usei":s==="CarryItem"?"cri":s==="Talk"?"talk":s==="Sleep"?"Sleep":s==="Move"?"mv":"std"}};let x=Qt;x.CARRY_OBJECT="cri";x.DANCE="dance";x.EFFECT="fx";x.EXPRESSION="expression";x.EXPRESSION_BLOW_A_KISS="blow";x.EXPRESSION_CRY="cry";x.EXPRESSION_IDLE="idle";x.EXPRESSION_LAUGH="laugh";x.EXPRESSION_RESPECT="respect";x.EXPRESSION_RIDE_JUMP="ridejump";x.EXPRESSION_SNOWBOARD_OLLIE="sbollie";x.EXPRESSION_SNOWBORD_360="sb360";x.EXPRESSION_WAVE="wave";x.GESTURE="gest";x.GESTURE_AGGRAVATED="agr";x.GESTURE_SAD="sad";x.GESTURE_SMILE="sml";x.GESTURE_SURPRISED="srp";x.GUIDE_STATUS="guide";x.MUTED="muted";x.PET_GESTURE_BLINK="eyb";x.PET_GESTURE_CRAZY="crz";x.PET_GESTURE_JOY="joy";x.PET_GESTURE_MISERABLE="mis";x.PET_GESTURE_PUZZLED="puz";x.PET_GESTURE_TONGUE="tng";x.PLAYING_GAME="playing_game";x.POSTURE="posture";x.POSTURE_FLOAT="float";x.POSTURE_LAY="lay";x.POSTURE_SIT="sit";x.POSTURE_STAND="std";x.POSTURE_SWIM="swim";x.POSTURE_WALK="mv";x.SIGN="sign";x.SLEEP="sleep";x.SNOWWAR_DIE_BACK="swdieback";x.SNOWWAR_DIE_FRONT="swdiefront";x.SNOWWAR_PICK="swpick";x.SNOWWAR_RUN="swrun";x.SNOWWAR_THROW="swthrow";x.TALK="talk";x.BLINK="blink";x.TYPING="typing";x.USE_OBJECT="usei";x.VOTE="vote";x.GESTURE_MAP=["",Qt.GESTURE_SMILE,Qt.GESTURE_AGGRAVATED,Qt.GESTURE_SURPRISED,Qt.GESTURE_SAD,Qt.PET_GESTURE_JOY,Qt.PET_GESTURE_CRAZY,Qt.PET_GESTURE_TONGUE,Qt.PET_GESTURE_BLINK,Qt.PET_GESTURE_MISERABLE,Qt.PET_GESTURE_PUZZLED];x.EXPRESSION_MAP=["",Qt.EXPRESSION_WAVE,Qt.EXPRESSION_BLOW_A_KISS,Qt.EXPRESSION_LAUGH,Qt.EXPRESSION_CRY,Qt.EXPRESSION_IDLE,Qt.DANCE,Qt.EXPRESSION_RESPECT,Qt.EXPRESSION_SNOWBOARD_OLLIE,Qt.EXPRESSION_SNOWBORD_360,Qt.EXPRESSION_RIDE_JUMP];class hi{}hi.DIRECTION_TO_ANGLE=[45,90,135,180,225,270,315,0];hi.DIRECTION_IS_FLIPPED=[!1,!1,!1,!1,!0,!0,!0,!1];hi.MIN_DIRECTION=0;hi.MAX_DIRECTION=7;class xn{}xn.GENERIC="hd";xn.HEAD="head";xn.TORSO="torso";xn.LEGS="legs";xn.HOTLOOKS="hotlooks";xn.WARDROBE="wardrobe";xn.EFFECTS="effects";const rs=class{};let vt=rs;vt.BODY="bd";vt.SHOES="sh";vt.LEGS="lg";vt.CHEST="ch";vt.WAIST_ACCESSORY="wa";vt.CHEST_ACCESSORY="ca";vt.HEAD="hd";vt.HAIR="hr";vt.FACE_ACCESSORY="fa";vt.EYE_ACCESSORY="ea";vt.HEAD_ACCESSORY="ha";vt.HEAD_ACCESSORY_EXTRA="he";vt.COAT_CHEST="cc";vt.CHEST_PRINT="cp";vt.LEFT_HAND_ITEM="li";vt.LEFT_HAND="lh";vt.LEFT_SLEEVE="ls";vt.RIGHT_HAND="rh";vt.RIGHT_SLEEVE="rs";vt.FACE="fc";vt.EYES="ey";vt.HAIR_BIG="hrb";vt.RIGHT_HAND_ITEM="ri";vt.LEFT_COAT_SLEEVE="lc";vt.RIGHT_COAT_SLEEVE="rc";vt.FIGURE_SETS=[rs.SHOES,rs.LEGS,rs.CHEST,rs.WAIST_ACCESSORY,rs.CHEST_ACCESSORY,rs.HEAD,rs.HAIR,rs.FACE_ACCESSORY,rs.EYE_ACCESSORY,rs.HEAD_ACCESSORY,rs.HEAD_ACCESSORY_EXTRA,rs.COAT_CHEST,rs.CHEST_PRINT];class Gs{}Gs.NONE=0;Gs.GUIDE=1;Gs.REQUESTER=2;class ui{}ui.LARGE="h";ui.SMALL="sh";class We{}We.FULL="full";We.HEAD="head";We.BODY="body";class Bs{}Bs.VERTICAL="vertical";Bs.SITTING="sitting";Bs.HORIZONTAL="horizontal";Bs.SWIM="swim";Bs.SNOWWARS_HORIZONTAL="swhorizontal";class St{}St.DOG=0;St.CAT=1;St.CROCODILE=2;St.TERRIER=3;St.BEAR=4;St.PIG=5;St.LION=6;St.RHINO=7;St.SPIDER=8;St.TURTLE=9;St.CHICKEN=10;St.FROG=11;St.DRAGON=12;St.MONSTER=13;St.MONKEY=14;St.HORSE=15;St.MONSTERPLANT=16;St.BUNNY=17;St.BUNNYEVIL=18;St.BUNNYDEPRESSED=19;St.BUNNYLOVE=20;St.PIGEONGOOD=21;St.PIGEONEVIL=22;St.DEMONMONKEY=23;St.BABYBEAR=24;St.BABYTERRIER=25;St.GNOME=26;St.LEPRECHAUN=27;St.KITTENBABY=28;St.PUPPYBABY=29;St.PIGLETNBABY=30;St.HALOOMPA=31;St.FOOLS=32;St.PTEROSAUR=33;St.VELOCIRAPTOR=34;class Fn{}Fn.NONE=0;Fn.HEART=1;Fn.SMILE=2;Fn.BOBBA=3;Fn.RELATIONSHIP_TYPES=[0,1,2,3];Fn.RELATIONSHIP_NAMES=["None","Heart","Smile","Bobba"];class $i{}$i.HOTEL_VIEW="hotel_view";$i.HOME_ROOM="home_room";$i.NAVIGATOR="navigator";$i.CATALOG="catalog";$i.INVENTORY="inventory";$i.ME_MENU="me_menu";$i.FRIEND_LIST="friendlist";class wn{}wn.LOVE_LOCK=0;wn.CARVE_A_TREE=1;wn.FRIENDS_PORTRAIT=2;wn.WILD_WEST_WANTED=3;wn.HABBOWEEN=4;class yf{}yf.CATALOG="catalog";yf.INVENTORY="inventory";class I{}I.OBJECT_ROOM_ID="object_room_id";I.OBJECT_ACCURATE_Z_VALUE="object_accurate_z_value";I.TILE_CURSOR_HEIGHT="tile_cursor_height";I.FIGURE="figure";I.GENDER="gender";I.OWN_USER="own_user";I.FIGURE_CAN_STAND_UP="figure_can_stand_up";I.FIGURE_VERTICAL_OFFSET="figure_vertical_offset";I.FIGURE_TALK="figure_talk";I.FIGURE_DANCE="figure_dance";I.FIGURE_SLEEP="figure_sleep";I.FIGURE_BLINK="figure_blink";I.FIGURE_EFFECT="figure_effect";I.FIGURE_CARRY_OBJECT="figure_carry_object";I.FIGURE_USE_OBJECT="figure_use_object";I.FIGURE_GESTURE="figure_gesture";I.FIGURE_POSTURE="figure_posture";I.FIGURE_POSTURE_PARAMETER="figure_posture_parameter";I.FIGURE_HIGHLIGHT_ENABLE="figure_highlight_enable";I.FIGURE_HIGHLIGHT="figure_highlight";I.FURNITURE_PURCHASER_NAME="furniture_purchaser_name";I.FURNITURE_PURCHASER_FIGURE="furniture_purchaser_figure";I.STD="std";I.FIGURE_SIGN="figure_sign";I.FIGURE_FLAT_CONTROL="figure_flat_control";I.FIGURE_IS_TYPING="figure_is_typing";I.FIGURE_IS_MUTED="figure_is_muted";I.FIGURE_GAINED_EXPERIENCE="figure_gained_experience";I.FIGURE_EXPERIENCE_TIMESTAMP="figure_experience_timestamp";I.FIGURE_NUMBER_VALUE="figure_number_value";I.FIGURE_IS_PLAYING_GAME="figure_is_playing_game";I.FIGURE_GUIDE_STATUS="figure_guide_status";I.FIGURE_EXPRESSION="figure_expression";I.HEAD_DIRECTION="head_direction";I.FURNITURE_CUSTOM_VARIABLES="furniture_custom_variables";I.FURNITURE_AUTOMATIC_STATE_INDEX="furniture_automatic_state_index";I.FURNITURE_ALWAYS_STACKABLE="furniture_always_stackable";I.FURNITURE_DISABLE_PICKING_ANIMATION="furniture_disable_picking_animation";I.FURNITURE_DATA_FORMAT="furniture_data_format";I.FURNITURE_UNIQUE_SERIAL_NUMBER="furniture_unique_serial_number";I.FURNITURE_UNIQUE_EDITION_SIZE="furniture_unique_edition_size";I.FURNITURE_CRACKABLE_STATE="furniture_crackable_state";I.FURNITURE_CRACKABLE_HITS="furniture_crackable_hits";I.FURNITURE_CRACKABLE_TARGET="furniture_crackable_target";I.FURNITURE_CREDIT_VALUE="furniture_credit_value";I.FURNITURE_DATA="furniture_data";I.FURNITURE_ITEMDATA="furniture_itemdata";I.FURNITURE_COLOR="furniture_color";I.FURNITURE_LIFT_AMOUNT="furniure_lift_amount";I.FURNITURE_GUILD_CUSTOMIZED_GUILD_ID="furniture_guild_customized_guild_id";I.FURNITURE_GUILD_CUSTOMIZED_ASSET_NAME="furniture_guild_customized_asset_name";I.FURNITURE_GUILD_CUSTOMIZED_COLOR_1="furniture_guild_customized_color_1";I.FURNITURE_GUILD_CUSTOMIZED_COLOR_2="furniture_guild_customized_color_2";I.FURNITURE_STATE_UPDATE_TIME="furniture_state_update_time";I.FURNITURE_SELECTION_DISABLED="furniture_selection_disabled";I.FURNITURE_SIZE_X="furniture_size_x";I.FURNITURE_SIZE_Y="furniture_size_y";I.FURNITURE_SIZE_Z="furniture_size_z";I.FURNITURE_CENTER_X="furniture_center_x";I.FURNITURE_CENTER_Y="furniture_center_y";I.FURNITURE_CENTER_Z="furniture_center_z";I.FURNITURE_ALLOWED_DIRECTIONS="furniture_allowed_directions";I.FURNITURE_AD_URL="furniture_ad_url";I.FURNITURE_TYPE_ID="furniture_type_id";I.FURNITURE_EXTRAS="furniture_extras";I.FURNITURE_EXPIRY_TIME="furniture_expiry_time";I.FURNITURE_EXPIRTY_TIMESTAMP="furniture_expiry_timestamp";I.FURNITURE_REAL_ROOM_OBJECT="furniture_real_room_object";I.FURNITURE_IS_STICKIE="furniture_is_stickie";I.FURNITURE_BRANDING_IMAGE_STATUS="furniture_branding_image_status";I.FURNITURE_BRANDING_IMAGE_URL="furniture_branding_image_url";I.FURNITURE_BRANDING_URL="furniture_branding_url";I.FURNITURE_BRANDING_OFFSET_X="furniture_branding_offset_x";I.FURNITURE_BRANDING_OFFSET_Y="furniture_branding_offset_y";I.FURNITURE_BRANDING_OFFSET_Z="furniture_branding_offset_z";I.FURNITURE_BRANDING_IS_ANIMATED="furniture_branding_is_animated";I.FURNITURE_BADGE_IMAGE_STATUS="furniture_badge_image_status";I.FURNITURE_BADGE_ASSET_NAME="furniture_badge_asset_name";I.FURNITURE_BADGE_VISIBLE_IN_STATE="furniture_badge_visible_in_state";I.FURNITURE_ALPHA_MULTIPLIER="furniture_alpha_multiplier";I.FURNITURE_USAGE_POLICY="furniture_usage_policy";I.FURNITURE_OWNER_ID="furniture_owner_id";I.FURNITURE_OWNER_NAME="furniture_owner_name";I.FURNITURE_ROOM_BACKGROUND_COLOR_HUE="furniture_room_background_color_hue";I.FURNITURE_ROOM_BACKGROUND_COLOR_SATURATION="furniture_room_background_color_saturation";I.FURNITURE_ROOM_BACKGROUND_COLOR_LIGHTNESS="furniture_room_background_color_lightness";I.FURNITURE_USES_PLANE_MASK="furniture_uses_plane_mask";I.FURNITURE_PLANE_MASK_TYPE="furniture_plane_mask_type";I.FURNITURE_IS_VARIABLE_HEIGHT="furniture_is_variable_height";I.FURNITURE_VOTE_MAJORITY_RESULT="furniture_vote_majority_result";I.FURNITURE_VOTE_COUNTER_COUNT="furniture_vote_counter_count";I.FURNITURE_SOUNDBLOCK_RELATIVE_ANIMATION_SPEED="furniture_soundblock_relative_animation_speed";I.FURNITURE_MANNEQUIN_NAME="furniture_mannequin_name";I.FURNITURE_MANNEQUIN_GENDER="furniture_mannequin_gender";I.FURNITURE_MANNEQUIN_FIGURE="furniture_mannequin_figure";I.FURNITURE_HIGHSCORE_SCORE_TYPE="furniture_highscore_score_type";I.FURNITURE_HIGHSCORE_CLEAR_TYPE="furniture_highscore_clear_type";I.FURNITURE_HIGHSCORE_DATA_ENTRY_COUNT="furniture_highscore_data_entry_count";I.FURNITURE_HIGHSCORE_DATA_ENTRY_BASE_USERS_="furniture_highscore_data_entry_base_users_";I.FURNITURE_HIGHSCORE_DATA_ENTRY_BASE_SCORE_="furniture_highscore_data_entry_base_score_";I.FURNITURE_INTERNAL_LINK="furniture_internal_link";I.FURNITURE_CLOTHING_BOY="furniture_clothing_boy";I.FURNITURE_CLOTHING_GIRL="furniture_clothing_girl";I.FURNITURE_PLANETSYSTEM_DATA="furniture_planetsystem_data";I.FURNITURE_FIREWORKS_DATA="furniture_fireworks_data";I.PET_PALETTE_INDEX="pet_palette_index";I.PET_COLOR="pet_color";I.PET_HEAD_ONLY="pet_head_only";I.PET_CUSTOM_LAYER_IDS="pet_custom_layer_ids";I.PET_CUSTOM_PARTS_IDS="pet_custom_part_ids";I.PET_CUSTOM_PALETTE_IDS="pet_custom_palette_ids";I.PET_IS_RIDING="pet_is_riding";I.PET_TYPE="pet_type";I.PET_ALLOWED_DIRECTIONS="pet_allowed_directions";I.RACE="race";I.ROOM_MAP_DATA="room_map_data";I.ROOM_PLANE_MASK_XML="room_plane_mask_xml";I.ROOM_FLOOR_TYPE="room_floor_type";I.ROOM_WALL_TYPE="room_wall_type";I.ROOM_LANDSCAPE_TYPE="room_landscape_type";I.ROOM_WALL_THICKNESS="room_wall_thickness";I.ROOM_FLOOR_THICKNESS="room_floor_thickness";I.ROOM_FLOOR_HOLE_UPDATE_TIME="room_floor_hole_update_time";I.ROOM_FLOOR_VISIBILITY="room_floor_visibility";I.ROOM_WALL_VISIBILITY="room_wall_visibility";I.ROOM_LANDSCAPE_VISIBILITY="room_landscape_visibility";I.ROOM_DOOR_X="room_door_x";I.ROOM_DOOR_Y="room_door_y";I.ROOM_DOOR_Z="room_door_z";I.ROOM_DOOR_DIR="room_door_dir";I.ROOM_BACKGROUND_COLOR="room_background_color";I.ROOM_COLORIZE_BG_ONLY="room_colorize_bg_only";I.ROOM_RANDOM_SEED="room_random_seed";I.ROOM_WORLD_TYPE="room_world_type";I.ROOM_SELECTED_X="room_selected_x";I.ROOM_SELECTED_Y="room_selected_y";I.ROOM_SELECTED_Z="room_selected_z";I.ROOM_SELECTED_PLANE="room_selected_plane";I.IMAGE_QUERY_SCALE="image_query_scale";I.FURNITURE_FRIENDFURNI_ENGRAVING="furniture_friendfurni_engraving_type";I.SESSION_URL_PREFIX="session_url_prefix";I.SESSION_CURRENT_USER_ID="session_current_user_id";class jm{}jm.UNIQUE_SET=256;class Gr{constructor(){this._flags=0,this._uniqueNumber=0,this._uniqueSeries=0}parseWrapper(t){(this._flags&jm.UNIQUE_SET)>0&&(this._uniqueNumber=t.readInt(),this._uniqueSeries=t.readInt())}initializeFromRoomObjectModel(t){this._uniqueNumber=t.getValue(I.FURNITURE_UNIQUE_SERIAL_NUMBER),this._uniqueSeries=t.getValue(I.FURNITURE_UNIQUE_EDITION_SIZE)}writeRoomObjectModel(t){t&&(t.setValue(I.FURNITURE_UNIQUE_SERIAL_NUMBER,this._uniqueNumber),t.setValue(I.FURNITURE_UNIQUE_EDITION_SIZE,this._uniqueSeries))}getLegacyString(){return""}compare(t){return!1}get state(){const t=parseInt(this.getLegacyString());return isNaN(t)?0:t}get isUnique(){return this._uniqueSeries>0}get uniqueNumber(){return this._uniqueNumber}set uniqueNumber(t){this._uniqueNumber=t}get uniqueSeries(){return this._uniqueSeries}set uniqueSeries(t){this._uniqueSeries=t}get rarityLevel(){return-1}get flags(){return this._flags}set flags(t){this._flags=t}}class Ke{}Ke.LEGACY_KEY=0;Ke.MAP_KEY=1;Ke.STRING_KEY=2;Ke.VOTE_KEY=3;Ke.EMPTY_KEY=4;Ke.NUMBER_KEY=5;Ke.HIGHSCORE_KEY=6;Ke.CRACKABLE_KEY=7;const zm=class extends Gr{constructor(){super(),this._state="",this._hits=0,this._target=0}parseWrapper(s){s&&(this._state=s.readString(),this._hits=s.readInt(),this._target=s.readInt(),super.parseWrapper(s))}initializeFromRoomObjectModel(s){super.initializeFromRoomObjectModel(s),this._state=s.getValue(I.FURNITURE_CRACKABLE_STATE),this._hits=s.getValue(I.FURNITURE_CRACKABLE_HITS),this._target=s.getValue(I.FURNITURE_CRACKABLE_TARGET)}writeRoomObjectModel(s){super.writeRoomObjectModel(s),s.setValue(I.FURNITURE_DATA_FORMAT,zm.FORMAT_KEY),s.setValue(I.FURNITURE_CRACKABLE_STATE,this._state),s.setValue(I.FURNITURE_CRACKABLE_HITS,this._hits),s.setValue(I.FURNITURE_CRACKABLE_TARGET,this._target)}getLegacyString(){return this._state}compare(s){return!0}get hits(){return this._hits}get target(){return this._target}};let bc=zm;bc.FORMAT_KEY=Ke.CRACKABLE_KEY;const Ym=class extends Gr{parseWrapper(s){s&&(this._state="",super.parseWrapper(s))}writeRoomObjectModel(s){super.writeRoomObjectModel(s),s.setValue(I.FURNITURE_DATA_FORMAT,Ym.FORMAT_KEY)}getLegacyString(){return this._state}compare(s){return super.compare(s)}};let Dc=Ym;Dc.FORMAT_KEY=Ke.EMPTY_KEY;class KE{constructor(){this._score=-1,this._users=[]}get score(){return this._score}set score(t){this._score=t}get users(){return this._users}set users(t){this._users=t}addUsername(t){this._users.push(t)}}const Wm=class extends Gr{constructor(){super(),this._state="",this._scoreType=-1,this._clearType=-1,this._entries=[]}parseWrapper(s){if(!s)return;this._state=s.readString(),this._scoreType=s.readInt(),this._clearType=s.readInt();let t=s.readInt();for(;t>0;){const e=new KE;e.score=s.readInt();let i=s.readInt();for(;i>0;)e.addUsername(s.readString()),i--;this._entries.push(e),t--}super.parseWrapper(s)}initializeFromRoomObjectModel(s){this._scoreType=s.getValue(I.FURNITURE_HIGHSCORE_SCORE_TYPE),this._clearType=s.getValue(I.FURNITURE_HIGHSCORE_CLEAR_TYPE),this._entries=[];const t=s.getValue(I.FURNITURE_HIGHSCORE_DATA_ENTRY_COUNT);let e=0;for(;e<t;){const i=new KE;i.score=s.getValue(I.FURNITURE_HIGHSCORE_DATA_ENTRY_BASE_SCORE_+e),i.users=s.getValue(I.FURNITURE_HIGHSCORE_DATA_ENTRY_BASE_USERS_+e),this._entries.push(i),e++}super.initializeFromRoomObjectModel(s)}writeRoomObjectModel(s){if(super.writeRoomObjectModel(s),s.setValue(I.FURNITURE_DATA_FORMAT,Wm.FORMAT_KEY),s.setValue(I.FURNITURE_HIGHSCORE_SCORE_TYPE,this._scoreType),s.setValue(I.FURNITURE_HIGHSCORE_CLEAR_TYPE,this._clearType),this._entries){s.setValue(I.FURNITURE_HIGHSCORE_DATA_ENTRY_COUNT,this._entries.length);let t=0;for(;t<this._entries.length;){const e=this._entries[t];s.setValue(I.FURNITURE_HIGHSCORE_DATA_ENTRY_BASE_SCORE_+t,e.score),s.setValue(I.FURNITURE_HIGHSCORE_DATA_ENTRY_BASE_USERS_+t,e.users),t++}}}getLegacyString(){return this._state}get entries(){return this._entries}get clearType(){return this._clearType}get scoreType(){return this._scoreType}};let Lc=Wm;Lc.FORMAT_KEY=Ke.HIGHSCORE_KEY;const Xm=class extends Gr{constructor(){super(),this._data=""}parseWrapper(s){s&&(this._data=s.readString(),super.parseWrapper(s))}initializeFromRoomObjectModel(s){super.initializeFromRoomObjectModel(s),this._data=s.getValue(I.FURNITURE_DATA)}writeRoomObjectModel(s){super.writeRoomObjectModel(s),s.setValue(I.FURNITURE_DATA_FORMAT,Xm.FORMAT_KEY),s.setValue(I.FURNITURE_DATA,this._data)}getLegacyString(){return this._data}compare(s){return this._data===s.getLegacyString()}setString(s){this._data=s}};let _s=Xm;_s.FORMAT_KEY=Ke.LEGACY_KEY;const gu=class extends Gr{constructor(){super(),this._data={}}parseWrapper(s){if(!s)return;this._data={};const t=s.readInt();if(t)for(let e=0;e<t;e++)this._data[s.readString()]=s.readString();super.parseWrapper(s)}initializeFromRoomObjectModel(s){super.initializeFromRoomObjectModel(s),this._data=s.getValue(I.FURNITURE_DATA)||{}}writeRoomObjectModel(s){super.writeRoomObjectModel(s),s.setValue(I.FURNITURE_DATA_FORMAT,gu.FORMAT_KEY),s.setValue(I.FURNITURE_DATA,this._data)}getLegacyString(){if(!this._data)return"";const s=this._data[gu.STATE];return s??""}compare(s){return!1}getValue(s){return this._data[s]}get rarityLevel(){if(!this._data)return-1;const s=this._data[gu.RARITY];return s==null?-1:parseInt(s)}get data(){return this._data}};let wr=gu;wr.FORMAT_KEY=Ke.MAP_KEY;wr.STATE="state";wr.RARITY="rarity";const Eu=class extends Gr{constructor(){super(),this._data=[]}parseWrapper(s){if(!s)return;this._data=[];const t=s.readInt();if(t)for(let e=0;e<t;e++)this._data.push(s.readInt());super.parseWrapper(s)}initializeFromRoomObjectModel(s){super.initializeFromRoomObjectModel(s),this._data=s.getValue(I.FURNITURE_DATA)}writeRoomObjectModel(s){super.writeRoomObjectModel(s),s.setValue(I.FURNITURE_DATA_FORMAT,Eu.FORMAT_KEY),s.setValue(I.FURNITURE_DATA,this._data)}getLegacyString(){return!this._data||!this._data.length?"":this._data[Eu.STATE].toString()}compare(s){if(!(s instanceof Eu))return!1;let t=0;for(;t<this._data.length;){if(t!==0){if(this._data[t]!==s.getValue(t))return!1}t++}return!0}getValue(s){if(!this._data||!this._data.length)return-1;const t=this._data[s];return t??-1}};let Zo=Eu;Zo.FORMAT_KEY=Ke.NUMBER_KEY;Zo.STATE=0;const pu=class extends Gr{constructor(){super(),this._data=[]}parseWrapper(s){if(!s)return;this._data=[];const t=s.readInt();if(t)for(let e=0;e<t;e++)this._data.push(s.readString());super.parseWrapper(s)}initializeFromRoomObjectModel(s){super.initializeFromRoomObjectModel(s),this._data=s.getValue(I.FURNITURE_DATA)}writeRoomObjectModel(s){super.writeRoomObjectModel(s),s.setValue(I.FURNITURE_DATA_FORMAT,pu.FORMAT_KEY),s.setValue(I.FURNITURE_DATA,this._data)}getLegacyString(){return!this._data||!this._data.length?"":this._data[pu.STATE]}compare(s){if(!(s instanceof pu))return!1;let t=0;for(;t<this._data.length;){if(t!==0){if(this._data[t]!==s.getValue(t))return!1}t++}return!0}getValue(s){return this._data[s]||""}setValue(s){this._data=s}};let Ma=pu;Ma.FORMAT_KEY=Ke.STRING_KEY;Ma.STATE=0;const Km=class extends Gr{constructor(){super(),this._state="",this._result=0}parseWrapper(s){s&&(this._state=s.readString(),this._result=s.readInt(),super.parseWrapper(s))}writeRoomObjectModel(s){super.writeRoomObjectModel(s),s.setValue(I.FURNITURE_DATA_FORMAT,Km.FORMAT_KEY);const t={};t.S=this._state,t.R=this._result.toString(),s.setValue(I.FURNITURE_DATA,t)}getLegacyString(){return this._state}compare(s){return!0}setString(s){this._state=s}get result(){return this._result}};let Yu=Km;Yu.FORMAT_KEY=Ke.VOTE_KEY;class vr{static getData(t){let e=null;switch(t&255){case bc.FORMAT_KEY:e=new bc;break;case Dc.FORMAT_KEY:e=new Dc;break;case Lc.FORMAT_KEY:e=new Lc;break;case _s.FORMAT_KEY:e=new _s;break;case wr.FORMAT_KEY:e=new wr;break;case Zo.FORMAT_KEY:e=new Zo;break;case Ma.FORMAT_KEY:e=new Ma;break;case Yu.FORMAT_KEY:e=new Yu;break}return e?(e.flags=t&65280,e):null}}class D{}D.MINIMUM=-2;D.ROOM=0;D.FLOOR=10;D.WALL=20;D.UNIT=100;D.CURSOR=200;class U{}U.FURNITURE_BASIC="furniture_basic";U.FURNITURE_MULTISTATE="furniture_multistate";U.FURNITURE_MULTIHEIGHT="furniture_multiheight";U.FURNITURE_RANDOMSTATE="furniture_randomstate";U.FURNITURE_PLACEHOLDER="furniture_placeholder";U.FURNITURE_CREDIT="furniture_credit";U.FURNITURE_STICKIE="furniture_stickie";U.FURNITURE_PRESENT="furniture_present";U.FURNITURE_TROPHY="furniture_trophy";U.FURNITURE_ECOTRON_BOX="furniture_ecotron_box";U.FURNITURE_DICE="furniture_dice";U.FURNITURE_HOCKEY_SCORE="furniture_hockey_score";U.FURNITURE_HABBOWHEEL="furniture_habbowheel";U.FURNITURE_ONE_WAY_DOOR="furniture_one_way_door";U.FURNITURE_PLANET_SYSTEM="furniture_planet_system";U.FURNITURE_WINDOW="furniture_window";U.FURNITURE_EXTERNAL_IMAGE_WALLITEM="furniture_external_image_wallitem";U.FURNITURE_ROOMDIMMER="furniture_roomdimmer";U.FURNITURE_SOUND_MACHINE="furniture_sound_machine";U.FURNITURE_JUKEBOX="furniture_jukebox";U.FURNITURE_CRACKABLE="furniture_crackable";U.FURNITURE_PUSHABLE="furniture_pushable";U.FURNITURE_CLOTHING_CHANGE="furniture_clothing_change";U.FURNITURE_COUNTER_CLOCK="furniture_counter_clock";U.FURNITURE_SCORE="furniture_score";U.FURNITURE_ES="furniture_es";U.FURNITURE_FIREWORKS="furniture_fireworks";U.FURNITURE_SONG_DISK="furniture_song_disk";U.FURNITURE_BB="furniture_bb";U.FURNITURE_BG="furniture_bg";U.FURNITURE_WELCOME_GIFT="furniture_welcome_gift";U.FURNITURE_FLOOR_HOLE="furniture_floor_hole";U.FURNITURE_MANNEQUIN="furniture_mannequin";U.FURNITURE_GUILD_CUSTOMIZED="furniture_guild_customized";U.FURNITURE_GROUP_FORUM_TERMINAL="furniture_group_forum_terminal";U.FURNITURE_PET_CUSTOMIZATION="furniture_pet_customization";U.FURNITURE_CUCKOO_CLOCK="furniture_cuckoo_clock";U.FURNITURE_VOTE_COUNTER="furniture_vote_counter";U.FURNITURE_VOTE_MAJORITY="furniture_vote_majority";U.FURNITURE_SOUNDBLOCK="furniture_soundblock";U.FURNITURE_RANDOM_TELEPORT="furniture_random_teleport";U.FURNITURE_MONSTERPLANT_SEED="furniture_monsterplant_seed";U.FURNITURE_PURCHASABLE_CLOTHING="furniture_purchasable_clothing";U.FURNITURE_BACKGROUND_COLOR="furniture_background_color";U.FURNITURE_MYSTERYBOX="furniture_mysterybox";U.FURNITURE_EFFECTBOX="furniture_effectbox";U.FURNITURE_MYSTERYTROPHY="furniture_mysterytrophy";U.FURNITURE_ACHIEVEMENT_RESOLUTION="furniture_achievement_resolution";U.FURNITURE_LOVELOCK="furniture_lovelock";U.FURNITURE_WILDWEST_WANTED="furniture_wildwest_wanted";U.FURNITURE_HWEEN_LOVELOCK="furniture_hween_lovelock";U.FURNITURE_BADGE_DISPLAY="furniture_badge_display";U.FURNITURE_HIGH_SCORE="furniture_high_score";U.FURNITURE_INTERNAL_LINK="furniture_internal_link";U.FURNITURE_CUSTOM_STACK_HEIGHT="furniture_custom_stack_height";U.FURNITURE_YOUTUBE="furniture_youtube";U.FURNITURE_RENTABLE_SPACE="furniture_rentable_space";U.FURNITURE_CHANGE_STATE_WHEN_STEP_ON="furniture_change_state_when_step_on";U.FURNITURE_VIMEO="furniture_vimeo";U.FURNITURE_EDITABLE_INTERNAL_LINK="furniture_editable_internal_link";U.FURNITURE_EDITABLE_ROOM_LINK="furniture_editable_room_link";U.FURNITURE_CRAFTING_GIZMO="furniture_crafting_gizmo";U.ROOM="room";U.USER="user";U.BOT="bot";U.RENTABLE_BOT="rentable_bot";U.PET="pet";U.TILE_CURSOR="tile_cursor";U.SELECTION_ARROW="selection_arrow";U.GAME_SNOWBALL="game_snowball";U.GAME_SNOWSPLASH="game_snowsplash";class at{}at.OBJECT_UNDEFINED="OBJECT_UNDEFINED";at.OBJECT_MOVE="OBJECT_MOVE";at.OBJECT_PLACE="OBJECT_PLACE";at.OBJECT_ROTATE_POSITIVE="OBJECT_ROTATE_POSITIVE";at.OBJECT_ROTATE_NEGATIVE="OBJECT_ROTATE_NEGATIVE";at.OBJECT_MOVE_TO="OBJECT_MOVE_TO";at.OBJECT_PLACE_TO="OBJECT_PLACE_TO";at.OBJECT_PICKUP="OBJECT_PICKUP";at.OBJECT_PICKUP_BOT="OBJECT_PICKUP_BOT";at.OBJECT_PICKUP_PET="OBJECT_PICKUP_PET";at.OBJECT_EJECT="OBJECT_EJECT";at.OBJECT_SAVE_STUFF_DATA="OBJECT_SAVE_STUFF_DATA";class Vs{}Vs.USER=1;Vs.PET=2;Vs.BOT=3;Vs.RENTABLE_BOT=4;const rn=class{static getTypeNumber(s){return rn.AVATAR_TYPES[s]}static getTypeString(s){for(const t in rn.AVATAR_TYPES)if(t&&rn.AVATAR_TYPES[t]===s)return t;return null}static getRealType(s){switch(s){case rn.BOT:case rn.RENTABLE_BOT:return rn.USER;default:return s}}};let ft=rn;ft.USER="user";ft.PET="pet";ft.BOT="bot";ft.RENTABLE_BOT="rentable_bot";ft.MONSTER_PLANT="monsterplant";ft.AVATAR_TYPES={user:1,pet:2,bot:3,rentable_bot:4};class F{}F.FURNITURE_STATIC="furniture_static";F.FURNITURE_ANIMATED="furniture_animated";F.FURNITURE_RESETTING_ANIMATED="furniture_resetting_animated";F.FURNITURE_POSTER="furniture_poster";F.FURNITURE_EXTERNAL_IMAGE="furniture_external_image";F.FURNITURE_HABBOWHEEL="furniture_habbowheel";F.FURNITURE_VAL_RANDOMIZER="furniture_val_randomizer";F.FURNITURE_BOTTLE="furniture_bottle";F.FURNITURE_PLANET_SYSTEM="furniture_planet_system";F.FURNITURE_QUEUE_TILE="furniture_queue_tile";F.FURNITURE_PARTY_BEAMER="furniture_party_beamer";F.FURNITURE_CUBOID="furniture_cuboid";F.FURNITURE_GIFT_WRAPPED="furniture_gift_wrapped";F.FURNITURE_GIFT_WRAPPED_FIREWORKS="furniture_gift_wrapped_fireworks";F.FURNITURE_COUNTER_CLOCK="furniture_counter_clock";F.FURNITURE_WATER_AREA="furniture_water_area";F.FURNITURE_SCORE_BOARD="furniture_score_board";F.FURNITURE_FIREWORKS="furniture_fireworks";F.FURNITURE_BB="furniture_bb";F.FURNITURE_ISOMETRIC_BB="furniture_isometric_bb";F.FURNITURE_BG="furniture_bg";F.FURNITURE_STICKIE="furniture_stickie";F.FURNITURE_MANNEQUIN="furniture_mannequin";F.FURNITURE_GUILD_CUSTOMIZED="furniture_guild_customized";F.FURNITURE_GUILD_ISOMETRIC_BADGE="furniture_guild_isometric_badge";F.FURNITURE_VOTE_COUNTER="furniture_vote_counter";F.FURNITURE_VOTE_MAJORITY="furniture_vote_majority";F.FURNITURE_SOUNDBLOCK="furniture_soundblock";F.FURNITURE_BADGE_DISPLAY="furniture_badge_display";F.FURNITURE_YOUTUBE="furniture_youtube";F.FURNITURE_BUILDER_PLACEHOLDER="furniture_builder_placeholder";F.ROOM="room";F.USER="user";F.PET_ANIMATED="pet_animated";F.BOT="bot";F.RENTABLE_BOT="rentable_bot";F.TILE_CURSOR="tile_cursor";class Hi{constructor(t,e,i,r=null){this._id=t,this._location=e,this._targetLocation=i,this._movementType=r}get id(){return this._id}get location(){return this._location}get targetLocation(){return this._targetLocation}get movementType(){return this._movementType}}Hi.MOVE="mv";Hi.SLIDE="sld";class Cf{}Cf.KICKED_OUT_OF_ROOM=4008;Cf.STRIP_LOCKED_FOR_TRADING=-13001;class Ta{}Ta.OLD_IDENTITY=0;Ta.NEW_IDENTITY=1;Ta.REAL_NOOB=2;class ms{}ms.NONE=0;ms.GUEST=1;ms.GUILD_MEMBER=2;ms.GUILD_ADMIN=3;ms.ROOM_OWNER=4;ms.MODERATOR=5;const mu=class{static getLocalizationKey(s){switch(s){case mu.FREE_TRADING:return"${trading.mode.free}";case mu.ROOM_CONTROLLER_REQUIRED:return"${trading.mode.controller}";case mu.NO_TRADING:return"${trading.mode.not.allowed}"}return""}};let Ml=mu;Ml.NO_TRADING=0;Ml.ROOM_CONTROLLER_REQUIRED=1;Ml.FREE_TRADING=2;class Ys{}Ys.SUPER_USER=9;Ys.ADMINISTRATOR=8;Ys.COMMUNITY=7;Ys.PLAYER_SUPPORT=6;Ys.MODERATOR=5;Ys.EMPLOYEE=4;Ys.BUS_PARTNER=3;Ys.PARTNER=2;Ys.CELEBRITY=1;Ys.NONE=0;var pn=(s=>(s.FLOOR="S",s.WALL="I",s.EFFECT="E",s.BADGE="B",s.ROBOT="R",s.HABBO_CLUB="H",s.PET="P",s))(pn||{});class Ms{}Ms.MATCH_ALL_PIXELS=-1;Ms.MATCH_OPAQUE_PIXELS=128;Ms.MATCH_NOTHING=256;class es{}es.DEFAULT=1;es.ROOM_PLANE=2;es.AVATAR=3;es.AVATAR_OWN=4;class qm{}class S{constructor(t=0,e=0,i=0){this._x=t,this._y=e,this._z=i,this._length=NaN}static sum(t,e){return!t||!e?null:new S(t.x+e.x,t.y+e.y,t.z+e.z)}static dif(t,e){return!t||!e?null:new S(t.x-e.x,t.y-e.y,t.z-e.z)}static product(t,e){return t?new S(t.x*e,t.y*e,t.z*e):null}static dotProduct(t,e){return!t||!e?0:t.x*e.x+t.y*e.y+t.z*e.z}static crossProduct(t,e){return!t||!e?null:new S(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}static scalarProjection(t,e){if(!t||!e)return-1;const i=e.length;return i>0?(t.x*e.x+t.y*e.y+t.z*e.z)/i:-1}static cosAngle(t,e){if(!t||!e)return 0;const i=t.length*e.length;return i?S.dotProduct(t,e)/i:0}static isEqual(t,e){return!(!t||!e||t.x!==e.x||t.y!==e.y||t.z!==e.z)}negate(){this._x=-this._x,this._y=-this._y,this._z=-this._z}add(t){t&&(this._x+=t.x,this._y+=t.y,this._z+=t.z,this._length=NaN)}subtract(t){t&&(this._x-=t.x,this._y-=t.y,this._z-=t.z,this._length=NaN)}multiply(t){this._x*=t,this._y*=t,this._z*=t,this._length=NaN}divide(t){t&&(this._x/=t,this._y/=t,this._z/=t,this._length=NaN)}assign(t){t&&(this._x=t.x,this._y=t.y,this._z=t.z,this._length=NaN)}get x(){return this._x}set x(t){this._x=t,this._length=NaN}get y(){return this._y}set y(t){this._y=t,this._length=NaN}get z(){return this._z}set z(t){this._z=t,this._length=NaN}get length(){return isNaN(this._length)&&(this._length=Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)),this._length}toString(){return`[Vector3d: ${this._x}, ${this._y}, ${this._z}]`}}class k{}k.MOUSE_CLICK="click";k.DOUBLE_CLICK="double_click";k.MOUSE_MOVE="mousemove";k.MOUSE_DOWN="mousedown";k.MOUSE_DOWN_LONG="mousedown_long";k.MOUSE_UP="mouseup";k.ROLL_OVER="mouseover";k.ROLL_OUT="mouseout";k.RIGHT_CLICK="contextmenu";class _h{}_h.TOUCH_START="touchstart";_h.TOUCH_MOVE="touchmove";_h.TOUCH_CANCEL="touchcancel";_h.TOUCH_END="touchend";_h.TOUCH_LONG="touchlong";const sr=class{constructor(s){this._ordinal=s}get ordinal(){return this._ordinal}equals(s){return s&&s._ordinal==this._ordinal}};let Br=sr;Br.NONE=new sr(0);Br.WAVE=new sr(1);Br.BLOW=new sr(2);Br.LAUGH=new sr(3);Br.CRY=new sr(4);Br.IDLE=new sr(5);Br.JUMP=new sr(6);Br.RESPECT=new sr(7);class je{}je.DUMMY="DUMMY";je.FRIEND_FURNITURE="FRIEND_FURNITURE";je.MONSTERPLANT_SEED="MONSTERPLANT_SEED";je.MYSTERY_BOX="MYSTERY_BOX";je.EFFECT_BOX="EFFECT_BOX";je.MYSTERY_TROPHY="MYSTERY_TROPHY";je.RANDOM_TELEPORT="RANDOM_TELEPORT";je.PURCHASABLE_CLOTHING="PURCHASABLE_CLOTHING";je.GENERIC_USABLE="GENERIC_USABLE";class tt{}tt.CHAT_WIDGET="RWE_CHAT_WIDGET";tt.INFOSTAND="RWE_INFOSTAND";tt.ME_MENU="RWE_ME_MENU";tt.CHAT_INPUT_WIDGET="RWE_CHAT_INPUT_WIDGET";tt.FURNI_PLACEHOLDER="RWE_FURNI_PLACEHOLDER";tt.FURNI_CREDIT_WIDGET="RWE_FURNI_CREDIT_WIDGET";tt.FURNI_STICKIE_WIDGET="RWE_FURNI_STICKIE_WIDGET";tt.FURNI_TROPHY_WIDGET="RWE_FURNI_TROPHY_WIDGET";tt.FURNI_LOVELOCK_WIDGET="RWE_FURNI_LOVELOCK_WIDGET";tt.FURNI_PRESENT_WIDGET="RWE_FURNI_PRESENT_WIDGET";tt.FURNI_ECOTRONBOX_WIDGET="RWE_FURNI_ECOTRONBOX_WIDGET";tt.FURNI_PET_PACKAGE_WIDGET="RWE_FURNI_PET_PACKAGE_WIDGET";tt.PLAYLIST_EDITOR_WIDGET="RWE_PLAYLIST_EDITOR_WIDGET";tt.DOORBELL="RWE_DOORBELL";tt.LOADINGBAR="RWE_LOADINGBAR";tt.ROOM_QUEUE="RWE_ROOM_QUEUE";tt.ROOM_POLL="RWE_ROOM_POLL";tt.ROOM_VOTE="RWE_ROOM_VOTE";tt.USER_CHOOSER="RWE_USER_CHOOSER";tt.FURNI_CHOOSER="RWE_FURNI_CHOOSER";tt.ROOM_DIMMER="RWE_ROOM_DIMMER";tt.FRIEND_REQUEST="RWE_FRIEND_REQUEST";tt.CLOTHING_CHANGE="RWE_CLOTHING_CHANGE";tt.CONVERSION_TRACKING="RWE_CONVERSION_TRACKING";tt.USER_NOTIFICATION="RWE_USER_NOTIFICATION";tt.FRIENDS_BAR="RWE_FRIENDS_BAR";tt.PURSE_WIDGET="RWE_PURSE_WIDGET";tt.AVATAR_INFO="RWE_AVATAR_INFO";tt.WELCOME_GIFT="RWE_WELCOME_GIFT";tt.SPAMWALL_POSTIT_WIDGET="RWE_SPAMWALL_POSTIT_WIDGET";tt.EFFECTS="RWE_EFFECTS";tt.MANNEQUIN="RWE_MANNEQUIN";tt.FURNITURE_CONTEXT_MENU="RWE_FURNITURE_CONTEXT_MENU";tt.LOCATION_WIDGET="RWE_LOCATION_WIDGET";tt.CAMERA="RWE_CAMERA";tt.ROOM_THUMBNAIL_CAMERA="RWE_ROOM_THUMBNAIL_CAMERA";tt.ROOM_BACKGROUND_COLOR="RWE_ROOM_BACKGROUND_COLOR";tt.CUSTOM_USER_NOTIFICATION="RWE_CUSTOM_USER_NOTIFICATION";tt.FURNI_ACHIEVEMENT_RESOLUTION_ENGRAVING="RWE_FURNI_ACHIEVEMENT_RESOLUTION_ENGRAVING";tt.FRIEND_FURNI_CONFIRM="RWE_FRIEND_FURNI_CONFIRM";tt.FRIEND_FURNI_ENGRAVING="RWE_FRIEND_FURNI_ENGRAVING";tt.HIGH_SCORE_DISPLAY="RWE_HIGH_SCORE_DISPLAY";tt.INTERNAL_LINK="RWE_INTERNAL_LINK";tt.CUSTOM_STACK_HEIGHT="RWE_CUSTOM_STACK_HEIGHT";tt.YOUTUBE="RWE_YOUTUBE";tt.RENTABLESPACE="RWE_RENTABLESPACE";tt.VIMEO="RWE_VIMEO";tt.ROOM_TOOLS="RWE_ROOM_TOOLS";tt.EXTERNAL_IMAGE="RWE_EXTERNAL_IMAGE";tt.WORD_QUIZZ="RWE_WORD_QUIZZ";tt.UI_HELP_BUBBLE="RWE_UI_HELP_BUBBLE";tt.ROOM_LINK="RWE_ROOM_LINK";tt.CRAFTING="RWE_CRAFTING";tt.ROOMGAME_CHECKERS="RWE_GAME_CHECKERS";class Me{}Me.INFOSTAND_EXTRA_PARAM="RWEIEP_INFOSTAND_EXTRA_PARAM";Me.JUKEBOX="RWEIEP_JUKEBOX";Me.USABLE_PRODUCT="RWEIEP_USABLE_PRODUCT";Me.SONGDISK="RWEIEP_SONGDISK";Me.CRACKABLE_FURNI="RWEIEP_CRACKABLE_FURNI";Me.BRANDING_OPTIONS="RWEIEP_BRANDING_OPTIONS";Me.USABLE="RWEIEP_USABLE";class Mf{}Mf.NOBODY=0;Mf.CONTROLLER=1;Mf.EVERYBODY=2;class mr{}mr.NORMAL=0;mr.GENERIC=1;mr.BOT=2;class cs{constructor(){this._isDisposed=!1,this._isDisposing=!1}dispose(){this._isDisposed||this._isDisposing||(this._isDisposing=!0,this.onDispose(),this._isDisposed=!0,this._isDisposing=!1)}onDispose(){}get disposed(){return this._isDisposed}get isDisposing(){return this._isDisposing}}class Rs extends cs{constructor(){super(),this._listeners=new Map}onDispose(){this.removeAllListeners(),super.onDispose()}addEventListener(t,e){if(!t||!e)return;const i=this._listeners.get(t);if(!i){this._listeners.set(t,[e]);return}i.push(e)}removeEventListener(t,e){if(!t||!e)return;const i=this._listeners.get(t);if(!(!i||!i.length)){for(const[r,n]of i.entries())if(!(!n||n!==e)){i.splice(r,1),i.length||this._listeners.delete(t);return}}}dispatchEvent(t){return t?(Y.events("Dispatched Event",t.type),this.processEvent(t),!0):!1}processEvent(t){const e=this._listeners.get(t.type);if(!e||!e.length)return;const i=[];for(const r of e)r&&i.push(r);for(;i.length;){const r=i.shift();try{r(t)}catch(n){Y.error(n.stack);return}}}removeAllListeners(){this._listeners.clear()}}class mi extends cs{constructor(){super(),this._events=new Rs,this._isLoaded=!1,this._isLoading=!1}init(){this._isLoaded||this._isLoading||this.isDisposing||(this._isLoading=!0,this.onInit(),this._isLoaded=!0,this._isLoading=!1)}onInit(){}onDispose(){this._events&&this._events.dispose(),super.onDispose()}reload(){this.dispose(),this.init()}get events(){return this._events}get isLoaded(){return this._isLoaded}get isLoading(){return this._isLoading}}class tD{constructor(t){this._value=t}get value(){return this._value}}class eD{constructor(t,e){this._header=t,this._buffer=e}readBytes(t){return this._buffer?this._buffer.readBytes(t):null}readByte(){return this._buffer?this._buffer.readByte():-1}readBoolean(){return this.readByte()===1}readShort(){return this._buffer?this._buffer.readShort():-1}readInt(){return this._buffer?this._buffer.readInt():-1}readFloat(){return this._buffer?this._buffer.readFloat():-1}readDouble(){return this._buffer?this._buffer.readDouble():-1}readString(){const t=this.readShort();return this._buffer.readBytes(t).toString("utf8")}get header(){return this._header}get bytesAvailable(){return this._buffer&&this._buffer.remaining()>0}}class sD{constructor(t){this._value=t}get value(){return this._value}}class iD{encode(t,e){const i=new nE;i.writeShort(t);for(const n of e){let a=typeof n;switch(a==="object"&&(n===null?a="null":n instanceof tD?a="byte":n instanceof sD?a="short":n instanceof ArrayBuffer&&(a="arraybuffer")),a){case"undefined":case"null":i.writeShort(0);break;case"byte":i.writeByte(n.value);break;case"short":i.writeShort(n.value);break;case"number":i.writeInt(n);break;case"boolean":i.writeByte(n?1:0);break;case"string":n?i.writeString(n,!0):i.writeShort(0);break;case"arraybuffer":i.writeBytes(n);break}}const r=i.getBuffer();return r?new nE().writeInt(r.byteLength).writeBytes(r):null}decode(t){if(!t||!t.dataBuffer||!t.dataBuffer.byteLength)return null;const e=[];for(;t.dataBuffer.byteLength&&!(t.dataBuffer.byteLength<4);){const i=new Ol(t.dataBuffer),r=i.readInt();if(r>t.dataBuffer.byteLength-4)break;const n=i.readBytes(r);e.push(new eD(n.readShort(),n)),t.dataBuffer=t.dataBuffer.slice(r+4)}return e}}class R{constructor(t,e){this._callBack=t,this._parserClass=e,this._parser=null,this._connection=null}dispose(){this._callBack=null,this._parserClass=null,this._parser=null,this._connection=null}get callBack(){return this._callBack}get parserClass(){return this._parserClass}get parser(){return this._parser}set parser(t){this._parser=t}get connection(){return this._connection}set connection(t){this._connection=t}}class Rt{constructor(t){this._type=t}get type(){return this._type}}class Oe extends Rt{constructor(t,e,i){super(t),this._connection=e,this._originalEvent=event}get connection(){return this._connection}get originalEvent(){return this._originalEvent}}Oe.CONNECTION_OPENED="SCE_OPEN";Oe.CONNECTION_CLOSED="SCE_CLOSED";Oe.CONNECTION_ERROR="SCE_ERROR";Oe.CONNECTION_MESSAGE="SCE_MESSAGE";class ua extends Rt{constructor(t,e){super(t),this._library=e}get library(){return this._library}}ua.DOWNLOAD_COMPLETE="ARELE_DOWNLOAD_COMPLETE";class Nl{}Nl.AVATAR_RENDER_READY="AVATAR_RENDER_READY";class la extends Rt{constructor(t,e){super(t),this._library=e}get library(){return this._library}}la.DOWNLOAD_COMPLETE="ARLE_DOWNLOAD_COMPLETE";class Uc extends Rt{constructor(t){super(t)}}Uc.INITIALIZED="RCWM_INITIALIZED";class Ve extends Rt{constructor(t,e){super(t),this._connection=e}get connection(){return this._connection}}Ve.CONNECTION_ESTABLISHED="NCE_ESTABLISHED";Ve.CONNECTION_CLOSED="NCE_CLOSED";Ve.CONNECTION_ERROR="NCE_ERROR";Ve.CONNECTION_HANDSHAKING="NCE_HANDSHAKING";Ve.CONNECTION_HANDSHAKED="NCE_HANDSHAKED";Ve.CONNECTION_HANDSHAKE_FAILED="NCE_HANDSHAKE_FAILED";Ve.CONNECTION_AUTHENTICATED="NCE_AUTHENTICATED";class _a extends Rt{constructor(t){super(t)}}_a.LOADED="NLE_LOADED";_a.FAILED="NLE_FAILED";const xc=class extends Rt{constructor(){super(xc.SETTINGS_UPDATED)}clone(){const s=new xc;return s._volumeSystem=this._volumeSystem,s._volumeFurni=this._volumeFurni,s._volumeTrax=this._volumeTrax,s._oldChat=this._oldChat,s._roomInvites=this._roomInvites,s._cameraFollow=this._cameraFollow,s._flags=this._flags,s._chatType=this._chatType,s}get volumeSystem(){return this._volumeSystem}set volumeSystem(s){this._volumeSystem=s}get volumeFurni(){return this._volumeFurni}set volumeFurni(s){this._volumeFurni=s}get volumeTrax(){return this._volumeTrax}set volumeTrax(s){this._volumeTrax=s}get oldChat(){return this._oldChat}set oldChat(s){this._oldChat=s}get roomInvites(){return this._roomInvites}set roomInvites(s){this._roomInvites=s}get cameraFollow(){return this._cameraFollow}set cameraFollow(s){this._cameraFollow=s}get flags(){return this._flags}set flags(s){this._flags=s}get chatType(){return this._chatType}set chatType(s){this._chatType=s}};let Ra=xc;Ra.SETTINGS_UPDATED="NSE_SETTINGS_UPDATED";class Iu extends Rt{constructor(t,e){super(t),this._sampleCode=e}get sampleCode(){return this._sampleCode}}Iu.PLAY_SOUND="NSOE_PLAY_SOUND";class Nf extends Rt{constructor(t){super(t)}get iconId(){return this._iconId}set iconId(t){this._iconId=t}get iconName(){return this._iconName}set iconName(t){this._iconName=t}}Nf.TOOLBAR_CLICK="NTE_TOOLBAR_CLICK";Nf.SELECT_OWN_AVATAR="NTE_SELECT_OWN_AVATAR";const Zm=class extends Nf{constructor(s,t,e){super(Zm.ANIMATE_ICON),this._image=s,this._x=t,this._y=e}get image(){return this._image}get x(){return this._x}get y(){return this._y}};let Fc=Zm;Fc.ANIMATE_ICON="NTAIE_ANIMATE_ICON";class Mt extends Rt{constructor(t,e){super(t),this._roomId=e}get roomId(){return this._roomId}}Mt.INITIALIZED="REE_INITIALIZED";Mt.ENGINE_INITIALIZED="REE_ENGINE_INITIALIZED";Mt.OBJECTS_INITIALIZED="REE_OBJECTS_INITIALIZED";Mt.NORMAL_MODE="REE_NORMAL_MODE";Mt.GAME_MODE="REE_GAME_MODE";Mt.ROOM_ZOOMED="REE_ROOM_ZOOMED";Mt.DISPOSED="REE_DISPOSED";const Qm=class extends Mt{constructor(s,t,e,i){super(Qm.ROOM_COLOR,s),this._color=t,this._brightness=e,this._bgOnly=i}get color(){return this._color}get brightness(){return this._brightness}get bgOnly(){return this._bgOnly}};let Jm=Qm;Jm.ROOM_COLOR="REE_ROOM_COLOR";class li extends Rt{constructor(t,e){super(t),this._contentType=e}get contentType(){return this._contentType}}li.RCLE_SUCCESS="RCLE_SUCCESS";li.RCLE_FAILURE="RCLE_FAILURE";li.RCLE_CANCEL="RCLE_CANCEL";const $m=class extends Mt{constructor(s,t,e){super($m.ROOM_DRAG,s),this._offsetX=t,this._offsetY=e}get offsetX(){return this._offsetX}get offsetY(){return this._offsetY}};let tI=$m;tI.ROOM_DRAG="RDE_ROOM_DRAG";const eI=class extends Mt{constructor(s,t,e,i,r,n){super(eI.ROOM_COLOR,s),this._state=t,this._presetId=e,this._effectId=i,this._color=r,this._brightness=n}get state(){return this._state}get presetId(){return this._presetId}get effectId(){return this._effectId}get color(){return this._color}get brightness(){return this._brightness}};let sI=eI;sI.ROOM_COLOR="REDSE_ROOM_COLOR";class Q extends Mt{constructor(t,e,i,r){super(t,e),this._objectId=i,this._category=r}get objectId(){return this._objectId}get category(){return this._category}}Q.SELECTED="REOE_SELECTED";Q.DESELECTED="REOE_DESELECTED";Q.ADDED="REOE_ADDED";Q.REMOVED="REOE_REMOVED";Q.PLACED="REOE_PLACED";Q.PLACED_ON_USER="REOE_PLACED_ON_USER";Q.CONTENT_UPDATED="REOE_CONTENT_UPDATED";Q.REQUEST_MOVE="REOE_REQUEST_MOVE";Q.REQUEST_ROTATE="REOE_REQUEST_ROTATE";Q.REQUEST_MANIPULATION="REOE_REQUEST_MANIPULATION";Q.MOUSE_ENTER="REOE_MOUSE_ENTER";Q.MOUSE_LEAVE="REOE_MOUSE_LEAVE";Q.DOUBLE_CLICK="REOE_DOUBLE_CLICK";class rD extends Q{constructor(t,e,i,r,n,a,o,h,u,c,l,_,d){super(t,e,i,r),this._wallLocation="",this._x=0,this._y=0,this._z=0,this._direction=0,this._placedInRoom=!1,this._placedOnFloor=!1,this._placedOnWall=!1,this._instanceData=null,this._wallLocation=n,this._x=a,this._y=o,this._z=h,this._direction=u,this._placedInRoom=c,this._placedOnFloor=l,this._placedOnWall=_,this._instanceData=d}get wallLocation(){return this._wallLocation}get x(){return this._x}get y(){return this._y}get z(){return this._z}get direction(){return this._direction}get placedInRoom(){return this._placedInRoom}get placedOnFloor(){return this._placedOnFloor}get placedOnWall(){return this._placedOnWall}get instanceData(){return this._instanceData}}class nD extends Q{constructor(t,e,i,r,n,a){super(t,e,i,r),this._droppedObjectId=n,this._droppedObjectCategory=a}get droppedObjectId(){return this._droppedObjectId}get droppedObjectCategory(){return this._droppedObjectCategory}}class ca extends Q{constructor(t,e,i,r,n,a=1){super(t,e,i,r),this._soundId=n,this._pitch=a}get soundId(){return this._soundId}get pitch(){return this._pitch}}ca.PLAY_SOUND="REOPSE_PLAY_SOUND";ca.PLAY_SOUND_AT_PITCH="REOPSE_PLAY_SOUND_AT_PITCH";class Sr extends Q{}Sr.FURNI_CLICK="RERAE_FURNI_CLICK";Sr.FURNI_DOUBLE_CLICK="RERAE_FURNI_DOUBLE_CLICK";Sr.TOOLTIP_SHOW="RERAE_TOOLTIP_SHOW";Sr.TOOLTIP_HIDE="RERAE_TOOLTIP_HIDE";class $e extends Q{constructor(t,e,i,r,n,a=1){super(t,e,i,r),this._sampleId=n,this._pitch=a}get sampleId(){return this._sampleId}get pitch(){return this._pitch}}$e.ROOM_OBJECT_INITIALIZED="ROPSPE_ROOM_OBJECT_INITIALIZED";$e.ROOM_OBJECT_DISPOSED="ROPSPE_ROOM_OBJECT_DISPOSED";$e.PLAY_SAMPLE="ROPSPE_PLAY_SAMPLE";$e.CHANGE_PITCH="ROPSPE_CHANGE_PITCH";class B extends Q{constructor(t,e,i,r,n=null){super(t,e,i,r),this._widget=n}get widget(){return this._widget}get contextMenu(){return this._widget}}B.OPEN_WIDGET="RETWE_OPEN_WIDGET";B.CLOSE_WIDGET="RETWE_CLOSE_WIDGET";B.OPEN_FURNI_CONTEXT_MENU="RETWE_OPEN_FURNI_CONTEXT_MENU";B.CLOSE_FURNI_CONTEXT_MENU="RETWE_CLOSE_FURNI_CONTEXT_MENU";B.REQUEST_PLACEHOLDER="RETWE_REQUEST_PLACEHOLDER";B.REQUEST_CREDITFURNI="RETWE_REQUEST_CREDITFURNI";B.REQUEST_STACK_HEIGHT="RETWE_REQUEST_STACK_HEIGHT";B.REQUEST_EXTERNAL_IMAGE="RETWE_REQUEST_EXTERNAL_IMAGE";B.REQUEST_STICKIE="RETWE_REQUEST_STICKIE";B.REQUEST_PRESENT="RETWE_REQUEST_PRESENT";B.REQUEST_TROPHY="RETWE_REQUEST_TROPHY";B.REQUEST_TEASER="RETWE_REQUEST_TEASER";B.REQUEST_ECOTRONBOX="RETWE_REQUEST_ECOTRONBOX";B.REQUEST_DIMMER="RETWE_REQUEST_DIMMER";B.REMOVE_DIMMER="RETWE_REMOVE_DIMMER";B.REQUEST_CLOTHING_CHANGE="RETWE_REQUEST_CLOTHING_CHANGE";B.REQUEST_PLAYLIST_EDITOR="RETWE_REQUEST_PLAYLIST_EDITOR";B.REQUEST_MANNEQUIN="RETWE_REQUEST_MANNEQUIN";B.REQUEST_MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG="ROWRE_REQUEST_MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG";B.REQUEST_PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG="ROWRE_REQUEST_PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG";B.REQUEST_BACKGROUND_COLOR="RETWE_REQUEST_BACKGROUND_COLOR";B.REQUEST_MYSTERYBOX_OPEN_DIALOG="RETWE_REQUEST_MYSTERYBOX_OPEN_DIALOG";B.REQUEST_EFFECTBOX_OPEN_DIALOG="RETWE_REQUEST_EFFECTBOX_OPEN_DIALOG";B.REQUEST_MYSTERYTROPHY_OPEN_DIALOG="RETWE_REQUEST_MYSTERYTROPHY_OPEN_DIALOG";B.REQUEST_ACHIEVEMENT_RESOLUTION_ENGRAVING="RETWE_REQUEST_ACHIEVEMENT_RESOLUTION_ENGRAVING";B.REQUEST_ACHIEVEMENT_RESOLUTION_FAILED="RETWE_REQUEST_ACHIEVEMENT_RESOLUTION_FAILED";B.REQUEST_FRIEND_FURNITURE_CONFIRM="RETWE_REQUEST_FRIEND_FURNITURE_CONFIRM";B.REQUEST_FRIEND_FURNITURE_ENGRAVING="RETWE_REQUEST_FRIEND_FURNITURE_ENGRAVING";B.REQUEST_BADGE_DISPLAY_ENGRAVING="RETWE_REQUEST_BADGE_DISPLAY_ENGRAVING";B.REQUEST_HIGH_SCORE_DISPLAY="RETWE_REQUEST_HIGH_SCORE_DISPLAY";B.REQUEST_HIDE_HIGH_SCORE_DISPLAY="RETWE_REQUEST_HIDE_HIGH_SCORE_DISPLAY";B.REQUEST_INTERNAL_LINK="RETWE_REQUEST_INTERNAL_LINK";B.REQUEST_ROOM_LINK="RETWE_REQUEST_ROOM_LINK";B.REQUEST_YOUTUBE="RETWE_REQUEST_YOUTUBE";class Wu extends Q{constructor(t,e,i,r,n=-1,a=-1){super(t,e,i,r),this._inventoryStripId=n,this._furnitureTypeId=a}get inventoryStripId(){return this._inventoryStripId}get furnitureTypeId(){return this._furnitureTypeId}}Wu.USE_PRODUCT_FROM_ROOM="REUPE_USE_PRODUCT_FROM_ROOM";Wu.USE_PRODUCT_FROM_INVENTORY="REUPE_USE_PRODUCT_FROM_INVENTORY";class bs extends Rt{constructor(t,e){super(t),this._object=e}get object(){return this._object}get objectId(){return this._object?this._object.id:-1}get objectType(){return this._object?this._object.type:null}}class gi extends bs{constructor(t,e,i,r=!0){super(t,e),this._badgeId=i,this._groupBadge=r}get badgeId(){return this._badgeId}get groupBadge(){return this._groupBadge}}gi.LOAD_BADGE="ROBAE_LOAD_BADGE";class Cs extends bs{constructor(t,e){super(t,e)}}Cs.RODRE_CURRENT_USER_ID="RODRE_CURRENT_USER_ID";Cs.RODRE_URL_PREFIX="RODRE_URL_PREFIX";const iI=class extends bs{constructor(s,t,e,i,r,n){super(iI.DIMMER_STATE,s),this._state=t,this._presetId=e,this._effectId=i,this._color=r,this._brightness=n}get state(){return this._state}get presetId(){return this._presetId}get effectId(){return this._effectId}get color(){return this._color}get brightness(){return this._brightness}};let Oa=iI;Oa.DIMMER_STATE="RODSUE_DIMMER_STATE";class ze extends bs{constructor(t,e){super(t,e)}}ze.ADD_HOLE="ROFHO_ADD_HOLE";ze.REMOVE_HOLE="ROFHO_REMOVE_HOLE";class G extends bs{}G.DICE_OFF="ROFCAE_DICE_OFF";G.DICE_ACTIVATE="ROFCAE_DICE_ACTIVATE";G.USE_HABBOWHEEL="ROFCAE_USE_HABBOWHEEL";G.STICKIE="ROFCAE_STICKIE";G.ENTER_ONEWAYDOOR="ROFCAE_ENTER_ONEWAYDOOR";G.SOUND_MACHINE_INIT="ROFCAE_SOUND_MACHINE_INIT";G.SOUND_MACHINE_START="ROFCAE_SOUND_MACHINE_START";G.SOUND_MACHINE_STOP="ROFCAE_SOUND_MACHINE_STOP";G.SOUND_MACHINE_DISPOSE="ROFCAE_SOUND_MACHINE_DISPOSE";G.JUKEBOX_INIT="ROFCAE_JUKEBOX_INIT";G.JUKEBOX_START="ROFCAE_JUKEBOX_START";G.JUKEBOX_MACHINE_STOP="ROFCAE_JUKEBOX_MACHINE_STOP";G.JUKEBOX_DISPOSE="ROFCAE_JUKEBOX_DISPOSE";G.MOUSE_BUTTON="ROFCAE_MOUSE_BUTTON";G.MOUSE_ARROW="ROFCAE_MOUSE_ARROW";class wc extends Mt{constructor(t,e,i,r,n,a){super(t,e),this._enable=i,this._hue=r,this._saturation=n,this._lightness=a}get enable(){return this._enable}get hue(){return this._hue}get saturation(){return this._saturation}get lightness(){return this._lightness}}wc.ROOM_BACKGROUND_COLOR="ROHSLCEE_ROOM_BACKGROUND_COLOR";class Ir extends bs{constructor(t,e,i,r,n,a){super(t,e),this._enable=i,this._hue=r,this._saturation=n,this._lightness=a}get enable(){return this._enable}get hue(){return this._hue}get saturation(){return this._saturation}get lightness(){return this._lightness}}Ir.ROOM_BACKGROUND_COLOR="ROHSLCEE_ROOM_BACKGROUND_COLOR";class $ extends bs{constructor(t,e,i,r=!1,n=!1,a=!1,o=!1){super(t,e),this._eventId="",this._eventId=i,this._altKey=r,this._ctrlKey=n,this._shiftKey=a,this._buttonDown=o}get eventId(){return this._eventId}get altKey(){return this._altKey}get ctrlKey(){return this._ctrlKey}get shiftKey(){return this._shiftKey}get buttonDown(){return this._buttonDown}get localX(){return this._localX}set localX(t){this._localX=t}get localY(){return this._localY}set localY(t){this._localY=t}get spriteOffsetX(){return this._spriteOffsetX}set spriteOffsetX(t){this._spriteOffsetX=t}get spriteOffsetY(){return this._spriteOffsetY}set spriteOffsetY(t){this._spriteOffsetY=t}}$.CLICK="ROE_MOUSE_CLICK";$.DOUBLE_CLICK="ROE_MOUSE_DOUBLE_CLICK";$.MOUSE_MOVE="ROE_MOUSE_MOVE";$.MOUSE_DOWN="ROE_MOUSE_DOWN";$.MOUSE_DOWN_LONG="ROE_MOUSE_DOWN_LONG";$.MOUSE_UP="ROE_MOUSE_UP";$.MOUSE_ENTER="ROE_MOUSE_ENTER";$.MOUSE_LEAVE="ROE_MOUSE_LEAVE";class Xe extends bs{constructor(t,e){super(t,e)}}Xe.POSITION_CHANGED="ROME_POSITION_CHANGED";Xe.OBJECT_REMOVED="ROME_OBJECT_REMOVED";class ki extends G{constructor(t,e,i,r=1){super(t,e),this._soundId=i,this._pitch=r}get soundId(){return this._soundId}get pitch(){return this._pitch}}ki.PLAY_SOUND="ROPSIE_PLAY_SOUND";ki.PLAY_SOUND_AT_PITCH="ROPSIE_PLAY_SOUND_AT_PITCH";class kt extends bs{constructor(t,e,i="",r=""){super(t,e),this._imageUrl="",this._clickUrl="",this._imageUrl=i,this._clickUrl=r}get imageUrl(){return this._imageUrl}get clickUrl(){return this._clickUrl}}kt.ROOM_AD_LOAD_IMAGE="RORAE_ROOM_AD_LOAD_IMAGE";kt.ROOM_AD_FURNI_CLICK="RORAE_ROOM_AD_FURNI_CLICK";kt.ROOM_AD_FURNI_DOUBLE_CLICK="RORAE_ROOM_AD_FURNI_DOUBLE_CLICK";kt.ROOM_AD_TOOLTIP_SHOW="RORAE_ROOM_AD_TOOLTIP_SHOW";kt.ROOM_AD_TOOLTIP_HIDE="RORAE_ROOM_AD_TOOLTIP_HIDE";class ne extends bs{constructor(t,e,i,r=1){super(t,e),this._sampleId=i,this._pitch=r}get sampleId(){return this._sampleId}get pitch(){return this._pitch}}ne.ROOM_OBJECT_INITIALIZED="ROPSPE_ROOM_OBJECT_INITIALIZED";ne.ROOM_OBJECT_DISPOSED="ROPSPE_ROOM_OBJECT_DISPOSED";ne.PLAY_SAMPLE="ROPSPE_PLAY_SAMPLE";ne.CHANGE_PITCH="ROPSPE_CHANGE_PITCH";class xt extends Q{}xt.SOUND_MACHINE_INIT="ROSM_SOUND_MACHINE_INIT";xt.SOUND_MACHINE_SWITCHED_ON="ROSM_SOUND_MACHINE_SWITCHED_ON";xt.SOUND_MACHINE_SWITCHED_OFF="ROSM_SOUND_MACHINE_SWITCHED_OFF";xt.SOUND_MACHINE_DISPOSE="ROSM_SOUND_MACHINE_DISPOSE";xt.JUKEBOX_INIT="ROSM_JUKEBOX_INIT";xt.JUKEBOX_SWITCHED_ON="ROSM_JUKEBOX_SWITCHED_ON";xt.JUKEBOX_SWITCHED_OFF="ROSM_JUKEBOX_SWITCHED_OFF";xt.JUKEBOX_DISPOSE="ROSM_JUKEBOX_DISPOSE";class Tt extends bs{constructor(t,e,i=0){super(t,e),this._state=i}get state(){return this._state}}Tt.STATE_CHANGE="ROSCE_STATE_CHANGE";Tt.STATE_RANDOM="ROSCE_STATE_RANDOM";class vi extends ${constructor(t,e,i,r,n,a,o=!1,h=!1,u=!1,c=!1){super(t,e,i,o,h,u,c),this._tileX=r,this._tileY=n,this._tileZ=a}get tileX(){return this._tileX}get tileY(){return this._tileY}get tileZ(){return this._tileZ}get tileXAsInt(){return Math.trunc(this._tileX+.499)}get tileYAsInt(){return Math.trunc(this._tileY+.499)}get tileZAsInt(){return Math.trunc(this._tileZ+.499)}}class Kn extends ${constructor(t,e,i,r,n,a,o,h,u,c=!1,l=!1,_=!1,d=!1){super(t,e,i,c,l,_,d),this._wallLocation=new S,this._wallWd=new S,this._wallHt=new S,this._wallLocation.assign(r),this._wallWd.assign(n),this._wallHt.assign(a),this._x=o,this._y=h,this._direction=u}get wallLocation(){return this._wallLocation}get wallWidth(){return this._wallWd}get wallHeight(){return this._wallHt}get x(){return this._x}get y(){return this._y}get direction(){return this._direction}}class M extends bs{constructor(t,e){super(t,e)}}M.OPEN_WIDGET="ROWRE_OPEN_WIDGET";M.CLOSE_WIDGET="ROWRE_CLOSE_WIDGET";M.OPEN_FURNI_CONTEXT_MENU="ROWRE_OPEN_FURNI_CONTEXT_MENU";M.CLOSE_FURNI_CONTEXT_MENU="ROWRE_CLOSE_FURNI_CONTEXT_MENU";M.PLACEHOLDER="ROWRE_PLACEHOLDER";M.CREDITFURNI="ROWRE_CREDITFURNI";M.STACK_HEIGHT="ROWRE_STACK_HEIGHT";M.EXTERNAL_IMAGE="ROWRE_EXTERNAL_IMAGE";M.STICKIE="ROWRE_STICKIE";M.PRESENT="ROWRE_PRESENT";M.TROPHY="ROWRE_TROPHY";M.TEASER="ROWRE_TEASER";M.ECOTRONBOX="ROWRE_ECOTRONBOX";M.DIMMER="ROWRE_DIMMER";M.WIDGET_REMOVE_DIMMER="ROWRE_WIDGET_REMOVE_DIMMER";M.CLOTHING_CHANGE="ROWRE_CLOTHING_CHANGE";M.JUKEBOX_PLAYLIST_EDITOR="ROWRE_JUKEBOX_PLAYLIST_EDITOR";M.MANNEQUIN="ROWRE_MANNEQUIN";M.PET_PRODUCT_MENU="ROWRE_PET_PRODUCT_MENU";M.GUILD_FURNI_CONTEXT_MENU="ROWRE_GUILD_FURNI_CONTEXT_MENU";M.MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG="ROWRE_MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG";M.PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG="ROWRE_PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG";M.BACKGROUND_COLOR="ROWRE_BACKGROUND_COLOR";M.MYSTERYBOX_OPEN_DIALOG="ROWRE_MYSTERYBOX_OPEN_DIALOG";M.EFFECTBOX_OPEN_DIALOG="ROWRE_EFFECTBOX_OPEN_DIALOG";M.MYSTERYTROPHY_OPEN_DIALOG="ROWRE_MYSTERYTROPHY_OPEN_DIALOG";M.ACHIEVEMENT_RESOLUTION_OPEN="ROWRE_ACHIEVEMENT_RESOLUTION_OPEN";M.ACHIEVEMENT_RESOLUTION_ENGRAVING="ROWRE_ACHIEVEMENT_RESOLUTION_ENGRAVING";M.ACHIEVEMENT_RESOLUTION_FAILED="ROWRE_ACHIEVEMENT_RESOLUTION_FAILED";M.FRIEND_FURNITURE_CONFIRM="ROWRE_FRIEND_FURNITURE_CONFIRM";M.FRIEND_FURNITURE_ENGRAVING="ROWRE_FRIEND_FURNITURE_ENGRAVING";M.BADGE_DISPLAY_ENGRAVING="ROWRE_BADGE_DISPLAY_ENGRAVING";M.HIGH_SCORE_DISPLAY="ROWRE_HIGH_SCORE_DISPLAY";M.HIDE_HIGH_SCORE_DISPLAY="ROWRE_HIDE_HIGH_SCORE_DISPLAY";M.INERNAL_LINK="ROWRE_INTERNAL_LINK";M.ROOM_LINK="ROWRE_ROOM_LINK";M.YOUTUBE="ROWRE_YOUTUBE";class aD{constructor(t,e,i,r,n,a,o=0,h=0,u=!1,c=!1,l=!1,_=!1){this._type=t,this._eventId=e,this._canvasId=i,this._spriteTag=r,this._screenX=n,this._screenY=a,this._localX=o,this._localY=h,this._ctrlKey=u,this._altKey=c,this._shiftKey=l,this._buttonDown=_,this._spriteOffsetX=0,this._spriteOffsetY=0}get type(){return this._type}get eventId(){return this._eventId}get canvasId(){return this._canvasId}get spriteTag(){return this._spriteTag}get screenX(){return this._screenX}get screenY(){return this._screenY}get localX(){return this._localX}get localY(){return this._localY}get ctrlKey(){return this._ctrlKey}get altKey(){return this._altKey}get shiftKey(){return this._shiftKey}get buttonDown(){return this._buttonDown}get spriteOffsetX(){return this._spriteOffsetX}set spriteOffsetX(t){this._spriteOffsetX=t}get spriteOffsetY(){return this._spriteOffsetY}set spriteOffsetY(t){this._spriteOffsetY=t}}class oD extends Rt{constructor(t){super(t)}}class Qo extends oD{constructor(t,e){super(t),this._targetLocation=e}get targetLocation(){return this._targetLocation}}Qo.ROAME_MOVE_TO="ROAME_MOVE_TO";const rI=class extends Mt{constructor(s,t,e=!1,i=!1){super(rI.ROOM_ZOOM,s),this._level=t,this._forceFlip=e,this._asDelta=i}get level(){return this._level}get forceFlip(){return this._forceFlip}get asDelta(){return this._asDelta}};let hD=rI;hD.ROOM_ZOOM="REE_ROOM_ZOOM";const nI=class extends Rt{constructor(s,t){super(nI.IMAGE_READY),this._badgeId=s,this._image=t}get badgeId(){return this._badgeId}get image(){return this._image}};let Jo=nI;Jo.IMAGE_READY="BIME_BADGE_IMAGE_READY";const aI=class extends Rt{constructor(s,t){super(aI.MYSTERY_BOX_KEYS_UPDATE),this._boxColor=s,this._keyColor=t}get boxColor(){return this._boxColor}get keyColor(){return this._keyColor}};let oI=aI;oI.MYSTERY_BOX_KEYS_UPDATE="mbke_update";const hI=class extends Rt{constructor(){super(hI.PERKS_UPDATED)}};let uD=hI;uD.PERKS_UPDATED="PUE_perks_updated";class nt extends Rt{constructor(t,e,i=!0){super(t),this._session=e,this._openLandingView=i}get session(){return this._session}get openLandingView(){return this._openLandingView}}nt.CREATED="RSE_CREATED";nt.STARTED="RSE_STARTED";nt.ENDED="RSE_ENDED";nt.ROOM_DATA="RSE_ROOM_DATA";class It extends nt{constructor(t,e,i,r,n,a=0,o=null,h=-1){super(t,e),this._objectId=i,this._message=r,this._chatType=n,this._links=o,this._extraParam=h,this._style=a}get objectId(){return this._objectId}get message(){return this._message}get chatType(){return this._chatType}get links(){return this._links}get extraParam(){return this._extraParam}get style(){return this._style}}It.CHAT_EVENT="RSCE_CHAT_EVENT";It.FLOOD_EVENT="RSCE_FLOOD_EVENT";It.CHAT_TYPE_SPEAK=0;It.CHAT_TYPE_WHISPER=1;It.CHAT_TYPE_SHOUT=2;It.CHAT_TYPE_RESPECT=3;It.CHAT_TYPE_PETRESPECT=4;It.CHAT_TYPE_HAND_ITEM_RECEIVED=5;It.CHAT_TYPE_PETTREAT=6;It.CHAT_TYPE_PETREVIVE=7;It.CHAT_TYPE_PET_REBREED_FERTILIZE=8;It.CHAT_TYPE_PET_SPEED_FERTILIZE=9;It.CHAT_TYPE_MUTE_REMAINING=10;const uI=class extends nt{constructor(s,t,e,i,r,n){super(uI.CONFIRM_PET_BREEDING,s),this._nestId=t,this._pet1=e,this._pet2=i,this._rarityCategories=r,this._resultPetTypeId=n}get nestId(){return this._nestId}get pet1(){return this._pet1}get pet2(){return this._pet2}get rarityCategories(){return this._rarityCategories}get resultPetTypeId(){return this._resultPetTypeId}};let lI=uI;lI.CONFIRM_PET_BREEDING="RSPFUE_CONFIRM_PET_BREEDING";const _I=class extends nt{constructor(s,t,e){super(_I.RSPFUE_CONFIRM_PET_BREEDING_RESULT,s),this._breedingNestStuffId=t,this._result=e}get breedingNestStuffId(){return this._breedingNestStuffId}get result(){return this._result}};let cI=_I;cI.RSPFUE_CONFIRM_PET_BREEDING_RESULT="RSPFUE_CONFIRM_PET_BREEDING_RESULT";const dI=class extends nt{constructor(s,t,e){super(dI.RSDE_DANCE,s),this._roomIndex=t,this._danceId=e}get roomIndex(){return this._roomIndex}get danceId(){return this._danceId}};let fI=dI;fI.RSDE_DANCE="RSDE_DANCE";class lD{constructor(t,e,i,r){this._id=t,this._type=e,this._color=i,this._brightness=r}get id(){return this._id}get type(){return this._type}get color(){return this._color}get brightness(){return this._brightness}}class Gc extends nt{constructor(t,e){super(t,e),this._selectedPresetId=0,this._presets=[]}storePreset(t,e,i,r){this._presets[t-1]=new lD(t,e,i,r)}getPreset(t){return t<0||t>=this._presets.length?null:this._presets[t]}get presetCount(){return this._presets.length}get selectedPresetId(){return this._selectedPresetId}set selectedPresetId(t){this._selectedPresetId=t}}Gc.ROOM_DIMMER_PRESETS="RSDPE_PRESETS";class ji extends nt{constructor(t,e,i){super(t,e),this._userName="",this._userName=i}get userName(){return this._userName}}ji.DOORBELL="RSDE_DOORBELL";ji.RSDE_REJECTED="RSDE_REJECTED";ji.RSDE_ACCEPTED="RSDE_ACCEPTED";class Zt extends nt{constructor(t,e,i=null){super(t,e),this._message=i}get message(){return this._message}}Zt.RSEME_KICKED="RSEME_KICKED";Zt.RSEME_PETS_FORBIDDEN_IN_HOTEL="RSEME_PETS_FORBIDDEN_IN_HOTEL";Zt.RSEME_PETS_FORBIDDEN_IN_FLAT="RSEME_PETS_FORBIDDEN_IN_FLAT";Zt.RSEME_MAX_PETS="RSEME_MAX_PETS";Zt.RSEME_MAX_NUMBER_OF_OWN_PETS="RSEME_MAX_NUMBER_OF_OWN_PETS";Zt.RSEME_NO_FREE_TILES_FOR_PET="RSEME_NO_FREE_TILES_FOR_PET";Zt.RSEME_SELECTED_TILE_NOT_FREE_FOR_PET="RSEME_SELECTED_TILE_NOT_FREE_FOR_PET";Zt.RSEME_BOTS_FORBIDDEN_IN_HOTEL="RSEME_BOTS_FORBIDDEN_IN_HOTEL";Zt.RSEME_BOTS_FORBIDDEN_IN_FLAT="RSEME_BOTS_FORBIDDEN_IN_FLAT";Zt.RSEME_BOT_LIMIT_REACHED="RSEME_BOT_LIMIT_REACHED";Zt.RSEME_SELECTED_TILE_NOT_FREE_FOR_BOT="RSEME_SELECTED_TILE_NOT_FREE_FOR_BOT";Zt.RSEME_BOT_NAME_NOT_ACCEPTED="RSEME_BOT_NAME_NOT_ACCEPTED";const gI=class extends nt{constructor(s,t,e,i,r){super(gI.FAVOURITE_GROUP_UPDATE,s),this._roomIndex=t,this._habboGroupId=e,this._habboGroupName=r,this._status=i}get roomIndex(){return this._roomIndex}get habboGroupId(){return this._habboGroupId}get habboGroupName(){return this._habboGroupName}get status(){return this._status}};let EI=gI;EI.FAVOURITE_GROUP_UPDATE="RSFGUE_FAVOURITE_GROUP_UPDATE";const pI=class extends nt{constructor(s,t,e,i){super(pI.RSFRE_FRIEND_REQUEST,s),this._requestId=0,this._userId=0,this._requestId=t,this._userId=e,this._userName=i}get requestId(){return this._requestId}get userId(){return this._userId}get userName(){return this._userName}};let mI=pI;mI.RSFRE_FRIEND_REQUEST="RSFRE_FRIEND_REQUEST";const II=class extends nt{constructor(s,t,e){super(II.NEST_BREEDING_SUCCESS,s),this._petId=t,this._rarityCategory=e}get rarityCategory(){return this._rarityCategory}get petId(){return this._petId}};let TI=II;TI.NEST_BREEDING_SUCCESS="RSPFUE_NEST_BREEDING_SUCCESS";const RI=class extends nt{constructor(s,t,e,i){super(RI.PET_BREEDING,s),this._state=t,this._ownPetId=e,this._otherPetId=i}get state(){return this._state}get ownPetId(){return this._ownPetId}get otherPetId(){return this._otherPetId}};let OI=RI;OI.PET_BREEDING="RSPFUE_PET_BREEDING";const AI=class extends nt{constructor(s,t,e){super(AI.PET_BREEDING_RESULT,s),this._resultData=t,this._otherResultData=e}get resultData(){return this._resultData}get otherResultData(){return this._otherResultData}};let vI=AI;vI.PET_BREEDING_RESULT="RSPFUE_PET_BREEDING_RESULT";const SI=class extends nt{constructor(s,t,e,i){super(SI.PET_COMMANDS,s),this._petId=t,this._allCommandIds=e,this._enabledCommandIds=i}get id(){return this._petId}get commands(){return this._allCommandIds}get enabledCommands(){return this._enabledCommandIds}};let _D=SI;_D.PET_COMMANDS="RSPIUE_ENABLED_PET_COMMANDS";const yI=class extends nt{constructor(s,t,e){super(yI.PET_FIGURE_UPDATE,s),this._petId=t,this._figure=e}get id(){return this._petId}get figure(){return this._figure}};let CI=yI;CI.PET_FIGURE_UPDATE="RSPFUE_PET_FIGURE_UPDATE";const MI=class extends nt{constructor(s,t){super(MI.PET_INFO,s),this._petInfo=t}get petInfo(){return this._petInfo}};let NI=MI;NI.PET_INFO="RSPIUE_PET_INFO";const PI=class extends nt{constructor(s,t,e){super(PI.PET_LEVEL_UPDATE,s),this._petId=t,this._level=e}get petId(){return this._petId}get level(){return this._level}};let bI=PI;bI.PET_LEVEL_UPDATE="RSPLUE_PET_LEVEL_UPDATE";class da extends nt{constructor(t,e,i,r,n,a){super(t,e),this._objectId=-1,this._nameValidationStatus=0,this._nameValidationInfo=null,this._objectId=i,this._figureData=r,this._nameValidationStatus=n,this._nameValidationInfo=a}get objectId(){return this._objectId}get figureData(){return this._figureData}get nameValidationStatus(){return this._nameValidationStatus}get nameValidationInfo(){return this._nameValidationInfo}}da.RSOPPE_OPEN_PET_PACKAGE_REQUESTED="RSOPPE_OPEN_PET_PACKAGE_REQUESTED";da.RSOPPE_OPEN_PET_PACKAGE_RESULT="RSOPPE_OPEN_PET_PACKAGE_RESULT";const DI=class extends nt{constructor(s,t,e,i,r,n){super(DI.PET_STATUS_UPDATE,s),this._petId=t,this._canBreed=e,this._canHarvest=i,this._canRevive=r,this._hasBreedingPermission=n}get petId(){return this._petId}get canBreed(){return this._canBreed}get canHarvest(){return this._canHarvest}get canRevive(){return this._canRevive}get hasBreedingPermission(){return this._hasBreedingPermission}};let LI=DI;LI.PET_STATUS_UPDATE="RSPFUE_PET_STATUS_UPDATE";class Fi extends nt{constructor(t,e,i){super(t,e),this._id=-1,this._numQuestions=0,this._startMessage="",this._endMessage="",this._questionArray=null,this._npsPoll=!1,this._id=i}get id(){return this._id}get headline(){return this._headline}set headline(t){this._headline=t}get summary(){return this._summary}set summary(t){this._summary=t}get numQuestions(){return this._numQuestions}set numQuestions(t){this._numQuestions=t}get startMessage(){return this._startMessage}set startMessage(t){this._startMessage=t}get endMessage(){return this._endMessage}set endMessage(t){this._endMessage=t}get questionArray(){return this._questionArray}set questionArray(t){this._questionArray=t}get npsPoll(){return this._npsPoll}set npsPoll(t){this._npsPoll=t}}Fi.OFFER="RSPE_POLL_OFFER";Fi.ERROR="RSPE_POLL_ERROR";Fi.CONTENT="RSPE_POLL_CONTENT";class Bc extends nt{constructor(t,e,i,r,n,a,o,h,u){super(t,e),this._classId=0,this._itemType="",this._placedItemId=0,this._placedItemType="",this._classId=i,this._itemType=r,this._productCode=n,this._placedItemId=a,this._placedItemType=o,this._placedInRoom=h,this._petFigureString=u}get classId(){return this._classId}get itemType(){return this._itemType}get productCode(){return this._productCode}get placedItemId(){return this._placedItemId}get placedInRoom(){return this._placedInRoom}get placedItemType(){return this._placedItemType}get petFigureString(){return this._petFigureString}}Bc.RSPE_PRESENT_OPENED="RSPE_PRESENT_OPENED";class Hc extends nt{constructor(t,e){super(t,e)}}Hc.RSDUE_ALLOW_PETS="RSDUE_ALLOW_PETS";const UI=class extends nt{constructor(s,t,e,i=!1){super(UI.QUEUE_STATUS,s),this._name=t,this._target=e,this._queues=new Map,this._isActive=i}get isActive(){return this._isActive}get queueSetName(){return this._name}get queueSetTarget(){return this._target}get queueTypes(){return Array.from(this._queues.keys())}getQueueSize(s){return this._queues.get(s)}addQueue(s,t){this._queues.set(s,t)}};let ch=UI;ch.QUEUE_STATUS="RSQE_QUEUE_STATUS";ch.QUEUE_TYPE_CLUB="c";ch.QUEUE_TYPE_NORMAL="d";ch.QUEUE_TARGET_VISITOR=2;ch.QUEUE_TARGET_SPECTATOR=1;class Vc extends nt{constructor(t,e){super(t,e)}}Vc.SPECTATOR_MODE="RSSME_SPECTATOR_MODE";const xI=class extends nt{constructor(s,t,e){super(xI.RSUBE_BADGES,s),this._userId=0,this._badges=[],this._userId=t,this._badges=e}get userId(){return this._userId}get badges(){return this._badges}};let FI=xI;FI.RSUBE_BADGES="RSUBE_BADGES";const wI=class extends nt{constructor(s,t){super(wI.USER_DATA_UPDATED,s),this._addedUsers=t}get addedUsers(){return this._addedUsers}};let GI=wI;GI.USER_DATA_UPDATED="RMUDUE_USER_DATA_UPDATED";const BI=class extends nt{constructor(s,t,e,i,r,n){super(BI.USER_FIGURE,s),this._roomIndex=0,this._figure="",this._gender="",this._customInfo="",this._roomIndex=t,this._figure=e,this._gender=i,this._customInfo=r,this._achievementScore=n}get roomIndex(){return this._roomIndex}get figure(){return this._figure}get gender(){return this._gender}get customInfo(){return this._customInfo}get activityPoints(){return this._achievementScore}};let HI=BI;HI.USER_FIGURE="RSUBE_FIGURE";const VI=class extends Rt{constructor(s,t){super(VI.UTRE_USER_TAGS_RECEIVED),this._userId=s,this._tags=t}get userId(){return this._userId}get tags(){return this._tags}};let cD=VI;cD.UTRE_USER_TAGS_RECEIVED="UTRE_USER_TAGS_RECEIVED";class fa extends nt{constructor(t,e,i,r,n=null,a=0){super(t,e),this._question="",this._SafeStr_7654=0,this._choices=[],this._SafeStr_7651=[],this._question=i,this._choices=r,this._SafeStr_7651=n,this._SafeStr_7651==null&&(this._SafeStr_7651=[]),this._SafeStr_7654=a}get question(){return this._question}get choices(){return this._choices.slice()}get _SafeStr_4173(){return this._SafeStr_7651.slice()}get _SafeStr_4174(){return this._SafeStr_7654}}fa.VOTE_QUESTION="RSPE_VOTE_QUESTION";fa.VOTE_RESULT="RSPE_VOTE_RESULT";class wi extends nt{constructor(t,e,i=-1){super(t,e),this._id=-1,this._pollType=null,this._pollId=-1,this._questionId=-1,this._duration=-1,this._question=null,this._userId=-1,this._id=i}get id(){return this._id}get pollType(){return this._pollType}set pollType(t){this._pollType=t}get pollId(){return this._pollId}set pollId(t){this._pollId=t}get questionId(){return this._questionId}set questionId(t){this._questionId=t}get duration(){return this._duration}set duration(t){this._duration=t}get question(){return this._question}set question(t){this._question=t}get userId(){return this._userId}set userId(t){this._userId=t}get value(){return this._value}set value(t){this._value=t}get answerCounts(){return this._answerCounts}set answerCounts(t){this._answerCounts=t}}wi.QUESTION="RWPUW_NEW_QUESTION";wi.FINISHED="RWPUW_QUESION_FINSIHED";wi.ANSWERED="RWPUW_QUESTION_ANSWERED";const kI=class extends Rt{constructor(s){super(kI.UPDATED),this._uiFlags=s}get uiFlags(){return this._uiFlags}};let jI=kI;jI.UPDATED="APUE_UPDATED";const zI=class extends Rt{constructor(s){super(zI.UNUE_NAME_UPDATED),this._name=s}get name(){return this._name}};let kc=zI;kc.UNUE_NAME_UPDATED="unue_name_updated";class dD{constructor(){this._messageIdByEvent=new Map,this._messageIdByComposer=new Map,this._messageInstancesById=new Map}dispose(){this._messageIdByEvent.clear(),this._messageIdByComposer.clear(),this._messageInstancesById.clear()}registerMessages(t){for(const[e,i]of t.events)this.registerMessageEventClass(e,i);for(const[e,i]of t.composers)this.registerMessageComposerClass(e,i)}registerMessageEventClass(t,e){!t||!e||this._messageIdByEvent.set(e,t)}registerMessageComposerClass(t,e){!t||!e||this._messageIdByComposer.set(e,t)}registerMessageEvent(t){if(!t)return;const e=this.getEventId(t);if(!e)return;let i=this._messageInstancesById.get(e);(!i||!i.length)&&(i=[],this._messageInstancesById.set(e,i)),i.push(t)}removeMessageEvent(t){if(!t)return;const e=this.getEventId(t);if(!e)return;const i=this._messageInstancesById.get(e);if(i){for(const[r,n]of i.entries())if(n&&n===t){i.splice(r,1),i.length===0&&this._messageInstancesById.delete(e),n.dispose();return}}}getEvents(t){if(!t)return;const e=this._messageInstancesById.get(t);if(e)return e}getEventId(t){if(!t)return-1;const e=t instanceof R?t.constructor:t,i=this._messageIdByEvent.get(e);return i||-1}getComposerId(t){if(!t)return-1;const e=this._messageIdByComposer.get(t.constructor);return e||-1}}class fD extends Rs{constructor(t,e){super(),this._communicationManager=t,this._stateListener=e,this._socket=null,this._messages=new dD,this._codec=new iD,this._dataBuffer=null,this._isReady=!1,this._pendingClientMessages=[],this._pendingServerMessages=[],this._isAuthenticated=!1,this.onOpen=this.onOpen.bind(this),this.onClose=this.onClose.bind(this),this.onError=this.onError.bind(this),this.onMessage=this.onMessage.bind(this)}init(t){this._stateListener&&this._stateListener.connectionInit(t),this.createSocket(t)}onDispose(){super.onDispose(),this.destroySocket(),this._communicationManager=null,this._stateListener=null,this._messages=null,this._codec=null,this._dataBuffer=null}onReady(){this._isReady||(this._isReady=!0,this._pendingServerMessages&&this._pendingServerMessages.length&&this.processWrappers(...this._pendingServerMessages),this._pendingClientMessages&&this._pendingClientMessages.length&&this.send(...this._pendingClientMessages),this._pendingServerMessages=[],this._pendingClientMessages=[])}createSocket(t){t&&(this.destroySocket(),this._dataBuffer=new ArrayBuffer(0),this._socket=new WebSocket(t),this._socket.addEventListener(vs.CONNECTION_OPENED,this.onOpen),this._socket.addEventListener(vs.CONNECTION_CLOSED,this.onClose),this._socket.addEventListener(vs.CONNECTION_ERROR,this.onError),this._socket.addEventListener(vs.CONNECTION_MESSAGE,this.onMessage))}destroySocket(){this._socket&&(this._socket.removeEventListener(vs.CONNECTION_OPENED,this.onOpen),this._socket.removeEventListener(vs.CONNECTION_CLOSED,this.onClose),this._socket.removeEventListener(vs.CONNECTION_ERROR,this.onError),this._socket.removeEventListener(vs.CONNECTION_MESSAGE,this.onMessage),this._socket.readyState===WebSocket.OPEN&&this._socket.close(),this._socket=null)}onOpen(t){this.dispatchConnectionEvent(Oe.CONNECTION_OPENED,t)}onClose(t){this.dispatchConnectionEvent(Oe.CONNECTION_CLOSED,t)}onError(t){this.dispatchConnectionEvent(Oe.CONNECTION_ERROR,t)}onMessage(t){if(!t)return;const e=new FileReader;e.readAsArrayBuffer(t.data),e.onloadend=()=>{this._dataBuffer=this.concatArrayBuffers(this._dataBuffer,e.result),this.processReceivedData()}}dispatchConnectionEvent(t,e){this.dispatchEvent(new Oe(t,this,e))}authenticated(){this._isAuthenticated=!0}send(...t){if(this.disposed||!t)return!1;if(t=[...t],this._isAuthenticated&&!this._isReady)return this._pendingClientMessages||(this._pendingClientMessages=[]),this._pendingClientMessages.push(...t),!1;for(const e of t){if(!e)continue;const i=this._messages.getComposerId(e);if(i===-1){Y.packets("Unknown Composer",e.constructor.name);continue}const r=e.getMessageArray(),n=this._codec.encode(i,r);if(!n){Y.packets("Encoding Failed",e.constructor.name);continue}Y.packets("OutgoingComposer",i,e.constructor.name,r),this.write(n.getBuffer())}return!0}write(t){this._socket.readyState===WebSocket.OPEN&&this._socket.send(t)}processReceivedData(){try{this.processData()}catch(t){Y.error(t)}}processData(){const t=this.splitReceivedMessages();if(!(!t||!t.length)){if(this._isAuthenticated&&!this._isReady){this._pendingServerMessages||(this._pendingServerMessages=[]),this._pendingServerMessages.push(...t);return}this.processWrappers(...t)}}processWrappers(...t){if(!(!t||!t.length))for(const e of t){if(!e)continue;const i=this.getMessagesForWrapper(e);!i||!i.length||(Y.packets("IncomingMessage",e.header,i[0].constructor.name,i[0].parser),this.handleMessages(...i))}}splitReceivedMessages(){return!this._dataBuffer||!this._dataBuffer.byteLength?null:this._codec.decode(this)}concatArrayBuffers(t,e){const i=new Uint8Array(t.byteLength+e.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(e),t.byteLength),i.buffer}getMessagesForWrapper(t){if(!t)return null;const e=this._messages.getEvents(t.header);if(!e||!e.length){Y.packets("IncomingMessage",t.header,"UNREGISTERED",t);return}try{const i=new e[0].parserClass;if(!i||!i.flush()||!i.parse(t))return null;for(const r of e)r.parser=i}catch(i){return Y.error("Error parsing message",i,e[0].constructor.name),null}return e}handleMessages(...t){t=[...t];for(const e of t)e&&(e.connection=this,e.callBack&&e.callBack(e))}registerMessages(t){t&&this._messages.registerMessages(t)}addMessageEvent(t){!t||!this._messages||this._messages.registerMessageEvent(t)}removeMessageEvent(t){!t||!this._messages||this._messages.removeMessageEvent(t)}get isAuthenticated(){return this._isAuthenticated}get dataBuffer(){return this._dataBuffer}set dataBuffer(t){this._dataBuffer=t}}class gD extends cs{constructor(){super(),this._connections=[]}onDispose(){if(!(!this._connections||!this._connections.length))for(const t of this._connections.values())t&&t.dispose()}createConnection(t=null){const e=new fD(this,t);if(e)return this._connections.push(e),e}update(t){let e=0;for(;e<this._connections.length;){const i=this._connections[e];if(i.processReceivedData(),this.disposed)return;i.disposed?this._connections.splice(e,1):e++}}}class Tr extends Rt{constructor(t){super(t)}}Tr.LOADED="NCE_LOADED";Tr.FAILED="NCE_FAILED";class ED extends mi{constructor(){super(),this._definitions=new Map,this._config=[],this._pendingUrls=[],this._missingKeys=[],this.onConfigurationLoaded=this.onConfigurationLoaded.bind(this)}onInit(){rt.parseConfiguration(this.getDefaultConfig(),!0),this._pendingUrls=rt.getValue("config.urls").slice(),this.loadNextConfiguration()}loadNextConfiguration(){if(!this._pendingUrls.length){this.dispatchConfigurationEvent(Tr.LOADED);return}this.loadConfigurationFromUrl(this._pendingUrls[0])}loadConfigurationFromUrl(t){if(!t||t===""){this.dispatchConfigurationEvent(Tr.FAILED);return}fetch(t).then(e=>e.json()).then(e=>this.onConfigurationLoaded(e,t)).catch(e=>this.onConfigurationFailed(e))}onConfigurationLoaded(t,e){if(t){if(rt.parseConfiguration(t)){const i=this._pendingUrls.indexOf(e);i>=0&&this._pendingUrls.splice(i,1),this.loadNextConfiguration();return}this.dispatchConfigurationEvent(Tr.FAILED)}}onConfigurationFailed(t){this.dispatchConfigurationEvent(Tr.FAILED)}dispatchConfigurationEvent(t){this.events&&this.events.dispatchEvent(new Tr(t))}getDefaultConfig(){return NitroConfig}}const lo=class{static sayHello(){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){const s=[`
 %c %c %c Nitro ${lo.UI_VERSION} - Renderer ${lo.RENDERER_VERSION} %c %c %c https://discord.nitrodev.co %c %c 

`,"background: #ffffff; padding:5px 0;","background: #ffffff; padding:5px 0;","color: #ffffff; background: #000000; padding:5px 0;","background: #ffffff; padding:5px 0;","background: #ffffff; padding:5px 0;","background: #000000; padding:5px 0;","background: #ffffff; padding:5px 0;","background: #ffffff; padding:5px 0;"];self.console.log(...s)}else self.console&&self.console.log(`Nitro ${lo.UI_VERSION} - Renderer ${lo.RENDERER_VERSION} `)}};let Pl=lo;Pl.RENDERER_VERSION="1.6.6";Pl.UI_VERSION="";class pD extends cs{constructor(){super(),Pl.sayHello(),this._configuration=new ED,this._communication=new gD}onDispose(){this._communication&&(this._communication.dispose(),this._communication=null)}get configuration(){return this._configuration}get communication(){return this._communication}}class mD{constructor(t){this._id=parseInt(t.id),this._value=parseInt(t.id),this._prevents=t.prevents||[],this._preventHeadTurn=t.preventHeadTurn||!1,this._isAnimated=!0,t.animated!==void 0&&t.animated===!1&&(this._isAnimated=!1)}get id(){return this._id}get value(){return this._value}get prevents(){return this._prevents}get preventHeadTurn(){return this._preventHeadTurn}get isAnimated(){return this._isAnimated}}class ID{constructor(t){if(this._id=t.id,this._state=t.state,this._precedence=t.precedence,this._activePartSet=t.activePartSet,this._assetPartDefinition=t.assetPartDefinition,this._lay=t.lay,this._geometryType=t.geometryType,this._isMain=t.main||!1,this._isDefault=t.isDefault||!1,this._isAnimation=t.animation||!1,this._startFromFrameZero=t.startFromFrameZero||!1,this._prevents=t.prevents||[],this._preventHeadTurn=t.preventHeadTurn||!1,this._types=new Map,this._params=new Map,this._defaultParameterValue="",this._canvasOffsets=null,t.params&&t.params.length>0)for(const e of t.params)e&&(e.id==="default"?this._defaultParameterValue=e.value:this._params.set(e.id,e.value));if(t.types&&t.types.length>0)for(const e of t.types){if(!e)continue;const i=new mD(e);this._types.set(i.id,i)}}setOffsets(t,e,i){this._canvasOffsets||(this._canvasOffsets=new Map);let r=this._canvasOffsets.get(t);r||(r=new Map,this._canvasOffsets.set(t,r)),r.set(e,i)}getOffsets(t,e){if(!this._canvasOffsets)return null;const i=this._canvasOffsets.get(t);return i?i.get(e):null}getType(t){if(!t)return null;const e=this._types.get(parseInt(t));return e||null}getParameterValue(t){if(!t)return"";const e=this._params.get(t);return e||this._defaultParameterValue}getPrevents(t){return this._prevents.concat(this.getTypePrevents(t))}getTypePrevents(t){if(!t)return[];const e=this._types.get(parseInt(t));return e?e.prevents:[]}getPreventHeadTurn(t){if(!t)return this._preventHeadTurn;const e=this.getType(t);return e?e.preventHeadTurn:this._preventHeadTurn}isAnimated(t){if(!t)return!0;const e=this.getType(t);return e?e.isAnimated:!0}get id(){return this._id}get state(){return this._state}get precedence(){return this._precedence}get activePartSet(){return this._activePartSet}get assetPartDefinition(){return this._assetPartDefinition}get lay(){return this._lay}get geometryType(){return this._geometryType}get isMain(){return this._isMain}get isDefault(){return this._isDefault}get isAnimation(){return this._isAnimation}get startFromFrameZero(){return this._startFromFrameZero}get prevents(){return this._prevents}get preventHeadTurn(){return this._preventHeadTurn}get params(){return this._params}}class jc{constructor(t,e="",i=0){this._actionType=t||"",this._actionParameter=e||"",this._definition=null,this._startFrame=i||0,this._overridingAction=null}dispose(){this._actionType=null,this._actionParameter=null,this._definition=null}get id(){return this._definition?this._definition.id+"_"+this._actionParameter:""}get actionType(){return this._actionType}get actionParameter(){return this._actionParameter}set actionParameter(t){this._actionParameter=t}get definition(){return this._definition}set definition(t){this._definition=t}get startFrame(){return this._startFrame}get overridingAction(){return this._overridingAction}set overridingAction(t){this._overridingAction=t}}class TD{constructor(t,e){this._assets=t,this._actions=new Map,this._defaultAction=null,this.updateActions(e)}updateActions(t){if(t){for(const e of t.actions){if(!e||!e.state)continue;const i=new ID(e);this._actions.set(i.state,i)}t.actionOffsets&&this.parseActionOffsets(t.actionOffsets)}}parseActionOffsets(t){if(!(!t||!t.length))for(const e of t){const i=this._actions.get(e.action);if(i)for(const r of e.offsets){const n=r.size||"",a=r.direction;if(n===""||a===void 0)continue;const o=r.x||0,h=r.y||0,u=r.z||0;i.setOffsets(n,a,[o,h,u])}}}getActionDefinition(t){if(!t)return null;for(const e of this._actions.values())if(!(!e||e.id!==t))return e;return null}getActionDefinitionWithState(t){const e=this._actions.get(t);return e||null}getDefaultAction(){if(this._defaultAction)return this._defaultAction;for(const t of this._actions.values())if(!(!t||!t.isDefault))return this._defaultAction=t,t;return null}getCanvasOffsets(t,e,i){let r=[];for(const n of t){if(!n)continue;const a=this._actions.get(n.actionType),o=a&&a.getOffsets(e,i);o&&(r=o)}return r}sortActions(t){if(!t)return null;t=this.filterActions(t);const e=[];for(const i of t){if(!i)continue;const r=this._actions.get(i.actionType);r&&(i.definition=r,e.push(i))}return e.sort(this.sortByPrecedence),e}filterActions(t){let e=[];const i=[];for(const r of t){if(!r)continue;const n=this._actions.get(r.actionType);n&&(e=e.concat(n.getPrevents(r.actionParameter)))}for(const r of t){if(!r)continue;let n=r.actionType;r.actionType==="fx"&&(n=n+("."+r.actionParameter)),!(e.indexOf(n)>=0)&&i.push(r)}return i}sortByPrecedence(t,e){if(!t||!e)return 0;const i=t.definition.precedence,r=e.definition.precedence;return i<r?1:i>r?-1:0}}class RD{constructor(t,e){this._name=t,this._link=e.link,this._flipH=e.flipH,this._flipV=e.flipV}get name(){return this._name}get link(){return this._link}get flipH(){return this._flipH}get flipV(){return this._flipV}}class OD{constructor(t,e){this._avatarRenderManager=t,this._aliases=new Map,this._assets=e,this._missingAssetNames=[]}dispose(){this._assets=null,this._aliases=null}reset(){this.init()}init(){for(const t of this._assets.collections.values()){if(!t)continue;const e=t.data&&t.data.aliases;if(e)for(const i in e){const r=e[i];r&&this._aliases.set(i,new RD(i,r))}}}hasAlias(t){return!!this._aliases.get(t)}getAssetName(t){let e=t,i=5;for(;this.hasAlias(e)&&i>=0;)e=this._aliases.get(e).link,i--;return e}getAsset(t){if(!this._assets)return null;t=this.getAssetName(t);const e=this._assets.getAsset(t);return e||null}}class AD{constructor(t){this._id=t.id||"",this._align=t.align||"",this._base=t.base||"",this._ink=t.ink||0,this._blend=0;const e=t.blend;e&&e.length>0&&(this._blend=parseInt(e),this._blend>1&&(this._blend=this._blend/100))}get id(){return this._id}get align(){return this._align}get base(){return this._base}get ink(){return this._ink}get blend(){return this._blend}get isBlended(){return this._blend!==1}}class ws{constructor(t,e,i){if(this._id=t.id,this._animationFrame=t.frame||0,this._dx=t.dx||0,this._dy=t.dy||0,this._dz=t.dz||0,this._directionOffset=t.dd||0,this._type=e,this._base=t.base||"",this._items=new Map,t.items)for(const r of t.items)this._items.set(r.id,r.base);this._base!==""&&this.baseAsInt().toString(),i&&(this._action=new jc(i.state,this.base),this._action.definition=i)}get items(){return this._items}baseAsInt(){let t=0,e=0;for(;e<this._base.length;)t=t+this._base.charCodeAt(e),e++;return t}get id(){return this._id}get animationFrame(){return this._animationFrame}get dx(){return this._dx}get dy(){return this._dy}get dz(){return this._dz}get dd(){return this._directionOffset}get type(){return this._type}get base(){return this._base}get action(){return this._action}}ws.BODYPART="bodypart";ws.FX="fx";class vD{constructor(t){this._ink=t.ink;let e=t.foreground,i=t.background;e=e.replace("#",""),i=i.replace("#",""),this._foreGround=parseInt(e,16),this._backGround=parseInt(i,16),this._colorTransform=null,this._rgb=parseInt(e,16),this._r=this._rgb>>16&255,this._g=this._rgb>>8&255,this._b=this._rgb>>0&255,this._redMultiplier=this._r/255*1,this._greenMultiplier=this._g/255*1,this._blueMultiplier=this._b/255*1,this._alphaMultiplier=1,this._paletteIsGrayscale=!0,this._ink===37&&(this._alphaMultiplier=.5,this._paletteIsGrayscale=!1),this._colorTransform=new Ub({red:this._r/255,green:this._g/255,blue:this._b/255,alpha:this._alphaMultiplier}),this._colorMap=this.generatePaletteMapForGrayscale(this._backGround,this._foreGround)}get ink(){return this._ink}get colorTransform(){return this._colorTransform}get reds(){return this._colorMap.get("reds")}get greens(){return this._colorMap.get("greens")}get blues(){return this._colorMap.get("blues")}get alphas(){return this._colorMap.get("alphas")}get paletteIsGrayscale(){return this._paletteIsGrayscale}generatePaletteMapForGrayscale(t,e){const i=t>>24&255,r=t>>16&255,n=t>>8&255,a=t>>0&255,o=e>>24&255,h=e>>16&255,u=e>>8&255,c=e>>0&255,l=(o-i)/255,_=(h-r)/255,d=(u-n)/255,g=(c-a)/255,m=new Map,p=[],T=[],A=[];let O=i,v=r,y=n,C=a;for(let N=0;N<256;N++)v==r&&y==n&&C==a&&(O=0),O=O+l,v=v+_,y=y+d,C=C+g,p.push(O<<24|v<<16|y<<8|C),T.push(O<<24|v<<16|y<<8|C),A.push(O<<24|v<<16|y<<8|C);return m.set("alphas",p),m.set("reds",p),m.set("greens",T),m.set("blues",A),m}}class SD{constructor(t){this._offset=t.offset}get offset(){return this._offset}}class yD{constructor(t,e){this._animation=t,this._id=e.id,this._ink=e.ink,this._member=e.member,this._hasStaticY=!!e.staticY,this._hasDirections=!!e.directions,this._dx=[],this._dy=[],this._dz=[];const i=e.directionList;if(i&&i.length)for(const r of i){const n=r.id;n!==void 0&&(this._dx[n]=r.dx||0,this._dy[n]=r.dy||0,this._dz[n]=r.dz||0)}}getDirectionOffsetX(t){return t<this._dx.length?this._dx[t]:0}getDirectionOffsetY(t){return t<this._dy.length?this._dy[t]:0}getDirectionOffsetZ(t){return t<this._dz.length?this._dz[t]:0}get animation(){return this._animation}get id(){return this._id}get ink(){return this._ink}get member(){return this._member}get hasDirections(){return this._hasDirections}get hasStaticY(){return this._hasStaticY}}const Tu=class{constructor(s,t){if(this._id=t.name,this._description=this._id,this._frames=[],this._spriteData=null,this._avatarData=null,this._directionData=null,this._removeData=null,this._addData=null,this._overriddenActions=null,this._overrideFrames=null,this._resetOnToggle=t.resetOnToggle||!1,t.sprites&&t.sprites.length){this._spriteData=[];for(const e of t.sprites)this._spriteData.push(new yD(this,e))}if(t.avatars&&t.avatars.length&&(this._avatarData=new vD(t.avatars[0])),t.directions&&t.directions.length&&(this._directionData=new SD(t.directions[0])),t.removes&&t.removes.length){this._removeData=[];for(const e of t.removes)this._removeData.push(e.id)}if(t.adds&&t.adds.length){this._addData=[];for(const e of t.adds)this._addData.push(new AD(e))}if(t.overrides&&t.overrides.length){this._overrideFrames=new Map,this._overriddenActions=new Map;for(const e of t.overrides){const i=e.name,r=e.override;this._overriddenActions.set(r,i);const n=[];this.parseFrames(n,e.frames,s),this._overrideFrames.set(i,n)}}this.parseFrames(this._frames,t.frames,s)}parseFrames(s,t,e){if(!(!t||!t.length))for(const i of t){let r=1;i.repeats&&i.repeats>1&&(r=i.repeats);let n=0;for(;n<r;){const a=[];if(i.bodyparts&&i.bodyparts.length)for(const o of i.bodyparts){const h=e.getActionDefinition(o.action),u=new ws(o,ws.BODYPART,h);a.push(u)}if(i.fxs&&i.fxs.length)for(const o of i.fxs){const h=e.getActionDefinition(o.action),u=new ws(o,ws.FX,h);a.push(u)}s.push(a),n++}}}frameCount(s=null){if(!s)return this._frames.length;if(this._overrideFrames){const t=this._overrideFrames.get(s);if(t)return t.length}return 0}hasOverriddenActions(){return this._overriddenActions?this._overriddenActions.size>0:!1}overriddenActionNames(){if(!this._overriddenActions)return null;const s=[];for(const t of this._overriddenActions.keys())s.push(t);return s}overridingAction(s){return this._overriddenActions?this._overriddenActions.get(s):null}getFrame(s,t=null){s<0&&(s=0);let e=[];if(!t)this._frames.length>0&&(e=this._frames[s%this._frames.length]);else{const i=this._overrideFrames.get(t);i&&i.length>0&&(e=i[s%i.length])}return e}getAnimatedBodyPartIds(s,t=null){const e=[];for(const i of this.getFrame(s,t))if(i.type===ws.BODYPART)e.push(i.id);else if(i.type===ws.FX&&this._addData&&this._addData.length)for(const r of this._addData)r.id===i.id&&e.push(r.align);return e}getLayerData(s,t,e=null){for(const i of this.getFrame(s,e)){if(i.id===t)return i;if(i.type===ws.FX&&this._addData&&this._addData.length){for(const r of this._addData)if(r.align===t&&r.id===i.id)return i}}return null}hasAvatarData(){return this._avatarData!==null}hasDirectionData(){return this._directionData!==null}hasAddData(){return this._addData!==null}getAddData(s){if(this._addData){for(const t of this._addData)if(t.id===s)return t}return null}get id(){return this._id}get spriteData(){return this._spriteData||Tu.EMPTY_ARRAY}get avatarData(){return this._avatarData}get directionData(){return this._directionData}get removeData(){return this._removeData||Tu.EMPTY_ARRAY}get addData(){return this._addData||Tu.EMPTY_ARRAY}toString(){return this._description}get resetOnToggle(){return this._resetOnToggle}};let YI=Tu;YI.EMPTY_ARRAY=[];class CD{constructor(){this._animations=new Map}registerAnimation(t,e){if(!e)return!1;const i=e[Object.keys(e)[0]],r=new YI(t,i);return this._animations.set(i.name,r),!0}getAnimation(t){const e=this._animations.get(t);return e||null}getLayerData(t,e,i){const r=this.getAnimation(t);return r?r.getLayerData(e,i):null}get animations(){return this._animations}}const Si=class extends Rs{constructor(s,t,e,i){super(),this._state=Si.NOT_LOADED,this._libraryName=s,this._revision=t,this._downloadUrl=i,this._assets=e,this._downloadUrl=this._downloadUrl.replace(/%libname%/gi,this._libraryName),this._downloadUrl=this._downloadUrl.replace(/%revision%/gi,this._revision),this._assets.getCollection(this._libraryName)&&(this._state=Si.LOADED)}async downloadAsset(){if(!this._assets||this._state===Si.LOADING||this._state===Si.LOADED)return;if(this._assets.getCollection(this._libraryName)){this._state=Si.LOADED,this.dispatchEvent(new la(la.DOWNLOAD_COMPLETE,this));return}this._state=Si.LOADING,await this._assets.downloadAsset(this._downloadUrl)&&(this._state=Si.LOADED,this.dispatchEvent(new la(la.DOWNLOAD_COMPLETE,this)))}get libraryName(){return this._libraryName}get isLoaded(){return this._state===Si.LOADED}};let dh=Si;dh.DOWNLOAD_COMPLETE="AADL_DOWNLOAD_COMPLETE";dh.NOT_LOADED=0;dh.LOADING=1;dh.LOADED=2;const zc=class extends Rs{constructor(s,t){super(),this._assets=s,this._structure=t,this._missingMandatoryLibs=rt.getValue("avatar.mandatory.libraries"),this._figureMap=new Map,this._pendingContainers=[],this._figureListeners=new Map,this._incompleteFigures=new Map,this._pendingDownloadQueue=[],this._currentDownloads=[],this._libraryNames=[],this._isReady=!1,this.onLibraryLoaded=this.onLibraryLoaded.bind(this),this.onAvatarRenderReady=this.onAvatarRenderReady.bind(this),this.loadFigureMap(),this._structure.renderManager.events.addEventListener(Nl.AVATAR_RENDER_READY,this.onAvatarRenderReady)}loadFigureMap(){const s=new XMLHttpRequest;try{s.open("GET",rt.getValue("avatar.figuremap.url")),s.send(),s.onloadend=t=>{if(s.responseText){const e=JSON.parse(s.responseText);this.processFigureMap(e.libraries),this.processMissingLibraries(),this._isReady=!0,this.dispatchEvent(new Rt(zc.DOWNLOADER_READY))}},s.onerror=t=>{throw new Error("invalid_avatar_figure_map")}}catch(t){Y.error(t)}}processFigureMap(s){if(s)for(const t of s){if(!t)continue;const e=t.id,i=t.revision||"";if(this._libraryNames.indexOf(e)>=0)continue;this._libraryNames.push(e);const r=new dh(e,i,this._assets,rt.getValue("avatar.asset.url"));r.addEventListener(la.DOWNLOAD_COMPLETE,this.onLibraryLoaded);for(const n of t.parts){const a=n.id,h=n.type+":"+a;let u=this._figureMap.get(h);u||(u=[]),u.push(r),this._figureMap.set(h,u)}}}onAvatarRenderReady(s){if(s){for(const[t,e]of this._pendingContainers)this.downloadAvatarFigure(t,e);this._pendingContainers=[]}}onLibraryLoaded(s){if(!s||!s.library)return;const t=[];for(const[i,r]of this._incompleteFigures.entries()){let n=!0;for(const a of r)if(!(!a||a.isLoaded)){n=!1;break}if(n){t.push(i);const a=this._figureListeners.get(i);if(a)for(const o of a)!o||o.disposed||o.resetFigure(i);this._figureListeners.delete(i),this.dispatchEvent(new Rt(zc.LIBRARY_LOADED))}}for(const i of t)i&&this._incompleteFigures.delete(i);let e=0;for(;e<this._currentDownloads.length;){const i=this._currentDownloads[e];i&&i.libraryName===s.library.libraryName&&this._currentDownloads.splice(e,1),e++}}processMissingLibraries(){const s=this._missingMandatoryLibs.slice();for(const t of s){if(!t)continue;const e=this._figureMap.get(t);if(e)for(const i of e)i&&this.downloadLibrary(i)}}isAvatarFigureContainerReady(s){return!this._isReady||!this._structure.renderManager.isReady?!1:!this.getAvatarFigurePendingLibraries(s).length}getAvatarFigurePendingLibraries(s){const t=[];if(!s||!this._structure)return t;const e=this._structure.figureData;if(!e)return t;const i=s.getPartTypeIds();for(const r of i){const n=e.getSetType(r);if(!n)continue;const a=n.getPartSet(s.getPartSetId(r));if(a)for(const o of a.parts){if(!o)continue;const h=o.type+":"+o.id,u=this._figureMap.get(h);if(u!==void 0)for(const c of u)!c||c.isLoaded||t.indexOf(c)>=0||t.push(c)}}return t}downloadAvatarFigure(s,t){if(!this._isReady||!this._structure.renderManager.isReady){this._pendingContainers.push([s,t]);return}const e=s.getFigureString(),i=this.getAvatarFigurePendingLibraries(s);if(i&&i.length){if(t&&!t.disposed){let r=this._figureListeners.get(e);r||(r=[],this._figureListeners.set(e,r)),r.push(t)}this._incompleteFigures.set(e,i);for(const r of i)r&&this.downloadLibrary(r)}else t&&!t.disposed&&t.resetFigure(e)}downloadLibrary(s){!s||s.isLoaded||this._pendingDownloadQueue.indexOf(s)>=0||this._currentDownloads.indexOf(s)>=0||(this._pendingDownloadQueue.push(s),this.processDownloadQueue())}processDownloadQueue(){for(;this._pendingDownloadQueue.length;)this._pendingDownloadQueue[0].downloadAsset(),this._currentDownloads.push(this._pendingDownloadQueue.shift())}};let Rr=zc;Rr.DOWNLOADER_READY="AADM_DOWNLOADER_READY";Rr.LIBRARY_LOADED="AADM_LIBRARY_LOADED";Rr.MAX_DOWNLOADS=2;class Ru{constructor(t){this._parts=new Map,this.parseFigure(t)}getPartTypeIds(){return this.partSets().keys()}hasPartType(t){return!!this.partSets().get(t)}getPartSetId(t){const e=this.partSets().get(t);return e?e.get("setid"):0}getPartColorIds(t){const e=this.partSets().get(t);return e?e.get("colorids"):null}updatePart(t,e,i){const r=new Map;r.set("type",t),r.set("setid",e),r.set("colorids",i);const n=this.partSets();n.delete(t),n.set(t,r)}removePart(t){this.partSets().delete(t)}getFigureString(){const t=[];for(const e of this.partSets().keys()){if(!e)continue;let i=[];i.push(e),i.push(this.getPartSetId(e)),i=i.concat(this.getPartColorIds(e)),t.push(i.join("-"))}return t.join(".")}partSets(){return this._parts||(this._parts=new Map),this._parts}parseFigure(t){t||(t="");for(const e of t.split(".")){const i=e.split("-");if(i.length>=2){const r=i[0],n=parseInt(i[1]),a=[];let o=2;for(;o<i.length;)a.push(parseInt(i[o])),o++;this.updatePart(r,n,a)}}}}/*!
 * @pixi/filter-color-matrix - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/filter-color-matrix is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Yc=function(s,t){return Yc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])},Yc(s,t)};function MD(s,t){Yc(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var ND=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`,Xu=function(s){MD(t,s);function t(){var e=this,i={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return e=s.call(this,FM,ND,i)||this,e.alpha=1,e}return t.prototype._loadMatrix=function(e,i){i===void 0&&(i=!1);var r=e;i&&(this._multiply(r,this.uniforms.m,e),r=this._colorMatrix(r)),this.uniforms.m=r},t.prototype._multiply=function(e,i,r){return e[0]=i[0]*r[0]+i[1]*r[5]+i[2]*r[10]+i[3]*r[15],e[1]=i[0]*r[1]+i[1]*r[6]+i[2]*r[11]+i[3]*r[16],e[2]=i[0]*r[2]+i[1]*r[7]+i[2]*r[12]+i[3]*r[17],e[3]=i[0]*r[3]+i[1]*r[8]+i[2]*r[13]+i[3]*r[18],e[4]=i[0]*r[4]+i[1]*r[9]+i[2]*r[14]+i[3]*r[19]+i[4],e[5]=i[5]*r[0]+i[6]*r[5]+i[7]*r[10]+i[8]*r[15],e[6]=i[5]*r[1]+i[6]*r[6]+i[7]*r[11]+i[8]*r[16],e[7]=i[5]*r[2]+i[6]*r[7]+i[7]*r[12]+i[8]*r[17],e[8]=i[5]*r[3]+i[6]*r[8]+i[7]*r[13]+i[8]*r[18],e[9]=i[5]*r[4]+i[6]*r[9]+i[7]*r[14]+i[8]*r[19]+i[9],e[10]=i[10]*r[0]+i[11]*r[5]+i[12]*r[10]+i[13]*r[15],e[11]=i[10]*r[1]+i[11]*r[6]+i[12]*r[11]+i[13]*r[16],e[12]=i[10]*r[2]+i[11]*r[7]+i[12]*r[12]+i[13]*r[17],e[13]=i[10]*r[3]+i[11]*r[8]+i[12]*r[13]+i[13]*r[18],e[14]=i[10]*r[4]+i[11]*r[9]+i[12]*r[14]+i[13]*r[19]+i[14],e[15]=i[15]*r[0]+i[16]*r[5]+i[17]*r[10]+i[18]*r[15],e[16]=i[15]*r[1]+i[16]*r[6]+i[17]*r[11]+i[18]*r[16],e[17]=i[15]*r[2]+i[16]*r[7]+i[17]*r[12]+i[18]*r[17],e[18]=i[15]*r[3]+i[16]*r[8]+i[17]*r[13]+i[18]*r[18],e[19]=i[15]*r[4]+i[16]*r[9]+i[17]*r[14]+i[18]*r[19]+i[19],e},t.prototype._colorMatrix=function(e){var i=new Float32Array(e);return i[4]/=255,i[9]/=255,i[14]/=255,i[19]/=255,i},t.prototype.brightness=function(e,i){var r=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(r,i)},t.prototype.tint=function(e,i){var r=e>>16&255,n=e>>8&255,a=e&255,o=[r/255,0,0,0,0,0,n/255,0,0,0,0,0,a/255,0,0,0,0,0,1,0];this._loadMatrix(o,i)},t.prototype.greyscale=function(e,i){var r=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(r,i)},t.prototype.blackAndWhite=function(e){var i=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(i,e)},t.prototype.hue=function(e,i){e=(e||0)/180*Math.PI;var r=Math.cos(e),n=Math.sin(e),a=Math.sqrt,o=1/3,h=a(o),u=r+(1-r)*o,c=o*(1-r)-h*n,l=o*(1-r)+h*n,_=o*(1-r)+h*n,d=r+o*(1-r),g=o*(1-r)-h*n,m=o*(1-r)-h*n,p=o*(1-r)+h*n,T=r+o*(1-r),A=[u,c,l,0,0,_,d,g,0,0,m,p,T,0,0,0,0,0,1,0];this._loadMatrix(A,i)},t.prototype.contrast=function(e,i){var r=(e||0)+1,n=-.5*(r-1),a=[r,0,0,0,n,0,r,0,0,n,0,0,r,0,n,0,0,0,1,0];this._loadMatrix(a,i)},t.prototype.saturate=function(e,i){e===void 0&&(e=0);var r=e*2/3+1,n=(r-1)*-.5,a=[r,n,n,0,0,n,r,n,0,0,n,n,r,0,0,0,0,0,1,0];this._loadMatrix(a,i)},t.prototype.desaturate=function(){this.saturate(-1)},t.prototype.negative=function(e){var i=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(i,e)},t.prototype.sepia=function(e){var i=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(i,e)},t.prototype.technicolor=function(e){var i=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(i,e)},t.prototype.polaroid=function(e){var i=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(i,e)},t.prototype.toBGR=function(e){var i=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(i,e)},t.prototype.kodachrome=function(e){var i=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(i,e)},t.prototype.browni=function(e){var i=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(i,e)},t.prototype.vintage=function(e){var i=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(i,e)},t.prototype.colorTone=function(e,i,r,n,a){e=e||.2,i=i||.15,r=r||16770432,n=n||3375104;var o=(r>>16&255)/255,h=(r>>8&255)/255,u=(r&255)/255,c=(n>>16&255)/255,l=(n>>8&255)/255,_=(n&255)/255,d=[.3,.59,.11,0,0,o,h,u,e,0,c,l,_,i,0,o-c,h-l,u-_,0,0];this._loadMatrix(d,a)},t.prototype.night=function(e,i){e=e||.1;var r=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(r,i)},t.prototype.predator=function(e,i){var r=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(r,i)},t.prototype.lsd=function(e){var i=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(i,e)},t.prototype.reset=function(){var e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)},Object.defineProperty(t.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(e){this.uniforms.m=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(e){this.uniforms.uAlpha=e},enumerable:!1,configurable:!0}),t}(Ua);Xu.prototype.grayscale=Xu.prototype.greyscale;class PD{constructor(){this._cache=new Map,this.setLastAccessTime(_t())}dispose(){if(this.debugInfo("[dispose]"),!!this._cache){for(const t of this._cache.values())t&&t.dispose();this._cache.clear()}}getDirectionCache(t){const e=this._cache.get(t.toString());return e||null}updateDirectionCache(t,e){this._cache.set(t.toString(),e)}setLastAccessTime(t){this._lastAccessTime=t}getLastAccessTime(){return this._lastAccessTime}debugInfo(t){}}class qE{constructor(){this._cache=new Map}setAction(t,e){this._currentAction||(this._currentAction=t);const i=this.getActionCache(this._currentAction);i&&i.setLastAccessTime(e),this._currentAction=t}dispose(){if(!this._disposed){if(!this._cache)return;this.disposeActions(0,2147483647),this._cache.clear(),this._cache=null,this._disposed=!0}}disposeActions(t,e){if(!(!this._cache||this._disposed))for(const[i,r]of this._cache.entries()){if(!r)continue;const n=r.getLastAccessTime();e-n>=t&&(r.dispose(),this._cache.delete(i))}}getAction(){return this._currentAction}setDirection(t){this._currentDirection=t}getDirection(){return this._currentDirection}getActionCache(t=null){return this._currentAction?(t||(t=this._currentAction),t.overridingAction?this._cache.get(t.overridingAction):this._cache.get(t.id)):null}updateActionCache(t,e){t.overridingAction?this._cache.set(t.overridingAction,e):this._cache.set(t.id,e)}debugInfo(t){}}class bD{constructor(t,e,i){this._image=t,this._regPoint=e,this._offset=new H(0,0),this._regPoint=e,this._isCacheable=i,this.cleanPoints()}dispose(){this._image&&this._image.destroy({children:!0}),this._image=null,this._regPoint=null,this._offset=null}cleanPoints(){}setRegPoint(t){this._regPoint=t,this.cleanPoints()}get image(){return this._image}set image(t){this._image&&this._image!==t&&this._image.destroy({children:!0}),this._image=t}get regPoint(){const t=this._regPoint.clone();return t.x+=this._offset.x,t.y+=this._offset.y,t}set offset(t){this._offset=t,this.cleanPoints()}get isCacheable(){return this._isCacheable}}class DD{constructor(t){this._partList=t,this._images=new Map}dispose(){for(const t of this._images.values())t&&t.dispose();this._images=null}getPartList(){return this._partList}getImageContainer(t){const e=this._images.get(this.getCacheKey(t));return e||null}updateImageContainer(t,e){const i=this.getCacheKey(e),r=this._images.get(i);r&&r.dispose(),this._images.set(i,t)}getCacheKey(t){let e="";for(const i of this._partList)e+=i.getCacheableKey(t)+"/";return e}debugInfo(t){}}class ZE{constructor(t,e,i,r,n,a=null){this._texture=t,this._container=a,this._rect=e,this._regPoint=i,this._flipH=r,this._colorTransform=n,r&&(this._regPoint.x=-this._regPoint.x+e.width)}dispose(){this._texture=null,this._regPoint=null,this._colorTransform=null}get texture(){return this._texture}get container(){return this._container}get rect(){return this._rect}get regPoint(){return this._regPoint}get flipH(){return this._flipH}get colorTransform(){return this._colorTransform}get offsetRect(){return new et(-this._regPoint.x,-this._regPoint.y,this._rect.width,this._rect.height)}}class WI{constructor(t,e,i,r){this._structure=t,this._avatar=e,this._assets=i,this._scale=r,this._cache=new Map,this._canvas=null,this._disposed=!1,this._unionImages=[],this._matrix=new wt,this._serverRenderData=[]}dispose(){if(!this._disposed){if(this._structure=null,this._avatar=null,this._assets=null,this._canvas=null,this._disposed=!0,this._cache){for(const t of this._cache.values())t&&t.dispose();this._cache=null}if(this._unionImages){for(const t of this._unionImages)t&&t.dispose();this._unionImages=[]}}}disposeInactiveActions(t=6e4){const e=_t();if(this._cache)for(const i of this._cache.values())i&&i.disposeActions(t,e)}resetBodyPartCache(t){if(this._cache)for(const e of this._cache.values())e&&e.setAction(t,0)}setDirection(t,e){const i=this._structure.getBodyPartsUnordered(t);if(i)for(const r of i){const n=this.getBodyPartCache(r);n&&n.setDirection(e)}}setAction(t,e){const i=this._structure.getActiveBodyPartIds(t,this._avatar);for(const r of i){const n=this.getBodyPartCache(r);n&&n.setAction(t,e)}}setGeometryType(t){if(this._geometryType!==t){if(this._geometryType===Bs.SITTING&&t===Bs.VERTICAL||this._geometryType===Bs.VERTICAL&&t===Bs.SITTING||this._geometryType===Bs.SNOWWARS_HORIZONTAL&&(t=Bs.SNOWWARS_HORIZONTAL)){this._geometryType=t,this._canvas=null;return}this.disposeInactiveActions(0),this._geometryType=t,this._canvas=null}}getImageContainer(t,e,i=!1){let r=this.getBodyPartCache(t);r||(r=new qE,this._cache.set(t,r));let n=r.getDirection(),a=r.getAction(),o=e;a.definition.startFromFrameZero&&(o-=a.startFrame);let h=a,u=[],c=new Map;const l=new H;if(!(!a||!a.definition)&&a.definition.isAnimation){let p=n;const T=this._structure.getAnimation(a.definition.state+"."+a.actionParameter),A=e-a.startFrame;if(T){const O=T.getLayerData(A,t,a.overridingAction);O&&(p=n+O.dd,O.dd<0?p<0?p=8+p:p>7&&(p=8-p):p<0?p=p+8:p>7&&(p=p-8),this._scale===ui.LARGE?(l.x=O.dx,l.y=O.dy):(l.x=O.dx/2,l.y=O.dy/2),o=O.animationFrame,O.action&&(a=O.action),O.type===ws.BODYPART?(O.action!=null&&(h=O.action),n=p):O.type===ws.FX&&(n=p),c=O.items),u=T.removeData}}let _=r.getActionCache(h);(!_||i)&&(_=new PD,r.updateActionCache(h,_));let d=_.getDirectionCache(n);if(!d||i){const p=this._structure.getParts(t,this._avatar.getFigure(),h,this._geometryType,n,u,this._avatar,c);d=new DD(p),_.updateDirectionCache(n,d)}let g=d.getImageContainer(o);if(!g||i){const p=d.getPartList();if(g=this.renderBodyPart(n,p,o,a,i),g&&!i)g.isCacheable&&d.updateImageContainer(g,o);else return null}const m=this._structure.getFrameBodyPartOffset(h,n,o,t);return l.x+=m.x,l.y+=m.y,g.offset=l,g}getServerRenderData(){return this._serverRenderData=[],this._serverRenderData}getBodyPartCache(t){let e=this._cache.get(t);return e||(e=new qE,this._cache.set(t,e)),e}renderBodyPart(t,e,i,r,n=!1){if(!e||!e.length||!this._canvas&&(this._canvas=this._structure.getCanvas(this._scale,this._geometryType),!this._canvas))return null;const a=hi.DIRECTION_IS_FLIPPED[t]||!1;let o=r.definition.assetPartDefinition,h=!0,u=e.length-1;for(;u>=0;){const g=e[u];let m=16777215;if(!(t==7&&(g.partType==="fc"||g.partType==="ey"))&&!(g.partType==="ri"&&!g.partId)){const p=g.partId,T=g.getFrameDefinition(i);let A=g.partType,O=0;T?(O=T.number,T.assetPartDefinition&&T.assetPartDefinition!==""&&(o=T.assetPartDefinition)):O=g.getFrameIndex(i);let v=t,y=!1;a&&(o==="wav"&&(A===vt.LEFT_HAND||A===vt.LEFT_SLEEVE||A===vt.LEFT_COAT_SLEEVE)||o==="drk"&&(A===vt.RIGHT_HAND||A===vt.RIGHT_SLEEVE||A===vt.RIGHT_COAT_SLEEVE)||o==="blw"&&A===vt.RIGHT_HAND||o==="sig"&&A===vt.LEFT_HAND||o==="respect"&&A===vt.LEFT_HAND||A===vt.RIGHT_HAND_ITEM||A===vt.LEFT_HAND_ITEM||A===vt.CHEST_PRINT?y=!0:(t===4?v=2:t===5?v=1:t===6&&(v=0),g.flippedPartType!==A&&(A=g.flippedPartType)));let C=this._scale+"_"+o+"_"+A+"_"+p+"_"+v+"_"+O,N=this._assets.getAsset(C);if(N||(C=this._scale+"_std_"+A+"_"+p+"_"+v+"_0",N=this._assets.getAsset(C)),N){const L=N.texture;if(!L||!L.valid||!L.baseTexture)h=!1;else{g.isColorable&&g.color&&(m=g.color.rgb);const P=new H(-N.x,-N.y);if(y&&(P.x=P.x+(this._scale===ui.LARGE?65:31)),n){const b=new qm;b.name=this._assets.getAssetName(C),b.x=-P.x-33,b.y=-P.y,b.z=this._serverRenderData.length*-1e-4,b.width=N.rectangle.width,b.height=N.rectangle.height,b.flipH=y,o==="lay"&&(b.x=b.x+53),a&&(b.flipH=!b.flipH,b.flipH?b.x=-b.x-L.width:b.x=b.x+65),g.isColorable&&(b.color=`${m}`),this._serverRenderData.push(b)}this._unionImages.push(new ZE(L,N.rectangle,P,y,m))}}}u--}if(!this._unionImages.length)return null;const c=this.createUnionImage(this._unionImages,a),l=this._scale===ui.LARGE?this._canvas.height-16:this._canvas.height-8,_=new H(-c.regPoint.x,l-c.regPoint.y);a&&o!=="lay"&&(_.x=_.x+(this._scale===ui.LARGE?67:31));let d=this._unionImages.length-1;for(;d>=0;){const g=this._unionImages.pop();g&&g.dispose(),d--}return new bD(c.container,_,h)}convertColorToHex(t){let e=(t*255).toString(16);return e.length<2&&(e="0"+e),e}createUnionImage(t,e){const i=new et;for(const o of t)o&&i.enlarge(o.offsetRect);const r=new H(-i.x,-i.y),n=new Hs,a=new se(ut.EMPTY);a.width=i.width,a.height=i.height,n.addChild(a);for(const o of t){if(!o)continue;const h=o.texture,u=o.colorTransform,c=!(e&&o.flipH)&&(e||o.flipH),l=r.clone();l.x-=o.regPoint.x,l.y-=o.regPoint.y,e&&(l.x=n.width-(l.x+o.rect.width)),c?(this._matrix.a=-1,this._matrix.tx=o.rect.x+o.rect.width+l.x,this._matrix.ty=l.y-o.rect.y):(this._matrix.a=1,this._matrix.tx=l.x-o.rect.x,this._matrix.ty=l.y-o.rect.y);const _=new se(h);_.tint=u,_.transform.setFromMatrix(this._matrix),n.addChild(_)}return new ZE(null,n.getLocalBounds(),r,e,null,n)}}WI.DEFAULT_MAX_CACHE_STORAGE_TIME_MS=6e4;const yi=class{constructor(s,t,e,i,r,n=null){this._frameCounter=0,this._directionOffset=0,this._isAnimating=!1,this._animationHasResetOnToggle=!1,this._actionsSorted=!1,this._fullImageCacheSize=5,this._isCachedImage=!1,this._useFullImageCache=!1,this._effectIdInUse=-1,this._cachedBodyPartsDirection=-1,this._cachedBodyPartsGeometryType=null,this._cachedBodyPartsAvatarSet=null,this._canvasOffsets=[],this._actions=[],this._cachedBodyParts=[],this._changes=!0,this._disposed=!1,this._effectManager=r,this._structure=s,this._assets=t,this._scale=i,this._effectListener=n,this._scale==null&&(this._scale=ui.LARGE),e==null&&(e=new Ru("hr-893-45.hd-180-2.ch-210-66.lg-270-82.sh-300-91.wa-2007-.ri-1-")),this._figure=e,this._cache=new WI(this._structure,this,this._assets,this._scale),this.setDirection(yi.DEFAULT_AVATAR_SET,yi.DEFAULT_DIRECTION),this._actions=[],this._defaultAction=new jc(x.POSTURE_STAND),this._defaultAction.definition=this._structure.getActionDefinition(yi.DEFAULT_ACTION),this.resetActions(),this._fullImageCache=new Ee,this._animationFrameCount=0}getServerRenderData(){return this.getAvatarPartsForCamera(We.FULL),this._cache.getServerRenderData()}dispose(){if(!this._disposed){if(this._structure=null,this._assets=null,this._mainAction=null,this._figure=null,this._avatarSpriteData=null,this._actions=null,this._image&&(this._image.destroy(),this._image=null),this._cache&&(this._cache.dispose(),this._cache=null),this._fullImageCache){for(const s of this._fullImageCache.getValues())s&&s.destroy();this._fullImageCache=null}this._image=null,this._canvasOffsets=null,this._disposed=!0}}get disposed(){return this._disposed}getFigure(){return this._figure}getScale(){return this._scale}getPartColor(s){return this._structure.getPartColor(this._figure,s)}setDirection(s,t){t=t+this._directionOffset,t<hi.MIN_DIRECTION&&(t=hi.MAX_DIRECTION+(t+1)),t>hi.MAX_DIRECTION&&(t=t-(hi.MAX_DIRECTION+1)),this._structure.isMainAvatarSet(s)&&(this._mainDirection=t),(s===We.HEAD||s===We.FULL)&&(s===We.HEAD&&this.isHeadTurnPreventedByAction()&&(t=this._mainDirection),this._headDirection=t),this._cache.setDirection(s,t),this._changes=!0}setDirectionAngle(s,t){this.setDirection(s,Math.floor(t/45))}getSprites(){return this._sprites}getCanvasOffsets(){return this._canvasOffsets}getLayerData(s){return this._structure.getBodyPartData(s.animation.id,this._frameCounter,s.id)}updateAnimationByFrames(s=1){this._frameCounter+=s,this._changes=!0}resetAnimationFrameCounter(){this._frameCounter=0,this._changes=!0}getFullImageCacheKey(){if(!this._useFullImageCache)return null;if(this._sortedActions.length==1&&this._mainDirection==this._headDirection)return this._mainDirection+this._currentActionsString+this._frameCounter%4;if(this._sortedActions.length==2)for(const s of this._sortedActions){if(s.actionType=="fx"&&(s.actionParameter=="33"||s.actionParameter=="34"||s.actionParameter=="35"||s.actionParameter=="36"))return this._mainDirection+this._currentActionsString+0;if(s.actionType=="fx"&&(s.actionParameter=="38"||s.actionParameter=="39"))return this._mainDirection+"_"+this._headDirection+this._currentActionsString+this._frameCounter%11;if(s.actionType==="dance"&&(s.actionParameter==="1"||s.actionParameter==="2"||s.actionParameter==="3"||s.actionParameter==="4")){let t=this._frameCounter%8;return s.actionParameter==="3"&&(t=this._frameCounter%10),s.actionParameter==="4"&&(t=this._frameCounter%16),this._mainDirection+s.actionType+s.actionParameter+t}}return null}getBodyParts(s,t,e){return(e!=this._cachedBodyPartsDirection||t!=this._cachedBodyPartsGeometryType||s!=this._cachedBodyPartsAvatarSet)&&(this._cachedBodyPartsDirection=e,this._cachedBodyPartsGeometryType=t,this._cachedBodyPartsAvatarSet=s,this._cachedBodyParts=this._structure.getBodyParts(s,t,e)),this._cachedBodyParts}getAvatarPartsForCamera(s){let t;if(this._mainAction==null||this._structure.getCanvas(this._scale,this._mainAction.definition.geometryType)==null)return;const i=this.getBodyParts(s,this._mainAction.definition.geometryType,this._mainDirection);let r=i.length-1;for(;r>=0;)t=i[r],this._cache.getImageContainer(t,this._frameCounter,!0),r--}getImage(s,t,e=1,i=!0){if(!this._changes)return this._image;if(!this._mainAction)return null;this._actionsSorted||this.endActionAppends();const r=this._structure.getCanvas(this._scale,this._mainAction.definition.geometryType);if(!r)return null;this._image&&(this._image.width!==r.width||this._image.height!==r.height)&&(this._reusableTexture&&(this._reusableTexture.destroy(!0),this._reusableTexture=null),this._image=null,this._isCachedImage=!1);const n=this.getBodyParts(s,this._mainAction.definition.geometryType,this._mainDirection);this._image=null;const a=new Hs;let o=!0,h=n.length-1;for(;h>=0;){const u=n[h],c=this._cache.getImageContainer(u,this._frameCounter);if(c){const l=c.image;if(!l)return a.destroy({children:!0}),null;o=o&&c.isCacheable;const _=c.regPoint.clone();if(_){_.x+=r.offset.x,_.y+=r.offset.y,_.x+=r.regPoint.x,_.y+=r.regPoint.y;const d=new Hs;d.addChild(l),d&&(d.position.set(_.x,_.y),a.addChild(d))}}h--}return this._avatarSpriteData&&(a.filters||(a.filters=[]),this._avatarSpriteData.colorTransform&&a.filters.push(this._avatarSpriteData.colorTransform),this._avatarSpriteData.paletteIsGrayscale&&(this.convertToGrayscale(a),a.filters.push(new Ca(this._avatarSpriteData.reds,Ca.CHANNEL_RED)))),i?(this._reusableTexture?(Ae.instance.renderer.render(a,{renderTexture:this._reusableTexture,clear:!0}),this._reusableTexture.baseTexture.hitMap=null):this._reusableTexture=qt.generateTexture(a,new et(0,0,r.width,r.height)),this._reusableTexture?(this._image=this._reusableTexture,this._changes=!1,this._image):null):qt.generateTexture(a,new et(0,0,r.width,r.height))}applyPalette(s,t=[],e=[],i=[]){const r=qt.generateCanvas(s),n=r.getContext("2d"),a=n.getImageData(0,0,r.width,r.height),o=a.data;for(let u=0;u<o.length;u+=4){if(t.length==256){let c=t[o[u]];c===void 0&&(c=0),o[u]=c>>16&255,o[u+1]=c>>8&255,o[u+2]=c&255}if(e.length==256){let c=e[o[u+1]];c===void 0&&(c=0),o[u]=c>>16&255,o[u+1]=c>>8&255,o[u+2]=c&255}if(i.length==256){let c=e[o[u+2]];c===void 0&&(c=0),o[u]=c>>16&255,o[u+1]=c>>8&255,o[u+2]=c&255}}n.putImageData(a,0,0);const h=new Wt(ut.from(r));return Ae.instance.renderer.render(h,{renderTexture:s,clear:!0}),s}getImageAsSprite(s,t=1){if(!this._mainAction)return null;this._actionsSorted||this.endActionAppends();const e=this._structure.getCanvas(this._scale,this._mainAction.definition.geometryType);if(!e)return null;const i=this.getBodyParts(s,this._mainAction.definition.geometryType,this._mainDirection),r=new se,n=new se(ut.EMPTY);n.width=e.width,n.height=e.height,r.addChild(n);let a=i.length-1;for(;a>=0;){const o=i[a],h=this._cache.getImageContainer(o,this._frameCounter);if(h){const u=h.image;if(!u)return r.destroy({children:!0}),null;const c=h.regPoint.clone();if(c){c.x+=e.offset.x,c.y+=e.offset.y,c.x+=e.regPoint.x,c.y+=e.regPoint.y;const l=new Hs;l.addChild(u),l.position.set(c.x,c.y),r.addChild(l)}}a--}return r}getCroppedImage(s,t=1){if(!this._mainAction)return null;this._actionsSorted||this.endActionAppends();const e=this._structure.getCanvas(this._scale,this._mainAction.definition.geometryType);if(!e)return null;const i=this.getBodyParts(s,this._mainAction.definition.geometryType,this._mainDirection),r=new Hs;let n=i.length-1;for(;n>=0;){const h=i[n],u=this._cache.getImageContainer(h,this._frameCounter);if(u){const c=u.image;if(!c)return r.destroy({children:!0}),null;const l=u.regPoint.clone();if(l){l.x+=e.offset.x,l.y+=e.offset.y,l.x+=e.regPoint.x,l.y+=e.regPoint.y;const _=new Hs;_.addChild(c),_&&(_.position.set(l.x,l.y),r.addChild(_))}}n--}const a=qt.generateTexture(r,new et(0,0,e.width,e.height)),o=qt.generateImage(a);return o||null}getFullImage(s){const t=this._fullImageCache.getValue(s);return t?(t.valid||(this._fullImageCache.remove(s),t.destroy(!0)),t):null}cacheFullImage(s,t){const e=this._fullImageCache.getValue(s);if(e&&(this._fullImageCache.remove(s),e.destroy(!0)),this._fullImageCache.length===this._fullImageCacheSize){const i=this._fullImageCache.getKey(0);i&&this._fullImageCache.remove(i).destroy(!0)}this._fullImageCache.add(s,t)}getAsset(s){return this._assets.getAsset(s)}getDirection(){return this._mainDirection}initActionAppends(){this._actions=[],this._actionsSorted=!1,this._currentActionsString="",this._useFullImageCache=!1}endActionAppends(){if(this.sortActions()){for(const s of this._sortedActions)s.actionType===x.EFFECT&&(this._effectManager.isAvatarEffectReady(parseInt(s.actionParameter))||this._effectManager.downloadAvatarEffect(parseInt(s.actionParameter),this));this.resetActions(),this.setActionsToParts()}}appendAction(s,...t){let e="";switch(this._actionsSorted=!1,t&&t.length>0&&(e=t[0]),e!=null&&(e=e.toString()),s){case x.POSTURE:switch(e){case x.POSTURE_LAY:case x.POSTURE_WALK:case x.POSTURE_STAND:case x.POSTURE_SWIM:case x.POSTURE_FLOAT:case x.POSTURE_SIT:case x.SNOWWAR_RUN:case x.SNOWWAR_DIE_FRONT:case x.SNOWWAR_DIE_BACK:case x.SNOWWAR_PICK:case x.SNOWWAR_THROW:(e===x.POSTURE_LAY||e===x.POSTURE_LAY||e===x.POSTURE_LAY)&&(e===x.POSTURE_LAY&&(this._mainDirection==0?this.setDirection(We.FULL,4):this.setDirection(We.FULL,2)),this._useFullImageCache=!0,this._useFullImageCache=!0),this.addActionData(e);break}break;case x.GESTURE:switch(e){case x.GESTURE_AGGRAVATED:case x.GESTURE_SAD:case x.GESTURE_SMILE:case x.GESTURE_SURPRISED:this.addActionData(e);break}break;case x.EFFECT:case x.DANCE:case x.TALK:case x.EXPRESSION_WAVE:case x.SLEEP:case x.SIGN:case x.EXPRESSION_RESPECT:case x.EXPRESSION_BLOW_A_KISS:case x.EXPRESSION_LAUGH:case x.EXPRESSION_CRY:case x.EXPRESSION_IDLE:case x.EXPRESSION_SNOWBOARD_OLLIE:case x.EXPRESSION_SNOWBORD_360:case x.EXPRESSION_RIDE_JUMP:e===x.EFFECT&&(e==="33"||e==="34"||e==="35"||e==="36"||e==="38"||e==="39")&&(this._useFullImageCache=!0),this.addActionData(s,e);break;case x.CARRY_OBJECT:case x.USE_OBJECT:{const i=this._structure.getActionDefinitionWithState(s);i&&(e=i.getParameterValue(e)),this.addActionData(s,e);break}}return!0}addActionData(s,t=""){let e;this._actions||(this._actions=[]);let i=0;for(;i<this._actions.length;){if(e=this._actions[i],e.actionType==s&&e.actionParameter==t)return;i++}this._actions.push(new jc(s,t,this._frameCounter))}isAnimating(){return this._isAnimating||this._animationFrameCount>1}resetActions(){return this._animationHasResetOnToggle=!1,this._isAnimating=!1,this._sprites=[],this._avatarSpriteData=null,this._directionOffset=0,this._structure.removeDynamicItems(this),this._mainAction=this._defaultAction,this._mainAction.definition=this._defaultAction.definition,this.resetBodyPartCache(this._defaultAction),!0}isHeadTurnPreventedByAction(){let s,t;if(this._sortedActions==null)return!1;for(const e of this._sortedActions)s=this._structure.getActionDefinitionWithState(e.actionType),s!=null&&s.getPreventHeadTurn(e.actionParameter)&&(t=!0);return t}sortActions(){let s,t,e;if(this._currentActionsString="",this._sortedActions=this._structure.sortActions(this._actions),this._animationFrameCount=this._structure.maxFrames(this._sortedActions),!this._sortedActions)this._canvasOffsets=[0,0,0],this._lastActionsString!==""&&(e=!0,this._lastActionsString="");else{this._canvasOffsets=this._structure.getCanvasOffsets(this._sortedActions,this._scale,this._mainDirection);for(const i of this._sortedActions)if(this._currentActionsString=this._currentActionsString+(i.actionType+i.actionParameter),i.actionType===x.EFFECT){const r=parseInt(i.actionParameter);this._effectIdInUse!==r&&(s=!0),this._effectIdInUse=r,t=!0}t||(this._effectIdInUse>-1&&(s=!0),this._effectIdInUse=-1),s&&this._cache.disposeInactiveActions(0),this._lastActionsString!=this._currentActionsString&&(e=!0,this._lastActionsString=this._currentActionsString)}return this._actionsSorted=!0,e}setActionsToParts(){if(!this._sortedActions==null)return;const s=_t(),t=[];for(const e of this._sortedActions)t.push(e.actionType);for(const e of this._sortedActions)if(e&&e.definition&&e.definition.isAnimation){const i=this._structure.getAnimation(e.definition.state+"."+e.actionParameter);if(i&&i.hasOverriddenActions()){const r=i.overriddenActionNames();if(r)for(const n of r)t.indexOf(n)>=0&&(e.overridingAction=i.overridingAction(n))}i&&i.resetOnToggle&&(this._animationHasResetOnToggle=!0)}for(const e of this._sortedActions)if(!(!e||!e.definition)&&(e.definition.isAnimation&&e.actionParameter===""&&(e.actionParameter="1"),this.setActionToParts(e,s),e.definition.isAnimation)){this._isAnimating=e.definition.isAnimated(e.actionParameter);const i=this._structure.getAnimation(e.definition.state+"."+e.actionParameter);i&&(this._sprites=this._sprites.concat(i.spriteData),i.hasDirectionData()&&(this._directionOffset=i.directionData.offset),i.hasAvatarData()&&(this._avatarSpriteData=i.avatarData))}}setActionToParts(s,t){s==null||s.definition==null||s.definition.assetPartDefinition!=""&&(s.definition.isMain&&(this._mainAction=s,this._cache.setGeometryType(s.definition.geometryType)),this._cache.setAction(s,t),this._changes=!0)}resetBodyPartCache(s){s&&s.definition.assetPartDefinition!==""&&(s.definition.isMain&&(this._mainAction=s,this._cache.setGeometryType(s.definition.geometryType)),this._cache.resetBodyPartCache(s),this._changes=!0)}get avatarSpriteData(){return this._avatarSpriteData}convertToGrayscale(s,t="CHANNELS_EQUAL"){let e=.33,i=.33,r=.33;switch(t){case yi.CHANNELS_UNIQUE:e=.3,i=.59,r=.11;break;case yi.CHANNELS_RED:e=1,i=0,r=0;break;case yi.CHANNELS_GREEN:e=0,i=1,r=0;break;case yi.CHANNELS_BLUE:e=0,i=0,r=1;break;case yi.CHANNELS_DESATURATED:e=.3086,i=.6094,r=.082;break}const n=new Xu;return n.matrix=[e,i,r,0,0,e,i,r,0,0,e,i,r,0,0,0,0,0,1,0],s.filters.push(n),s}errorThis(s){}logThis(s){}isPlaceholder(){return!1}forceActionUpdate(){this._lastActionsString=""}get animationHasResetOnToggle(){return this._animationHasResetOnToggle}get mainAction(){return this._mainAction.actionType}resetEffect(s){s===this._effectIdInUse&&(this.resetActions(),this.setActionsToParts(),this._animationHasResetOnToggle=!0,this._changes=!0,this._effectListener&&this._effectListener.resetEffect(s))}};let Ws=yi;Ws.CHANNELS_EQUAL="CHANNELS_EQUAL";Ws.CHANNELS_UNIQUE="CHANNELS_UNIQUE";Ws.CHANNELS_RED="CHANNELS_RED";Ws.CHANNELS_GREEN="CHANNELS_GREEN";Ws.CHANNELS_BLUE="CHANNELS_BLUE";Ws.CHANNELS_DESATURATED="CHANNELS_DESATURATED";Ws.DEFAULT_ACTION="Default";Ws.DEFAULT_DIRECTION=2;Ws.DEFAULT_AVATAR_SET=We.FULL;class Ou{constructor(t){this._number=t.number,this._assetPartDefinition=t.assetPartDefinition||null}get number(){return this._number}get assetPartDefinition(){return this._assetPartDefinition}}class LD{constructor(t){if(this._frames=[],t.frames&&t.frames.length>0)for(const e of t.frames){if(!e)continue;this._frames.push(new Ou(e));let i=e.repeats||0;if(i>1)for(;--i>0;)this._frames.push(this._frames[this._frames.length-1])}}get frames(){return this._frames}}const Au=class{constructor(s){if(this._id=s.id,this._actionParts=new Map,this._bodyPartOffsets=new Map,this._frameCount=0,this._frameIndexes=[],s.parts&&s.parts.length>0)for(const t of s.parts){if(!t)continue;const e=new LD(t);this._actionParts.set(t.setType,e),this._frameCount=Math.max(this._frameCount,e.frames.length)}if(s.offsets&&s.offsets.frames&&s.offsets.frames.length>0)for(const t of s.offsets.frames){if(!t)continue;const e=t.id;this._frameCount=Math.max(this._frameCount,e);const i=new Map;if(this._bodyPartOffsets.set(e,i),t.directions&&t.directions.length>0)for(const r of t.directions){if(!r)continue;const n=r.id,a=new Map;if(i.set(n,a),r.bodyParts&&r.bodyParts.length>0)for(const o of r.bodyParts){if(!o)continue;const h=o.id;let u=0,c=0;o.dx!==void 0&&(u=o.dx),o.dy!==void 0&&(c=o.dy),a.set(h,new H(u,c))}}if(this._frameIndexes.push(e),t.repeats!==void 0){let r=t.repeats||0;if(r>1)for(;--r>0;)this._frameIndexes.push(e)}}}getPart(s){if(!s)return null;const t=this._actionParts.get(s);return t||null}getFrameBodyPartOffset(s,t,e){const i=t%this._frameIndexes.length,r=this._frameIndexes[i],n=this._bodyPartOffsets.get(r);if(!n)return Au.DEFAULT_OFFSET;const a=n.get(s);if(!a)return Au.DEFAULT_OFFSET;const o=a.get(e);return o||Au.DEFAULT_OFFSET}get id(){return this._id}get parts(){return this._actionParts}get frameCount(){return this._frameCount}};let Ku=Au;Ku.DEFAULT_OFFSET=new H(0,0);class UD{constructor(){this._actions=new Map}parse(t){if(t&&t.length>0)for(const e of t){if(!e)continue;const i=new Ku(e);this._actions.set(i.id,i)}return!0}appendJSON(t){for(const e of t.action)this._actions.set(e.id,new Ku(e));return!0}getAction(t){const e=this._actions.get(t.id);return e||null}getFrameCount(t){const e=this.getAction(t);return e?e.frameCount:0}}class xD{constructor(t,e){this._id=t.id,this._width=t.width,this._height=t.height,this._offset=new H(t.dx,t.dy),e==ui.LARGE?this._regPoint=new H((this._width-64)/2,0):this._regPoint=new H((this._width-32)/2,0)}get width(){return this._width}get height(){return this._height}get offset(){return this._offset}get id(){return this._id}get regPoint(){return this._regPoint}}const XI=class extends Rs{constructor(s,t){super(),this._dataReceiver=t,this.download(s)}download(s){const t=new XMLHttpRequest;try{t.open("GET",s),t.send(),t.onloadend=e=>{const i=t.responseText;if(!i||!i.length)throw new Error("invalid_figure_data");this._dataReceiver&&this._dataReceiver.appendJSON(JSON.parse(i)),this.dispatchEvent(new Rt(XI.AVATAR_STRUCTURE_DONE))},t.onerror=e=>{throw new Error("invalid_avatar_figure_data")}}catch(e){Y.error(e)}}};let Wc=XI;Wc.AVATAR_STRUCTURE_DONE="AVATAR_STRUCTURE_DONE";class FD{constructor(t){if(!t)throw new Error("invalid_data");this._id=t.id,this._type=t.type,this._index=t.index,this._colorLayerIndex=t.colorindex,this._paletteMapId=-1,this._breed=-1}dispose(){}get id(){return this._id}get type(){return this._type}get breed(){return this._breed}get index(){return this._index}get colorLayerIndex(){return this._colorLayerIndex}get paletteMap(){return this._paletteMapId}}class wD{constructor(t,e){if(!t||!e)throw new Error("invalid_data");this._id=e.id,this._type=t,this._gender=e.gender,this._clubLevel=e.club,this._isColorable=e.colorable,this._isSelectable=e.selectable,this._parts=[],this._hiddenLayers=[],this._isPreSelectable=e.preselectable,this._isSellable=e.sellable;for(const i of e.parts){const r=new FD(i),n=this.getPartIndex(r);n!==-1?this._parts.splice(n,0,r):this._parts.push(r)}if(e.hiddenLayers)for(const i of e.hiddenLayers)this._hiddenLayers.push(i.partType)}dispose(){for(const t of this._parts)t.dispose();this._parts=null,this._hiddenLayers=null}getPartIndex(t){const e=this._parts.length;if(!e)return-1;for(let i=0;i<e;i++){const r=this._parts[i];if(r&&!(r.type!==t.type||r.index>t.index))return i}return-1}getPart(t,e){for(const i of this._parts)if(!(i.type!==t||i.id!==e))return i;return null}get id(){return this._id}get type(){return this._type}get gender(){return this._gender}get clubLevel(){return this._clubLevel}get isColorable(){return this._isColorable}get isSelectable(){return this._isSelectable}get parts(){return this._parts}get hiddenLayers(){return this._hiddenLayers}get isPreSelectable(){return this._isPreSelectable}get isSellable(){return this._isSellable}}class GD{constructor(t){if(!t)throw new Error("invalid_data");this._id=t.id,this._index=t.index,this._clubLevel=t.club||0,this._isSelectable=t.selectable,this._rgb=parseInt("0x"+t.hexCode,16)}get id(){return this._id}get index(){return this._index}get clubLevel(){return this._clubLevel}get isSelectable(){return this._isSelectable}get rgb(){return this._rgb}}class QE{constructor(t){if(!t)throw new Error("invalid_data");this._id=t.id,this._colors=new Ee,this.append(t)}append(t){for(const e of t.colors){const i=new GD(e);this._colors.add(e.id.toString(),i)}}getColor(t){return t===void 0||t<0?null:this._colors.getValue(t.toString())||null}get id(){return this._id}get colors(){return this._colors}}class V_{constructor(t){if(!t)throw new Error("invalid_data");this._type=t.type,this._paletteId=t.paletteId,this._isMandatory={},this._isMandatory.F=[t.mandatory_f_0,t.mandatory_f_1],this._isMandatory.M=[t.mandatory_m_0,t.mandatory_m_1],this._partSets=new Ee,this.append(t)}dispose(){for(const t of this._partSets.getValues())t.dispose();this._partSets=null}cleanUp(t){for(const e of t.sets){const i=e.id.toString(),r=this._partSets.getValue(i);r&&(r.dispose(),this._partSets.remove(i))}}append(t){if(!(!t||!t.sets))for(const e of t.sets)this._partSets.add(e.id.toString(),new wD(this._type,e))}getDefaultPartSet(t){for(const e of this._partSets.getValues())if(e&&e.clubLevel===0&&(e.gender===t||e.gender==="U"))return e;return null}getPartSet(t){return this._partSets.getValue(t.toString())}get type(){return this._type}get paletteID(){return this._paletteId}isMandatory(t,e){return this._isMandatory[t.toUpperCase()][Math.min(e,1)]}optionalFromClubLevel(t){return this._isMandatory[t.toUpperCase()].indexOf(!1)}get partSets(){return this._partSets}}class BD{constructor(){this._palettes=new Map,this._setTypes=new Map}dispose(){}parse(t){if(!t)return!1;for(const e of t.palettes){const i=new QE(e);i&&this._palettes.set(i.id.toString(),i)}for(const e of t.setTypes){const i=new V_(e);i&&this._setTypes.set(i.type,i)}return!0}injectJSON(t){for(const e of t.setTypes){const i=this._setTypes.get(e.type);i?i.cleanUp(e):this._setTypes.set(e.type,new V_(e))}this.appendJSON(t)}appendJSON(t){if(!t)return!1;for(const e of t.palettes){const i=e.id.toString(),r=this._palettes.get(i);r?r.append(e):this._palettes.set(i,new QE(e))}for(const e of t.setTypes){const i=e.type,r=this._setTypes.get(i);r?r.append(e):this._setTypes.set(i,new V_(e))}return!1}getMandatorySetTypeIds(t,e){const i=[];for(const r of this._setTypes.values())!r||!r.isMandatory(t,e)||i.push(r.type);return i}getDefaultPartSet(t,e){const i=this._setTypes.get(t);return i?i.getDefaultPartSet(e):null}getSetType(t){return this._setTypes.get(t)||null}getPalette(t){return this._palettes.get(t.toString())||null}getFigurePartSet(t){for(const e of this._setTypes.values()){const i=e.getPartSet(t);if(i)return i}return null}}class JE{constructor(t){if(this._id=t.id,this._parts=[],t.activeParts&&t.activeParts.length>0)for(const e of t.activeParts)e&&this._parts.push(e.setType)}get parts(){return this._parts}}class k_{constructor(t){if(!t)throw new Error("invalid_data");this._setType=t.setType,this._flippedSetType=t.flippedSetType||null,this._removeSetType=t.removeSetType||null,this._appendToFigure=!1,this._staticId=-1}hasStaticId(){return this._staticId>=0}get staticId(){return this._staticId}set staticId(t){this._staticId=t}get setType(){return this._setType}get flippedSetType(){return this._flippedSetType}set flippedSetType(t){this._flippedSetType=t}get removeSetType(){return this._removeSetType}get appendToFigure(){return this._appendToFigure}set appendToFigure(t){this._appendToFigure=t}}class HD{constructor(){this._parts=new Map,this._activePartSets=new Map}parse(t){if(t.partSet&&t.partSet.length>0)for(const e of t.partSet)e&&this._parts.set(e.setType,new k_(e));if(t.activePartSets&&t.activePartSets.length>0)for(const e of t.activePartSets)e&&this._activePartSets.set(e.id,new JE(e));return!0}appendJSON(t){if(t.partSet&&t.partSet.length>0)for(const e of t.partSet)e&&this._parts.set(e.setType,new k_(e));if(t.activePartSets&&t.activePartSets.length>0)for(const e of t.activePartSets)e&&this._activePartSets.set(e.id,new JE(e));return!1}getActiveParts(t){const e=this._activePartSets.get(t.activePartSet);return e?e.parts:[]}getPartDefinition(t){const e=this._parts.get(t);return e||null}addPartDefinition(t){const e=t.setType;let i=this._parts.get(e);return i||(i=new k_(t),this._parts.set(e,i)),i}getActivePartSet(t){const e=this._activePartSets.get(t.activePartSet);return e||null}get parts(){return this._parts}get activePartSets(){return this._activePartSets}}class j_{constructor(t,e,i,r,n,a,o,h,u="",c=!1,l=1){this._bodyPartId=t,this._partType=e,this._partId=i,this._color=r,this._frames=n,this._action=a,this._isColorable=o,this._paletteMapId=h,this._flippedPartType=u,this._isBlendable=c,this._blendTransform=null,this._partType==="ey"&&(this._isColorable=!1)}getFrameIndex(t){if(!this._frames||!this._frames.length)return 0;const e=t%this._frames.length;return this._frames[e]instanceof Ou?this._frames[e].number:e}getFrameDefinition(t){const e=t%this._frames.length;return this._frames&&this._frames.length>e&&this._frames[e]instanceof Ou?this._frames[e]:null}getCacheableKey(t){const e=t%this._frames.length;if(this._frames&&this._frames.length>e&&this._frames[e]instanceof Ou){const i=this._frames[e];return this.partId+":"+i.assetPartDefinition+":"+i.number}return this.partId+":"+e}get bodyPartId(){return this._bodyPartId}get partType(){return this._partType}get partId(){return this._partId}get color(){return this._color}get action(){return this._action}get isColorable(){return this._isColorable}set isColorable(t){this._isColorable=t}get paletteMapId(){return this._paletteMapId}get flippedPartType(){return this._flippedPartType}get isBlendable(){return this._isBlendable}toString(){return[this._bodyPartId,this._partType,this._partId].join(":")}}const zt=class{constructor(){this._gender="M",this._avatarEffectType=-1}loadAvatarData(s,t){this._data=new Map,this._colors=new Map,this._gender=t,this.parseFigureString(s)}dispose(){this._data=null,this._colors=null,this._isDisposed=!0}get disposed(){return this._isDisposed}parseFigureString(s){if(s)for(const t of s.split(".")){const e=t.split("-");if(e.length>0){const i=e[0],r=parseInt(e[1]),n=[];let a=2;for(;a<e.length;)n.push(parseInt(e[a])),a++;n.length||n.push(0),this.savePartSetId(i,r,!1),this.savePartSetColourId(i,n,!1)}}}hasSetType(s){return!!this._data.get(s)}getPartSetId(s){return this.hasSetType(s)?this._data.get(s):-1}getColourIds(s){return this._colors.get(s)?this._colors.get(s):[]}getFigureString(){let s="";const t=[];for(const[i,r]of this._data.entries()){let n=i+"-"+r;const a=this._colors.get(i);if(a)for(const o of a)n=n+("-"+o);t.push(n)}let e=0;for(;e<t.length;)s=s+t[e],e<t.length-1&&(s=s+"."),e++;return s}savePartData(s,t,e,i=!1){this.savePartSetId(s,t,i),this.savePartSetColourId(s,e,i)}savePartSetId(s,t,e=!0){switch(s){case zt.HD:case zt.HAIR:case zt.HAT:case zt.HEAD_ACCESSORIES:case zt.EYE_ACCESSORIES:case zt.FACE_ACCESSORIES:case zt.SHIRT:case zt.JACKET:case zt.CHEST_ACCESSORIES:case zt.CHEST_PRINTS:case zt.TROUSERS:case zt.SHOES:case zt.TROUSER_ACCESSORIES:t>=0?this._data.set(s,t):this._data.delete(s)}}savePartSetColourId(s,t,e=!0){switch(s){case zt.HD:case zt.HAIR:case zt.HAT:case zt.HEAD_ACCESSORIES:case zt.EYE_ACCESSORIES:case zt.FACE_ACCESSORIES:case zt.SHIRT:case zt.JACKET:case zt.CHEST_ACCESSORIES:case zt.CHEST_PRINTS:case zt.TROUSERS:case zt.SHOES:case zt.TROUSER_ACCESSORIES:this._colors.set(s,t);return}}getFigureStringWithFace(s){const t=[zt.HD];let e="";const i=[];for(const n of t){const a=this._colors.get(n);if(a){let o=this._data.get(n);n===zt.HD&&(o=s);let h=n+"-"+o;if(o>=0){let u=0;for(;u<a.length;)h=h+("-"+a[u]),u++}i.push(h)}}let r=0;for(;r<i.length;)e=e+i[r],r<i.length-1&&(e=e+"."),r++;return e}get gender(){return this._gender}};let Ie=zt;Ie.MALE="M";Ie.FEMALE="F";Ie.UNISEX="U";Ie.SCALE="h";Ie.STD="std";Ie.DEFAULT_FRAME="0";Ie.HD="hd";Ie.HAIR="hr";Ie.HAT="ha";Ie.HEAD_ACCESSORIES="he";Ie.EYE_ACCESSORIES="ea";Ie.FACE_ACCESSORIES="fa";Ie.JACKET="cc";Ie.SHIRT="ch";Ie.CHEST_ACCESSORIES="ca";Ie.CHEST_PRINTS="cp";Ie.TROUSERS="lg";Ie.SHOES="sh";Ie.TROUSER_ACCESSORIES="wa";Ie.BLOCKED_FX_TYPES=[28,29,30,33,34,35,36,37,38,39,40,41,42,43,68];class qq{constructor(t){this._data=[],this._maxSize=t,this._index=0}reset(){this._data=[],this._index=0}addValue(t){this._data.length<this._maxSize?this._data.push(t):this._data[this._index]=t,this._index=(this._index+1)%this._maxSize}getMax(){let t=Number.MIN_VALUE,e=0;for(;e<this._maxSize;)this._data[e]>t&&(t=this._data[e]),e++;return t}getMin(){let t=Number.MAX_VALUE,e=0;for(;e<this._maxSize;)this._data[e]<t&&(t=this._data[e]),e++;return t}}class me{constructor(t,e){this._location=t,this._direction=e}get location(){return this._location}get direction(){return this._direction}}class bl extends cs{constructor(){super(),this._object=null,this._events=null,this._time=0}initialize(t){}onDispose(){this._object=null}update(t){this._time=t}processUpdateMessage(t){!t||!this._object||(this._object.setLocation(t.location),this._object.setDirection(t.direction))}getEventTypes(){return[]}mergeTypes(t,e){const i=t.concat();for(const r of e)!r||i.indexOf(r)>=0||i.push(r);return i}mouseEvent(t,e){}useObject(){}setObject(t){if(this._object!==t){if(this._object&&this._object.setLogic(null),!t){this.dispose(),this._object=null;return}this._object=t,this._object.setLogic(this)}}tearDown(){}get object(){return this._object}get eventDispatcher(){return this._events}set eventDispatcher(t){this._events=t}get widget(){return null}get contextMenu(){return null}get time(){return this._time}}class KI{constructor(){this._map=new Map,this._updateCounter=0}dispose(){this._map.clear(),this._updateCounter=0}getValue(t){return this._map.get(t)}setValue(t,e){this._map.has(t)&&this._map.get(t)===e||(this._map.set(t,e),this._updateCounter++)}removeKey(t){t&&(this._map.delete(t),this._updateCounter++)}get updateCounter(){return this._updateCounter}}const qI=class extends cs{constructor(s,t,e){super(),this._id=s,this._instanceId=qI.OBJECT_COUNTER++,this._type=e,this._model=new KI,this._location=new S,this._direction=new S,this._states=[],this._visualization=null,this._logic=null,this._pendingLogicMessages=[],this._updateCounter=0,this._isReady=!1;let i=t-1;for(;i>=0;)this._states[i]=0,i--}onDispose(){this._pendingLogicMessages=[],this.setVisualization(null),this.setLogic(null),this._model&&this._model.dispose(),super.onDispose()}getLocation(){return this._location}setLocation(s){s&&(s.x===this._location.x&&s.y===this._location.y&&s.z===this._location.z||(this._location.x=s.x,this._location.y=s.y,this._location.z=s.z,this._updateCounter++))}getDirection(){return this._direction}setDirection(s){s&&(s.x===this._direction.x&&s.y===this._direction.y&&s.z===this._direction.z||(this._direction.x=(s.x%360+360)%360,this._direction.y=(s.y%360+360)%360,this._direction.z=(s.z%360+360)%360,this._updateCounter++))}getState(s=0){return s>=0&&s<this._states.length?this._states[s]:-1}setState(s,t=0){return t>=0&&t<this._states.length?(this._states[t]!==s&&(this._states[t]=s,this._updateCounter++),!0):!1}setVisualization(s){this._visualization!==s&&(this._visualization&&this._visualization.dispose(),this._visualization=s,this._visualization&&(this._visualization.object=this))}setLogic(s){if(this._logic===s)return;const t=this._logic;if(t&&(this._logic=null,t.setObject(null)),this._logic=s,this._logic)for(this._logic.setObject(this);this._pendingLogicMessages.length;){const e=this._pendingLogicMessages.shift();this._logic.processUpdateMessage(e)}}processUpdateMessage(s){if(this._logic)return this._logic.processUpdateMessage(s);this._pendingLogicMessages.push(s)}tearDown(){this._logic&&this._logic.tearDown()}get id(){return this._id}get instanceId(){return this._instanceId}get type(){return this._type}get model(){return this._model}get visualization(){return this._visualization}get mouseHandler(){return this._logic}get logic(){return this._logic}get location(){return this._location}get direction(){return this._direction}get updateCounter(){return this._updateCounter}set updateCounter(s){this._updateCounter=s}get isReady(){return this._isReady}set isReady(s){this._isReady=s}};let ZI=qI;ZI.OBJECT_COUNTER=0;const QI=class{constructor(){this._id=QI.SPRITE_COUNTER++,this._name="",this._type="",this._spriteType=es.DEFAULT,this._texture=null,this._container=null,this._width=0,this._height=0,this._offsetX=0,this._offsetY=0,this._flipH=!1,this._flipV=!1,this._direction=0,this._alpha=255,this._blendMode=J.NORMAL,this._color=16777215,this._relativeDepth=0,this._varyingDepth=!1,this._libraryAssetName="",this._clickHandling=!1,this._visible=!0,this._tag="",this._posture=null,this._alphaTolerance=Ms.MATCH_OPAQUE_PIXELS,this._filters=[],this._updateCounter=0,this._updateContainer=!1}dispose(){this._texture=null,this._width=0,this._height=0}get id(){return this._id}set id(s){this._id=s}get name(){return this._name}set name(s){this._name!==s&&(this._name=s,this._updateCounter++)}get type(){return this._type}set type(s){this._type=s}get spriteType(){return this._spriteType}set spriteType(s){this._spriteType=s}get texture(){return this._texture}set texture(s){this._texture!==s&&(s&&(this._width=s.width,this._height=s.height),this._texture=s,this._updateCounter++)}get container(){return this._container}set container(s){this._container!==s&&(this.texture=ut.EMPTY,s&&(this._width=s.width,this._height=s.height),this._container=s,this._updateCounter++,this._updateContainer=!0)}get width(){return this._width}get height(){return this._height}get offsetX(){return this._offsetX}set offsetX(s){this._offsetX!==s&&(this._offsetX=s,this._updateCounter++)}get offsetY(){return this._offsetY}set offsetY(s){this._offsetY!==s&&(this._offsetY=s,this._updateCounter++)}get flipH(){return this._flipH}set flipH(s){this._flipH!==s&&(this._flipH=s,this._updateCounter++)}get flipV(){return this._flipV}set flipV(s){this._flipV!==s&&(this._flipV=s,this._updateCounter++)}get direction(){return this._direction}set direction(s){this._direction=s}get alpha(){return this._alpha}set alpha(s){s=s&255,this._alpha!==s&&(this._alpha=s,this._updateCounter++)}get blendMode(){return this._blendMode}set blendMode(s){this._blendMode!==s&&(this._blendMode=s,this._updateCounter++)}get color(){return this._color}set color(s){s=s&16777215,this._color!==s&&(this._color=s,this._updateCounter++)}get relativeDepth(){return this._relativeDepth}set relativeDepth(s){this._relativeDepth!==s&&(this._relativeDepth=s,this._updateCounter++)}get varyingDepth(){return this._varyingDepth}set varyingDepth(s){s!==this._varyingDepth&&(this._varyingDepth=s,this._updateCounter++)}get libraryAssetName(){return this._libraryAssetName}set libraryAssetName(s){this._libraryAssetName=s}get clickHandling(){return this._clickHandling}set clickHandling(s){this._clickHandling=s}get visible(){return this._visible}set visible(s){this._visible!==s&&(this._visible=s,this._updateCounter++)}get tag(){return this._tag}set tag(s){this._tag!==s&&(this._tag=s,this._updateCounter++)}get posture(){return this._posture}set posture(s){this._posture!==s&&(this._posture=s,this._updateCounter++)}get alphaTolerance(){return this._alphaTolerance}set alphaTolerance(s){this._alphaTolerance!==s&&(this._alphaTolerance=s,this._updateCounter++)}get filters(){return this._filters}set filters(s){this._filters=s,this._updateCounter++}get updateCounter(){return this._updateCounter}get updateContainer(){return this._updateContainer}set updateContainer(s){this._updateContainer=s}};let Xc=QI;Xc.SPRITE_COUNTER=0;const JI=class{constructor(){this._id=JI.VISUALIZATION_COUNTER++,this._object=null,this._asset=null,this._sprites=[],this._scale=-1,this._updateObjectCounter=-1,this._updateModelCounter=-1,this._updateSpriteCounter=-1}initialize(s){return!1}update(s,t,e,i){}reset(){this._scale=-1}dispose(){if(this._sprites){for(;this._sprites.length;){const s=this._sprites[0];s&&s.dispose(),this._sprites.pop()}this._sprites=null}this._object=null,this._asset=null}getSprite(s){return s>=0&&s<this._sprites.length?this._sprites[s]:null}getSpriteList(){return null}createSprite(){return this.createSpriteAtIndex(this._sprites.length)}createSpriteAtIndex(s){const t=new Xc;return s>=this._sprites.length?this._sprites.push(t):this._sprites.splice(s,0,t),t}createSprites(s){for(;this._sprites.length>s;){const t=this._sprites[this._sprites.length-1];t&&t.dispose(),this._sprites.pop()}for(;this._sprites.length<s;)this._sprites.push(new Xc)}get image(){return this.getImage(0,-1)}getImage(s,t){const e=this.getBoundingRectangle();if(e.width*e.height===0)return null;const i=this.totalSprites,r=[];let n=0;for(;n<i;){const h=this.getSprite(n);h&&h.visible&&h.texture&&r.push(h),n++}r.sort((h,u)=>u.relativeDepth-h.relativeDepth);const a=new Hs;for(n=0;n<r.length;){const h=r[n],u=h.texture;if(u){const c=new se(u);c.alpha=h.alpha/255,c.tint=h.color,c.x=h.offsetX,c.y=h.offsetY,c.blendMode=h.blendMode,c.filters=h.filters,h.flipH&&(c.scale.x=-1),h.flipV&&(c.scale.y=-1),a.addChild(c)}n++}const o=qt.generateTexture(a);return o||null}getBoundingRectangle(){const s=this.totalSprites,t=new et;let e=0;for(;e<s;){const i=this.getSprite(e);if(i&&i.texture&&i.visible){const r=i.flipH?-i.width+i.offsetX:i.offsetX,n=i.flipV?-i.height+i.offsetY:i.offsetY,a=new H(r,n);e===0?(t.x=a.x,t.y=a.y,t.width=i.width,t.height=i.height):(a.x<t.x&&(t.x=a.x),a.y<t.y&&(t.y=a.y),a.x+i.width>t.right&&(t.width=a.x+i.width-t.x),a.y+i.height>t.bottom&&(t.height=a.y+i.height-t.y))}e++}return t}get instanceId(){return this._id}get object(){return this._object}set object(s){this._object=s}get asset(){return this._asset}set asset(s){this._asset&&this._asset.removeReference(),this._asset=s,this._asset&&this._asset.addReference()}get sprites(){return this._sprites}get totalSprites(){return this._sprites.length}get updateObjectCounter(){return this._updateObjectCounter}set updateObjectCounter(s){this._updateObjectCounter=s}get updateModelCounter(){return this._updateModelCounter}set updateModelCounter(s){this._updateModelCounter=s}get updateSpriteCounter(){return this._updateSpriteCounter}set updateSpriteCounter(s){this._updateSpriteCounter=s}get spriteCount(){return this._sprites.length}};let fh=JI;fh.VISUALIZATION_COUNTER=0;class VD{constructor(t){this._roomObjectVariableAccurateZ=t||"",this._location=new S,this._screenLocation=new S,this._locationChanged=!1,this._geometryUpdateId=-1,this._objectUpdateId=-1}dispose(){this._screenLocation=null}updateLocation(t,e){if(!t||!e)return null;let i=!1;const r=t.getLocation();if((e.updateId!==this._geometryUpdateId||t.updateCounter!==this._objectUpdateId)&&(this._objectUpdateId=t.updateCounter,(e.updateId!==this._geometryUpdateId||r.x!==this._location.x||r.y!==this._location.y||r.z!==this._location.z)&&(this._geometryUpdateId=e.updateId,this._location.assign(r),i=!0)),this._locationChanged=i,this._locationChanged){const n=e.getScreenPosition(r);if(!n)return null;const a=t.model.getValue(this._roomObjectVariableAccurateZ);if(isNaN(a)||a===0){const o=new S(Math.round(r.x),Math.round(r.y),r.z);if(o.x!==r.x||o.y!==r.y){const h=e.getScreenPosition(o);this._screenLocation.assign(n),h&&(this._screenLocation.z=h.z)}else this._screenLocation.assign(n)}else this._screenLocation.assign(n);this._screenLocation.x=Math.round(this._screenLocation.x),this._screenLocation.y=Math.round(this._screenLocation.y)}return this._screenLocation}get locationChanged(){return this._locationChanged}}class kD{constructor(){this._sprites=[],this._updateId1=-1,this._updateId2=-1,this._isEmpty=!1}get spriteCount(){return this._sprites.length}get isEmpty(){return this._isEmpty}dispose(){this.setSpriteCount(0)}addSprite(t){this._sprites.push(t)}getSprite(t){return this._sprites[t]}get sprites(){return this._sprites}needsUpdate(t,e){return t===this._updateId1&&e===this._updateId2?!1:(this._updateId1=t,this._updateId2=e,!0)}setSpriteCount(t){if(t<this._sprites.length){let e=t;for(;e<this._sprites.length;){const i=this._sprites[e];i&&i.dispose(),e++}this._sprites.splice(t,this._sprites.length-t)}this._isEmpty=!this._sprites.length}}class jD{constructor(t){this._location=new VD(t),this._sprites=new kD}get location(){return this._location}get sprites(){return this._sprites}dispose(){this._location&&(this._location.dispose(),this._location=null),this._sprites&&(this._sprites.dispose(),this._sprites=null)}get objectId(){return this._objectId}set objectId(t){this._objectId=t}}const Kc=class{constructor(s){this._data=new Map,this._roomObjectVariableAccurateZ=s}dispose(){if(this._data){for(const[s,t]of this._data.entries())t&&(this._data.delete(s),t.dispose());this._data=null}}getObjectCache(s){let t=this._data.get(s);return t||(t=new jD(this._roomObjectVariableAccurateZ),this._data.set(s,t)),t}removeObjectCache(s){const t=this._data.get(s);t&&(this._data.delete(s),t.dispose())}getSortableSpriteList(){const s=[];for(const t of this._data.values()){if(!t)continue;const e=t.sprites&&t.sprites.sprites;if(!(!e||!e.length)){for(const i of e)if(i&&i.sprite.spriteType!==es.ROOM_PLANE&&i.sprite.name!==""){const r=new qm;r.objectId=t.objectId,r.x=i.x,r.y=i.y,r.z=i.z,r.name=i.sprite.name||"",r.flipH=i.sprite.flipH,r.alpha=i.sprite.alpha,r.color=i.sprite.color.toString(),r.blendMode=i.sprite.blendMode.toString(),r.width=i.sprite.width,r.height=i.sprite.height,r.type=i.sprite.type,r.posture=i.sprite.posture;const n=this.isSkewedSprite(i.sprite);n&&(r.skew=i.sprite.direction%4===0?-.5:.5),(n||i.name.indexOf("%image.library.url%")>=0||i.name.indexOf("%group.badge.url%")>=0)&&r.width<=Kc.MAX_SIZE_FOR_AVG_COLOR&&r.height<=Kc.MAX_SIZE_FOR_AVG_COLOR&&i.sprite.name.indexOf("external_image_wallitem")===0&&(r.frame=!0),s.push(r)}}}return!s||!s.length?null:s}isSkewedSprite(s){return s.type?s.type.indexOf("external_image_wallitem")===0&&s.tag==="THUMBNAIL"||s.type.indexOf("guild_forum")===0&&s.tag==="THUMBNAIL":!1}getPlaneSortableSprites(){const s=[];for(const t of this._data.values())for(const e of t.sprites.sprites)e.sprite.spriteType===es.ROOM_PLANE&&s.push(e);return s}};let $I=Kc;$I.MAX_SIZE_FOR_AVG_COLOR=200;/*!
 * @pixi/graphics - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/graphics is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Vi;(function(s){s.MITER="miter",s.BEVEL="bevel",s.ROUND="round"})(Vi||(Vi={}));var yr;(function(s){s.BUTT="butt",s.ROUND="round",s.SQUARE="square"})(yr||(yr={}));var $o={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(s,t){if(t===void 0&&(t=20),!this.adaptive||!s||isNaN(s))return t;var e=Math.ceil(s/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}},tT=function(){function s(){this.color=16777215,this.alpha=1,this.texture=ut.WHITE,this.matrix=null,this.visible=!1,this.reset()}return s.prototype.clone=function(){var t=new s;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t},s.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=ut.WHITE,this.matrix=null,this.visible=!1},s.prototype.destroy=function(){this.texture=null,this.matrix=null},s}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var qc=function(s,t){return qc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])},qc(s,t)};function Pf(s,t){qc(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function $E(s,t){var e,i;t===void 0&&(t=!1);var r=s.length;if(!(r<6)){for(var n=0,a=0,o=s[r-2],h=s[r-1];a<r;a+=2){var u=s[a],c=s[a+1];n+=(u-o)*(c+h),o=u,h=c}if(!t&&n>0||t&&n<=0)for(var l=r/2,a=l+l%2;a<r;a+=2){var _=r-a-2,d=r-a-1,g=a,m=a+1;e=[s[g],s[_]],s[_]=e[0],s[g]=e[1],i=[s[m],s[d]],s[d]=i[0],s[m]=i[1]}}}var eT={build:function(s){s.points=s.shape.points.slice()},triangulate:function(s,t){var e=s.points,i=s.holes,r=t.points,n=t.indices;if(e.length>=6){$E(e,!1);for(var a=[],o=0;o<i.length;o++){var h=i[o];$E(h.points,!0),a.push(e.length/2),e=e.concat(h.points)}var u=Np(e,a,2);if(!u)return;for(var c=r.length/2,o=0;o<u.length;o+=3)n.push(u[o]+c),n.push(u[o+1]+c),n.push(u[o+2]+c);for(var o=0;o<e.length;o++)r.push(e[o])}}},qu={build:function(s){var t=s.points,e,i,r,n,a,o;if(s.type===Le.CIRC){var h=s.shape;e=h.x,i=h.y,a=o=h.radius,r=n=0}else if(s.type===Le.ELIP){var u=s.shape;e=u.x,i=u.y,a=u.width,o=u.height,r=n=0}else{var c=s.shape,l=c.width/2,_=c.height/2;e=c.x+l,i=c.y+_,a=o=Math.max(0,Math.min(c.radius,Math.min(l,_))),r=l-a,n=_-o}if(!(a>=0&&o>=0&&r>=0&&n>=0)){t.length=0;return}var d=Math.ceil(2.3*Math.sqrt(a+o)),g=d*8+(r?4:0)+(n?4:0);if(t.length=g,g!==0){if(d===0){t.length=8,t[0]=t[6]=e+r,t[1]=t[3]=i+n,t[2]=t[4]=e-r,t[5]=t[7]=i-n;return}var m=0,p=d*4+(r?2:0)+2,T=p,A=g;{var O=r+a,v=n,y=e+O,C=e-O,N=i+v;if(t[m++]=y,t[m++]=N,t[--p]=N,t[--p]=C,n){var L=i-v;t[T++]=C,t[T++]=L,t[--A]=L,t[--A]=y}}for(var P=1;P<d;P++){var b=Math.PI/2*(P/d),O=r+Math.cos(b)*a,v=n+Math.sin(b)*o,y=e+O,C=e-O,N=i+v,L=i-v;t[m++]=y,t[m++]=N,t[--p]=N,t[--p]=C,t[T++]=C,t[T++]=L,t[--A]=L,t[--A]=y}{var O=r,v=n+o,y=e+O,C=e-O,N=i+v,L=i-v;t[m++]=y,t[m++]=N,t[--A]=L,t[--A]=y,r&&(t[m++]=C,t[m++]=N,t[--A]=L,t[--A]=C)}}},triangulate:function(s,t){var e=s.points,i=t.points,r=t.indices;if(e.length!==0){var n=i.length/2,a=n,o,h;if(s.type!==Le.RREC){var u=s.shape;o=u.x,h=u.y}else{var c=s.shape;o=c.x+c.width/2,h=c.y+c.height/2}var l=s.matrix;i.push(s.matrix?l.a*o+l.c*h+l.tx:o,s.matrix?l.b*o+l.d*h+l.ty:h),n++,i.push(e[0],e[1]);for(var _=2;_<e.length;_+=2)i.push(e[_],e[_+1]),r.push(n++,a,n);r.push(a+1,a,n)}}},zD={build:function(s){var t=s.shape,e=t.x,i=t.y,r=t.width,n=t.height,a=s.points;a.length=0,a.push(e,i,e+r,i,e+r,i+n,e,i+n)},triangulate:function(s,t){var e=s.points,i=t.points,r=i.length/2;i.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(r,r+1,r+2,r+1,r+2,r+3)}};function Yn(s,t,e){var i=t-s;return s+i*e}function hu(s,t,e,i,r,n,a){a===void 0&&(a=[]);for(var o=20,h=a,u=0,c=0,l=0,_=0,d=0,g=0,m=0,p=0;m<=o;++m)p=m/o,u=Yn(s,e,p),c=Yn(t,i,p),l=Yn(e,r,p),_=Yn(i,n,p),d=Yn(u,l,p),g=Yn(c,_,p),!(m===0&&h[h.length-2]===d&&h[h.length-1]===g)&&h.push(d,g);return h}var YD={build:function(s){if(Na.nextRoundedRectBehavior){qu.build(s);return}var t=s.shape,e=s.points,i=t.x,r=t.y,n=t.width,a=t.height,o=Math.max(0,Math.min(t.radius,Math.min(n,a)/2));e.length=0,o?(hu(i,r+o,i,r,i+o,r,e),hu(i+n-o,r,i+n,r,i+n,r+o,e),hu(i+n,r+a-o,i+n,r+a,i+n-o,r+a,e),hu(i+o,r+a,i,r+a,i,r+a-o,e)):e.push(i,r,i+n,r,i+n,r+a,i,r+a)},triangulate:function(s,t){if(Na.nextRoundedRectBehavior){qu.triangulate(s,t);return}for(var e=s.points,i=t.points,r=t.indices,n=i.length/2,a=Np(e,null,2),o=0,h=a.length;o<h;o+=3)r.push(a[o]+n),r.push(a[o+1]+n),r.push(a[o+2]+n);for(var o=0,h=e.length;o<h;o++)i.push(e[o],e[++o])}};function tp(s,t,e,i,r,n,a,o){var h=s-e*r,u=t-i*r,c=s+e*n,l=t+i*n,_,d;a?(_=i,d=-e):(_=-i,d=e);var g=h+_,m=u+d,p=c+_,T=l+d;return o.push(g,m),o.push(p,T),2}function Qr(s,t,e,i,r,n,a,o){var h=e-s,u=i-t,c=Math.atan2(h,u),l=Math.atan2(r-s,n-t);o&&c<l?c+=Math.PI*2:!o&&c>l&&(l+=Math.PI*2);var _=c,d=l-c,g=Math.abs(d),m=Math.sqrt(h*h+u*u),p=(15*g*Math.sqrt(m)/Math.PI>>0)+1,T=d/p;if(_+=T,o){a.push(s,t),a.push(e,i);for(var A=1,O=_;A<p;A++,O+=T)a.push(s,t),a.push(s+Math.sin(O)*m,t+Math.cos(O)*m);a.push(s,t),a.push(r,n)}else{a.push(e,i),a.push(s,t);for(var A=1,O=_;A<p;A++,O+=T)a.push(s+Math.sin(O)*m,t+Math.cos(O)*m),a.push(s,t);a.push(r,n),a.push(s,t)}return p*2}function WD(s,t){var e=s.shape,i=s.points||e.points.slice(),r=t.closePointEps;if(i.length!==0){var n=s.lineStyle,a=new H(i[0],i[1]),o=new H(i[i.length-2],i[i.length-1]),h=e.type!==Le.POLY||e.closeStroke,u=Math.abs(a.x-o.x)<r&&Math.abs(a.y-o.y)<r;if(h){i=i.slice(),u&&(i.pop(),i.pop(),o.set(i[i.length-2],i[i.length-1]));var c=(a.x+o.x)*.5,l=(o.y+a.y)*.5;i.unshift(c,l),i.push(c,l)}var _=t.points,d=i.length/2,g=i.length,m=_.length/2,p=n.width/2,T=p*p,A=n.miterLimit*n.miterLimit,O=i[0],v=i[1],y=i[2],C=i[3],N=0,L=0,P=-(v-C),b=O-y,w=0,q=0,ht=Math.sqrt(P*P+b*b);P/=ht,b/=ht,P*=p,b*=p;var dt=n.alignment,j=(1-dt)*2,V=dt*2;h||(n.cap===yr.ROUND?g+=Qr(O-P*(j-V)*.5,v-b*(j-V)*.5,O-P*j,v-b*j,O+P*V,v+b*V,_,!0)+2:n.cap===yr.SQUARE&&(g+=tp(O,v,P,b,j,V,!0,_))),_.push(O-P*j,v-b*j),_.push(O+P*V,v+b*V);for(var Dt=1;Dt<d-1;++Dt){O=i[(Dt-1)*2],v=i[(Dt-1)*2+1],y=i[Dt*2],C=i[Dt*2+1],N=i[(Dt+1)*2],L=i[(Dt+1)*2+1],P=-(v-C),b=O-y,ht=Math.sqrt(P*P+b*b),P/=ht,b/=ht,P*=p,b*=p,w=-(C-L),q=y-N,ht=Math.sqrt(w*w+q*q),w/=ht,q/=ht,w*=p,q*=p;var Fe=y-O,qe=v-C,X=y-N,st=L-C,gt=Fe*X+qe*st,Et=qe*X-st*Fe,pt=Et<0;if(Math.abs(Et)<.001*Math.abs(gt)){_.push(y-P*j,C-b*j),_.push(y+P*V,C+b*V),gt>=0&&(n.join===Vi.ROUND?g+=Qr(y,C,y-P*j,C-b*j,y-w*j,C-q*j,_,!1)+4:g+=2,_.push(y-w*V,C-q*V),_.push(y+w*j,C+q*j));continue}var Gt=(-P+O)*(-b+C)-(-P+y)*(-b+v),jt=(-w+N)*(-q+C)-(-w+y)*(-q+L),Jt=(Fe*jt-X*Gt)/Et,ee=(st*Gt-qe*jt)/Et,Ne=(Jt-y)*(Jt-y)+(ee-C)*(ee-C),we=y+(Jt-y)*j,ie=C+(ee-C)*j,Te=y-(Jt-y)*V,Se=C-(ee-C)*V,Qs=Math.min(Fe*Fe+qe*qe,X*X+st*st),Js=pt?j:V,Ja=Qs+Js*Js*T,pv=Ne<=Ja;pv?n.join===Vi.BEVEL||Ne/T>A?(pt?(_.push(we,ie),_.push(y+P*V,C+b*V),_.push(we,ie),_.push(y+w*V,C+q*V)):(_.push(y-P*j,C-b*j),_.push(Te,Se),_.push(y-w*j,C-q*j),_.push(Te,Se)),g+=2):n.join===Vi.ROUND?pt?(_.push(we,ie),_.push(y+P*V,C+b*V),g+=Qr(y,C,y+P*V,C+b*V,y+w*V,C+q*V,_,!0)+4,_.push(we,ie),_.push(y+w*V,C+q*V)):(_.push(y-P*j,C-b*j),_.push(Te,Se),g+=Qr(y,C,y-P*j,C-b*j,y-w*j,C-q*j,_,!1)+4,_.push(y-w*j,C-q*j),_.push(Te,Se)):(_.push(we,ie),_.push(Te,Se)):(_.push(y-P*j,C-b*j),_.push(y+P*V,C+b*V),n.join===Vi.ROUND?pt?g+=Qr(y,C,y+P*V,C+b*V,y+w*V,C+q*V,_,!0)+2:g+=Qr(y,C,y-P*j,C-b*j,y-w*j,C-q*j,_,!1)+2:n.join===Vi.MITER&&Ne/T<=A&&(pt?(_.push(Te,Se),_.push(Te,Se)):(_.push(we,ie),_.push(we,ie)),g+=2),_.push(y-w*j,C-q*j),_.push(y+w*V,C+q*V),g+=2)}O=i[(d-2)*2],v=i[(d-2)*2+1],y=i[(d-1)*2],C=i[(d-1)*2+1],P=-(v-C),b=O-y,ht=Math.sqrt(P*P+b*b),P/=ht,b/=ht,P*=p,b*=p,_.push(y-P*j,C-b*j),_.push(y+P*V,C+b*V),h||(n.cap===yr.ROUND?g+=Qr(y-P*(j-V)*.5,C-b*(j-V)*.5,y-P*j,C-b*j,y+P*V,C+b*V,_,!1)+2:n.cap===yr.SQUARE&&(g+=tp(y,C,P,b,j,V,!1,_)));for(var mv=t.indices,Iv=$o.epsilon*$o.epsilon,Dt=m;Dt<g+m-2;++Dt)O=_[Dt*2],v=_[Dt*2+1],y=_[(Dt+1)*2],C=_[(Dt+1)*2+1],N=_[(Dt+2)*2],L=_[(Dt+2)*2+1],!(Math.abs(O*(C-L)+y*(L-v)+N*(v-C))<Iv)&&mv.push(Dt,Dt+1,Dt+2)}}function XD(s,t){var e=0,i=s.shape,r=s.points||i.points,n=i.type!==Le.POLY||i.closeStroke;if(r.length!==0){var a=t.points,o=t.indices,h=r.length/2,u=a.length/2,c=u;for(a.push(r[0],r[1]),e=1;e<h;e++)a.push(r[e*2],r[e*2+1]),o.push(c,c+1),c++;n&&o.push(c,u)}}function ep(s,t){s.lineStyle.native?XD(s,t):WD(s,t)}var sp=function(){function s(){}return s.curveTo=function(t,e,i,r,n,a){var o=a[a.length-2],h=a[a.length-1],u=h-e,c=o-t,l=r-e,_=i-t,d=Math.abs(u*_-c*l);if(d<1e-8||n===0)return(a[a.length-2]!==t||a[a.length-1]!==e)&&a.push(t,e),null;var g=u*u+c*c,m=l*l+_*_,p=u*l+c*_,T=n*Math.sqrt(g)/d,A=n*Math.sqrt(m)/d,O=T*p/g,v=A*p/m,y=T*_+A*c,C=T*l+A*u,N=c*(A+O),L=u*(A+O),P=_*(T+v),b=l*(T+v),w=Math.atan2(L-C,N-y),q=Math.atan2(b-C,P-y);return{cx:y+t,cy:C+e,radius:n,startAngle:w,endAngle:q,anticlockwise:c*l>_*u}},s.arc=function(t,e,i,r,n,a,o,h,u){for(var c=o-a,l=$o._segmentsCount(Math.abs(c)*n,Math.ceil(Math.abs(c)/Bo)*40),_=c/(l*2),d=_*2,g=Math.cos(_),m=Math.sin(_),p=l-1,T=p%1/p,A=0;A<=p;++A){var O=A+T*A,v=_+a+d*O,y=Math.cos(v),C=-Math.sin(v);u.push((g*y+m*C)*n+i,(g*-C+m*y)*n+r)}},s}(),KD=function(){function s(){}return s.curveLength=function(t,e,i,r,n,a,o,h){for(var u=10,c=0,l=0,_=0,d=0,g=0,m=0,p=0,T=0,A=0,O=0,v=0,y=t,C=e,N=1;N<=u;++N)l=N/u,_=l*l,d=_*l,g=1-l,m=g*g,p=m*g,T=p*t+3*m*l*i+3*g*_*n+d*o,A=p*e+3*m*l*r+3*g*_*a+d*h,O=y-T,v=C-A,y=T,C=A,c+=Math.sqrt(O*O+v*v);return c},s.curveTo=function(t,e,i,r,n,a,o){var h=o[o.length-2],u=o[o.length-1];o.length-=2;var c=$o._segmentsCount(s.curveLength(h,u,t,e,i,r,n,a)),l=0,_=0,d=0,g=0,m=0;o.push(h,u);for(var p=1,T=0;p<=c;++p)T=p/c,l=1-T,_=l*l,d=_*l,g=T*T,m=g*T,o.push(d*h+3*_*T*t+3*l*g*i+m*n,d*u+3*_*T*e+3*l*g*r+m*a)},s}(),qD=function(){function s(){}return s.curveLength=function(t,e,i,r,n,a){var o=t-2*i+n,h=e-2*r+a,u=2*i-2*t,c=2*r-2*e,l=4*(o*o+h*h),_=4*(o*u+h*c),d=u*u+c*c,g=2*Math.sqrt(l+_+d),m=Math.sqrt(l),p=2*l*m,T=2*Math.sqrt(d),A=_/m;return(p*g+m*_*(g-T)+(4*d*l-_*_)*Math.log((2*m+A+g)/(A+T)))/(4*p)},s.curveTo=function(t,e,i,r,n){for(var a=n[n.length-2],o=n[n.length-1],h=$o._segmentsCount(s.curveLength(a,o,t,e,i,r)),u=0,c=0,l=1;l<=h;++l){var _=l/h;u=a+(t-a)*_,c=o+(e-o)*_,n.push(u+(t+(i-t)*_-u)*_,c+(e+(r-e)*_-c)*_)}},s}(),ZD=function(){function s(){this.reset()}return s.prototype.begin=function(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i},s.prototype.end=function(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start},s.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},s}(),Jr,z_=(Jr={},Jr[Le.POLY]=eT,Jr[Le.CIRC]=qu,Jr[Le.ELIP]=qu,Jr[Le.RECT]=zD,Jr[Le.RREC]=YD,Jr),ip=[],uu=[],rp=function(){function s(t,e,i,r){e===void 0&&(e=null),i===void 0&&(i=null),r===void 0&&(r=null),this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=r,this.type=t.type}return s.prototype.clone=function(){return new s(this.shape,this.fillStyle,this.lineStyle,this.matrix)},s.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},s}(),Wn=new H,QD=function(s){Pf(t,s);function t(){var e=s.call(this)||this;return e.closePointEps=1e-4,e.boundsPadding=0,e.uvsFloat32=null,e.indicesUint16=null,e.batchable=!1,e.points=[],e.colors=[],e.uvs=[],e.indices=[],e.textureIds=[],e.graphicsData=[],e.drawCalls=[],e.batchDirty=-1,e.batches=[],e.dirty=0,e.cacheDirty=-1,e.clearDirty=0,e.shapeIndex=0,e._bounds=new qo,e.boundsDirty=-1,e}return Object.defineProperty(t.prototype,"bounds",{get:function(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),t.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),uu.push(this.drawCalls[e]);this.drawCalls.length=0;for(var e=0;e<this.batches.length;e++){var i=this.batches[e];i.reset(),ip.push(i)}this.batches.length=0},t.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},t.prototype.drawShape=function(e,i,r,n){i===void 0&&(i=null),r===void 0&&(r=null),n===void 0&&(n=null);var a=new rp(e,i,r,n);return this.graphicsData.push(a),this.dirty++,this},t.prototype.drawHole=function(e,i){if(i===void 0&&(i=null),!this.graphicsData.length)return null;var r=new rp(e,null,null,i),n=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=n.lineStyle,n.holes.push(r),this.dirty++,this},t.prototype.destroy=function(){s.prototype.destroy.call(this);for(var e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},t.prototype.containsPoint=function(e){for(var i=this.graphicsData,r=0;r<i.length;++r){var n=i[r];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(e,Wn):Wn.copyFrom(e),n.shape.contains(Wn.x,Wn.y))){var a=!1;if(n.holes)for(var o=0;o<n.holes.length;o++){var h=n.holes[o];if(h.shape.contains(Wn.x,Wn.y)){a=!0;break}}if(!a)return!0}}return!1},t.prototype.updateBatches=function(){if(!this.graphicsData.length){this.batchable=!0;return}if(this.validateBatching()){this.cacheDirty=this.dirty;var e=this.uvs,i=this.graphicsData,r=null,n=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],n=r.style);for(var a=this.shapeIndex;a<i.length;a++){this.shapeIndex++;var o=i[a],h=o.fillStyle,u=o.lineStyle,c=z_[o.type];c.build(o),o.matrix&&this.transformPoints(o.points,o.matrix),(h.visible||u.visible)&&this.processHoles(o.holes);for(var l=0;l<2;l++){var _=l===0?h:u;if(_.visible){var d=_.texture.baseTexture,g=this.indices.length,m=this.points.length/2;d.wrapMode=qi.REPEAT,l===0?this.processFill(o):this.processLine(o);var p=this.points.length/2-m;p!==0&&(r&&!this._compareStyles(n,_)&&(r.end(g,m),r=null),r||(r=ip.pop()||new ZD,r.begin(_,g,m),this.batches.push(r),n=_),this.addUvs(this.points,e,_.texture,m,p,_.matrix))}}}var T=this.indices.length,A=this.points.length/2;if(r&&r.end(T,A),this.batches.length===0){this.batchable=!0;return}var O=A>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&O===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=O?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}},t.prototype._compareStyles=function(e,i){return!(!e||!i||e.texture.baseTexture!==i.texture.baseTexture||e.color+e.alpha!==i.color+i.alpha||!!e.native!=!!i.native)},t.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var e=0,i=this.graphicsData.length;e<i;e++){var r=this.graphicsData[e],n=r.fillStyle,a=r.lineStyle;if(n&&!n.texture.baseTexture.valid||a&&!a.texture.baseTexture.valid)return!1}return!0},t.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var e=this.batches,i=0,r=e.length;i<r;i++)for(var n=e[i],a=0;a<n.size;a++){var o=n.start+a;this.indicesUint16[o]=this.indicesUint16[o]-n.attribStart}},t.prototype.isBatchable=function(){if(this.points.length>65535*2)return!1;for(var e=this.batches,i=0;i<e.length;i++)if(e[i].style.native)return!1;return this.points.length<t.BATCHABLE_SIZE*2},t.prototype.buildDrawCalls=function(){for(var e=++Yt._globalBatch,i=0;i<this.drawCalls.length;i++)this.drawCalls[i].texArray.clear(),uu.push(this.drawCalls[i]);this.drawCalls.length=0;var r=this.colors,n=this.textureIds,a=uu.pop();a||(a=new dc,a.texArray=new fc),a.texArray.count=0,a.start=0,a.size=0,a.type=oi.TRIANGLES;var o=0,h=null,u=0,c=!1,l=oi.TRIANGLES,_=0;this.drawCalls.push(a);for(var i=0;i<this.batches.length;i++){var d=this.batches[i],g=8,m=d.style,p=m.texture.baseTexture;c!==!!m.native&&(c=!!m.native,l=c?oi.LINES:oi.TRIANGLES,h=null,o=g,e++),h!==p&&(h=p,p._batchEnabled!==e&&(o===g&&(e++,o=0,a.size>0&&(a=uu.pop(),a||(a=new dc,a.texArray=new fc),this.drawCalls.push(a)),a.start=_,a.size=0,a.texArray.count=0,a.type=l),p.touched=1,p._batchEnabled=e,p._batchLocation=o,p.wrapMode=qi.REPEAT,a.texArray.elements[a.texArray.count++]=p,o++)),a.size+=d.size,_+=d.size,u=p._batchLocation,this.addColors(r,m.color,m.alpha,d.attribSize,d.attribStart),this.addTextureIds(n,u,d.attribSize,d.attribStart)}Yt._globalBatch=e,this.packAttributes()},t.prototype.packAttributes=function(){for(var e=this.points,i=this.uvs,r=this.colors,n=this.textureIds,a=new ArrayBuffer(e.length*3*4),o=new Float32Array(a),h=new Uint32Array(a),u=0,c=0;c<e.length/2;c++)o[u++]=e[c*2],o[u++]=e[c*2+1],o[u++]=i[c*2],o[u++]=i[c*2+1],h[u++]=r[c],o[u++]=n[c];this._buffer.update(a),this._indexBuffer.update(this.indicesUint16)},t.prototype.processFill=function(e){if(e.holes.length)eT.triangulate(e,this);else{var i=z_[e.type];i.triangulate(e,this)}},t.prototype.processLine=function(e){ep(e,this);for(var i=0;i<e.holes.length;i++)ep(e.holes[i],this)},t.prototype.processHoles=function(e){for(var i=0;i<e.length;i++){var r=e[i],n=z_[r.type];n.build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}},t.prototype.calculateBounds=function(){var e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)},t.prototype.transformPoints=function(e,i){for(var r=0;r<e.length/2;r++){var n=e[r*2],a=e[r*2+1];e[r*2]=i.a*n+i.c*a+i.tx,e[r*2+1]=i.b*n+i.d*a+i.ty}},t.prototype.addColors=function(e,i,r,n,a){a===void 0&&(a=0);var o=(i>>16)+(i&65280)+((i&255)<<16),h=Dp(o,r);e.length=Math.max(e.length,a+n);for(var u=0;u<n;u++)e[a+u]=h},t.prototype.addTextureIds=function(e,i,r,n){n===void 0&&(n=0),e.length=Math.max(e.length,n+r);for(var a=0;a<r;a++)e[n+a]=i},t.prototype.addUvs=function(e,i,r,n,a,o){o===void 0&&(o=null);for(var h=0,u=i.length,c=r.frame;h<a;){var l=e[(n+h)*2],_=e[(n+h)*2+1];if(o){var d=o.a*l+o.c*_+o.tx;_=o.b*l+o.d*_+o.ty,l=d}h++,i.push(l/c.width,_/c.height)}var g=r.baseTexture;(c.width<g.width||c.height<g.height)&&this.adjustUvs(i,r,u,a)},t.prototype.adjustUvs=function(e,i,r,n){for(var a=i.baseTexture,o=1e-6,h=r+n*2,u=i.frame,c=u.width/a.width,l=u.height/a.height,_=u.x/u.width,d=u.y/u.height,g=Math.floor(e[r]+o),m=Math.floor(e[r+1]+o),p=r+2;p<h;p+=2)g=Math.min(g,Math.floor(e[p]+o)),m=Math.min(m,Math.floor(e[p+1]+o));_-=g,d-=m;for(var p=r;p<h;p+=2)e[p]=(e[p]+_)*c,e[p+1]=(e[p+1]+d)*l},t.BATCHABLE_SIZE=100,t}(qp),JD=function(s){Pf(t,s);function t(){var e=s!==null&&s.apply(this,arguments)||this;return e.width=0,e.alignment=.5,e.native=!1,e.cap=yr.BUTT,e.join=Vi.MITER,e.miterLimit=10,e}return t.prototype.clone=function(){var e=new t;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e},t.prototype.reset=function(){s.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},t}(tT),$D=new Float32Array(3),Y_={},Na=function(s){Pf(t,s);function t(e){e===void 0&&(e=null);var i=s.call(this)||this;return i.shader=null,i.pluginName="batch",i.currentPath=null,i.batches=[],i.batchTint=-1,i.batchDirty=-1,i.vertexData=null,i._fillStyle=new tT,i._lineStyle=new JD,i._matrix=null,i._holeMode=!1,i.state=ah.for2d(),i._geometry=e||new QD,i._geometry.refCount++,i._transformID=-1,i.tint=16777215,i.blendMode=J.NORMAL,i}return Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return this.finishPoly(),new t(this._geometry)},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(e){this.state.blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tint",{get:function(){return this._tint},set:function(e){this._tint=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),t.prototype.lineStyle=function(e,i,r,n,a){return e===void 0&&(e=null),i===void 0&&(i=0),r===void 0&&(r=1),n===void 0&&(n=.5),a===void 0&&(a=!1),typeof e=="number"&&(e={width:e,color:i,alpha:r,alignment:n,native:a}),this.lineTextureStyle(e)},t.prototype.lineTextureStyle=function(e){e=Object.assign({width:0,texture:ut.WHITE,color:e&&e.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:yr.BUTT,join:Vi.MITER,miterLimit:10},e),this.currentPath&&this.startPoly();var i=e.width>0&&e.alpha>0;return i?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:i},e)):this._lineStyle.reset(),this},t.prototype.startPoly=function(){if(this.currentPath){var e=this.currentPath.points,i=this.currentPath.points.length;i>2&&(this.drawShape(this.currentPath),this.currentPath=new du,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[i-2],e[i-1]))}else this.currentPath=new du,this.currentPath.closeStroke=!1},t.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},t.prototype.moveTo=function(e,i){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=i,this},t.prototype.lineTo=function(e,i){this.currentPath||this.moveTo(0,0);var r=this.currentPath.points,n=r[r.length-2],a=r[r.length-1];return(n!==e||a!==i)&&r.push(e,i),this},t.prototype._initCurve=function(e,i){e===void 0&&(e=0),i===void 0&&(i=0),this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,i]):this.moveTo(e,i)},t.prototype.quadraticCurveTo=function(e,i,r,n){this._initCurve();var a=this.currentPath.points;return a.length===0&&this.moveTo(0,0),qD.curveTo(e,i,r,n,a),this},t.prototype.bezierCurveTo=function(e,i,r,n,a,o){return this._initCurve(),KD.curveTo(e,i,r,n,a,o,this.currentPath.points),this},t.prototype.arcTo=function(e,i,r,n,a){this._initCurve(e,i);var o=this.currentPath.points,h=sp.curveTo(e,i,r,n,a,o);if(h){var u=h.cx,c=h.cy,l=h.radius,_=h.startAngle,d=h.endAngle,g=h.anticlockwise;this.arc(u,c,l,_,d,g)}return this},t.prototype.arc=function(e,i,r,n,a,o){if(o===void 0&&(o=!1),n===a)return this;!o&&a<=n?a+=Bo:o&&n<=a&&(n+=Bo);var h=a-n;if(h===0)return this;var u=e+Math.cos(n)*r,c=i+Math.sin(n)*r,l=this._geometry.closePointEps,_=this.currentPath?this.currentPath.points:null;if(_){var d=Math.abs(_[_.length-2]-u),g=Math.abs(_[_.length-1]-c);d<l&&g<l||_.push(u,c)}else this.moveTo(u,c),_=this.currentPath.points;return sp.arc(u,c,e,i,r,n,a,o,_),this},t.prototype.beginFill=function(e,i){return e===void 0&&(e=0),i===void 0&&(i=1),this.beginTextureFill({texture:ut.WHITE,color:e,alpha:i})},t.prototype.beginTextureFill=function(e){e=Object.assign({texture:ut.WHITE,color:16777215,alpha:1,matrix:null},e),this.currentPath&&this.startPoly();var i=e.alpha>0;return i?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:i},e)):this._fillStyle.reset(),this},t.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},t.prototype.drawRect=function(e,i,r,n){return this.drawShape(new et(e,i,r,n))},t.prototype.drawRoundedRect=function(e,i,r,n,a){return this.drawShape(new uC(e,i,r,n,a))},t.prototype.drawCircle=function(e,i,r){return this.drawShape(new oC(e,i,r))},t.prototype.drawEllipse=function(e,i,r,n){return this.drawShape(new hC(e,i,r,n))},t.prototype.drawPolygon=function(){for(var e=arguments,i=[],r=0;r<arguments.length;r++)i[r]=e[r];var n,a=!0,o=i[0];o.points?(a=o.closeStroke,n=o.points):Array.isArray(i[0])?n=i[0]:n=i;var h=new du(n);return h.closeStroke=a,this.drawShape(h),this},t.prototype.drawShape=function(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},t.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},t.prototype.isFastRect=function(){var e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===Le.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)},t.prototype._render=function(e){this.finishPoly();var i=this._geometry;i.updateBatches(),i.batchable?(this.batchDirty!==i.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))},t.prototype._populateBatches=function(){var e=this._geometry,i=this.blendMode,r=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(e.points);for(var n=0;n<r;n++){var a=e.batches[n],o=a.style.color,h=new Float32Array(this.vertexData.buffer,a.attribStart*4*2,a.attribSize*2),u=new Float32Array(e.uvsFloat32.buffer,a.attribStart*4*2,a.attribSize*2),c=new Uint16Array(e.indicesUint16.buffer,a.start*2,a.size),l={vertexData:h,blendMode:i,indices:c,uvs:u,_batchRGB:Gu(o),_tintRGB:o,_texture:a.style.texture,alpha:a.style.alpha,worldAlpha:1};this.batches[n]=l}},t.prototype._renderBatched=function(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var i=0,r=this.batches.length;i<r;i++){var n=this.batches[i];n.worldAlpha=this.worldAlpha*n.alpha,e.plugins[this.pluginName].render(n)}}},t.prototype._renderDirect=function(e){var i=this._resolveDirectShader(e),r=this._geometry,n=this.tint,a=this.worldAlpha,o=i.uniforms,h=r.drawCalls;o.translationMatrix=this.transform.worldTransform,o.tint[0]=(n>>16&255)/255*a,o.tint[1]=(n>>8&255)/255*a,o.tint[2]=(n&255)/255*a,o.tint[3]=a,e.shader.bind(i),e.geometry.bind(r,i),e.state.set(this.state);for(var u=0,c=h.length;u<c;u++)this._renderDrawCallDirect(e,r.drawCalls[u])},t.prototype._renderDrawCallDirect=function(e,i){for(var r=i.texArray,n=i.type,a=i.size,o=i.start,h=r.count,u=0;u<h;u++)e.texture.bind(r.elements[u],u);e.geometry.draw(n,a,o)},t.prototype._resolveDirectShader=function(e){var i=this.shader,r=this.pluginName;if(!i){if(!Y_[r]){for(var n=e.plugins[r].MAX_TEXTURES,a=new Int32Array(n),o=0;o<n;o++)a[o]=o;var h={tint:new Float32Array([1,1,1,1]),translationMatrix:new wt,default:An.from({uSamplers:a},!0)},u=e.plugins[r]._shader.program;Y_[r]=new vn(u,h)}i=Y_[r]}return i},t.prototype._calculateBounds=function(){this.finishPoly();var e=this._geometry;if(e.graphicsData.length){var i=e.bounds,r=i.minX,n=i.minY,a=i.maxX,o=i.maxY;this._bounds.addFrame(this.transform,r,n,a,o)}},t.prototype.containsPoint=function(e){return this.worldTransform.applyInverse(e,t._TEMP_POINT),this._geometry.containsPoint(t._TEMP_POINT)},t.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var e=Gu(this.tint,$D),i=0;i<this.batches.length;i++){var r=this.batches[i],n=r._batchRGB,a=e[0]*n[0]*255,o=e[1]*n[1]*255,h=e[2]*n[2]*255,u=(a<<16)+(o<<8)+(h|0);r._tintRGB=(u>>16)+(u&65280)+((u&255)<<16)}}},t.prototype.calculateVertices=function(){var e=this.transform._worldID;if(this._transformID!==e){this._transformID=e;for(var i=this.transform.worldTransform,r=i.a,n=i.b,a=i.c,o=i.d,h=i.tx,u=i.ty,c=this._geometry.points,l=this.vertexData,_=0,d=0;d<c.length;d+=2){var g=c[d],m=c[d+1];l[_++]=r*g+a*m+h,l[_++]=o*m+n*g+u}}},t.prototype.closePath=function(){var e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this},t.prototype.setMatrix=function(e){return this._matrix=e,this},t.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},t.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},t.prototype.destroy=function(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,s.prototype.destroy.call(this,e)},t.nextRoundedRectBehavior=!1,t._TEMP_POINT=new H,t}(pi);const ar=class{static hex2rgb(s,t=[]){return t[0]=(s>>16&255)/255,t[1]=(s>>8&255)/255,t[2]=(s&255)/255,t}static hex2rgba(s,t=[]){return t[0]=(s>>16&255)/255,t[1]=(s>>8&255)/255,t[2]=(s&255)/255,t[3]=s&255,t}static rgb2hex(s){return(s[0]*255<<16)+(s[1]*255<<8)+(s[2]*255|0)}static rgba2hex(s){return(s[0]*255<<16)+(s[1]*255<<8)+(s[2]*255|0)+(s[3]|0)}static rgbStringToHex(s){const t=s.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return"#"+ar.getHex(t[1])+ar.getHex(t[2])+ar.getHex(t[3])}static getHex(s){return isNaN(s)?"00":ar.HEX_DIGITS[(s-s%16)/16]+ar.HEX_DIGITS[s%16]}static int2rgb(s){s>>>=0;const t=s&255,e=(s&65280)>>>8;return"rgba("+[(s&16711680)>>>16,e,t,1].join(",")+")"}static rgbToHSL(s){const t=(s>>16&255)/255,e=(s>>8&255)/255,i=(s&255)/255,r=Math.max(t,e,i),n=Math.min(t,e,i),a=r-n;let o=0,h=0,u=0;a==0?o=0:r==t?e>i?o=60*(e-i)/a:o=60*(e-i)/a+360:r==e?o=60*(i-t)/a+120:r==i&&(o=60*(t-e)/a+240),h=.5*(r+n),a==0?u=0:h<=.5?u=a/h*.5:u=a/(1-h)*.5;const c=Math.round(o/360*255),l=Math.round(u*255),_=Math.round(h*255);return(c<<16)+(l<<8)+_}static hslToRGB(s){let t,e,i,r,n;const a=(s>>16&255)/255,o=(s>>8&255)/255,h=(s&255)/255;let u=0,c=0,l=0;o>0?(t=0,e=0,h<.5?t=h*(1+o):t=h+o-h*o,e=2*h-t,i=a+1/3,r=a,n=a-1/3,i<0?i=i+1:i>1&&i--,r<0?r=r+1:r>1&&r--,n<0?n=n+1:n>1&&n--,i*6<1?u=e+(t-e)*6*i:i*2<1?u=t:i*3<2?u=e+(t-e)*6*(2/3-i):u=e,r*6<1?c=e+(t-e)*6*r:r*2<1?c=t:r*3<2?c=e+(t-e)*6*(2/3-r):c=e,n*6<1?l=e+(t-e)*6*n:n*2<1?l=t:n*3<2?l=e+(t-e)*6*(2/3-n):l=e):(u=h,c=h,l=h);const _=Math.round(u*255),d=Math.round(c*255),g=Math.round(l*255);return(_<<16)+(d<<8)+g}static rgb2xyz(s){let t=(s>>16&255)/255,e=(s>>8&255)/255,i=(s>>0&255)/255;return t>.04045?t=Math.pow((t+.055)/1.055,2.4):t=t/12.92,e>.04045?e=Math.pow((e+.055)/1.055,2.4):e=e/12.92,i>.04045?i=Math.pow((i+.055)/1.055,2.4):i=i/12.92,t=t*100,e=e*100,i=i*100,new S(t*.4124+e*.3576+i*.1805,t*.2126+e*.7152+i*.0722,t*.0193+e*.1192+i*.9505)}static xyz2CieLab(s){let t=s.x/95.047,e=s.y/100,i=s.z/108.883;return t>.008856?t=Math.pow(t,1/3):t=7.787*t+16/116,e>.008856?e=Math.pow(e,1/3):e=7.787*e+16/116,i>.008856?i=Math.pow(i,1/3):i=7.787*i+16/116,new S(116*e-16,500*(t-e),200*(e-i))}static rgb2CieLab(s){return ar.xyz2CieLab(ar.rgb2xyz(s))}static colorize(s,t){if(t===4294967295)return s;let e=t>>16&255,i=t>>8&255,r=t&255;return e=(s>>16&255)*e/255,i=(s>>8&255)*i/255,r=(s&255)*r/255,(s&&4278190080)|e<<16|i<<8|r}};let Zu=ar;Zu.HEX_DIGITS=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];class np{constructor(t){t<0&&(t=0),this._reservedNumbers=[],this._freeNumbers=[];let e=0;for(;e<t;)this._freeNumbers.push(e),e++}dispose(){this._reservedNumbers=null,this._freeNumbers=null}reserveNumber(){if(this._freeNumbers.length>0){const t=this._freeNumbers.pop();return this._reservedNumbers.push(t),t}return-1}freeNumber(t){const e=this._reservedNumbers.indexOf(t);e>=0&&(this._reservedNumbers.splice(e,1),this._freeNumbers.push(t))}}class tL{static getFlipHBitmapData(t){if(!t)return null;const e=qt.createRenderTexture(t.width,t.height),i=new wt;return i.scale(-1,1),i.translate(t.width,0),Ae.instance.renderer.render(new Wt(t),{renderTexture:e,clear:!0,transform:i}),e}static getFlipVBitmapData(t){if(!t)return null;const e=new wt;e.scale(1,-1),e.translate(0,t.height);const i=new Na;return i.beginTextureFill({texture:t,matrix:e}).drawRect(0,0,t.width,t.height).endFill(),qt.generateTexture(i)}static getFlipHVBitmapData(t){if(!t)return null;const e=new wt;e.scale(-1,-1),e.translate(t.width,t.height);const i=new Na;return i.beginTextureFill({texture:t,matrix:e}).drawRect(0,0,t.width,t.height).endFill(),qt.generateTexture(i)}}const Ct=class{static init(s,t){Ct._currentDelta=0,Ct._startDelayMs=s,Ct._effectDurationMs=t,Ct._initializationTimeMs=_t(),Ct._state=Ct.STATE_START_DELAY}static turnVisualizationOn(){if(Ct._state===Ct.STATE_NOT_INITIALIZED||Ct._state===Ct.STATE_OVER)return;const s=_t()-Ct._initializationTimeMs;if(s>Ct._startDelayMs+Ct._effectDurationMs){Ct._state=Ct.STATE_OVER;return}if(Ct._visualizationOn=!0,s<Ct._startDelayMs){Ct._state=Ct.STATE_START_DELAY;return}Ct._state=Ct.STATE_RUNNING,Ct._currentDelta=(s-Ct._startDelayMs)/Ct._effectDurationMs}static turnVisualizationOff(){Ct._visualizationOn=!1}static isVisualizationOn(){return Ct._visualizationOn&&Ct.isRunning()}static isRunning(){return Ct._state===Ct.STATE_START_DELAY||Ct._state===Ct.STATE_RUNNING}static getDelta(s=0,t=1){return Math.min(Math.max(Ct._currentDelta,s),t)}static get totalRunningTime(){return Ct._startDelayMs+Ct._effectDurationMs}};let Ue=Ct;Ue.STATE_NOT_INITIALIZED=0;Ue.STATE_START_DELAY=1;Ue.STATE_RUNNING=2;Ue.STATE_OVER=3;Ue._state=Ct.STATE_NOT_INITIALIZED;Ue._visualizationOn=!1;Ue._currentDelta=0;Ue._initializationTimeMs=0;Ue._startDelayMs=20*1e3;Ue._effectDurationMs=2e3;const nn=class{constructor(s,t,e,i=null){this._updateId=0,this._scale=1,this._x_scale=1,this._y_scale=1,this._z_scale=1,this._x_scale_internal=1,this._y_scale_internal=1,this._z_scale_internal=1,this._clipNear=-500,this._clipFar=500,this._displacements=null,this.scale=s,this._x=new S,this._y=new S,this._z=new S,this._directionAxis=new S,this._location=new S,this._direction=new S,this._depth=new S,this._x_scale_internal=1,this._y_scale_internal=1,this.x_scale=1,this.y_scale=1,this._z_scale_internal=Math.sqrt(1/2)/Math.sqrt(3/4),this.z_scale=1,this.location=new S(e.x,e.y,e.z),this.direction=new S(t.x,t.y,t.z),i!=null?this.setDepthVector(i):this.setDepthVector(t),this._displacements=new Map}static getIntersectionVector(s,t,e,i){const r=S.dotProduct(t,i);if(Math.abs(r)<1e-5)return null;const n=S.dif(s,e),a=-S.dotProduct(i,n)/r;return S.sum(s,S.product(t,a))}get updateId(){return this._updateId}get scale(){return this._scale/Math.sqrt(.5)}set scale(s){s<=1&&(s=1),s=s*Math.sqrt(.5),s!=this._scale&&(this._scale=s,this._updateId++)}get directionAxis(){return this._directionAxis}get location(){return this._location.assign(this._loc),this._location.x=this._location.x*this._x_scale,this._location.y=this._location.y*this._y_scale,this._location.z=this._location.z*this._z_scale,this._location}set location(s){if(s==null)return;this._loc==null&&(this._loc=new S);const t=this._loc.x,e=this._loc.y,i=this._loc.z;this._loc.assign(s),this._loc.x=this._loc.x/this._x_scale,this._loc.y=this._loc.y/this._y_scale,this._loc.z=this._loc.z/this._z_scale,(this._loc.x!=t||this._loc.y!=e||this._loc.z!=i)&&this._updateId++}get direction(){return this._direction}set direction(s){let t,e,i,r,n;if(s==null)return;this._dir==null&&(this._dir=new S);const a=this._dir.x,o=this._dir.y,h=this._dir.z;this._dir.assign(s),this._direction.assign(s),(this._dir.x!=a||this._dir.y!=o||this._dir.z!=h)&&this._updateId++;const u=new S(0,1,0),c=new S(0,0,1),l=new S(1,0,0),_=s.x/180*Math.PI,d=s.y/180*Math.PI,g=s.z/180*Math.PI,m=Math.cos(_),p=Math.sin(_),T=S.sum(S.product(u,m),S.product(l,-p)),A=new S(c.x,c.y,c.z),O=S.sum(S.product(u,p),S.product(l,m)),v=Math.cos(d),y=Math.sin(d),C=new S(T.x,T.y,T.z),N=S.sum(S.product(A,v),S.product(O,y)),L=S.sum(S.product(A,-y),S.product(O,v));g!=0?(t=Math.cos(g),e=Math.sin(g),i=S.sum(S.product(C,t),S.product(N,e)),r=S.sum(S.product(C,-e),S.product(N,t)),n=new S(L.x,L.y,L.z),this._x.assign(i),this._y.assign(r),this._z.assign(n),this._directionAxis.assign(this._z)):(this._x.assign(C),this._y.assign(N),this._z.assign(L),this._directionAxis.assign(this._z))}set x_scale(s){this._x_scale!=s*this._x_scale_internal&&(this._x_scale=s*this._x_scale_internal,this._updateId++)}set y_scale(s){this._y_scale!=s*this._y_scale_internal&&(this._y_scale=s*this._y_scale_internal,this._updateId++)}set z_scale(s){this._z_scale!=s*this._z_scale_internal&&(this._z_scale=s*this._z_scale_internal,this._updateId++)}dispose(){this._x=null,this._y=null,this._z=null,this._loc=null,this._dir=null,this._directionAxis=null,this._location=null,this._displacements!=null&&(this._displacements.clear(),this._displacements=null)}setDisplacement(s,t){let e,i;s==null||t==null||this._displacements!=null&&(e=Math.trunc(Math.round(s.x))+"_"+Math.trunc(Math.round(s.y))+"_"+Math.trunc(Math.round(s.z)),this._displacements.delete(e),i=new S,i.assign(t),this._displacements.set(e,i),this._updateId++)}getDisplacenent(s){let t;return this._displacements!=null?(t=Math.trunc(Math.round(s.x))+"_"+Math.trunc(Math.round(s.y))+"_"+Math.trunc(Math.round(s.z)),this._displacements.get(t)):null}setDepthVector(s){let t,e,i;const r=new S(0,1,0),n=new S(0,0,1),a=new S(1,0,0),o=s.x/180*Math.PI,h=s.y/180*Math.PI,u=s.z/180*Math.PI,c=Math.cos(o),l=Math.sin(o),_=S.sum(S.product(r,c),S.product(a,-l)),d=new S(n.x,n.y,n.z),g=S.sum(S.product(r,l),S.product(a,c)),m=Math.cos(h),p=Math.sin(h),T=new S(_.x,_.y,_.z),A=S.sum(S.product(d,m),S.product(g,p)),O=S.sum(S.product(d,-p),S.product(g,m));u!=0?(t=Math.cos(u),e=Math.sin(u),S.sum(S.product(T,t),S.product(A,e)),S.sum(S.product(T,-e),S.product(A,t)),i=new S(O.x,O.y,O.z),this._depth.assign(i)):this._depth.assign(O),this._updateId++}adjustLocation(s,t){if(s==null||this._z==null)return;const e=S.product(this._z,-t),i=new S(s.x+e.x,s.y+e.y,s.z+e.z);this.location=i}getCoordinatePosition(s){if(s==null)return null;const t=S.scalarProjection(s,this._x),e=S.scalarProjection(s,this._y),i=S.scalarProjection(s,this._z);return new S(t,e,i)}getScreenPosition(s){let t=S.dif(s,this._loc);t.x=t.x*this._x_scale,t.y=t.y*this._y_scale,t.z=t.z*this._z_scale;let e=S.scalarProjection(t,this._depth);if(e<this._clipNear||e>this._clipFar)return null;let i=S.scalarProjection(t,this._x),r=-S.scalarProjection(t,this._y);i=i*this._scale,r=r*this._scale;const n=this.getDisplacenent(s);return n!=null&&(t=S.dif(s,this._loc),t.add(n),t.x=t.x*this._x_scale,t.y=t.y*this._y_scale,t.z=t.z*this._z_scale,e=S.scalarProjection(t,this._depth)),t.x=i,t.y=r,t.z=e,t}getScreenPoint(s){const t=this.getScreenPosition(s);return t==null?null:new H(t.x,t.y)}getPlanePosition(s,t,e,i){let r,n;const a=s.x/this._scale,o=-s.y/this._scale,h=S.product(this._x,a);h.add(S.product(this._y,o));const u=new S(this._loc.x*this._x_scale,this._loc.y*this._y_scale,this._loc.z*this._z_scale);u.add(h);const c=this._z,l=new S(t.x*this._x_scale,t.y*this._y_scale,t.z*this._z_scale),_=new S(e.x*this._x_scale,e.y*this._y_scale,e.z*this._z_scale),d=new S(i.x*this._x_scale,i.y*this._y_scale,i.z*this._z_scale),g=S.crossProduct(_,d),m=new S;return m.assign(nn.getIntersectionVector(u,c,l,g)),m!=null?(m.subtract(l),r=S.scalarProjection(m,e)/_.length*e.length,n=S.scalarProjection(m,i)/d.length*i.length,new H(r,n)):null}performZoom(){this.isZoomedIn()?this.scale=nn.SCALE_ZOOMED_OUT:this.scale=nn.SCALE_ZOOMED_IN}isZoomedIn(){return this.scale==nn.SCALE_ZOOMED_IN}performZoomOut(){this.scale=nn.SCALE_ZOOMED_OUT}performZoomIn(){this.scale=nn.SCALE_ZOOMED_IN}};let bn=nn;bn.SCALE_ZOOMED_IN=64;bn.SCALE_ZOOMED_OUT=32;const Zc=class{static makeRoomPreviewerId(s){return(s&65535)+Zc.PREVIEW_ROOM_ID_BASE}static isRoomPreviewerId(s){return s>=Zc.PREVIEW_ROOM_ID_BASE}};let bf=Zc;bf.PREVIEW_ROOM_ID_BASE=2147418112;class Xs{static init(t,e){this._SafeStr_4513=0,this._SafeStr_4515=t,this._SafeStr_4516=e,this._SafeStr_4514=_t(),this._SafeStr_448=1}static turnVisualizationOn(){if(this._SafeStr_448===0||this._SafeStr_448===3)return;this._SafeStr_4524||(this._SafeStr_4524=setTimeout(()=>this.turnVisualizationOff(),this._SafeStr_4516));const t=_t()-this._SafeStr_4514;if(t>this._SafeStr_4515+this._SafeStr_4516){this._SafeStr_448=3;return}if(this._SafeStr_4512=!0,t<this._SafeStr_4515){this._SafeStr_448=1;return}this._SafeStr_448=2,this._SafeStr_4513=(t-this._SafeStr_4515)/this._SafeStr_4516}static turnVisualizationOff(){this._SafeStr_4512=!1,clearTimeout(this._SafeStr_4524),this._SafeStr_4524=null}static isVisualizationOn(){return this._SafeStr_4512&&this.isRunning()}static isRunning(){return this._SafeStr_448===1||this._SafeStr_448===2}}Xs.STATE_NOT_INITIALIZED=0;Xs.STATE_START_DELAY=1;Xs.STATE_RUNNING=2;Xs.STATE_OVER=3;Xs._SafeStr_448=0;Xs._SafeStr_4512=!1;Xs._SafeStr_4513=0;Xs._SafeStr_4514=0;Xs._SafeStr_4515=2e4;Xs._SafeStr_4516=5e3;class js{static init(t,e){this._SafeStr_4513=0,this._SafeStr_4515=t,this._SafeStr_4516=e,this._SafeStr_4514=_t(),this._SafeStr_448=1}static turnVisualizationOn(){if(this._SafeStr_448===0||this._SafeStr_448===3)return;this._SafeStr_4524||(this._SafeStr_4524=setTimeout(()=>this.turnVisualizationOff(),this._SafeStr_4516));const t=_t()-this._SafeStr_4514;if(t>this._SafeStr_4515+this._SafeStr_4516){this._SafeStr_448=3;return}if(this._SafeStr_4512=!0,t<this._SafeStr_4515){this._SafeStr_448=1;return}this._SafeStr_448=2,this._SafeStr_4513=(t-this._SafeStr_4515)/this._SafeStr_4516}static turnVisualizationOff(){this._SafeStr_4512=!1,clearTimeout(this._SafeStr_4524),this._SafeStr_4524=null}static isVisualizationOn(){return this._SafeStr_4512&&this.isRunning()}static isRunning(){return this._SafeStr_448===1||this._SafeStr_448===2}}js.STATE_NOT_INITIALIZED=0;js.STATE_START_DELAY=1;js.STATE_RUNNING=2;js.STATE_OVER=3;js._SafeStr_448=0;js._SafeStr_4512=!1;js._SafeStr_4514=0;js._SafeStr_4515=2e4;js._SafeStr_4516=5e3;class eL{static hex2int(t){return parseInt(t,16)}static inkToBlendMode(t){return t=="ADD"||t==33?J.ADD:t=="SUBTRACT"?J.SUBTRACT:t=="DARKEN"?J.DARKEN:J.NORMAL}}class Qu extends Wt{constructor(t=null){super(t),this._offsetX=0,this._offsetY=0,this._tag="",this._alphaTolerance=128,this._varyingDepth=!1,this._clickHandling=!1,this._pairedSpriteId=-1,this._pairedSpriteUpdateCounter=-1}needsUpdate(t,e){return this._pairedSpriteId===t&&this._pairedSpriteUpdateCounter===e?!1:(this._pairedSpriteId=t,this._pairedSpriteUpdateCounter=e,!0)}calculateVertices(){this.texture.orig&&super.calculateVertices()}setTexture(t){t||(t=ut.EMPTY),t!==this.texture&&(t===ut.EMPTY&&(this._pairedSpriteId=-1,this._pairedSpriteUpdateCounter=-1),this.texture=t)}containsPoint(t){return Qu.containsPoint(this,t)}static containsPoint(t,e){if(!t||!e||t.alphaTolerance>255||!(t instanceof Wt))return!1;if(t.texture===ut.EMPTY||t.blendMode!==J.NORMAL)return;const i=t.texture,r=i.baseTexture;if(!i||!r||!r.valid)return!1;const n=e.x*t.scale.x,a=e.y*t.scale.y;if(!t.getLocalBounds().contains(n,a)||!r.hitMap&&!Qu.generateHitMap(r))return!1;const o=r.hitMap;let h=n+i.frame.x,u=a+i.frame.y;i.trim&&(h-=i.trim.x,u-=i.trim.y),h=Math.round(h)*r.resolution,u=Math.round(u)*r.resolution;const c=h+u*r.realWidth,l=c%32,_=c/32|0;return(o[_]&1<<l)!==0}static generateHitMap(t){if(!t)return!1;const e=new ut(t),i=new Wt(e),r=qt.getPixels(i),n=t.width,a=t.height,o=new Uint32Array(Math.ceil(n*a/32)),h=Ms.MATCH_OPAQUE_PIXELS;for(let u=0;u<n*a;u++){const c=u%32,l=u/32|0;r[u*4+3]>=h&&(o[l]=o[l]|1<<c)}return t.hitMap=o,i.destroy(),e.destroy(),!0}get offsetX(){return this._offsetX}set offsetX(t){this._offsetX=t}get offsetY(){return this._offsetY}set offsetY(t){this._offsetY=t}get tag(){return this._tag}set tag(t){this._tag=t}get alphaTolerance(){return this._alphaTolerance}set alphaTolerance(t){this._alphaTolerance=t}get varyingDepth(){return this._varyingDepth}set varyingDepth(t){this._varyingDepth=t}get clickHandling(){return this._clickHandling}set clickHandling(t){this._clickHandling=t}}class sL{constructor(){this._objectId="",this._spriteTag=""}get objectId(){return this._objectId}set objectId(t){this._objectId=t}get spriteTag(){return this._spriteTag}set spriteTag(t){this._spriteTag=t}}const sT=class{constructor(){this._name="",this._sprite=null,this._x=0,this._y=0,this._z=0}dispose(){this._z=-sT.Z_INFINITY,this._sprite=null}get name(){return this._name}set name(s){this._name=s}get sprite(){return this._sprite}set sprite(s){this._sprite=s}get x(){return this._x}set x(s){this._x=s}get y(){return this._y}set y(s){this._y=s}get z(){return this._z}set z(s){this._z=s}};let iT=sT;iT.Z_INFINITY=1e8;class iL{constructor(t,e,i,r,n){this._SafeStr_4507=!1,this._rotation=0,this._rotationOrigin=null,this._rotationRodLength=0,this._SafeStr_795=0,this._id=e,this._container=t,this._geometry=new bn(n,new S(-135,30,0),new S(11,11,5),new S(-135,.5,0)),this._animationFPS=K.instance.getConfiguration("system.fps.animation",24),this._renderTimestamp=0,this._totalTimeRunning=0,this._lastFrame=0,this._master=null,this._display=null,this._mask=null,this._sortableSprites=[],this._spriteCount=0,this._activeSpriteCount=0,this._spritePool=[],this._skipObjectUpdate=!1,this._runningSlow=!1,this._width=0,this._height=0,this._renderedWidth=0,this._renderedHeight=0,this._screenOffsetX=0,this._screenOffsetY=0,this._mouseLocation=new H,this._mouseOldX=0,this._mouseOldY=0,this._mouseCheckCount=0,this._mouseSpriteWasHit=!1,this._mouseActiveObjects=new Map,this._eventCache=new Map,this._eventId=0,this._scale=1,this._restrictsScaling=!1,this._noSpriteVisibilityChecking=!1,this._usesExclusionRectangles=!1,this._usesMask=!0,this._canvasUpdated=!1,this._objectCache=new $I(this._container.roomObjectVariableAccurateZ),this._mouseListener=null,this.setupCanvas(),this.initialize(i,r)}setupCanvas(){if(this._master||(this._master=new se,this._master.interactiveChildren=!1),!this._display){const t=new Hs;this._master.addChild(t),this._display=t}}dispose(){if(this.cleanSprites(0,!0),this._geometry&&(this._geometry.dispose(),this._geometry=null),this._mask&&(this._mask=null),this._objectCache&&(this._objectCache.dispose(),this._objectCache=null),this._master){for(;this._master.children.length;)this._master.removeChildAt(0).destroy();this._master.parent&&this._master.parent.removeChild(this._master),this._master.destroy(),this._master=null}if(this._display=null,this._sortableSprites=[],this._mouseActiveObjects&&(this._mouseActiveObjects.clear(),this._mouseActiveObjects=null),this._spritePool){for(const t of this._spritePool)this.cleanSprite(t,!0);this._spritePool=[]}this._eventCache&&(this._eventCache.clear(),this._eventCache=null),this._mouseListener=null}initialize(t,e){if(t=t<1?1:t,e=e<1?1:e,this._usesMask&&(this._mask?this._mask.clear().beginFill(16711680).drawRect(0,0,t,e).endFill():(this._mask=new Na().beginFill(16711680).drawRect(0,0,t,e).endFill(),this._master&&(this._master.addChild(this._mask),this._display&&(this._display.mask=this._mask)))),this._master){if(this._master.hitArea){const i=this._master.hitArea;i.width=t,i.height=e}else this._master.hitArea=new et(0,0,t,e);if(this._master.filterArea){const i=this._master.filterArea;i.width=t,i.height=e}else this._master.filterArea=new et(0,0,t,e)}this._width=t,this._height=e}setMask(t){t&&!this._usesMask?(this._usesMask=!0,this._mask&&this._mask.parent!==this._master&&(this._master.addChild(this._mask),this._display.mask=this._mask)):!t&&this._usesMask&&(this._usesMask=!1,this._mask&&this._mask.parent===this._master&&(this._master.removeChild(this._mask),this._display.mask=null))}setScale(t,e=null,i=null,r=!1,n=!1){!this._master||!this._display||this._restrictsScaling&&!r||(e||(e=new H(this._width/2,this._height/2)),i||(i=e),e=this._display.toLocal(e),n?this._scale*=t:this._scale=t,this.screenOffsetX=i.x-e.x*this._scale,this.screenOffsetY=i.y-e.y*this._scale)}render(t,e=!1){if(this._canvasUpdated=!1,this._totalTimeRunning+=Bi().deltaTime,this._totalTimeRunning===this._renderTimestamp||(t===-1&&(t=this._renderTimestamp+1),!this._container||!this._geometry))return;(this._width!==this._renderedWidth||this._height!==this._renderedHeight)&&(e=!0),(this._display.x!==this._screenOffsetX||this._display.y!==this._screenOffsetY)&&(this._display.position.set(this._screenOffsetX,this._screenOffsetY),e=!0),this._display.scale.x!==this._scale&&(this._display.scale.set(this._scale),e=!0),this.doMagic();const i=Math.round(this._totalTimeRunning/(60/this._animationFPS));let r=!1;i!==this._lastFrame&&(this._lastFrame=i,r=!0);let n=0;const a=this._container.objects;if(a.size)for(const h of a.values())h&&(n=n+this.renderObject(h,h.instanceId.toString(),t,e,r,n));this._sortableSprites.sort((h,u)=>u.z-h.z),n<this._sortableSprites.length&&this._sortableSprites.splice(n);let o=0;for(;o<n;){const h=this._sortableSprites[o];h&&h.sprite&&this.renderSprite(o,h),o++}this.cleanSprites(n),(e||r)&&(this._canvasUpdated=!0),this._renderTimestamp=this._totalTimeRunning,this._renderedWidth=this._width,this._renderedHeight=this._height}skipSpriteVisibilityChecking(){this._noSpriteVisibilityChecking=!0,this.render(-1,!0)}resumeSpriteVisibilityChecking(){this._noSpriteVisibilityChecking=!1}getSortableSpriteList(){return this._objectCache.getSortableSpriteList()}getPlaneSortableSprites(){return this._objectCache.getPlaneSortableSprites()}removeFromCache(t){this._objectCache.removeObjectCache(t)}renderObject(t,e,i,r,n,a){if(!t)return 0;const o=t.visualization;if(!o)return this.removeFromCache(e),0;const h=this.getCacheItem(e);h.objectId=t.instanceId;const u=h.location,c=h.sprites,l=u.updateLocation(t,this._geometry);if(!l)return this.removeFromCache(e),0;if(n&&o.update(this._geometry,i,!c.isEmpty||r,this._skipObjectUpdate&&this._runningSlow),u.locationChanged&&(r=!0),!c.needsUpdate(o.instanceId,o.updateSpriteCounter)&&!r)return c.spriteCount;let _=l.x,d=l.y,g=l.z;_>0?g=g+_*12e-8:g=g+-_*12e-8,_=_+Math.trunc(this._width/2),d=d+Math.trunc(this._height/2);let m=0;for(const p of o.sprites.values()){if(!p||!p.visible)continue;const T=p.texture,A=T&&T.baseTexture;if(!T||!A)continue;const O=_+p.offsetX+this._screenOffsetX,v=d+p.offsetY+this._screenOffsetY;if(p.flipH){const C=_+-(T.width+-p.offsetX)+this._screenOffsetX;if(!this.isSpriteVisible(C,v,T.width,T.height))continue}else if(p.flipV){const C=d+-(T.height+-p.offsetY)+this._screenOffsetY;if(!this.isSpriteVisible(O,C,T.width,T.height))continue}else if(!this.isSpriteVisible(O,v,T.width,T.height))continue;let y=c.getSprite(m);y||(y=new iT,c.addSprite(y),this._sortableSprites.push(y),y.name=e),y.sprite=p,(p.spriteType===es.AVATAR||p.spriteType===es.AVATAR_OWN)&&(y.sprite.libraryAssetName="avatar_"+t.id),y.x=O-this._screenOffsetX,y.y=v-this._screenOffsetY,y.z=g+p.relativeDepth+37e-12*a,m++,a++}return c.setSpriteCount(m),this._canvasUpdated=!0,m}getExtendedSprite(t){if(t<0||t>=this._spriteCount)return null;const e=this._display.getChildAt(t);return e||null}getExtendedSpriteIdentifier(t){return t?t.name:""}renderSprite(t,e){if(t>=this._spriteCount)return this.createAndAddSprite(e),!0;if(!e)return!1;const i=e.sprite,r=this.getExtendedSprite(t);if(!i||!r)return!1;if(r.varyingDepth!==i.varyingDepth)return r.varyingDepth&&!i.varyingDepth?(this._display.removeChildAt(t),this._spritePool.push(r),this.renderSprite(t,e)):(this.createAndAddSprite(e,t),!0);if(r.needsUpdate(i.id,i.updateCounter)||Ue.isVisualizationOn()){r.tag=i.tag,r.alphaTolerance=i.alphaTolerance,r.name=e.name,r.varyingDepth=i.varyingDepth,r.clickHandling=i.clickHandling,r.filters=i.filters;const n=i.alpha/255;r.alpha!==n&&(r.alpha=n),r.tint!==i.color&&(r.tint=i.color),r.blendMode!==i.blendMode&&(r.blendMode=i.blendMode),r.texture!==i.texture&&r.setTexture(i.texture),i.updateContainer&&(r.children.length===1&&r.removeChildAt(0),r.addChild(i.container),i.updateContainer=!1),i.flipH?r.scale.x!==-1&&(r.scale.x=-1):r.scale.x!==1&&(r.scale.x=1),i.flipV?r.scale.y!==-1&&(r.scale.y=-1):r.scale.y!==1&&(r.scale.y=1),this.updateEnterRoomEffect(r,i)}return r.x!==e.x&&(r.x=e.x),r.y!==e.y&&(r.y=e.y),r.offsetX=i.offsetX,r.offsetY=i.offsetY,!0}createAndAddSprite(t,e=-1){const i=t.sprite;if(!i)return;let r=null;this._spritePool.length>0&&(r=this._spritePool.pop()),r||(r=new Qu),r.children.length&&r.removeChildren(),r.tag=i.tag,r.alphaTolerance=i.alphaTolerance,r.alpha=i.alpha/255,r.tint=i.color,r.x=t.x,r.y=t.y,r.offsetX=i.offsetX,r.offsetY=i.offsetY,r.name=i.name,r.varyingDepth=i.varyingDepth,r.clickHandling=i.clickHandling,r.blendMode=i.blendMode,r.filters=i.filters,r.setTexture(i.texture),i.updateContainer&&(r.addChild(i.container),i.updateContainer=!1),i.flipH&&(r.scale.x=-1),i.flipV&&(r.scale.y=-1),this.updateEnterRoomEffect(r,i),e<0||e>=this._spriteCount?(this._display.addChild(r),this._spriteCount++):this._display.addChildAt(r,e),this._activeSpriteCount++}cleanSprites(t,e=!1){if(this._display){if(t<0&&(t=0),t<this._activeSpriteCount||!this._activeSpriteCount){let i=this._spriteCount-1;for(;i>=t;)this.cleanSprite(this.getExtendedSprite(i),e),i--}this._activeSpriteCount=t}}updateEnterRoomEffect(t,e){if(!(!Ue.isVisualizationOn()||!e))switch(e.spriteType){case es.AVATAR_OWN:return;case es.ROOM_PLANE:t.alpha=Ue.getDelta(.9);return;case es.AVATAR:t.alpha=Ue.getDelta(.5);return;default:t.alpha=Ue.getDelta(.1)}}cleanSprite(t,e){t&&(e?(t.parent&&t.parent.removeChild(t),t.destroy({children:!0})):t.setTexture(null))}update(){this._mouseCheckCount,this._mouseCheckCount=0,this._eventId++}setMouseListener(t){this._mouseListener=t}getCacheItem(t){return this._objectCache.getObjectCache(t)}isSpriteVisible(t,e,i,r){return!!(this._noSpriteVisibilityChecking||(t=(t-this._screenOffsetX)*this._scale+this._screenOffsetX,e=(e-this._screenOffsetY)*this._scale+this._screenOffsetY,i=i*this._scale,r=r*this._scale,t<this._width&&t+i>=0&&e<this._height&&e+r>=0&&!this._usesExclusionRectangles))}handleMouseEvent(t,e,i,r,n,a,o){return t=t-this._screenOffsetX,e=e-this._screenOffsetY,this._mouseLocation.x=t/this._scale,this._mouseLocation.y=e/this._scale,this._mouseCheckCount>0&&i==k.MOUSE_MOVE?this._mouseSpriteWasHit:(this._mouseSpriteWasHit=this.checkMouseHits(Math.trunc(t/this._scale),Math.trunc(e/this._scale),i,r,n,a,o),this._mouseCheckCount++,this._mouseSpriteWasHit)}checkMouseHits(t,e,i,r=!1,n=!1,a=!1,o=!1){const h=[];let u=!1,c=null,l=this._activeSpriteCount-1;for(;l>=0;){const g=this.getExtendedSprite(l);if(g&&g.containsPoint(new H(t-g.x,e-g.y))&&!(g.clickHandling&&(i===k.MOUSE_CLICK||i===k.DOUBLE_CLICK))){const m=this.getExtendedSpriteIdentifier(g);if(h.indexOf(m)===-1){const p=g.tag;let T=this._mouseActiveObjects.get(m);T&&T.spriteTag!==p&&(c=this.createMouseEvent(0,0,0,0,k.ROLL_OUT,T.spriteTag,r,n,a,o),this.bufferMouseEvent(c,m)),i===k.MOUSE_MOVE&&(!T||T.spriteTag!==p)?c=this.createMouseEvent(t,e,t-g.x,e-g.y,k.ROLL_OVER,p,r,n,a,o):(c=this.createMouseEvent(t,e,t-g.x,e-g.y,i,p,r,n,a,o),c.spriteOffsetX=g.offsetX,c.spriteOffsetY=g.offsetY),T||(T=new sL,T.objectId=m,this._mouseActiveObjects.set(m,T)),T.spriteTag=p,(i!==k.MOUSE_MOVE||t!==this._mouseOldX||e!==this._mouseOldY)&&this.bufferMouseEvent(c,m),h.push(m)}u=!0}l--}const _=[];for(const g of this._mouseActiveObjects.keys())g&&_.push(g);let d=0;for(;d<_.length;){const g=_[d];h.indexOf(g)>=0&&(_[d]=null),d++}for(d=0;d<_.length;){const g=_[d];if(g!==null){const m=this._mouseActiveObjects.get(g);m&&this._mouseActiveObjects.delete(g);const p=this.createMouseEvent(0,0,0,0,k.ROLL_OUT,m.spriteTag,r,n,a,o);this.bufferMouseEvent(p,g)}d++}return this.processMouseEvents(),this._mouseOldX=t,this._mouseOldY=e,u}createMouseEvent(t,e,i,r,n,a,o,h,u,c){const l=t-this._width/2,_=e-this._height/2,d=`canvas_${this._id}`;return new aD(n,d+"_"+this._eventId,d,a,l,_,i,r,h,o,u,c)}bufferMouseEvent(t,e){!t||!this._eventCache||(this._eventCache.delete(e),this._eventCache.set(e,t))}processMouseEvents(){if(!(!this._container||!this._eventCache)){for(const[t,e]of this._eventCache.entries()){if(!this._eventCache)return;if(!e)continue;const i=this._container.getRoomObject(parseInt(t));if(i)if(this._mouseListener)this._mouseListener.processRoomCanvasMouseEvent(e,i,this._geometry);else{const r=i.mouseHandler;r&&r.mouseEvent(e,this._geometry)}}this._eventCache&&this._eventCache.clear()}}getDisplayAsTexture(){this._noSpriteVisibilityChecking=!0;const t=this._scale,e=this._screenOffsetX,i=this._screenOffsetY;this.setScale(1,null,null,!0),this._screenOffsetX=0,this._screenOffsetY=0,this.render(-1,!0),this._display.mask=null;const r=this._display.getBounds(),n=xe.create({width:this._display.width,height:this._display.height});return Ae.instance.renderer.render(this._display,{renderTexture:n,clear:!0,transform:new wt(1,0,0,1,-r.x,-r.y)}),this._display.mask=this._mask,this._noSpriteVisibilityChecking=!1,this.setScale(t,null,null,!0),this._screenOffsetX=e,this._screenOffsetY=i,n}doMagic(){const t=this.geometry;if(this._rotation!==0){let e=this._effectDirection;t.direction=new S(e.x+this._rotation,e.y,e.z),e=t.direction,t.setDepthVector(new S(e.x,e.y,5));const i=new S;i.assign(this._rotationOrigin),i.x=i.x+this._rotationRodLength*Math.cos((e.x+180)/180*3.14159265358979)*Math.cos(e.y/180*3.14159265358979),i.y=i.y+this._rotationRodLength*Math.sin((e.x+180)/180*3.14159265358979)*Math.cos(e.y/180*3.14159265358979),i.z=i.z+this._rotationRodLength*Math.sin(e.y/180*3.14159265358979),t.location=i,this._effectLocation=new S,this._effectLocation.assign(i),this._effectDirection=new S,this._effectDirection.assign(t.direction)}if(js.isVisualizationOn()&&!this._SafeStr_4507?this.changeShaking():!js.isVisualizationOn()&&this._SafeStr_4507&&this.changeShaking(),Xs.isVisualizationOn()&&this.changeRotation(),this._SafeStr_4507){this._SafeStr_795++;const e=this._effectDirection,i=S.sum(e,new S(Math.sin(this._SafeStr_795*5/180*3.14159265358979)*2,Math.sin(this._SafeStr_795/180*3.14159265358979)*5,Math.sin(this._SafeStr_795*10/180*3.14159265358979)*2));t.direction=i}else this._SafeStr_795=0,t.direction=this._effectDirection}changeShaking(){if(this._SafeStr_4507=!this._SafeStr_4507,this._SafeStr_4507){const t=this.geometry.direction;this._effectDirection=new S(t.x,t.y,t.z)}}changeRotation(){if(this._SafeStr_4507)return;const t=this.geometry;if(t){if(this._rotation===0){const e=t.location,i=t.directionAxis;this._effectLocation=new S,this._effectLocation.assign(e),this._effectDirection=new S,this._effectDirection.assign(t.direction);const r=bn.getIntersectionVector(e,i,new S(0,0,0),new S(0,0,1));r!==null&&(this._rotationOrigin=new S(r.x,r.y,r.z),this._rotationRodLength=S.dif(r,e).length,this._rotation=1);return}this._rotation=0,t.location=this._effectLocation,t.direction=this._effectDirection,t.setDepthVector(new S(this._effectDirection.x,this._effectDirection.y,5))}}moveLeft(){if(this._rotation!==0){this._rotation===1?this._rotation=-1:this._rotation=this._rotation-1;return}const t=this.geometry,e=(t.direction.x-90)/180*3.14159265358979;t.location=S.sum(t.location,new S(Math.cos(e)*Math.sqrt(2),Math.sin(e)*Math.sqrt(2)))}moveRight(){if(this._rotation!==0){this._rotation===-1?this._rotation=1:this._rotation=this._rotation+1;return}const t=this.geometry,e=(t.direction.x+90)/180*3.14159265358979;t.location=S.sum(t.location,new S(Math.cos(e)*Math.sqrt(2),Math.sin(e)*Math.sqrt(2)))}moveUp(){if(this._rotation!==0)return;const t=this.geometry,e=t.direction.x/180*3.14159265358979;t.location=S.sum(t.location,new S(Math.cos(e)*Math.sqrt(2),Math.sin(e)*Math.sqrt(2)))}moveDown(){if(this._rotation!==0)return;const t=this.geometry,e=(t.direction.x+180)/180*3.14159265358979;t.location=S.sum(t.location,new S(Math.cos(e)*Math.sqrt(2),Math.sin(e)*Math.sqrt(2)))}get id(){return this._id}get geometry(){return this._geometry}get master(){return this._master}get display(){return this._display}get screenOffsetX(){return this._screenOffsetX}set screenOffsetX(t){t=Math.trunc(t),this._mouseLocation.x=this._mouseLocation.x-(t-this._screenOffsetX),this._screenOffsetX=t}get screenOffsetY(){return this._screenOffsetY}set screenOffsetY(t){t=Math.trunc(t),this._mouseLocation.y=this._mouseLocation.y-(t-this._screenOffsetY),this._screenOffsetY=t}get scale(){return this._scale}get width(){return this._width*this._scale}get height(){return this._height*this._scale}get restrictsScaling(){return this._restrictsScaling}set restrictsScaling(t){this._restrictsScaling=t}get canvasUpdated(){return this._canvasUpdated}set canvasUpdated(t){this._canvasUpdated=t}}class rL{constructor(){this._objects=new Map,this._canvases=new Map,this._disposed=!1,this._roomObjectVariableAccurateZ=null}dispose(){if(!this._disposed){if(this._canvases){for(const[t,e]of this._canvases.entries())this._canvases.delete(t),e&&e.dispose();this._canvases=null}this._objects&&(this._objects=null),this._disposed=!0}}reset(){this._objects.clear()}getInstanceId(t){return t?t.instanceId:-1}getRoomObject(t){return this._objects.get(t)}addObject(t){t&&this._objects.set(this.getInstanceId(t),t)}removeObject(t){const e=this.getInstanceId(t);this._objects.delete(e);for(const i of this._canvases.values()){if(!i)continue;i.removeFromCache(e.toString())}}render(t,e=!1){if(!(!this._canvases||!this._canvases.size))for(const i of this._canvases.values())i&&i.render(t,e)}update(t,e=!1){if(!(!this._canvases||!this._canvases.size)){this.render(t,e);for(const i of this._canvases.values())i&&i.update()}}getCanvas(t){const e=this._canvases.get(t);return e||null}createCanvas(t,e,i,r){const n=this._canvases.get(t);if(n)return n.initialize(e,i),n.geometry&&(n.geometry.scale=r),n;const a=this.createSpriteCanvas(t,e,i,r);if(a)return this._canvases.set(t,a),a}createSpriteCanvas(t,e,i,r){return new iL(this,t,e,i,r)}removeCanvas(t){const e=this._canvases.get(t);e&&(this._canvases.delete(t),e.dispose())}get objects(){return this._objects}get disposed(){return this._disposed}get roomObjectVariableAccurateZ(){return this._roomObjectVariableAccurateZ}set roomObjectVariableAccurateZ(t){this._roomObjectVariableAccurateZ=t}}class nL{createRenderer(){return new rL}}class aL extends cs{constructor(t,e){super(),this._id=t,this._container=e,this._renderer=null,this._managers=new Map,this._updateCategories=[],this._model=new KI}onDispose(){this.removeAllManagers(),this.destroyRenderer(),this._container=null,this._model.dispose()}setRenderer(t){if(t!==this._renderer&&(this._renderer&&this.destroyRenderer(),this._renderer=t,!!this._renderer&&(this._renderer.reset(),this._managers.size)))for(const e of this._managers.values()){if(!e)continue;const i=e.objects;if(i.length)for(const r of i.getValues())r&&this._renderer.addObject(r)}}destroyRenderer(){this._renderer&&(this._renderer.dispose(),this._renderer=null)}getManager(t){const e=this._managers.get(t);return e||null}getManagerOrCreate(t){let e=this.getManager(t);return e||(e=this._container.createRoomObjectManager(t),e?(this._managers.set(t,e),e):null)}getTotalObjectsForManager(t){const e=this.getManager(t);return e?e.totalObjects:0}getRoomObject(t,e){const i=this.getManager(e);if(!i)return null;const r=i.getObject(t);return r||null}getRoomObjectsForCategory(t){const e=this.getManager(t);return e?e.objects.getValues():[]}getRoomObjectByIndex(t,e){const i=this.getManager(e);if(!i)return null;const r=i.getObjectByIndex(t);return r||null}createRoomObject(t,e,i,r){const n=this.getManagerOrCreate(r);if(!n)return null;const a=n.createObject(t,e,i);return a?(this._renderer&&this._renderer.addObject(a),a):null}createRoomObjectAndInitalize(t,e,i){return this._container?this._container.createRoomObjectAndInitalize(this._id,t,e,i):null}removeRoomObject(t,e){const i=this.getManager(e);if(!i)return;const r=i.getObject(t);r&&(r.tearDown(),this._renderer&&this._renderer.removeObject(r),i.removeObject(t))}removeAllManagers(){for(const t of this._managers.values())if(t){if(this._renderer){const e=t.objects;if(e.length)for(const i of e.getValues())i&&this._renderer.removeObject(i)}t.dispose()}this._managers.clear()}addUpdateCategory(t){this._updateCategories.indexOf(t)>=0||this._updateCategories.push(t)}removeUpdateCategory(t){const e=this._updateCategories.indexOf(t);e!==-1&&this._updateCategories.splice(e,1)}update(t,e=!1){for(const i of this._updateCategories){const r=this.getManager(i);if(!r)continue;const n=r.objects;if(n.length)for(const a of n.getValues()){if(!a)continue;const o=a.logic;o&&o.update(t)}}this._renderer&&this._renderer.update(t,e)}hasUninitializedObjects(){for(const t of this._managers.values())if(t){for(const e of t.objects.getValues())if(e&&!e.isReady)return!0}return!1}get id(){return this._id}get container(){return this._container}get renderer(){return this._renderer}get managers(){return this._managers}get model(){return this._model}}const Qc=class{constructor(s,t,e,i,r,n,a){this._layerTags=[],this._primaryColor=s&16777215,this._secondaryColor=t&16777215,this._breed=e,this._tag=i>-1&&i<Qc.COLOR_TAGS.length?Qc.COLOR_TAGS[i]:"",this._id=r,this._isMaster=n,this._layerTags=a}get primaryColor(){return this._primaryColor}get secondaryColor(){return this._secondaryColor}get breed(){return this._breed}get tag(){return this._tag}get id(){return this._id}get isMaster(){return this._isMaster}get layerTags(){return this._layerTags}};let rT=Qc;rT.COLOR_TAGS=["Null","Black","White","Grey","Red","Orange","Pink","Green","Lime","Blue","Light-Blue","Dark-Blue","Yellow","Brown","Dark-Brown","Beige","Cyan","Purple","Gold"];const $t=class{constructor(){this._stateEvents=null,this._sessionDataManager=null,this._waitingForSessionDataManager=!1,this._iconListener=null,this._collections=new Map,this._gifCollections=new Map,this._images=new Map,this._events=new Map,this._activeObjects={},this._activeObjectTypes=new Map,this._activeObjectTypeIds=new Map,this._objectTypeAdUrls=new Map,this._wallItems={},this._wallItemTypes=new Map,this._wallItemTypeIds=new Map,this._furniRevisions=new Map,this._pets={},this._petColors=new Map,this._objectAliases=new Map,this._objectOriginalNames=new Map,this._pendingContentTypes=[],this._dataInitialized=!1}initialize(s){this._stateEvents=s,this.setFurnitureData();for(const[t,e]of rt.getValue("pet.types").entries())this._pets[e]=t}dispose(){}setSessionDataManager(s){this._sessionDataManager=s,this._waitingForSessionDataManager&&(this._waitingForSessionDataManager=!1,this.setFurnitureData())}loadFurnitureData(){this.setFurnitureData()}setFurnitureData(){if(!this._sessionDataManager){this._waitingForSessionDataManager=!0;return}const s=this._sessionDataManager.getAllFurnitureData(this);s&&(this._sessionDataManager.removePendingFurniDataListener(this),this.processFurnitureData(s),this._stateEvents.dispatchEvent(new Rt($t.LOADER_READY)))}processFurnitureData(s){if(s)for(const t of s){if(!t)continue;const e=t.id;let i=t.className;t.hasIndexedColor&&(i=i+"*"+t.colorIndex);const r=t.revision,n=t.adUrl;n&&n.length>0&&this._objectTypeAdUrls.set(i,n);let a=t.className;t.type===pn.FLOOR?(this._activeObjectTypes.set(e,i),this._activeObjectTypeIds.set(i,e),this._activeObjects[a]||(this._activeObjects[a]=1)):t.type===pn.WALL&&(a==="post.it"&&(i="post_it",a="post_it"),a==="post.it.vd"&&(i="post_it_vd",a="post_id_vd"),this._wallItemTypes.set(e,i),this._wallItemTypeIds.set(i,e),this._wallItems[a]||(this._wallItems[a]=1));const o=this._furniRevisions.get(a);r>o&&(this._furniRevisions.delete(a),this._furniRevisions.set(a,r))}}getFurnitureFloorNameForTypeId(s){const t=this._activeObjectTypes.get(s);return this.removeColorIndex(t)}getFurnitureWallNameForTypeId(s,t=null){let e=this._wallItemTypes.get(s);return e==="poster"&&t!==null&&(e=e+t),this.removeColorIndex(e)}getFurnitureFloorColorIndex(s){const t=this._activeObjectTypes.get(s);return t?this.getColorIndexFromName(t):-1}getFurnitureWallColorIndex(s){const t=this._wallItemTypes.get(s);return t?this.getColorIndexFromName(t):-1}getColorIndexFromName(s){if(!s)return-1;const t=s.indexOf("*");return t===-1?0:parseInt(s.substr(t+1))}removeColorIndex(s){if(!s)return null;const t=s.indexOf("*");return t===-1?s:s.substr(0,t)}getRoomObjectAdUrl(s){const t=this._objectTypeAdUrls.get(s);return t||""}getPetColorResult(s,t){const e=this._petColors.get(s);return e?e.get(t):null}getPetColorResultsForTag(s,t){const e=this._petColors.get(s),i=[];if(e)for(const r of e.values())r.tag===t&&i.push(r);return i}getCollection(s){if(!s)return null;const t=this._collections.get(s);if(!t){const e=ys().getCollection(s);return e?(this._collections.set(s,e),e):null}return t}getGifCollection(s){return s&&this._gifCollections.get(s)||null}getImage(s){if(!s)return null;const t=this._images.get(s);if(!t)return null;const e=new Image;return e.src=t.src,e}addAssetToCollection(s,t,e,i=!0){const r=this.getCollection(s);return r?r.addAsset(t,e,i,0,0,!1,!1):!1}createGifCollection(s,t,e){if(!s||!t||!e)return null;const i=new $b(s,t,e);return this._gifCollections.set(s,i),i}createCollection(s,t){if(!s||!t)return null;const e=new vf(s,t);this._collections.set(e.name,e);const i=this._pets[e.name];if(i!==void 0){const r=e.getPaletteNames(),n=new Map;for(const a of r){const o=e.getPalette(a),h=s.palettes[a],u=o.primaryColor,c=o.secondaryColor,l=h.breed!==void 0?h.breed:0,_=h.colorTag!==void 0?h.colorTag:-1,d=h.master!==void 0?h.master:!1,g=h.tags!==void 0?h.tags:[];n.set(parseInt(a),new rT(u,c,l,_,a,d,g))}this._petColors.set(i,n)}}getPlaceholderName(s){switch(this.getCategoryForType(s)){case D.FLOOR:return $t.PLACE_HOLDER;case D.WALL:return $t.PLACE_HOLDER_WALL;default:return this._pets[s]!==void 0?$t.PLACE_HOLDER_PET:$t.PLACE_HOLDER_DEFAULT}}getCategoryForType(s){return s?this._activeObjects[s]!==void 0?D.FLOOR:this._wallItems[s]!==void 0?D.WALL:this._pets[s]!==void 0?D.UNIT:s.indexOf("poster")===0?D.WALL:s==="room"?D.ROOM:s===ft.USER||s===ft.PET||s===ft.BOT||s===ft.RENTABLE_BOT?D.UNIT:s===$t.TILE_CURSOR||s===$t.SELECTION_ARROW?D.CURSOR:D.MINIMUM:D.MINIMUM}getPetNameForType(s){return rt.getValue("pet.types")[s]||null}isLoaderType(s){return s=ft.getRealType(s),s!==F.USER}downloadImage(s,t,e,i=null){let r=null,n=[];if(t&&t.indexOf(",")>=0&&(r=t,t=r.split(",")[0]),r?n=this.getAssetUrls(r,e,!0):n=this.getAssetUrls(t,e,!0),n&&n.length){const a=n[0],o=new Image;return o.src=a,o.onload=()=>{o.onerror=null,this._images.set([t,e].join("_"),o),this._iconListener.onRoomContentLoaded(s,[t,e].join("_"),!0)},o.onerror=()=>{o.onload=null,Y.error("Failed to download asset",a),this._iconListener.onRoomContentLoaded(s,[t,e].join("_"),!1)},!0}return!1}async downloadAsset(s,t){var i;const e=(i=this.getAssetUrls(s))==null?void 0:i[0];if(!(!e||!e.length)&&!(this._pendingContentTypes.indexOf(s)>=0||this.getOrRemoveEventDispatcher(s))){this._pendingContentTypes.push(s),this._events.set(s,t);try{const r=await fetch(e);let n="application/octet-stream";switch(r.headers.has("Content-Type")&&(n=r.headers.get("Content-Type")),n){case"application/octet-stream":{const a=new Rf(await r.arrayBuffer());await this.processAsset(a.baseTexture,a.jsonFile);const o=this._events.get(s);if(!o)return;o.dispatchEvent(new li(li.RCLE_SUCCESS,s));break}default:throw new Error}}catch{t.dispatchEvent(new li(li.RCLE_FAILURE,s))}}}async processAsset(s,t){const e=t.spritesheet;if(!s||!e||!Object.keys(e).length){this.createCollection(t,null);return}const i=async()=>{const r=new df(s,e);await r.parse(),this.createCollection(t,r)};s.valid?await i():await new Promise((r,n)=>{s.once("update",async()=>(await i(),r()))})}setAssetAliasName(s,t){this._objectAliases.set(s,t),this._objectOriginalNames.set(t,s)}getAssetAliasName(s){const t=this._objectAliases.get(s);return t||s}getAssetOriginalName(s){const t=this._objectOriginalNames.get(s);return t||s}getAssetUrls(s,t=null,e=!1){switch(s){case $t.PLACE_HOLDER:return[this.getAssetUrlWithGenericBase($t.PLACE_HOLDER)];case $t.PLACE_HOLDER_WALL:return[this.getAssetUrlWithGenericBase($t.PLACE_HOLDER_WALL)];case $t.PLACE_HOLDER_PET:return[this.getAssetUrlWithGenericBase($t.PLACE_HOLDER_PET)];case $t.ROOM:return[this.getAssetUrlWithGenericBase("room")];case $t.TILE_CURSOR:return[this.getAssetUrlWithGenericBase($t.TILE_CURSOR)];case $t.SELECTION_ARROW:return[this.getAssetUrlWithGenericBase($t.SELECTION_ARROW)];default:{const i=this.getCategoryForType(s);if(i===D.FLOOR||i===D.WALL){const r=this.getAssetAliasName(s);let n=e?this.getAssetUrlWithFurniIconBase(r):this.getAssetUrlWithFurniBase(s);if(e){const a=t&&t!==""&&this._activeObjectTypeIds.has(r+"*"+t);n=n.replace(/%param%/gi,a?"_"+t:"")}return[n]}return i===D.UNIT?[this.getAssetUrlWithPetBase(s)]:null}}}getAssetIconUrl(s,t){let e=null,i=[];return s&&s.indexOf(",")>=0&&(e=s,s=e.split(",")[0]),e?i=this.getAssetUrls(e,t,!0):i=this.getAssetUrls(s,t,!0),i&&i.length?i[0]:null}getAssetUrlWithGenericBase(s){return rt.getValue("generic.asset.url").replace(/%libname%/gi,s)}getAssetUrlWithFurniBase(s){return rt.getValue("furni.asset.url").replace(/%libname%/gi,s)}getAssetUrlWithFurniIconBase(s){return rt.getValue("furni.asset.icon.url").replace(/%libname%/gi,s)}getAssetUrlWithPetBase(s){return rt.getValue("pet.asset.url").replace(/%libname%/gi,s)}setRoomObjectRoomId(s,t){const e=s&&s.model;e&&e.setValue(I.OBJECT_ROOM_ID,t)}getOrRemoveEventDispatcher(s,t=!1){const e=this._events.get(s);return t&&this._events.delete(s),e}setIconListener(s){this._iconListener=s}};let Is=$t;Is.PLACE_HOLDER="place_holder";Is.PLACE_HOLDER_WALL="place_holder_wall";Is.PLACE_HOLDER_PET="place_holder_pet";Is.PLACE_HOLDER_DEFAULT=$t.PLACE_HOLDER;Is.ROOM="room";Is.TILE_CURSOR="tile_cursor";Is.SELECTION_ARROW="selection_arrow";Is.LOADER_READY="RCL_LOADER_READY";Is.MANDATORY_LIBRARIES=[$t.PLACE_HOLDER,$t.PLACE_HOLDER_WALL,$t.PLACE_HOLDER_PET,$t.ROOM,$t.TILE_CURSOR,$t.SELECTION_ARROW];class oL{constructor(){this._objects=new Ee,this._objectsPerType=new Ee}dispose(){this.removeAllObjects()}getObject(t){const e=this._objects.getValue(t);return e||null}getObjectByIndex(t){const e=this._objects.getWithIndex(t);return e||null}createObject(t,e,i){const r=new ZI(t,e,i);return this.addObject(t,i,r)}addObject(t,e,i){if(this._objects.getValue(t))return i.dispose(),null;this._objects.add(t,i);const r=this.getTypeMap(e);return r&&r.add(t,i),i}removeObject(t){const e=this._objects.remove(t);if(e){const i=this.getTypeMap(e.type);i&&i.remove(e.id),e.dispose()}}removeAllObjects(){let t=0;for(;t<this._objects.length;){const e=this._objects.getWithIndex(t);e&&e.dispose(),t++}for(this._objects.reset(),t=0;t<this._objectsPerType.length;){const e=this._objectsPerType.getWithIndex(t);e&&e.dispose(),t++}this._objectsPerType.reset()}getTypeMap(t,e=!0){let i=this._objectsPerType.getValue(t);return!i&&e&&(i=new Ee,this._objectsPerType.add(t,i)),i}get objects(){return this._objects}get totalObjects(){return this._objects.length}}const or=class extends mi{constructor(s,t,e){super(),this._state=or.ROOM_MANAGER_LOADED,this._rooms=new Map,this._contentLoader=null,this._updateCategories=[],this._listener=s,this._visualizationFactory=t,this._logicFactory=e,this._initialLoadList=[],this._pendingContentTypes=[],this._skipContentProcessing=!1,this._disposed=!1,this.onRoomContentLoadedEvent=this.onRoomContentLoadedEvent.bind(this),this.events.addEventListener(li.RCLE_SUCCESS,this.onRoomContentLoadedEvent),this.events.addEventListener(li.RCLE_FAILURE,this.onRoomContentLoadedEvent),this.events.addEventListener(li.RCLE_CANCEL,this.onRoomContentLoadedEvent)}onInit(){if(this._state>=or.ROOM_MANAGER_INITIALIZING||!this._contentLoader)return;const s=Is.MANDATORY_LIBRARIES;for(const t of s)t&&this._initialLoadList.indexOf(t)===-1&&(this._contentLoader.downloadAsset(t,this.events),this._initialLoadList.push(t));this._state=or.ROOM_MANAGER_INITIALIZING}getRoomInstance(s){const t=this._rooms.get(s);return t||null}createRoomInstance(s){if(this._rooms.get(s))return null;const t=new aL(s,this);if(this._rooms.set(t.id,t),this._updateCategories.length)for(const e of this._updateCategories)t.addUpdateCategory(e);return t}removeRoomInstance(s){const t=this._rooms.get(s);return t?(this._rooms.delete(s),t.dispose(),!0):!1}createRoomObjectAndInitalize(s,t,e,i){const r=this.getRoomInstance(s);if(!r)return null;let n=e,a=e,o=e,h=null,u=!1;if(this._contentLoader.isLoaderType(e)){if(h=this._contentLoader.getCollection(e),!h&&(u=!0,this._contentLoader.downloadAsset(e,this.events),o=this._contentLoader.getPlaceholderName(e),h=this._contentLoader.getCollection(o),!h))return null;n=h.data.visualizationType,a=h.data.logicType}const c=r.createRoomObject(t,1,e,i);if(!c)return null;if(this._visualizationFactory){const l=this._visualizationFactory.getVisualization(n);if(!l)return r.removeRoomObject(t,i),null;l.asset=h;const _=this._visualizationFactory.getVisualizationData(o,n,h&&h.data||null);if(!_||!l.initialize(_))return r.removeRoomObject(t,i),null;c.setVisualization(l)}if(this._logicFactory){const l=this._logicFactory.getLogic(a);c.setLogic(l),l&&l.initialize(h&&h.data||null)}return u||(c.isReady=!0),this._contentLoader.setRoomObjectRoomId(c,s),c}reinitializeRoomObjectsByType(s){if(!s||!this._contentLoader||!this._visualizationFactory||!this._logicFactory)return;const t=this._contentLoader.getCollection(s);if(!t)return;const e=t.data.visualizationType,i=t.data.logicType,r=this._visualizationFactory.getVisualizationData(s,e,t.data);for(const n of this._rooms.values())if(n){for(const[a,o]of n.managers.entries())if(o)for(const h of o.objects.getValues()){if(!h||h.type!==s)continue;const u=this._visualizationFactory.getVisualization(e);if(u)if(u.asset=t,!r||!u.initialize(r))o.removeObject(h.id);else{h.setVisualization(u);const c=this._logicFactory.getLogic(i);h.setLogic(c),c&&c.initialize(t.data),h.isReady=!0,this._listener&&this._listener.objectInitialized(n.id,h.id,a)}else o.removeObject(h.id)}}}addUpdateCategory(s){if(!(this._updateCategories.indexOf(s)>=0)&&(this._updateCategories.push(s),!!this._rooms.size))for(const e of this._rooms.values())e&&e.addUpdateCategory(s)}removeUpdateCategory(s){const t=this._updateCategories.indexOf(s);if(t!==-1&&(this._updateCategories.splice(t,1),!!this._rooms.size))for(const e of this._rooms.values())e&&e.removeUpdateCategory(s)}setContentLoader(s){this._contentLoader&&this._contentLoader.dispose(),this._contentLoader=s}processPendingContentTypes(s){if(this._skipContentProcessing){this._skipContentProcessing=!1;return}for(;this._pendingContentTypes.length;){const t=this._pendingContentTypes.shift();if(!this._contentLoader.getCollection(t)){this._listener&&this._listener.initalizeTemporaryObjectsByType(t,!1),Y.log("Invalid Collection",t);continue}this.reinitializeRoomObjectsByType(t),this._listener&&this._listener.initalizeTemporaryObjectsByType(t,!0),this._initialLoadList.length>0&&this.removeFromInitialLoad(t)}}removeFromInitialLoad(s){if(!(!s||this._state===or.ROOM_MANAGER_ERROR))if(this._contentLoader||(this._state=or.ROOM_MANAGER_ERROR),this._contentLoader.getCollection(s)){const t=this._initialLoadList.indexOf(s);t>=0&&this._initialLoadList.splice(t,1),this._initialLoadList.length||(this._state=or.ROOM_MANAGER_INITIALIZED,this._listener&&this._listener.onRoomEngineInitalized(!0))}else this._state=or.ROOM_MANAGER_ERROR,this._listener&&this._listener.onRoomEngineInitalized(!1)}onRoomContentLoadedEvent(s){if(!this._contentLoader)return;const t=s.contentType;this._pendingContentTypes.indexOf(t)>=0||this._pendingContentTypes.push(t)}update(s,t=!1){if(this.processPendingContentTypes(s),!!this._rooms.size)for(const e of this._rooms.values())e&&e.update(s,t)}createRoomObjectManager(s){return new oL}get rooms(){return this._rooms}get disposed(){return this._disposed}};let Gn=or;Gn.ROOM_MANAGER_ERROR=-1;Gn.ROOM_MANAGER_LOADING=0;Gn.ROOM_MANAGER_LOADED=1;Gn.ROOM_MANAGER_INITIALIZING=2;Gn.ROOM_MANAGER_INITIALIZED=3;Gn.CONTENT_PROCESSING_TIME_LIMIT_MILLISECONDS=40;class hL{constructor(t,e=-1,i=null,r=null,n=null){this._minLevel=-1,this._texture=null,this._colorMatrix=null,this._blendMode=null,this._name=t,this._minLevel=e,this._texture=i,this._colorMatrix=r,this._blendMode=n}get name(){return this._name}get texture(){return this._texture}set texture(t){this._texture=t}get colorMatrix(){return this._colorMatrix}set colorMatrix(t){this._colorMatrix=t}get blendMode(){return this._blendMode}set blendMode(t){this._blendMode=t}get minLevel(){return this._minLevel}}class uL{constructor(){this._effects=new Map,this._events=new Rs,this._isLoaded=!1}init(){if(this._isLoaded)return;this._isLoaded=!0;const t=rt.getValue("image.library.url")+"Habbo-Stories/",e=rt.getValue("camera.available.effects");for(const i of e){if(!i.enabled)continue;const r=new hL(i.name,i.minLevel);i.colorMatrix.length?r.colorMatrix=i.colorMatrix:(r.texture=ut.from(t+i.name+".png"),r.blendMode=i.blendMode),this._effects.set(r.name,r)}this.events.dispatchEvent(new Uc(Uc.INITIALIZED))}applyEffects(t,e,i){const r=new Hs,n=new se(t);r.addChild(n),i&&n.scale.set(2);for(const a of e){const o=a.effect;if(o)if(o.colorMatrix){const h=new Xu;h.matrix=o.colorMatrix,h.alpha=a.alpha,n.filters||(n.filters=[]),n.filters.push(h)}else{const h=new se(o.texture);h.alpha=a.alpha,h.blendMode=o.blendMode,r.addChild(h)}}return qt.generateImage(r)}get effects(){return this._effects}get events(){return this._events}get isLoaded(){return this._isLoaded}}class Zq{constructor(t,e){this._effect=t,this._alpha=e}get effect(){return this._effect}get alpha(){return this._alpha}}class lL{flush(){return this._canShowInterstitial=!1,!0}parse(t){return t?(this._canShowInterstitial=t.readBoolean(),!0):!1}get canShowInterstitial(){return this._canShowInterstitial}}class _L{flush(){return this._errorCode=0,this._filteredText=null,!0}parse(t){return t?(this._errorCode=t.readInt(),this._filteredText=t.readString(),!0):!1}get errorCode(){return this._errorCode}get filteredText(){return this._filteredText}}class cL{flush(){return this._isOpen=!1,this._onShutdown=!1,this._isAuthenticUser=!1,!0}parse(t){return t?(this._isOpen=t.readBoolean(),this._onShutdown=t.readBoolean(),t.bytesAvailable&&(this._isAuthenticUser=t.readBoolean()),!0):!1}get isOpen(){return this._isOpen}get onShutdown(){return this._onShutdown}get isAuthenticUser(){return this._isAuthenticUser}}class dL{flush(){return this._isOpen=!1,this._minutesUntilChange=0,!0}parse(t){return t?(this._isOpen=t.readInt()>0,this._minutesUntilChange=t.readInt(),!0):!1}get isOpen(){return this._isOpen}get minutesUntilChange(){return this._minutesUntilChange}}class fL{flush(){return this._openHour=0,this._openMinute=0,!0}parse(t){return t?(this._openHour=t.readInt(),this._openMinute=t.readInt(),!0):!1}get openHour(){return this._openHour}get openMinute(){return this._openMinute}}class gL{flush(){return this._openHour=0,this._openMinute=0,this._userThrownOutAtClose=!1,!0}parse(t){return t?(this._openHour=t.readInt(),this._openMinute=t.readInt(),this._userThrownOutAtClose=t.readBoolean(),!0):!1}get openHour(){return this._openHour}get openMinute(){return this._openMinute}get userThrowOutAtClose(){return this._userThrownOutAtClose}}class EL{flush(){return this._minutes=0,!0}parse(t){return t?(this._minutes=t.readInt(),!0):!1}get openMinute(){return this._minutes}}class pL{flush(){return this._isInMaintenance=!1,this._minutesUntilMaintenance=0,this._duration=15,!0}parse(t){return t?(this._isInMaintenance=t.readBoolean(),this._minutesUntilMaintenance=t.readInt(),t.bytesAvailable&&(this._duration=t.readInt()),!0):!1}get isInMaintenance(){return this._isInMaintenance}get minutesUntilMaintenance(){return this._minutesUntilMaintenance}get duration(){return this._duration}}class mL{flush(){return this._resultCode=-1,this._name="",this._nameSuggestions=[],!0}parse(t){if(!t)return!1;this._resultCode=t.readInt(),this._name=t.readString();let e=t.readInt();for(;e>0;)this._nameSuggestions.push(t.readString()),e--;return!0}get resultCode(){return this._resultCode}get name(){return this._name}get nameSuggestions(){return this._nameSuggestions}}class IL{flush(){return this._resultCode=-1,this._name="",this._nameSuggestions=[],!0}parse(t){if(!t)return!1;this._resultCode=t.readInt(),this._name=t.readString();let e=t.readInt();for(;e>0;)this._nameSuggestions.push(t.readString()),e--;return!0}get resultCode(){return this._resultCode}get name(){return this._name}get nameSuggestions(){return this._nameSuggestions}}class TL{flush(){return this._figure="",this._gender="",!0}parse(t){return t?(this._figure=t.readString(),this._gender=t.readString(),this._gender&&(this._gender=this._gender.toUpperCase()),!0):!1}get figure(){return this._figure}get gender(){return this._gender}}class RL{constructor(t){this._slotId=t.readInt(),this._figureString=t.readString(),this._gender=t.readString()}get slotId(){return this._slotId}get figureString(){return this._figureString}get gender(){return this._gender}}class OL{flush(){return this._state=0,this._outfits=[],!0}parse(t){if(!t)return!1;this._state=t.readInt();let e=t.readInt();for(;e>0;)this._outfits.push(new RL(t)),e--;return!0}get state(){return this._state}get outfits(){return this._outfits}}class Df{constructor(t){if(!t)throw new Error("invalid_parser");this._id=t.readInt(),this._name=t.readString(),this._motto=t.readString(),this._gender=t.readString(),this._figure=t.readString()}get id(){return this._id}get name(){return this._name}get motto(){return this._motto}get figure(){return this._figure}get gender(){return this._gender}}class AL{flush(){return this._item=null,this._openInventory=!1,!0}parse(t){return t?(this._item=new Df(t),this._openInventory=t.readBoolean(),!0):!1}get item(){return this._item}openInventory(){return this._openInventory}}class vL{flush(){return this._items=null,!0}parse(t){this._items=new Map;let e=t.readInt();for(;e>0;){const i=new Df(t);this._items.set(i.id,i),e--}return!0}get items(){return this._items}}class SL{flush(){return this._boughtAsGift=!1,this._item=null,!0}parse(t){return t?(this._boughtAsGift=t.readBoolean(),this._item=new Df(t),!0):!1}get boughtAsGift(){return this._boughtAsGift}get item(){return this._item}}class yL{flush(){return this._itemId=0,!0}parse(t){return t?(this._itemId=t.readInt(),!0):!1}get itemId(){return this._itemId}}class CL{constructor(t){this._name=t.readString(),this._id=t.readInt(),this._consequence=t.readString()}get name(){return this._name}get id(){return this._id}get consequence(){return this._consequence}}class ML{constructor(t){this._topics=[],this._name=t.readString();let e=t.readInt();for(;e>0;)this._topics.push(new CL(t)),e--}dispose(){this._disposed||(this._disposed=!0,this._topics=null)}get disposed(){return this._disposed}get name(){return this._name}get topics(){return this._topics}}class NL{constructor(t){this._tradeLockInfo="",this._machineBanInfo="",this._name=t.readString(),this._sanctionLengthInHours=t.readInt(),this._probationDays=t.readInt(),this._avatarOnly=t.readBoolean(),t.bytesAvailable&&(this._tradeLockInfo=t.readString()),t.bytesAvailable&&(this._machineBanInfo=t.readString())}get name(){return this._name}get sanctionLengthInHours(){return this._sanctionLengthInHours}get avatarOnly(){return this._avatarOnly}get tradeLockInfo(){return this._tradeLockInfo}get machineBanInfo(){return this._machineBanInfo}}class PL{flush(){return this._issueId=-1,this._accountId=1,this._sanctionType=null,!0}parse(t){return t?(this._issueId=t.readInt(),this._accountId=t.readInt(),this._sanctionType=new NL(t),!0):!1}get issueId(){return this._issueId}get accountId(){return this._accountId}get sanctionType(){return this._sanctionType}}class bL{flush(){return this._callForHelpCategories=null,!0}parse(t){if(!t)return!1;this._callForHelpCategories=[];let e=t.readInt();for(;e>0;)this._callForHelpCategories.push(new ML(t)),e--;return!0}get callForHelpCategories(){return this._callForHelpCategories}}class DL{flush(){return this._isSanctionNew=!1,this._isSanctionActive=!1,this._sanctionName=null,this._sanctionLengthHours=0,this._sanctionReason=null,this._sanctionCreationTime=null,this._probationHoursLeft=0,this._nextSanctionName=null,this._nextSanctionLengthHours=0,this._hasCustomMute=!1,this._tradeLockExpiryTime=null,!0}parse(t){return t?(this._isSanctionNew=t.readBoolean(),this._isSanctionActive=t.readBoolean(),this._sanctionName=t.readString(),this._sanctionLengthHours=t.readInt(),t.readInt(),this._sanctionReason=t.readString(),this._sanctionCreationTime=t.readString(),this._probationHoursLeft=t.readInt(),this._nextSanctionName=t.readString(),this._nextSanctionLengthHours=t.readInt(),t.readInt(),this._hasCustomMute=t.readBoolean(),t.bytesAvailable&&(this._tradeLockExpiryTime=t.readString()),!0):!1}get isSanctionNew(){return this._isSanctionNew}get isSanctionActive(){return this._isSanctionActive}get sanctionName(){return this._sanctionName}get sanctionLengthHours(){return this._sanctionLengthHours}get sanctionReason(){return this._sanctionReason}get sanctionCreationTime(){return this._sanctionCreationTime}get probationHoursLeft(){return this._probationHoursLeft}get nextSanctionName(){return this._nextSanctionName}get nextSanctionLengthHours(){return this._nextSanctionLengthHours}get hasCustomMute(){return this._hasCustomMute}get tradeLockExpiryTime(){return this._tradeLockExpiryTime}}class LL{constructor(){this._ok=!1,this._secondsToWait=0}flush(){return this._ok=!1,this._secondsToWait=0,this._extraDataId=null,!0}parse(t){return t?(this._ok=t.readBoolean(),this._secondsToWait=t.readInt(),this._ok&&t.bytesAvailable&&(this._extraDataId=t.readString()),!0):!1}get ok(){return this._ok}get secondsToWait(){return this._secondsToWait}get extraDataId(){return this._extraDataId}}class UL{flush(){return!0}parse(t){return!!t}}class xL{flush(){return this._roomType=null,this._roomId=-1,!0}parse(t){return t?(this._roomType=t.readString(),this._roomId=t.readInt(),!0):!1}get roomType(){return this._roomType}get roomId(){return this._roomId}}class FL{flush(){return this._url="",!0}parse(t){return t?(this._url=t.readString(),!0):!1}get url(){return this._url}}class wL{constructor(){this._ok=!1,this._errorReason=null}flush(){return this._ok=!1,this._errorReason=null,!0}parse(t){return t?(this._ok=t.readBoolean(),this._errorReason=t.readString(),!0):!1}get ok(){return this._ok}get errorReason(){return this._errorReason}}class GL{constructor(){this._creditPrice=0,this._ducketPrice=0,this._publishDucketPrice=0}flush(){return this._creditPrice=0,this._ducketPrice=0,this._publishDucketPrice=0,!0}parse(t){return t?(this._creditPrice=t.readInt(),this._ducketPrice=t.readInt(),t.bytesAvailable&&(this._publishDucketPrice=t.readInt()),!0):!1}get creditPrice(){return this._creditPrice}get ducketPrice(){return this._ducketPrice}get publishDucketPrice(){return this._publishDucketPrice}}class BL{constructor(){this._ok=!0,this._renderLimitHit=!1}flush(){return this._ok=!0,this._renderLimitHit=!1,!0}parse(t){return t?(t.bytesAvailable&&(this._ok=t.readBoolean(),this._renderLimitHit=t.readBoolean()),!0):!1}get ok(){return this._ok}get isRenderLimitHit(){return this._renderLimitHit}}class Lf{parse(t){if(!t)return!1;this._campaignName=t.readString(),this._campaignImage=t.readString(),this._currentDay=t.readInt(),this._campaignDays=t.readInt(),this._openedDays=[];let e=t.readInt();for(let i=0;i<e;i++)this._openedDays.push(t.readInt());this._missedDays=[],e=t.readInt();for(let i=0;i<e;i++)this._missedDays.push(t.readInt());return!0}clone(){const t=new Lf;return t.campaignDays=this._campaignDays,t.campaignImage=this._campaignImage,t.campaignName=this._campaignName,t.currentDay=this._currentDay,t.missedDays=this._missedDays,t.openedDays=this._openedDays,t}get campaignName(){return this._campaignName}set campaignName(t){this._campaignName=t}get campaignImage(){return this._campaignImage}set campaignImage(t){this._campaignImage=t}get currentDay(){return this._currentDay}set currentDay(t){this._currentDay=t}get campaignDays(){return this._campaignDays}set campaignDays(t){this._campaignDays=t}get openedDays(){return this._openedDays}set openedDays(t){this._openedDays=t}get missedDays(){return this._missedDays}set missedDays(t){this._missedDays=t}}class HL{flush(){return this._calendarData=null,!0}parse(t){return t?(this._calendarData=new Lf,this._calendarData.parse(t),!0):!1}get calendarData(){return this._calendarData}}class VL{flush(){return this._doorOpened=!1,this._productName=null,this._customImage=null,this._furnitureClassName=null,!0}parse(t){return t?(this._doorOpened=t.readBoolean(),this._productName=t.readString(),this._customImage=t.readString(),this._furnitureClassName=t.readString(),!0):!1}get doorOpened(){return this._doorOpened}get productName(){return this._productName}get customImage(){return this._customImage}get furnitureClassName(){return this._furnitureClassName}}class kL{flush(){return this._totalCoinsForBonus=-1,this._coinsStillRequiredToBuy=-1,this._productType="",this._productClassId=-1,!0}parse(t){return t?(this._productType=t.readString(),this._productClassId=t.readInt(),this._totalCoinsForBonus=t.readInt(),this._coinsStillRequiredToBuy=t.readInt(),!0):!1}get totalCoinsForBonus(){return this._totalCoinsForBonus}get coinsStillRequiredToBuy(){return this._coinsStillRequiredToBuy}get productType(){return this._productType}get productClassId(){return this._productClassId}}class jL{flush(){return this._furniCount=0,!0}parse(t){return t?(this._furniCount=t.readInt(),!0):!1}get furniCount(){return this._furniCount}}class zL{flush(){return this._secondsLeft=0,this._furniLimit=0,this._maxFurniLimit=0,this._secondsLeftWithGrace=0,!0}parse(t){return t?(this._secondsLeft=t.readInt(),this._furniLimit=t.readInt(),this._maxFurniLimit=t.readInt(),t.bytesAvailable?this._secondsLeftWithGrace=t.readInt():this._secondsLeftWithGrace=this._secondsLeft,!0):!1}get secondsLeft(){return this._secondsLeft}get furniLimit(){return this._furniLimit}get maxFurniLimit(){return this._maxFurniLimit}get secondsLeftWithGrace(){return this._secondsLeftWithGrace}}class YL{constructor(t){this._maxPurchaseSize=t.readInt(),this._bundleSize=t.readInt(),this._bundleDiscountSize=t.readInt(),this._bonusThreshold=t.readInt(),this._additionalBonusDiscountThresholdQuantities=[];let e=t.readInt();for(;e>0;)this._additionalBonusDiscountThresholdQuantities.push(t.readInt()),e--}get maxPurchaseSize(){return this._maxPurchaseSize}get bundleSize(){return this._bundleSize}get bundleDiscountSize(){return this._bundleDiscountSize}get bonusThreshold(){return this._bonusThreshold}get additionalBonusDiscountThresholdQuantities(){return this._additionalBonusDiscountThresholdQuantities}}class WL{flush(){return this._bundleDiscountRuleset=null,!0}parse(t){return t?(this._bundleDiscountRuleset=new YL(t),!0):!1}get bundleDiscountRuleset(){return this._bundleDiscountRuleset}}class Uf{constructor(t){if(!t)throw new Error("invalid_wrapper");this.flush(),this.parse(t)}flush(){return this._visible=!1,this._icon=0,this._pageId=-1,this._pageName=null,this._localization=null,this._children=[],this._offerIds=[],!0}parse(t){if(!t)return!1;this._visible=t.readBoolean(),this._icon=t.readInt(),this._pageId=t.readInt(),this._pageName=t.readString(),this._localization=t.readString();let e=t.readInt();for(;e>0;)this._offerIds.push(t.readInt()),e--;let i=t.readInt();for(;i>0;)this._children.push(new Uf(t)),i--;return!0}get visible(){return this._visible}get icon(){return this._icon}get pageId(){return this._pageId}get pageName(){return this._pageName}get localization(){return this._localization}get children(){return this._children}get offerIds(){return this._offerIds}}class XL{flush(){return this._root=null,!0}parse(t){return t?(this._root=new Uf(t),this._newAdditionsAvailable=t.readBoolean(),this._catalogType=t.readString(),!0):!1}get root(){return this._root}get newAdditionsAvailable(){return this._newAdditionsAvailable}get catalogType(){return this._catalogType}}class KL{constructor(t){this._images=[],this._texts=[];let e=t.readInt();for(;e>0;)this._images.push(t.readString()),e--;let i=t.readInt();for(;i>0;)this._texts.push(t.readString()),i--}get images(){return this._images}get texts(){return this._texts}}class qL{flush(){return this._pageName=null,this._pageId=0,this._secondsToExpiry=0,this._image=null,!0}parse(t){return t?(this._pageId=t.readInt(),this._pageName=t.readString(),this._secondsToExpiry=t.readInt(),this._image=t.readString(),!0):!1}get pageName(){return this._pageName}get pageId(){return this._pageId}get secondsToExpiry(){return this._secondsToExpiry}get image(){return this._image}}const nT=class{constructor(s){if(!s)throw new Error("invalid_wrapper");this.flush(),this.parse(s)}flush(){return this._productType=null,this._furniClassId=-1,this._extraParam=null,this._productCount=0,this._uniqueLimitedItem=!1,this._uniqueLimitedItemSeriesSize=0,this._uniqueLimitedItemsLeft=0,!0}parse(s){switch(this._productType=s.readString(),this._productType){case nT.B:return this._extraParam=s.readString(),this._productCount=1,!0;default:return this._furniClassId=s.readInt(),this._extraParam=s.readString(),this._productCount=s.readInt(),this._uniqueLimitedItem=s.readBoolean(),this._uniqueLimitedItem&&(this._uniqueLimitedItemSeriesSize=s.readInt(),this._uniqueLimitedItemsLeft=s.readInt()),!0}}get productType(){return this._productType}get furniClassId(){return this._furniClassId}get extraParam(){return this._extraParam}get productCount(){return this._productCount}get uniqueLimitedItem(){return this._uniqueLimitedItem}get uniqueLimitedSeriesSize(){return this._uniqueLimitedItemSeriesSize}get uniqueLimitedItemsLeft(){return this._uniqueLimitedItemsLeft}};let Hr=nT;Hr.I="i";Hr.S="s";Hr.E="e";Hr.B="b";class Dl{constructor(t){this._offerId=t.readInt(),this._localizationId=t.readString(),this._rent=t.readBoolean(),this._priceCredits=t.readInt(),this._priceActivityPoints=t.readInt(),this._priceActivityPointsType=t.readInt(),this._giftable=t.readBoolean(),this._products=[];let e=t.readInt();for(;e>0;)this._products.push(new Hr(t)),e--;this._clubLevel=t.readInt(),this._bundlePurchaseAllowed=t.readBoolean(),this._isPet=t.readBoolean(),this._previewImage=t.readString()}get offerId(){return this._offerId}get localizationId(){return this._localizationId}get rent(){return this._rent}get priceCredits(){return this._priceCredits}get priceActivityPoints(){return this._priceActivityPoints}get priceActivityPointsType(){return this._priceActivityPointsType}get clubLevel(){return this._clubLevel}get giftable(){return this._giftable}get bundlePurchaseAllowed(){return this._bundlePurchaseAllowed}get isPet(){return this._isPet}get previewImage(){return this._previewImage}get products(){return this._products}}const vu=class{constructor(s){if(!s)throw new Error("invalid_wrapper");this.flush(),this.parse(s)}flush(){return this._type=-1,this._position=null,this._itemName=null,this._itemPromoImage=null,this._catalogPageLocation=null,this._productCode=null,this._productOfferId=0,this._expirationTime=0,!0}parse(s){if(!s)return!1;switch(this._position=s.readInt(),this._itemName=s.readString(),this._itemPromoImage=s.readString(),this._type=s.readInt(),this._type){case vu.ITEM_CATALOGUE_PAGE:this._catalogPageLocation=s.readString();break;case vu.ITEM_PRODUCT_OFFER:this._productOfferId=s.readInt();break;case vu.ITEM_IAP:this._productCode=s.readString();break}const t=s.readInt();return this._expirationTime=t>0?t*1e3+_t():0,!0}get type(){return this._type}get position(){return this._position}get itemName(){return this._itemName}get itemPromoImage(){return this._itemPromoImage}get catalogPageLocation(){return this._catalogPageLocation}get productCode(){return this._productCode}get productOfferId(){return this._productOfferId}get expirationTime(){return this._expirationTime}};let Ll=vu;Ll.ITEM_CATALOGUE_PAGE=0;Ll.ITEM_PRODUCT_OFFER=1;Ll.ITEM_IAP=2;class ZL{flush(){return this._pageId=-1,this._catalogType=null,this._layoutCode=null,this._localization=null,this._offers=[],this._offerId=-1,this._acceptSeasonCurrencyAsCredits=!1,this._frontPageItems=[],!0}parse(t){if(!t)return!1;this._pageId=t.readInt(),this._catalogType=t.readString(),this._layoutCode=t.readString(),this._localization=new KL(t);let e=t.readInt();for(;e>0;)this._offers.push(new Dl(t)),e--;if(this._offerId=t.readInt(),this._acceptSeasonCurrencyAsCredits=t.readBoolean(),t.bytesAvailable){let i=t.readInt();for(;i>0;)this._frontPageItems.push(new Ll(t)),i--}return!0}get pageId(){return this._pageId}get catalogType(){return this._catalogType}get layoutCode(){return this._layoutCode}get localization(){return this._localization}get offers(){return this._offers}get offerId(){return this._offerId}get acceptSeasonCurrencyAsCredits(){return this._acceptSeasonCurrencyAsCredits}get frontPageItems(){return this._frontPageItems}}class QL{flush(){return this._pageName=null,this._secondsToExpiry=0,this._image=null,!0}parse(t){return t?(this._pageName=t.readString(),this._secondsToExpiry=t.readInt(),this._image=t.readString(),!0):!1}get pageName(){return this._pageName}get secondsToExpiry(){return this._secondsToExpiry}get image(){return this._image}}class JL{flush(){return this._instantlyRefreshCatalogue=!1,this._newFurniDataHash=null,!0}parse(t){return t?(this._instantlyRefreshCatalogue=t.readBoolean(),t.bytesAvailable&&(this._newFurniDataHash=t.readString()),!0):!1}get instantlyRefreshCatalogue(){return this._instantlyRefreshCatalogue}get newFurniDataHash(){return this._newFurniDataHash}}class $L{constructor(t){this._offerId=t.readInt(),this._isVip=t.readBoolean(),this._daysRequired=t.readInt(),this._isSelectable=t.readBoolean()}get offerId(){return this._offerId}get isVip(){return this._isVip}get isSelectable(){return this._isSelectable}get daysRequired(){return this._daysRequired}}class tU{flush(){return!0}parse(t){if(!t)return!1;this._offers=[],this._giftData=new Map,this._daysUntilNextGift=t.readInt(),this._giftsAvailable=t.readInt();const e=t.readInt();for(let r=0;r<e;r++)this._offers.push(new Dl(t));const i=t.readInt();for(let r=0;r<i;r++){const n=new $L(t);this._giftData.set(n.offerId,n)}return!0}get offers(){return this._offers}get daysUntilNextGift(){return this._daysUntilNextGift}get giftsAvailable(){return this._giftsAvailable}set giftsAvailable(t){this._giftsAvailable=t}getOfferExtraData(t){return t?this._giftData.get(t):null}get giftData(){return this._giftData}}class eU{flush(){return this._productCode=null,this._products=[],!0}parse(t){if(!t)return!1;this._productCode=t.readString();let e=t.readInt();for(;e>0;)this._products.push(new Hr(t)),e--;return!0}get productCode(){return this._productCode}get products(){return this._products}}class aT{constructor(t){if(!t)throw new Error("invalid_wrapper");this._offerId=t.readInt(),this._productCode=t.readString(),t.readBoolean(),this._priceCredits=t.readInt(),this._priceActivityPoints=t.readInt(),this._priceActivityPointsType=t.readInt(),this._vip=t.readBoolean(),this._months=t.readInt(),this._extraDays=t.readInt(),this._giftable=t.readBoolean(),this._daysLeftAfterPurchase=t.readInt(),this._year=t.readInt(),this._month=t.readInt(),this._day=t.readInt()}get offerId(){return this._offerId}get productCode(){return this._productCode}get priceCredits(){return this._priceCredits}get priceActivityPoints(){return this._priceActivityPoints}get priceActivityPointsType(){return this._priceActivityPointsType}get vip(){return this._vip}get months(){return this._months}get extraDays(){return this._extraDays}get daysLeftAfterPurchase(){return this._daysLeftAfterPurchase}get year(){return this._year}get month(){return this._month}get day(){return this._day}get giftable(){return this._giftable}}class sU extends aT{constructor(t){super(t),this._originalPrice=t.readInt(),this._originalActivityPointPrice=t.readInt(),this._originalActivityPointType=t.readInt(),this._subscriptionDaysLeft=t.readInt()}get originalPrice(){return this._originalPrice*this.months}get originalActivityPointPrice(){return this._originalActivityPointPrice*this.months}get originalActivityPointType(){return this._originalActivityPointType}get discountCreditAmount(){return this._originalPrice*this.months-this.priceCredits}get discountActivityPointAmount(){return this.originalActivityPointPrice*this.months-this.priceActivityPoints}get subscriptionDaysLeft(){return this._subscriptionDaysLeft}}class iU{flush(){return this._available=!1,this._pricePointUrl=null,this._market=null,this._lengthInDays=0,!0}parse(t){return t?(this._pricePointUrl=t.readString(),this._pricePointUrl!==""&&(this._available=!0),this._market=t.readString(),this._lengthInDays=t.readInt(),!0):!1}get available(){return this._available}get pricePointUrl(){return this._pricePointUrl}get market(){return this._market}get lengthInDays(){return this._lengthInDays}}class rU{constructor(t){this._stuffId=t.readInt(),this._charges=t.readInt(),this._SafeStr_6935=t.readInt(),this._SafeStr_6936=t.readInt(),this._SafeStr_6518=t.readInt(),this._SafeStr_7875=t.readInt()}get stuffId(){return this._stuffId}get charges(){return this._charges}get _SafeStr_5946(){return this._SafeStr_6935}get _SafeStr_5944(){return this._SafeStr_6936}get _SafeStr_7876(){return this._SafeStr_7875}get _SafeStr_5945(){return this._SafeStr_6518}}class nU{flush(){return this._fireworkChargeData=null,!0}parse(t){return t?(this._fireworkChargeData=new rU(t),!0):!1}get fireworkChargeData(){return this._fireworkChargeData}}class aU{flush(){return!0}parse(t){return!!t}}class oU{constructor(){this._isEnabled=!1,this._price=null,this._giftWrappers=null,this._boxTypes=null,this._ribbonTypes=null,this._giftFurnis=null}flush(){return this._boxTypes=null,this._giftFurnis=null,this._giftWrappers=null,this._ribbonTypes=null,this._isEnabled=null,this._price=null,!0}parse(t){if(!t)return!1;const e=[],i=[],r=[],n=[];this._isEnabled=t.readBoolean(),this._price=t.readInt();let a=t.readInt(),o=0;for(;o<a;)e.push(t.readInt()),o++;for(a=t.readInt(),o=0;o<a;)i.push(t.readInt()),o++;for(a=t.readInt(),o=0;o<a;)r.push(t.readInt()),o++;for(a=t.readInt(),o=0;o<a;)n.push(t.readInt()),o++;return this._giftWrappers=e,this._ribbonTypes=r,this._giftFurnis=n,this._boxTypes=i,!0}get giftWrappers(){return this._giftWrappers}get ribbonTypes(){return this._ribbonTypes}get giftFurnis(){return this._giftFurnis}get boxTypes(){return this._boxTypes}get isEnabled(){return this._isEnabled}get price(){return this._price}}class hU{flush(){return this._offer=null,!0}parse(t){return t?(this._offer=new sU(t),!0):!1}get offer(){return this._offer}}class uU{flush(){return this._offers=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._offers.push(new aT(t)),e--;return!0}get offers(){return this._offers}}class lU{flush(){return this._offerId=0,this._isGiftable=!1,!0}parse(t){return t?(this._offerId=t.readInt(),this._isGiftable=t.readBoolean(),!0):!1}get offerId(){return this._offerId}get isGiftable(){return this._isGiftable}}class _U{flush(){return!0}parse(t){return!!t}}class cU{flush(){return this._appearsInSeconds=-1,this._pageId=-1,this._offerId=-1,this._productType="",!0}parse(t){return t?(this._appearsInSeconds=t.readInt(),this._pageId=t.readInt(),this._offerId=t.readInt(),this._productType=t.readString(),!0):!1}get appearsInSeconds(){return this._appearsInSeconds}get pageId(){return this._pageId}get offerId(){return this._offerId}get productType(){return this._productType}}class dU{constructor(){this._notEnoughCredits=!1,this._notEnoughActivityPoints=!1,this._activityPointType=0}flush(){return this._notEnoughCredits=!1,this._notEnoughActivityPoints=!1,this._activityPointType=0,!0}parse(t){return t?(this._notEnoughCredits=t.readBoolean(),this._notEnoughActivityPoints=t.readBoolean(),t.bytesAvailable&&(this._activityPointType=t.readInt()),!0):!1}get notEnoughCredits(){return this._notEnoughCredits}get notEnoughActivityPoints(){return this._notEnoughActivityPoints}get activityPointType(){return this._activityPointType}}class fU{flush(){return this._offer=null,!0}parse(t){return t?(this._offer=new Dl(t),!0):!1}get offer(){return this._offer}}class gU{flush(){return this._code=0,!0}parse(t){return t?(this._code=t.readInt(),!0):!1}get code(){return this._code}}class EU{flush(){return this._code=0,!0}parse(t){return t?(this._code=t.readInt(),!0):!1}get code(){return this._code}}class pU{constructor(t){if(!t)throw new Error("invalid_wrapper");this.flush(),this.parse(t)}flush(){return this._offerId=-1,this._localizationId=null,this._rent=!1,this._priceCredits=0,this._priceActivityPoints=0,this._priceActivityPointsType=0,this._clubLevel=0,this._giftable=!1,this._bundlePurchaseAllowed=!1,this._products=[],!0}parse(t){if(!t)return!1;this._offerId=t.readInt(),this._localizationId=t.readString(),this._rent=t.readBoolean(),this._priceCredits=t.readInt(),this._priceActivityPoints=t.readInt(),this._priceActivityPointsType=t.readInt(),this._giftable=t.readBoolean();let e=t.readInt();for(;e>0;)this._products.push(new Hr(t)),e--;return this._clubLevel=t.readInt(),this._bundlePurchaseAllowed=t.readBoolean(),!0}get offerId(){return this._offerId}get localizationId(){return this._localizationId}get rent(){return this._rent}get priceCredits(){return this._priceCredits}get priceActivityPoints(){return this._priceActivityPoints}get priceActivityPointsType(){return this._priceActivityPointsType}get clubLevel(){return this._clubLevel}get giftable(){return this._giftable}get bundlePurchaseAllowed(){return this._bundlePurchaseAllowed}get products(){return this._products}}class mU{flush(){return this._offer=null,!0}parse(t){return t?(this._offer=new pU(t),!0):!1}get offer(){return this._offer}}class IU{flush(){return this._clubLevel=0,this._securityLevel=0,this._isAmbassador=!1,!0}parse(t){return t?(this._clubLevel=t.readInt(),this._securityLevel=t.readInt(),this._isAmbassador=t.readBoolean(),!0):!1}get clubLevel(){return this._clubLevel}get securityLevel(){return this._securityLevel}get isAmbassador(){return this._isAmbassador}}class Ul{flush(){return!0}parse(t){return t?(this._status=t.readInt(),!0):!1}get status(){return this._status}}Ul.SAFETY_LOCK_STATUS_LOCKED=0;Ul.SAFETY_LOCK_STATUS_UNLOCKED=1;class TU{flush(){return this._result=-1,this._validationInfo="",!0}parse(t){return t?(this._result=t.readInt(),this._validationInfo=t.readString(),!0):!1}get result(){return this._result}get validationInfo(){return this._validationInfo}}class oT{flush(){return this._result=-1,!0}parse(t){return t?(this._result=t.readInt(),!0):!1}get result(){return this._result}}oT.EMAIL_STATUS_OK=0;class RU{constructor(t){if(!t)throw new Error("invalid_wrapper");this.flush(),this.parse(t)}flush(){return this._relationshipStatusType=Fn.NONE,this._friendCount=0,this._randomFriendId=0,this._randomFriendFigure=null,this._randomFriendName=null,!0}parse(t){return t?(this._relationshipStatusType=t.readInt(),this._friendCount=t.readInt(),this._randomFriendId=t.readInt(),this._randomFriendName=t.readString(),this._randomFriendFigure=t.readString(),!0):!1}get relationshipStatusType(){return this._relationshipStatusType}get friendCount(){return this._friendCount}get randomFriendId(){return this._randomFriendId}get randomFriendName(){return this._randomFriendName}get randomFriendFigure(){return this._randomFriendFigure}}class OU{flush(){return this._userId=0,this._relationshipStatusMap=null,!0}parse(t){if(!t)return!1;this._userId=t.readInt(),this._relationshipStatusMap=new Ee;const e=t.readInt();for(let i=0;i<e;i++){const r=new RU(t);this._relationshipStatusMap.add(r.relationshipStatusType,r)}return!0}get userId(){return this._userId}get relationshipStatusMap(){return this._relationshipStatusMap}}class AU{flush(){return this._userId=null,this._badges=[],!0}parse(t){if(!t)return!1;this._userId=t.readInt();let e=t.readInt();for(;e>0;){t.readInt();const i=t.readString();this._badges.push(i),e--}return!0}get userId(){return this._userId}get badges(){return this._badges}}class vU{constructor(t){if(!t)throw new Error("invalid_wrapper");this.flush(),this.parse(t)}flush(){return this._userId=0,this._username=null,this._figure=null,this._gender=null,this._motto=null,this._realName=null,this._directMail=!1,this._respectsReceived=0,this._respectsRemaining=0,this._respectsPetRemaining=0,this._streamPublishingAllowed=!1,this._lastAccessDate=null,this._canChangeName=!1,this._safetyLocked=!1,!0}parse(t){return t?(this._userId=t.readInt(),this._username=t.readString(),this._figure=t.readString(),this._gender=t.readString(),this._motto=t.readString(),this._realName=t.readString(),this._directMail=t.readBoolean(),this._respectsReceived=t.readInt(),this._respectsRemaining=t.readInt(),this._respectsPetRemaining=t.readInt(),this._streamPublishingAllowed=t.readBoolean(),this._lastAccessDate=t.readString(),this._canChangeName=t.readBoolean(),this._safetyLocked=t.readBoolean(),!0):!1}get userId(){return this._userId}get username(){return this._username}get figure(){return this._figure}get gender(){return this._gender}get motto(){return this._motto}get realName(){return this._realName}get directMail(){return this._directMail}get respectsReceived(){return this._respectsReceived}get respectsRemaining(){return this._respectsRemaining}get respectsPetRemaining(){return this._respectsPetRemaining}get streamPublishingAllowed(){return this._streamPublishingAllowed}get lastAccessedDate(){return this._lastAccessDate}get canChangeName(){return this._canChangeName}get safetyLocked(){return this._safetyLocked}}class SU{flush(){return this._userInfo=null,!0}parse(t){return!(!t||(this._userInfo=new vU(t),!this._userInfo))}get userInfo(){return this._userInfo}}class yU{flush(){return this._webId=-1,this._id=-1,this._newName="",!0}parse(t){return t?(this._webId=t.readInt(),this._id=t.readInt(),this._newName=t.readString(),!0):!1}get webId(){return this._webId}get id(){return this._id}get newName(){return this._newName}}class hT{constructor(t){this._groupId=t.readInt(),this._groupName=t.readString(),this._badgeCode=t.readString(),this._colorA=t.readString(),this._colorB=t.readString(),this._favourite=t.readBoolean(),this._ownerId=t.readInt(),this._hasForum=t.readBoolean()}get groupId(){return this._groupId}get groupName(){return this._groupName}get badgeCode(){return this._badgeCode}get colorA(){return this._colorA}get colorB(){return this._colorB}get favourite(){return this._favourite}get ownerId(){return this._ownerId}get hasForum(){return this._hasForum}}class CU{flush(){return this._id=0,this._username=null,this._figure=null,this._motto=null,this._registration=null,this._achievementPoints=0,this._friendsCount=0,this._isMyFriend=!1,this._requestSent=!1,this._isOnline=!1,this._groups=[],this._secondsSinceLastVisit=0,this._openProfileWindow=!1,!0}parse(t){if(!t)return!1;this._id=t.readInt(),this._username=t.readString(),this._figure=t.readString(),this._motto=t.readString(),this._registration=t.readString(),this._achievementPoints=t.readInt(),this._friendsCount=t.readInt(),this._isMyFriend=t.readBoolean(),this._requestSent=t.readBoolean(),this._isOnline=t.readBoolean();const e=t.readInt();for(let i=0;i<e;i++)this._groups.push(new hT(t));return this._secondsSinceLastVisit=t.readInt(),this._openProfileWindow=t.readBoolean(),!0}get id(){return this._id}get username(){return this._username}get figure(){return this._figure}get motto(){return this._motto}get registration(){return this._registration}get achievementPoints(){return this._achievementPoints}get friendsCount(){return this._friendsCount}get isMyFriend(){return this._isMyFriend}get requestSent(){return this._requestSent}get isOnline(){return this._isOnline}get groups(){return this._groups}get secondsSinceLastVisit(){return this._secondsSinceLastVisit}get openProfileWindow(){return this._openProfileWindow}}class MU{flush(){return this._volumeSystem=0,this._volumeFurni=0,this._volumeTrax=0,this._oldChat=!1,this._roomInvites=!1,this._cameraFollow=!1,this._flags=0,this._chatType=0,!0}parse(t){return t?(this._volumeSystem=t.readInt(),this._volumeFurni=t.readInt(),this._volumeTrax=t.readInt(),this._oldChat=t.readBoolean(),this._roomInvites=t.readBoolean(),this._cameraFollow=t.readBoolean(),this._flags=t.readInt(),this._chatType=t.readInt(),!0):!1}get volumeSystem(){return this._volumeSystem}get volumeFurni(){return this._volumeFurni}get volumeTrax(){return this._volumeTrax}get oldChat(){return this._oldChat}get roomInvites(){return this._roomInvites}get cameraFollow(){return this._cameraFollow}get flags(){return this._flags}get chatType(){return this._chatType}}class NU{flush(){return this._roomUnitId=-1,this._tags=[],!0}parse(t){if(!t)return!1;this._roomUnitId=t.readInt();let e=t.readInt();for(;e>0;)this._tags.push(t.readString()),e--;return!0}get roomUnitId(){return this._roomUnitId}get tags(){return this._tags}}class PU{flush(){return this._email=null,this._isVerified=!1,this._allowChange=!1,!0}parse(t){return t?(this._email=t.readString(),this._isVerified=t.readBoolean(),this._allowChange=t.readBoolean(),!0):!1}get email(){return this._email}get isVerified(){return this._isVerified}get allowChange(){return this._allowChange}}class bU{flush(){return this._userId=-1,!0}parse(t){return t?(this._userId=t.readInt(),!0):!1}get userId(){return this._userId}}class DU{flush(){return this._groupId=-1,!0}parse(t){return t?(this._groupId=t.readInt(),!0):!1}get groupId(){return this._groupId}}class LU{flush(){return this._groupId=-1,this._requester=null,!0}parse(t){return t?(this._groupId=t.readInt(),this._requester=new Ha(t),!0):!1}get groupId(){return this._groupId}get requester(){return this._requester}}class uT{flush(){return this._reason=-1,!0}parse(t){return t?(this._reason=t.readInt(),!0):!1}get reason(){return this._reason}}uT.INSUFFICIENT_SUBSCRIPTION_LEVEL=2;class UU{flush(){return this._guildId=-1,this._reason=-1,!0}parse(t){return t?(this._guildId=t.readInt(),this._reason=t.readInt(),!0):!1}get guildId(){return this._guildId}get reason(){return this._reason}}class xU{flush(){return this._groups=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._groups.push(new hT(t)),e--;return!0}get groups(){return this._groups}}class FU{flush(){return this._badges=new Map,!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;){const i=t.readInt(),r=t.readString();this._badges.set(i,r),e--}return!0}get badges(){return this._badges}}class lT{flush(){return this._reason=-1,!0}parse(t){return t?(this._reason=t.readInt(),!0):!1}get reason(){return this._reason}}lT.INSUFFICIENT_SUBSCRIPTION_LEVEL=4;class wU{flush(){return this._ignoredUsers=[],!0}parse(t){if(!t)return!1;this._ignoredUsers=[];let e=t.readInt();for(;e>0;)this._ignoredUsers.push(t.readString()),e--;return!0}get ignoredUsers(){return this._ignoredUsers}}class GU{flush(){return this._result=-1,this._name=null,!0}parse(t){return t?(this._result=t.readInt(),this._name=t.readString(),!0):!1}get result(){return this._result}get name(){return this._name}}class BU{flush(){return this._link=null,!0}parse(t){return t?(this._link=t.readString(),!0):!1}get link(){return this._link}}class HU{flush(){return this._credits=null,!0}parse(t){return t?(this._credits=t.readString(),!0):!1}get credits(){return this._credits}}class VU{flush(){return this._currencies=new Map,!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._currencies.set(t.readInt(),t.readInt()),e--;return!0}get currencies(){return this._currencies}}class gh{flush(){return this._productName=null,this._daysToPeriodEnd=0,this._memberPeriods=0,this._periodsSubscribedAhead=0,this._responseType=0,this._hasEverBeenMember=!1,this._isVip=!1,this._pastClubDays=0,this._pastVipDays=0,this._minutesUntilExpiration=0,this._minutesSinceLastModified=0,!0}parse(t){return t?(this._productName=t.readString(),this._daysToPeriodEnd=t.readInt(),this._memberPeriods=t.readInt(),this._periodsSubscribedAhead=t.readInt(),this._responseType=t.readInt(),this._hasEverBeenMember=t.readBoolean(),this._isVip=t.readBoolean(),this._pastClubDays=t.readInt(),this._pastVipDays=t.readInt(),this._minutesUntilExpiration=t.readInt(),t.bytesAvailable&&(this._minutesSinceLastModified=t.readInt()),!0):!1}get productName(){return this._productName}get daysToPeriodEnd(){return this._daysToPeriodEnd}get memberPeriods(){return this._memberPeriods}get periodsSubscribedAhead(){return this._periodsSubscribedAhead}get responseType(){return this._responseType}get hasEverBeenMember(){return this._hasEverBeenMember}get isVip(){return this._isVip}get pastClubDays(){return this._pastClubDays}get pastVipDays(){return this._pastVipDays}get minutesUntilExpiration(){return this._minutesUntilExpiration}get minutesSinceLastModified(){return this._minutesSinceLastModified}}gh.RESPONSE_TYPE_LOGIN=1;gh.RESPONSE_TYPE_PURCHASE=2;gh.RESPONSE_TYPE_DISCOUNT_AVAILABLE=3;gh.RESPONSE_TYPE_CITIZENSHIP_DISCOUNT=4;class Ga{constructor(t){if(this._unseen=0,!t)throw new Error("invalid_parser");this._achievementId=t.readInt(),this._level=t.readInt(),this._badgeId=t.readString(),this._scoreAtStartOfLevel=t.readInt(),this._scoreLimit=Math.max(1,t.readInt()),this._levelRewardPoints=t.readInt(),this._levelRewardPointType=t.readInt(),this._currentPoints=t.readInt(),this._finalLevel=t.readBoolean(),this._category=t.readString(),this._subCategory=t.readString(),this._levelCount=t.readInt(),this._displayMethod=t.readInt()}get achievementId(){return this._achievementId}get badgeId(){return this._badgeId}get level(){return this._level}get scoreAtStartOfLevel(){return this._scoreAtStartOfLevel}get scoreLimit(){return this._scoreLimit-this._scoreAtStartOfLevel}get levelRewardPoints(){return this._levelRewardPoints}get levelRewardPointType(){return this._levelRewardPointType}get currentPoints(){return this._currentPoints-this._scoreAtStartOfLevel}get finalLevel(){return this._finalLevel}get category(){return this._category}get subCategory(){return this._subCategory}get levelCount(){return this._levelCount}get firstLevelAchieved(){return this._level>1||this._finalLevel}setMaxProgress(){this._currentPoints=this._scoreLimit}get displayMethod(){return this._displayMethod}get progress(){return this._currentPoints}get toNextProgress(){return this._scoreLimit}set unseen(t){this._unseen=t}get unseen(){return this._unseen}reset(t){this._achievementId=t._achievementId,this._level=t._level,this._badgeId=t._badgeId,this._scoreAtStartOfLevel=t._scoreAtStartOfLevel,this._scoreLimit=t._scoreLimit,this._levelRewardPoints=t._levelRewardPoints,this._levelRewardPointType=t._levelRewardPointType,this._currentPoints=t._currentPoints,this._finalLevel=t._finalLevel,this._category=t.category,this._subCategory=t._subCategory,this._levelCount=t._levelCount,this._displayMethod=t._displayMethod}}Ga.DISPLAY_METHOD_OBSOLETE=-1;Ga.DISPLAY_METHOD_SHOW_LEVEL_PROGRESS=0;Ga.DISPLAY_METHOD_NEVER_SHOW_PROGRESS=1;Ga.DISPLAY_METHOD_SHOW_TOTAL_PROGRESS=2;class kU{flush(){return this._achievement=null,!0}parse(t){return t?(this._achievement=new Ga(t),!0):!1}get achievement(){return this._achievement}}const _T=class{constructor(s){this._achievementId=s.readInt(),this._level=s.readInt(),this._badgeId=s.readString(),this._requiredLevel=s.readInt(),this._state=s.readInt()}dispose(){this._achievementId=0,this._level=0,this._badgeId="",this._requiredLevel=0}get achievementId(){return this._achievementId}get level(){return this._level}get badgeId(){return this._badgeId}get requiredLevel(){return this._requiredLevel}get enabled(){return this._state===_T.STATE_SELECTABLE}get state(){return this._state}};let cT=_T;cT.STATE_SELECTABLE=0;class jU{flush(){return this._achievements=[],this._defaultCategory=null,!0}parse(t){if(!t)return!1;this._achievements=[];let e=t.readInt();for(;e>0;)this._achievements.push(new Ga(t)),e--;return this._defaultCategory=t.readString(),!0}get achievements(){return this._achievements}get defaultCategory(){return this._defaultCategory}}class zU{flush(){return this._score=0,!0}parse(t){return t?(this._score=t.readInt(),!0):!1}get score(){return this._score}}class YU{get type(){return this._type}set type(t){this._type=t}get subType(){return this._subType}set subType(t){this._subType=t}get duration(){return this._duration}set duration(t){this._duration=t}get inactiveEffectsInInventory(){return this._inactiveEffectsInInventory}set inactiveEffectsInInventory(t){this._inactiveEffectsInInventory=t}get secondsLeftIfActive(){return this._secondsLeftIfActive}set secondsLeftIfActive(t){this._secondsLeftIfActive=t}get isPermanent(){return this._permanent}set isPermanent(t){this._permanent=t}}class WU{flush(){return this._type=0,this._duration=0,this._isPermanent=!1,!0}parse(t){return t?(this._type=t.readInt(),this._duration=t.readInt(),this._isPermanent=t.readBoolean(),!0):!1}get type(){return this._type}get duration(){return this._duration}get isPermanent(){return this._isPermanent}}class XU{flush(){return this._type=0,this._subType=0,this._duration=0,this._permanent=!1,!0}parse(t){return t?(this._type=t.readInt(),this._subType=t.readInt(),this._duration=t.readInt(),this._permanent=t.readBoolean(),!0):!1}get type(){return this._type}get subType(){return this._subType}get duration(){return this._duration}get isPermanent(){return this._permanent}}class KU{flush(){return this._type=0,!0}parse(t){return t?(this._type=t.readInt(),!0):!1}get type(){return this._type}}class qU{flush(){return this._type=0,!0}parse(t){return t?(this._type=t.readInt(),!0):!1}get type(){return this._type}}class ZU{flush(){return this._effects=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;){const i=new YU;i.type=t.readInt(),i.subType=t.readInt(),i.duration=t.readInt(),i.inactiveEffectsInInventory=t.readInt(),i.secondsLeftIfActive=t.readInt(),i.isPermanent=t.readBoolean(),this._effects.push(i),e--}return!0}get effects(){return this._effects}}class QU{constructor(t,e){if(!e)throw new Error("invalid_parser");this._badgeId="ACH_"+t+e.readInt(),this._limit=e.readInt()}get badgeId(){return this._badgeId}get limit(){return this._limit}}class JU{flush(){return this._data=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;){const i=t.readString(),r=t.readInt();let n=0;for(;n<r;)this._data.push(new QU(i,t)),n++;e--}return!0}get data(){return this._data}}class $U{flush(){return this._badgeId=0,this._badgeCode=null,!0}parse(t){return t?(this._badgeId=t.readInt(),this._badgeCode=t.readString(),!0):!1}get badgeId(){return this._badgeId}get badgeCode(){return this._badgeCode}}class tx{flush(){return this._allBadgeCodes=[],this._activeBadgeCodes=null,this._badgeIds=null,!0}parse(t){if(!t)return!1;this._allBadgeCodes=[],this._activeBadgeCodes=[],this._badgeIds=new Ee;let e=t.readInt();for(;e>0;){const i=t.readInt(),r=t.readString();this._badgeIds.add(r,i),this._allBadgeCodes.push(r),e--}for(e=t.readInt();e>0;){t.readInt();const i=t.readString();this._activeBadgeCodes.push(i),e--}return!0}getBadgeId(t){return this._badgeIds.getValue(t)}getAllBadgeCodes(){return this._allBadgeCodes}getActiveBadgeCodes(){return this._activeBadgeCodes}}class ex{flush(){return!0}parse(t){return t?(this._requestCode=t.readString(),this._fulfilled=t.readBoolean(),!0):!1}get requestCode(){return this._requestCode}get fulfilled(){return this._fulfilled}}class sx{flush(){return this._figureSetIds=[],this._boundFurnitureNames=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._figureSetIds.push(t.readInt()),e--;let i=t.readInt();for(;i>0;)this._boundFurnitureNames.push(t.readString()),i--;return!0}get figureSetIds(){return this._figureSetIds}get boundsFurnitureNames(){return this._boundFurnitureNames}}class Eh{flush(){return this._reason=0,this._parameter="",!0}parse(t){return t?(this._reason=t.readInt(),this._parameter=t.readString(),!0):!1}get reason(){return this._reason}get parameter(){return this._parameter}}Eh.REASON_FULL=1;Eh.REASON_CLOSED=2;Eh.REASON_QUEUE_ERROR=3;Eh.REASON_BANNED=4;class ix{flush(){return this._userName=null,!0}parse(t){return t?(this._userName=t.readString(),!0):!1}get userName(){return this._userName}}class rx{flush(){return!0}parse(t){return!!t}}class nx{flush(){return!0}parse(t){return!!t}}class ax{flush(){return this._controllerLevel=ms.NONE,!0}parse(t){return t?(this._controllerLevel=t.readInt(),!0):!1}get controllerLevel(){return this._controllerLevel}}class ox{flush(){return!0}parse(t){return!!t}}class hx{flush(){return this._roomId=0,!0}parse(t){return t?(this._roomId=t.readInt(),!0):!1}get roomId(){return this._roomId}}class ux{flush(){return this._botId=-1,this._commandId=-1,this._data="",!0}parse(t){return t?(this._botId=t.readInt(),this._commandId=t.readInt(),this._data=t.readString(),!0):!1}get botId(){return this._botId}get commandId(){return this._commandId}get data(){return this._data}}class lx{flush(){return this._botId=-1,!0}parse(t){return t?(this._botId=t.readInt(),!0):!1}get botId(){return this._botId}}class _x{constructor(t){this._id=t.readInt(),this._data=t.readString()}get id(){return this._id}get data(){return this._data}}class cx{flush(){return this._botId=-1,this._skillList=[],!0}parse(t){if(!t)return!1;this._botId=t.readInt();let e=t.readInt();for(;e>0;)this._skillList.push(new _x(t)),e--;return!0}get botId(){return this._botId}get skillList(){return this._skillList}}class dx{constructor(t){this._userId=t.readInt(),this._userName=t.readString()}get userId(){return this._userId}get userName(){return this._userName}}class fx{flush(){return this._roomId=0,this._bannedUsers=[],!0}parse(t){if(!t)return!1;this._roomId=t.readInt();let e=t.readInt();for(;e>0;)this._bannedUsers.push(new dx(t)),e--;return!0}get roomId(){return this._roomId}get bannedUsers(){return this._bannedUsers}}class gx{constructor(t){this._userId=t.readInt(),this._userName=t.readString()}get userId(){return this._userId}get userName(){return this._userName}get selected(){return this._selected}set selected(t){this._selected=t}}class Ex{flush(){return this._roomId=0,this._data=null,!0}parse(t){return t?(this._roomId=t.readInt(),this._data=new gx(t),!0):!1}get roomId(){return this._roomId}get data(){return this._data}}class px{flush(){return this._roomId=0,this._userId=0,!0}parse(t){return t?(this._roomId=t.readInt(),this._userId=t.readInt(),!0):!1}get roomId(){return this._roomId}get userId(){return this._userId}}class mx{flush(){return this._roomId=0,this._users=new Map,!0}parse(t){if(!t)return!1;this._roomId=t.readInt();let e=t.readInt();for(;e>0;){const i=t.readInt(),r=t.readString();this._users.set(i,r),e--}return!0}get roomId(){return this._roomId}get users(){return this._users}}class Ix{flush(){return!0}parse(t){return t?(this._isMuted=t.readBoolean(),!0):!1}get isMuted(){return this._isMuted}}class Tx{flush(){return this._roomId=0,!0}parse(t){return t?(this._roomId=t.readInt(),!0):!1}get roomId(){return this._roomId}}class ds{constructor(t){if(!t)throw new Error("invalid_wrapper");this._mode=t.readInt(),this._weight=t.readInt(),this._speed=t.readInt(),this._distance=t.readInt(),this._protection=t.readInt()}get mode(){return this._mode}get weight(){return this._weight}get speed(){return this._speed}get distance(){return this._distance}get protection(){return this._protection}}ds.CHAT_MODE_FREE_FLOW=0;ds.CHAT_MODE_LINE_BY_LINE=1;ds.CHAT_BUBBLE_WIDTH_WIDE=0;ds.CHAT_BUBBLE_WIDTH_NORMAL=1;ds.CHAT_BUBBLE_WIDTH_THIN=2;ds.CHAT_SCROLL_SPEED_FAST=0;ds.CHAT_SCROLL_SPEED_NORMAL=1;ds.CHAT_SCROLL_SPEED_SLOW=2;ds.FLOOD_FILTER_STRICT=0;ds.FLOOD_FILTER_NORMAL=1;ds.FLOOD_FILTER_LOOSE=2;class ph{constructor(t){this._allowMute=t.readInt(),this._allowKick=t.readInt(),this._allowBan=t.readInt()}get allowMute(){return this._allowMute}get allowKick(){return this._allowKick}get allowBan(){return this._allowBan}}ph.MODERATION_LEVEL_NONE=0;ph.MODERATION_LEVEL_USER_WITH_RIGHTS=1;ph.MODERATION_LEVEL_ALL=2;const Ci=class{constructor(){this._roomId=-1,this._name=null,this._description=null,this._doorMode=Ci.DOORMODE_OPEN,this._categoryId=-1,this._maximumVisitors=0,this._maximumVisitorsLimit=0,this._tags=[],this._tradeMode=Ci.TRADEMODE_NOT_ALLOWED,this._allowPets=!1,this._allowFoodConsume=!1,this._allowWalkThrough=!1,this._hideWalls=!1,this._wallThickness=0,this._floorThickness=0,this._controllersById=new Map,this._controllerList=null,this._highlightedUserId=-1,this._bannedUsersById=new Map,this._bannedUsersList=null,this._roomModerationSettings=null,this._chatSettings=null,this._allowNavigatorDynamicCats=!1}static from(s){const t=new Ci;return t._roomId=s._roomId,t._name=s._name,t._description=s._description,t._doorMode=s._doorMode,t._categoryId=s._categoryId,t._maximumVisitors=s._maximumVisitors,t._maximumVisitorsLimit=s._maximumVisitorsLimit,t._tags=s._tags,t._tradeMode=s._tradeMode,t._allowPets=s._allowPets,t._allowFoodConsume=s._allowFoodConsume,t._allowWalkThrough=s._allowWalkThrough,t._hideWalls=s._hideWalls,t._wallThickness=s._wallThickness,t._floorThickness=s._floorThickness,t._controllersById=s._controllersById,t._controllerList=s._controllerList,t._highlightedUserId=s._highlightedUserId,t._bannedUsersById=s._bannedUsersById,t._bannedUsersList=s._bannedUsersList,t._roomModerationSettings=s._roomModerationSettings,t._chatSettings=s._chatSettings,t._allowNavigatorDynamicCats=s._allowNavigatorDynamicCats,t}static getDoorModeLocalizationKey(s){switch(s){case Ci.DOORMODE_OPEN:return"${navigator.door.mode.open}";case Ci.DOORMODE_CLOSED:return"${navigator.door.mode.closed}";case Ci.DOORMODE_PASSWORD:return"${navigator.door.mode.password}";case Ci.DOORMODE_INVISIBLE:return"${navigator.door.mode.invisible}";case Ci.DOORMODE_NOOBS_ONLY:return"${navigator.door.mode.noobs_only}"}return""}get tradeMode(){return this._tradeMode}set tradeMode(s){this._tradeMode=s}get allowPets(){return this._allowPets}set allowPets(s){this._allowPets=s}get allowFoodConsume(){return this._allowFoodConsume}set allowFoodConsume(s){this._allowFoodConsume=s}get allowWalkThrough(){return this._allowWalkThrough}set allowWalkThrough(s){this._allowWalkThrough=s}get hideWalls(){return this._hideWalls}set hideWalls(s){this._hideWalls=s}get wallThickness(){return this._wallThickness}set wallThickness(s){this._wallThickness=s}get floorThickness(){return this._floorThickness}set floorThickness(s){this._floorThickness=s}get roomId(){return this._roomId}set roomId(s){this._roomId=s}get name(){return this._name}set name(s){this._name=s}get description(){return this._description}set description(s){this._description=s}get doorMode(){return this._doorMode}set doorMode(s){this._doorMode=s}get categoryId(){return this._categoryId}set categoryId(s){this._categoryId=s}get maximumVisitors(){return this._maximumVisitors}set maximumVisitors(s){this._maximumVisitors=s}get maximumVisitorsLimit(){return this._maximumVisitorsLimit}set maximumVisitorsLimit(s){this._maximumVisitorsLimit=s}get tags(){return this._tags}set tags(s){this._tags=s}setFlatController(s,t){this._controllersById.set(s,t),this._controllerList=null,this._highlightedUserId=s}get roomModerationSettings(){return this._roomModerationSettings}set roomModerationSettings(s){this._roomModerationSettings=s}get controllersById(){return this._controllersById}set controllersById(s){this._controllersById=s}get controllerList(){if(!this._controllerList){this._controllerList=[];for(const s of this._controllersById.values())this._controllerList.push(s);this._controllerList.sort((s,t)=>s.userName.localeCompare(t.userName))}return this._controllerList}get highlightedUserId(){return this._highlightedUserId}setBannedUser(s,t){this._bannedUsersById.set(s,t),this._bannedUsersList=null}get bannedUsersById(){return this._bannedUsersById}get bannedUsersList(){if(!this._bannedUsersList){this._bannedUsersList=[];for(const s of this._bannedUsersById.values())this._bannedUsersList.push(s);this._bannedUsersList.sort((s,t)=>s.userName.localeCompare(t.userName))}return this._bannedUsersList}get chatSettings(){return this._chatSettings}set chatSettings(s){this._chatSettings=s}get allowNavigatorDynamicCats(){return this._allowNavigatorDynamicCats}set allowNavigatorDynamicCats(s){this._allowNavigatorDynamicCats=s}};let ir=Ci;ir.DOORMODE_OPEN=0;ir.DOORMODE_CLOSED=1;ir.DOORMODE_PASSWORD=2;ir.DOORMODE_INVISIBLE=3;ir.DOORMODE_NOOBS_ONLY=4;ir.TRADEMODE_NOT_ALLOWED=0;ir.TRADEMODE_WITH_CONTROLLER=1;ir.TRADEMODE_ALLOWED=2;class Rx{flush(){return this._roomSettingsData=null,!0}parse(t){if(!t)return!1;this._roomSettingsData=new ir,this._roomSettingsData.roomId=t.readInt(),this._roomSettingsData.name=t.readString(),this._roomSettingsData.description=t.readString(),this._roomSettingsData.doorMode=t.readInt(),this._roomSettingsData.categoryId=t.readInt(),this._roomSettingsData.maximumVisitors=t.readInt(),this._roomSettingsData.maximumVisitorsLimit=t.readInt(),this._roomSettingsData.tags=[];let e=t.readInt();for(;e>0;)this._roomSettingsData.tags.push(t.readString()),e--;return this._roomSettingsData.tradeMode=t.readInt(),this._roomSettingsData.allowPets=t.readInt()===1,this._roomSettingsData.allowFoodConsume=t.readInt()===1,this._roomSettingsData.allowWalkThrough=t.readInt()===1,this._roomSettingsData.hideWalls=t.readInt()===1,this._roomSettingsData.wallThickness=t.readInt(),this._roomSettingsData.floorThickness=t.readInt(),this._roomSettingsData.chatSettings=new ds(t),this._roomSettingsData.allowNavigatorDynamicCats=t.readBoolean(),this._roomSettingsData.roomModerationSettings=new ph(t),!0}get data(){return this._roomSettingsData}}class Ox{flush(){return this._roomId=0,this._code=0,!0}parse(t){return t?(this._roomId=t.readInt(),this._code=t.readInt(),!0):!1}get roomId(){return this._roomId}get code(){return this._code}}class Ax{flush(){return this._roomId=0,!0}parse(t){return t?(this._roomId=t.readInt(),!0):!1}get roomId(){return this._roomId}}class fs{flush(){return this._roomId=0,this._code=0,this._message=null,!0}parse(t){return t?(this._roomId=t.readInt(),this._code=t.readInt(),this._message=t.readString(),!0):!1}get roomId(){return this._roomId}get code(){return this._code}get message(){return this._message}}fs.ERROR_ROOM_NOT_FOUND=1;fs.ERROR_NOT_OWNER=2;fs.ERROR_INVALID_DOOR_MODE=3;fs.ERROR_INVALID_USER_LIMIT=4;fs.ERROR_INVALID_PASSWORD=5;fs.ERROR_INVALID_CATEGORY=6;fs.ERROR_INVALID_NAME=7;fs.ERROR_UNACCEPTABLE_NAME=8;fs.ERROR_INVALID_DESCRIPTION=9;fs.ERROR_UNACCEPTABLE_DESCRIPTION=10;fs.ERROR_INVALID_TAG=11;fs.ERROR_NON_USER_CHOOSABLE_TAG=12;fs.ERROR_TOO_MANY_CHARACTERS_IN_TAG=13;class vx{flush(){return this._selectionType=0,!0}parse(t){return t?(this._selectionType=t.readInt(),!0):!1}get selectionType(){return this._selectionType}}class Sx{flush(){return this._roomId=0,this._userId=0,!0}parse(t){return t?(this._roomId=t.readInt(),this._userId=t.readInt(),!0):!1}get roomId(){return this._roomId}get userId(){return this._userId}}class yx{flush(){return this._chat=null,!0}parse(t){return t?(this._chat=new ds(t),!0):!1}get chat(){return this._chat}}const an=class{constructor(s){if(!s)throw new Error("invalid_wrapper");this.flush(),this.parse(s)}flush(){return this._roomId=0,this._roomName=null,this._ownerId=0,this._ownerName=null,this._doorMode=0,this._userCount=0,this._maxUserCount=0,this._description=null,this._tradeMode=2,this._score=0,this._ranking=0,this._categoryId=0,this._totalStars=0,this._groupId=0,this._groupName=null,this._groupBadge=null,this._tags=[],this._bitMask=0,this._thumbnail=null,this._allowPets=!1,this._showOwner=!0,this._displayAd=!1,this._adName=null,this._adDescription=null,this._adExpiresIn=0,this._allInRoomMuted=!1,this._canMute=!1,this._officialRoomPicRef=null,!0}parse(s){return s?(this._roomId=s.readInt(),this._roomName=s.readString(),this._ownerId=s.readInt(),this._ownerName=s.readString(),this._doorMode=s.readInt(),this._userCount=s.readInt(),this._maxUserCount=s.readInt(),this._description=s.readString(),this._tradeMode=s.readInt(),this._score=s.readInt(),this._ranking=s.readInt(),this._categoryId=s.readInt(),this.parseTags(s),this.parseBitMask(s),!0):!1}parseTags(s){if(!s)return!1;this._tags=[];let t=s.readInt();for(;t>0;)this._tags.push(s.readString()),t--;return!0}parseBitMask(s){return s?(this._bitMask=s.readInt(),this._bitMask&an.THUMBNAIL_BITMASK&&(this._officialRoomPicRef=s.readString()),this._bitMask&an.GROUPDATA_BITMASK&&(this._groupId=s.readInt(),this._groupName=s.readString(),this._groupBadge=s.readString()),this._bitMask&an.ROOMAD_BITMASK&&(this._adName=s.readString(),this._adDescription=s.readString(),this._adExpiresIn=s.readInt()),this._showOwner=(this._bitMask&an.SHOWOWNER_BITMASK)>0,this._allowPets=(this._bitMask&an.ALLOW_PETS_BITMASK)>0,this._displayAd=(this._bitMask&an.DISPLAY_ROOMAD_BITMASK)>0,this._thumbnail=null,!0):!1}get roomId(){return this._roomId}get roomName(){return this._roomName}set roomName(s){this._roomName=s}get ownerId(){return this._ownerId}get ownerName(){return this._ownerName}get doorMode(){return this._doorMode}get userCount(){return this._userCount}get maxUserCount(){return this._maxUserCount}get description(){return this._description}get tradeMode(){return this._tradeMode}get score(){return this._score}get ranking(){return this._ranking}get categoryId(){return this._categoryId}get tags(){return this._tags}get officialRoomPicRef(){return this._officialRoomPicRef}get habboGroupId(){return this._groupId}get groupName(){return this._groupName}get groupBadgeCode(){return this._groupBadge}get roomAdName(){return this._adName}get roomAdDescription(){return this._adDescription}get roomAdExpiresInMin(){return this._adExpiresIn}get showOwner(){return this._showOwner}get allowPets(){return this._allowPets}get displayRoomEntryAd(){return this._displayAd}get canMute(){return this._canMute}set canMute(s){this._canMute=s}get allInRoomMuted(){return this._allInRoomMuted}set allInRoomMuted(s){this._allInRoomMuted=s}};let is=an;is.THUMBNAIL_BITMASK=1;is.GROUPDATA_BITMASK=2;is.ROOMAD_BITMASK=4;is.SHOWOWNER_BITMASK=8;is.ALLOW_PETS_BITMASK=16;is.DISPLAY_ROOMAD_BITMASK=32;is.OPEN_STATE=0;is.DOORBELL_STATE=1;is.PASSWORD_STATE=2;is.INVISIBLE_STATE=3;is.NOOB_STATE=4;class Cx{flush(){return this._roomId=0,this._isOwner=!1,!0}parse(t){return t?(this._roomId=t.readInt(),this._isOwner=t.readBoolean(),!0):!1}get roomId(){return this._roomId}get isOwner(){return this._isOwner}}class Mx{flush(){return this._totalLikes=0,this._canLike=!1,!0}parse(t){return t?(this._totalLikes=t.readInt(),this._canLike=t.readBoolean(),!0):!1}get totalLikes(){return this._totalLikes}get canLike(){return this._canLike}}class Nx{flush(){return this._roomIndex=-1,this._groupId=-1,this._status=0,this._groupName=null,!0}parse(t){return t?(this._roomIndex=t.readInt(),this._groupId=t.readInt(),this._status=t.readInt(),this._groupName=t.readString(),!0):!1}get roomIndex(){return this._roomIndex}get groupId(){return this._groupId}get status(){return this._status}get groupName(){return this._groupName}}class Px{constructor(t,e,i){this._id=0,this._state=0,this._id=t,this._state=e,this._data=i}get id(){return this._id}get state(){return this._state}get data(){return this._data}}class bx{flush(){return this._code=0,!0}parse(t){return t?(this._code=t.readInt(),!0):!1}get count(){return this._code}}class Dx{flush(){return this._itemId=0,this._value=0,!0}parse(t){return t?(this._itemId=t.readInt(),this._value=t.readInt(),!0):!1}get itemId(){return this._itemId}get value(){return this._value}}class Vr{flush(){return this._itemId=0,this._data=null,!0}parse(t){return t?(this._itemId=parseInt(t.readString()),this._data=Vr.parseObjectData(t),!0):!1}static parseObjectData(t){if(!t)return null;const e=vr.getData(t.readInt());return e?(e.parseWrapper(t),e):null}get furnitureId(){return this._itemId}get objectData(){return this._data}}class xf{constructor(t){if(!t)throw new Error("invalid_wrapper");this.flush(),this.parse(t)}flush(){return this._itemId=0,this._spriteId=0,this._spriteName=null,this._x=0,this._y=0,this._direction=0,this._z=0,this._stackHeight=0,this._extra=0,this._data=null,this._state=0,this._expires=0,this._usagePolicy=0,this._userId=0,this._username=null,!0}parse(t){return t?(this._itemId=t.readInt(),this._spriteId=t.readInt(),this._x=t.readInt(),this._y=t.readInt(),this._direction=t.readInt()%8*45,this._z=parseFloat(t.readString()),this._stackHeight=parseFloat(t.readString()),this._extra=t.readInt(),this._data=Vr.parseObjectData(t),this._state=parseFloat(this._data&&this._data.getLegacyString())||0,this._expires=t.readInt(),this._usagePolicy=t.readInt(),this._userId=t.readInt(),this._username=null,this._spriteId<0&&(this._spriteName=t.readString()),!0):!1}get itemId(){return this._itemId}get spriteId(){return this._spriteId}get x(){return this._x}get y(){return this._y}get direction(){return this._direction}get z(){return isNaN(this._z)?0:this._z}get stackHeight(){return isNaN(this._stackHeight)?0:this._stackHeight}get extra(){return this._extra}get data(){return this._data}get state(){return this._state}get expires(){return this._expires}get usagePolicy(){return this._usagePolicy}get userId(){return this._userId}get username(){return this._username}set username(t){this._username=t}get spriteName(){return this._spriteName}set spriteName(t){this._spriteName=t}}class Lx{flush(){return this._item=null,!0}parse(t){return t?(this._item=new xf(t),this._item.username=t.readString(),!0):!1}get item(){return this._item}}class Ux{flush(){return this._owners=new Map,this._items=[],!0}parse(t){if(!t||!this.parseOwners(t))return!1;let e=t.readInt();for(;e>0;){const i=new xf(t);if(!i)continue;const r=this._owners.get(i.userId);r&&(i.username=r),this._items.push(i),e--}return!0}parseOwners(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._owners.set(t.readInt(),t.readString()),e--;return!0}get owners(){return this._owners}get items(){return this._items}}class xx{flush(){return this._itemId=0,this._isExpired=!0,this._userId=0,this._delay=0,!0}parse(t){return t?(this._itemId=parseInt(t.readString()),this._isExpired=t.readBoolean(),this._userId=t.readInt(),this._delay=t.readInt(),!0):!1}get itemId(){return this._itemId}get isExpired(){return this._isExpired}get userId(){return this._userId}get delay(){return this._delay}}class Fx{flush(){return this._item=null,!0}parse(t){return t?(this._item=new xf(t),!0):!1}get item(){return this._item}}class wx{flush(){return this._isWallItem=!1,this._furniTypeName=null,this._buyout=!1,this._priceInCredits=-1,this._priceInActivityPoints=-1,this._activityPointType=-1,!0}parse(t){return t?(this._isWallItem=t.readBoolean(),this._furniTypeName=t.readString(),this._buyout=t.readBoolean(),this._priceInCredits=t.readInt(),this._priceInActivityPoints=t.readInt(),this._activityPointType=t.readInt(),!0):!1}get isWallItem(){return this._isWallItem}get furniTypeName(){return this._furniTypeName}get buyout(){return this._buyout}get priceInCredits(){return this._priceInCredits}get priceInActivityPoints(){return this._priceInActivityPoints}get activityPointType(){return this._activityPointType}}class Gx{flush(){return this._aliases=new Map,!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._aliases.set(t.readString(),t.readString()),e--;return!0}get aliases(){return this._aliases}}class Bx{flush(){return this._furniId=-1,this._height=0,!0}parse(t){return t?(this._furniId=t.readInt(),this._height=t.readInt()/100,!0):!1}get furniId(){return this._furniId}get height(){return this._height}}class Hx{flush(){return this._objectId=0,this._guildId=0,this._guildName=null,this._guildHomeRoomId=0,this._userIsMember=!1,this._guildHasReadableForum=!1,!0}parse(t){return t?(this._objectId=t.readInt(),this._guildId=t.readInt(),this._guildName=t.readString(),this._guildHomeRoomId=t.readInt(),this._userIsMember=t.readBoolean(),this._guildHasReadableForum=t.readBoolean(),!0):!1}get objectId(){return this._objectId}get guildId(){return this._guildId}get guildName(){return this._guildName}get guildHomeRoomId(){return this._guildHomeRoomId}get userIsMember(){return this._userIsMember}get guildHasReadableForum(){return this._guildHasReadableForum}}class Vx{flush(){return this._itemId=0,this._data="",!0}parse(t){return t?(this._itemId=parseInt(t.readString()),this._data=t.readString(),!0):!1}get furnitureId(){return this._itemId}get data(){return this._data}}class kx{get furniId(){return this._furniId}flush(){return this._furniId=-1,!0}parse(t){return this._furniId=t.readInt(),!0}}class jx{get furniId(){return this._furniId}flush(){return this._furniId=-1,!0}parse(t){return this._furniId=t.readInt(),!0}}class zx{get furniId(){return this._furniId}get start(){return this._start}flush(){return this._furniId=-1,this._start=!1,!0}parse(t){return this._furniId=t.readInt(),this._start=t.readBoolean(),!0}}class Yx{flush(){return this._itemId=0,this._state=0,!0}parse(t){return t?(this._itemId=t.readInt(),this._state=t.readInt(),!0):!1}get itemId(){return this._itemId}get state(){return this._state}}class Wx{flush(){return!0}parse(t){return t?(this._reason=t.readInt(),!0):!1}get reason(){return this._reason}}class Xx{flush(){return!0}parse(t){return t?(this._expiryTime=t.readInt(),!0):!1}get expiryTime(){return this._expiryTime}}class Ks{flush(){return this._rented=!1,this._renterId=-1,this._renterName=null,this._canRent=!1,this._canRentErrorCode=-1,this._timeRemaining=-1,this._price=-1,!0}parse(t){return t?(this._rented=t.readBoolean(),this._canRentErrorCode=t.readInt(),this._canRent=this._canRentErrorCode===0,this._renterId=t.readInt(),this._renterName=t.readString(),this._timeRemaining=t.readInt(),this._price=t.readInt(),this._rented||(this._renterId=-1,this._renterName=""),!0):!1}get rented(){return this._rented}get renterId(){return this._renterId}get renterName(){return this._renterName}get canRent(){return this._canRent}get price(){return this._price}get timeRemaining(){return this._timeRemaining}get canRentErrorCode(){return this._canRentErrorCode}}Ks.SPACE_ALREADY_RENTED=100;Ks.SPACE_EXTEND_NOT_RENTED=101;Ks.SPACE_EXTEND_NOT_RENTED_BY_YOU=102;Ks.CAN_RENT_ONLY_ONE_SPACE=103;Ks.NOT_ENOUGH_CREDITS=200;Ks.NOT_ENOUGH_PIXELS=201;Ks.CANT_RENT_NO_PERMISSION=202;Ks.CANT_RENT_NO_HABBO_CLUB=203;Ks.CANT_RENT=300;Ks.CANT_RENT_GENERIC=400;class Kx{flush(){return this._itemId=-1,this._location="",!0}parse(t){return t?(this._itemId=t.readInt(),this._location=t.readString(),!0):!1}get itemId(){return this._itemId}get location(){return this._location}}class qx{constructor(t,e,i,r){this.id=t,this.type=e,this.color=i,this.brightness=r}}class Zx{constructor(){this._selectedPresetId=0,this._presets=[]}flush(){return this._presets=[],!0}parse(t){const e=t.readInt();this._selectedPresetId=t.readInt();for(let i=0;i<e;i++){const r=t.readInt(),n=t.readInt(),a=parseInt(t.readString().substr(1),16),o=t.readInt();this._presets.push(new qx(r,n,a,o))}return!0}getPreset(t){return t<0||t>=this.presetCount?null:this._presets[t]}get presetCount(){return this._presets.length}get selectedPresetId(){return this._selectedPresetId}}class Qx{flush(){return this._roomId=-1,this._roomName=null,this._messageCount=-1,!0}parse(t){return t?(this._roomId=t.readInt(),this._roomName=t.readString(),this._messageCount=t.readInt(),!0):!1}get roomId(){return this._roomId}get roomName(){return this._roomName}get messageCount(){return this._messageCount}}class Ff{constructor(t){if(!t)throw new Error("invalid_wrapper");this.flush(),this.parse(t)}flush(){return this._itemId=0,this._spriteId=0,this._location=null,this._stuffData=null,this._state=0,this._secondsToExpiration=0,this._usagePolicy=-1,this._userId=0,this._username=null,this._width=0,this._height=0,this._localX=0,this._localY=0,this._y=0,this._z=0,this._direction=null,this._isOldFormat=!1,!0}parse(t){if(!t)return!1;this._itemId=parseInt(t.readString()),this._spriteId=t.readInt(),this._location=t.readString(),this._stuffData=t.readString(),this._secondsToExpiration=t.readInt(),this._usagePolicy=t.readInt(),this._userId=t.readInt(),this._username=null;const e=parseFloat(this._stuffData);if(isNaN(e)||(this._state=Math.trunc(e)),this._location.indexOf(":")===0){this._isOldFormat=!1;let i=this._location.split(" ");if(i.length>=3){let r=i[0],n=i[1];const a=i[2];if(r.length>3&&n.length>2&&(r=r.substr(3),n=n.substr(2),i=r.split(","),i.length>=2)){const o=parseInt(i[0]),h=parseInt(i[1]);if(i=n.split(","),i.length>=2){const u=parseInt(i[0]),c=parseInt(i[1]);this._width=o,this._height=h,this._localX=u,this._localY=c,this._direction=a}}}}else this._isOldFormat=!0;return!0}get itemId(){return this._itemId}get spriteId(){return this._spriteId}get wallPosition(){return this._location}get stuffData(){return this._stuffData}get state(){return this._state}get secondsToExpiration(){return this._secondsToExpiration}get usagePolicy(){return this._usagePolicy}get userId(){return this._userId}get username(){return this._username}set username(t){this._username=t}get width(){return this._width}get height(){return this._height}get localX(){return this._localX}get localY(){return this._localY}get direction(){return this._direction}get isOldFormat(){return this._isOldFormat}}class Jx{flush(){return this._item=null,!0}parse(t){return t?(this._item=new Ff(t),this._item.username=t.readString(),!0):!1}get item(){return this._item}}class $x{flush(){return this._owners=new Map,this._items=[],!0}parse(t){if(!t||!this.parseOwners(t))return!1;let e=t.readInt();for(;e>0;){const i=new Ff(t);if(!i)continue;const r=this._owners.get(i.userId);r&&(i.username=r),this._items.push(i),e--}return!0}parseOwners(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._owners.set(t.readInt(),t.readString()),e--;return!0}get owners(){return this._owners}get items(){return this._items}}class t1{flush(){return this._itemId=0,this._userId=0,!0}parse(t){return t?(this._itemId=parseInt(t.readString()),this._userId=t.readInt(),!0):!1}get itemId(){return this._itemId}get userId(){return this._userId}}class e1{flush(){return this._item=null,!0}parse(t){return t?(this._item=new Ff(t),!0):!1}get item(){return this._item}}class s1{flush(){return this._email=null,this._isVerified=!1,this._allowChange=!1,this._furniId=-1,this._requestedByUser=!1,!0}parse(t){return t?(this._email=t.readString(),this._isVerified=t.readBoolean(),this._allowChange=t.readBoolean(),this._furniId=t.readInt(),this._requestedByUser=t.readBoolean(),!0):!1}get email(){return this._email}get isVerified(){return this._isVerified}get allowChange(){return this._allowChange}get furniId(){return this._furniId}get requestedByUser(){return this._requestedByUser}}class i1{parse(t){return this._furniId=t.readInt(),this._commandId=t.readInt(),!0}flush(){return this._furniId=-1,this._commandId=-1,!0}get furniId(){return this._furniId}get commandId(){return this._commandId}}class r1{constructor(t,e,i){this._video=t,this._title=e,this._description=i}get video(){return this._video}get title(){return this._title}get description(){return this._description}}class n1{flush(){return this._furniId=-1,this._playlists=null,this._selectedPlaylistId=null,!0}parse(t){this._furniId=t.readInt();const e=t.readInt();this._playlists=[];for(let i=0;i<e;i++)this._playlists.push(new r1(t.readString(),t.readString(),t.readString()));return this._selectedPlaylistId=t.readString(),!0}get furniId(){return this._furniId}get playlists(){return this._playlists}get selectedPlaylistId(){return this._selectedPlaylistId}}class a1{flush(){return!0}parse(t){return this._furniId=t.readInt(),this._videoId=t.readString(),this._startAtSeconds=t.readInt(),this._endAtSeconds=t.readInt(),this._state=t.readInt(),!0}get furniId(){return this._furniId}get videoId(){return this._videoId}get state(){return this._state}get startAtSeconds(){return this._startAtSeconds}get endAtSeconds(){return this._endAtSeconds}}class o1{flush(){return this._objects=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;){const i=t.readInt(),r=Vr.parseObjectData(t),n=parseFloat(r.getLegacyString());this._objects.push(new Px(i,n,r)),e--}return!0}get objects(){return this._objects}}class h1{flush(){return this._rollerId=0,this._itemsRolling=[],this._unitRolling=null,!0}parse(t){if(!t)return!1;const e=t.readInt(),i=t.readInt(),r=t.readInt(),n=t.readInt();let a=t.readInt();for(;a>0;){const l=t.readInt(),_=parseFloat(t.readString()),d=parseFloat(t.readString()),g=new Hi(l,new S(e,i,_),new S(r,n,d));this._itemsRolling.push(g),a--}if(this._rollerId=t.readInt(),!t.bytesAvailable)return!0;const o=t.readInt(),h=t.readInt(),u=parseFloat(t.readString()),c=parseFloat(t.readString());switch(o){case 0:break;case 1:this._unitRolling=new Hi(h,new S(e,i,u),new S(r,n,c),Hi.MOVE);break;case 2:this._unitRolling=new Hi(h,new S(e,i,u),new S(r,n,c),Hi.SLIDE);break}return!0}get rollerId(){return this._rollerId}get itemsRolling(){return this._itemsRolling}get unitRolling(){return this._unitRolling}}const Jc=class{flush(){return this._model=null,this._width=0,this._height=0,this._wallHeight=-1,this._heightMap=[],this._scale=64,this._model=null,!0}parse(s){if(!s)return!1;const t=s.readBoolean(),e=s.readInt(),i=s.readString();return this.parseExplicitly(i,e,t)}parseModel(s,t,e=!0){return this.parseExplicitly(s,t,e)}parseExplicitly(s,t,e=!0){this._scale=e?32:64,this._wallHeight=t,this._model=s;const i=this._model.split("\r"),r=i.length;let n=0,a=0;for(;a<r;){const o=i[a];o.length>n&&(n=o.length),a++}for(this._heightMap=[],a=0;a<r;){const o=[];let h=0;for(;h<n;)o.push(Jc.TILE_BLOCKED),h++;this._heightMap.push(o),a++}for(this._width=n,this._height=r,a=0;a<r;){const o=this._heightMap[a],h=i[a];if(h.length>0){let u=0;for(;u<h.length;){const c=h.charAt(u);let l=Jc.TILE_BLOCKED;c!=="x"&&c!=="X"&&(l=parseInt(c,36)),o[u]=l,u++}}a++}return!0}getHeight(s,t){if(s<0||s>=this._width||t<0||t>=this._height)return-110;const e=this._heightMap[t];if(e===void 0)return-110;const i=e[s];return i===void 0?-110:i}get model(){return this._model}get width(){return this._width}get height(){return this._height}get heightMap(){return this._heightMap}get wallHeight(){return this._wallHeight}get scale(){return this._scale}};let wf=Jc;wf.TILE_BLOCKED=-110;class u1{flush(){return this._x=0,this._y=0,this._direction=0,!0}parse(t){return t?(this._x=t.readInt(),this._y=t.readInt(),this._direction=t.readInt(),!0):!1}get x(){return this._x}get y(){return this._y}get direction(){return this._direction}}class Pr{static decodeTileHeight(t){return t<0?-1:(t&16383)/256}static decodeIsStackingBlocked(t){return!!(t&16384)}static decodeIsRoomTile(t){return t>=0}getTileHeight(t,e){return t<0||t>=this._width||e<0||e>=this._height?-1:Pr.decodeTileHeight(this._heights[e*this._width+t])}getStackingBlocked(t,e){return t<0||t>=this._width||e<0||e>=this._height?!0:Pr.decodeIsStackingBlocked(this._heights[e*this._width+t])}isRoomTile(t,e){return t<0||t>=this._width||e<0||e>=this._height?!1:Pr.decodeIsRoomTile(this._heights[e*this._width+t])}flush(){return this._width=0,this._height=0,this._heights=[],!0}parse(t){if(!t)return!1;this._width=t.readInt();const e=t.readInt();this._height=e/this._width;let i=0;for(;i<e;)this._heights[i]=t.readShort(),i++;return!0}get width(){return this._width}get height(){return this._height}get heights(){return this._heights}}class l1{flush(){return this._wrapper=null,this._count=0,this._x=0,this._y=0,this._value=0,!0}tileHeight(){return Pr.decodeTileHeight(this._value)}isStackingBlocked(){return Pr.decodeIsStackingBlocked(this._value)}isRoomTile(){return Pr.decodeIsRoomTile(this._value)}next(){return this._count?(this._count--,this._x=this._wrapper.readByte(),this._y=this._wrapper.readByte(),this._value=this._wrapper.readShort(),!0):!1}parse(t){return t?(this._wrapper=t,this._count=t.readByte(),!0):!1}get x(){return this._x}get y(){return this._y}get height(){return this._value}}class _1{flush(){return this._blockedTilesMap=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;){const i=t.readInt(),r=t.readInt();this._blockedTilesMap[r]||(this._blockedTilesMap[r]=[]),this._blockedTilesMap[r][i]=!0,e--}return!0}get blockedTilesMap(){return this._blockedTilesMap}}class c1{flush(){return this._floorType=null,this._wallType=null,this._landscapeType=null,this._landscapeAnimation=null,!0}parse(t){if(!t)return!1;const e=t.readString(),i=t.readString();switch(e){case"floor":this._floorType=i;break;case"wallpaper":this._wallType=i;break;case"landscape":this._landscapeType=i;break;case"landscapeanim":this._landscapeAnimation=i;break}return!0}get floorType(){return this._floorType}get wallType(){return this._wallType}get landscapeType(){return this._landscapeType}get landscapeAnimation(){return this._landscapeAnimation}}class d1{flush(){return this._name=null,this._roomId=0,!0}parse(t){return t?(this._name=t.readString(),this._roomId=t.readInt(),!0):!1}get name(){return this._name}get roomId(){return this._roomId}}class f1{flush(){return this._hideWalls=!1,this._thicknessWall=0,this._thicknessFloor=0,!0}parse(t){if(!t)return!1;this._hideWalls=t.readBoolean();let e=t.readInt(),i=t.readInt();return e=e<-2?-2:e>1?1:e,i=i<-2?-2:i>1?1:i,this._thicknessWall=Math.pow(2,e),this._thicknessFloor=Math.pow(2,i),!0}get hideWalls(){return this._hideWalls}get thicknessWall(){return this._thicknessWall}get thicknessFloor(){return this._thicknessFloor}}class ap{constructor(t){if(!t)throw new Error("invalid_wrapper");this._webId=t.readInt(),this._name=t.readString(),this._level=t.readInt(),this._figure=t.readString(),this._owner=t.readString()}dispose(){this._webId=0,this._name="",this._level=0,this._figure="",this._owner=""}get webId(){return this._webId}get name(){return this._name}get level(){return this._level}get figure(){return this._figure}get owner(){return this._owner}}class op{constructor(t){this._stuffId=t.readInt(),this._classId=t.readInt(),this._productCode=t.readString(),this._userId=t.readInt(),this._userName=t.readString(),this._rarityLevel=t.readInt(),this._hasMutation=t.readBoolean()}get stuffId(){return this._stuffId}get classId(){return this._classId}get productCode(){return this._productCode}get userId(){return this._userId}get userName(){return this._userName}get rarityLevel(){return this._rarityLevel}get hasMutation(){return this._hasMutation}}class g1{flush(){return this._resultData=null,this._otherResultData=null,!0}parse(t){return t?(this._resultData=new op(t),this._otherResultData=new op(t),!0):!1}get resultData(){return this._resultData}get otherResultData(){return this._otherResultData}}class E1{flush(){return this._petId=-1,this._roomIndex=-1,this._gainedExperience=0,!0}parse(t){return t?(this._petId=t.readInt(),this._roomIndex=t.readInt(),this._gainedExperience=t.readInt(),!0):!1}get petId(){return this._petId}get roomIndex(){return this._roomIndex}get gainedExperience(){return this._gainedExperience}}class p1{flush(){return!0}parse(t){return t?(this._roomIndex=t.readInt(),this._petId=t.readInt(),this._figureData=new Bf(t),this._hasSaddle=t.readBoolean(),this._isRiding=t.readBoolean(),!0):!1}get roomIndex(){return this._roomIndex}get petId(){return this._petId}get figureData(){return this._figureData}get hasSaddle(){return this._hasSaddle}get isRiding(){return this._isRiding}}class m1{flush(){return this._id=-1,this._skillThresholds=[],!0}parse(t){if(!t)return!1;this._id=t.readInt(),this._name=t.readString(),this._level=t.readInt(),this._maximumLevel=t.readInt(),this._experience=t.readInt(),this._levelExperienceGoal=t.readInt(),this._energy=t.readInt(),this._maximumEnergy=t.readInt(),this._happyness=t.readInt(),this._maximumHappyness=t.readInt(),this._respect=t.readInt(),this._ownerId=t.readInt(),this._age=t.readInt(),this._ownerName=t.readString(),this._rarityLevel=t.readInt(),this._saddle=t.readBoolean(),this._rider=t.readBoolean();let e=t.readInt();for(;e>0;)this._skillThresholds.push(t.readInt()),e--;return this._skillThresholds.sort(),this._publiclyRideable=t.readInt(),this._breedable=t.readBoolean(),this._fullyGrown=t.readBoolean(),this._dead=t.readBoolean(),this._unknownRarity=t.readInt(),this._maximumTimeToLive=t.readInt(),this._remainingTimeToLive=t.readInt(),this._remainingGrowTime=t.readInt(),this._publiclyBreedable=t.readBoolean(),!0}get id(){return this._id}get name(){return this._name}get level(){return this._level}get maximumLevel(){return this._maximumLevel}get experience(){return this._experience}get energy(){return this._energy}get happyness(){return this._happyness}get levelExperienceGoal(){return this._levelExperienceGoal}get maximumEnergy(){return this._maximumEnergy}get maximumHappyness(){return this._maximumHappyness}get respect(){return this._respect}get ownerId(){return this._ownerId}get ownerName(){return this._ownerName}get age(){return this._age}get rarityLevel(){return this._rarityLevel}get saddle(){return this._saddle}get rider(){return this._rider}get breedable(){return this._breedable}get fullyGrown(){return this._fullyGrown}get dead(){return this._dead}get maximumTimeToLive(){return this._maximumTimeToLive}get remainingTimeToLive(){return this._remainingTimeToLive}get remainingGrowTime(){return this._remainingGrowTime}get skillTresholds(){return this._skillThresholds}get publiclyRideable(){return this._publiclyRideable}get unknownRarity(){return this._unknownRarity}get publiclyBreedable(){return this._publiclyBreedable}}class I1{flush(){return this._roomIndex=-1,this._petId=-1,this._canBreed=!1,this._canHarvest=!1,this._canRevive=!1,this._hasBreedingPermission=!1,!0}parse(t){return t?(this._roomIndex=t.readInt(),this._petId=t.readInt(),this._canBreed=t.readBoolean(),this._canHarvest=t.readBoolean(),this._canRevive=t.readBoolean(),this._hasBreedingPermission=t.readBoolean(),!0):!1}get roomIndex(){return this._roomIndex}get petId(){return this._petId}get canBreed(){return this._canBreed}get canHarvest(){return this._canHarvest}get canRevive(){return this._canRevive}get hasBreedingPermission(){return this._hasBreedingPermission}}class T1{constructor(t){if(!t)throw new Error("invalid_wrapper");this._chance=t.readInt(),this._breeds=[];let e=t.readInt();for(;e>0;)this._breeds.push(t.readInt()),e--}dispose(){this._chance=-1,this._breeds=[]}get chance(){return this._chance}get breeds(){return this._breeds}}class R1{flush(){return this._isPlaying=!1,!0}parse(t){return t?(this._isPlaying=t.readBoolean(),!0):!1}get isPlaying(){return this._isPlaying}}class O1{flush(){return!0}parse(t){return!0}}class A1{flush(){return this._seconds=0,!0}parse(t){return t?(this._seconds=t.readInt(),!0):!1}get seconds(){return this._seconds}}class v1{flush(){return this._seconds=0,!0}parse(t){return t?(this._seconds=t.readInt(),!0):!1}get seconds(){return this._seconds}}class Gf{flush(){return this._roomIndex=null,this._message=null,this._gesture=0,this._bubble=0,this._urls=[],this._messageLength=0,!0}parse(t){return t?(this._roomIndex=t.readInt(),this._message=t.readString(),this._gesture=t.readInt(),this._bubble=t.readInt(),this.parseUrls(t),this._messageLength=t.readInt(),!0):!1}parseUrls(t){if(!t)return!1;this._urls=[];let e=t.readInt();for(;e>0;)this._urls.push(t.readString()),e--;return!0}get roomIndex(){return this._roomIndex}get message(){return this._message}get gesture(){return this._gesture}get bubble(){return this._bubble}get urls(){return this._urls}get messageLength(){return this._messageLength}}class S1{flush(){return this._unitId=null,this._isTyping=!1,!0}parse(t){return t?(this._unitId=t.readInt(),this._isTyping=t.readInt()===1,!0):!1}get unitId(){return this._unitId}get isTyping(){return this._isTyping}}class y1{flush(){return this._unitId=null,this._danceId=0,!0}parse(t){return t?(this._unitId=t.readInt(),this._danceId=t.readInt(),!0):!1}get unitId(){return this._unitId}get danceId(){return this._danceId}}class C1{flush(){return this._unitId=null,this._effectId=0,this._delay=0,!0}parse(t){return t?(this._unitId=t.readInt(),this._effectId=t.readInt(),this._delay=t.readInt(),!0):!1}get unitId(){return this._unitId}get effectId(){return this._effectId}get delay(){return this._delay}}class M1{flush(){return this._unitId=null,this._expression=0,!0}parse(t){return t?(this._unitId=t.readInt(),this._expression=t.readInt(),!0):!1}get unitId(){return this._unitId}get expression(){return this._expression}}class N1{flush(){return this._unitId=null,this._handId=0,!0}parse(t){return t?(this._unitId=t.readInt(),this._handId=t.readInt(),!0):!1}get unitId(){return this._unitId}get handId(){return this._handId}}class P1{flush(){return this._giverUserId=-1,this._handItemType=-1,!0}parse(t){return t?(this._giverUserId=t.readInt(),this._handItemType=t.readInt(),!0):!1}get giverUserId(){return this._giverUserId}get handItemType(){return this._handItemType}}class b1{flush(){return this._unitId=null,this._isIdle=!1,!0}parse(t){return t?(this._unitId=t.readInt(),this._isIdle=t.readBoolean(),!0):!1}get unitId(){return this._unitId}get isIdle(){return this._isIdle}}class D1{flush(){return this._unitId=null,this._figure=null,this._gender="M",this._motto=null,this._achievementScore=0,!0}parse(t){return t?(this._unitId=t.readInt(),this._figure=t.readString(),this._gender=t.readString().toLocaleUpperCase(),this._motto=t.readString(),this._achievementScore=t.readInt(),!0):!1}get unitId(){return this._unitId}get figure(){return this._figure}get gender(){return this._gender}get motto(){return this._motto}get achievementScore(){return this._achievementScore}}class L1{flush(){return this._unitId=null,this._value=0,!0}parse(t){return t?(this._unitId=t.readInt(),this._value=t.readInt(),!0):!1}get unitId(){return this._unitId}get value(){return this._value}}class ga{constructor(t){this._roomIndex=0,this._x=0,this._y=0,this._z=0,this._dir=0,this._name="",this._userType=0,this._sex="",this._figure="",this._custom="",this._activityPoints=0,this._webID=0,this._groupID=0,this._groupStatus=0,this._groupName="",this._subType="",this._ownerId=0,this._ownerName="",this._rarityLevel=0,this._hasSaddle=!1,this._isRiding=!1,this._canBreed=!1,this._canHarvest=!1,this._canRevive=!1,this._hasBreedingPermission=!1,this._petLevel=0,this._petPosture="",this._botSkills=[],this._isModerator=!1,this._isReadOnly=!1,this._roomIndex=t}setReadOnly(){this._isReadOnly=!0}get roomIndex(){return this._roomIndex}get x(){return this._x}set x(t){this._isReadOnly||(this._x=t)}get y(){return this._y}set y(t){this._isReadOnly||(this._y=t)}get z(){return this._z}set z(t){this._isReadOnly||(this._z=t)}get dir(){return this._dir}set dir(t){this._isReadOnly||(this._dir=t)}get name(){return this._name}set name(t){this._isReadOnly||(this._name=t)}get userType(){return this._userType}set userType(t){this._isReadOnly||(this._userType=t)}get sex(){return this._sex}set sex(t){this._isReadOnly||(this._sex=t)}get figure(){return this._figure}set figure(t){this._isReadOnly||(this._figure=t)}get custom(){return this._custom}set custom(t){this._isReadOnly||(this._custom=t)}get activityPoints(){return this._activityPoints}set activityPoints(t){this._isReadOnly||(this._activityPoints=t)}get webID(){return this._webID}set webID(t){this._isReadOnly||(this._webID=t)}get groupID(){return this._groupID}set groupID(t){this._isReadOnly||(this._groupID=t)}get groupName(){return this._groupName}set groupName(t){this._isReadOnly||(this._groupName=t)}get groupStatus(){return this._groupStatus}set groupStatus(t){this._isReadOnly||(this._groupStatus=t)}get subType(){return this._subType}set subType(t){this._isReadOnly||(this._subType=t)}get ownerId(){return this._ownerId}set ownerId(t){this._isReadOnly||(this._ownerId=t)}get ownerName(){return this._ownerName}set ownerName(t){this._isReadOnly||(this._ownerName=t)}get rarityLevel(){return this._rarityLevel}set rarityLevel(t){this._isReadOnly||(this._rarityLevel=t)}get hasSaddle(){return this._hasSaddle}set hasSaddle(t){this._isReadOnly||(this._hasSaddle=t)}get isRiding(){return this._isRiding}set isRiding(t){this._isReadOnly||(this._isRiding=t)}get canBreed(){return this._canBreed}set canBreed(t){this._isReadOnly||(this._canBreed=t)}get canHarvest(){return this._canHarvest}set canHarvest(t){this._isReadOnly||(this._canHarvest=t)}get canRevive(){return this._canRevive}set canRevive(t){this._isReadOnly||(this._canRevive=t)}get hasBreedingPermission(){return this._hasBreedingPermission}set hasBreedingPermission(t){this._isReadOnly||(this._hasBreedingPermission=t)}get petLevel(){return this._petLevel}set petLevel(t){this._isReadOnly||(this._petLevel=t)}get petPosture(){return this._petPosture}set petPosture(t){this._isReadOnly||(this._petPosture=t)}get botSkills(){return this._botSkills}set botSkills(t){this._botSkills=t}get isModerator(){return this._isModerator}set isModerator(t){this._isReadOnly||(this._isModerator=t)}}ga.M="M";ga.F="F";class U1{flush(){return this._users=[],!0}parse(t){if(!t)return!1;this._users=[];const e=t.readInt();let i=0;for(;i<e;){const r=t.readInt(),n=t.readString(),a=t.readString();let o=t.readString();const h=t.readInt(),u=t.readInt(),c=t.readInt(),l=parseFloat(t.readString()),_=t.readInt(),d=t.readInt(),g=new ga(h);if(g.dir=_,g.name=n,g.custom=a,g.x=u,g.y=c,g.z=l,this._users.push(g),d===1){g.webID=r,g.userType=Vs.USER,g.sex=this.resolveSex(t.readString()),g.groupID=t.readInt(),g.groupStatus=t.readInt(),g.groupName=t.readString();const m=t.readString();m!==""&&(o=this.convertSwimFigure(m,o,g.sex)),g.figure=o,g.activityPoints=t.readInt(),g.isModerator=t.readBoolean()}else if(d===2)g.userType=Vs.PET,g.figure=o,g.webID=r,g.subType=t.readInt().toString(),g.ownerId=t.readInt(),g.ownerName=t.readString(),g.rarityLevel=t.readInt(),g.hasSaddle=t.readBoolean(),g.isRiding=t.readBoolean(),g.canBreed=t.readBoolean(),g.canHarvest=t.readBoolean(),g.canRevive=t.readBoolean(),g.hasBreedingPermission=t.readBoolean(),g.petLevel=t.readInt(),g.petPosture=t.readString();else if(d===3)g.userType=Vs.BOT,g.webID=h*-1,o.indexOf("/")===-1?g.figure=o:g.figure="hr-100-.hd-180-1.ch-876-66.lg-270-94.sh-300-64",g.sex=ga.M;else if(d===4){g.userType=Vs.RENTABLE_BOT,g.webID=r,g.sex=this.resolveSex(t.readString()),g.figure=o,g.ownerId=t.readInt(),g.ownerName=t.readString();const m=t.readInt();if(m){const p=[];let T=0;for(;T<m;)p.push(t.readShort()),T++;g.botSkills=p}}i++}return!0}resolveSex(t){return t.substr(0,1).toLowerCase()==="f"?ga.F:ga.M}convertSwimFigure(t,e,i){const r=e.split(".");let n=1,a=1,o=1;const h=1e4;let u=0;for(;u<r.length;){const d=r[u].split("-");d.length>2&&d[0]==="hd"&&(n=parseInt(d[2])),u++}const c=["238,238,238","250,56,49","253,146,160","42,199,210","53,51,44","239,255,146","198,255,152","255,146,90","157,89,126","182,243,255","109,255,51","51,120,201","255,182,49","223,161,233","249,251,50","202,175,143","197,198,197","71,98,61","138,131,97","255,140,51","84,198,39","30,108,153","152,79,136","119,200,255","255,192,142","60,75,135","124,44,71","215,255,227","143,63,28","255,99,147","31,155,121","253,255,51"],l=t.split("=");if(l.length>1){const _=l[1].split("/");_[0];const d=_[1];i==="F"?o=10010:o=10011;const g=c.indexOf(d);a=h+g+1}return e+(".bds-10001-"+n+".ss-"+o+"-"+a)}get users(){return this._users}}class x1{flush(){return this._unitId=null,!0}parse(t){return t?(this._unitId=parseInt(t.readString()),!0):!1}get unitId(){return this._unitId}}class F1{constructor(t,e){this._action=t,this._value=e}get action(){return this._action}get value(){return this._value}}class w1{constructor(t,e,i,r,n,a,o,h=0,u=0,c=0,l,_,d){this._id=t,this._x=e,this._y=i,this._z=r,this._height=n,this._headDirection=a,this._direction=o,this._targetX=h,this._targetY=u,this._targetZ=c,this._didMove=l,this._canStandUp=_,this._actions=d||[]}get id(){return this._id}get x(){return this._x}get y(){return this._y}get z(){return this._z}get height(){return this._height}get headDirection(){return this._headDirection}get direction(){return this._direction}get targetX(){return this._targetX}get targetY(){return this._targetY}get targetZ(){return this._targetZ}get didMove(){return this._didMove}get canStandUp(){return this._canStandUp}get actions(){return this._actions}}class G1{flush(){return this._statuses=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;){const i=this.parseStatus(t);if(!i){e--;continue}this._statuses.push(i),e--}return!0}parseStatus(t){if(!t)return null;const e=t.readInt(),i=t.readInt(),r=t.readInt(),n=parseFloat(t.readString()),a=t.readInt()%8*45,o=t.readInt()%8*45,h=t.readString();let u=0,c=0,l=0,_=0,d=!1,g=!1;if(h){const m=h.split("/"),p=[];for(const T of m){const A=T.split(" ");if(A[0]!==""&&A.length>=2){switch(A[0]){case"mv":{const O=A[1].split(",");O.length>=3&&(u=parseInt(O[0]),c=parseInt(O[1]),l=parseFloat(O[2]),g=!0);break}case"sit":{const O=parseFloat(A[1]);A.length>=3&&(d=A[2]==="1"),_=O;break}case"lay":{const O=parseFloat(A[1]);_=Math.abs(O);break}}p.push(new F1(A[0],A[1]))}}this._statuses.push(new w1(e,i,r,n,_,a,o,u,c,l,g,d,p))}}get statuses(){return this._statuses}}const $c=class{constructor(s){if(!s)throw new Error("invalid_wrapper");this.flush(),this.parse(s)}flush(){return this._rentable=!1,this._itemId=0,this._furniType=null,this._ref=0,this._spriteId=0,this._category=0,this._stuffData=null,this._isGroupable=!1,this._isRecyclable=!1,this._tradable=!1,this._sellable=!1,this._secondsToExpiration=0,this._extra=0,this._flatId=0,this._isWallItem=!1,this._hasRentPeriodStarted=!1,this._expirationTimeStamp=0,this._slotId="",this._songId=-1,!0}parse(s){return s?(this._itemId=s.readInt(),this._furniType=s.readString(),this._ref=s.readInt(),this._spriteId=s.readInt(),this._category=s.readInt(),this._stuffData=Vr.parseObjectData(s),this._isRecyclable=s.readBoolean(),this._tradable=s.readBoolean(),this._isGroupable=s.readBoolean(),this._sellable=s.readBoolean(),this._secondsToExpiration=s.readInt(),this._expirationTimeStamp=_t(),this.secondsToExpiration>-1?this._rentable=!0:(this._rentable=!1,this._secondsToExpiration=-1),this._hasRentPeriodStarted=s.readBoolean(),this._flatId=s.readInt(),this._isWallItem=this._furniType===$c.WALL_ITEM,this._furniType===$c.FLOOR_ITEM&&(this._slotId=s.readString(),this._extra=s.readInt()),!0):!1}get itemId(){return this._itemId}get furniType(){return this._furniType}get ref(){return this._ref}get spriteId(){return this._spriteId}get category(){return this._category}get stuffData(){return this._stuffData}get isGroupable(){return this._isGroupable}get isRecycleable(){return this._isRecyclable}get tradable(){return this._tradable}get sellable(){return this._sellable}get secondsToExpiration(){return this._secondsToExpiration}get flatId(){return this._flatId}get slotId(){return this._slotId}get songId(){return this._songId}get extra(){return this._extra}get rentable(){return this._rentable}get isWallItem(){return this._isWallItem}get hasRentPeriodStarted(){return this._hasRentPeriodStarted}get expirationTimeStamp(){return this._expirationTimeStamp}get creationDay(){return 0}get creationMonth(){return 0}get creationYear(){return 0}get isExternalImageFurni(){return this._furniType.indexOf("external_image")!==-1}};let xl=$c;xl.WALL_ITEM="I";xl.FLOOR_ITEM="S";class B1{flush(){return this._items=[],!0}parse(t){return t?(this._items.push(new xl(t)),!0):!1}get items(){return this._items}}class H1{flush(){return!0}parse(t){return!!t}}class V1{flush(){return this._totalFragments=0,this._fragmentNumber=0,this._fragment=new Map,!0}parse(t){if(!t)return!1;this._totalFragments=t.readInt(),this._fragmentNumber=t.readInt();let e=t.readInt();for(;e>0;){const i=new xl(t);i&&this._fragment.set(i.itemId,i),e--}return!0}get totalFragments(){return this._totalFragments}get fragmentNumber(){return this._fragmentNumber}get fragment(){return this._fragment}}class k1{flush(){return this._itemId=0,!0}parse(t){return t?(this._itemId=t.readInt(),!0):!1}get itemId(){return this._itemId}}class j1{flush(){return this._itemId=0,this._itemsLeft=0,!0}parse(t){return t?(this._itemId=t.readInt(),this._itemsLeft=t.readInt(),!0):!1}get itemId(){return this._itemId}get itemsLeft(){return this._itemsLeft}}class z1{flush(){return this._itemType="",this._classId=0,this._productCode="",!0}parse(t){return t?(this._itemType=t.readString(),this._classId=t.readInt(),this._productCode=t.readString(),this._placedItemId=t.readInt(),this._placedItemType=t.readString(),this._placedInRoom=t.readBoolean(),this._petFigureString=t.readString(),!0):!1}get itemType(){return this._itemType}get classId(){return this._classId}get productCode(){return this._productCode}get placedItemId(){return this._placedItemId}get placedItemType(){return this._placedItemType}get placedInRoom(){return this._placedInRoom}get petFigureString(){return this._petFigureString}}class Y1{flush(){this._nestId=0,this._pet1&&(this._pet1.dispose(),this._pet1=null),this._pet2&&(this._pet2.dispose(),this._pet2=null);for(const t of this._rarityCategories)t&&t.dispose();return this._rarityCategories=[],!0}parse(t){if(!t)return!1;this._nestId=t.readInt(),this._pet1=new ap(t),this._pet2=new ap(t);let e=t.readInt();for(;e>0;)this._rarityCategories.push(new T1(t)),e--;return this._resultPetType=t.readInt(),!0}get nestId(){return this._nestId}get pet1(){return this._pet1}get pet2(){return this._pet2}get rarityCategories(){return this._rarityCategories}get resultPetType(){return this._resultPetType}}class W1{flush(){return this._breedingNestStuffId=0,this._result=0,!0}parse(t){return t?(this._breedingNestStuffId=t.readInt(),this._result=t.readInt(),!0):!1}get breedingNestStuffId(){return this._breedingNestStuffId}get result(){return this._result}}class X1{flush(){return this._petId=-1,this._rarityCategory=-1,!0}parse(t){return this._petId=t.readInt(),this._rarityCategory=t.readInt(),!0}get rarityCategory(){return this._rarityCategory}get petId(){return this._petId}}class Bf{constructor(t){this._typeId=t.readInt(),this._paletteId=t.readInt(),this._color=t.readString(),this._breedId=t.readInt(),this._customParts=[],this._customPartCount=t.readInt();let e=0;for(;e<this._customPartCount;)this._customParts.push(t.readInt()),this._customParts.push(t.readInt()),this._customParts.push(t.readInt()),e++}get typeId(){return this._typeId}get paletteId(){return this._paletteId}get color(){return this._color}get breedId(){return this._breedId}get figuredata(){let t=this.typeId+" "+this.paletteId+" "+this.color;t=t+(" "+this.custompartCount);for(const e of this.customParts)t=t+(" "+e);return t}get customParts(){return this._customParts}get custompartCount(){return this._customPartCount}}class Fl{constructor(t){if(!t)throw new Error("invalid_wrapper");this._id=t.readInt(),this._name=t.readString(),this._figureData=new Bf(t),this._level=t.readInt()}get id(){return this._id}get name(){return this._name}get typeId(){return this._figureData.typeId}get paletteId(){return this._figureData.paletteId}get color(){return this._figureData.color}get breedId(){return this._figureData.breedId}get customPartCount(){return this._figureData.custompartCount}get figureString(){return this._figureData.figuredata}get figureData(){return this._figureData}get level(){return this._level}}class K1{flush(){return this._pet=null,this._boughtAsGift=!1,!0}parse(t){return this._pet=new Fl(t),this._boughtAsGift=t.readBoolean(),!0}get pet(){return this._pet}get boughtAsGift(){return this._boughtAsGift}}class wl{flush(){return this._state=0,this._ownPetId=0,this._otherPetId=0,!0}parse(t){return t?(this._state=t.readInt(),this._ownPetId=t.readInt(),this._otherPetId=t.readInt(),!0):!1}get state(){return this._state}get ownPetId(){return this._ownPetId}get otherPetId(){return this._otherPetId}}wl.STATE_CANCEL=1;wl.STATE_ACCEPT=2;wl.STATE_REQUEST=3;class q1{flush(){return this._fragment=null,!0}parse(t){this._totalFragments=t.readInt(),this._fragmentNumber=t.readInt();let e=t.readInt();for(this._fragment=new Map;e>0;){const i=new Fl(t);this._fragment.set(i.id,i),e--}return!0}get totalFragments(){return this._totalFragments}get fragmentNumber(){return this._fragmentNumber}get fragment(){return this._fragment}}class Z1{flush(){return this._boughtAsGift=!1,this._pet=null,!0}parse(t){return this._boughtAsGift=t.readBoolean(),this._pet=new Fl(t),!0}get boughtAsGift(){return this._boughtAsGift}get pet(){return this._pet}}class Q1{flush(){return!0}parse(t){return t?(this._petId=t.readInt(),!0):!1}get petId(){return this._petId}}class J1{constructor(t){this._itemId=t.readInt(),this._furniType=t.readString().toUpperCase(),this._ref=t.readInt(),this._spriteId=t.readInt(),this._category=t.readInt(),this._isGroupable=t.readBoolean(),this._stuffData=Vr.parseObjectData(t),this._secondsToExpiration=-1,this._expirationTimeStamp=_t(),this._hasRentPeriodStarted=!1,this._creationDay=t.readInt(),this._creationMonth=t.readInt(),this._creationYear=t.readInt(),this._extra=this.furniType==="S"?t.readInt():-1,this._flatId=-1,this._rentable=!1,this._isWallItem=this._furniType==="I"}get itemId(){return this._itemId}get furniType(){return this._furniType}get ref(){return this._ref}get spriteId(){return this._spriteId}get category(){return this._category}get stuffData(){return this._stuffData}get extra(){return this._extra}get secondsToExpiration(){return this._secondsToExpiration}get creationDay(){return this._creationDay}get creationMonth(){return this._creationMonth}get creationYear(){return this._creationYear}get isGroupable(){return this._isGroupable}get songId(){return this._extra}get flatId(){return this._flatId}get rentable(){return this._rentable}get isWallItem(){return this._isWallItem}get hasRentPeriodStarted(){return this._hasRentPeriodStarted}get expirationTimeStamp(){return this._expirationTimeStamp}get isRecycleable(){return!0}get tradable(){return!0}get sellable(){return!0}get slotId(){return null}get isExternalImageFurni(){return this._furniType.indexOf("external_image")!==-1}}class $1{flush(){return this._userID=-1,this._userAccepts=!1,!0}parse(t){return t?(this._userID=t.readInt(),this._userAccepts=t.readInt()>0,!0):!1}get userID(){return this._userID}get userAccepts(){return this._userAccepts}}class dT{flush(){return!0}parse(t){return t?(this._userId=t.readInt(),this._reason=t.readInt(),!0):!1}get userID(){return this._userId}get reason(){return this._reason}}dT.ERROR_WHILE_COMMIT=1;class tF{flush(){return!0}parse(t){return!!t}}class eF{flush(){return!0}parse(t){return!!t}}class sF{flush(){return this._firstUserID=-1,this._firstUserItemArray=null,this._firstUserNumItems=0,this._firstUserNumCredits=0,this._secondUserID=-1,this._secondUserItemArray=null,this._secondUserNumItems=0,this._secondUserNumCredits=0,!0}parse(t){return!t||(this._firstUserID=t.readInt(),this._firstUserItemArray=[],!this.parseItems(t,this._firstUserItemArray))||(this._firstUserNumItems=t.readInt(),this._firstUserNumCredits=t.readInt(),this._secondUserID=t.readInt(),this._secondUserItemArray=[],!this.parseItems(t,this._secondUserItemArray))?!1:(this._secondUserNumItems=t.readInt(),this._secondUserNumCredits=t.readInt(),!0)}parseItems(t,e){let i=t.readInt();for(;i>0;)e.push(new J1(t)),i--;return!0}get firstUserID(){return this._firstUserID}get firstUserItemArray(){return this._firstUserItemArray}get firstUserNumItems(){return this._firstUserNumItems}get firstUserNumCredits(){return this._firstUserNumCredits}get secondUserID(){return this._secondUserID}get secondUserItemArray(){return this._secondUserItemArray}get secondUserNumItems(){return this._secondUserNumItems}get secondUserNumCredits(){return this._secondUserNumCredits}}class iF{flush(){return!0}parse(t){return!!t}}class rF{flush(){return!0}parse(t){return!!t}}class Hf{flush(){return!0}parse(t){return t?(this._reason=t.readInt(),this._otherUserName=t.readString(),!0):!1}get reason(){return this._reason}get otherUserName(){return this._otherUserName}}Hf.REASON_YOU_ARE_ALREADY_TRADING=7;Hf.REASON_OTHER_USER_ALREADY_TRADING=8;class nF{flush(){return this._userId=-1,this._userCanTrade=!1,this._otherUserId=-1,this._otherUserCanTrade=!1,!0}parse(t){return t?(this._userId=t.readInt(),this._userCanTrade=t.readInt()===1,this._otherUserId=t.readInt(),this._otherUserCanTrade=t.readInt()===1,!0):!1}get userID(){return this._userId}get userCanTrade(){return this._userCanTrade}get otherUserID(){return this._otherUserId}get otherUserCanTrade(){return this._otherUserCanTrade}}class aF{flush(){return!0}parse(t){return!!t}}class oF{flush(){return!0}parse(t){return!!t}}class hF{flush(){return this._respect=0,this._petOwnerId=0,this._petData=null,!0}parse(t){return t?(this._respect=t.readInt(),this._petOwnerId=t.readInt(),this._petData=new Fl(t),!0):!1}get respect(){return this._respect}get petOwnerId(){return this._petOwnerId}get petData(){return this._petData}get isTreat(){return this._petData.typeId===St.MONSTERPLANT}}class uF{flush(){return this._petId=0,this._userId=0,this._supplementType=0,!0}parse(t){return t?(this._petId=t.readInt(),this._userId=t.readInt(),this._supplementType=t.readInt(),!0):!1}get petId(){return this._petId}get userId(){return this._userId}get supplementType(){return this._supplementType}}class br{}br.WATER=0;br.LIGHT=1;br.REVIVE=2;br.REBREED_FERTILIZER=3;br.SPEED_FERTILIZER=4;class lF{flush(){return this._userId=0,this._respectsReceived=0,!0}parse(t){return t?(this._userId=t.readInt(),this._respectsReceived=t.readInt(),!0):!1}get userId(){return this._userId}get respectsReceived(){return this._respectsReceived}}class _F{constructor(t,e,i){this._hasControllers=!1,this._roomId=t,this._roomName=e,this._hasControllers=i}get roomId(){return this._roomId}get roomName(){return this._roomName}get hasControllers(){return this._hasControllers}}class cF{constructor(t){this._currentHcStreak=t.readInt(),this._firstSubscriptionDate=t.readString(),this._kickbackPercentage=t.readDouble(),this._totalCreditsMissed=t.readInt(),this._totalCreditsRewarded=t.readInt(),this._totalCreditsSpent=t.readInt(),this._creditRewardForStreakBonus=t.readInt(),this._creditRewardForMonthlySpent=t.readInt(),this._timeUntilPayday=t.readInt()}get currentHcStreak(){return this._currentHcStreak}get firstSubscriptionDate(){return this._firstSubscriptionDate}get kickbackPercentage(){return this._kickbackPercentage}get totalCreditsMissed(){return this._totalCreditsMissed}get totalCreditsRewarded(){return this._totalCreditsRewarded}get totalCreditsSpent(){return this._totalCreditsSpent}get creditRewardForStreakBonus(){return this._creditRewardForStreakBonus}get creditRewardForMonthlySpent(){return this._creditRewardForMonthlySpent}get timeUntilPayday(){return this._timeUntilPayday}}class dF{flush(){return this._data=null,!0}parse(t){return this._data=new cF(t),!0}get data(){return this._data}}class fF{flush(){return this._looks=new Map,!0}parse(t){if(!t)return!1;t.readInt();let e=t.readInt();for(;e>0;){const i=t.readInt(),r=t.readString(),n=t.readString();this._looks.set(i,[r,n]),e--}return!0}get looks(){return this._looks}}class gF{flush(){return this._result=-1,!0}parse(t){return t?(this._result=t.readInt(),!0):!1}get result(){return this._result}}class EF{flush(){return this._isVip=!1,this._rooms=[],!0}parse(t){if(!t)return!1;this._isVip=t.readBoolean();let e=t.readInt();for(;e>0;)this._rooms.push(new _F(t.readInt(),t.readString(),t.readBoolean())),e--;return!0}get isVip(){return this._isVip}get rooms(){return this._rooms}}class pF{flush(){return this._pageId=-1,this._data=null,!0}parse(t){return t?(this._pageId=t.readInt(),this._data=new Dl(t),!0):!1}get pageId(){return this._pageId}get data(){return this._data}}class mF{constructor(t){if(!t)throw new Error("invalid_wrapper");this.flush(),this.parse(t)}flush(){return this._type=-1,this._breedId=-1,this._paletteId=-1,this._sellable=!1,this._rare=!1,!0}parse(t){return t?(this._type=t.readInt(),this._breedId=t.readInt(),this._paletteId=t.readInt(),this._sellable=t.readBoolean(),this._rare=t.readBoolean(),!0):!1}get type(){return this._type}get breedId(){return this._breedId}get paletteId(){return this._paletteId}get sellable(){return this._sellable}get rare(){return this._rare}}class IF{flush(){return this._productCode="",this._palettes=[],!0}parse(t){if(!t)return!1;this._productCode=t.readString();let e=t.readInt();for(;e>0;)this._palettes.push(new mF(t)),e--;return!0}get productCode(){return this._productCode}get palettes(){return this._palettes}}class TF{constructor(t){this._trackingState=t.readInt(),this._id=t.readInt(),this._identifier=t.readString(),this._productCode=t.readString(),this._priceInCredits=t.readInt(),this._priceInActivityPoints=t.readInt(),this._activityPointType=t.readInt(),this._purchaseLimit=t.readInt();const e=t.readInt();this._expirationTime=e>0?e*1e3+Date.now():0,this._title=t.readString(),this._description=t.readString(),this._imageUrl=t.readString(),this._iconImageUrl=t.readString(),this._type=t.readInt(),this._subProductCodes=[];let i=t.readInt();for(;i>0;)this._subProductCodes.push(t.readString()),i--;return this}populate(t){t&&(this._id=t.id,this._identifier=t.identifier,this._type=t.type,this._title=t.title,this._description=t.description,this._imageUrl=t.imageUrl,this._iconImageUrl=t.iconImageUrl,this._productCode=t.productCode,this._purchaseLimit=t.purchaseLimit,this._expirationTime=t.expirationTime,this._priceInCredits=t.priceInCredits,this._priceInActivityPoints=t.priceInActivityPoints,this._activityPointType=t.activityPointType,this._subProductCodes=t.subProductCodes,this._trackingState=t.trackingState)}purchase(t){this._purchaseLimit=this._purchaseLimit-t}get id(){return this._id}get identifier(){return this._identifier}get type(){return this._type}get title(){return this._title}get description(){return this._description}get imageUrl(){return this._imageUrl}get iconImageUrl(){return this._iconImageUrl}get productCode(){return this._productCode}get purchaseLimit(){return this._purchaseLimit}get expirationTime(){return this._expirationTime}get priceInCredits(){return this._priceInCredits}get priceInActivityPoints(){return this._priceInActivityPoints}get activityPointType(){return this._activityPointType}get subProductCodes(){return this._subProductCodes}get trackingState(){return this._trackingState}}class RF{flush(){return!0}parse(t){return!!t}}class OF{flush(){return this._data=null,!0}parse(t){return t?(this._data=new TF(t),!0):!1}get data(){return this._data}}class AF{constructor(){this._errorCode=""}flush(){return this._errorCode="",!0}parse(t){return t?(this._errorCode=t.readString(),!0):!1}get errorCode(){return this._errorCode}}class vF{constructor(){this._productName="",this._productDescription=""}flush(){return this._productDescription="",this._productName="",!0}parse(t){return t?(this._productDescription=t.readString(),this._productName=t.readString(),!0):!1}get productName(){return this._productName}get productDescription(){return this._productDescription}}class SF{flush(){return!0}parse(t){return!!t}}class kr{flush(){return this._goalId=0,this._goalCode=null,this._result=0,this._requiredFurnis=null,this._missingFurnis=null,!0}parse(t){this._goalId=t.readInt(),this._goalCode=t.readString(),this._result=t.readInt(),this._requiredFurnis=[];let e=t.readInt();for(;e>0;)this._requiredFurnis.push(t.readString()),e--;for(e=t.readInt();e>0;)this._missingFurnis[t.readString()]="",e--;return!0}get goalId(){return this._goalId}get goalCode(){return this._goalCode}get result(){return this._result}get requiredFurnis(){return this._requiredFurnis}isMissing(t){return!!this._missingFurnis[t]}}kr.SUBMITTED=0;kr.ASK_FOR_SUBMIT=1;kr.ASK_FOR_CONFIRM=2;kr.PREREQUISITES_NOT_MET=3;kr.ROOM_DOOR_NOT_OPEN=4;kr.ROOM_TOO_OLD=5;kr.ASK_FOR_ACCEPT_RULES=6;class Gl{}Gl.ALLOWED=0;Gl.REQUIRED_PERK_MISSING=1;Gl.REQUIRED_BADGE_MISSING=2;class yF{flush(){return this._goalId=0,this._goalCode=null,this._resultCode=0,this._votesRemaining=0,!0}parse(t){return this._goalId=t.readInt(),this._goalCode=t.readString(),this._resultCode=t.readInt(),this._votesRemaining=t.readInt(),!0}get goalId(){return this._goalId}get goalCode(){return this._goalCode}get isVotingAllowedForUser(){return this._resultCode===Gl.ALLOWED}get votesRemaining(){return this._votesRemaining}get resultCode(){return this._resultCode}}class CF{flush(){return this._schedulingStr=null,this._code=null,!0}parse(t){return this._schedulingStr=t.readString(),this._code=t.readString(),!0}get schedulingStr(){return this._schedulingStr}get code(){return this._code}}class MF{flush(){return this._isPartOf=!1,this._targetId=0,!0}parse(t){return this._isPartOf=t.readBoolean(),this._targetId=t.readInt(),!0}get isPartOf(){return this._isPartOf}get targetId(){return this._targetId}}class NF{flush(){return!0}parse(t){return!0}}class PF{flush(){return this._timeStr=null,this._secondsUntil=0,!0}parse(t){return this._timeStr=t.readString(),this._secondsUntil=t.readInt(),!0}get timeStr(){return this._timeStr}get secondsUntil(){return this._secondsUntil}}class fT{constructor(t){this._recipeName=t.readString(),this._itemName=t.readString()}get recipeName(){return this._recipeName}get itemName(){return this._itemName}}class bF{constructor(){this._recipes=[],this._ingredients=[]}flush(){return this._recipes=[],this._ingredients=[],!0}parse(t){if(!t)return!1;const e=t.readInt();for(let r=0;r<e;r++)this._recipes.push(new fT(t));const i=t.readInt();for(let r=0;r<i;r++)this._ingredients.push(t.readString());return!0}get recipes(){return this._recipes}get ingredients(){return this._ingredients}isActive(){return this._recipes.length>0||this._ingredients.length>0}}class DF{constructor(t){this._count=t.readInt(),this._itemName=t.readString()}get count(){return this._count}get itemName(){return this._itemName}}class LF{constructor(){this._ingredients=[]}parse(t){if(!t)return!1;const e=t.readInt();for(let i=0;i<e;i++)this._ingredients.push(new DF(t));return!0}flush(){return this._ingredients=[],!0}get ingredients(){return this._ingredients}}class UF{parse(t){return t?(this._count=t.readInt(),this._hasRecipes=t.readBoolean(),!0):!1}flush(){return this._count=0,this._hasRecipes=!1,!0}get count(){return this._count}get hasRecipes(){return this._hasRecipes}}class xF{parse(t){return t?(this._success=t.readBoolean(),this._success&&(this._result=new fT(t)),!0):!1}flush(){return this._success=!1,!0}get success(){return this._success}get result(){return this._result}}class FF{flush(){return!0}parse(t){return!!t}}class wF{constructor(t){if(!t)throw new Error("invalid_wrapper");this._senderId=t.readInt(),this._errorCode=t.readInt()}get senderId(){return this._senderId}get errorCode(){return this._errorCode}}class GF{flush(){return this._failuers=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._failuers.push(new wF(t)),e--;return!0}get failures(){return this._failuers}}class BF{flush(){return this._success=!1,!0}parse(t){return t?(this._success=t.readBoolean(),!0):!1}get success(){return this._success}}class HF{flush(){return this._errorCode=0,!0}parse(t){return t?(this._errorCode=t.readInt(),!0):!1}get errorCode(){return this._errorCode}}class gT{constructor(t){if(!t)throw new Error("invalid_wrapper");this._id=t.readInt(),this._name=t.readString()}get id(){return this._id}get name(){return this._name}}class td{constructor(t){if(!t)throw new Error("invalid_wrapper");this._id=t.readInt(),this._name=t.readString(),this._gender=t.readInt(),this._online=t.readBoolean(),this._followingAllowed=t.readBoolean(),this._figure=t.readString(),this._categoryId=t.readInt(),this._motto=t.readString(),this._realName=t.readString(),this._lastAccess=t.readString(),this._persistedMessageUser=t.readBoolean(),this._vipMember=t.readBoolean(),this._pocketHabboUser=t.readBoolean(),this._relationshipStatus=t.readShort()}get id(){return this._id}get name(){return this._name}get gender(){return this._gender}get online(){return this._online}get followingAllowed(){return this._followingAllowed}get figure(){return this._figure}get categoryId(){return this._categoryId}get motto(){return this._motto}get lastAccess(){return this._lastAccess}get realName(){return this._realName}get persistedMessageUser(){return this._persistedMessageUser}get vipMember(){return this._vipMember}get pocketHabboUser(){return this._pocketHabboUser}get relationshipStatus(){return this._relationshipStatus}}class VF{flush(){return this._totalFragments=0,this._fragmentNumber=0,this._fragment=[],!0}parse(t){if(!t)return!1;this._totalFragments=t.readInt(),this._fragmentNumber=t.readInt();let e=t.readInt();for(;e>0;)this._fragment.push(new td(t)),e--;return!0}get totalFragments(){return this._totalFragments}get fragmentNumber(){return this._fragmentNumber}get fragment(){return this._fragment}}class kF{flush(){return this._categories=[],this._removedFriendIds=[],this._addedFriends=[],this._updatedFriends=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._categories.push(new gT(t)),e--;let i=t.readInt();for(;i>0;){const r=t.readInt();r===-1?this._removedFriendIds.push(t.readInt()):r===0?this._updatedFriends.push(new td(t)):r===1&&this._addedFriends.push(new td(t)),i--}return!0}get categories(){return this._categories}get removedFriendIds(){return this._removedFriendIds}get addedFriends(){return this._addedFriends}get updatedFriends(){return this._updatedFriends}}class jF{flush(){return this._typeCode=-1,this._avatarId=0,this._message=null,!0}parse(t){return t?(this._typeCode=t.readInt(),this._avatarId=t.readInt(),this._message=t.readString(),!0):!1}get typeCode(){return this._typeCode}get avatarId(){return this._avatarId}get message(){return this._message}}class ET{constructor(t){if(!t)throw new Error("invalid_wrapper");this._requestId=t.readInt(),this._requesterName=t.readString(),this._figureString=t.readString(),this._requesterUserId=this._requestId}get requestId(){return this._requestId}get requesterName(){return this._requesterName}get requesterUserId(){return this._requesterUserId}get figureString(){return this._figureString}}class zF{flush(){return this._totalRequests=0,this._requests=[],!0}parse(t){if(!t)return!1;this._totalRequests=t.readInt();let e=t.readInt();for(;e>0;)this._requests.push(new ET(t)),e--;return!0}get totalRequests(){return this._totalRequests}get requests(){return this._requests}}class hp{constructor(t){if(!t)throw new Error("invalid_wrapper");this._avatarId=t.readInt(),this._avatarName=t.readString(),this._avatarMotto=t.readString(),this._isAvatarOnline=t.readBoolean(),this._canFollow=t.readBoolean(),this._lastOnlineData=t.readString(),this._avatarGender=t.readInt(),this._avatarFigure=t.readString(),this._realName=t.readString()}get avatarId(){return this._avatarId}get avatarName(){return this._avatarName}get avatarMotto(){return this._avatarMotto}get isAvatarOnline(){return this._isAvatarOnline}get canFollow(){return this._canFollow}get avatarGender(){return this._avatarGender}get avatarFigure(){return this._avatarFigure}get lastOnlineData(){return this._lastOnlineData}get realName(){return this._realName}}class YF{flush(){return this._friends=[],this._others=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._friends.push(new hp(t)),e--;let i=t.readInt();for(;i>0;)this._others.push(new hp(t)),i--;return!0}get friends(){return this._friends}get others(){return this._others}}class WF{flush(){return this._errorCode=0,this._userId=0,this._message=null,!0}parse(t){return t?(this._errorCode=t.readInt(),this._userId=t.readInt(),this._message=t.readString(),!0):!1}get errorCode(){return this._errorCode}get userId(){return this._userId}get message(){return this._message}}class XF{flush(){return this._clientMessageId=0,this._errorCode=0,!0}parse(t){return t?(this._clientMessageId=t.readInt(),this._errorCode=t.readInt(),!0):!1}get clientMessageId(){return this._clientMessageId}get errorCode(){return this._errorCode}}class KF{flush(){return this._userFriendLimit=0,this._normalFriendLimit=0,this._extendedFriendLimit=0,this._categories=[],!0}parse(t){if(!t)return!1;this._userFriendLimit=t.readInt(),this._normalFriendLimit=t.readInt(),this._extendedFriendLimit=t.readInt();let e=t.readInt();for(;e>0;)this._categories.push(new gT(t)),e--;return!0}get userFriendLimit(){return this._userFriendLimit}get normalFriendLimit(){return this._normalFriendLimit}get extendedFriendLimit(){return this._extendedFriendLimit}get categories(){return this._categories}}class qF{flush(){return!0}parse(t){return!!t}}class ZF{flush(){return this._count=0,!0}parse(t){return t?(this._count=t.readInt(),!0):!1}get count(){return this._count}}class QF{flush(){return this._senderId=0,this._messageText=null,this._secondsSinceSent=0,this._extraData=null,!0}parse(t){return t?(this._senderId=t.readInt(),this._messageText=t.readString(),this._secondsSinceSent=t.readInt(),t.bytesAvailable&&(this._extraData=t.readString()),!0):!1}get senderId(){return this._senderId}get messageText(){return this._messageText}get secondsSinceSent(){return this._secondsSinceSent}get extraData(){return this._extraData}}class JF{flush(){return this._request=null,!0}parse(t){return t?(this._request=new ET(t),!0):!1}get request(){return this._request}}class $F{flush(){return this._errorCode=0,this._failedRecipients=[],!0}parse(t){if(!t)return!1;this._errorCode=t.readInt();let e=t.readInt();for(;e>0;)this._failedRecipients.push(t.readInt()),e--;return!0}get errorCode(){return this._errorCode}get failedRecipients(){return this._failedRecipients}}class tw{flush(){return this._senderId=0,this._messageText=null,!0}parse(t){return t?(this._senderId=t.readInt(),this._messageText=t.readString(),!0):!1}get senderId(){return this._senderId}get messageText(){return this._messageText}}class ew{flush(){return!0}parse(t){return t?(this._gameTypeId=t.readInt(),this._freeGamesLeft=t.readInt(),this._gamesPlayedTotal=t.readInt(),!0):!1}get gameTypeId(){return this._gameTypeId}get freeGamesLeft(){return this._freeGamesLeft}get gamesPlayedTotal(){return this._gamesPlayedTotal}get hasUnlimitedGames(){return this._freeGamesLeft==-1}}class mh{flush(){return this._status=-1,this._blockLength=-1,this._gamesPlayed=-1,this._freeGamesLeft=-1,!0}parse(t){return t?(this._status=t.readInt(),this._blockLength=t.readInt(),this._gamesPlayed=t.readInt(),this._freeGamesLeft=t.readInt(),!0):!1}get status(){return this._status}get blockLength(){return this._blockLength}get gamesPlayed(){return this._gamesPlayed}get freeGamesLeft(){return this._freeGamesLeft}get hasUnlimitedGames(){return this._freeGamesLeft==-1}}mh.STATUS_OK=0;mh.STATUS_FAILED_REASON_UNKNOWN=1;mh.STATUS_FAILED_REASON_GAME_DIRECTORY_IS_NOT_AVAILABLE=2;mh.STATUS_FAILED_REASON_HOTEL_IS_CLOSED=3;class sw{flush(){return this._position=-1,!0}parse(t){return t?(this._position=t.readInt(),!0):!1}get position(){return this._position}}class rr{flush(){return this._reason=-1,!0}parse(t){return t?(this._reason=t.readInt(),!0):!1}get reason(){return this._reason}}rr.KICKED=1;rr.DUPLICATE_MACHINEID=2;rr.INVITATION_REQUIRED=3;rr.NO_SPACE_IN_TEAM=4;rr.TEAM_NOT_FOUND=5;rr.USER_HAS_ACTIVE_INSTANCE=6;rr.USER_HAS_PENDING_INSTANCE_REQUEST=7;rr.USER_HAS_NO_FREE_GAMES_LEFT=8;class Vf{flush(){return this._reason=-1,!0}parse(t){return t?(this._reason=t.readInt(),!0):!1}get reason(){return this._reason}}Vf.NOT_ENOUGH_PLAYERS=1;Vf.GAME_HAS_NO_OWNER=2;class iw{flush(){return!0}parse(t){return!!t}}class rw{flush(){return this._userId=-1,!0}parse(t){return t?(this._userId=t.readInt(),!0):!1}get userId(){return this._userId}}class nw{flush(){return!0}parse(t){return t?(this._stuffCode=t.readString(),this._badgeCode=t.readString(),!0):!1}get stuffCode(){return this._stuffCode}get badgeCode(){return this._badgeCode}}class aw{flush(){return this._stuffId=-1,this._achievementId=0,this._requiredLevelBadgeCode="",this._userProgress=0,this._totalProgress=0,this._endTime=0,!0}parse(t){return t?(this._stuffId=t.readInt(),this._achievementId=t.readInt(),this._requiredLevelBadgeCode=t.readString(),this._userProgress=t.readInt(),this._totalProgress=t.readInt(),this._endTime=t.readInt(),!0):!1}get stuffId(){return this._stuffId}get achievementId(){return this._achievementId}get requiredLevelBadgeCode(){return this._requiredLevelBadgeCode}get userProgress(){return this._userProgress}get totalProgress(){return this._totalProgress}get endTime(){return this._endTime}}class ow{flush(){return!0}parse(t){if(!t)return!1;this._stuffId=t.readInt();const e=t.readInt();let i=0;for(;i<e;)this._achievements.push(new cT(t)),i++;return this._endTime=t.readInt(),!0}get stuffId(){return this._stuffId}get achievements(){return this._achievements}get endTime(){return this._endTime}}class hw{constructor(t,e,i,r){this._gameTypeId=t,this._achievementId=e,this._achievementName=i,this._levels=r}get gameTypeId(){return this._gameTypeId}get achievementId(){return this._achievementId}get achievementName(){return this._achievementName}get levels(){return this._levels}}class uw{flush(){return!0}parse(t){if(!t)return!1;this._achievements=[];const e=t.readInt();let i=0;for(;i<e;){const r=t.readInt(),n=t.readInt();let a=0;for(;a<n;){const o=t.readInt(),h=t.readString(),u=t.readInt();this._achievements.push(new hw(r,o,h,u)),a++}i++}return!0}get achievements(){return this._achievements}}class lw{constructor(t,e,i,r,n,a){this._gameId=t,this._gameNameId=e,this._bgColor=i,this._textColor=r,this._assetUrl=n,this._supportUrl=a}get gameId(){return this._gameId}get gameNameId(){return this._gameNameId}get bgColor(){return this._bgColor}get textColor(){return this._textColor}get assetUrl(){return this._assetUrl}get supportUrl(){return this._supportUrl}}class _w{flush(){return!0}parse(t){return t?(this._gameTypeId=t.readInt(),this._inviterId=t.readInt(),!0):!1}get gameTypeId(){return this._gameTypeId}get inviterId(){return this._inviterId}}class cw{flush(){return!0}parse(t){if(!t)return!1;this._games=[];const e=t.readInt();for(let i=0;i<e;i++){const r=t.readInt(),n=t.readString(),a=t.readString();let o=parseInt(a,16);o=o|4278190080;const h=t.readString();let u=parseInt(h,16);u=u|4278190080;const c=t.readString(),l=t.readString();this._games.push(new lw(r,n,o,u,c,l))}return!0}get games(){return this._games}}const ed=class{flush(){return!0}parse(s){return s?(this._gameTypeId=s.readInt(),this._status=s.readInt(),!0):!1}get gameTypeId(){return this._gameTypeId}get isOk(){return this._status==ed.OK}get isInMaintenance(){return this._status==ed.MAINTENANCE}};let kf=ed;kf.OK=0;kf.MAINTENANCE=1;class dw{flush(){return!0}parse(t){return t?(this._gameTypeId=t.readInt(),!0):!1}get gameTypeId(){return this._gameTypeId}}class pT{flush(){return!0}parse(t){return t?(this._gameTypeId=t.readInt(),this._reason=t.readInt(),!0):!1}get gameTypeId(){return this._gameTypeId}get reason(){return this._reason}}pT.DUPLICATE_MACHINEID=1;class fw{flush(){return!0}parse(t){return t?(this._gameTypeId=t.readInt(),!0):!1}get gameTypeId(){return this._gameTypeId}}class gw{flush(){return!0}parse(t){if(!t)return!1;this._gameTypeId=t.readInt(),this._gameClientId=t.readString(),this._url=t.readString(),this._quality=t.readString(),this._scaleMode=t.readString(),this._frameRate=t.readInt(),this._minMajorVersion=t.readInt(),this._minMinorVersion=t.readInt(),this._params=new Map;const e=t.readInt();let i=0;for(;i<e;)this._params.set(t.readString(),t.readString()),i++;return!0}get gameTypeId(){return this._gameTypeId}get url(){return this._url}get quality(){return this._quality}get scaleMode(){return this._scaleMode}get frameRate(){return this._frameRate}get minMajorVersion(){return this._minMajorVersion}get minMinorVersion(){return this._minMinorVersion}get params(){return this._params}get gameClientId(){return this._gameClientId}}class Ew{flush(){return this._gameTypeId=0,this._url=null,this._gameClientId=null,!0}parse(t){return t?(this._gameTypeId=t.readInt(),this._gameClientId=t.readString(),this._url=t.readString(),!0):!1}get gameTypeId(){return this._gameTypeId}get url(){return this._url}get gameClientId(){return this._gameClientId}}class pw{flush(){return!0}parse(t){return t?(this._gameTypeId=t.readInt(),this._gameClientId=t.readString(),!0):!1}get gameTypeId(){return this._gameTypeId}get gameClientId(){return this._gameClientId}}class mw{flush(){return!0}parse(t){return!!t}}class Bl{flush(){return this._year=-1,this._week=-1,this._maxOffset=-1,this._currentOffset=-1,this._minutesUntilReset=-1,!0}parse(t){return t?(this._year=t.readInt(),this._week=t.readInt(),this._maxOffset=t.readInt(),this._currentOffset=t.readInt(),this._minutesUntilReset=t.readInt(),!0):!1}get year(){return this._year}get week(){return this._week}get maxOffset(){return this._maxOffset}get currentOffset(){return this._currentOffset}get minutesUntilReset(){return this._minutesUntilReset}}class Iw{constructor(t){this._name=t.readString(),this._figure=t.readString(),this._gender=t.readString(),this._rank=t.readInt(),this._score=t.readInt()}get name(){return this._name}get figure(){return this._figure}get gender(){return this._gender}get rank(){return this._rank}get score(){return this._score}}class Tw{flush(){return this._gameTypeId=-1,this._products=[],this._minutesUntilNextWeek=0,this._rewardingOn=!0,!0}parse(t){if(!t)return!1;this._gameTypeId=t.readInt();let e=t.readInt();for(;e>0;)this._products.push(new Hr(t)),e--;return this._minutesUntilNextWeek=t.readInt(),this._rewardingOn=t.readBoolean(),!0}get gameTypeId(){return this._gameTypeId}get products(){return this._products}get minutesUntilNextWeek(){return this._minutesUntilNextWeek}get rewardingOn(){return this._rewardingOn}}class Rw{flush(){return this._gameTypeId=-1,this._winners=[],!0}parse(t){if(!t)return!1;this._gameTypeId=t.readInt();let e=t.readInt();for(;e>0;)this._winners.push(new Iw(t)),e--;return!0}get gameTypeId(){return this._gameTypeId}get winners(){return this._winners}}class Ow{flush(){return this._errorCode=0,!0}parse(t){return t?(this._errorCode=t.readInt(),!0):!1}get errorCode(){return this._errorCode}}class Aw{flush(){return this._phoneStatusCode=-1,this._millisecondsToAllowProcessReset=-1,!0}parse(t){return t?(this._phoneStatusCode=t.readInt(),this._collectionStatusCode=t.readInt(),this._millisecondsToAllowProcessReset=t.readInt(),!0):!1}get phoneStatusCode(){return this._phoneStatusCode}get collectionStatusCode(){return this._collectionStatusCode}get millisecondsToAllowProcessReset(){return this._millisecondsToAllowProcessReset}}class vw{flush(){return this._resultCode=-1,!0}parse(t){return t?(this._resultCode=t.readInt(),this._millisToAllowProcessReset=t.readInt(),!0):!1}get resultCode(){return this._resultCode}get millisToAllowProcessReset(){return this._millisToAllowProcessReset}}class Sw{flush(){return this._resultCode=-1,this._millisecondsToAllowProcessReset=-1,!0}parse(t){return t?(this._resultCode=t.readInt(),this._millisecondsToAllowProcessReset=t.readInt(),!0):!1}get resultCode(){return this._resultCode}get millisToAllowProcessReset(){return this._millisecondsToAllowProcessReset}}class yw{flush(){return this._bases=new Map,this._symbols=new Map,this._partColors=new Map,this._colorsA=new Map,this._colorsB=new Map,!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;){const o=t.readInt(),h=t.readString(),u=t.readString();this._bases.set(o,[h,u]),e--}let i=t.readInt();for(;i>0;){const o=t.readInt(),h=t.readString(),u=t.readString();this._symbols.set(o,[h,u]),i--}let r=t.readInt();for(;r>0;){const o=t.readInt(),h=t.readString();this._partColors.set(o,h),r--}let n=t.readInt();for(;n>0;){const o=t.readInt(),h=t.readString();this._colorsA.set(o,h),n--}let a=t.readInt();for(;a>0;){const o=t.readInt(),h=t.readString();this._colorsB.set(o,h),a--}return!0}get bases(){return this._bases}get symbols(){return this._symbols}get partColors(){return this._partColors}get colorsA(){return this._colorsA}get colorsB(){return this._colorsB}}class Cw{flush(){return this._groupCost=0,this._availableRooms=new Map,!0}parse(t){if(!t)return!1;this._groupCost=t.readInt();let e=t.readInt();for(;e>0;){const i=t.readInt(),r=t.readString();t.readBoolean(),this._availableRooms.set(i,r),e--}return!0}get groupCost(){return this._groupCost}get availableRooms(){return this._availableRooms}}class Mw{flush(){return this._userId=0,this._furnitureCount=0,!0}parse(t){return t?(this._userId=t.readInt(),this._furnitureCount=t.readInt(),!0):!1}get userId(){return this._userId}get furnitureCount(){return this._furnitureCount}}class Nw{flush(){return this._id=0,this._type=0,this._title=null,this._description=null,this._badge=null,this._roomId=0,this._roomName=null,this._membershipType=0,this._membersCount=0,this._isFavorite=!1,this._createdAt=null,this._isOwner=!1,this._isAdmin=!1,this._ownerName=null,this._flag=!1,this._canMembersDecorate=!1,this._pendingRequestsCount=0,!0}parse(t){return t?(this._id=t.readInt(),t.readBoolean(),this._type=t.readInt(),this._title=t.readString(),this._description=t.readString(),this._badge=t.readString(),this._roomId=t.readInt(),this._roomName=t.readString(),this._membershipType=t.readInt(),this._membersCount=t.readInt(),this._isFavorite=t.readBoolean(),this._createdAt=t.readString(),this._isOwner=t.readBoolean(),this._isAdmin=t.readBoolean(),this._ownerName=t.readString(),this._flag=t.readBoolean(),this._canMembersDecorate=t.readBoolean(),this._pendingRequestsCount=t.readInt(),!0):!1}get id(){return this._id}get type(){return this._type}get title(){return this._title}get description(){return this._description}get badge(){return this._badge}get roomId(){return this._roomId}get roomName(){return this._roomName}get membershipType(){return this._membershipType}get membersCount(){return this._membersCount}get isFavorite(){return this._isFavorite}get createdAt(){return this._createdAt}get isOwner(){return this._isOwner}get isAdmin(){return this._isAdmin}get ownerName(){return this._ownerName}get flag(){return this._flag}get canMembersDecorate(){return this._canMembersDecorate}get pendingRequestsCount(){return this._pendingRequestsCount}}class Pw{constructor(t){this.isBase=t,this.key=0,this.color=0,this.position=4}get code(){return this.key===0?null:(this.isBase?"b":"s")+(this.key<100?"0":"")+(this.key<10?"0":"")+this.key+(this.color<10?"0":"")+this.color+this.position}}class Ih{}Ih.OWNER=0;Ih.ADMIN=1;Ih.MEMBER=2;Ih.REQUESTED=3;Ih.DELETED=4;class bw{constructor(t){if(!t)throw new Error("invalid_wrapper");this.flush(),this.parse(t)}flush(){return this._rank=-1,this._id=0,this._name=null,this._figure=null,this._joinedAt=null,!0}parse(t){return t?(this._rank=t.readInt(),this._id=t.readInt(),this._name=t.readString(),this._figure=t.readString(),this._joinedAt=t.readString(),!0):!1}get id(){return this._id}get name(){return this._name}get figure(){return this._figure}get rank(){return this._rank}get joinedAt(){return this._joinedAt}}class Dw{flush(){return this._groupId=0,this._groupTitle=null,this._roomId=0,this._badge=null,this._totalMembersCount=0,this._result=[],this._admin=!1,this._pageSize=0,this._pageIndex=0,this._level=0,this._query=null,!0}parse(t){if(!t)return!1;this._groupId=t.readInt(),this._groupTitle=t.readString(),this._roomId=t.readInt(),this._badge=t.readString(),this._totalMembersCount=t.readInt();let e=t.readInt();for(;e>0;)this._result.push(new bw(t)),e--;return this._admin=t.readBoolean(),this._pageSize=t.readInt(),this._pageIndex=t.readInt(),this._level=t.readInt(),this._query=t.readString(),!0}get groupId(){return this._groupId}get groupTitle(){return this._groupTitle}get roomId(){return this._roomId}get badge(){return this._badge}get totalMembersCount(){return this._totalMembersCount}get result(){return this._result}get admin(){return this._admin}get pageSize(){return this._pageSize}get pageIndex(){return this._pageIndex}get level(){return this._level}get query(){return this._query}}class Lw{flush(){return this._roomId=0,this._groupId=0,!0}parse(t){return t?(this._roomId=t.readInt(),this._groupId=t.readInt(),!0):!1}get roomId(){return this._roomId}get guildId(){return this._groupId}}class Uw{flush(){return this._roomId=0,this._roomName=null,this._id=0,this._title=null,this._description=null,this._colorA=0,this._colorB=0,this._state=0,this._canMembersDecorate=!1,this._badgeParts=new Map,this._badgeCode=null,this._membersCount=0,!0}parse(t){if(!t)return!1;t.readInt()===1&&(this._roomId=t.readInt(),this._roomName=t.readString(),t.readBoolean()),t.readBoolean(),this._id=t.readInt(),this._title=t.readString(),this._description=t.readString(),t.readInt(),this._colorA=t.readInt(),this._colorB=t.readInt(),this._state=t.readInt(),this._canMembersDecorate=t.readInt()===0,t.readBoolean(),t.readString();const i=t.readInt();for(let r=0;r<i;r++){const n=new Pw(r===0);n.key=t.readInt(),n.color=t.readInt(),n.position=t.readInt(),n.key===0&&(n.position=4),this._badgeParts.set(r,n)}return this._badgeCode=t.readString(),this._membersCount=t.readInt(),!0}get roomId(){return this._roomId}get roomName(){return this._roomName}get id(){return this._id}get title(){return this._title}get description(){return this._description}get colorA(){return this._colorA}get colorB(){return this._colorB}get state(){return this._state}get canMembersDecorate(){return this._canMembersDecorate}get badgeParts(){return this._badgeParts}get badgeCode(){return this._badgeCode}get membersCount(){return this._membersCount}}class xw{flush(){return!0}parse(t){return this._groupId=t.readInt(),!0}get groupId(){return this._groupId}}class th{static parse(t){return this.fillFromMessage(new th,t)}static fillFromMessage(t,e){return t._groupId=e.readInt(),t._name=e.readString(),t._description=e.readString(),t._icon=e.readString(),t._totalThreads=e.readInt(),t._leaderboardScore=e.readInt(),t._totalMessages=e.readInt(),t._unreadMessages=e.readInt(),t._lastMessageId=e.readInt(),t._lastMessageAuthorId=e.readInt(),t._lastMessageAuthorName=e.readString(),t._lastMessageTimeAsSecondsAgo=e.readInt(),t}get groupId(){return this._groupId}get name(){return this._name}get description(){return this._description}get icon(){return this._icon}get totalThreads(){return this._totalThreads}get leaderboardScore(){return this._leaderboardScore}get totalMessages(){return this._totalMessages}get unreadMessages(){return this._unreadMessages}get lastMessageId(){return this._lastMessageId}get lastMessageAuthorId(){return this._lastMessageAuthorId}get lastMessageAuthorName(){return this._lastMessageAuthorName}get lastMessageTimeAsSecondsAgo(){return this._lastMessageTimeAsSecondsAgo}updateFrom(t){this._totalThreads=t._totalThreads,this._totalMessages=t._totalMessages,this._unreadMessages=t._unreadMessages,this._lastMessageAuthorId=t._lastMessageAuthorId,this._lastMessageAuthorName=t._lastMessageAuthorName,this._lastMessageId=t._lastMessageId,this._lastMessageTimeAsSecondsAgo=t._lastMessageTimeAsSecondsAgo}get lastReadMessageId(){return this._totalMessages-this._unreadMessages}set lastReadMessageId(t){this._unreadMessages=this._totalMessages-t,this._unreadMessages<0&&(this._unreadMessages=0)}addNewThread(t){this._lastMessageAuthorId=t.lastUserId,this._lastMessageAuthorName=t.lastUserName,this._lastMessageId=t.lastMessageId,this._lastMessageTimeAsSecondsAgo=t.lastCommentTime,this._totalThreads++,this._totalMessages++,this._unreadMessages=0}}class jf extends th{static parse(t){const e=new jf;return th.fillFromMessage(e,t),e._readPermissions=t.readInt(),e._postMessagePermissions=t.readInt(),e._postThreadPermissions=t.readInt(),e._moderatePermissions=t.readInt(),e._readPermissionError=t.readString(),e._postMessagePermissionError=t.readString(),e._postThreadPermissionError=t.readString(),e._moderatePermissionError=t.readString(),e._reportPermissionError=t.readString(),e._canChangeSettings=t.readBoolean(),e._isStaff=t.readBoolean(),e}get readPermissions(){return this._readPermissions}get postMessagePermissions(){return this._postMessagePermissions}get postThreadPermissions(){return this._postThreadPermissions}get moderatePermissions(){return this._moderatePermissions}get hasReadPermissionError(){return this._readPermissionError.length===0}get canReport(){return!0}get hasPostMessagePermissionError(){return this._postMessagePermissionError.length===0}get hasPostThreadPermissionError(){return this._postThreadPermissionError.length===0}get hasModeratePermissionError(){return this._moderatePermissionError.length===0}get canChangeSettings(){return this._canChangeSettings}get isStaf(){return this._isStaff}get readPermissionError(){return this._readPermissionError}get postMessagePermissionError(){return this._postMessagePermissionError}get postThreadPermissionError(){return this._postThreadPermissionError}get moderatePermissionError(){return this._moderatePermissionError}get reportPermissionError(){return this._reportPermissionError}}class Fw{flush(){return this._extendedForumData=null,!0}parse(t){return t?(this._extendedForumData=jf.parse(t),!0):!1}get extendedForumData(){return this._extendedForumData}}class ww{flush(){return this._listCode=-1,this._totalAmount=0,this._startIndex=-1,this._amount=0,this._forums=[],!0}parse(t){if(!t)return!1;this._listCode=t.readInt(),this._totalAmount=t.readInt(),this._startIndex=t.readInt(),this._amount=t.readInt(),this._forums=[];let e=0;for(;e<this._amount;)this._forums.push(th.parse(t)),e++;return!0}get listCode(){return this._listCode}get totalAmount(){return this._totalAmount}get startIndex(){return this._startIndex}get amount(){return this._amount}get forums(){return this._forums}}class Th{static parse(t){const e=new Th;return e._threadId=t.readInt(),e._authorId=t.readInt(),e._authorName=t.readString(),e._header=t.readString(),e._isPinned=t.readBoolean(),e._isLocked=t.readBoolean(),e._creationTimeAsSecondsAgo=t.readInt(),e._totalMessages=t.readInt(),e._unreadMessagesCount=t.readInt(),e._lastMessageId=t.readInt(),e._lastUserId=t.readInt(),e._lastUserName=t.readString(),e._lastCommentTime=t.readInt(),e._state=t.readByte(),e._adminId=t.readInt(),e._adminName=t.readString(),e._adminOperationTimeAsSecondsAgo=t.readInt(),e}get adminOperationTimeAsSecondsAgo(){return this._adminOperationTimeAsSecondsAgo}set adminOperationTimeAsSecondsAgo(t){this._adminOperationTimeAsSecondsAgo=t}get lastCommentTime(){return this._lastCommentTime}set lastCommentTime(t){this._lastCommentTime=t}get threadId(){return this._threadId}set threadId(t){this._threadId=t}get authorId(){return this._authorId}set authorId(t){this._authorId=t}get authorName(){return this._authorName}set authorName(t){this._authorName=t}get creationTimeAsSecondsAgo(){return this._creationTimeAsSecondsAgo}set creationTimeAsSecondsAgo(t){this._creationTimeAsSecondsAgo=t}get header(){return this._header}set header(t){this._header=t}get lastMessageId(){return this._lastMessageId}set lastMessageId(t){this._lastMessageId=t}get lastUserId(){return this._lastUserId}set lastUserId(t){this._lastUserId=t}get lastUserName(){return this._lastUserName}set lastUserName(t){this._lastUserName=t}get totalMessages(){return this._totalMessages}set totalMessages(t){this._totalMessages=t}get unreadMessagesCount(){return this._unreadMessagesCount}set unreadMessagesCount(t){this._unreadMessagesCount=t}get state(){return this._state}set state(t){this._state=t}get adminId(){return this._adminId}set adminId(t){this._adminId=t}get adminName(){return this._adminName}set adminName(t){this._adminName=t}get isPinned(){return this._isPinned}set isPinned(t){this._isPinned=t}get isLocked(){return this._isLocked}set isLocked(t){this._isLocked=t}}class Gw{flush(){return this._groupId=-1,this._startIndex=-1,this._amount=0,this._threads=[],!0}parse(t){if(!t)return!1;this._groupId=t.readInt(),this._startIndex=t.readInt(),this._amount=t.readInt(),this._threads=[];let e=0;for(;e<this._amount;)this._threads.push(Th.parse(t)),e++;return!0}get groupId(){return this._groupId}get startIndex(){return this._startIndex}get amount(){return this._amount}get threads(){return this._threads}}class Rh{static parse(t){const e=new Rh;return e._messageId=t.readInt(),e._messageIndex=t.readInt(),e._authorId=t.readInt(),e._authorName=t.readString(),e._authorFigure=t.readString(),e._creationTime=t.readInt(),e._messageText=t.readString(),e._state=t.readByte(),e._adminId=t.readInt(),e._adminName=t.readString(),e._adminOperationTimeAsSeccondsAgo=t.readInt(),e._authorPostCount=t.readInt(),e}get state(){return this._state}set state(t){this._state=t}get adminId(){return this._adminId}set adminId(t){this._adminId=t}get adminName(){return this._adminName}set adminName(t){this._adminName=t}get adminOperationTimeAsSeccondsAgo(){return this._adminOperationTimeAsSeccondsAgo}set adminOperationTimeAsSeccondsAgo(t){this._adminOperationTimeAsSeccondsAgo=t}get messageId(){return this._messageId}set messageId(t){this._messageId=t}get creationTime(){return this._creationTime}set creationTime(t){this._creationTime=t}get authorName(){return this._authorName}set authorName(t){this._authorName=t}get authorFigure(){return this._authorFigure}set authorFigure(t){this._authorFigure=t}get threadId(){return this._threadId}set threadId(t){this._threadId=t}get messageIndex(){return this._messageIndex}set messageIndex(t){this._messageIndex=t}set groupID(t){this._groupId=t}get groupId(){return this._groupId}get authorId(){return this._authorId}set authorId(t){this._authorId=t}get messageText(){return this._messageText}set messageText(t){this._messageText=t}get authorPostCount(){return this._authorPostCount}set authorPostCount(t){this._authorPostCount=t}}class Bw{flush(){return this._groupId=-1,this._threadId=-1,this._message=null,!0}parse(t){return t?(this._groupId=t.readInt(),this._threadId=t.readInt(),this._message=Rh.parse(t),!0):!1}get groupId(){return this._groupId}get threadId(){return this._threadId}get message(){return this._message}}class Hw{flush(){return this._groupId=-1,this._thread=null,!0}parse(t){return t?(this._groupId=t.readInt(),this._thread=Th.parse(t),!0):!1}get groupId(){return this._groupId}get thread(){return this._thread}}class Vw{flush(){return this._groupId=-1,this._threadId=-1,this._startIndex=-1,this._amount=0,this._messages=[],!0}parse(t){if(!t)return!1;this._groupId=t.readInt(),this._threadId=t.readInt(),this._startIndex=t.readInt(),this._amount=t.readInt(),this._messages=[];let e=0;for(;e<this._amount;){const i=Rh.parse(t);i.groupID=this._groupId,i.threadId=this._threadId,this._messages.push(i),e++}return!0}get groupId(){return this._groupId}get threadId(){return this._threadId}get startIndex(){return this._startIndex}get amount(){return this._amount}get messages(){return this._messages}}class kw{flush(){return this._count=0,!0}parse(t){return t?(this._count=t.readInt(),!0):!1}get count(){return this._count}}class jw{flush(){return this._groupId=-1,this._threadId=-1,this._message=null,!0}parse(t){return t?(this._groupId=t.readInt(),this._threadId=t.readInt(),this._message=Rh.parse(t),!0):!1}get groupId(){return this._groupId}get threadId(){return this._threadId}get message(){return this._message}}class zw{flush(){return this._groupId=-1,this._thread=null,!0}parse(t){return t?(this._groupId=t.readInt(),this._thread=Th.parse(t),!0):!1}get groupId(){return this._groupId}get thread(){return this._thread}}class Yw{constructor(){this._encryptedPublicKey=null,this._serverClientEncryption=!1}flush(){return!0}parse(t){return t?(this._encryptedPublicKey=t.readString(),t.bytesAvailable&&(this._serverClientEncryption=t.readBoolean()),!0):!1}get encryptedPublicKey(){return this._encryptedPublicKey}get serverClientEncryption(){return this._serverClientEncryption}}class Ww{flush(){return this._reason=-1,!0}parse(t){return t?(this._reason=0,t.bytesAvailable&&(this._reason=t.readInt()),!0):!1}get reason(){return this._reason}}class Xw{flush(){return this._accounts&&(this._accounts=new Map),!0}parse(t){if(!t)return!1;this._accounts=new Map;let e=t.readInt();for(;e>0;)this._accounts.set(t.readInt(),t.readString()),e--;return!0}get accounts(){return this._accounts}}class Kw{flush(){return!0}parse(t){return t?(this._encryptedPrime=t.readString(),this._encryptedGenerator=t.readString(),!0):!1}get encryptedPrime(){return this._encryptedPrime}get encryptedGenerator(){return this._encryptedGenerator}}class qw{flush(){return this._noobnessLevel=0,!0}parse(t){return t?(this._noobnessLevel=t.readInt(),!0):!1}get noobnessLevel(){return this._noobnessLevel}}class Zw{flush(){return!0}parse(t){return t?(this._infoUrl=t.readString(),!0):!1}get infoUrl(){return this._infoUrl}}class Qw{flush(){return!0}parse(t){return!0}}class Jw{flush(){return this._calls=[],!0}parse(t){this._calls=[];const e=t.readInt();for(let i=0;i<e;i++){const r=t.readString(),n=t.readString(),a=t.readString();this._calls.push({callId:r,timeStamp:n,message:a})}return!0}get pendingCalls(){return this._calls}get count(){return this._calls.length}}class $w{flush(){return this._message=null,!0}parse(t){return this._message=t.readString(),!0}get message(){return this._message}}class tG{flush(){return this._resultType=0,this._messageText=null,!0}parse(t){return t?(this._resultType=t.readInt(),this._messageText=t.readString(),!0):!1}get resultType(){return this._resultType}get messageText(){return this._messageText}}class eG{flush(){return!0}parse(t){return!0}}class sG{flush(){return this._acceptanceTimeout=-1,!0}parse(t){return this._acceptanceTimeout=t.readInt(),!0}get acceptanceTimeout(){return this._acceptanceTimeout}}class iG{flush(){return this._winningVoteCode=-1,this._ownVoteCode=-1,this._finalStatus=null,!0}parse(t){this._finalStatus=[],this._winningVoteCode=t.readInt(),this._ownVoteCode=t.readInt();const e=t.readInt();for(let i=0;i<e;i++)this._finalStatus.push(t.readInt());return!0}get winningVoteCode(){return this._winningVoteCode}get ownVoteCode(){return this._ownVoteCode}get finalStatus(){return this._finalStatus}}class rG{flush(){return!0}parse(t){return this._votingTimeout=t.readInt(),this._chatRecord=t.readString(),!0}get votingTimeout(){return this._votingTimeout}get chatRecord(){return this._chatRecord}}class Bn{flush(){return this._status=null,!0}parse(t){this._status=[];const e=t.readInt();for(let i=0;i<e;i++)this._status.push(t.readInt());return!0}get status(){return this._status}}Bn.AWAITING_VOTE=0;Bn.VOTED_OK=1;Bn.VOTED_BAD=2;Bn.VOTED_VERY_BAD=3;Bn.NO_VOTE=4;Bn.FINDING_NEW_VOTER=5;class nG{flush(){return this._onDuty=!1,this._guidesOnDuty=0,this._helpersOnDuty=0,this._guardiansOnDuty=0,!0}parse(t){return t?(this._onDuty=t.readBoolean(),this._guidesOnDuty=t.readInt(),this._helpersOnDuty=t.readInt(),this._guardiansOnDuty=t.readInt(),!0):!1}get onDuty(){return this._onDuty}get guidesOnDuty(){return this._guidesOnDuty}get helpersOnDuty(){return this._helpersOnDuty}get guardiansOnDuty(){return this._guardiansOnDuty}}class aG{constructor(t,e,i,r,n,a,o){this._type=t,this._secondsAgo=e,this._isGuide=i,this._otherPartyName=r,this._otherPartyFigure=n,this._description=a,this._roomName=o}get type(){return this._type}set type(t){this._type=t}get secondsAgo(){return this._secondsAgo}set secondsAgo(t){this._secondsAgo=t}get isGuide(){return this._isGuide}set isGuide(t){this._isGuide=t}get otherPartyName(){return this._otherPartyName}set otherPartyName(t){this._otherPartyName=t}get otherPartyFigure(){return this._otherPartyFigure}set otherPartyFigure(t){this._otherPartyFigure=t}get description(){return this._description}set description(t){this._description=t}get roomName(){return this._roomName}set roomName(t){this._roomName=t}}class Oh{flush(){return this._statusCode=0,this._pendingTicket=null,!0}parse(t){return t?(this._statusCode=t.readInt(),this._pendingTicket=new aG(t.readInt(),t.readInt(),t.readBoolean(),t.readString(),t.readString(),t.readString(),t.readString()),!0):!1}get statusCode(){return this._statusCode}get pendingTicket(){return this._pendingTicket}}Oh.GUIDE_REPORTING_STATUS_OK=0;Oh.GUIDE_REPORTING_STATUS_PENDING_TICKET=1;Oh.GUIDE_REPORTING_STATUS_ABUSIVE=2;Oh.GUIDE_REPORTING_STATUS_REPORTING_TOO_QUICKLY=3;class oG{flush(){return this._asGuide=!1,this._helpRequestType=0,this._helpRequestDescription=null,this._roleSpecificWaitTime=0,!0}parse(t){return t?(this._asGuide=t.readBoolean(),this._helpRequestType=t.readInt(),this._helpRequestDescription=t.readString(),this._roleSpecificWaitTime=t.readInt(),!0):!1}get asGuide(){return this._asGuide}get helpRequestType(){return this._helpRequestType}get helpRequestDescription(){return this._helpRequestDescription}get roleSpecificWaitTime(){return this._roleSpecificWaitTime}}class hG{flush(){return!0}parse(t){return!!t}}class uG{flush(){return this._endReason=0,!0}parse(t){return t?(this._endReason=t.readInt(),!0):!1}get endReason(){return this._endReason}}class Ba{flush(){return this._errorCode=0,!0}parse(t){return t?(this._errorCode=t.readInt(),!0):!1}get errorCode(){return this._errorCode}}Ba.ERROR_GENERIC=0;Ba.ERROR_GUIDES_REJECT=1;Ba.ERROR_NOT_ENOUGH_GUIDES=2;Ba.ERROR_NOT_ENOUGH_VOTES=3;Ba.ERROR_NO_CHATLOG_FOUND=4;class lG{flush(){return this._roomId=0,this._roomName=null,!0}parse(t){return t?(this._roomId=t.readInt(),this._roomName=t.readString(),!0):!1}get roomId(){return this._roomId}get roomName(){return this._roomName}}class _G{flush(){return this._chatMessage=null,this._senderId=0,!0}parse(t){return t?(this._chatMessage=t.readString(),this._senderId=t.readInt(),!0):!1}get chatMessage(){return this._chatMessage}get senderId(){return this._senderId}}class cG{flush(){return this._isTyping=!1,!0}parse(t){return t?(this._isTyping=t.readBoolean(),!0):!1}get isTyping(){return this._isTyping}}class dG{flush(){return this._requesterRoomId=0,!0}parse(t){return t?(this._requesterRoomId=t.readInt(),!0):!1}get requesterRoomId(){return this._requesterRoomId}}class fG{flush(){return this._requesterUserId=0,this._requesterName=null,this._requesterFigure=null,this._guideUserId=0,this._guideName=null,this._guideFigure=null,!0}parse(t){return t?(this._requesterUserId=t.readInt(),this._requesterName=t.readString(),this._requesterFigure=t.readString(),this._guideUserId=t.readInt(),this._guideName=t.readString(),this._guideFigure=t.readString(),!0):!1}get requesterUserId(){return this._requesterUserId}get requesterName(){return this._requesterName}get requesterFigure(){return this._requesterFigure}get guideUserId(){return this._guideUserId}get guideName(){return this._guideName}get guideFigure(){return this._guideFigure}}class Ah{flush(){return this._result=0,!0}parse(t){return t?(this._result=t.readInt(),!0):!1}get result(){return this._result}}Ah.CREATION_RESULT_OK=0;Ah.CREATION_RESULT_UNABLE_TO_REPORT=1;Ah.CREATION_RESULT_NO_CHATLOG_FOUND=2;Ah.CREATION_RESULT_BULLY_ALREADY_REPORTED=3;class Hl{flush(){return this._resolution=0,!0}parse(t){return t?(this._resolution=t.readInt(),!0):!1}get resolution(){return this._resolution}}Hl.RESOLUTION_GUARDIANS_TOOK_ACTION=0;Hl.RESOLUTION_FORWARDED_TO_MODERATORS=1;Hl.RESOLUTION_REPORTER_IS_ABUSIVE=2;class gG{flush(){return!0}parse(t){return!!t}}class EG{flush(){return this._closeReason=0,this._messageText="",!0}parse(t){return t?(this._closeReason=t.readInt(),this._messageText=t.readString(),!0):!1}get closeReason(){return this._closeReason}get messageText(){return this._messageText}}class pG{flush(){return this._quizCode=null,this._questionIds=[],!0}parse(t){if(!t)return!1;this._quizCode=t.readString();const e=t.readInt();this._questionIds=[];for(let i=0;i<e;i++)this._questionIds.push(t.readInt());return!0}get quizCode(){return this._quizCode}get questionIds(){return this._questionIds}}class mG{flush(){return this._quizCode=null,this._questionIdsForWrongAnswers=[],!0}parse(t){if(!t)return!1;this._quizCode=t.readString();const e=t.readInt();this._questionIdsForWrongAnswers=[];for(let i=0;i<e;i++)this._questionIdsForWrongAnswers.push(t.readInt());return!0}get quizCode(){return this._quizCode}get questionIdsForWrongAnswers(){return this._questionIdsForWrongAnswers}}class Vl{constructor(t){this._id=t.readInt(),this._title=t.readString(),this._bodyText=t.readString(),this._buttonText=t.readString(),this._linkType=t.readInt(),this._linkContent=t.readString(),this._imageUrl=t.readString()}get id(){return this._id}get title(){return this._title}get bodyText(){return this._bodyText}get buttonText(){return this._buttonText}get linkType(){return this._linkType}get linkContent(){return this._linkContent}get imageUrl(){return this._imageUrl}}Vl.LINK_TYPE_URL=0;Vl.LINK_TYPE_INTERNAL=1;Vl.LINK_TYPE_NO_LINK=2;class IG{flush(){return this._articles=[],!0}parse(t){if(!t)return!1;const e=t.readInt();for(let i=0;i<e;i++)this._articles.push(new Vl(t));return!0}get articles(){return this._articles}}class TG{flush(){return!0}parse(t){return t?(this._acknowledged=t.readBoolean(),!0):!1}get acknowledged(){return this._acknowledged}}class RG{flush(){return this._newOfferId=-1,this._newPrice=0,this._requestedOfferId=-1,!0}parse(t){return t?(this._result=t.readInt(),this._newOfferId=t.readInt(),this._newPrice=t.readInt(),this._requestedOfferId=t.readInt(),!0):!1}get result(){return this._result}get offerId(){return this._newOfferId}get newPrice(){return this._newPrice}get requestedOfferId(){return this._requestedOfferId}}class OG{flush(){return this._offerId=0,this._success=!1,!0}parse(t){return t?(this._offerId=t.readInt(),this._success=t.readBoolean(),!0):!1}get offerId(){return this._offerId}get success(){return this._success}}class AG{flush(){return this._tokenCount=0,this._result=0,!0}parse(t){return t?(this._result=t.readInt(),this._tokenCount=t.readInt(),!0):!1}get tokenCount(){return this._tokenCount}get resultCode(){return this._result}}class vG{flush(){return this._enabled=!1,this._commission=0,this._credits=0,this._advertisements=0,this._maximumPrice=0,this._minimumPrice=0,this._offerTime=0,this._displayTime=0,!0}parse(t){return t?(this._enabled=t.readBoolean(),this._commission=t.readInt(),this._credits=t.readInt(),this._advertisements=t.readInt(),this._minimumPrice=t.readInt(),this._maximumPrice=t.readInt(),this._offerTime=t.readInt(),this._displayTime=t.readInt(),!0):!1}get enabled(){return this._enabled}get commission(){return this._commission}get credits(){return this._credits}get advertisements(){return this._advertisements}get minimumPrice(){return this._minimumPrice}get maximumPrice(){return this._maximumPrice}get offerTime(){return this._offerTime}get displayTime(){return this._displayTime}}class SG{flush(){return this._result=0,!0}parse(t){return t?(this._result=t.readInt(),!0):!1}get result(){return this._result}}class yG{flush(){return this._averagePrice=0,this._currentOfferCount=0,this._historyLength=0,this._dayOffsets=[],this._averagePrices=[],this._soldAmounts=[],this._furniTypeId=0,this._furniCategoryId=0,!0}parse(t){if(!t)return!1;this._averagePrice=t.readInt(),this._currentOfferCount=t.readInt(),this._historyLength=t.readInt();let e=t.readInt();for(;e>0;)this._dayOffsets.push(t.readInt()),this._averagePrices.push(t.readInt()),this._soldAmounts.push(t.readInt()),e--;return this._furniCategoryId=t.readInt(),this._furniTypeId=t.readInt(),!0}get averagePrice(){return this._averagePrice}get offerCount(){return this._currentOfferCount}get historyLength(){return this._historyLength}get dayOffsets(){return this._dayOffsets}get averagePrices(){return this._averagePrices}get soldAmounts(){return this._soldAmounts}get furniTypeId(){return this._furniTypeId}get furniCategoryId(){return this._furniCategoryId}}class mT{constructor(t,e,i,r,n,a,o,h,u,c=-1){this._timeLeftMinutes=-1,this._offerId=t,this._furniId=e,this._furniType=i,this._extraData=r,this._stuffData=n,this._price=a,this._status=o,this._timeLeftMinutes=h,this._averagePrice=u,this._offerCount=c}get offerId(){return this._offerId}get furniId(){return this._furniId}get furniType(){return this._furniType}get extraData(){return this._extraData}get stuffData(){return this._stuffData}get price(){return this._price}get status(){return this._status}get timeLeftMinutes(){return this._timeLeftMinutes}get averagePrice(){return this._averagePrice}get offerCount(){return this._offerCount}get isUniqueLimitedItem(){return this.stuffData!=null&&this.stuffData.uniqueSeries>0}}const _o=class{constructor(){this.MAX_LIST_LENGTH=500}flush(){return this._offers=[],this._totalItemsFound=0,!0}parse(s){if(!s)return!1;const t=s.readInt();let e=0;for(;e<t;){const i=s.readInt(),r=s.readInt();let n=s.readInt(),a=-1,o="",h=null;n===_o.FURNITYPE_STUFF?(a=s.readInt(),h=Vr.parseObjectData(s)):n===_o.FURNITYPE_WALL?(a=s.readInt(),o=s.readString()):n==_o.FAKE_FURNITYPE_UNIQUE&&(a=s.readInt(),h=vr.getData(_s.FORMAT_KEY),h.uniqueNumber=s.readInt(),h.uniqueSeries=s.readInt(),n=_o.FURNITYPE_STUFF);const u=s.readInt(),c=s.readInt(),l=s.readInt(),_=s.readInt(),d=new mT(i,a,n,o,h,u,r,c,l,_);e<this.MAX_LIST_LENGTH&&this._offers.push(d),e++}return this._totalItemsFound=s.readInt(),!0}get offers(){return this._offers}get totalItemsFound(){return this._totalItemsFound}};let kl=_o;kl.FURNITYPE_STUFF=1;kl.FURNITYPE_WALL=2;kl.FAKE_FURNITYPE_UNIQUE=3;const IT=class{flush(){return this._offers=[],!0}parse(s){if(!s)return!1;this._offers=[],this._creditsWaiting=s.readInt();const t=s.readInt();for(let e=0;e<t;e++){const i=s.readInt(),r=s.readInt();let n=s.readInt(),a,o,h;n==1?(a=s.readInt(),h=this.getStuffData(s)):n==2?(a=s.readInt(),o=s.readString()):n==3&&(a=s.readInt(),h=vr.getData(_s.FORMAT_KEY),h.uniqueNumber=s.readInt(),h.uniqueSeries=s.readInt(),n=1);const u=s.readInt(),c=s.readInt(),l=s.readInt(),_=new mT(i,a,n,o,h,u,r,c,l);e<IT.MAX_LIST_LENGTH&&this._offers.push(_)}return!0}get offers(){return this._offers}get creditsWaiting(){return this._creditsWaiting}getStuffData(s){const t=s.readInt(),e=vr.getData(t);return e.parseWrapper(s),e}};let TT=IT;TT.MAX_LIST_LENGTH=500;class CG{constructor(t,e,i,r,n){this._timestamp=t,this._habboId=e,this._username=i,this._message=r,this._hasHighlighting=n}get timestamp(){return this._timestamp}get userId(){return this._habboId}get userName(){return this._username}get message(){return this._message}get hasHighlighting(){return this._hasHighlighting}}class Ii{constructor(t){this._context=new Map,this._chatlog=[],this._recordType=t.readByte();const e=t.readShort();for(let r=0;r<e;r++){const n=t.readString(),a=t.readByte();switch(a){case 0:this._context.set(n,t.readBoolean());break;case 1:this._context.set(n,t.readInt());break;case 2:this._context.set(n,t.readString());break;default:throw new Error("Unknown data type "+a)}}const i=t.readShort();for(let r=0;r<i;r++){const n=t.readString(),a=t.readInt(),o=t.readString(),h=t.readString(),u=t.readBoolean();this._chatlog.push(new CG(n,a,o,h,u))}}get recordType(){return this._recordType}get context(){return this._context}get chatlog(){return this._chatlog}get roomId(){return this.getInt("roomId")}get roomName(){return this._context.get("roomName")}get groupId(){return this.getInt("groupId")}get threadId(){return this.getInt("threadId")}get messageId(){return this.getInt("messageId")}getInt(t){const e=this._context.get(t);return e||0}}Ii.TYPE_SIMPLE=0;Ii.TYPE_ROOM_CHAT=1;Ii.TYPE_IM_SESSION=2;Ii.TYPE_DISCUSSION_THREAD=3;Ii.TYPE_DISCUSSION_MESSAGE=4;Ii.TYPE_SELFIE=5;Ii.TYPE_PHOTO=6;class MG{constructor(t){this._issueId=t.readInt(),this._callerUserId=t.readInt(),this._reportedUserId=t.readInt(),this._chatRecordId=t.readInt(),this._chatRecord=new Ii(t)}get issueId(){return this._issueId}get callerUserId(){return this._callerUserId}get reportedUserId(){return this._reportedUserId}get chatRecordId(){return this._chatRecordId}get chatRecord(){return this._chatRecord}}class NG{flush(){return this._data=null,!0}parse(t){return t?(this._data=new MG(t),!0):!1}get data(){return this._data}}class PG{flush(){return!0}parse(t){return this._issueId=parseInt(t.readString()),!0}get issueId(){return this._issueId}}class vh{constructor(t,e,i,r,n,a,o,h,u,c,l,_,d,g,m,p){this._disposed=!1,this._issueId=t,this._state=e,this._categoryId=i,this._reportedCategoryId=r,this._issueAgeInMilliseconds=n,this._priority=a,this._groupingId=o,this._reporterUserId=h,this._reporterUserName=u,this._reportedUserId=c,this._reportedUserName=l,this._pickerUserId=_,this._pickerUserName=d,this._message=g,this._chatRecordId=m,this._patterns=p,this._creationTimeInMilliseconds=_t()}get issueId(){return this._issueId}get state(){return this._state}get categoryId(){return this._categoryId}get reportedCategoryId(){return this._reportedCategoryId}get issueAgeInMilliseconds(){return this._issueAgeInMilliseconds}get priority(){return this._priority}get groupingId(){return this._groupingId}get reporterUserId(){return this._reporterUserId}get reporterUserName(){return this._reporterUserName}get reportedUserId(){return this._reportedUserId}get reportedUserName(){return this._reportedUserName}get pickerUserId(){return this._pickerUserId}get pickerUserName(){return this._pickerUserName}get message(){return this._message}get chatRecordId(){return this._chatRecordId}get patterns(){return this._patterns}dispose(){if(!this.disposed){for(const t of this._patterns)t.dispose();this._patterns=[],this._disposed=!0}}get disposed(){return this._disposed}getOpenTime(t){const i=(this._issueAgeInMilliseconds+t-this._creationTimeInMilliseconds)/1e3/60,r=i%60,n=i/60,a=(r<10?"0":"")+r;return(n<10?"0":"")+n+":"+a}}vh.STATE_OPEN=1;vh.STATE_PICKED=2;vh.STATE_CLOSED=3;class bG{constructor(t){this._disposed=!1,this._pattern=t.readString(),this._startIndex=t.readInt(),this._endIndex=t.readInt()}dispose(){this._disposed=!0,this._pattern="",this._startIndex=-1,this._endIndex=-1}get disposed(){return this._disposed}get pattern(){return this._pattern}get startIndex(){return this._startIndex}get endIndex(){return this._endIndex}}class RT{get issueData(){return this._issueData}flush(){return this._issueData=null,!0}parse(t){const e=t.readInt(),i=t.readInt(),r=t.readInt(),n=t.readInt(),a=t.readInt(),o=t.readInt(),h=t.readInt(),u=t.readInt(),c=t.readString(),l=t.readInt(),_=t.readString(),d=t.readInt(),g=t.readString(),m=t.readString(),p=t.readInt(),T=t.readInt(),A=[];for(let O=0;O<T;O++)A.push(new bG(t));return this._issueData=new vh(e,i,r,n,a,o,h,u,c,l,_,d,g,m,p,A),!0}}class DG{flush(){return this._issues=null,!0}parse(t){this._issues=[];const e=t.readInt();for(let i=0;i<e;i++){const r=t.readInt(),n=t.readInt(),a=t.readString(),o=new vh(r,0,0,0,0,0,0,0,null,0,null,n,a,null,0,[]);this._issues.push(o)}return this._retryEnabled=t.readBoolean(),this._retryCount=t.readInt(),!0}get issues(){return this._issues}get retryEnabled(){return this._retryEnabled}get retryCount(){return this._retryCount}}class LG{flush(){return this._message="",this._url=null,!0}parse(t){return t?(this._message=t.readString(),this._url=t.readString(),!0):!1}get message(){return this._message}get url(){return this._url}}class UG{flush(){return this._userId=-1,this._success=!1,!0}parse(t){return this._userId=t.readInt(),this._success=t.readBoolean(),!0}get userId(){return this._userId}get success(){return this._success}}class xG{constructor(t){this._disposed=!1;const e=new RT;this._issues=[],this._messageTemplates=[],this._roomMessageTemplates=[];let i=t.readInt(),r=0;for(;r<i;)e.parse(t)&&this._issues.push(e.issueData),r++;for(i=t.readInt(),r=0;r<i;)this._messageTemplates.push(t.readString()),r++;for(i=t.readInt(),r=0;r<i;)t.readString(),r++;for(this._cfhPermission=t.readBoolean(),this._chatlogsPermission=t.readBoolean(),this._alertPermission=t.readBoolean(),this._kickPermission=t.readBoolean(),this._banPermission=t.readBoolean(),this._roomAlertPermission=t.readBoolean(),this._roomKickPermission=t.readBoolean(),i=t.readInt(),r=0;r<i;)this._roomMessageTemplates.push(t.readString()),r++}dispose(){this._disposed||(this._disposed=!0,this._messageTemplates=null,this._roomMessageTemplates=null,this._issues=null)}get disposed(){return this._disposed}get messageTemplates(){return this._messageTemplates}get roomMessageTemplates(){return this._roomMessageTemplates}get issues(){return this._issues}get cfhPermission(){return this._cfhPermission}get chatlogsPermission(){return this._chatlogsPermission}get alertPermission(){return this._alertPermission}get kickPermission(){return this._kickPermission}get banPermission(){return this._banPermission}get roomAlertPermission(){return this._roomAlertPermission}get roomKickPermission(){return this._roomKickPermission}}class FG{constructor(){this._data=null}flush(){return this._data=null,!0}parse(t){return this._data=new xG(t),!0}get data(){return this._data}}class wG{flush(){return this._message="",this._url="",!0}parse(t){return t?(this._message=t.readString(),this._url=t.readString(),!0):!1}get message(){return this._message}get url(){return this._url}}class GG{constructor(t){if(this._tags=[],this._exists=t.readBoolean(),!this.exists)return;this._name=t.readString(),this._desc=t.readString();const e=t.readInt();for(let i=0;i<e;i++)this._tags.push(t.readString())}get name(){return this._name}get desc(){return this._desc}get tags(){return this._tags}get exists(){return this._exists}get disposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this._tags=null)}}class BG{constructor(t){this._flatId=t.readInt(),this._userCount=t.readInt(),this._ownerInRoom=t.readBoolean(),this._ownerId=t.readInt(),this._ownerName=t.readString(),this._room=new GG(t)}get flatId(){return this._flatId}get userCount(){return this._userCount}get ownerInRoom(){return this._ownerInRoom}get ownerId(){return this._ownerId}get ownerName(){return this._ownerName}get room(){return this._room}get disposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this._room!=null&&(this._room.dispose(),this._room=null))}}class HG{flush(){return this._data=null,!0}parse(t){return t?(this._data=new BG(t),!0):!1}get data(){return this._data}}class VG{flush(){return this._windowX=0,this._windowY=0,this._windowWidth=0,this._windowHeight=0,!0}parse(t){return this._windowX=t.readInt(),this._windowY=t.readInt(),this._windowWidth=t.readInt(),this._windowHeight=t.readInt(),!0}get windowX(){return this._windowX}get windowY(){return this._windowY}get windowWidth(){return this._windowWidth}get windowHeight(){return this._windowHeight}}class kG{constructor(t){this._lastSanctionTime="",this._sanctionAgeHours=0,this._userId=t.readInt(),this._userName=t.readString(),this._figure=t.readString(),this._registrationAgeInMinutes=t.readInt(),this._minutesSinceLastLogin=t.readInt(),this._online=t.readBoolean(),this._cfhCount=t.readInt(),this._abusiveCfhCount=t.readInt(),this._cautionCount=t.readInt(),this._banCount=t.readInt(),this._tradingLockCount=t.readInt(),this._tradingExpiryDate=t.readString(),this._lastPurchaseDate=t.readString(),this._identityId=t.readInt(),this._identityRelatedBanCount=t.readInt(),this._primaryEmailAddress=t.readString(),this._userClassification=t.readString(),t.bytesAvailable&&(this._lastSanctionTime=t.readString(),this._sanctionAgeHours=t.readInt())}get userId(){return this._userId}get userName(){return this._userName}get figure(){return this._figure}get registrationAgeInMinutes(){return this._registrationAgeInMinutes}get minutesSinceLastLogin(){return this._minutesSinceLastLogin}get online(){return this._online}get cfhCount(){return this._cfhCount}get abusiveCfhCount(){return this._abusiveCfhCount}get cautionCount(){return this._cautionCount}get banCount(){return this._banCount}get tradingLockCount(){return this._tradingLockCount}get tradingExpiryDate(){return this._tradingExpiryDate}get lastPurchaseDate(){return this._lastPurchaseDate}get identityId(){return this._identityId}get identityRelatedBanCount(){return this._identityRelatedBanCount}get primaryEmailAddress(){return this._primaryEmailAddress}get userClassification(){return this._userClassification}get lastSanctionTime(){return this._lastSanctionTime}get sanctionAgeHours(){return this._sanctionAgeHours}}class jG{flush(){return this._data=null,!0}parse(t){return t?(this._data=new kG(t),!0):!1}get data(){return this._data}}class zG{flush(){return this._data=null,!0}parse(t){return t?(this._data=new Ii(t),!0):!1}get data(){return this._data}}class YG{constructor(t){this._roomId=t.readInt(),this._roomName=t.readString(),this._enterHour=t.readInt(),this._enterMinute=t.readInt()}get roomId(){return this._roomId}get roomName(){return this._roomName}get enterHour(){return this._enterHour}get enterMinute(){return this._enterMinute}}class WG{constructor(t){this._rooms=[],this._userId=t.readInt(),this._userName=t.readString();const e=t.readInt();let i=0;for(;i<e;)this._rooms.push(new YG(t)),i++}get userId(){return this._userId}get userName(){return this._userName}get rooms(){return this._rooms}}class XG{flush(){return!0}parse(t){return this._data=new WG(t),!0}get data(){return this._data}}class KG{flush(){return this._message="",!0}parse(t){return t?(this._message=t.readString(),!0):!1}get message(){return this._message}}class qG{constructor(t){this._roomChatlogs=[],this._userId=t.readInt(),this._username=t.readString();const e=t.readInt();for(let i=0;i<e;i++)this._roomChatlogs.push(new Ii(t))}get userId(){return this._userId}get username(){return this._username}get roomChatlogs(){return this._roomChatlogs}}class ZG{flush(){return this._data=null,!0}parse(t){return t?(this._data=new qG(t),!0):!1}get data(){return this._data}}class QG{flush(){return!0}parse(t){return!!t}}class JG{flush(){return!0}parse(t){return t?(this._contentType=t.readString(),this._classId=t.readInt(),!0):!1}get contentType(){return this._contentType}get classId(){return this._classId}}class $G{flush(){return this._boxColor=null,this._keyColor=null,!0}parse(t){return t?(this._boxColor=t.readString(),this._keyColor=t.readString(),!0):!1}get boxColor(){return this._boxColor}get keyColor(){return this._keyColor}}class tB{flush(){return!0}parse(t){return!!t}}class eB{flush(){return this._canCreate=!1,this._errorCode=0,!0}parse(t){return t?(this._canCreate=t.readBoolean(),this._errorCode=t.readInt(),!0):!1}get canCreate(){return this._canCreate}get errorCode(){return this._errorCode}}class zf{flush(){return!0}parse(t){return t?(this._resultCode=t.readInt(),this._roomLimit=t.readInt(),!0):!1}get resultCode(){return this._resultCode}get roomLimit(){return this._roomLimit}}zf.CREATION_ALLOWED=0;zf.ROOM_LIMIT_REACHED=1;class sB{constructor(t){this._categoryToCurrentUserCountMap=new Map,this._categoryToMaxUserCountMap=new Map;const e=t.readInt();for(let i=0;i<e;i++){const r=t.readInt(),n=t.readInt(),a=t.readInt();this._categoryToCurrentUserCountMap.set(r,n),this._categoryToMaxUserCountMap.set(r,a)}}get categoryToCurrentUserCountMap(){return this._categoryToCurrentUserCountMap}get categoryToMaxUserCountMap(){return this._categoryToMaxUserCountMap}}class iB{constructor(t,e=0,i=0){this._goalId=e,this._pageIndex=i,t&&(this._goalId=t.readInt(),this._pageIndex=t.readInt(),this._pageCount=t.readInt())}get goalId(){return this._goalId}get pageIndex(){return this._pageIndex}get pageCount(){return this._pageCount}}const co=class{constructor(s){this._index=s.readInt(),this._popupCaption=s.readString(),this._popupDesc=s.readString(),this._showDetails=s.readInt()==1,this._picText=s.readString(),this._picRef=s.readString(),this._folderId=s.readInt(),this._userCount=s.readInt(),this._type=s.readInt(),this._type==co.TYPE_TAG?this._tag=s.readString():this._type==co.TYPE_GUEST_ROOM?this._guestRoomData=new is(s):this._open=s.readBoolean()}dispose(){this._disposed||(this._disposed=!0,this._guestRoomData!=null&&(this._guestRoomData.flush(),this._guestRoomData=null))}get disposed(){return this._disposed}get type(){return this._type}get index(){return this._index}get popupCaption(){return this._popupCaption}get popupDesc(){return this._popupDesc}get showDetails(){return this._showDetails}get picText(){return this._picText}get picRef(){return this._picRef}get folderId(){return this._folderId}get tag(){return this._tag}get userCount(){return this._userCount}get guestRoomData(){return this._guestRoomData}get open(){return this._open}toggleOpen(){this._open=!this._open}get maxUsers(){return this.type==co.TYPE_TAG?0:this.type==co.TYPE_GUEST_ROOM?this._guestRoomData.maxUserCount:0}};let jl=co;jl.TYPE_TAG=1;jl.TYPE_GUEST_ROOM=2;jl.TYPE_FOLDER=4;class rB{constructor(t){this._rooms=[],this._searchType=t.readInt(),this._searchParam=t.readString();const e=t.readInt();for(let r=0;r<e;r++)this._rooms.push(new is(t));t.readBoolean()&&(this._ad=new jl(t))}dispose(){if(!this._disposed){if(this._disposed=!0,this._rooms!=null)for(const t of this._rooms)t.flush();this._ad!=null&&(this._ad.dispose(),this._ad=null),this._rooms=null}}get disposed(){return this._disposed}get searchType(){return this._searchType}get searchParam(){return this._searchParam}get rooms(){return this._rooms}get ad(){return this._ad}}class OT{constructor(t){if(!t)throw new Error("invalid_wrapper");this.flush(),this.parse(t)}flush(){return this._id=-1,this._code=null,this._filter=null,this._localization=null,!0}parse(t){return t?(this._id=t.readInt(),this._code=t.readString(),this._filter=t.readString(),this._localization=t.readString(),!0):!1}get id(){return this._id}get code(){return this._code}get filter(){return this._filter}get localization(){return this._localization}}class nB{constructor(t){if(!t)throw new Error("invalid_wrapper");this.flush(),this.parse(t)}flush(){return this._code=null,this._data=null,this._action=-1,this._closed=!1,this._mode=-1,this._rooms=[],!0}parse(t){if(!t)return!1;this._code=t.readString(),this._data=t.readString(),this._action=t.readInt(),this._closed=t.readBoolean(),this._mode=t.readInt();let e=t.readInt();for(;e>0;)this._rooms.push(new is(t)),e--;return!0}get code(){return this._code}get data(){return this._data}get action(){return this._action}get closed(){return this._closed}get mode(){return this._mode}get rooms(){return this._rooms}}class aB{constructor(t){if(!t)throw new Error("invalid_wrapper");this.flush(),this.parse(t)}flush(){return this._code=null,this._data=null,this._results=[],!0}parse(t){if(!t)return!1;this._code=t.readString(),this._data=t.readString();let e=t.readInt();for(;e>0;)this._results.push(new nB(t)),e--;return!0}get code(){return this._code}get data(){return this._data}get results(){return this._results}}class oB{constructor(t){if(!t)throw new Error("invalid_wrapper");this.flush(),this.parse(t)}flush(){return this._code=null,this._savedSearches=[],!0}parse(t){if(!t)return!1;this._code=t.readString();let e=t.readInt();for(;e>0;)this._savedSearches.push(new OT(t)),e--;return!0}get code(){return this._code}get savedSearches(){return this._savedSearches}}class hB{constructor(t){this._adId=t.readInt(),this._ownerAvatarId=t.readInt(),this._ownerAvatarName=t.readString(),this._flatId=t.readInt(),this._eventType=t.readInt(),this._eventName=t.readString(),this._eventDescription=t.readString();const e=t.readInt(),i=t.readInt(),r=new Date;let n=r.getTime();const a=e*60*1e3;n=n-a;const o=new Date(n);this._creationTime=o.getDate()+"-"+o.getMonth()+"-"+o.getFullYear()+" "+o.getHours()+":"+o.getMinutes();let h=r.getTime();const u=i*60*1e3;h=h+u,this._expirationDate=new Date(h),this._categoryId=t.readInt()}dispose(){this._disposed||(this._disposed=!0)}get disposed(){return this._disposed}get adId(){return this._adId}get ownerAvatarId(){return this._ownerAvatarId}get ownerAvatarName(){return this._ownerAvatarName}get flatId(){return this._flatId}get categoryId(){return this._categoryId}get eventType(){return this._eventType}get eventName(){return this._eventName}get eventDescription(){return this._eventDescription}get creationTime(){return this._creationTime}get expirationDate(){return this._expirationDate}}class uB{flush(){return!0}parse(t){return t?(this._data=new sB(t),!0):!1}get data(){return this._data}}class lB{flush(){return!0}parse(t){return t?(this._data=new iB(t),!0):!1}get data(){return this._data}}class _B{flush(){return!0}parse(t){return t?(this._globalId=t.readString(),this._convertedId=t.readInt(),!0):!1}get globalId(){return this._globalId}get convertedId(){return this._convertedId}}class cB{flush(){return this._userName=null,!0}parse(t){return t?(this._userName=t.readString(),!0):!1}get userName(){return this._userName}}class dB{flush(){return!0}parse(t){return t?(this._flatId=t.readInt(),this._added=t.readBoolean(),!0):!1}get flatId(){return this._flatId}get added(){return this._added}}class fB{flush(){return!0}parse(t){if(!t)return!1;this._favouriteRoomIds=[],this._limit=t.readInt();const e=t.readInt();for(let i=0;i<e;i++)this._favouriteRoomIds.push(t.readInt());return!0}get limit(){return this._limit}get favoriteRoomIds(){return this._favouriteRoomIds}}class gB{flush(){return this._userName=null,!0}parse(t){return t?(this._userName=t.readString(),!0):!1}get userName(){return this._userName}}class EB{flush(){return this._roomId=-1,this._roomName=null,!0}parse(t){return t?(this._roomId=t.readInt(),this._roomName=t.readString(),!0):!1}get roomId(){return this._roomId}get roomName(){return this._roomName}}class pB{flush(){return this._roomEnter=!1,this._roomForward=!1,this._data=null,this._staffPick=!1,this._isGroupMember=!1,this._moderation=null,this._chat=null,!0}parse(t){return t?(this._roomEnter=t.readBoolean(),this._data=new is(t),this._roomForward=t.readBoolean(),this._staffPick=t.readBoolean(),this._isGroupMember=t.readBoolean(),this.data.allInRoomMuted=t.readBoolean(),this._moderation=new ph(t),this.data.canMute=t.readBoolean(),this._chat=new ds(t),!0):!1}get roomEnter(){return this._roomEnter}get roomForward(){return this._roomForward}get data(){return this._data}get staffPick(){return this._staffPick}get isGroupMember(){return this._isGroupMember}get moderation(){return this._moderation}get chat(){return this._chat}}class mB{flush(){return!0}parse(t){return t?(this._data=new rB(t),!0):!1}get data(){return this._data}}class IB{constructor(t){if(!t)throw new Error("invalid_wrapper");this.flush(),this.parse(t)}flush(){return this._id=-1,this._name=null,this._visible=!1,this._automatic=!1,this._automaticCategoryKey=null,this._globalCategoryKey=null,this._staffOnly=!1,!0}parse(t){return t?(this._id=t.readInt(),this._name=t.readString(),this._visible=t.readBoolean(),this._automatic=t.readBoolean(),this._automaticCategoryKey=t.readString(),this._globalCategoryKey=t.readString(),this._staffOnly=t.readBoolean(),!0):!1}get id(){return this._id}get name(){return this._name}get visible(){return this._visible}get automatic(){return this._automatic}get automaticCategoryKey(){return this._automaticCategoryKey}get globalCategoryKey(){return this._globalCategoryKey}get staffOnly(){return this._staffOnly}}class TB{flush(){return this._categories=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._categories.push(t.readString()),e--;return!0}get categories(){return this._categories}}class RB{constructor(t){if(!t)throw new Error("invalid_wrapper");this.flush(),this.parse(t)}flush(){return this._id=-1,this._name=null,this._visible=!1,!0}parse(t){return t?(this._id=t.readInt(),this._name=t.readString(),this._visible=t.readBoolean(),!0):!1}get id(){return this._id}get name(){return this._name}get visible(){return this._visible}}class OB{flush(){return this._homeRoomId=-1,this._roomIdToEnter=-1,!0}parse(t){return t?(this._homeRoomId=t.readInt(),this._roomIdToEnter=t.readInt(),!0):!1}get homeRoomId(){return this._homeRoomId}get roomIdToEnter(){return this._roomIdToEnter}}class AB{constructor(t){if(!t)throw new Error("invalid_wrapper");this.flush(),this.parse(t)}flush(){return this._roomId=-1,this._areaId=-1,this._image=null,this._caption=null,!0}parse(t){return t?(this._roomId=t.readInt(),this._areaId=t.readInt(),this._image=t.readString(),this._caption=t.readString(),!0):!1}get roomId(){return this._roomId}get areaId(){return this._areaId}get image(){return this._image}get caption(){return this._caption}}class vB{flush(){return this._rooms=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._rooms.push(new AB(t)),e--;return!0}get rooms(){return this._rooms}}class SB{flush(){return this._topLevelContexts=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._topLevelContexts.push(new oB(t)),e--;return!0}get topLevelContexts(){return this._topLevelContexts}}class yB{flush(){return!0}parse(t){return!!t}}class CB{flush(){return this._searches=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._searches.push(new OT(t)),e--;return!0}get searches(){return this._searches}}class MB{flush(){return this._result=null,!0}parse(t){return t?(this._result=new aB(t),!0):!1}get result(){return this._result}}class NB{flush(){return this._windowX=0,this._windowY=0,this._windowWidth=0,this._windowHeight=0,this._leftPanelHidden=!1,this._resultsMode=0,!0}parse(t){return t?(this._windowX=t.readInt(),this._windowY=t.readInt(),this._windowWidth=t.readInt(),this._windowHeight=t.readInt(),this._leftPanelHidden=t.readBoolean(),this._resultsMode=t.readInt(),!0):!1}get windowX(){return this._windowX}get windowY(){return this._windowY}get windowWidth(){return this._windowWidth}get windowHeight(){return this._windowHeight}get leftPanelHidden(){return this._leftPanelHidden}get resultsMode(){return this._resultsMode}}class PB{constructor(t){this._tagName=t.readString(),this._userCount=t.readInt()}get tagName(){return this._tagName}get userCount(){return this._userCount}}class bB{constructor(t){if(!t)throw new Error("invalid_wrapper");this.flush(),this.parse(t)}flush(){return this._tags=[],!0}parse(t){if(!t)return!1;this._tags=[];const e=t.readInt();let i=0;for(;i<e;)this._tags.push(new PB(t)),i++;return!0}get tags(){return this._tags}}class DB{flush(){return this._data=null,!0}parse(t){return t?(this._data=new bB(t),!0):!1}get data(){return this._data}}class LB{flush(){return!0}parse(t){return!0}}class UB{flush(){return!0}parse(t){return this._data=new hB(t),!0}get data(){return this._data}}class xB{flush(){return this._words=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._words.push(t.readString()),e--;return!0}get words(){return this._words}}class FB{flush(){return this._roomId=0,!0}parse(t){return t?(this._roomId=t.readInt(),!0):!1}get roomId(){return this._roomId}}class wB{flush(){return!0}parse(t){return this._flatId=t.readInt(),this._resultCode=t.readInt(),!0}get flatId(){return this._flatId}get resultCode(){return this._resultCode}}class GB{flush(){return this._categories=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._categories.push(new RB(t)),e--;return!0}get categories(){return this._categories}}class BB{flush(){return this._categories=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._categories.push(new IB(t)),e--;return!0}get categories(){return this._categories}}class HB{constructor(t){this._badgeCode="",this._removedBadgeCode="",this._type=t.readInt(),this._level=t.readInt(),this._badgeId=t.readInt(),this._badgeCode=t.readString(),this._points=t.readInt(),this._levelRewardPoints=t.readInt(),this._levelRewardPointType=t.readInt(),this._bonusPoints=t.readInt(),this._achievementID=t.readInt(),this._removedBadgeCode=t.readString(),this._category=t.readString(),this._showDialogToUser=t.readBoolean()}get type(){return this._type}get level(){return this._level}get points(){return this._points}get levelRewardPoints(){return this._levelRewardPoints}get levelRewardPointType(){return this._levelRewardPointType}get bonusPoints(){return this._bonusPoints}get badgeId(){return this._badgeId}get badgeCode(){return this._badgeCode}get removedBadgeCode(){return this._removedBadgeCode}get achievementID(){return this._achievementID}get category(){return this._category}get showDialogToUser(){return this._showDialogToUser}}class VB{flush(){return this._data=null,!0}parse(t){return t?(this._data=new HB(t),!0):!1}get data(){return this._data}}class kB{flush(){return this._amount=0,this._amountChanged=0,this._type=-1,!0}parse(t){return t?(this._amount=t.readInt(),this._amountChanged=t.readInt(),this._type=t.readInt(),!0):!1}get amount(){return this._amount}get amountChanged(){return this._amountChanged}get type(){return this._type}}class jB{flush(){return this._errorCode=-1,!0}parse(t){return t?(this._errorCode=t.readInt(),!0):!1}get errorCode(){return this._errorCode}}class zB{flush(){return this._numGifts=0,!0}parse(t){return t?(this._numGifts=t.readInt(),!0):!1}get numGifts(){return this._numGifts}}class YB{flush(){return this._errorCode=0,this._messageId=0,this._timestamp=null,!0}parse(t){return t?(this._messageId=t.readInt(),this._errorCode=t.readInt(),this._timestamp=t.readString(),!0):!1}get errorCode(){return this._errorCode}get messageId(){return this._messageId}get timestamp(){return this._timestamp}}class WB{flush(){return this._key=null,!0}parse(t){return t?(this._key=t.readString(),!0):!1}get key(){return this._key}}class XB{flush(){return this._message=null,!0}parse(t){return t?(this._message=t.readString(),!0):!1}get message(){return this._message}}class KB{flush(){return this._enabled=!1,!0}parse(t){return t?(this._enabled=t.readBoolean(),!0):!1}get enabled(){return this._enabled}}class qB{flush(){return this._messages=[],!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;)this._messages.push(t.readString()),e--;return!0}get messages(){return this._messages}}class ZB{flush(){return this._type=null,this._parameters=new Map,!0}parse(t){if(!t)return!1;this._type=t.readString();let e=t.readInt();for(;e>0;)this._parameters.set(t.readString(),t.readString()),e--;return!0}get type(){return this._type}get parameters(){return this._parameters}}class QB{flush(){return this._contentType=null,this._classId=0,this._name=null,this._description=null,!0}parse(t){return t?(this._contentType=t.readString(),this._classId=t.readInt(),this._name=t.readString(),this._description=t.readString(),!0):!1}get contentType(){return this._contentType}get classId(){return this._classId}get name(){return this._name}get description(){return this._description}}class JB{flush(){return this._petId=-1,this._petName=null,this._level=0,this._figureData=null,!0}parse(t){return t?(this._petId=t.readInt(),this._petName=t.readString(),this._level=t.readInt(),this._figureData=new Bf(t),!0):!1}get petId(){return this._petId}get petName(){return this._petName}get level(){return this._level}get figureData(){return this._figureData}}class $B{flush(){return this._errorCode=-1,!0}parse(t){return t?(this._errorCode=t.readInt(),!0):!1}get errorCode(){return this._errorCode}}class t2{flush(){return!0}parse(t){return!0}}class e2{flush(){return this._alertMessage=null,!0}parse(t){return t?(this._alertMessage=t.readString(),t.bytesAvailable&&(this._titleMessage=t.readString()),!0):!1}get alertMessage(){return this._alertMessage}get titleMessage(){return this._titleMessage}}class s2{flush(){return this._items=new Ee,!0}parse(t){if(!t)return!1;let e=t.readInt();for(;e>0;){const i=t.readInt();let r=t.readInt();const n=[];for(;r>0;)n.push(t.readInt()),r--;this._items.add(i,n),e--}return!0}getItemsByCategory(t){return this._items.getValue(t)}get categories(){return this._items.getKeys()}}class i2{constructor(t,e,i){this._code=t,this._errorMessage=e,this._isAllowed=i}get code(){return this._code}get errorMessage(){return this._errorMessage}get isAllowed(){return this._isAllowed}}class Ds{}Ds.USE_GUIDE_TOOL="USE_GUIDE_TOOL";Ds.GIVE_GUIDE_TOUR="GIVE_GUIDE_TOUR";Ds.JUDGE_CHAT_REVIEWS="JUDGE_CHAT_REVIEWS";Ds.VOTE_IN_COMPETITIONS="VOTE_IN_COMPETITIONS";Ds.CALL_ON_HELPERS="CALL_ON_HELPERS";Ds.CITIZEN="CITIZEN";Ds.TRADE="TRADE";Ds.HEIGHTMAP_EDITOR_BETA="HEIGHTMAP_EDITOR_BETA";Ds.BUILDER_AT_WORK="BUILDER_AT_WORK";Ds.NAVIGATOR_ROOM_THUMBNAIL_CAMERA="NAVIGATOR_ROOM_THUMBNAIL_CAMERA";Ds.CAMERA="CAMERA";Ds.MOUSE_ZOOM="MOUSE_ZOOM";class r2{flush(){return this._perks=[],!0}parse(t){if(!t)return!1;this._perks=[];const e=t.readInt();for(let i=0;i<e;i++)this._perks.push(new i2(t.readString(),t.readString(),t.readBoolean()));return!0}isAllowed(t){let e=!1;for(const i of this._perks)if(i.code===t){e=i.isAllowed;break}return e}get perks(){return this._perks}}class n2{flush(){return this._objectId=-1,this._figureData=null,!0}parse(t){return this._objectId=t.readInt(),t.bytesAvailable&&(this._figureData=new gl(t.readString())),!0}get objectId(){return this._objectId}get figureData(){return this._figureData}}class a2{flush(){return this._objectId=0,this._nameValidationStatus=0,this._nameValidationInfo=null,!0}parse(t){return this._objectId=t.readInt(),this._nameValidationStatus=t.readInt(),this._nameValidationInfo=t.readString(),!0}get objectId(){return this._objectId}get nameValidationStatus(){return this._nameValidationStatus}get nameValidationInfo(){return this._nameValidationInfo}}class o2{flush(){return this._roomIndex=-1,this._petId=-1,this._level=-1,!0}parse(t){return this._roomIndex=t.readInt(),this._petId=t.readInt(),this._level=t.readInt(),!0}get roomIndex(){return this._roomIndex}get petId(){return this._petId}get level(){return this._level}}class h2{flush(){return this._currentAge=-1,this._requiredAge=-1,!0}parse(t){return this._currentAge=t.readInt(),this._requiredAge=t.readInt(),!0}get currentAge(){return this._currentAge}get requiredAge(){return this._requiredAge}}class u2{flush(){return this._petId=-1,this._commands=[],this._enabledCommands=[],!0}parse(t){this._petId=t.readInt();let e=t.readInt();for(;e>0;)this._commands.push(t.readInt()),e--;let i=t.readInt();for(;i>0;)this._enabledCommands.push(t.readInt()),i--;return!0}get petId(){return this._petId}get commands(){return this._commands}get enabledCommands(){return this._enabledCommands}}class l2{constructor(t,e,i){this._value=t,this._choiceText=e,this._choiceType=i}get value(){return this._value}set value(t){this._value=t}get choiceText(){return this._choiceText}set choiceText(t){this._choiceText=t}get choiceType(){return this._choiceType}set choiceType(t){this._choiceType=t}}class _2{constructor(){this._children=[],this._questionChoices=[]}get questionId(){return this._questionId}set questionId(t){this._questionId=t}get questionType(){return this._questionType}set questionType(t){this._questionType=t}get sortOrder(){return this._sortOrder}set sortOrder(t){this._sortOrder=t}get questionText(){return this._questionText}set questionText(t){this._questionText=t}get questionCategory(){return this._questionCategory}set questionCategory(t){this._questionCategory=t}get questionAnswerType(){return this._questionAnswerType}set questionAnswerType(t){this._questionAnswerType=t}get questionAnswerCount(){return this._questionAnswerCount}set questionAnswerCount(t){this._questionAnswerCount=t}get children(){return this._children}set children(t){this._children=t}get questionChoices(){return this._questionChoices}set questionChoices(t){this._questionChoices=t}}class c2{constructor(){this._id=-1,this._startMessage="",this._endMessage="",this._numQuestions=0,this._questionArray=[],this._npsPoll=!1}flush(){return this._id=-1,this._startMessage="",this._endMessage="",this._numQuestions=0,this._questionArray=[],!0}parse(t){this._id=t.readInt(),this._startMessage=t.readString(),this._endMessage=t.readString(),this._numQuestions=t.readInt();for(let e=0;e<this._numQuestions;e++){const i=this.parsePollQuestion(t),r=t.readInt();for(let n=0;n<r;n++)i.children.push(this.parsePollQuestion(t));this._questionArray.push(i)}return this._npsPoll=t.readBoolean(),!0}parsePollQuestion(t){const e=new _2;if(e.questionId=t.readInt(),e.sortOrder=t.readInt(),e.questionType=t.readInt(),e.questionText=t.readString(),e.questionCategory=t.readInt(),e.questionAnswerType=t.readInt(),e.questionAnswerCount=t.readInt(),e.questionType==1||e.questionType==2)for(let i=0;i<e.questionAnswerCount;i++)e.questionChoices.push(new l2(t.readString(),t.readString(),t.readInt()));return e}get id(){return this._id}get startMessage(){return this._startMessage}get endMessage(){return this._endMessage}get numQuestions(){return this._numQuestions}get questionArray(){return this._questionArray}get npsPoll(){return this._npsPoll}}class d2{flush(){throw!0}parse(t){return!0}}class f2{constructor(){this._id=-1,this._type="",this._headline="",this._summary=""}flush(){return this._id=-1,this._type="",this._summary="",!0}parse(t){return this._id=t.readInt(),this._type=t.readString(),this._headline=t.readString(),this._summary=t.readString(),!0}get id(){return this._id}get type(){return this._type}get headline(){return this._headline}get summary(){return this._summary}}class g2{flush(){return this._userId=-1,this._value="",this._answerCounts=null,!0}parse(t){this._userId=t.readInt(),this._value=t.readString(),this._answerCounts=new Map;const e=t.readInt();for(let i=0;i<e;i++){const r=t.readString(),n=t.readInt();this._answerCounts.set(r,n)}return!0}get userId(){return this._userId}get value(){return this._value}get answerCounts(){return this._answerCounts}}class E2{flush(){return this._questionId=-1,this._answerCounts=null,!0}parse(t){this._questionId=t.readInt(),this._answerCounts=new Map;const e=t.readInt();for(let i=0;i<e;i++){const r=t.readString(),n=t.readInt();this._answerCounts.set(r,n)}return!0}get questionId(){return this._questionId}get answerCounts(){return this._answerCounts}}class p2{constructor(){this._pollType=null,this._pollId=-1,this._questionId=-1,this._duration=-1,this._question=null}flush(){return this._pollType=null,this._pollId=-1,this._questionId=-1,this._duration=-1,this._question=null,!0}parse(t){this._pollType=t.readString(),this._pollId=t.readInt(),this._questionId=t.readInt(),this._duration=t.readInt();const e=t.readInt(),i=t.readInt(),r=t.readInt(),n=t.readString();if(this._question={id:e,number:i,type:r,content:n},this._question.type==1||this._question.type==2){this._question.selection_min=t.readInt();const a=t.readInt();this._question.selections=[],this._question.selection_values=[],this._question.selection_count=a,this._question.selection_max=a;for(let o=0;o<a;o++)this._question.selection_values.push(t.readString()),this._question.selections.push(t.readString())}return!0}get pollType(){return this._pollType}get pollId(){return this._pollId}get questionId(){return this._questionId}get duration(){return this._duration}get question(){return this._question}}class m2{flush(){return this._question=null,this._choices=[],this._SafeStr_7651=[],this._SafeStr_7654=-1,!0}parse(t){this._question=t.readString(),this._choices=[],this._SafeStr_7651=[];let e=t.readInt();for(;e>0;)this._choices.push(t.readString()),this._SafeStr_7651.push(t.readInt()),e--;return this._SafeStr_7654=t.readInt(),!0}get question(){return this._question}get choices(){return this._choices}get SafeStr_7651(){return this._SafeStr_7651}get SafeStr_7654(){return this._SafeStr_7654}}class I2{flush(){return this._question=null,this._choices=[],!0}parse(t){this._question=t.readString(),this._choices=[];const e=t.readInt();let i=0;for(;i<e;)this._choices.push(t.readString()),i++;return!0}get question(){return this._question}get choices(){return this._choices.slice()}}class T2{constructor(t){this._rewardUserLimits=[],this._hasGoalExpired=t.readBoolean(),this._personalContributionScore=t.readInt(),this._personalContributionRank=t.readInt(),this._communityTotalScore=t.readInt(),this._communityHighestAchievedLevel=t.readInt(),this._scoreRemainingUntilNextLevel=t.readInt(),this._percentCompletionTowardsNextLevel=t.readInt(),this._goalCode=t.readString(),this._timeRemainingInSeconds=t.readInt();const e=t.readInt();for(let i=0;i<e;i++)this._rewardUserLimits.push(t.readInt())}dispose(){this._rewardUserLimits=null}get disposed(){return this._rewardUserLimits==null}get hasGoalExpired(){return this._hasGoalExpired}get personalContributionScore(){return this._personalContributionScore}get personalContributionRank(){return this._personalContributionRank}get communityTotalScore(){return this._communityTotalScore}get communityHighestAchievedLevel(){return this._communityHighestAchievedLevel}get scoreRemainingUntilNextLevel(){return this._scoreRemainingUntilNextLevel}get percentCompletionTowardsNextLevel(){return this._percentCompletionTowardsNextLevel}get timeRemainingInSeconds(){return this._timeRemainingInSeconds}get rewardUserLimits(){return this._rewardUserLimits}get goalCode(){return this._goalCode}}class R2{constructor(t){this._communityGoalId=t.readInt(),this._communityGoalCode=t.readString(),this._userRank=t.readInt(),this._rewardCode=t.readString(),this._badge=t.readBoolean(),this._localizedName=t.readString()}get communityGoalId(){return this._communityGoalId}get communityGoalCode(){return this._communityGoalCode}get userRank(){return this._userRank}get rewardCode(){return this._rewardCode}get badge(){return this._badge}get localizedName(){return this._localizedName}}class O2{flush(){return this._prizes=[],!0}parse(t){if(!t)return!1;const e=t.readInt();for(let i=0;i<e;i++)this._prizes.push(new R2(t));return!0}get prizes(){return this._prizes}}class A2{constructor(t){this._userId=t.readInt(),this._userName=t.readString(),this._figure=t.readString(),this._rank=t.readInt(),this._currentScore=t.readInt()}get userId(){return this._userId}get userName(){return this._userName}get figure(){return this._figure}get rank(){return this._rank}get currentScore(){return this._currentScore}}class v2{constructor(t){this._hof=[],this._goalCode=t.readString();const e=t.readInt();for(let i=0;i<e;i++)this._hof.push(new A2(t))}dispose(){this._hof=null}get disposed(){return this._hof==null}get hof(){return this._hof}get goalCode(){return this._goalCode}}class S2{flush(){return this._data=null,!0}parse(t){return t?(this._data=new v2(t),!0):!1}get data(){return this._data}}class y2{flush(){return this._data=null,!0}parse(t){return t?(this._data=new T2(t),!0):!1}get data(){return this._data}}class C2{flush(){return this._state=-1,this._userCount=-1,this._userCountGoal=-1,!0}parse(t){return t?(this._state=t.readInt(),this._userCount=t.readInt(),this._userCountGoal=t.readInt(),!0):!1}get state(){return this._state}get userCount(){return this._userCount}get userCountGoal(){return this._userCountGoal}}class M2{flush(){return this._imageUri="",!0}parse(t){return t?(this._imageUri=t.readString(),!0):!1}get imageUri(){return this._imageUri}}class N2{flush(){return!0}parse(t){return t?(this._expired=t.readBoolean(),!0):!1}get expired(){return this._expired}}class Hn{constructor(t){this._receiveTime=new Date,this._campaignCode=t.readString(),this._completedQuestsInCampaign=t.readInt(),this._questCountInCampaign=t.readInt(),this._activityPointType=t.readInt(),this._id=t.readInt(),this._accepted=t.readBoolean(),this._type=t.readString(),this._imageVersion=t.readString(),this._rewardCurrencyAmount=t.readInt(),this._localizationCode=t.readString(),this._completedSteps=t.readInt(),this._totalSteps=t.readInt(),this._sortOrder=t.readInt(),this._catalogPageName=t.readString(),this._chainCode=t.readString(),this._easy=t.readBoolean()}static getCampaignLocalizationKeyForCode(t){return"quests."+t}get campaignCode(){return this._campaignCode}get localizationCode(){return this._localizationCode}get completedQuestsInCampaign(){return this._completedQuestsInCampaign}get questCountInCampaign(){return this._questCountInCampaign}get activityPointType(){return this._activityPointType}set accepted(t){this._accepted=t}get accepted(){return this._accepted}set id(t){this._id=t}get id(){return this._id}get type(){return this._type}get imageVersion(){return this._imageVersion}get rewardCurrencyAmount(){return this._rewardCurrencyAmount}get completedSteps(){return this._completedSteps}get totalSteps(){return this._totalSteps}get isCompleted(){return this._completedSteps==this._totalSteps}set waitPeriodSeconds(t){this._waitPeriodSeconds=t}get waitPeriodSeconds(){if(this._waitPeriodSeconds<1)return 0;const e=new Date().getTime()-this._receiveTime.getTime();return Math.max(0,this._waitPeriodSeconds-Math.floor(e/1e3))}getCampaignLocalizationKey(){return Hn.getCampaignLocalizationKeyForCode(this.campaignCode)}getQuestLocalizationKey(){return this.getCampaignLocalizationKey()+"."+this._localizationCode}get completedCampaign(){return this._id<1}get lastQuestInCampaign(){return this._completedQuestsInCampaign>=this._questCountInCampaign}get receiveTime(){return this._receiveTime}get sortOrder(){return this._sortOrder}get catalogPageName(){return this._catalogPageName}get chainCode(){return this._chainCode}get easy(){return this._easy}}class P2{flush(){return this._questData=null,!0}parse(t){return t?(this._questData=new Hn(t),this._showDialog=t.readBoolean(),!0):!1}get questData(){return this._questData}get showDialog(){return this._showDialog}}class b2{flush(){return this._quest=null,!0}parse(t){return t?(t.readBoolean()&&(this._quest=new Hn(t),this._easyQuestCount=t.readInt(),this._hardQuestCount=t.readInt()),!0):!1}get quest(){return this._quest}get easyQuestCount(){return this._easyQuestCount}get hardQuestCount(){return this._hardQuestCount}}class D2{flush(){return this._quest=null,!0}parse(t){return t?(this._quest=new Hn(t),!0):!1}get quest(){return this._quest}}class L2{flush(){return this._quests=[],!0}parse(t){if(!t)return!1;const e=t.readInt();for(let i=0;i<e;i++)this._quests.push(new Hn(t));return this._openWindow=t.readBoolean(),!0}get quests(){return this._quests}get openWindow(){return this._openWindow}}class U2{flush(){return this._quests=[],!0}parse(t){if(!t)return!1;const e=t.readInt();for(let i=0;i<e;i++)this._quests.push(new Hn(t));return!0}get quests(){return this._quests}}class x2{flush(){return this._recyclerFinishedStatus=-1,this._prizeId=0,!0}parse(t){return t?(this._recyclerFinishedStatus=t.readInt(),this._prizeId=t.readInt(),!0):!1}get recyclerFinishedStatus(){return this._recyclerFinishedStatus}get prizeId(){return this._prizeId}}class F2{flush(){return this._recyclerStatus=-1,this._recyclerTimeoutSeconds=0,!0}parse(t){return t?(this._recyclerStatus=t.readInt(),this._recyclerTimeoutSeconds=t.readInt(),!0):!1}get recyclerStatus(){return this._recyclerStatus}get recyclerTimeoutSeconds(){return this._recyclerTimeoutSeconds}}class Yf{constructor(t){this._stuffIds=[],this._intParams=[],this._stuffTypeSelectionEnabled=t.readBoolean(),this._furniLimit=t.readInt();let e=t.readInt();for(;e>0;)this._stuffIds.push(t.readInt()),e--;for(this._stuffTypeId=t.readInt(),this._id=t.readInt(),this._stringParam=t.readString(),e=t.readInt();e>0;)this._intParams.push(t.readInt()),e--;this._stuffTypeSelectionCode=t.readInt()}getBoolean(t){return this._intParams[t]===1}get stuffTypeSelectionEnabled(){return this._stuffTypeSelectionEnabled}get stuffTypeSelectionCode(){return this._stuffTypeSelectionCode}set stuffTypeSelectionCode(t){this._stuffTypeSelectionCode=t}get maximumItemSelectionCount(){return this._furniLimit}get selectedItems(){return this._stuffIds}get id(){return this._id}get stringData(){return this._stringParam}get intData(){return this._intParams}get code(){return 0}get spriteId(){return this._stuffTypeId}}class w2 extends Yf{constructor(t){super(t),this._type=t.readInt()}get type(){return this._type}get code(){return this._type}}class G2 extends Yf{constructor(t){super(t),this._conflictingActions=[],this._triggerConf=t.readInt();let e=t.readInt();for(;e>0;)this._conflictingActions.push(t.readInt()),e--}get code(){return this._triggerConf}get conflictingActions(){return this._conflictingActions}}class B2 extends Yf{constructor(t){super(t),this._conflictingTriggers=[],this._type=t.readInt(),this._delayInPulses=t.readInt();let e=t.readInt();for(;e>0;)this._conflictingTriggers.push(t.readInt()),e--}get type(){return this._type}get code(){return this._type}get delayInPulses(){return this._delayInPulses}get conflictingTriggers(){return this._conflictingTriggers}}class H2{flush(){return this._definition=null,!0}parse(t){return t?(this._definition=new B2(t),!0):!1}get definition(){return this._definition}}class V2{flush(){return this._definition=null,!0}parse(t){return t?(this._definition=new w2(t),!0):!1}get definition(){return this._definition}}class k2{flush(){return this._definition=null,!0}parse(t){return t?(this._definition=new G2(t),!0):!1}get definition(){return this._definition}}class j2{flush(){return this._stuffId=0,!0}parse(t){return t?(this._stuffId=t.readInt(),!0):!1}get stuffId(){return this._stuffId}}class z2{flush(){return this._reason=0,!0}parse(t){return t?(this._reason=t.readInt(),!0):!1}get reason(){return this._reason}}class Y2{flush(){return!0}parse(t){return!!t}}class W2{flush(){return this._info=null,!0}parse(t){return t?(this._info=t.readString(),!0):!1}get info(){return this._info}}class X2{flush(){return!0}parse(t){return!!t}}class K2{flush(){return!0}parse(t){return!0}}class q2{constructor(){this._songDisks=new Ee}flush(){return this._songDisks.reset(),this._maxLength=0,!0}parse(t){this._maxLength=t.readInt();const e=t.readInt();for(let i=0;i<e;i++)this._songDisks.add(t.readInt(),t.readInt());return!0}get songDisks(){return this._songDisks}get maxLength(){return this._maxLength}}class Z2{flush(){return this._currentSongId=-1,this._currentPosition=-1,this._nextSongId=-1,this._nextPosition=-1,this._syncCount=-1,!0}parse(t){return this._currentSongId=t.readInt(),this._currentPosition=t.readInt(),this._nextSongId=t.readInt(),this._nextPosition=t.readInt(),this._syncCount=t.readInt(),!0}get currentSongId(){return this._currentSongId}get currentPosition(){return this._currentPosition}get nextSongId(){return this._nextSongId}get nextPosition(){return this._nextPosition}get syncCount(){return this._syncCount}}class Q2{flush(){return this._songId=0,this._officialSongId="",!0}parse(t){return this._officialSongId=t.readString(),this._songId=t.readInt(),!0}get songId(){return this._songId}get officialSongId(){return this._officialSongId}}class zl{constructor(t,e,i,r){this._startPlayHead=0,this._id=t,this._length=e,this._name=i,this._creator=r}get id(){return this._id}get length(){return this._length}get name(){return this._name}get creator(){return this._creator}get startPlayHeadPos(){return this._startPlayHead}set startPlayHeadPos(t){this._startPlayHead=t}}class J2{flush(){return this._synchronizationCount=-1,this._playlist=[],!0}parse(t){this._synchronizationCount=t.readInt();const e=t.readInt();for(let i=0;i<e;i++)this._playlist.push(new zl(t.readInt(),t.readInt(),t.readString(),t.readString()));return!0}get synchronizationCount(){return this._synchronizationCount}get playList(){return this._playlist}}class $2{flush(){return this._entry=null,!0}parse(t){return this._entry=new zl(t.readInt(),t.readInt(),t.readString(),t.readString()),!0}get entry(){return this._entry}}class tH extends zl{constructor(t,e,i,r,n){super(t,e,i,r),this._data="",this._data=n}get data(){return this._data}}class eH{flush(){return this._songs=[],!0}parse(t){const e=t.readInt();for(let i=0;i<e;i++){const r=t.readInt();t.readString();const n=t.readString(),a=t.readString(),o=t.readInt(),h=t.readString(),u=new tH(r,o,n,h,a);this._songs.push(u)}return!0}get songs(){return this._songs}}class sH{constructor(){this._songDiskInventory=new Ee}flush(){return this._songDiskInventory.reset(),!0}parse(t){const e=t.readInt();for(let i=0;i<e;i++)this._songDiskInventory.add(t.readInt(),t.readInt());return!0}getDiskId(t){return t>=0&&t<this._songDiskInventory.length?this._songDiskInventory.getKey(t):-1}getSongId(t){return t>=0&&t<this._songDiskInventory.length?this._songDiskInventory.getWithIndex(t):-1}get songDiskCount(){return this._songDiskInventory.length}}class iH{flush(){return this._talentTrackName=null,this._level=-1,this._rewardPerks=[],this._rewardProducts=[],!0}parse(t){if(!t)return!1;let e=0;this._talentTrackName=t.readString(),this._level=t.readInt();const i=t.readInt();for(;e<i;)this._rewardPerks.push(new hH(t)),e++;const r=t.readInt();if(e<r)for(let n=0;n<r;n++){const a=t.readString(),o=t.readInt();this._rewardProducts.push(new AT(a,o)),e++}return!0}get talentTrackName(){return this._talentTrackName}get level(){return this._level}get rewardPerks(){return this._rewardPerks}get rewardProducts(){return this._rewardProducts}}class rH{constructor(t,e,i,r,n){this._level=t,this._state=e,this._tasks=i,this._rewardPerks=r,this._rewardProducts=n}get level(){return this._level}get state(){return this._state}get tasks(){return this._tasks}get perks(){return this._rewardPerks}get items(){return this._rewardProducts}}class nH{flush(){return this._talentTrackName=null,this._level=-1,this._maxLevel=-1,!0}parse(t){return t?(this._talentTrackName=t.readString(),this._level=t.readInt(),this._maxLevel=t.readInt(),!0):!1}get talentTrackName(){return this._talentTrackName}get level(){return this._level}get maxLevel(){return this._maxLevel}}class AT{constructor(t,e){this._productCode=t,this._vipDays=e}get productCode(){return this._productCode}get vipDays(){return this._vipDays}}class aH{constructor(t,e,i,r,n,a){this._id=t,this._requiredLevel=e,this._badgeCode=i,this._state=r,this._currentScore=n,this._totalScore=a}get id(){return this._id}get requiredLevel(){return this._requiredLevel}get badgeCode(){return this._badgeCode}get state(){return this._state}get currentScore(){return this._currentScore}get totalScore(){return this._totalScore}}class oH{flush(){return this._type=null,this._levels=null,!0}parse(t){if(!t)return!1;this._type=t.readString(),this._levels=[];const e=t.readInt();for(let i=0;i<e;i++){const r=t.readInt(),n=t.readInt(),a=[],o=t.readInt();for(let _=0;_<o;_++){const d=t.readInt(),g=t.readInt(),m=t.readString(),p=t.readInt(),T=t.readInt(),A=t.readInt();a.push(new aH(d,g,m,p,T,A))}const h=[],u=t.readInt();for(let _=0;_<u;_++)h.push(t.readString());const c=[],l=t.readInt();for(let _=0;_<l;_++){const d=t.readString(),g=t.readInt();c.push(new AT(d,g))}this._levels.push(new rH(r,n,a,h,c))}return!0}get type(){return this._type}get levels(){return this._levels}}class hH{constructor(t){this._perkId=t.readInt()}get perkId(){return this._perkId}}class uH{flush(){return this._classifiedUsersNames&&(this._classifiedUsersNames=new Map),this._classifiedUsersClass&&(this._classifiedUsersClass=new Map),!0}parse(t){if(!t)return!1;let e,i,r,n=t.readInt();for(this._classifiedUsersNames=new Map,this._classifiedUsersClass=new Map;n>0;)e=t.readInt(),i=t.readString(),r=t.readString(),this._classifiedUsersNames.set(e,i),this._classifiedUsersClass.set(e,r),n--;return!0}get classifiedUsernameMap(){return this._classifiedUsersNames}get classifiedUserTypeMap(){return this._classifiedUsersClass}}class lH extends R{constructor(t){super(t,lL)}getParser(){return this.parser}}class _H extends R{constructor(t){super(t,_L)}getParser(){return this.parser}}class vT extends R{constructor(t){super(t,cL)}getParser(){return this.parser}}class cH extends R{constructor(t){super(t,dL)}getParser(){return this.parser}}class dH extends R{constructor(t){super(t,fL)}getParser(){return this.parser}}class fH extends R{constructor(t){super(t,gL)}getParser(){return this.parser}}class gH extends R{constructor(t){super(t,EL)}getParser(){return this.parser}}class EH extends R{constructor(t){super(t,pL)}getParser(){return this.parser}}class zs extends R{constructor(t){super(t,mL)}getParser(){return this.parser}}zs.NAME_OK=0;zs.ERROR_NAME_REQUIRED=1;zs.ERROR_NAME_TOO_SHORT=2;zs.ERROR_NAME_TOO_LONG=3;zs.ERROR_NAME_NOT_VALID=4;zs.ERROR_NAME_IN_USE=5;zs.ERROR_NAME_CHANGE_NOT_ALLOWED=6;zs.ERROR_MERGE_HOTEL_DOWN=7;class pH extends R{constructor(t){super(t,IL)}getParser(){return this.parser}}class ST extends R{constructor(t){super(t,TL)}getParser(){return this.parser}}class mH extends R{constructor(t){super(t,OL)}getParser(){return this.parser}}class IH extends R{constructor(t){super(t,AL)}getParser(){return this.parser}}class TH extends R{constructor(t){super(t,vL)}getParser(){return this.parser}}class RH extends R{constructor(t){super(t,SL)}getParser(){return this.parser}}class OH extends R{constructor(t){super(t,yL)}getParser(){return this.parser}}class AH extends R{constructor(t){super(t,PL)}getParser(){return this.parser}}class vH extends R{constructor(t){super(t,bL)}getParser(){return this.parser}}class SH extends R{constructor(t){super(t,DL)}getParser(){return this.parser}}class yH extends R{constructor(t){super(t,LL)}getParser(){return this.parser}}class CH extends R{constructor(t){super(t,UL)}getParser(){return this.parser}}class MH extends R{constructor(t){super(t,xL)}getParser(){return this.parser}}class NH extends R{constructor(t){super(t,FL)}getParser(){return this.parser}}class PH extends R{constructor(t){super(t,wL)}getParser(){return this.parser}}class bH extends R{constructor(t){super(t,GL)}getParser(){return this.parser}}class DH extends R{constructor(t){super(t,BL)}getParser(){return this.parser}}class LH extends R{constructor(t){super(t,HL)}getParser(){return this.parser}}class UH extends R{constructor(t){super(t,VL)}getParser(){return this.parser}}class xH extends R{constructor(t){super(t,kL)}getParser(){return this.parser}}class FH extends R{constructor(t){super(t,jL)}getParser(){return this.parser}}class wH extends R{constructor(t){super(t,zL)}getParser(){return this.parser}}class GH extends R{constructor(t){super(t,WL)}getParser(){return this.parser}}class BH extends R{constructor(t){super(t,qL)}getParser(){return this.parser}}class HH extends R{constructor(t){super(t,ZL)}getParser(){return this.parser}}class VH extends R{constructor(t){super(t,XL)}getParser(){return this.parser}}class kH extends R{constructor(t){super(t,QL)}getParser(){return this.parser}}class jH extends R{constructor(t){super(t,JL)}getParser(){return this.parser}}class zH extends R{constructor(t){super(t,tU)}getParser(){return this.parser}}class YH extends R{constructor(t){super(t,eU)}getParser(){return this.parser}}class WH extends R{constructor(t){super(t,iU)}getParser(){return this.parser}}class XH extends R{constructor(t){super(t,nU)}getParser(){return this.parser}}class KH extends R{constructor(t){super(t,aU)}getParser(){return this.parser}}class qH extends R{constructor(t){super(t,oU)}getParser(){return this.parser}}class ZH extends R{constructor(t){super(t,hU)}getParser(){return this.parser}}class QH extends R{constructor(t){super(t,uU)}getParser(){return this.parser}}class JH extends R{constructor(t){super(t,lU)}getParser(){return this.parser}}class $H extends R{constructor(t){super(t,_U)}getParser(){return this.parser}}class tV extends R{constructor(t){super(t,cU)}getParser(){return this.parser}}class eV extends R{constructor(t){super(t,dU)}getParser(){return this.parser}}class sV extends R{constructor(t){super(t,fU)}getParser(){return this.parser}}class iV extends R{constructor(t){super(t,gU)}getParser(){return this.parser}}class rV extends R{constructor(t){super(t,EU)}getParser(){return this.parser}}class nV extends R{constructor(t){super(t,mU)}getParser(){return this.parser}}class aV extends R{constructor(t){super(t,EF)}getParser(){return this.parser}}class oV extends R{constructor(t){super(t,pF)}getParser(){return this.parser}}class hV extends R{constructor(t){super(t,IF)}getParser(){return this.parser}}class uV extends R{constructor(t){super(t,OF)}getParser(){return this.parser}}class lV extends R{constructor(t){super(t,RF)}getParser(){return this.parser}}class _V extends R{constructor(t){super(t,AF)}getParser(){return this.parser}}class cV extends R{constructor(t){super(t,vF)}getParser(){return this.parser}}class yT extends R{constructor(t){super(t,SF)}getParser(){return this.parser}}class dV extends R{constructor(t){super(t,kr)}getParser(){return this.parser}}class fV extends R{constructor(t){super(t,yF)}getParser(){return this.parser}}class gV extends R{constructor(t){super(t,CF)}getParser(){return this.parser}}class EV extends R{constructor(t){super(t,MF)}getParser(){return this.parser}}class pV extends R{constructor(t){super(t,NF)}getParser(){return this.parser}}class mV extends R{constructor(t){super(t,PF)}getParser(){return this.parser}}class IV extends R{constructor(t){super(t,bF)}getParser(){return this.parser}}class TV extends R{constructor(t){super(t,LF)}getParser(){return this.parser}}class RV extends R{constructor(t){super(t,UF)}getParser(){return this.parser}}class OV extends R{constructor(t){super(t,xF)}getParser(){return this.parser}}class sd extends R{constructor(t){super(t,FF)}getParser(){return this.parser}}class AV extends R{constructor(t){super(t,GF)}getParser(){return this.parser}}class vV extends R{constructor(t){super(t,BF)}getParser(){return this.parser}}class SV extends R{constructor(t){super(t,HF)}getParser(){return this.parser}}class yV extends R{constructor(t){super(t,VF)}getParser(){return this.parser}}class CV extends R{constructor(t){super(t,kF)}getParser(){return this.parser}}class MV extends R{constructor(t){super(t,jF)}getParser(){return this.parser}}class NV extends R{constructor(t){super(t,zF)}getParser(){return this.parser}}class PV extends R{constructor(t){super(t,YF)}getParser(){return this.parser}}class bV extends R{constructor(t){super(t,WF)}getParser(){return this.parser}}class DV extends R{constructor(t){super(t,XF)}getParser(){return this.parser}}class LV extends R{constructor(t){super(t,KF)}getParser(){return this.parser}}class UV extends R{constructor(t){super(t,qF)}getParser(){return this.parser}}class xV extends R{constructor(t){super(t,ZF)}getParser(){return this.parser}}class FV extends R{constructor(t){super(t,QF)}getParser(){return this.parser}}class CT extends R{constructor(t){super(t,JF)}getParser(){return this.parser}}class wV extends R{constructor(t){super(t,$F)}getParser(){return this.parser}}class GV extends R{constructor(t){super(t,tw)}getParser(){return this.parser}}class BV extends R{constructor(t){super(t,ew)}getParser(){return this.parser}}class HV extends R{constructor(t){super(t,mh)}getParser(){return this.parser}}class VV extends R{constructor(t){super(t,sw)}getParser(){return this.parser}}class kV extends R{constructor(t){super(t,rr)}getParser(){return this.parser}}class jV extends R{constructor(t){super(t,Vf)}getParser(){return this.parser}}class zV extends R{constructor(t){super(t,iw)}getParser(){return this.parser}}class YV extends R{constructor(t){super(t,rw)}getParser(){return this.parser}}class WV extends R{constructor(t){super(t,nw)}getParser(){return this.parser}}class XV extends R{constructor(t){super(t,aw)}getParser(){return this.parser}}class KV extends R{constructor(t){super(t,ow)}getParser(){return this.parser}}class qV extends R{constructor(t){super(t,uw)}getParser(){return this.parser}}class ZV extends R{constructor(t){super(t,_w)}getParser(){return this.parser}}class QV extends R{constructor(t){super(t,cw)}getParser(){return this.parser}}class JV extends R{constructor(t){super(t,kf)}getParser(){return this.parser}}class $V extends R{constructor(t){super(t,dw)}getParser(){return this.parser}}class tk extends R{constructor(t){super(t,pT)}getParser(){return this.parser}}class ek extends R{constructor(t){super(t,fw)}getParser(){return this.parser}}class sk extends R{constructor(t){super(t,gw)}getParser(){return this.parser}}class MT extends R{constructor(t){super(t,Ew)}getParser(){return this.parser}}class ik extends R{constructor(t){super(t,pw)}getParser(){return this.parser}}class rk extends R{constructor(t){super(t,mw)}getParser(){return this.parser}}class nk extends R{constructor(t){super(t,Bl)}getParser(){return this.parser}}class ak extends R{constructor(t){super(t,Bl)}getParser(){return this.parser}}class ok extends R{constructor(t){super(t,Bl)}getParser(){return this.parser}}class hk extends R{constructor(t){super(t,Bl)}getParser(){return this.parser}}class uk extends R{constructor(t){super(t,Tw)}getParser(){return this.parser}}class lk extends R{constructor(t){super(t,Rw)}getParser(){return this.parser}}class id extends R{constructor(t){super(t,Ow)}getParser(){return this.parser}}class _k extends R{constructor(t){super(t,Aw)}getParser(){return this.parser}}class ck extends R{constructor(t){super(t,vw)}getParser(){return this.parser}}class dk extends R{constructor(t){super(t,Sw)}getParser(){return this.parser}}class NT extends R{constructor(t){super(t,yw)}getParser(){return this.parser}}class fk extends R{constructor(t){super(t,Cw)}getParser(){return this.parser}}class gk extends R{constructor(t){super(t,Mw)}getParser(){return this.parser}}class Ek extends R{constructor(t){super(t,Nw)}getParser(){return this.parser}}class pk extends R{constructor(t){super(t,Dw)}getParser(){return this.parser}}class mk extends R{constructor(t){super(t,Lw)}getParser(){return this.parser}}class Ik extends R{constructor(t){super(t,Uw)}getParser(){return this.parser}}class Tk extends R{constructor(t){super(t,xw)}getParser(){return this.parser}}class Rk extends R{constructor(t){super(t,Fw)}getParser(){return this.parser}}class Ok extends R{constructor(t){super(t,ww)}getParser(){return this.parser}}class Ak extends R{constructor(t){super(t,Gw)}getParser(){return this.parser}}class vk extends R{constructor(t){super(t,Bw)}getParser(){return this.parser}}class Sk extends R{constructor(t){super(t,Hw)}getParser(){return this.parser}}class yk extends R{constructor(t){super(t,Vw)}getParser(){return this.parser}}class Ck extends R{constructor(t){super(t,kw)}getParser(){return this.parser}}class Mk extends R{constructor(t){super(t,jw)}getParser(){return this.parser}}class Nk extends R{constructor(t){super(t,zw)}getParser(){return this.parser}}class Pk extends R{constructor(t){super(t,Yw)}getParser(){return this.parser}}class ot{}ot.LOGOUT=0;ot.JUST_BANNED=1;ot.CONCURRENT_LOGIN=2;ot.CONNECTION_LOST_TO_PEER=3;ot.AVATAR_IDENTITY_CHANGE=4;ot.REMOVE_FURNITURE_TOOL=5;ot.STILL_BANNED=10;ot.DUAL_LOGIN_BY_USERID=11;ot.HOTEL_CLOSED=12;ot.DUAL_LOGIN_BY_IP=13;ot.PEER_CONNECTION_MISSING=16;ot.NO_LOGIN_PERMISSION=17;ot.DUPLICATE_CONNECTION=18;ot.HOTEL_CLOSING=19;ot.INCORRECT_PASSWORD=20;ot.INVALID_LOGIN_TICKET=22;ot.VERSION_CHECK_URL=23;ot.VERSION_CHECK_PROPERTY=24;ot.VERSION_CHECK_MACHINE_ID=25;ot.NO_MESSENGER_SESSION=26;ot.USER_NOT_FOUND=27;ot.CRYPTO_NOT_INITIALIZED=28;ot.DEV_CRYPTO_NOT_ALLOWED=29;ot.DUPLICATE_UUID_DETECTED=100;ot.OLD_SESSION_IN_PROXY=101;ot.PUBLIC_KEY_NOT_NUMERIC=102;ot.PUBLIC_KEY_TOO_SHORT=103;ot.SOCKET_READ_GENERIC=104;ot.SOCKET_READ_FIRST_BYTE=105;ot.SOCKET_READ_LENGTH=106;ot.SOCKET_READ_BODY=107;ot.SOCKET_READ_POLICY=108;ot.SOCKET_IO_EXCEPTION=109;ot.SOCKET_WRONG_CRYPTO=110;ot.PROXY_RUNTIME_EXCEPTION=111;ot.IDLE_CONNECTION=112;ot.PONG_TIMEOUT=113;ot.IDLE_CONNECTION_NOT_AUTH=114;ot.IDLE_CONNECTION_NO_USER_ID=115;ot.WRITE_CLOSED_CHANNEL=116;ot.SOCKET_WRITE_EXCEPTION_1=117;ot.SOCKET_WRITE_EXCEPTION_2=118;ot.SOCKET_WRITE_EXCEPTION_3=119;class bk extends R{constructor(t){super(t,Ww)}getParser(){return this.parser}get reasonString(){switch(this.getParser().reason){case ot.JUST_BANNED:case ot.STILL_BANNED:return"banned";case ot.CONCURRENT_LOGIN:return"concurrentlogin";case ot.INCORRECT_PASSWORD:return"incorrectpassword";default:return"logout"}}}class Dk extends R{constructor(t){super(t,Xw)}getParser(){return this.parser}}class Lk extends R{constructor(t){super(t,Kw)}getParser(){return this.parser}}class PT extends R{constructor(t){super(t,qw)}getParser(){return this.parser}}class Uk extends R{constructor(t){super(t,Zw)}getParser(){return this.parser}}class xk extends R{constructor(t){super(t,Qw)}getParser(){return this.parser}}class Fk extends R{constructor(t){super(t,Jw)}getParser(){return this.parser}}class wk extends R{constructor(t){super(t,$w)}getParser(){return this.parser}}class Gk extends R{constructor(t){super(t,tG)}getParser(){return this.parser}}class Bk extends R{constructor(t){super(t,eG)}getParser(){return this.parser}}class Hk extends R{constructor(t){super(t,sG)}getParser(){return this.parser}}class Vk extends R{constructor(t){super(t,iG)}getParser(){return this.parser}}class kk extends R{constructor(t){super(t,rG)}getParser(){return this.parser}}class jk extends R{constructor(t){super(t,Bn)}getParser(){return this.parser}}class zk extends R{constructor(t){super(t,nG)}getParser(){return this.parser}}class Yk extends R{constructor(t){super(t,Oh)}getParser(){return this.parser}}class Wk extends R{constructor(t){super(t,oG)}getParser(){return this.parser}}class Xk extends R{constructor(t){super(t,hG)}getParser(){return this.parser}}class bT extends R{constructor(t){super(t,uG)}getParser(){return this.parser}}class DT extends R{constructor(t){super(t,Ba)}getParser(){return this.parser}}class Kk extends R{constructor(t){super(t,lG)}getParser(){return this.parser}}class qk extends R{constructor(t){super(t,_G)}getParser(){return this.parser}}class Zk extends R{constructor(t){super(t,cG)}getParser(){return this.parser}}class Qk extends R{constructor(t){super(t,dG)}getParser(){return this.parser}}class LT extends R{constructor(t){super(t,fG)}getParser(){return this.parser}}class Jk extends R{constructor(t){super(t,Ah)}getParser(){return this.parser}}class $k extends R{constructor(t){super(t,Hl)}getParser(){return this.parser}}class tj extends R{constructor(t){super(t,gG)}getParser(){return this.parser}}class ej extends R{constructor(t){super(t,EG)}getParser(){return this.parser}}class sj extends R{constructor(t){super(t,pG)}getParser(){return this.parser}}class ij extends R{constructor(t){super(t,mG)}getParser(){return this.parser}}class E{}E.ACHIEVEMENT_LIST=305;E.AUTHENTICATED=2491;E.AUTHENTICATION=-1;E.AVAILABILITY_STATUS=2033;E.BUILDERS_CLUB_EXPIRED=1452;E.CLUB_OFFERS=2405;E.CATALOG_PAGE=804;E.CATALOG_PAGE_LIST=1032;E.CATALOG_PURCHASE_OK=869;E.CATALOG_PURCHASE_ERROR=1404;E.CATALOG_PURCHASE_NOT_ALLOWED=3770;E.PRODUCT_OFFER=3388;E.LIMITED_SOLD_OUT=377;E.CATALOG_PUBLISHED=1866;E.CFH_RESULT_MESSAGE=3635;E.CLIENT_LATENCY=10;E.CLIENT_PING=3928;E.DESKTOP_CAMPAIGN=1745;E.DESKTOP_NEWS=286;E.DESKTOP_VIEW=122;E.BUNDLE_DISCOUNT_RULESET=2347;E.FIRST_LOGIN_OF_DAY=793;E.FURNITURE_ALIASES=1723;E.FURNITURE_DATA=2547;E.FURNITURE_FLOOR=1778;E.FURNITURE_FLOOR_ADD=1534;E.FURNITURE_FLOOR_REMOVE=2703;E.FURNITURE_FLOOR_UPDATE=3776;E.FURNITURE_ITEMDATA=2202;E.FURNITURE_STATE=2376;E.FURNITURE_GROUP_CONTEXT_MENU_INFO=3293;E.FURNITURE_POSTIT_STICKY_POLE_OPEN=2366;E.GAME_CENTER_ACHIEVEMENTS=2265;E.GAME_CENTER_GAME_LIST=222;E.GAME_CENTER_STATUS=2893;E.GAME_CENTER_IN_ARENA_QUEUE=872;E.GAME_CENTER_STOP_COUNTER=3191;E.GAME_CENTER_USER_LEFT_GAME=3138;E.GAME_CENTER_DIRECTORY_STATUS=2246;E.GAME_CENTER_STARTING_GAME_FAILED=2142;E.GAME_CENTER_JOINING_FAILED=1730;E.GAMESTATUSMESSAGE=3805;E.GAMEACHIEVEMENTS=1689;E.GAMEINVITE=904;E.JOININGQUEUEFAILED=3035;E.JOINEDQUEUEMESSAGE=2260;E.LEFTQUEUE=1477;E.LOAD_GAME_URL=2624;E.LOADGAME=3654;E.UNLOADGAME=1715;E.ACHIEVEMENTRESOLUTIONCOMPLETED=740;E.ACHIEVEMENTRESOLUTIONPROGRESS=3370;E.ACHIEVEMENTRESOLUTIONS=66;E.GENERIC_ALERT=3801;E.MODERATOR_MESSAGE=2030;E.GENERIC_ERROR=1600;E.GIFT_WRAPPER_CONFIG=2234;E.GROUP_BADGES=2402;E.GROUP_CREATE_OPTIONS=2159;E.GROUP_FORUM_DATA=3011;E.GROUP_FORUM_LIST=3001;E.GROUP_FORUM_THREADS=1073;E.GROUP_FORUM_POST=2049;E.GROUP_FORUM_POST_THREAD=1862;E.GROUP_FORUM_THREAD_MESSAGES=509;E.GROUP_FORUM_UNREAD_COUNT=2379;E.GROUP_FORUM_UPDATE_MESSAGE=324;E.GROUP_FORUM_UPDATE_THREAD=2528;E.GROUP_INFO=1702;E.GROUP_LIST=420;E.GROUP_MEMBER=265;E.GROUP_MEMBERS=1200;E.GROUP_MEMBERS_REFRESH=2445;E.GROUP_MEMBER_REMOVE_CONFIRM=1876;E.GROUP_PURCHASED=2808;E.GROUP_SETTINGS=3965;E.GROUP_BADGE_PARTS=2238;E.GROUP_MEMBERSHIP_REQUESTED=1180;E.GROUP_DETAILS_CHANGED=1459;E.GROUP_HABBO_JOIN_FAILED=762;E.GUILD_EDIT_FAILED=3988;E.GUILD_MEMBER_MGMT_FAILED=818;E.ITEM_DIMMER_SETTINGS=2710;E.ITEM_STACK_HELPER=2816;E.ITEM_WALL=1369;E.ITEM_WALL_ADD=2187;E.ITEM_WALL_REMOVE=3208;E.ITEM_WALL_UPDATE=2009;E.MARKETPLACE_CONFIG=1823;E.MESSENGER_ACCEPT_FRIENDS=896;E.MESSENGER_CHAT=1587;E.MESSENGER_FIND_FRIENDS=1210;E.MESSENGER_FOLLOW_FAILED=3048;E.MESSENGER_FRIEND_NOTIFICATION=3082;E.MESSENGER_FRIENDS=3130;E.MESSENGER_INIT=1605;E.MESSENGER_INSTANCE_MESSAGE_ERROR=3359;E.MESSENGER_INVITE=3870;E.MESSENGER_INVITE_ERROR=462;E.MESSENGER_MESSAGE_ERROR=892;E.MESSENGER_MINIMAIL_COUNT=2803;E.MESSENGER_MINIMAIL_NEW=1911;E.MESSENGER_RELATIONSHIPS=2016;E.MESSENGER_REQUEST=2219;E.MESSENGER_REQUEST_ERROR=892;E.MESSENGER_REQUESTS=280;E.MESSENGER_SEARCH=973;E.MESSENGER_UPDATE=2800;E.MODERATION_REPORT_DISABLED=1651;E.MODERATION_TOOL=2696;E.MODERATION_USER_INFO=2866;E.MOTD_MESSAGES=2035;E.NAVIGATOR_CATEGORIES=1562;E.NAVIGATOR_COLLAPSED=1543;E.NAVIGATOR_EVENT_CATEGORIES=3244;E.NAVIGATOR_LIFTED=3104;E.NAVIGATOR_METADATA=3052;E.NAVIGATOR_OPEN_ROOM_CREATOR=2064;E.NAVIGATOR_SEARCH=2690;E.NAVIGATOR_SEARCHES=3984;E.NAVIGATOR_SETTINGS=518;E.THUMBNAIL_UPDATE_RESULT=1927;E.CAN_CREATE_ROOM=378;E.CATEGORIES_WITH_VISITOR_COUNT=1455;E.COMPETITION_ROOMS_DATA=3954;E.CONVERTED_ROOM_ID=1331;E.GUEST_ROOM_SEARCH_RESULT=52;E.NOTIFICATION_LIST=1992;E.NOTIFICATION_OFFER_REWARD_DELIVERED=2125;E.NOTIFICATION_SIMPLE_ALERT=5100;E.NOTIFICATION_ELEMENT_POINTER=1787;E.PET_FIGURE_UPDATE=1924;E.PET_INFO=2901;E.PET_TRAINING_PANEL=1164;E.PET_LEVEL_UPDATE=2824;E.PET_SCRATCH_FAILED=1130;E.PET_OPEN_PACKAGE_REQUESTED=2380;E.PET_OPEN_PACKAGE_RESULT=546;E.PET_BREEDING=1746;E.PET_CONFIRM_BREEDING_RESULT=1625;E.PET_GO_TO_BREEDING_NEST_FAILURE=2621;E.PET_NEST_BREEDING_SUCCESS=2527;E.PET_CONFIRM_BREEDING_REQUEST=634;E.PET_BREEDING_RESULT=1553;E.RECYCLER_PRIZES=3164;E.RECYCLER_STATUS=3433;E.RECYCLER_FINISHED=468;E.ROOM_BAN_LIST=1869;E.ROOM_BAN_REMOVE=3429;E.ROOM_CREATED=1304;E.ROOM_DOORBELL=2309;E.ROOM_DOORBELL_ACCEPTED=3783;E.ROOM_DOORBELL_REJECTED=878;E.ROOM_ENTER=758;E.ROOM_ENTER_ERROR=899;E.ROOM_FORWARD=160;E.ROOM_HEIGHT_MAP=2753;E.ROOM_HEIGHT_MAP_UPDATE=558;E.ROOM_INFO=687;E.ROOM_INFO_OWNER=749;E.ROOM_MODEL=1301;E.ROOM_MODEL_BLOCKED_TILES=3990;E.ROOM_MODEL_DOOR=1664;E.ROOM_MODEL_NAME=2031;E.ROOM_MUTED=2533;E.ROOM_MUTE_USER=826;E.ROOM_PAINT=2454;E.ROOM_PROMOTION=2274;E.ROOM_QUEUE_STATUS=2208;E.ROOM_RIGHTS=780;E.ROOM_RIGHTS_CLEAR=2392;E.ROOM_RIGHTS_LIST=1284;E.ROOM_RIGHTS_LIST_ADD=2088;E.ROOM_RIGHTS_LIST_REMOVE=1327;E.ROOM_RIGHTS_OWNER=339;E.ROOM_ROLLING=3207;E.ROOM_SCORE=482;E.ROOM_SETTINGS=1498;E.ROOM_SETTINGS_CHAT=1191;E.ROOM_SETTINGS_SAVE=948;E.ROOM_SETTINGS_SAVE_ERROR=1555;E.ROOM_INFO_UPDATED=3297;E.ROOM_SPECTATOR=1033;E.ROOM_THICKNESS=3547;E.ROOM_GET_FILTER_WORDS=2937;E.ROOM_MESSAGE_NOTIFICATION=1634;E.ROOM_POPULAR_TAGS_RESULT=2012;E.INFO_FEED_ENABLE=3284;E.SECURITY_MACHINE=1488;E.MYSTERY_BOX_KEYS=2833;E.GOTMYSTERYBOXPRIZEMESSAGE=3712;E.CANCELMYSTERYBOXWAITMESSAGE=596;E.SHOWMYSTERYBOXWAITMESSAGE=3201;E.TRADE_ACCEPTED=2568;E.TRADE_CLOSED=1373;E.TRADE_COMPLETED=1001;E.TRADE_CONFIRMATION=2720;E.TRADE_LIST_ITEM=2024;E.TRADE_NOT_OPEN=3128;E.TRADE_OPEN=2505;E.TRADE_OPEN_FAILED=217;E.TRADE_OTHER_NOT_ALLOWED=1254;E.TRADE_YOU_NOT_ALLOWED=3058;E.TRADE_NO_SUCH_ITEM=2873;E.UNIT=374;E.UNIT_CHANGE_NAME=2182;E.UNIT_CHAT=1446;E.UNIT_CHAT_SHOUT=1036;E.UNIT_CHAT_WHISPER=2704;E.UNIT_DANCE=2233;E.UNIT_EFFECT=1167;E.UNIT_EXPRESSION=1631;E.UNIT_HAND_ITEM=1474;E.UNIT_IDLE=1797;E.UNIT_INFO=3920;E.UNIT_NUMBER=2324;E.UNIT_REMOVE=2661;E.UNIT_STATUS=1640;E.UNIT_TYPING=1717;E.UNSEEN_ITEMS=2103;E.USER_ACHIEVEMENT_SCORE=1968;E.USER_BADGES=717;E.USER_BADGES_ADD=2493;E.USER_BADGES_CURRENT=1087;E.USER_BOT_REMOVE=233;E.USER_BOTS=3086;E.USER_CHANGE_NAME=118;E.USER_CLOTHING=1450;E.USER_CREDITS=3475;E.USER_CURRENCY=2018;E.ACTIVITY_POINT_NOTIFICATION=2275;E.USER_EFFECTS=340;E.USER_FAVORITE_ROOM=2524;E.USER_FAVORITE_ROOM_COUNT=151;E.USER_FIGURE=2429;E.USER_FURNITURE=994;E.USER_FURNITURE_ADD=104;E.USER_FURNITURE_POSTIT_PLACED=1501;E.USER_FURNITURE_REFRESH=3151;E.USER_FURNITURE_REMOVE=159;E.USER_HOME_ROOM=2875;E.ROOM_EVENT_CANCEL=3479;E.ROOM_EVENT=1840;E.USER_IGNORED=126;E.USER_IGNORED_RESULT=207;E.USER_INFO=2725;E.USER_OUTFITS=3315;E.USER_PERKS=2586;E.USER_PERMISSIONS=411;E.USER_PET_ADD=2101;E.USER_PET_REMOVE=3253;E.USER_PETS=3522;E.USER_PROFILE=3898;E.USER_RESPECT=2815;E.USER_SANCTION_STATUS=3679;E.USER_SETTINGS=513;E.USER_SUBSCRIPTION=954;E.USER_WARDROBE_PAGE=3315;E.USER_CLASSIFICATION=966;E.GET_USER_TAGS=1255;E.WIRED_ACTION=1434;E.WIRED_CONDITION=1108;E.WIRED_ERROR=156;E.WIRED_OPEN=1830;E.WIRED_REWARD=178;E.WIRED_SAVE=1155;E.WIRED_TRIGGER=383;E.PLAYING_GAME=448;E.FURNITURE_STATE_2=3431;E.REMOVE_BOT_FROM_INVENTORY=233;E.ADD_BOT_TO_INVENTORY=1352;E.ACHIEVEMENT_PROGRESSED=2107;E.MODTOOL_ROOM_INFO=1333;E.MODTOOL_USER_CHATLOG=3377;E.MODTOOL_ROOM_CHATLOG=3434;E.MODTOOL_VISITED_ROOMS_USER=1752;E.MODERATOR_ACTION_RESULT=2335;E.ISSUE_DELETED=3192;E.ISSUE_INFO=3609;E.ISSUE_PICK_FAILED=3150;E.CFH_CHATLOG=607;E.MODERATOR_TOOL_PREFERENCES=1576;E.LOVELOCK_FURNI_START=3753;E.LOVELOCK_FURNI_FRIEND_COMFIRMED=382;E.LOVELOCK_FURNI_FINISHED=770;E.GIFT_RECEIVER_NOT_FOUND=1517;E.GIFT_OPENED=56;E.FLOOD_CONTROL=566;E.REMAINING_MUTE=826;E.USER_EFFECT_LIST=340;E.USER_EFFECT_LIST_ADD=2867;E.USER_EFFECT_LIST_REMOVE=2228;E.USER_EFFECT_ACTIVATE=1959;E.AVATAR_EFFECT_SELECTED=3473;E.CLUB_GIFT_INFO=619;E.REDEEM_VOUCHER_ERROR=714;E.REDEEM_VOUCHER_OK=3336;E.IN_CLIENT_LINK=2023;E.BOT_COMMAND_CONFIGURATION=1618;E.BOT_SKILL_LIST_UPDATE=69;E.BOT_FORCE_OPEN_CONTEXT_MENU=296;E.HAND_ITEM_RECEIVED=354;E.PET_PLACING_ERROR=2913;E.BOT_ERROR=639;E.MARKETPLACE_SELL_ITEM=54;E.MARKETPLACE_ITEM_STATS=725;E.MARKETPLACE_OWN_ITEMS=3884;E.MARKETPLACE_CANCEL_SALE=3264;E.MARKETPLACE_ITEM_POSTED=1359;E.MARKETPLACE_ITEMS_SEARCHED=680;E.MARKETPLACE_AFTER_ORDER_STATUS=2032;E.CATALOG_RECEIVE_PET_BREEDS=3331;E.CATALOG_APPROVE_NAME_RESULT=1503;E.OBJECTS_DATA_UPDATE=1453;E.PET_EXPERIENCE=2156;E.COMMUNITY_GOAL_VOTE_EVENT=1435;E.PROMO_ARTICLES=286;E.COMMUNITY_GOAL_EARNED_PRIZES=3319;E.COMMUNITY_GOAL_PROGRESS=2525;E.CONCURRENT_USERS_GOAL_PROGRESS=2737;E.QUEST_DAILY=1878;E.QUEST_CANCELLED=3027;E.QUEST_COMPLETED=949;E.COMMUNITY_GOAL_HALL_OF_FAME=3005;E.EPIC_POPUP=3945;E.SEASONAL_QUESTS=1122;E.QUESTS=3625;E.QUEST=230;E.BONUS_RARE_INFO=1533;E.CRAFTABLE_PRODUCTS=1e3;E.CRAFTING_RECIPE=2774;E.CRAFTING_RECIPES_AVAILABLE=2124;E.CRAFTING_RESULT=618;E.CAMERA_PUBLISH_STATUS=2057;E.CAMERA_PURCHASE_OK=2783;E.CAMERA_STORAGE_URL=3696;E.CAMERA_SNAPSHOT=463;E.COMPETITION_STATUS=133;E.INIT_CAMERA=3878;E.THUMBNAIL_STATUS=3595;E.ACHIEVEMENT_NOTIFICATION=806;E.CLUB_GIFT_NOTIFICATION=2188;E.INTERSTITIAL_MESSAGE=1808;E.ROOM_AD_ERROR=1759;E.AVAILABILITY_TIME=600;E.HOTEL_CLOSED_AND_OPENS=3728;E.HOTEL_CLOSES_AND_OPENS_AT=2771;E.HOTEL_WILL_CLOSE_MINUTES=1050;E.HOTEL_MAINTENANCE=1350;E.JUKEBOX_PLAYLIST_FULL=105;E.JUKEBOX_SONG_DISKS=34;E.NOW_PLAYING=469;E.OFFICIAL_SONG_ID=1381;E.PLAYLIST=1748;E.PLAYLIST_SONG_ADDED=1140;E.TRAX_SONG_INFO=3365;E.USER_SONG_DISKS_INVENTORY=2602;E.CHECK_USER_NAME=563;E.CFH_SANCTION=2782;E.CFH_TOPICS=325;E.CFH_SANCTION_STATUS=2221;E.CAMPAIGN_CALENDAR_DATA=2531;E.CAMPAIGN_CALENDAR_DOOR_OPENED=2551;E.BUILDERS_CLUB_FURNI_COUNT=3828;E.BUILDERS_CLUB_SUBSCRIPTION=1452;E.CATALOG_PAGE_EXPIRATION=2668;E.CATALOG_EARLIEST_EXPIRY=2515;E.CLUB_GIFT_SELECTED=659;E.TARGET_OFFER_NOT_FOUND=1237;E.TARGET_OFFER=119;E.DIRECT_SMS_CLUB_BUY=195;E.ROOM_AD_PURCHASE=2468;E.NOT_ENOUGH_BALANCE=3914;E.LIMITED_OFFER_APPEARING_NEXT=44;E.IS_OFFER_GIFTABLE=761;E.CLUB_EXTENDED_OFFER=3964;E.SEASONAL_CALENDAR_OFFER=1889;E.COMPETITION_ENTRY_SUBMIT=1177;E.COMPETITION_VOTING_INFO=3506;E.COMPETITION_TIMING_CODE=1745;E.COMPETITION_USER_PART_OF=3841;E.COMPETITION_NO_OWNED_ROOMS=2064;E.COMPETITION_SECONDS_UNTIL=3926;E.BADGE_POINT_LIMITS=2501;E.BADGE_REQUEST_FULFILLED=2998;E.HELPER_TALENT_TRACK=3406;E.TALENT_TRACK_LEVEL=1203;E.TALENT_TRACK_LEVEL_UP=638;E.USER_BANNED=1683;E.BOT_RECEIVED=3684;E.PET_LEVEL_NOTIFICATION=859;E.PET_RECEIVED=1111;E.MODERATION_CAUTION=1890;E.YOUTUBE_CONTROL_VIDEO=1554;E.YOUTUBE_DISPLAY_PLAYLISTS=1112;E.YOUTUBE_DISPLAY_VIDEO=1411;E.CFH_DISABLED_NOTIFY=1651;E.QUESTION=2665;E.POLL_CONTENTS=2997;E.POLL_ERROR=662;E.POLL_OFFER=3785;E.POLL_ROOM_RESULT=5201;E.POLL_START_ROOM=5200;E.QUESTION_ANSWERED=2589;E.QUESTION_FINISHED=1066;E.CFH_PENDING_CALLS=1121;E.GUIDE_ON_DUTY_STATUS=1548;E.GUIDE_SESSION_ATTACHED=1591;E.GUIDE_SESSION_DETACHED=138;E.GUIDE_SESSION_ENDED=1456;E.GUIDE_SESSION_ERROR=673;E.GUIDE_SESSION_INVITED_TO_GUIDE_ROOM=219;E.GUIDE_SESSION_MESSAGE=841;E.GUIDE_SESSION_PARTNER_IS_TYPING=1016;E.GUIDE_SESSION_REQUESTER_ROOM=1847;E.GUIDE_SESSION_STARTED=3209;E.GUIDE_TICKET_CREATION_RESULT=3285;E.GUIDE_TICKET_RESOLUTION=2674;E.GUIDE_REPORTING_STATUS=3463;E.HOTEL_MERGE_NAME_CHANGE=1663;E.ISSUE_CLOSE_NOTIFICATION=934;E.QUIZ_DATA=2927;E.QUIZ_RESULTS=2772;E.CFH_PENDING_CALLS_DELETED=77;E.CFH_REPLY=3796;E.CHAT_REVIEW_SESSION_DETACHED=30;E.CHAT_REVIEW_SESSION_OFFERED_TO_GUIDE=735;E.CHAT_REVIEW_SESSION_RESULTS=3276;E.CHAT_REVIEW_SESSION_STARTED=143;E.CHAT_REVIEW_SESSION_VOTING_STATUS=1829;E.SCR_SEND_KICKBACK_INFO=3277;E.PET_STATUS=1907;E.GROUP_DEACTIVATE=3129;E.PET_RESPECTED=2788;E.PET_SUPPLEMENT=3441;E.NOOBNESS_LEVEL=3738;E.DISCONNECT_REASON=4e3;E.CAN_CREATE_ROOM_EVENT=2599;E.FAVORITE_GROUP_UDPATE=3403;E.NO_SUCH_FLAT=84;E.ROOM_SETTINGS_ERROR=2897;E.SHOW_ENFORCE_ROOM_CATEGORY=3896;E.CUSTOM_USER_NOTIFICATION=909;E.NEW_USER_EXPERIENCE_GIFT_OFFER=3575;E.RESTORE_CLIENT=426;E.FIREWORK_CHARGE_DATA=5210;E.NEW_USER_EXPERIENCE_NOT_COMPLETE=3639;E.CONNECTION_ERROR=1004;E.ACCOUNT_SAFETY_LOCK_STATUS_CHANGE=1243;E.PHONE_COLLECTION_STATE=2890;E.PHONE_TRY_NUMBER_RESULT=800;E.PHONE_TRY_VERIFICATION_CODE_RESULT=91;E.EXTENDED_PROFILE_CHANGED=876;E.WELCOME_GIFT_CHANGE_EMAIL_RESULT=2293;E.WELCOME_GIFT_STATUS=2707;E.HANDSHAKE_INIT_DIFFIE=1347;E.HANDSHAKE_COMPLETE_DIFFIE=3885;E.RENTABLE_SPACE_RENT_OK=2046;E.RENTABLE_SPACE_STATUS=3559;E.RENTABLE_SPACE_RENT_FAILED=1868;E.EMAIL_STATUS=612;E.CHANGE_EMAIL_RESULT=1815;E.WEEKLY_GAME_REWARD=2641;E.WEEKLY_GAME_REWARD_WINNERS=3097;E.WEEKLY_COMPETITIVE_LEADERBOARD=3512;E.WEEKLY_COMPETITIVE_FRIENDS_LEADERBOARD=3560;E.WEEKLY_GAME2_FRIENDS_LEADERBOARD=2270;E.WEEKLY_GAME2_LEADERBOARD=2196;E.RENTABLE_FURNI_RENT_OR_BUYOUT_OFFER=35;E.HANDSHAKE_IDENTITY_ACCOUNT=3523;class rj extends R{constructor(t){super(t,kU)}getParser(){return this.parser}}class nj extends R{constructor(t){super(t,jU)}getParser(){return this.parser}}class aj extends R{constructor(t){super(t,zU)}getParser(){return this.parser}}class oj extends R{constructor(t){super(t,WU)}getParser(){return this.parser}}class hj extends R{constructor(t){super(t,XU)}getParser(){return this.parser}}class uj extends R{constructor(t){super(t,KU)}getParser(){return this.parser}}class lj extends R{constructor(t){super(t,qU)}getParser(){return this.parser}}class _j extends R{constructor(t){super(t,ZU)}getParser(){return this.parser}}class UT extends R{constructor(t){super(t,JU)}getParser(){return this.parser}}class cj extends R{constructor(t){super(t,$U)}getParser(){return this.parser}}class dj extends R{constructor(t){super(t,tx)}getParser(){return this.parser}}class fj extends R{constructor(t){super(t,ex)}getParser(){return this.parser}}class gj extends R{constructor(t){super(t,sx)}getParser(){return this.parser}}class Ej extends R{constructor(t){super(t,B1)}getParser(){return this.parser}}class pj extends R{constructor(t){super(t,V1)}getParser(){return this.parser}}class mj extends R{constructor(t){super(t,H1)}getParser(){return this.parser}}class Ij extends R{constructor(t){super(t,k1)}getParser(){return this.parser}}class Tj extends R{constructor(t){super(t,j1)}getParser(){return this.parser}}class xT extends R{constructor(t){super(t,z1)}getParser(){return this.parser}}class Rj extends R{constructor(t){super(t,Y1)}getParser(){return this.parser}}class Oj extends R{constructor(t){super(t,W1)}getParser(){return this.parser}}class Aj extends R{constructor(t){super(t,X1)}getParser(){return this.parser}}class vj extends R{constructor(t){super(t,K1)}getParser(){return this.parser}}class Sj extends R{constructor(t){super(t,q1)}getParser(){return this.parser}}class yj extends R{constructor(t){super(t,Z1)}getParser(){return this.parser}}class Cj extends R{constructor(t){super(t,Q1)}getParser(){return this.parser}}class Mj extends R{constructor(t){super(t,$1)}get userID(){return this.getParser().userID}get userAccepts(){return this.getParser().userAccepts}getParser(){return this.parser}}class Nj extends R{constructor(t){super(t,dT)}get userID(){return this.getParser().userID}getParser(){return this.parser}}class Pj extends R{constructor(t){super(t,tF)}getParser(){return this.parser}}class bj extends R{constructor(t){super(t,eF)}getParser(){return this.parser}}class Dj extends R{constructor(t){super(t,sF)}get firstUserID(){return this.getParser().firstUserID}get secondUserID(){return this.getParser().secondUserID}get firstUserNumItems(){return this.getParser().firstUserNumItems}get secondUserNumItems(){return this.getParser().secondUserNumItems}get firstUserNumCredits(){return this.getParser().firstUserNumCredits}get secondUserNumCredits(){return this.getParser().secondUserNumCredits}get firstUserItemArray(){return this.getParser().firstUserItemArray}get secondUserItemArray(){return this.getParser().secondUserItemArray}getParser(){return this.parser}}class Lj extends R{constructor(t){super(t,iF)}getParser(){return this.parser}}class Uj extends R{constructor(t){super(t,rF)}getParser(){return this.parser}}class xj extends R{constructor(t){super(t,nF)}get userID(){return this.getParser().userID}get userCanTrade(){return this.getParser().userCanTrade}get otherUserID(){return this.getParser().otherUserID}get otherUserCanTrade(){return this.getParser().otherUserCanTrade}getParser(){return this.parser}}class Fj extends R{constructor(t){super(t,Hf)}getParser(){return this.parser}}class wj extends R{constructor(t){super(t,aF)}getParser(){return this.parser}}class Gj extends R{constructor(t){super(t,oF)}getParser(){return this.parser}}class Bj extends R{constructor(t){super(t,IG)}getParser(){return this.parser}}class Hj extends R{constructor(t){super(t,TG)}getParser(){return this.parser}}class Vj extends R{constructor(t){super(t,RG)}getParser(){return this.parser}}class kj extends R{constructor(t){super(t,OG)}getParser(){return this.parser}}class jj extends R{constructor(t){super(t,AG)}getParser(){return this.parser}}class zj extends R{constructor(t){super(t,vG)}getParser(){return this.parser}}class Yj extends R{constructor(t){super(t,yG)}getParser(){return this.parser}}class Wj extends R{constructor(t){super(t,SG)}getParser(){return this.parser}}class Xj extends R{constructor(t){super(t,kl)}getParser(){return this.parser}}class Kj extends R{constructor(t){super(t,TT)}getParser(){return this.parser}}class qj extends R{constructor(t){super(t,NG)}getParser(){return this.parser}}class Zj extends R{constructor(t){super(t,PG)}getParser(){return this.parser}}class Qj extends R{constructor(t){super(t,RT)}getParser(){return this.parser}}class Jj extends R{constructor(t){super(t,DG)}getParser(){return this.parser}}class $j extends R{constructor(t){super(t,UG)}getParser(){return this.parser}}class t3 extends R{constructor(t){super(t,LG)}getParser(){return this.parser}}class e3 extends R{constructor(t){super(t,FG)}getParser(){return this.parser}}class s3 extends R{constructor(t){super(t,wG)}getParser(){return this.parser}}class i3 extends R{constructor(t){super(t,HG)}getParser(){return this.parser}}class r3 extends R{constructor(t){super(t,VG)}getParser(){return this.parser}}class n3 extends R{constructor(t){super(t,jG)}getParser(){return this.parser}}class a3 extends R{constructor(t){super(t,zG)}getParser(){return this.parser}}class o3 extends R{constructor(t){super(t,XG)}getParser(){return this.parser}}class h3 extends R{constructor(t){super(t,KG)}getParser(){return this.parser}}class u3 extends R{constructor(t){super(t,ZG)}getParser(){return this.parser}}class l3 extends R{constructor(t){super(t,QG)}getParser(){return this.parser}}class _3 extends R{constructor(t){super(t,JG)}getParser(){return this.parser}}class FT extends R{constructor(t){super(t,$G)}getParser(){return this.parser}}class c3 extends R{constructor(t){super(t,tB)}getParser(){return this.parser}}class d3 extends R{constructor(t){super(t,zf)}getParser(){return this.parser}}class f3 extends R{constructor(t){super(t,eB)}getParser(){return this.parser}}class g3 extends R{constructor(t){super(t,uB)}getParser(){return this.parser}}class E3 extends R{constructor(t){super(t,lB)}getParser(){return this.parser}}class p3 extends R{constructor(t){super(t,_B)}getParser(){return this.parser}}class wT extends R{constructor(t){super(t,cB)}getParser(){return this.parser}get userName(){return this.getParser().userName}}class m3 extends R{constructor(t){super(t,dB)}getParser(){return this.parser}}class I3 extends R{constructor(t){super(t,fB)}getParser(){return this.parser}}class rd extends R{constructor(t){super(t,gB)}getParser(){return this.parser}}class T3 extends R{constructor(t){super(t,EB)}getParser(){return this.parser}}class nd extends R{constructor(t){super(t,pB)}getParser(){return this.parser}}class R3 extends R{constructor(t){super(t,mB)}getParser(){return this.parser}}class O3 extends R{constructor(t){super(t,TB)}getParser(){return this.parser}}class A3 extends R{constructor(t){super(t,OB)}getParser(){return this.parser}}class v3 extends R{constructor(t){super(t,vB)}getParser(){return this.parser}}class S3 extends R{constructor(t){super(t,SB)}getParser(){return this.parser}}class y3 extends R{constructor(t){super(t,yB)}getParser(){return this.parser}}class C3 extends R{constructor(t){super(t,CB)}getParser(){return this.parser}}class M3 extends R{constructor(t){super(t,MB)}getParser(){return this.parser}}class N3 extends R{constructor(t){super(t,NB)}getParser(){return this.parser}}class P3 extends R{constructor(t){super(t,DB)}getParser(){return this.parser}}class b3 extends R{constructor(t){super(t,LB)}getParser(){return this.parser}}class D3 extends R{constructor(t){super(t,UB)}getParser(){return this.parser}}class L3 extends R{constructor(t){super(t,xB)}getParser(){return this.parser}}class U3 extends R{constructor(t){super(t,FB)}getParser(){return this.parser}}class x3 extends R{constructor(t){super(t,wB)}getParser(){return this.parser}}class F3 extends R{constructor(t){super(t,GB)}getParser(){return this.parser}}class w3 extends R{constructor(t){super(t,BB)}getParser(){return this.parser}}class G3 extends R{constructor(t){super(t,VB)}getParser(){return this.parser}}class B3 extends R{constructor(t){super(t,kB)}getParser(){return this.parser}}class GT extends R{constructor(t){super(t,jB)}getParser(){return this.parser}}class H3 extends R{constructor(t){super(t,zB)}getParser(){return this.parser}}class V3 extends R{constructor(t){super(t,YB)}getParser(){return this.parser}}class k3 extends R{constructor(t){super(t,WB)}getParser(){return this.parser}}class j3 extends R{constructor(t){super(t,XB)}getParser(){return this.parser}}class z3 extends R{constructor(t){super(t,KB)}getParser(){return this.parser}}class Y3 extends R{constructor(t){super(t,qB)}getParser(){return this.parser}}class W3 extends R{constructor(t){super(t,ZB)}getParser(){return this.parser}}class X3 extends R{constructor(t){super(t,QB)}getParser(){return this.parser}}class K3 extends R{constructor(t){super(t,JB)}getParser(){return this.parser}}class BT extends R{constructor(t){super(t,$B)}getParser(){return this.parser}}class q3 extends R{constructor(t){super(t,t2)}getParser(){return this.parser}}class Z3 extends R{constructor(t){super(t,e2)}getParser(){return this.parser}}class Q3 extends R{constructor(t){super(t,s2)}getParser(){return this.parser}}class J3{constructor(t){this._itemName=t.readString(),this._extraInfo=t.readString(),this._extraInfo==""&&(this._extraInfo=null)}get itemName(){return this._itemName}get extraInfo(){return this._extraInfo}}class $3{constructor(t){this._thumbnailUrl=t.readString(),this._thumbnailUrl==""&&(this._thumbnailUrl=null),this._productOfferList=[];const e=t.readInt();let i=0;for(;i<e;)this._productOfferList.push(new J3(t)),i++}get productOfferList(){return this._productOfferList}get thumbnailUrl(){return this._thumbnailUrl}}class tz{flush(){return!0}parse(t){if(!t)return!1;const e=t.readInt();this._giftOptions=[];let i=0;for(;i<e;)this._giftOptions.push(new iz(t)),i++;return!0}get giftOptions(){return this._giftOptions}}class ez{flush(){return!0}parse(t){return!!t}}class sz extends R{constructor(t){super(t,tz)}getParser(){return this.parser}}class iz{constructor(t){this._dayIndex=t.readInt(),this._stepIndex=t.readInt(),this._options=[];const e=t.readInt();let i=0;for(;i<e;)this._options.push(new $3(t)),i++}get dayIndex(){return this._dayIndex}get stepIndex(){return this._stepIndex}get options(){return this._options}}class rz extends R{constructor(t){super(t,ez)}getParser(){return this.parser}}class nz extends R{constructor(t){super(t,r2)}getParser(){return this.parser}}class az extends R{constructor(t){super(t,wl)}getParser(){return this.parser}}class HT extends R{constructor(t){super(t,n2)}getParser(){return this.parser}}class VT extends R{constructor(t){super(t,a2)}getParser(){return this.parser}}class kT extends R{constructor(t){super(t,o2)}getParser(){return this.parser}}class jT extends R{constructor(t){super(t,h2)}getParser(){return this.parser}}class oz extends R{constructor(t){super(t,u2)}getParser(){return this.parser}}class zT extends R{constructor(t){super(t,c2)}getParser(){return this.parser}}class YT extends R{constructor(t){super(t,d2)}getParser(){return this.parser}}class WT extends R{constructor(t){super(t,f2)}getParser(){return this.parser}}class XT extends R{constructor(t){super(t,g2)}getParser(){return this.parser}}class KT extends R{constructor(t){super(t,p2)}getParser(){return this.parser}}class qT extends R{constructor(t){super(t,E2)}getParser(){return this.parser}}class ZT extends R{constructor(t){super(t,m2)}getParser(){return this.parser}}class QT extends R{constructor(t){super(t,I2)}getParser(){return this.parser}}class hz extends R{constructor(t){super(t,O2)}getParser(){return this.parser}}class uz extends R{constructor(t){super(t,S2)}getParser(){return this.parser}}class lz extends R{constructor(t){super(t,y2)}getParser(){return this.parser}}class _z extends R{constructor(t){super(t,C2)}getParser(){return this.parser}}class cz extends R{constructor(t){super(t,M2)}getParser(){return this.parser}}class dz extends R{constructor(t){super(t,N2)}getParser(){return this.parser}}class fz extends R{constructor(t){super(t,P2)}getParser(){return this.parser}}class gz extends R{constructor(t){super(t,b2)}getParser(){return this.parser}}class Ez extends R{constructor(t){super(t,D2)}getParser(){return this.parser}}class pz extends R{constructor(t){super(t,L2)}getParser(){return this.parser}}class mz extends R{constructor(t){super(t,U2)}getParser(){return this.parser}}class Wf extends R{constructor(t){super(t,x2)}getParser(){return this.parser}}Wf.FINISHED_OK=1;Wf.FINISHED_FAIL=2;class Yl extends R{constructor(t){super(t,F2)}getParser(){return this.parser}}Yl.SYSTEM_STATUS_ENABLED=1;Yl.SYSTEM_STATUS_DISABLED=2;Yl.SYSTEM_STATUS_TIMEOUT=3;class ad extends R{constructor(t){super(t,ix)}getParser(){return this.parser}}class od extends R{constructor(t){super(t,rx)}getParser(){return this.parser}}class hd extends R{constructor(t){super(t,ax)}getParser(){return this.parser}}class ud extends R{constructor(t){super(t,nx)}getParser(){return this.parser}}class Iz extends R{constructor(t){super(t,Eh)}getParser(){return this.parser}}class ld extends R{constructor(t){super(t,ox)}getParser(){return this.parser}}class Tz extends R{constructor(t){super(t,hx)}getParser(){return this.parser}}class Rz extends R{constructor(t){super(t,ux)}getParser(){return this.parser}}class Oz extends R{constructor(t){super(t,lx)}getParser(){return this.parser}}class Az extends R{constructor(t){super(t,cx)}getParser(){return this.parser}}class vz extends R{constructor(t){super(t,yx)}getParser(){return this.parser}}class Sz extends R{constructor(t){super(t,Cx)}getParser(){return this.parser}}class yz extends R{constructor(t){super(t,Mx)}getParser(){return this.parser}}class JT extends R{constructor(t){super(t,Nx)}getParser(){return this.parser}}class _d extends R{constructor(t){super(t,o1)}getParser(){return this.parser}}class cd extends R{constructor(t){super(t,h1)}getParser(){return this.parser}}class Cz extends R{constructor(t){super(t,bx)}getParser(){return this.parser}}class dd extends R{constructor(t){super(t,Dx)}getParser(){return this.parser}}class fd extends R{constructor(t){super(t,Lx)}getParser(){return this.parser}}class gd extends R{constructor(t){super(t,Ux)}getParser(){return this.parser}}class Ed extends R{constructor(t){super(t,xx)}getParser(){return this.parser}}class pd extends R{constructor(t){super(t,Fx)}getParser(){return this.parser}}class Mz extends R{constructor(t){super(t,wx)}getParser(){return this.parser}}class md extends R{constructor(t){super(t,Gx)}getParser(){return this.parser}}class Id extends R{constructor(t){super(t,Vr)}getParser(){return this.parser}}class Nz extends R{constructor(t){super(t,Bx)}getParser(){return this.parser}}class Pz extends R{constructor(t){super(t,Hx)}getParser(){return this.parser}}class Td extends R{constructor(t){super(t,Vx)}getParser(){return this.parser}}class bz extends R{constructor(t){super(t,kx)}getParser(){return this.parser}}class Dz extends R{constructor(t){super(t,jx)}getParser(){return this.parser}}class Lz extends R{constructor(t){super(t,zx)}getParser(){return this.parser}}class Rd extends R{constructor(t){super(t,Yx)}getParser(){return this.parser}}class Uz extends R{constructor(t){super(t,Wx)}getParser(){return this.parser}}class xz extends R{constructor(t){super(t,Xx)}getParser(){return this.parser}}class Fz extends R{constructor(t){super(t,Ks)}getParser(){return this.parser}}class wz extends R{constructor(t){super(t,Kx)}getParser(){return this.parser}}class $T extends R{constructor(t){super(t,Zx)}getParser(){return this.parser}}class Gz extends R{constructor(t){super(t,Qx)}getParser(){return this.parser}}class Od extends R{constructor(t){super(t,Jx)}getParser(){return this.parser}}class Ad extends R{constructor(t){super(t,$x)}getParser(){return this.parser}}class vd extends R{constructor(t){super(t,t1)}getParser(){return this.parser}}class Sd extends R{constructor(t){super(t,e1)}getParser(){return this.parser}}class Bz extends R{constructor(t){super(t,s1)}getParser(){return this.parser}}class Hz extends R{constructor(t){super(t,i1)}getParser(){return this.parser}}class Vz extends R{constructor(t){super(t,n1)}getParser(){return this.parser}}class kz extends R{constructor(t){super(t,a1)}getParser(){return this.parser}}class yd extends R{constructor(t){super(t,wf)}getParser(){return this.parser}}class Cd extends R{constructor(t){super(t,u1)}getParser(){return this.parser}}class Md extends R{constructor(t){super(t,Pr)}getParser(){return this.parser}}class Nd extends R{constructor(t){super(t,l1)}getParser(){return this.parser}}class jz extends R{constructor(t){super(t,_1)}getParser(){return this.parser}}class Pd extends R{constructor(t){super(t,c1)}getParser(){return this.parser}}class Pa extends R{constructor(t){super(t,d1)}getParser(){return this.parser}}class bd extends R{constructor(t){super(t,f1)}getParser(){return this.parser}}class tR extends R{constructor(t){super(t,g1)}getParser(){return this.parser}}class eR extends R{constructor(t){super(t,E1)}getParser(){return this.parser}}class Ju extends R{constructor(t){super(t,p1)}getParser(){return this.parser}}class sR extends R{constructor(t){super(t,m1)}getParser(){return this.parser}}class iR extends R{constructor(t){super(t,I1)}getParser(){return this.parser}}class rR extends R{constructor(t){super(t,R1)}getParser(){return this.parser}}class nR extends R{constructor(t){super(t,O1)}getParser(){return this.parser}}class aR extends R{constructor(t){super(t,A1)}getParser(){return this.parser}}class oR extends R{constructor(t){super(t,v1)}getParser(){return this.parser}}class Xf extends R{constructor(t){super(t,Gf)}getParser(){return this.parser}}class $u extends R{constructor(t){super(t,Gf)}getParser(){return this.parser}}class tl extends R{constructor(t){super(t,Gf)}getParser(){return this.parser}}class Dd extends R{constructor(t){super(t,S1)}getParser(){return this.parser}}class el extends R{constructor(t){super(t,y1)}getParser(){return this.parser}}class Ld extends R{constructor(t){super(t,C1)}getParser(){return this.parser}}class sl extends R{constructor(t){super(t,U1)}getParser(){return this.parser}}class Ud extends R{constructor(t){super(t,M1)}getParser(){return this.parser}}class xd extends R{constructor(t){super(t,N1)}getParser(){return this.parser}}class hR extends R{constructor(t){super(t,P1)}getParser(){return this.parser}}class Fd extends R{constructor(t){super(t,b1)}getParser(){return this.parser}}class il extends R{constructor(t){super(t,D1)}getParser(){return this.parser}}class wd extends R{constructor(t){super(t,L1)}getParser(){return this.parser}}class rl extends R{constructor(t){super(t,x1)}getParser(){return this.parser}}class Gd extends R{constructor(t){super(t,G1)}getParser(){return this.parser}}class zz extends R{constructor(t){super(t,H2)}getParser(){return this.parser}}class Yz extends R{constructor(t){super(t,V2)}getParser(){return this.parser}}class Wz extends R{constructor(t){super(t,k2)}getParser(){return this.parser}}class Xz extends R{constructor(t){super(t,j2)}getParser(){return this.parser}}class Kf extends R{constructor(t){super(t,z2)}getParser(){return this.parser}}Kf.PRODUCT_DONATED_CODE=6;Kf.BADGE_DONATED_CODE=7;class Kz extends R{constructor(t){super(t,Y2)}getParser(){return this.parser}}class qz extends R{constructor(t){super(t,W2)}getParser(){return this.parser}}class Zz extends R{constructor(t){super(t,fx)}getParser(){return this.parser}}class Qz extends R{constructor(t){super(t,Ex)}getParser(){return this.parser}}class Jz extends R{constructor(t){super(t,px)}getParser(){return this.parser}}class $z extends R{constructor(t){super(t,mx)}getParser(){return this.parser}}class tY extends R{constructor(t){super(t,Ix)}getParser(){return this.parser}}class eY extends R{constructor(t){super(t,Tx)}getParser(){return this.parser}}class sY extends R{constructor(t){super(t,Rx)}getParser(){return this.parser}}class iY extends R{constructor(t){super(t,Ox)}getParser(){return this.parser}}class rY extends R{constructor(t){super(t,Ax)}getParser(){return this.parser}}class nY extends R{constructor(t){super(t,fs)}getParser(){return this.parser}}class aY extends R{constructor(t){super(t,vx)}getParser(){return this.parser}}class oY extends R{constructor(t){super(t,Sx)}getParser(){return this.parser}}class uR extends R{constructor(t){super(t,X2)}getParser(){return this.parser}}class lR extends R{constructor(t){super(t,K2)}getParser(){return this.parser}}class _R extends R{constructor(t){super(t,q2)}getParser(){return this.parser}}class cR extends R{constructor(t){super(t,Z2)}getParser(){return this.parser}}class hY extends R{constructor(t){super(t,Q2)}getParser(){return this.parser}}class uY extends R{constructor(t){super(t,J2)}getParser(){return this.parser}}class lY extends R{constructor(t){super(t,$2)}getParser(){return this.parser}}class dR extends R{constructor(t){super(t,eH)}getParser(){return this.parser}}class fR extends R{constructor(t){super(t,sH)}getParser(){return this.parser}}class _Y extends R{constructor(t){super(t,iH)}getParser(){return this.parser}}class cY extends R{constructor(t){super(t,nH)}getParser(){return this.parser}}class dY extends R{constructor(t){super(t,oH)}getParser(){return this.parser}}class gR extends R{constructor(t){super(t,IU)}getParser(){return this.parser}}class ER extends R{constructor(t){super(t,Ul)}getParser(){return this.parser}}class fY extends R{constructor(t){super(t,TU)}getParser(){return this.parser}}class gY extends R{constructor(t){super(t,oT)}getParser(){return this.parser}}class EY extends R{constructor(t){super(t,OU)}getParser(){return this.parser}}class pR extends R{constructor(t){super(t,AU)}getParser(){return this.parser}}class nl extends R{constructor(t){super(t,SU)}getParser(){return this.parser}}class qf extends R{constructor(t){super(t,yU)}getParser(){return this.parser}}class pY extends R{constructor(t){super(t,CU)}getParser(){return this.parser}}class mY extends R{constructor(t){super(t,MU)}getParser(){return this.parser}}class mR extends R{constructor(t){super(t,NU)}getParser(){return this.parser}}class IR extends R{constructor(t){super(t,PU)}getParser(){return this.parser}}class IY extends R{constructor(t){super(t,bU)}getParser(){return this.parser}}class TY extends R{constructor(t){super(t,DU)}getParser(){return this.parser}}class RY extends R{constructor(t){super(t,LU)}getParser(){return this.parser}}class OY extends R{constructor(t){super(t,uT)}getParser(){return this.parser}}class AY extends R{constructor(t){super(t,UU)}getParser(){return this.parser}}class vY extends R{constructor(t){super(t,xU)}getParser(){return this.parser}}class TR extends R{constructor(t){super(t,FU)}getParser(){return this.parser}}class SY extends R{constructor(t){super(t,lT)}getParser(){return this.parser}}class RR extends R{constructor(t){super(t,wU)}getParser(){return this.parser}}class Zf extends R{constructor(t){super(t,GU)}getParser(){return this.parser}}class OR extends R{constructor(t){super(t,BU)}getParser(){return this.parser}}class yY extends R{constructor(t){super(t,HU)}getParser(){return this.parser}}class CY extends R{constructor(t){super(t,VU)}getParser(){return this.parser}}class MY extends R{constructor(t){super(t,gh)}getParser(){return this.parser}}const qn=class{constructor(s){this._type=s.readInt(),this._userId=s.readInt(),this._userName=s.readString(),this._figure=s.readString(),this._memberSince=s.readString()}get userId(){return this._userId}get userName(){return this._userName}get admin(){return this._type==qn.TYPE_ADMIN}get owner(){return this._type==qn.TYPE_OWNER}get pending(){return this._type==qn.TYPE_PENDING}get member(){return this._type!=qn.TYPE_MEMBER}get blocked(){return this._type==qn.TYPE_BLOCKED}get figure(){return this._figure}get memberSince(){return this._memberSince}};let Ha=qn;Ha.TYPE_OWNER=0;Ha.TYPE_ADMIN=1;Ha.TYPE_PENDING=2;Ha.TYPE_MEMBER=3;Ha.TYPE_BLOCKED=4;class AR extends R{constructor(t){super(t,hF)}getParser(){return this.parser}}class vR extends R{constructor(t){super(t,uF)}getParser(){return this.parser}}class SR extends R{constructor(t){super(t,lF)}getParser(){return this.parser}}class NY extends R{constructor(t){super(t,dF)}getParser(){return this.parser}}class PY extends R{constructor(t){super(t,fF)}getParser(){return this.parser}}class bY extends R{constructor(t){super(t,gF)}getParser(){return this.parser}}class DY extends R{constructor(t){super(t,uH)}getParser(){return this.parser}}class LY{constructor(){this._data=[]}dispose(){}getMessageArray(){return this._data}}class UY{constructor(){this._data=[]}dispose(){}getMessageArray(){return this._data}}class xY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class FY{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class wY{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class GY{constructor(t=0){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class BY{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class HY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class VY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class kY{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class al{constructor(t="",e="",i="",r=-1,n=-1){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=[]}assignBitmap(t){const e=qt.generateImageUrl(t);if(!e)return;const i=e.split(",")[1],r=Uint8Array.from(atob(i),n=>n.charCodeAt(0));this._data.push(r.byteLength,r.buffer)}assignBase64(t){const e=t.split(",")[1],i=Uint8Array.from(atob(e),r=>r.charCodeAt(0));this._data.push(i.byteLength,i.buffer)}}class Bd extends al{constructor(t="",e="",i="",r=-1,n=-1){super(t,e,i,r,n)}}class jY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class zY{constructor(t,e){this._data=[t,e]}dispose(){this._data=null}getMessageArray(){return this._data}}class YY{constructor(t,e){this._data=[t,e]}dispose(){this._data=null}getMessageArray(){return this._data}}class WY{constructor(t,e,i,r,n,a){this._data=[t,e,i,r,n,a]}dispose(){this._data=null}getMessageArray(){return this._data}}class XY{constructor(t,e,i,r){this._data=[t,e,i,r]}dispose(){this._data=null}getMessageArray(){return this._data}}class KY{constructor(){this._data=[]}dispose(){this._data=null}getMessageArray(){return this._data}}class qY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class ZY{constructor(){this._data=[]}dispose(){this._data=null}getMessageArray(){return this._data}}class QY{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class JY{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class $Y{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class t5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class e5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class s5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){this._data=null}}class i5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){this._data=null}}class r5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class n5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class a5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class o5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){this._data=null}}class h5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class u5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){this._data=null}}class l5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class _5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class c5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class d5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class f5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class g5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class E5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){this._data=null}}class p5{constructor(t,e,i,r,n,a,o,h,u){this._data=[t,e,i,r,n,a,o,h,u]}getMessageArray(){return this._data}dispose(){}}class m5{constructor(t,e,i,r){this._data=[t,e,i,r]}getMessageArray(){return this._data}dispose(){}}class I5{constructor(t,e,i,r,n,a,o){this._data=[t,e,i,r,n,a,o]}getMessageArray(){return this._data}dispose(){}}class T5{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class R5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class O5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class A5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class v5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class S5{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class y5{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class C5{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class M5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class N5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class P5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class b5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class D5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class L5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Sh{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}Sh.CONFIRM_LEVEL_NOT_ACCEPTED=0;Sh.CONFIRM_LEVEL_NOT_SUBMITTED=1;Sh.CONFIRM_LEVEL_NOT_CONFIRMED=2;Sh.CONFIRM_LEVEL_COMMIT=3;class U5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class x5{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class F5{constructor(t,e){this._data=[t,e.length].concat(e)}getMessageArray(){return this._data}dispose(){}}class w5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class G5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class B5{constructor(t,e){this._data=[t,e.length].concat(e)}getMessageArray(){return this._data}dispose(){}}class H5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class V5{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class k5{constructor(...t){this._data=[t.length,...t]}getMessageArray(){return this._data}dispose(){}}class j5{constructor(t,...e){this._data=[t,e.length,...e]}getMessageArray(){return this._data}dispose(){}}class z5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Y5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class W5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class X5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class K5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class q5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Z5{constructor(...t){this._data=[t.length,...t]}getMessageArray(){return this._data}dispose(){}}class Q5{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class J5{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class $5{constructor(t,e){this._data=[e.length,...e,t]}getMessageArray(){return this._data}dispose(){}}class tW{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class eW{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class sW{constructor(t=!0){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class iW{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class rW{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class nW{constructor(){this._data=[]}dispose(){this._data=null}getMessageArray(){return this._data}}class aW{constructor(){this._data=[]}dispose(){this._data=null}getMessageArray(){return this._data}}class oW{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class hW{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class uW{constructor(t,e){this._data=[t,e]}dispose(){this._data=null}getMessageArray(){return this._data}}class lW{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class _W{constructor(){this._data=[]}dispose(){this._data=null}getMessageArray(){return this._data}}class cW{constructor(){this._data=[]}dispose(){this._data=null}getMessageArray(){return this._data}}class dW{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class yR{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class fW{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class gW{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class EW{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class pW{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class mW{constructor(t,e,i,r,n,a){this._data=[t,e,i,r,n,a]}dispose(){this._data=null}getMessageArray(){return this._data}}class IW{constructor(t,e,i,r,n,a){this._data=[t,e,i,r,n,a]}dispose(){this._data=null}getMessageArray(){return this._data}}class TW{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class RW{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class CR{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}CR.NO_ISSUE_ID=-1;class OW{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class MR{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}MR.NO_ISSUE_ID=-1;class AW{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class vW{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class SW{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class yW{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class CW{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class MW{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class NW{constructor(t,e,i,r,n,a){this._data=[t,e,i,r,n,a.length,...a]}getMessageArray(){return this._data}dispose(){}}class PW{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class bW{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class DW{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class LW{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class UW{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class xW{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class FW{constructor(t,e,i,r){this._data=[t,e,i,r]}getMessageArray(){return this._data}dispose(){}}class wW{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class GW{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class BW{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class HW{constructor(t,e){this._data=[t,e.length,...e]}getMessageArray(){return this._data}dispose(){}}class VW{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class kW{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class jW{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class zW{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class YW{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class WW{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class XW{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class KW{constructor(t,e,i,r){this._data=[t,e,i,r]}getMessageArray(){return this._data}dispose(){}}class qW{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class ZW{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class QW{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class JW{constructor(t,e,i,r){this._data=[t,e,i,r]}getMessageArray(){return this._data}dispose(){}}class $W{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class t4{constructor(t,e,i,r){this._data=[t,e,i,r]}getMessageArray(){return this._data}dispose(){}}class e4{constructor(...t){this._data=[t.length],t.forEach(e=>{this._data.push(e.k),this._data.push(e._arg_2),this._data.push(e._arg_3)})}getMessageArray(){return this._data}dispose(){}}class s4{constructor(t,e,i,r,n){this._data=[t,e,i,r,n]}getMessageArray(){return this._data}dispose(){}}class i4{constructor(t,e,i,r){this._data=[t,e,r,i]}getMessageArray(){return this._data}dispose(){}}class r4{constructor(t,e,i){if(this._type=t,e.length===i.length){this._data=[];for(let r=0;r<e.length;r++)this._data.push(e[r]),this._data.push(i[r])}}getMessageArray(){return this._data}dispose(){}}class NR{constructor(t,e,i,r){this._data=[`NITRO-${Pl.RENDERER_VERSION.replaceAll(".","-")}`,"HTML5",Cl.HTML5,Sf.BROWSER]}getMessageArray(){return this._data}dispose(){}}class n4{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class a4{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class PR{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class o4{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class bR{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class DR{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class h4{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class u4{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class l4{constructor(t,e,i,r,n){this._data=[t,e,i,r,n]}getMessageArray(){return this._data}dispose(){}}class _4{constructor(t,e,i,r){this._data=[t,e,i,r]}getMessageArray(){return this._data}dispose(){}}class c4{constructor(t,e,i,r){this._data=[t,e,i,r.length/2,...r]}getMessageArray(){return this._data}dispose(){}}class d4{constructor(t,e,i,r,n){this._data=[t,e,i,r,n]}getMessageArray(){return this._data}dispose(){}}class f4{constructor(t,e,i,r,n){this._data=[t,e,i,r,n]}getMessageArray(){return this._data}dispose(){}}class g4{constructor(t,e,i,r,n){this._data=[t,e,i,r,n.length/2,...n]}getMessageArray(){return this._data}dispose(){}}class E4{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class p4{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class m4{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class I4{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class T4{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class R4{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class O4{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class A4{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class v4{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class S4{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class y4{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class C4{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class M4{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class N4{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class P4{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class b4{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class D4{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class L4{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class U4{constructor(t,e,i,r){this._data=[t,e,i,r]}getMessageArray(){return this._data}dispose(){}}class x4{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class F4{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class w4{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class G4{constructor(t,e){this._data=[t,e.length,...e]}getMessageArray(){return this._data}dispose(){}}class B4{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class H4{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class V4{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class k4{constructor(){this._data=[]}dispose(){this._data=null}getMessageArray(){return this._data}}class j4{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class z4{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class Y4{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class W4{constructor(){this._badges=[]}getMessageArray(){const t=[];for(let e=1;e<=this._badges.length;e++)t.push(e),t.push(this._badges[e-1]);return t}dispose(){}addActivatedBadge(t){this._badges.push(t)}}class up{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class X4{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class K4{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class q4{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class Z4{constructor(t,e,i,r){this._data=[t,e,i,r]}getMessageArray(){return this._data}dispose(){}}class lp{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Q4{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class J4{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class $4{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class tX{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class eX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class sX{constructor(...t){this._data=[t.length,...t]}getMessageArray(){return this._data}dispose(){}}class iX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class rX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class nX{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class aX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class oX{constructor(t,...e){this._data=[t,e.length,...e]}getMessageArray(){return this._data}dispose(){}}class hX{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class uX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class lX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){this._data=null}}class _X{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class cX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){this._data=null}}class dX{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class fX{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class gX{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){this._data=null}}class EX{constructor(t,e,i,r){this._data=[t,e,i,r]}getMessageArray(){return this._data}dispose(){this._data=null}}class pX{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class mX{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class IX{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class TX{constructor(t,e,i){this._data=[t,e.length,...e,i]}getMessageArray(){return this._data}dispose(){}}class Wl{constructor(t,e){this._data=[e,t.length,...t]}getMessageArray(){return this._data}dispose(){}}Wl.RESOLUTION_USELESS=1;Wl.RESOLUTION_ABUSIVE=2;Wl.RESOLUTION_RESOLVED=3;const LR=class{constructor(s,t,e,i,r,n=-1){this._data=[s,t,e,i,r],n!=LR.NO_ISSUE_ID&&this._data.push(n)}getMessageArray(){return this._data}dispose(){}};let jr=LR;jr.NO_ISSUE_ID=-1;class RX{constructor(t,e,i,r=-1){this._data=[t,e,i],r!=jr.NO_ISSUE_ID&&this._data.push(r)}getMessageArray(){return this._data}dispose(){}}class OX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class AX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class vX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class SX{constructor(t,e=0){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class yX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class CX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class MX{constructor(t,e,i,r=-1){this._data=[t,e,i],r!=jr.NO_ISSUE_ID&&this._data.push(r)}getMessageArray(){return this._data}dispose(){}}class NX{constructor(t,e,i,r){this._data=[t,e,i,r]}getMessageArray(){return this._data}dispose(){}}class yh{constructor(t,e,i){this._data=[],this._data.push(t),this._data.push(e),this._data.push(i)}getMessageArray(){return this._data}dispose(){}}yh.ACTION_ALERT=0;yh.ACTION_KICK=1;yh.ACTION_MESSAGE=3;yh.ACTION_MESSAGE_AND_SOFT_KICK=4;class PX{constructor(t,e,i,r=-1){this._data=[t,e,i],r!=jr.NO_ISSUE_ID&&this._data.push(r)}getMessageArray(){return this._data}dispose(){}}class bX{constructor(t,e,i,r=-1){this._data=[],this._data.push(t),this._data.push(e),this._data.push(""),this._data.push(""),this._data.push(i),r!=jr.NO_ISSUE_ID&&this._data.push(r)}getMessageArray(){return this._data}dispose(){}}class DX{constructor(t,e,i,r=-1){this._data=[t,e,i],r!=jr.NO_ISSUE_ID&&this._data.push(r)}getMessageArray(){return this._data}dispose(){}}class LX{constructor(t,e,i,r){this._data=[t,e,i,r]}getMessageArray(){return this._data}dispose(){}}class UX{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class xX{constructor(t,e,i,r,n=-1){this._data=[t,e,i,r],n!=jr.NO_ISSUE_ID&&this._data.push(n)}getMessageArray(){return this._data}dispose(){}}class FX{constructor(t,e,i,r){this._data=[t.length,...t,e,i,r]}getMessageArray(){return this._data}dispose(){}}class wX{constructor(t){this._data=[t.length,...t]}getMessageArray(){return this._data}dispose(){}}class GX{constructor(t){this._data=[t]}dispose(){this._data=null}getMessageArray(){return this._data}}class BX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class HX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class VX{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class kX{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class jX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class zX{constructor(t,e,i,r,n,a){this._data=[t,e,i,r,n,a]}getMessageArray(){return this._data}dispose(){}}class YX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class WX{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class XX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class KX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class qX{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class ZX{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class QX{constructor(t,e,i){this._data=[t,e?1:0,i?1:0]}getMessageArray(){return this._data}dispose(){}}class JX{constructor(t=0){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class $X{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class t6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class e6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class s6{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class i6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class r6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class n6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class a6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class o6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class h6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class u6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class l6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class _6{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class c6{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class d6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class f6{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class g6{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class E6{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class p6{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class m6{constructor(t,e,i,r,n,a){this._data=[t,e,i,r,n,a]}getMessageArray(){return this._data}dispose(){}}class I6{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class T6{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class R6{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class O6{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class A6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class v6{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class S6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class y6{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class C6{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class M6{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class N6{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class P6{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class b6{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class D6{constructor(t,e,i,r){this._data=[t,e,i,r]}getMessageArray(){return this._data}dispose(){}}class L6{constructor(...t){this._data=[t.length*3],t.forEach(e=>{this._data.push(e.dayIndex),this._data.push(e.stepIndex),this._data.push(e.giftIndex)})}dispose(){this._data=null}getMessageArray(){return this._data}}class UR{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class f{}f.ACHIEVEMENT_LIST=219;f.AUTHENTICATION=-1;f.BOT_CONFIGURATION=1986;f.BOT_PICKUP=3323;f.BOT_PLACE=1592;f.BOT_SKILL_SAVE=2624;f.GET_CLUB_OFFERS=3285;f.GET_CLUB_GIFT_INFO=487;f.GET_CATALOG_INDEX=1195;f.GET_CATALOG_PAGE=412;f.CATALOG_PURCHASE=3492;f.CATALOG_PURCHASE_GIFT=1411;f.GET_PRODUCT_OFFER=2594;f.CLIENT_LATENCY=295;f.CLIENT_LATENCY_MEASURE=96;f.CLIENT_POLICY=26979;f.CLIENT_PONG=2596;f.CLIENT_TOOLBAR_TOGGLE=2313;f.CLIENT_VARIABLES=1053;f.GET_CURRENT_TIMING_CODE=2912;f.DESKTOP_NEWS=1827;f.DESKTOP_VIEW=105;f.GET_BUNDLE_DISCOUNT_RULESET=223;f.EVENT_TRACKER=3457;f.FIND_NEW_FRIENDS=516;f.FURNITURE_ALIASES=3898;f.FURNITURE_FLOOR_UPDATE=248;f.FURNITURE_MULTISTATE=99;f.FURNITURE_PICKUP=3456;f.FURNITURE_PLACE=1258;f.FURNITURE_POSTIT_PLACE=2248;f.FURNITURE_POSTIT_SAVE_STICKY_POLE=3283;f.FURNITURE_RANDOMSTATE=3617;f.FURNITURE_WALL_MULTISTATE=210;f.FURNITURE_WALL_UPDATE=168;f.GAMES_INIT=2914;f.GAMES_LIST=741;f.ACCEPTGAMEINVITE=3802;f.GAMEUNLOADEDMESSAGE=3207;f.GETGAMEACHIEVEMENTSMESSAGE=2399;f.GETGAMESTATUSMESSAGE=3171;f.GETUSERGAMEACHIEVEMENTSMESSAGE=389;f.JOINQUEUEMESSAGE=1458;f.LEAVEQUEUEMESSAGE=2384;f.RESETRESOLUTIONACHIEVEMENTMESSAGE=3144;f.GETWEEKLYGAMEREWARDWINNERS=1054;f.GAME2GETACCOUNTGAMESTATUSMESSAGE=11;f.GAME2CHECKGAMEDIRECTORYSTATUSMESSAGE=3259;f.GAME2EXITGAMEMESSAGE=1445;f.GAME2GAMECHATMESSAGE=2502;f.GAME2LOADSTAGEREADYMESSAGE=2415;f.GAME2PLAYAGAINMESSAGE=3196;f.GAME2REQUESTFULLSTATUSUPDATEMESSAGE=1598;f.GAME2GETWEEKLYFRIENDSLEADERBOARD=1232;f.GAME2GETWEEKLYLEADERBOARD=2565;f.GET_GIFT_WRAPPING_CONFIG=418;f.GROUP_ADMIN_ADD=2894;f.GROUP_ADMIN_REMOVE=722;f.GROUP_CREATE_OPTIONS=798;f.GROUP_FAVORITE=3549;f.GET_FORUM_STATS=3149;f.GET_FORUM_THREADS=873;f.GET_FORUMS_LIST=436;f.GET_FORUM_MESSAGES=232;f.GET_FORUM_THREAD=3900;f.GET_UNREAD_FORUMS_COUNT=2908;f.FORUM_MODERATE_MESSAGE=286;f.FORUM_MODERATE_THREAD=1397;f.FORUM_POST_MESSAGE=3529;f.UPDATE_FORUM_READ_MARKER=1855;f.UPDATE_FORUM_SETTINGS=2214;f.FORUM_UPDATE_THREAD=3045;f.GROUP_INFO=2991;f.GROUP_DELETE=1134;f.GROUP_MEMBER_REMOVE_CONFIRM=3593;f.GROUP_MEMBER_REMOVE=593;f.GROUP_MEMBERS=312;f.GROUP_MEMBERSHIPS=367;f.GROUP_REQUEST=998;f.GROUP_REQUEST_ACCEPT=3386;f.GROUP_REQUEST_DECLINE=1894;f.GROUP_SETTINGS=1004;f.GROUP_PARTS=813;f.GROUP_BUY=230;f.GROUP_SAVE_INFORMATION=3137;f.GROUP_SAVE_BADGE=1991;f.GROUP_SAVE_COLORS=1764;f.GROUP_SAVE_PREFERENCES=3435;f.GROUP_BADGES=21;f.GROUP_UNBLOCK_MEMBER=2864;f.GET_BADGE_POINTS_LIMITS=1371;f.REQUESTABADGE=3077;f.GETISBADGEREQUESTFULFILLED=1364;f.ITEM_CLOTHING_REDEEM=3374;f.ITEM_COLOR_WHEEL_CLICK=2144;f.ITEM_DICE_CLICK=1990;f.ITEM_DICE_CLOSE=1533;f.ITEM_DIMMER_SAVE=1648;f.ITEM_DIMMER_SETTINGS=2813;f.ITEM_DIMMER_TOGGLE=2296;f.ITEM_EXCHANGE_REDEEM=3115;f.ITEM_PAINT=711;f.SET_OBJECT_DATA=3608;f.ITEM_STACK_HELPER=3839;f.ITEM_WALL_CLICK=210;f.ITEM_WALL_UPDATE=168;f.MARKETPLACE_CONFIG=2597;f.ACCEPT_FRIEND=137;f.MESSENGER_CHAT=3567;f.DECLINE_FRIEND=2890;f.FOLLOW_FRIEND=3997;f.MESSENGER_FRIENDS=1523;f.MESSENGER_INIT=2781;f.MESSENGER_RELATIONSHIPS=2138;f.SET_RELATIONSHIP_STATUS=3768;f.REMOVE_FRIEND=1689;f.REQUEST_FRIEND=3157;f.GET_FRIEND_REQUESTS=2448;f.SEND_ROOM_INVITE=1276;f.HABBO_SEARCH=1210;f.FRIEND_LIST_UPDATE=1419;f.MOD_TOOL_USER_INFO=3295;f.GET_USER_FLAT_CATS=3027;f.NAVIGATOR_INIT=2110;f.NAVIGATOR_SEARCH=249;f.NAVIGATOR_SEARCH_CLOSE=1834;f.NAVIGATOR_SEARCH_OPEN=637;f.NAVIGATOR_SEARCH_SAVE=2226;f.GET_USER_EVENT_CATS=1782;f.NAVIGATOR_SETTINGS_SAVE=3159;f.NAVIGATOR_CATEGORY_LIST_MODE=1202;f.NAVIGATOR_DELETE_SAVED_SEARCH=1954;f.PET_INFO=2934;f.PET_PICKUP=1581;f.PET_PLACE=2647;f.PET_RESPECT=3202;f.PET_RIDE=1036;f.PET_MOVE=3449;f.PET_OPEN_PACKAGE=3698;f.PET_SELECTED=549;f.PETS_BREED=1638;f.PET_CANCEL_BREEDING=2713;f.PET_CONFIRM_BREEDING=3382;f.GET_PET_TRAINING_PANEL=2161;f.RECYCLER_PRIZES=398;f.RECYCLER_STATUS=1342;f.RECYCLER_ITEMS=2771;f.RELEASE_VERSION=4e3;f.CALL_FOR_HELP=1691;f.ROOM_AMBASSADOR_ALERT=2996;f.ROOM_BAN_GIVE=1477;f.ROOM_BAN_LIST=2267;f.ROOM_BAN_REMOVE=992;f.ROOM_CREATE=2752;f.ROOM_DELETE=532;f.ROOM_DOORBELL=1644;f.ROOM_ENTER=2312;f.ROOM_FAVORITE=3817;f.ROOM_FAVORITE_REMOVE=309;f.CAN_CREATE_ROOM=2128;f.CANCEL_ROOM_EVENT=2725;f.EDIT_ROOM_EVENT=3991;f.COMPETITION_ROOM_SEARCH=433;f.FORWARD_TO_RANDOM_PROMOTED_ROOM=10;f.FORWARD_TO_SOME_ROOM=1703;f.GET_CATEGORIES_WITH_USER_COUNT=3782;f.GET_GUEST_ROOM=2230;f.GET_OFFICIAL_ROOMS=1229;f.GET_POPULAR_ROOM_TAGS=826;f.GUILD_BASE_SEARCH=2930;f.MY_FAVOURITE_ROOMS_SEARCH=2578;f.MY_FREQUENT_ROOM_HISTORY_SEARCH=1002;f.MY_FRIENDS_ROOM_SEARCH=2266;f.MY_GUILD_BASES_SEARCH=39;f.MY_RECOMMENDED_ROOMS=2537;f.MY_ROOM_HISTORY_SEARCH=2264;f.MY_ROOM_RIGHTS_SEARCH=272;f.MY_ROOMS_SEARCH=2277;f.POPULAR_ROOMS_SEARCH=2758;f.ROOM_AD_EVENT_TAB_CLICKED=2412;f.ROOM_AD_EVENT_TAB_VIEWED=2668;f.ROOM_AD_SEARCH=2809;f.ROOM_TEXT_SEARCH=3943;f.ROOMS_WHERE_MY_FRIENDS_ARE=1786;f.ROOMS_WITH_HIGHEST_SCORE_SEARCH=2939;f.SET_ROOM_SESSION_TAGS=3305;f.UPDATE_ROOM_THUMBNAIL=2468;f.ROOM_KICK=1320;f.ROOM_LIKE=3582;f.ROOM_MODEL=2300;f.GET_OCCUPIED_TILES=1687;f.GET_ROOM_ENTRY_TILE=3559;f.ROOM_MODEL_SAVE=875;f.ROOM_MUTE=3637;f.ROOM_MUTE_USER=3485;f.ROOM_RIGHTS_GIVE=808;f.ROOM_RIGHTS_LIST=3385;f.ROOM_RIGHTS_REMOVE=2064;f.ROOM_RIGHTS_REMOVE_ALL=2683;f.ROOM_RIGHTS_REMOVE_OWN=3182;f.ROOM_SETTINGS=3129;f.ROOM_SETTINGS_SAVE=1969;f.ROOM_SETTINGS_UPDATE_ROOM_CATEGORY_AND_TRADE=1265;f.ROOM_STAFF_PICK=1918;f.ROOM_FILTER_WORDS=1911;f.ROOM_FILTER_WORDS_MODIFY=3001;f.MYSTERYBOXWAITINGCANCELEDMESSAGE=2012;f.MYSTERYBOX_OPEN_TROPHY=3074;f.SECURITY_MACHINE=2490;f.SECURITY_TICKET=2419;f.TRADE=1481;f.TRADE_ACCEPT=3863;f.TRADE_CANCEL=2341;f.TRADE_CLOSE=2551;f.TRADE_CONFIRM=2760;f.TRADE_ITEM=3107;f.TRADE_ITEM_REMOVE=3845;f.TRADE_ITEMS=1263;f.TRADE_UNACCEPT=1444;f.UNIT_ACTION=2456;f.UNIT_CHAT=1314;f.UNIT_CHAT_SHOUT=2085;f.UNIT_CHAT_WHISPER=1543;f.UNIT_DANCE=2080;f.UNIT_DROP_HAND_ITEM=2814;f.UNIT_GIVE_HANDITEM=2941;f.UNIT_LOOK=3301;f.UNIT_POSTURE=2235;f.UNIT_SIGN=1975;f.UNIT_TYPING=1597;f.UNIT_TYPING_STOP=1474;f.UNIT_WALK=3320;f.USER_BADGES=2769;f.USER_BADGES_CURRENT=2091;f.USER_BADGES_CURRENT_UPDATE=644;f.USER_BOTS=3848;f.USER_CURRENCY=273;f.USER_EFFECT_ACTIVATE=2959;f.USER_EFFECT_ENABLE=1752;f.USER_FIGURE=2730;f.USER_FURNITURE=3150;f.REQUESTFURNIINVENTORYWHENNOTINROOM=3500;f.USER_HOME_ROOM=1740;f.USER_INFO=357;f.USER_MOTTO=2228;f.USER_IGNORED=3878;f.USER_PETS=3095;f.USER_PROFILE=3265;f.USER_PROFILE_BY_NAME=2249;f.USER_RESPECT=2694;f.GET_SOUND_SETTINGS=2388;f.USER_SETTINGS_CAMERA=1461;f.USER_SETTINGS_CHAT_STYLE=1030;f.USER_SETTINGS_INVITES=1086;f.USER_SETTINGS_OLD_CHAT=1262;f.USER_SETTINGS_VOLUME=1367;f.USER_SUBSCRIPTION=3166;f.GET_WARDROBE=2742;f.SAVE_WARDROBE_OUTFIT=800;f.USER_TAGS=17;f.PEER_USERS_CLASSIFICATION=1160;f.USER_CLASSIFICATION=2285;f.VISIT_USER=2970;f.WIRED_ACTION_SAVE=2281;f.WIRED_APPLY_SNAPSHOT=3373;f.WIRED_CONDITION_SAVE=3203;f.WIRED_OPEN=768;f.WIRED_TRIGGER_SAVE=1520;f.GET_ITEM_DATA=3964;f.ONE_WAY_DOOR_CLICK=2765;f.REMOVE_WALL_ITEM=3336;f.SET_ITEM_DATA=3666;f.CATALOG_REDEEM_VOUCHER=339;f.ROOM_TONER_APPLY=2880;f.FRIEND_FURNI_CONFIRM_LOCK=3775;f.MANNEQUIN_SAVE_NAME=2850;f.MANNEQUIN_SAVE_LOOK=2209;f.PRESENT_OPEN_PRESENT=3558;f.CATALOG_SELECT_VIP_GIFT=2276;f.USER_IGNORE_ID=3314;f.USER_IGNORE=1117;f.USER_UNIGNORE=2061;f.MODTOOL_REQUEST_ROOM_INFO=707;f.MODTOOL_CHANGE_ROOM_SETTINGS=3260;f.MODTOOL_REQUEST_USER_CHATLOG=1391;f.MODTOOL_REQUEST_ROOM_CHATLOG=2587;f.MODTOOL_SANCTION_ALERT=229;f.MODTOOL_SANCTION_BAN=2766;f.MODTOOL_SANCTION_KICK=2582;f.MODTOOL_SANCTION_TRADELOCK=3742;f.MODTOOL_ALERTEVENT=1840;f.MODTOOL_SANCTION_MUTE=1945;f.MODTOOL_REQUEST_USER_ROOMS=3526;f.MODTOOL_ROOM_ALERT=3842;f.MODTOOL_PREFERENCES=31;f.CLOSE_ISSUE_DEFAULT_ACTION=2717;f.CLOSE_ISSUES=2067;f.DEFAULT_SANCTION=1681;f.GET_CFH_CHATLOG=211;f.MODTOOL_SANCTION=1392;f.PICK_ISSUES=15;f.RELEASE_ISSUES=1572;f.CONVERT_GLOBAL_ROOM_ID=314;f.REQUEST_SELL_ITEM=848;f.REQUEST_MARKETPLACE_ITEM_STATS=3288;f.MARKETPLACE_SELL_ITEM=3447;f.MARKETPLACE_REQUEST_OWN_ITEMS=2105;f.MARKETPLACE_TAKE_BACK_ITEM=434;f.MARKETPLACE_REDEEM_CREDITS=2650;f.MARKETPLACE_REQUEST_OFFERS=2407;f.MARKETPLACE_BUY_OFFER=1603;f.MARKETPLACE_BUY_TOKENS=1866;f.CATALOG_REQUESET_PET_BREEDS=1756;f.APPROVE_NAME=2109;f.UNIT_GIVE_HANDITEM_PET=2768;f.PET_MOUNT=1036;f.PET_SUPPLEMENT=749;f.FURNITURE_GROUP_INFO=2651;f.ACHIEVEMENT_RESOLUTION_OPEN=359;f.USE_PET_PRODUCT=1328;f.REMOVE_PET_SADDLE=186;f.TOGGLE_PET_RIDING=1472;f.TOGGLE_PET_BREEDING=3379;f.UNSEEN_RESET_CATEGORY=3493;f.UNSEEN_RESET_ITEMS=2343;f.COMMUNITY_GOAL_VOTE_COMPOSER=3536;f.GET_PROMO_ARTICLES=1827;f.ACCEPT_QUEST=3604;f.ACTIVATE_QUEST=793;f.CANCEL_QUEST=3133;f.FRIEND_REQUEST_QUEST_COMPLETE=1148;f.GET_COMMUNITY_GOAL_EARNED_PRIZES=2688;f.GET_COMMUNITY_GOAL_HALL_OF_FAME=2167;f.GET_COMMUNITY_GOAL_PROGRESS=1145;f.GET_CONCURRENT_USERS_GOAL_PROGRESS=1343;f.GET_CONCURRENT_USERS_REWARD=3872;f.GET_DAILY_QUEST=2486;f.GET_QUESTS=3333;f.GET_SEASONAL_QUESTS_ONLY=1190;f.OPEN_QUEST_TRACKER=2750;f.REDEEM_COMMUNITY_GOAL_PRIZE=90;f.REJECT_QUEST=2397;f.START_CAMPAIGN=1697;f.GET_BONUS_RARE_INFO=957;f.CRAFT=3591;f.CRAFT_SECRET=1251;f.GET_CRAFTABLE_PRODUCTS=633;f.GET_CRAFTING_RECIPE=1173;f.GET_CRAFTING_RECIPES_AVAILABLE=3086;f.PHOTO_COMPETITION=3959;f.PUBLISH_PHOTO=2068;f.PURCHASE_PHOTO=2408;f.RENDER_ROOM=3226;f.RENDER_ROOM_THUMBNAIL=1982;f.REQUEST_CAMERA_CONFIGURATION=796;f.ADD_JUKEBOX_DISK=753;f.GET_JUKEBOX_PLAYLIST=1435;f.GET_NOW_PLAYING=1325;f.GET_OFFICIAL_SONG_ID=3189;f.GET_SONG_INFO=3082;f.GET_SOUND_MACHINE_PLAYLIST=3498;f.GET_USER_SONG_DISKS=2304;f.REMOVE_JUKEBOX_DISK=3050;f.INTERSTITIAL_SHOWN=1109;f.GET_INTERSTITIAL=2519;f.CHANGE_USERNAME=2977;f.CHECK_USERNAME=3950;f.OPEN_CAMPAIGN_CALENDAR_DOOR_STAFF=3889;f.OPEN_CAMPAIGN_CALENDAR_DOOR=2257;f.BUILDERS_CLUB_PLACE_ROOM_ITEM=1051;f.BUILDERS_CLUB_PLACE_WALL_ITEM=462;f.BUILDERS_CLUB_QUERY_FURNI_COUNT=2529;f.GET_CATALOG_PAGE_EXPIRATION=742;f.GET_CATALOG_PAGE_WITH_EARLIEST_EXP=3135;f.GET_DIRECT_CLUB_BUY_AVAILABLE=801;f.GET_HABBO_BASIC_MEMBERSHIP_EXTEND_OFFER=603;f.GET_HABBO_CLUB_EXTEND_OFFER=2462;f.GET_IS_OFFER_GIFTABLE=1347;f.GET_LIMITED_OFFER_APPEARING_NEXT=410;f.GET_NEXT_TARGETED_OFFER=596;f.GET_ROOM_AD_PURCHASE_INFO=1075;f.GET_SEASONAL_CALENDAR_DAILY_OFFER=3257;f.GET_TARGETED_OFFER=2487;f.MARK_CATALOG_NEW_ADDITIONS_PAGE_OPENED=2150;f.PURCHASE_BASIC_MEMBERSHIP_EXTENSION=2735;f.PURCHASE_ROOM_AD=777;f.PURCHASE_TARGETED_OFFER=1826;f.PURCHASE_VIP_MEMBERSHIP_EXTENSION=3407;f.ROOM_AD_PURCHASE_INITIATED=2283;f.SET_TARGETTED_OFFER_STATE=2041;f.SHOP_TARGETED_OFFER_VIEWED=3483;f.HELPER_TALENT_TRACK=196;f.TALENT_TRACK_GET_LEVEL=2127;f.FORWARD_TO_A_COMPETITION_ROOM=172;f.FORWARD_TO_A_SUBMITTABLE_ROOM=1450;f.FORWARD_TO_RANDOM_COMPETITION_ROOM=865;f.GET_IS_USER_PART_OF_COMPETITION=2077;f.GET_SECONDS_UNTIL=271;f.ROOM_COMPETITION_INIT=1334;f.SUBMIT_ROOM_TO_COMPETITION=2595;f.VOTE_FOR_ROOM=143;f.GET_GIFT=2436;f.RESET_PHONE_NUMBER_STATE=2741;f.SET_PHONE_NUMBER_VERIFICATION_STATUS=1379;f.TRY_PHONE_NUMBER=790;f.VERIFY_CODE=2721;f.CONTROL_YOUTUBE_DISPLAY_PLAYBACK=3005;f.GET_YOUTUBE_DISPLAY_STATUS=336;f.SET_YOUTUBE_DISPLAY_PLAYLIST=2069;f.GO_TO_FLAT=685;f.CHANGE_QUEUE=3093;f.CALL_FOR_HELP_FROM_FORUM_MESSAGE=1412;f.CALL_FOR_HELP_FROM_FORUM_THREAD=534;f.CALL_FOR_HELP_FROM_IM=2950;f.CALL_FOR_HELP_FROM_PHOTO=2492;f.CALL_FOR_HELP_FROM_SELFIE=2755;f.CHAT_REVIEW_GUIDE_DECIDES=3365;f.CHAT_REVIEW_GUIDE_DETACHED=2501;f.CHAT_REVIEW_GUIDE_VOTE=3961;f.CHAT_REVIEW_SESSION_CREATE=3060;f.DELETE_PENDING_CALLS_FOR_HELP=3605;f.GET_CFH_STATUS=2746;f.GET_FAQ_CATEGORY=3445;f.GET_FAQ_TEXT=1849;f.GET_GUIDE_REPORTING_STATUS=3786;f.GET_PENDING_CALLS_FOR_HELP=3267;f.GET_QUIZ_QUESTIONS=1296;f.GUIDE_SESSION_CREATE=3338;f.GUIDE_SESSION_FEEDBACK=477;f.GUIDE_SESSION_GET_REQUESTER_ROOM=1052;f.GUIDE_SESSION_GUIDE_DECIDES=1424;f.GUIDE_SESSION_INVITE_REQUESTER=234;f.GUIDE_SESSION_IS_TYPING=519;f.GUIDE_SESSION_MESSAGE=3899;f.GUIDE_SESSION_ON_DUTY_UPDATE=1922;f.GUIDE_SESSION_REPORT=3969;f.GUIDE_SESSION_REQUESTER_CANCELS=291;f.GUIDE_SESSION_RESOLVED=887;f.POST_QUIZ_ANSWERS=3720;f.SEARCH_FAQS=2031;f.POLL_ANSWER=3505;f.POLL_REJECT=1773;f.POLL_START=109;f.POLL_VOTE_COUNTER=6200;f.DISCONNECT=2445;f.SCR_GET_KICKBACK_INFO=869;f.COMPOST_PLANT=3835;f.HARVEST_PET=1521;f.SET_CLOTHING_CHANGE_DATA=924;f.GROUP_UNFAVORITE=1820;f.NEW_USER_EXPERIENCE_GET_GIFTS=1822;f.NEW_USER_EXPERIENCE_SCRIPT_PROCEED=1299;f.HANDSHAKE_INIT_DIFFIE=3110;f.HANDSHAKE_COMPLETE_DIFFIE=773;f.WELCOME_OPEN_GIFT=2638;f.WELCOME_GIFT_CHANGE_EMAIL=66;f.EMAIL_GET_STATUS=2557;f.EMAIL_CHANGE=3965;f.APPROVE_ALL_MEMBERSHIP_REQUESTS=882;f.RENTABLE_SPACE_CANCEL_RENT=1667;f.RENTABLE_SPACE_RENT=2946;f.RENTABLE_SPACE_STATUS=872;f.TRACKING_PERFORMANCE_LOG=3230;f.TRACKING_LAG_WARNING_REPORT=3847;f.ROOM_DIRECTORY_ROOM_NETWORK_OPEN_CONNECTION=3736;f.RENTABLE_EXTEND_RENT_OR_BUYOUT_STRIP_ITEM=2115;f.RENTABLE_EXTEND_RENT_OR_BUYOUT_FURNI=1071;f.RENTABLE_GET_RENT_OR_BUYOUT_OFFER=2518;class xR{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class Hd{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class FR{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class U6{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class wR{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class GR{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class BR{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class HR{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class VR{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class kR{constructor(t,e,i){this._data=[t,e,i.length,...i]}getMessageArray(){return this._data}dispose(){}}class jR{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class zR{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class YR{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class x6{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class F6{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class w6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class G6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class B6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class H6{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class V6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class k6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class j6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class z6{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class Y6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class W6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class X6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class K6{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class q6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Z6{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class Q6{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class J6{constructor(...t){this._data=[t.length],t.forEach(e=>{this._data.push(e.itemId)})}getMessageArray(){return this._data}dispose(){}}class WR{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class XR{constructor(t,e=null){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class $6{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class KR{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class qR{constructor(t,e=0,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class t8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class ZR{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class QR{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class JR{constructor(t,e,i=0){this._data=[t,i,e]}getMessageArray(){return this._data}dispose(){}}class $R{constructor(...t){this._data=[t.length,...t]}getMessageArray(){return this._data}dispose(){}}class e8{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class s8{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class i8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class r8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class n8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class a8{constructor(t,e,i,r,n,a,o,h,u,c,l,_,d,g,m,p,T,A,O,v,y,C,N,L){this._data=[],this._data.push(t,e,i,r,n,a,o),this._data.push(u.length,...u),this._data.push(c,l,_,d,g,m,p,T,A,O,v,y,C,N,L)}getMessageArray(){return this._data}dispose(){}}class tO{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class eO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class o8{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class sO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class iO extends sO{constructor(t){super(t)}}class rO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class nO extends sO{constructor(t){super(t)}}class Vd{constructor(t,e,i,r){this._data=[t,e,i,r]}getMessageArray(){return this._data}dispose(){}}class aO{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class oO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class hO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class uO{constructor(t,e,i=""){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class lO{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class _O{constructor(t,e){this._data=[t,e.size*2];for(const[i,r]of e.entries())this._data.push(i,r)}getMessageArray(){return this._data}dispose(){}}class h8{constructor(t,e,i,r){this._data=[t,e,i,r]}getMessageArray(){return this._data}dispose(){}}class cO{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class dO{constructor(t,e,i,r,n){this._data=[t,e,i,r,n]}getMessageArray(){return this._data}dispose(){}}class fO{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class u8{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class l8{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class kd{constructor(t,e,i,r){this._data=[t,e,i,r]}getMessageArray(){return this._data}dispose(){}}class gO{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class EO{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class pO{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class mO{constructor(t,e,i,r,n,a){this._itemId=t,this._category=e,this._wallLocation=i,this._x=r,this._y=n,this._direction=a}getMessageArray(){switch(this._category){case D.FLOOR:return[`${this._itemId} ${this._x} ${this._y} ${this._direction}`];case D.WALL:return[`${this._itemId} ${this._wallLocation} `];default:return[]}}dispose(){}}class _8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class IO{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class c8{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class TO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class RO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class OO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class d8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class Qf{constructor(t,e=0){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class AO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class vO{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class f8{constructor(t,e=-100){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class SO{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class g8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class E8{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class p8{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class yO{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class m8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class CO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class I8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class T8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class R8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class O8{constructor(t,e,i,r){this._data=[t,e,i,r]}getMessageArray(){return this._data}dispose(){}}class MO{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class A8{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class v8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class S8{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class y8{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class jd{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class C8{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class M8{constructor(t,e,i,r,n,a,o){this._data=[t,e,i,r,n,a,o]}getMessageArray(){return this._data}dispose(){}}class N8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class NO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class PO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class Jf{constructor(t,e=0){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class bO{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class P8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class DO{constructor(t,e,i){this._data=[t+" "+e,i]}getMessageArray(){return this._data}dispose(){}}class LO{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class UO{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class xO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class FO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class b8{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class D8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class L8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class wO{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class GO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class BO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class HO{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class Xl{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}Xl.STATE_START=0;Xl.STATE_CANCEL=1;Xl.STATE_ACCEPT=2;class U8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class x8{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class F8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class w8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class G8{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class B8{constructor(t,e,i,r,n,a){this._data=[t,e.length,...e,i,r.length,...r,n,a]}getMessageArray(){return this._data}dispose(){}}class H8{constructor(t,e,i,r,n){this._data=[t,e.length,...e,i,r.length,...r,n]}getMessageArray(){return this._data}dispose(){}}class V8{constructor(t,e,i,r,n){this._data=[t,e.length,...e,i,r.length,...r,n]}getMessageArray(){return this._data}dispose(){}}class k8{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class j8{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class VO{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class kO{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class z8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class jO{constructor(...t){this._data=[t.length].concat(t)}getMessageArray(){return this._data}dispose(){}}class Y8{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class W8{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class zO{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class X8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class K8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class q8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class Z8{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class Q8{constructor(t,e,i,r,n,a,o,h,u,c,l){this._data=[t,e,i,r,n,a,o,h,u,c,l]}getMessageArray(){return this._data}dispose(){}}class J8{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class $8{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class tK{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class eK{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class YO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class WO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class XO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class KO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class qO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class ZO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class sK{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class QO{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class iK{constructor(t,e=!0){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class rK{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class nK{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class JO{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class aK{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class oK{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class hK{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class uK{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class lK{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class _K{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class cK{constructor(t,e,i){this._data=[t,e,i]}getMessageArray(){return this._data}dispose(){}}class dK{constructor(t,e){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class $O{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class fK{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class tA{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class eA{constructor(t){this._data=[t]}getMessageArray(){return this._data}dispose(){}}class gK extends mi{constructor(t){super(),this._communication=t,this._handShaking=!1,this._didConnect=!1,this._pongInterval=null,this.onConnectionOpenedEvent=this.onConnectionOpenedEvent.bind(this),this.onConnectionClosedEvent=this.onConnectionClosedEvent.bind(this),this.onConnectionErrorEvent=this.onConnectionErrorEvent.bind(this),this.sendPong=this.sendPong.bind(this)}onInit(){const t=this._communication.connection;t&&(t.addEventListener(Oe.CONNECTION_OPENED,this.onConnectionOpenedEvent),t.addEventListener(Oe.CONNECTION_CLOSED,this.onConnectionClosedEvent),t.addEventListener(Oe.CONNECTION_ERROR,this.onConnectionErrorEvent)),this._communication.registerMessageEvent(new yT(this.onClientPingEvent.bind(this))),this._communication.registerMessageEvent(new uR(this.onAuthenticatedEvent.bind(this)))}onDispose(){const t=this._communication.connection;t&&(t.removeEventListener(Oe.CONNECTION_OPENED,this.onConnectionOpenedEvent),t.removeEventListener(Oe.CONNECTION_CLOSED,this.onConnectionClosedEvent),t.removeEventListener(Oe.CONNECTION_ERROR,this.onConnectionErrorEvent)),this._handShaking=!1,this.stopPonging(),super.onDispose()}onConnectionOpenedEvent(t){const e=this._communication.connection;e&&(this._didConnect=!0,this.dispatchCommunicationDemoEvent(Ve.CONNECTION_ESTABLISHED,e),rt.getValue("system.pong.manually",!1)&&this.startPonging(),this.startHandshake(e),e.send(new NR(null,null,null,null)),this.tryAuthentication(e))}onConnectionClosedEvent(t){const e=this._communication.connection;e&&(this.stopPonging(),this._didConnect&&this.dispatchCommunicationDemoEvent(Ve.CONNECTION_CLOSED,e))}onConnectionErrorEvent(t){const e=this._communication.connection;e&&(this.stopPonging(),this.dispatchCommunicationDemoEvent(Ve.CONNECTION_ERROR,e))}tryAuthentication(t){if(!t||!this.getSSO()){this.getSSO()||Y.error("Login without an SSO ticket is not supported"),this.dispatchCommunicationDemoEvent(Ve.CONNECTION_HANDSHAKE_FAILED,t);return}t.send(new DR(this.getSSO(),_t()))}onClientPingEvent(t){!t||!t.connection||this.sendPong(t.connection)}onAuthenticatedEvent(t){!t||!t.connection||(this.completeHandshake(t.connection),this.dispatchCommunicationDemoEvent(Ve.CONNECTION_AUTHENTICATED,t.connection),t.connection.send(new PR))}startHandshake(t){this.dispatchCommunicationDemoEvent(Ve.CONNECTION_HANDSHAKING,t),this._handShaking=!0}completeHandshake(t){this.dispatchCommunicationDemoEvent(Ve.CONNECTION_HANDSHAKED,t),this._handShaking=!1}startPonging(){this.stopPonging(),this._pongInterval=setInterval(this.sendPong,rt.getValue("system.pong.interval.ms",2e4))}stopPonging(){this._pongInterval&&(clearInterval(this._pongInterval),this._pongInterval=null)}sendPong(t=null){t=t||this._communication.connection||null,t&&t.send(new bR)}dispatchCommunicationDemoEvent(t,e){K.instance.events.dispatchEvent(new Ve(t,e))}getSSO(){return rt.getValue("sso.ticket",null)}}class EK{constructor(){this._events=new Map,this._composers=new Map,this.registerEvents(),this.registerComposers()}registerEvents(){this._events.set(E.INTERSTITIAL_MESSAGE,lH),this._events.set(E.ROOM_AD_ERROR,_H),this._events.set(E.AVAILABILITY_STATUS,vT),this._events.set(E.AVAILABILITY_TIME,cH),this._events.set(E.HOTEL_CLOSED_AND_OPENS,dH),this._events.set(E.HOTEL_CLOSES_AND_OPENS_AT,fH),this._events.set(E.HOTEL_WILL_CLOSE_MINUTES,gH),this._events.set(E.HOTEL_MAINTENANCE,EH),this._events.set(E.USER_CHANGE_NAME,zs),this._events.set(E.CHECK_USER_NAME,pH),this._events.set(E.USER_FIGURE,ST),this._events.set(E.USER_OUTFITS,mH),this._events.set(E.ADD_BOT_TO_INVENTORY,IH),this._events.set(E.USER_BOTS,TH),this._events.set(E.BOT_RECEIVED,RH),this._events.set(E.REMOVE_BOT_FROM_INVENTORY,OH),this._events.set(E.CFH_SANCTION,AH),this._events.set(E.CFH_TOPICS,vH),this._events.set(E.CFH_SANCTION_STATUS,SH),this._events.set(E.CAMERA_PUBLISH_STATUS,yH),this._events.set(E.CAMERA_PURCHASE_OK,CH),this._events.set(E.CAMERA_STORAGE_URL,NH),this._events.set(E.COMPETITION_STATUS,PH),this._events.set(E.INIT_CAMERA,bH),this._events.set(E.THUMBNAIL_STATUS,DH),this._events.set(E.CAMERA_SNAPSHOT,MH),this._events.set(E.CAMPAIGN_CALENDAR_DATA,LH),this._events.set(E.CAMPAIGN_CALENDAR_DOOR_OPENED,UH),this._events.set(E.BONUS_RARE_INFO,xH),this._events.set(E.BUILDERS_CLUB_FURNI_COUNT,FH),this._events.set(E.BUILDERS_CLUB_SUBSCRIPTION,wH),this._events.set(E.BUNDLE_DISCOUNT_RULESET,GH),this._events.set(E.CATALOG_PAGE_EXPIRATION,BH),this._events.set(E.CATALOG_PAGE,HH),this._events.set(E.CATALOG_PAGE_LIST,VH),this._events.set(E.CATALOG_EARLIEST_EXPIRY,kH),this._events.set(E.CATALOG_PUBLISHED,jH),this._events.set(E.CLUB_GIFT_INFO,zH),this._events.set(E.CLUB_GIFT_SELECTED,YH),this._events.set(E.DIRECT_SMS_CLUB_BUY,WH),this._events.set(E.GIFT_RECEIVER_NOT_FOUND,KH),this._events.set(E.GIFT_WRAPPER_CONFIG,qH),this._events.set(E.CLUB_EXTENDED_OFFER,ZH),this._events.set(E.CLUB_OFFERS,QH),this._events.set(E.IS_OFFER_GIFTABLE,JH),this._events.set(E.LIMITED_SOLD_OUT,$H),this._events.set(E.LIMITED_OFFER_APPEARING_NEXT,tV),this._events.set(E.NOT_ENOUGH_BALANCE,eV),this._events.set(E.PRODUCT_OFFER,sV),this._events.set(E.CATALOG_PURCHASE_ERROR,iV),this._events.set(E.CATALOG_PURCHASE_NOT_ALLOWED,rV),this._events.set(E.CATALOG_PURCHASE_OK,nV),this._events.set(E.ROOM_AD_PURCHASE,aV),this._events.set(E.SEASONAL_CALENDAR_OFFER,oV),this._events.set(E.CATALOG_RECEIVE_PET_BREEDS,hV),this._events.set(E.TARGET_OFFER,uV),this._events.set(E.TARGET_OFFER_NOT_FOUND,lV),this._events.set(E.REDEEM_VOUCHER_ERROR,_V),this._events.set(E.REDEEM_VOUCHER_OK,cV),this._events.set(E.CLIENT_PING,yT),this._events.set(E.COMPETITION_ENTRY_SUBMIT,dV),this._events.set(E.COMPETITION_VOTING_INFO,fV),this._events.set(E.COMPETITION_TIMING_CODE,gV),this._events.set(E.COMPETITION_USER_PART_OF,EV),this._events.set(E.COMPETITION_NO_OWNED_ROOMS,pV),this._events.set(E.COMPETITION_SECONDS_UNTIL,mV),this._events.set(E.CRAFTABLE_PRODUCTS,IV),this._events.set(E.CRAFTING_RECIPE,TV),this._events.set(E.CRAFTING_RECIPES_AVAILABLE,RV),this._events.set(E.CRAFTING_RESULT,OV),this._events.set(E.DESKTOP_VIEW,sd),this._events.set(E.MESSENGER_ACCEPT_FRIENDS,AV),this._events.set(E.MESSENGER_FIND_FRIENDS,vV),this._events.set(E.MESSENGER_FOLLOW_FAILED,SV),this._events.set(E.MESSENGER_FRIENDS,yV),this._events.set(E.MESSENGER_UPDATE,CV),this._events.set(E.MESSENGER_FRIEND_NOTIFICATION,MV),this._events.set(E.MESSENGER_REQUESTS,NV),this._events.set(E.MESSENGER_SEARCH,PV),this._events.set(E.MESSENGER_INSTANCE_MESSAGE_ERROR,bV),this._events.set(E.MESSENGER_MESSAGE_ERROR,DV),this._events.set(E.MESSENGER_INIT,LV),this._events.set(E.MESSENGER_MINIMAIL_NEW,UV),this._events.set(E.MESSENGER_MINIMAIL_COUNT,xV),this._events.set(E.MESSENGER_CHAT,FV),this._events.set(E.MESSENGER_REQUEST,CT),this._events.set(E.MESSENGER_INVITE_ERROR,wV),this._events.set(E.MESSENGER_INVITE,GV),this._events.set(E.ACHIEVEMENTRESOLUTIONCOMPLETED,WV),this._events.set(E.ACHIEVEMENTRESOLUTIONPROGRESS,XV),this._events.set(E.ACHIEVEMENTRESOLUTIONS,KV),this._events.set(E.LOAD_GAME_URL,MT),this._events.set(E.LOADGAME,sk),this._events.set(E.UNLOADGAME,ik),this._events.set(E.GAME_CENTER_GAME_LIST,QV),this._events.set(E.GAMESTATUSMESSAGE,JV),this._events.set(E.GAME_CENTER_ACHIEVEMENTS,rk),this._events.set(E.GAME_CENTER_STATUS,BV),this._events.set(E.GAME_CENTER_IN_ARENA_QUEUE,VV),this._events.set(E.GAME_CENTER_STOP_COUNTER,zV),this._events.set(E.GAME_CENTER_USER_LEFT_GAME,YV),this._events.set(E.GAME_CENTER_DIRECTORY_STATUS,HV),this._events.set(E.GAME_CENTER_STARTING_GAME_FAILED,jV),this._events.set(E.GAME_CENTER_JOINING_FAILED,kV),this._events.set(E.GAMEACHIEVEMENTS,qV),this._events.set(E.GAMEINVITE,ZV),this._events.set(E.JOINEDQUEUEMESSAGE,$V),this._events.set(E.JOININGQUEUEFAILED,tk),this._events.set(E.LEFTQUEUE,ek),this._events.set(E.WEEKLY_GAME_REWARD,uk),this._events.set(E.WEEKLY_GAME_REWARD_WINNERS,lk),this._events.set(E.WEEKLY_COMPETITIVE_LEADERBOARD,hk),this._events.set(E.WEEKLY_COMPETITIVE_FRIENDS_LEADERBOARD,ok),this._events.set(E.WEEKLY_GAME2_FRIENDS_LEADERBOARD,nk),this._events.set(E.WEEKLY_GAME2_LEADERBOARD,ak),this._events.set(E.GROUP_INFO,Ek),this._events.set(E.GROUP_MEMBER_REMOVE_CONFIRM,gk),this._events.set(E.GROUP_MEMBERS,pk),this._events.set(E.GROUP_CREATE_OPTIONS,fk),this._events.set(E.GROUP_BADGE_PARTS,NT),this._events.set(E.GROUP_SETTINGS,Ik),this._events.set(E.GROUP_PURCHASED,mk),this._events.set(E.GROUP_BADGES,TR),this._events.set(E.GROUP_DEACTIVATE,Tk),this._events.set(E.GROUP_MEMBERSHIP_REQUESTED,RY),this._events.set(E.GROUP_DETAILS_CHANGED,TY),this._events.set(E.GROUP_HABBO_JOIN_FAILED,SY),this._events.set(E.GROUP_FORUM_DATA,Rk),this._events.set(E.GROUP_FORUM_LIST,Ok),this._events.set(E.GROUP_FORUM_THREADS,Ak),this._events.set(E.GROUP_FORUM_POST,vk),this._events.set(E.GROUP_FORUM_POST_THREAD,Sk),this._events.set(E.GROUP_FORUM_THREAD_MESSAGES,yk),this._events.set(E.GROUP_FORUM_UNREAD_COUNT,Ck),this._events.set(E.GROUP_FORUM_UPDATE_MESSAGE,Mk),this._events.set(E.GROUP_FORUM_UPDATE_THREAD,Nk),this._events.set(E.CFH_DISABLED_NOTIFY,Uk),this._events.set(E.CFH_PENDING_CALLS_DELETED,xk),this._events.set(E.CFH_PENDING_CALLS,Fk),this._events.set(E.CFH_REPLY,wk),this._events.set(E.CFH_RESULT_MESSAGE,Gk),this._events.set(E.GUIDE_ON_DUTY_STATUS,zk),this._events.set(E.GUIDE_SESSION_ATTACHED,Wk),this._events.set(E.GUIDE_SESSION_DETACHED,Xk),this._events.set(E.GUIDE_SESSION_ENDED,bT),this._events.set(E.GUIDE_SESSION_ERROR,DT),this._events.set(E.GUIDE_SESSION_INVITED_TO_GUIDE_ROOM,Kk),this._events.set(E.GUIDE_SESSION_MESSAGE,qk),this._events.set(E.GUIDE_SESSION_PARTNER_IS_TYPING,Zk),this._events.set(E.GUIDE_SESSION_REQUESTER_ROOM,Qk),this._events.set(E.GUIDE_SESSION_STARTED,LT),this._events.set(E.GUIDE_TICKET_CREATION_RESULT,Jk),this._events.set(E.GUIDE_TICKET_RESOLUTION,$k),this._events.set(E.GUIDE_REPORTING_STATUS,Yk),this._events.set(E.HOTEL_MERGE_NAME_CHANGE,tj),this._events.set(E.ISSUE_CLOSE_NOTIFICATION,ej),this._events.set(E.QUIZ_DATA,sj),this._events.set(E.QUIZ_RESULTS,ij),this._events.set(E.CHAT_REVIEW_SESSION_DETACHED,Bk),this._events.set(E.CHAT_REVIEW_SESSION_OFFERED_TO_GUIDE,Hk),this._events.set(E.CHAT_REVIEW_SESSION_RESULTS,Vk),this._events.set(E.CHAT_REVIEW_SESSION_STARTED,kk),this._events.set(E.CHAT_REVIEW_SESSION_VOTING_STATUS,jk),this._events.set(E.ACHIEVEMENT_PROGRESSED,rj),this._events.set(E.ACHIEVEMENT_LIST,nj),this._events.set(E.USER_ACHIEVEMENT_SCORE,aj),this._events.set(E.USER_EFFECT_ACTIVATE,oj),this._events.set(E.USER_EFFECT_LIST_ADD,hj),this._events.set(E.USER_EFFECT_LIST_REMOVE,uj),this._events.set(E.USER_EFFECT_LIST,_j),this._events.set(E.AVATAR_EFFECT_SELECTED,lj),this._events.set(E.USER_BADGES,dj),this._events.set(E.USER_BADGES_ADD,cj),this._events.set(E.BADGE_POINT_LIMITS,UT),this._events.set(E.BADGE_REQUEST_FULFILLED,fj),this._events.set(E.USER_CLOTHING,gj),this._events.set(E.USER_FURNITURE_ADD,Ej),this._events.set(E.USER_FURNITURE,pj),this._events.set(E.USER_FURNITURE_REFRESH,mj),this._events.set(E.USER_FURNITURE_REMOVE,Ij),this._events.set(E.USER_FURNITURE_POSTIT_PLACED,Tj),this._events.set(E.USER_PETS,Sj),this._events.set(E.USER_PET_REMOVE,Cj),this._events.set(E.USER_PET_ADD,vj),this._events.set(E.PET_RECEIVED,yj),this._events.set(E.PET_PLACING_ERROR,BT),this._events.set(E.YOUTUBE_CONTROL_VIDEO,Hz),this._events.set(E.YOUTUBE_DISPLAY_PLAYLISTS,Vz),this._events.set(E.YOUTUBE_DISPLAY_VIDEO,kz),this._events.set(E.TRADE_ACCEPTED,Mj),this._events.set(E.TRADE_CLOSED,Nj),this._events.set(E.TRADE_COMPLETED,Pj),this._events.set(E.TRADE_CONFIRMATION,bj),this._events.set(E.TRADE_LIST_ITEM,Dj),this._events.set(E.TRADE_NOT_OPEN,Uj),this._events.set(E.TRADE_OPEN_FAILED,Fj),this._events.set(E.TRADE_OPEN,xj),this._events.set(E.TRADE_OTHER_NOT_ALLOWED,wj),this._events.set(E.TRADE_YOU_NOT_ALLOWED,Gj),this._events.set(E.TRADE_NO_SUCH_ITEM,Lj),this._events.set(E.COMMUNITY_GOAL_VOTE_EVENT,Hj),this._events.set(E.PROMO_ARTICLES,Bj),this._events.set(E.MARKETPLACE_AFTER_ORDER_STATUS,Vj),this._events.set(E.MARKETPLACE_CANCEL_SALE,kj),this._events.set(E.MARKETPLACE_SELL_ITEM,jj),this._events.set(E.MARKETPLACE_CONFIG,zj),this._events.set(E.MARKETPLACE_ITEM_STATS,Yj),this._events.set(E.MARKETPLACE_ITEM_POSTED,Wj),this._events.set(E.MARKETPLACE_ITEMS_SEARCHED,Xj),this._events.set(E.MARKETPLACE_OWN_ITEMS,Kj),this._events.set(E.USER_BANNED,h3),this._events.set(E.MODERATION_CAUTION,t3),this._events.set(E.MODTOOL_ROOM_INFO,i3),this._events.set(E.MODTOOL_USER_CHATLOG,u3),this._events.set(E.MODTOOL_ROOM_CHATLOG,a3),this._events.set(E.MODERATION_USER_INFO,n3),this._events.set(E.MODERATION_TOOL,e3),this._events.set(E.MODTOOL_VISITED_ROOMS_USER,o3),this._events.set(E.CFH_CHATLOG,qj),this._events.set(E.ISSUE_DELETED,Zj),this._events.set(E.ISSUE_INFO,Qj),this._events.set(E.ISSUE_PICK_FAILED,Jj),this._events.set(E.MODERATOR_ACTION_RESULT,$j),this._events.set(E.MODERATOR_MESSAGE,s3),this._events.set(E.MODERATOR_TOOL_PREFERENCES,r3),this._events.set(E.MYSTERY_BOX_KEYS,FT),this._events.set(E.GOTMYSTERYBOXPRIZEMESSAGE,_3),this._events.set(E.CANCELMYSTERYBOXWAITMESSAGE,l3),this._events.set(E.SHOWMYSTERYBOXWAITMESSAGE,c3),this._events.set(E.CAN_CREATE_ROOM,d3),this._events.set(E.CAN_CREATE_ROOM_EVENT,f3),this._events.set(E.CATEGORIES_WITH_VISITOR_COUNT,g3),this._events.set(E.COMPETITION_ROOMS_DATA,E3),this._events.set(E.CONVERTED_ROOM_ID,p3),this._events.set(E.ROOM_DOORBELL,wT),this._events.set(E.USER_FAVORITE_ROOM,m3),this._events.set(E.USER_FAVORITE_ROOM_COUNT,I3),this._events.set(E.ROOM_DOORBELL_REJECTED,rd),this._events.set(E.ROOM_CREATED,T3),this._events.set(E.ROOM_INFO,nd),this._events.set(E.GUEST_ROOM_SEARCH_RESULT,R3),this._events.set(E.USER_HOME_ROOM,A3),this._events.set(E.ROOM_EVENT_CANCEL,b3),this._events.set(E.ROOM_EVENT,D3),this._events.set(E.ROOM_INFO_UPDATED,U3),this._events.set(E.THUMBNAIL_UPDATE_RESULT,x3),this._events.set(E.NAVIGATOR_EVENT_CATEGORIES,F3),this._events.set(E.NAVIGATOR_CATEGORIES,w3),this._events.set(E.NAVIGATOR_COLLAPSED,O3),this._events.set(E.NAVIGATOR_LIFTED,v3),this._events.set(E.NAVIGATOR_METADATA,S3),this._events.set(E.NAVIGATOR_OPEN_ROOM_CREATOR,y3),this._events.set(E.NAVIGATOR_SEARCHES,C3),this._events.set(E.NAVIGATOR_SEARCH,M3),this._events.set(E.NAVIGATOR_SETTINGS,N3),this._events.set(E.GENERIC_ALERT,j3),this._events.set(E.MOTD_MESSAGES,Y3),this._events.set(E.NOTIFICATION_LIST,W3),this._events.set(E.UNSEEN_ITEMS,Q3),this._events.set(E.ACHIEVEMENT_NOTIFICATION,G3),this._events.set(E.INFO_FEED_ENABLE,z3),this._events.set(E.CLUB_GIFT_NOTIFICATION,H3),this._events.set(E.ACTIVITY_POINT_NOTIFICATION,B3),this._events.set(E.BOT_ERROR,GT),this._events.set(E.PET_LEVEL_NOTIFICATION,K3),this._events.set(E.NOTIFICATION_OFFER_REWARD_DELIVERED,X3),this._events.set(E.NOTIFICATION_SIMPLE_ALERT,Z3),this._events.set(E.NOTIFICATION_ELEMENT_POINTER,k3),this._events.set(E.USER_PERKS,nz),this._events.set(E.PET_TRAINING_PANEL,oz),this._events.set(E.PET_LEVEL_UPDATE,kT),this._events.set(E.PET_SCRATCH_FAILED,jT),this._events.set(E.PET_OPEN_PACKAGE_REQUESTED,HT),this._events.set(E.PET_OPEN_PACKAGE_RESULT,VT),this._events.set(E.PET_BREEDING_RESULT,tR),this._events.set(E.QUESTION,KT),this._events.set(E.POLL_CONTENTS,zT),this._events.set(E.POLL_ERROR,YT),this._events.set(E.POLL_OFFER,WT),this._events.set(E.POLL_START_ROOM,QT),this._events.set(E.QUESTION_ANSWERED,XT),this._events.set(E.QUESTION_FINISHED,qT),this._events.set(E.POLL_ROOM_RESULT,ZT),this._events.set(E.COMMUNITY_GOAL_EARNED_PRIZES,hz),this._events.set(E.COMMUNITY_GOAL_PROGRESS,lz),this._events.set(E.CONCURRENT_USERS_GOAL_PROGRESS,_z),this._events.set(E.QUEST_DAILY,gz),this._events.set(E.QUEST_CANCELLED,dz),this._events.set(E.QUEST_COMPLETED,fz),this._events.set(E.COMMUNITY_GOAL_HALL_OF_FAME,uz),this._events.set(E.EPIC_POPUP,cz),this._events.set(E.SEASONAL_QUESTS,mz),this._events.set(E.QUESTS,pz),this._events.set(E.QUEST,Ez),this._events.set(E.ROOM_ENTER_ERROR,Iz),this._events.set(E.ROOM_ENTER,ld),this._events.set(E.ROOM_FORWARD,Tz),this._events.set(E.ROOM_DOORBELL_ACCEPTED,ad),this._events.set(E.ROOM_RIGHTS_CLEAR,od),this._events.set(E.ROOM_RIGHTS_OWNER,ud),this._events.set(E.ROOM_RIGHTS,hd),this._events.set(E.BOT_COMMAND_CONFIGURATION,Rz),this._events.set(E.BOT_SKILL_LIST_UPDATE,Az),this._events.set(E.BOT_FORCE_OPEN_CONTEXT_MENU,Oz),this._events.set(E.ROOM_SETTINGS_CHAT,vz),this._events.set(E.ROOM_INFO_OWNER,Sz),this._events.set(E.ROOM_SCORE,yz),this._events.set(E.ROOM_ROLLING,cd),this._events.set(E.FURNITURE_FLOOR_ADD,fd),this._events.set(E.FURNITURE_FLOOR,gd),this._events.set(E.FURNITURE_FLOOR_REMOVE,Ed),this._events.set(E.FURNITURE_FLOOR_UPDATE,pd),this._events.set(E.ITEM_WALL_ADD,Od),this._events.set(E.ITEM_WALL,Ad),this._events.set(E.ITEM_WALL_REMOVE,vd),this._events.set(E.ITEM_WALL_UPDATE,Sd),this._events.set(E.FURNITURE_ALIASES,md),this._events.set(E.FURNITURE_DATA,Id),this._events.set(E.FURNITURE_ITEMDATA,Td),this._events.set(E.ITEM_STACK_HELPER,Nz),this._events.set(E.FURNITURE_STATE,Rd),this._events.set(E.ITEM_DIMMER_SETTINGS,$T),this._events.set(E.FURNITURE_STATE_2,dd),this._events.set(E.LOVELOCK_FURNI_FINISHED,bz),this._events.set(E.LOVELOCK_FURNI_FRIEND_COMFIRMED,Dz),this._events.set(E.LOVELOCK_FURNI_START,Lz),this._events.set(E.OBJECTS_DATA_UPDATE,_d),this._events.set(E.FURNITURE_GROUP_CONTEXT_MENU_INFO,Pz),this._events.set(E.FURNITURE_POSTIT_STICKY_POLE_OPEN,wz),this._events.set(E.ROOM_SPECTATOR,nR),this._events.set(E.CUSTOM_USER_NOTIFICATION,Cz),this._events.set(E.ROOM_MESSAGE_NOTIFICATION,Gz),this._events.set(E.ROOM_POPULAR_TAGS_RESULT,P3),this._events.set(E.ROOM_RIGHTS_LIST,$z),this._events.set(E.ROOM_RIGHTS_LIST_ADD,Qz),this._events.set(E.ROOM_RIGHTS_LIST_REMOVE,Jz),this._events.set(E.ROOM_BAN_LIST,Zz),this._events.set(E.ROOM_SETTINGS_SAVE_ERROR,nY),this._events.set(E.ROOM_SETTINGS,sY),this._events.set(E.ROOM_SETTINGS_SAVE,rY),this._events.set(E.ROOM_SETTINGS_ERROR,iY),this._events.set(E.SHOW_ENFORCE_ROOM_CATEGORY,aY),this._events.set(E.ROOM_BAN_REMOVE,oY),this._events.set(E.ROOM_MUTED,tY),this._events.set(E.NO_SUCH_FLAT,eY),this._events.set(E.FAVORITE_GROUP_UDPATE,JT),this._events.set(E.ROOM_MODEL_DOOR,Cd),this._events.set(E.ROOM_HEIGHT_MAP,Md),this._events.set(E.ROOM_HEIGHT_MAP_UPDATE,Nd),this._events.set(E.ROOM_MODEL,yd),this._events.set(E.ROOM_MODEL_NAME,Pa),this._events.set(E.ROOM_PAINT,Pd),this._events.set(E.ROOM_THICKNESS,bd),this._events.set(E.ROOM_GET_FILTER_WORDS,L3),this._events.set(E.ROOM_MODEL_BLOCKED_TILES,jz),this._events.set(E.PET_FIGURE_UPDATE,Ju),this._events.set(E.PET_INFO,sR),this._events.set(E.PET_STATUS,iR),this._events.set(E.PET_EXPERIENCE,eR),this._events.set(E.PLAYING_GAME,rR),this._events.set(E.UNIT_DANCE,el),this._events.set(E.UNIT_EFFECT,Ld),this._events.set(E.UNIT,sl),this._events.set(E.UNIT_EXPRESSION,Ud),this._events.set(E.UNIT_HAND_ITEM,xd),this._events.set(E.UNIT_IDLE,Fd),this._events.set(E.UNIT_INFO,il),this._events.set(E.UNIT_NUMBER,wd),this._events.set(E.UNIT_REMOVE,rl),this._events.set(E.UNIT_STATUS,Gd),this._events.set(E.HAND_ITEM_RECEIVED,hR),this._events.set(E.FLOOD_CONTROL,aR),this._events.set(E.REMAINING_MUTE,oR),this._events.set(E.UNIT_CHAT,Xf),this._events.set(E.UNIT_CHAT_SHOUT,$u),this._events.set(E.UNIT_CHAT_WHISPER,tl),this._events.set(E.UNIT_TYPING,Dd),this._events.set(E.WIRED_ACTION,zz),this._events.set(E.WIRED_CONDITION,Yz),this._events.set(E.WIRED_TRIGGER,Wz),this._events.set(E.WIRED_OPEN,Xz),this._events.set(E.WIRED_REWARD,Kf),this._events.set(E.WIRED_SAVE,Kz),this._events.set(E.WIRED_ERROR,qz),this._events.set(E.AUTHENTICATED,uR),this._events.set(E.JUKEBOX_PLAYLIST_FULL,lR),this._events.set(E.JUKEBOX_SONG_DISKS,_R),this._events.set(E.NOW_PLAYING,cR),this._events.set(E.OFFICIAL_SONG_ID,hY),this._events.set(E.PLAYLIST,uY),this._events.set(E.PLAYLIST_SONG_ADDED,lY),this._events.set(E.TRAX_SONG_INFO,dR),this._events.set(E.USER_SONG_DISKS_INVENTORY,fR),this._events.set(E.HELPER_TALENT_TRACK,dY),this._events.set(E.TALENT_TRACK_LEVEL,cY),this._events.set(E.TALENT_TRACK_LEVEL_UP,_Y),this._events.set(E.IN_CLIENT_LINK,OR),this._events.set(E.USER_IGNORED,RR),this._events.set(E.USER_IGNORED_RESULT,Zf),this._events.set(E.USER_RESPECT,SR),this._events.set(E.USER_PERMISSIONS,gR),this._events.set(E.USER_BADGES_CURRENT,pR),this._events.set(E.USER_INFO,nl),this._events.set(E.UNIT_CHANGE_NAME,qf),this._events.set(E.USER_SETTINGS,mY),this._events.set(E.USER_PROFILE,pY),this._events.set(E.MESSENGER_RELATIONSHIPS,EY),this._events.set(E.GIFT_OPENED,xT),this._events.set(E.USER_CREDITS,yY),this._events.set(E.USER_CURRENCY,CY),this._events.set(E.USER_SUBSCRIPTION,MY),this._events.set(E.USER_WARDROBE_PAGE,PY),this._events.set(E.USER_CLASSIFICATION,DY),this._events.set(E.GET_USER_TAGS,mR),this._events.set(E.SCR_SEND_KICKBACK_INFO,NY),this._events.set(E.PET_RESPECTED,AR),this._events.set(E.PET_SUPPLEMENT,vR),this._events.set(E.ACCOUNT_SAFETY_LOCK_STATUS_CHANGE,ER),this._events.set(E.GENERIC_ERROR,id),this._events.set(E.GROUP_LIST,vY),this._events.set(E.CATALOG_APPROVE_NAME_RESULT,fY),this._events.set(E.CONNECTION_ERROR,V3),this._events.set(E.GUILD_EDIT_FAILED,OY),this._events.set(E.GUILD_MEMBER_MGMT_FAILED,AY),this._events.set(E.EXTENDED_PROFILE_CHANGED,IY),this._events.set(E.NOOBNESS_LEVEL,PT),this._events.set(E.DISCONNECT_REASON,bk),this._events.set(E.HANDSHAKE_INIT_DIFFIE,Lk),this._events.set(E.HANDSHAKE_COMPLETE_DIFFIE,Pk),this._events.set(E.HANDSHAKE_IDENTITY_ACCOUNT,Dk),this._events.set(E.NEW_USER_EXPERIENCE_GIFT_OFFER,sz),this._events.set(E.NEW_USER_EXPERIENCE_NOT_COMPLETE,rz),this._events.set(E.RESTORE_CLIENT,q3),this._events.set(E.FIREWORK_CHARGE_DATA,XH),this._events.set(E.PHONE_COLLECTION_STATE,_k),this._events.set(E.PHONE_TRY_NUMBER_RESULT,ck),this._events.set(E.PHONE_TRY_VERIFICATION_CODE_RESULT,dk),this._events.set(E.WELCOME_GIFT_CHANGE_EMAIL_RESULT,bY),this._events.set(E.WELCOME_GIFT_STATUS,Bz),this._events.set(E.RENTABLE_SPACE_RENT_OK,xz),this._events.set(E.RENTABLE_SPACE_STATUS,Fz),this._events.set(E.RENTABLE_SPACE_RENT_FAILED,Uz),this._events.set(E.RECYCLER_STATUS,Yl),this._events.set(E.RECYCLER_FINISHED,Wf),this._events.set(E.EMAIL_STATUS,IR),this._events.set(E.CHANGE_EMAIL_RESULT,gY),this._events.set(E.RENTABLE_FURNI_RENT_OR_BUYOUT_OFFER,Mz)}registerComposers(){this._composers.set(f.AUTHENTICATION,r4),this._composers.set(f.INTERSTITIAL_SHOWN,UY),this._composers.set(f.GET_INTERSTITIAL,LY),this._composers.set(f.GET_WARDROBE,GY),this._composers.set(f.SAVE_WARDROBE_OUTFIT,BY),this._composers.set(f.CHANGE_USERNAME,FY),this._composers.set(f.CHECK_USERNAME,wY),this._composers.set(f.REQUEST_CAMERA_CONFIGURATION,jY),this._composers.set(f.RENDER_ROOM,al),this._composers.set(f.RENDER_ROOM_THUMBNAIL,Bd),this._composers.set(f.PURCHASE_PHOTO,kY),this._composers.set(f.PUBLISH_PHOTO,VY),this._composers.set(f.PHOTO_COMPETITION,HY),this._composers.set(f.OPEN_CAMPAIGN_CALENDAR_DOOR,YY),this._composers.set(f.OPEN_CAMPAIGN_CALENDAR_DOOR_STAFF,zY),this._composers.set(f.BUILDERS_CLUB_PLACE_ROOM_ITEM,WY),this._composers.set(f.BUILDERS_CLUB_PLACE_WALL_ITEM,XY),this._composers.set(f.BUILDERS_CLUB_QUERY_FURNI_COUNT,KY),this._composers.set(f.GET_CATALOG_INDEX,QY),this._composers.set(f.GET_CATALOG_PAGE,JY),this._composers.set(f.CATALOG_PURCHASE,m5),this._composers.set(f.CATALOG_PURCHASE_GIFT,p5),this._composers.set(f.GET_PRODUCT_OFFER,l5),this._composers.set(f.GET_CLUB_OFFERS,s5),this._composers.set(f.GET_CLUB_GIFT_INFO,e5),this._composers.set(f.CATALOG_REDEEM_VOUCHER,O5),this._composers.set(f.GROUP_MEMBERSHIPS,$8),this._composers.set(f.GET_GIFT_WRAPPING_CONFIG,r5),this._composers.set(f.CATALOG_SELECT_VIP_GIFT,v5),this._composers.set(f.CATALOG_REQUESET_PET_BREEDS,d5),this._composers.set(f.GET_BONUS_RARE_INFO,qY),this._composers.set(f.GET_BUNDLE_DISCOUNT_RULESET,ZY),this._composers.set(f.GET_CATALOG_PAGE_EXPIRATION,$Y),this._composers.set(f.GET_CATALOG_PAGE_WITH_EARLIEST_EXP,t5),this._composers.set(f.GET_DIRECT_CLUB_BUY_AVAILABLE,i5),this._composers.set(f.GET_HABBO_BASIC_MEMBERSHIP_EXTEND_OFFER,n5),this._composers.set(f.GET_HABBO_CLUB_EXTEND_OFFER,a5),this._composers.set(f.GET_IS_OFFER_GIFTABLE,o5),this._composers.set(f.GET_LIMITED_OFFER_APPEARING_NEXT,h5),this._composers.set(f.GET_NEXT_TARGETED_OFFER,u5),this._composers.set(f.GET_ROOM_AD_PURCHASE_INFO,_5),this._composers.set(f.GET_SEASONAL_CALENDAR_DAILY_OFFER,c5),this._composers.set(f.GET_TARGETED_OFFER,f5),this._composers.set(f.MARK_CATALOG_NEW_ADDITIONS_PAGE_OPENED,g5),this._composers.set(f.PURCHASE_BASIC_MEMBERSHIP_EXTENSION,E5),this._composers.set(f.PURCHASE_ROOM_AD,I5),this._composers.set(f.PURCHASE_TARGETED_OFFER,T5),this._composers.set(f.PURCHASE_VIP_MEMBERSHIP_EXTENSION,R5),this._composers.set(f.ROOM_AD_PURCHASE_INITIATED,A5),this._composers.set(f.SET_TARGETTED_OFFER_STATE,S5),this._composers.set(f.SHOP_TARGETED_OFFER_VIEWED,y5),this._composers.set(f.FORWARD_TO_A_COMPETITION_ROOM,C5),this._composers.set(f.FORWARD_TO_A_SUBMITTABLE_ROOM,M5),this._composers.set(f.FORWARD_TO_RANDOM_COMPETITION_ROOM,N5),this._composers.set(f.GET_CURRENT_TIMING_CODE,P5),this._composers.set(f.GET_IS_USER_PART_OF_COMPETITION,b5),this._composers.set(f.GET_SECONDS_UNTIL,D5),this._composers.set(f.ROOM_COMPETITION_INIT,L5),this._composers.set(f.SUBMIT_ROOM_TO_COMPETITION,Sh),this._composers.set(f.VOTE_FOR_ROOM,U5),this._composers.set(f.CRAFT,x5),this._composers.set(f.CRAFT_SECRET,F5),this._composers.set(f.GET_CRAFTABLE_PRODUCTS,G5),this._composers.set(f.GET_CRAFTING_RECIPE,w5),this._composers.set(f.GET_CRAFTING_RECIPES_AVAILABLE,B5),this._composers.set(f.FRIEND_FURNI_CONFIRM_LOCK,V5),this._composers.set(f.ACCEPT_FRIEND,k5),this._composers.set(f.DECLINE_FRIEND,j5),this._composers.set(f.FIND_NEW_FRIENDS,z5),this._composers.set(f.FOLLOW_FRIEND,Y5),this._composers.set(f.FRIEND_LIST_UPDATE,W5),this._composers.set(f.GET_FRIEND_REQUESTS,X5),this._composers.set(f.HABBO_SEARCH,K5),this._composers.set(f.MESSENGER_INIT,q5),this._composers.set(f.REMOVE_FRIEND,Z5),this._composers.set(f.REQUEST_FRIEND,Q5),this._composers.set(f.MESSENGER_CHAT,J5),this._composers.set(f.SEND_ROOM_INVITE,$5),this._composers.set(f.SET_RELATIONSHIP_STATUS,tW),this._composers.set(f.VISIT_USER,eW),this._composers.set(f.ACHIEVEMENT_RESOLUTION_OPEN,yR),this._composers.set(f.ACCEPTGAMEINVITE,uW),this._composers.set(f.GAMEUNLOADEDMESSAGE,lW),this._composers.set(f.GETGAMEACHIEVEMENTSMESSAGE,_W),this._composers.set(f.GAMES_LIST,cW),this._composers.set(f.GETGAMESTATUSMESSAGE,dW),this._composers.set(f.GETUSERGAMEACHIEVEMENTSMESSAGE,fW),this._composers.set(f.JOINQUEUEMESSAGE,gW),this._composers.set(f.LEAVEQUEUEMESSAGE,EW),this._composers.set(f.RESETRESOLUTIONACHIEVEMENTMESSAGE,pW),this._composers.set(f.GAMES_INIT,TW),this._composers.set(f.GETWEEKLYGAMEREWARDWINNERS,RW),this._composers.set(f.GAME2GETACCOUNTGAMESTATUSMESSAGE,oW),this._composers.set(f.GAME2CHECKGAMEDIRECTORYSTATUSMESSAGE,aW),this._composers.set(f.GAME2EXITGAMEMESSAGE,sW),this._composers.set(f.GAME2GAMECHATMESSAGE,iW),this._composers.set(f.GAME2LOADSTAGEREADYMESSAGE,rW),this._composers.set(f.GAME2PLAYAGAINMESSAGE,nW),this._composers.set(f.GAME2REQUESTFULLSTATUSUPDATEMESSAGE,hW),this._composers.set(f.GAME2GETWEEKLYFRIENDSLEADERBOARD,mW),this._composers.set(f.GAME2GETWEEKLYLEADERBOARD,IW),this._composers.set(f.GET_GIFT,CR),this._composers.set(f.RESET_PHONE_NUMBER_STATE,OW),this._composers.set(f.SET_PHONE_NUMBER_VERIFICATION_STATUS,MR),this._composers.set(f.TRY_PHONE_NUMBER,AW),this._composers.set(f.VERIFY_CODE,vW),this._composers.set(f.GET_FORUM_STATS,XW),this._composers.set(f.GET_FORUMS_LIST,WW),this._composers.set(f.GET_FORUM_MESSAGES,KW),this._composers.set(f.GET_FORUM_THREAD,qW),this._composers.set(f.GET_FORUM_THREADS,ZW),this._composers.set(f.GET_UNREAD_FORUMS_COUNT,QW),this._composers.set(f.FORUM_MODERATE_MESSAGE,JW),this._composers.set(f.FORUM_MODERATE_THREAD,$W),this._composers.set(f.FORUM_POST_MESSAGE,t4),this._composers.set(f.UPDATE_FORUM_READ_MARKER,e4),this._composers.set(f.UPDATE_FORUM_SETTINGS,s4),this._composers.set(f.FORUM_UPDATE_THREAD,i4),this._composers.set(f.CLIENT_PONG,bR),this._composers.set(f.RELEASE_VERSION,NR),this._composers.set(f.SECURITY_TICKET,DR),this._composers.set(f.USER_INFO,PR),this._composers.set(f.DISCONNECT,a4),this._composers.set(f.SECURITY_MACHINE,h4),this._composers.set(f.CLIENT_VARIABLES,u4),this._composers.set(f.HANDSHAKE_INIT_DIFFIE,o4),this._composers.set(f.HANDSHAKE_COMPLETE_DIFFIE,n4),this._composers.set(f.CALL_FOR_HELP_FROM_FORUM_MESSAGE,l4),this._composers.set(f.CALL_FOR_HELP_FROM_FORUM_THREAD,_4),this._composers.set(f.CALL_FOR_HELP_FROM_IM,c4),this._composers.set(f.CALL_FOR_HELP_FROM_PHOTO,d4),this._composers.set(f.CALL_FOR_HELP_FROM_SELFIE,f4),this._composers.set(f.CALL_FOR_HELP,g4),this._composers.set(f.CHAT_REVIEW_GUIDE_DECIDES,E4),this._composers.set(f.CHAT_REVIEW_GUIDE_DETACHED,p4),this._composers.set(f.CHAT_REVIEW_GUIDE_VOTE,m4),this._composers.set(f.CHAT_REVIEW_SESSION_CREATE,I4),this._composers.set(f.DELETE_PENDING_CALLS_FOR_HELP,T4),this._composers.set(f.GET_CFH_STATUS,R4),this._composers.set(f.GET_FAQ_CATEGORY,O4),this._composers.set(f.GET_FAQ_TEXT,A4),this._composers.set(f.GET_GUIDE_REPORTING_STATUS,v4),this._composers.set(f.GET_PENDING_CALLS_FOR_HELP,S4),this._composers.set(f.GET_QUIZ_QUESTIONS,y4),this._composers.set(f.GUIDE_SESSION_CREATE,C4),this._composers.set(f.GUIDE_SESSION_FEEDBACK,M4),this._composers.set(f.GUIDE_SESSION_GET_REQUESTER_ROOM,N4),this._composers.set(f.GUIDE_SESSION_GUIDE_DECIDES,P4),this._composers.set(f.GUIDE_SESSION_INVITE_REQUESTER,b4),this._composers.set(f.GUIDE_SESSION_IS_TYPING,D4),this._composers.set(f.GUIDE_SESSION_MESSAGE,L4),this._composers.set(f.GUIDE_SESSION_ON_DUTY_UPDATE,U4),this._composers.set(f.GUIDE_SESSION_REPORT,x4),this._composers.set(f.GUIDE_SESSION_REQUESTER_CANCELS,F4),this._composers.set(f.GUIDE_SESSION_RESOLVED,w4),this._composers.set(f.POST_QUIZ_ANSWERS,G4),this._composers.set(f.SEARCH_FAQS,B4),this._composers.set(f.DESKTOP_VIEW,H5),this._composers.set(f.GROUP_INFO,UW),this._composers.set(f.GROUP_REQUEST,xW),this._composers.set(f.GROUP_MEMBER_REMOVE_CONFIRM,bW),this._composers.set(f.GROUP_MEMBER_REMOVE,BW),this._composers.set(f.GROUP_MEMBERS,FW),this._composers.set(f.GROUP_ADMIN_ADD,yW),this._composers.set(f.GROUP_ADMIN_REMOVE,CW),this._composers.set(f.GROUP_REQUEST_ACCEPT,wW),this._composers.set(f.GROUP_REQUEST_DECLINE,GW),this._composers.set(f.GROUP_DELETE,DW),this._composers.set(f.GROUP_CREATE_OPTIONS,PW),this._composers.set(f.GROUP_PARTS,MW),this._composers.set(f.GROUP_BUY,NW),this._composers.set(f.GROUP_SETTINGS,zW),this._composers.set(f.GROUP_SAVE_BADGE,HW),this._composers.set(f.GROUP_SAVE_COLORS,VW),this._composers.set(f.GROUP_SAVE_INFORMATION,kW),this._composers.set(f.GROUP_SAVE_PREFERENCES,jW),this._composers.set(f.GROUP_FAVORITE,LW),this._composers.set(f.GROUP_UNFAVORITE,YW),this._composers.set(f.GROUP_BADGES,JO),this._composers.set(f.APPROVE_ALL_MEMBERSHIP_REQUESTS,SW),this._composers.set(f.GROUP_UNBLOCK_MEMBER,dK),this._composers.set(f.ROOM_FAVORITE,BX),this._composers.set(f.CAN_CREATE_ROOM,VX),this._composers.set(f.CANCEL_ROOM_EVENT,HX),this._composers.set(f.CONVERT_GLOBAL_ROOM_ID,jX),this._composers.set(f.COMPETITION_ROOM_SEARCH,kX),this._composers.set(f.ROOM_CREATE,zX),this._composers.set(f.GET_USER_FLAT_CATS,e6),this._composers.set(f.GET_USER_EVENT_CATS,t6),this._composers.set(f.ROOM_FAVORITE_REMOVE,YX),this._composers.set(f.EDIT_ROOM_EVENT,WX),this._composers.set(f.FORWARD_TO_RANDOM_PROMOTED_ROOM,XX),this._composers.set(f.FORWARD_TO_SOME_ROOM,KX),this._composers.set(f.GET_CATEGORIES_WITH_USER_COUNT,qX),this._composers.set(f.GET_GUEST_ROOM,QX),this._composers.set(f.GET_OFFICIAL_ROOMS,JX),this._composers.set(f.GET_POPULAR_ROOM_TAGS,$X),this._composers.set(f.GUILD_BASE_SEARCH,s6),this._composers.set(f.MY_FAVOURITE_ROOMS_SEARCH,i6),this._composers.set(f.MY_FREQUENT_ROOM_HISTORY_SEARCH,r6),this._composers.set(f.MY_FRIENDS_ROOM_SEARCH,n6),this._composers.set(f.MY_GUILD_BASES_SEARCH,a6),this._composers.set(f.MY_RECOMMENDED_ROOMS,o6),this._composers.set(f.MY_ROOM_HISTORY_SEARCH,h6),this._composers.set(f.MY_ROOM_RIGHTS_SEARCH,u6),this._composers.set(f.MY_ROOMS_SEARCH,l6),this._composers.set(f.POPULAR_ROOMS_SEARCH,I6),this._composers.set(f.ROOM_LIKE,T6),this._composers.set(f.ROOM_RIGHTS_REMOVE_OWN,R6),this._composers.set(f.ROOM_AD_EVENT_TAB_CLICKED,O6),this._composers.set(f.ROOM_AD_EVENT_TAB_VIEWED,A6),this._composers.set(f.ROOM_AD_SEARCH,v6),this._composers.set(f.ROOM_TEXT_SEARCH,C6),this._composers.set(f.ROOMS_WHERE_MY_FRIENDS_ARE,S6),this._composers.set(f.ROOMS_WITH_HIGHEST_SCORE_SEARCH,y6),this._composers.set(f.SET_ROOM_SESSION_TAGS,M6),this._composers.set(f.ROOM_STAFF_PICK,N6),this._composers.set(f.ROOM_FILTER_WORDS,ZX),this._composers.set(f.ROOM_FILTER_WORDS_MODIFY,b6),this._composers.set(f.USER_HOME_ROOM,P6),this._composers.set(f.UPDATE_ROOM_THUMBNAIL,D6),this._composers.set(f.NAVIGATOR_INIT,d6),this._composers.set(f.NAVIGATOR_SEARCH_CLOSE,f6),this._composers.set(f.NAVIGATOR_SEARCH,g6),this._composers.set(f.NAVIGATOR_SEARCH_OPEN,E6),this._composers.set(f.NAVIGATOR_SEARCH_SAVE,p6),this._composers.set(f.NAVIGATOR_SETTINGS_SAVE,m6),this._composers.set(f.NAVIGATOR_CATEGORY_LIST_MODE,_6),this._composers.set(f.NAVIGATOR_DELETE_SAVED_SEARCH,c6),this._composers.set(f.POLL_ANSWER,kR),this._composers.set(f.POLL_REJECT,jR),this._composers.set(f.POLL_START,zR),this._composers.set(f.POLL_VOTE_COUNTER,YR),this._composers.set(f.USER_EFFECT_ACTIVATE,H4),this._composers.set(f.USER_EFFECT_ENABLE,V4),this._composers.set(f.USER_BADGES,Y4),this._composers.set(f.USER_BADGES_CURRENT_UPDATE,W4),this._composers.set(f.GET_BADGE_POINTS_LIMITS,k4),this._composers.set(f.REQUESTABADGE,z4),this._composers.set(f.GETISBADGEREQUESTFULFILLED,j4),this._composers.set(f.USER_BOTS,up),this._composers.set(f.USER_FURNITURE,X4),this._composers.set(f.REQUESTFURNIINVENTORYWHENNOTINROOM,K4),this._composers.set(f.USER_PETS,lp),this._composers.set(f.TRADE_ACCEPT,Q4),this._composers.set(f.TRADE_CANCEL,J4),this._composers.set(f.TRADE_CLOSE,$4),this._composers.set(f.TRADE_CONFIRM,tX),this._composers.set(f.TRADE_ITEM,eX),this._composers.set(f.TRADE_ITEMS,sX),this._composers.set(f.TRADE_ITEM_REMOVE,iX),this._composers.set(f.TRADE,rX),this._composers.set(f.TRADE_UNACCEPT,nX),this._composers.set(f.UNSEEN_RESET_CATEGORY,aX),this._composers.set(f.UNSEEN_RESET_ITEMS,oX),this._composers.set(f.ACHIEVEMENT_LIST,xY),this._composers.set(f.PET_MOUNT,Hd),this._composers.set(f.PET_RESPECT,FR),this._composers.set(f.PET_SUPPLEMENT,U6),this._composers.set(f.REMOVE_PET_SADDLE,wR),this._composers.set(f.PET_INFO,GR),this._composers.set(f.TOGGLE_PET_BREEDING,BR),this._composers.set(f.TOGGLE_PET_RIDING,HR),this._composers.set(f.USE_PET_PRODUCT,VR),this._composers.set(f.GET_PET_TRAINING_PANEL,xR),this._composers.set(f.PET_OPEN_PACKAGE,yO),this._composers.set(f.PET_SELECTED,U8),this._composers.set(f.PETS_BREED,Xl),this._composers.set(f.PET_CANCEL_BREEDING,q4),this._composers.set(f.PET_CONFIRM_BREEDING,Z4),this._composers.set(f.ROOM_ENTER,XR),this._composers.set(f.ROOM_DOORBELL,WR),this._composers.set(f.GO_TO_FLAT,PO),this._composers.set(f.CHANGE_QUEUE,NO),this._composers.set(f.ROOM_AMBASSADOR_ALERT,KR),this._composers.set(f.ROOM_BAN_GIVE,qR),this._composers.set(f.ROOM_BAN_REMOVE,e8),this._composers.set(f.ROOM_RIGHTS_GIVE,ZR),this._composers.set(f.ROOM_KICK,QR),this._composers.set(f.ROOM_MUTE_USER,JR),this._composers.set(f.ROOM_RIGHTS_REMOVE,$R),this._composers.set(f.ROOM_RIGHTS_REMOVE_ALL,$6),this._composers.set(f.ROOM_DELETE,t8),this._composers.set(f.ROOM_SETTINGS,r8),this._composers.set(f.ROOM_SETTINGS_SAVE,a8),this._composers.set(f.ROOM_RIGHTS_LIST,n8),this._composers.set(f.ROOM_BAN_LIST,i8),this._composers.set(f.ROOM_SETTINGS_UPDATE_ROOM_CATEGORY_AND_TRADE,k8),this._composers.set(f.BOT_CONFIGURATION,s8),this._composers.set(f.GET_ITEM_DATA,rO),this._composers.set(f.REMOVE_WALL_ITEM,hO),this._composers.set(f.BOT_PLACE,tO),this._composers.set(f.BOT_PICKUP,eO),this._composers.set(f.BOT_SKILL_SAVE,o8),this._composers.set(f.PET_PLACE,aO),this._composers.set(f.PET_MOVE,Vd),this._composers.set(f.PET_PICKUP,oO),this._composers.set(f.SET_ITEM_DATA,lO),this._composers.set(f.SET_OBJECT_DATA,_O),this._composers.set(f.COMPOST_PLANT,iO),this._composers.set(f.HARVEST_PET,nO),this._composers.set(f.SET_CLOTHING_CHANGE_DATA,uO),this._composers.set(f.FURNITURE_ALIASES,gO),this._composers.set(f.FURNITURE_GROUP_INFO,EO),this._composers.set(f.FURNITURE_PICKUP,pO),this._composers.set(f.FURNITURE_PLACE,mO),this._composers.set(f.ITEM_PAINT,_8),this._composers.set(f.FURNITURE_POSTIT_PLACE,IO),this._composers.set(f.FURNITURE_POSTIT_SAVE_STICKY_POLE,h8),this._composers.set(f.CONTROL_YOUTUBE_DISPLAY_PLAYBACK,A8),this._composers.set(f.GET_YOUTUBE_DISPLAY_STATUS,v8),this._composers.set(f.SET_YOUTUBE_DISPLAY_PLAYLIST,S8),this._composers.set(f.FURNITURE_FLOOR_UPDATE,kd),this._composers.set(f.FURNITURE_WALL_UPDATE,MO),this._composers.set(f.ITEM_DIMMER_SETTINGS,cO),this._composers.set(f.ITEM_DIMMER_SAVE,dO),this._composers.set(f.ITEM_DIMMER_TOGGLE,fO),this._composers.set(f.ROOM_TONER_APPLY,O8),this._composers.set(f.ITEM_COLOR_WHEEL_CLICK,TO),this._composers.set(f.ITEM_DICE_CLICK,RO),this._composers.set(f.ITEM_DICE_CLOSE,OO),this._composers.set(f.FURNITURE_MULTISTATE,Qf),this._composers.set(f.FURNITURE_RANDOMSTATE,vO),this._composers.set(f.ITEM_STACK_HELPER,f8),this._composers.set(f.FURNITURE_WALL_MULTISTATE,SO),this._composers.set(f.ONE_WAY_DOOR_CLICK,AO),this._composers.set(f.ITEM_EXCHANGE_REDEEM,d8),this._composers.set(f.ITEM_CLOTHING_REDEEM,N8),this._composers.set(f.ROOM_MODEL,jd),this._composers.set(f.GET_OCCUPIED_TILES,y8),this._composers.set(f.GET_ROOM_ENTRY_TILE,C8),this._composers.set(f.ROOM_MODEL_SAVE,M8),this._composers.set(f.UNIT_ACTION,xO),this._composers.set(f.UNIT_DANCE,FO),this._composers.set(f.UNIT_DROP_HAND_ITEM,b8),this._composers.set(f.UNIT_GIVE_HANDITEM,D8),this._composers.set(f.UNIT_GIVE_HANDITEM_PET,L8),this._composers.set(f.UNIT_LOOK,wO),this._composers.set(f.UNIT_SIGN,BO),this._composers.set(f.UNIT_POSTURE,GO),this._composers.set(f.UNIT_WALK,HO),this._composers.set(f.UNIT_CHAT,Jf),this._composers.set(f.UNIT_CHAT_SHOUT,bO),this._composers.set(f.USER_SETTINGS_CHAT_STYLE,P8),this._composers.set(f.UNIT_CHAT_WHISPER,DO),this._composers.set(f.UNIT_TYPING,LO),this._composers.set(f.UNIT_TYPING_STOP,UO),this._composers.set(f.WIRED_APPLY_SNAPSHOT,F8),this._composers.set(f.WIRED_OPEN,w8),this._composers.set(f.WIRED_ACTION_SAVE,B8),this._composers.set(f.WIRED_CONDITION_SAVE,H8),this._composers.set(f.WIRED_TRIGGER_SAVE,V8),this._composers.set(f.ROOM_MUTE,G8),this._composers.set(f.APPROVE_NAME,J8),this._composers.set(f.USER_RESPECT,$O),this._composers.set(f.SCR_GET_KICKBACK_INFO,hK),this._composers.set(f.PEER_USERS_CLASSIFICATION,tA),this._composers.set(f.USER_CLASSIFICATION,eA),this._composers.set(f.USER_IGNORED,YO),this._composers.set(f.USER_IGNORE,XO),this._composers.set(f.USER_IGNORE_ID,KO),this._composers.set(f.USER_UNIGNORE,qO),this._composers.set(f.USER_BADGES_CURRENT,ZO),this._composers.set(f.USER_FIGURE,sK),this._composers.set(f.USER_MOTTO,QO),this._composers.set(f.USER_PROFILE,iK),this._composers.set(f.USER_PROFILE_BY_NAME,eK),this._composers.set(f.USER_TAGS,WO),this._composers.set(f.MESSENGER_RELATIONSHIPS,rK),this._composers.set(f.MANNEQUIN_SAVE_NAME,E8),this._composers.set(f.MANNEQUIN_SAVE_LOOK,g8),this._composers.set(f.PRESENT_OPEN_PRESENT,CO),this._composers.set(f.MARKETPLACE_CONFIG,fX),this._composers.set(f.MARKETPLACE_SELL_ITEM,mX),this._composers.set(f.MARKETPLACE_REQUEST_OWN_ITEMS,pX),this._composers.set(f.MARKETPLACE_TAKE_BACK_ITEM,cX),this._composers.set(f.MARKETPLACE_REQUEST_OFFERS,EX),this._composers.set(f.MARKETPLACE_BUY_OFFER,lX),this._composers.set(f.MARKETPLACE_REDEEM_CREDITS,IX),this._composers.set(f.MARKETPLACE_BUY_TOKENS,_X),this._composers.set(f.REQUEST_SELL_ITEM,dX),this._composers.set(f.REQUEST_MARKETPLACE_ITEM_STATS,gX),this._composers.set(f.USER_BOTS,up),this._composers.set(f.USER_PETS,lp),this._composers.set(f.USER_CURRENCY,aK),this._composers.set(f.USER_SUBSCRIPTION,oK),this._composers.set(f.MODTOOL_REQUEST_ROOM_INFO,AX),this._composers.set(f.MODTOOL_CHANGE_ROOM_SETTINGS,NX),this._composers.set(f.MODTOOL_REQUEST_USER_CHATLOG,CX),this._composers.set(f.MODTOOL_REQUEST_ROOM_CHATLOG,SX),this._composers.set(f.MOD_TOOL_USER_INFO,vX),this._composers.set(f.MODTOOL_SANCTION_ALERT,MX),this._composers.set(f.MODTOOL_SANCTION_BAN,jr),this._composers.set(f.MODTOOL_SANCTION_KICK,PX),this._composers.set(f.MODTOOL_SANCTION_TRADELOCK,xX),this._composers.set(f.MODTOOL_ALERTEVENT,bX),this._composers.set(f.MODTOOL_SANCTION_MUTE,DX),this._composers.set(f.MODTOOL_REQUEST_USER_ROOMS,yX),this._composers.set(f.MODTOOL_ROOM_ALERT,yh),this._composers.set(f.CLOSE_ISSUE_DEFAULT_ACTION,TX),this._composers.set(f.CLOSE_ISSUES,Wl),this._composers.set(f.DEFAULT_SANCTION,RX),this._composers.set(f.GET_CFH_CHATLOG,OX),this._composers.set(f.MODTOOL_PREFERENCES,LX),this._composers.set(f.MODTOOL_SANCTION,UX),this._composers.set(f.PICK_ISSUES,FX),this._composers.set(f.RELEASE_ISSUES,wX),this._composers.set(f.MYSTERYBOXWAITINGCANCELEDMESSAGE,GX),this._composers.set(f.MYSTERYBOX_OPEN_TROPHY,p8),this._composers.set(f.USER_SETTINGS_CAMERA,uK),this._composers.set(f.USER_SETTINGS_OLD_CHAT,lK),this._composers.set(f.USER_SETTINGS_INVITES,_K),this._composers.set(f.USER_SETTINGS_VOLUME,cK),this._composers.set(f.COMMUNITY_GOAL_VOTE_COMPOSER,uX),this._composers.set(f.GET_PROMO_ARTICLES,hX),this._composers.set(f.ACCEPT_QUEST,x6),this._composers.set(f.ACTIVATE_QUEST,F6),this._composers.set(f.CANCEL_QUEST,w6),this._composers.set(f.FRIEND_REQUEST_QUEST_COMPLETE,G6),this._composers.set(f.GET_COMMUNITY_GOAL_EARNED_PRIZES,B6),this._composers.set(f.GET_COMMUNITY_GOAL_HALL_OF_FAME,H6),this._composers.set(f.GET_COMMUNITY_GOAL_PROGRESS,V6),this._composers.set(f.GET_CONCURRENT_USERS_GOAL_PROGRESS,k6),this._composers.set(f.GET_CONCURRENT_USERS_REWARD,j6),this._composers.set(f.GET_DAILY_QUEST,z6),this._composers.set(f.GET_QUESTS,Y6),this._composers.set(f.GET_SEASONAL_QUESTS_ONLY,W6),this._composers.set(f.OPEN_QUEST_TRACKER,X6),this._composers.set(f.REDEEM_COMMUNITY_GOAL_PRIZE,K6),this._composers.set(f.REJECT_QUEST,q6),this._composers.set(f.START_CAMPAIGN,Z6),this._composers.set(f.GET_SOUND_SETTINGS,W8),this._composers.set(f.ADD_JUKEBOX_DISK,j8),this._composers.set(f.GET_JUKEBOX_PLAYLIST,VO),this._composers.set(f.GET_NOW_PLAYING,kO),this._composers.set(f.GET_OFFICIAL_SONG_ID,z8),this._composers.set(f.GET_SONG_INFO,jO),this._composers.set(f.GET_SOUND_MACHINE_PLAYLIST,Y8),this._composers.set(f.GET_USER_SONG_DISKS,zO),this._composers.set(f.REMOVE_JUKEBOX_DISK,X8),this._composers.set(f.HELPER_TALENT_TRACK,q8),this._composers.set(f.TALENT_TRACK_GET_LEVEL,K8),this._composers.set(f.NEW_USER_EXPERIENCE_GET_GIFTS,L6),this._composers.set(f.NEW_USER_EXPERIENCE_SCRIPT_PROCEED,UR),this._composers.set(f.WELCOME_OPEN_GIFT,m8),this._composers.set(f.WELCOME_GIFT_CHANGE_EMAIL,fK),this._composers.set(f.EMAIL_GET_STATUS,nK),this._composers.set(f.EMAIL_CHANGE,tK),this._composers.set(f.RENTABLE_SPACE_CANCEL_RENT,I8),this._composers.set(f.RENTABLE_SPACE_RENT,T8),this._composers.set(f.RENTABLE_SPACE_STATUS,R8),this._composers.set(f.RECYCLER_STATUS,Q6),this._composers.set(f.RECYCLER_ITEMS,J6),this._composers.set(f.TRACKING_PERFORMANCE_LOG,Q8),this._composers.set(f.TRACKING_LAG_WARNING_REPORT,Z8),this._composers.set(f.ROOM_DIRECTORY_ROOM_NETWORK_OPEN_CONNECTION,x8),this._composers.set(f.RENTABLE_EXTEND_RENT_OR_BUYOUT_STRIP_ITEM,l8),this._composers.set(f.RENTABLE_EXTEND_RENT_OR_BUYOUT_FURNI,u8),this._composers.set(f.RENTABLE_GET_RENT_OR_BUYOUT_OFFER,c8)}get events(){return this._events}get composers(){return this._composers}}class pK extends mi{constructor(t){super(),this._communication=t,this._connection=null,this._messages=new EK,this._demo=new gK(this),this.onConnectionOpenedEvent=this.onConnectionOpenedEvent.bind(this),this.onConnectionClosedEvent=this.onConnectionClosedEvent.bind(this),this.onConnectionErrorEvent=this.onConnectionErrorEvent.bind(this),this.onConnectionAuthenticatedEvent=this.onConnectionAuthenticatedEvent.bind(this)}onInit(){this._connection||(K.instance.events.addEventListener(Ve.CONNECTION_AUTHENTICATED,this.onConnectionAuthenticatedEvent),this._connection=this._communication.createConnection(this),this._connection.registerMessages(this._messages),this._connection.addEventListener(Oe.CONNECTION_OPENED,this.onConnectionOpenedEvent),this._connection.addEventListener(Oe.CONNECTION_CLOSED,this.onConnectionClosedEvent),this._connection.addEventListener(Oe.CONNECTION_ERROR,this.onConnectionErrorEvent),this._demo&&this._demo.init(),this._connection.init(rt.getValue("socket.url")))}onDispose(){this._demo&&this._demo.dispose(),this._connection&&(this._connection.removeEventListener(Oe.CONNECTION_OPENED,this.onConnectionOpenedEvent),this._connection.removeEventListener(Oe.CONNECTION_CLOSED,this.onConnectionClosedEvent),this._connection.removeEventListener(Oe.CONNECTION_ERROR,this.onConnectionErrorEvent)),K.instance.events.removeEventListener(Ve.CONNECTION_AUTHENTICATED,this.onConnectionAuthenticatedEvent),super.onDispose()}onConnectionOpenedEvent(t){Y.log("Connection Initialized")}onConnectionClosedEvent(t){Y.log("Connection Closed")}onConnectionErrorEvent(t){Y.log("Connection Error")}onConnectionAuthenticatedEvent(t){Y.log("Connection Authenticated"),this._connection&&this._connection.authenticated()}connectionInit(t){Y.log("Initializing Connection",t)}registerMessageEvent(t){return this._connection&&this._connection.addMessageEvent(t),t}removeMessageEvent(t){this._connection&&this._connection.removeMessageEvent(t)}get demo(){return this._demo}get connection(){return this._connection}}const Su=class{static get available(){return this._isListeningForPostMessages||(this._isListeningForPostMessages=!0,window.addEventListener("message",s=>{if(typeof s.data=="string"&&s.data.startsWith(Su.MESSAGE_KEY)){const{method:t,params:e}=JSON.parse(s.data.substr(Su.MESSAGE_KEY.length)),i=window[t];if(!i)return;i(...e);return}})),!0}static call(s,...t){if(window.top!==window&&window.top.postMessage(Su.MESSAGE_KEY+JSON.stringify({method:s,params:t}),"*"),!("FlashExternalInterface"in window))return;const e=window.FlashExternalInterface[s];return typeof e<"u"?e(...t):void 0}static callGame(s,...t){if(window.top!==window&&window.top.postMessage("Nitro_LegacyExternalGameInterface"+JSON.stringify({method:s,params:t}),"*"),!("FlashExternalGameInterface"in window))return;const e=window.FlashExternalGameInterface[s];return typeof e<"u"?e(...t):void 0}static addCallback(s,t){window[s]=t}};let mt=Su;mt.MESSAGE_KEY="Nitro_LegacyExternalInterface";mt._isListeningForPostMessages=!1;class mK{constructor(t){t.addMessageEvent(new MT(this.onLoadGameUrl.bind(this)))}onLoadGameUrl(t){if(!t)return;const e=t.getParser();e&&mt.callGame("showGame",e.url)}}class W_{constructor(t){this._badgeId="",this._level=1,this._base="",this._badgeId=t,this.parseText()}parseText(){let t=this._badgeId.length-1;for(;t>0&&this.isNumber(this._badgeId.charAt(t));)t--;this._base=this._badgeId.substr(0,t+1);const e=this._badgeId.substr(t+1,this._badgeId.length);e&&e!==""&&(this._level=Number.parseInt(e))}isNumber(t){const e=t.charCodeAt(0);return e>=48&&e<=57}get level(){return this._level}set level(t){this._level=Math.max(1,t)}get getBadgeId(){return this._base+this._level}get base(){return this._base}}class IK extends mi{constructor(t){super(),this._communication=t,this._definitions=new Map,this._parameters=new Map,this._badgePointLimits=new Map,this._romanNumerals=["I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII","XIII","XIV","XV","XVI","XVII","XVIII","XIX","XX","XXI","XXII","XXIII","XXIV","XXV","XXVI","XXVII","XXVIII","XXIX","XXX"],this._pendingUrls=[]}onInit(){this._communication.registerMessageEvent(new UT(this.onBadgePointLimitsEvent.bind(this)));let t=rt.getValue("external.texts.url");Array.isArray(t)||(t=[rt.getValue("external.texts.url")]);for(let e=0;e<t.length;e++)t[e]=rt.interpolate(t[e]);this._pendingUrls=t,this.loadNextLocalization()}loadNextLocalization(){if(!this._pendingUrls.length){this.events&&this.events.dispatchEvent(new _a(_a.LOADED));return}this.loadLocalizationFromURL(this._pendingUrls[0])}loadLocalizationFromURL(t){fetch(t).then(e=>e.json()).then(e=>this.onLocalizationLoaded(e,t)).catch(e=>this.onLocalizationFailed(e))}onLocalizationLoaded(t,e){if(!t)return;if(!this.parseLocalization(t))throw new Error(`Invalid json data for file ${e}`);const i=this._pendingUrls.indexOf(e);i>=0&&this._pendingUrls.splice(i,1),this.loadNextLocalization()}onLocalizationFailed(t){this.events&&this.events.dispatchEvent(new _a(_a.FAILED))}parseLocalization(t){if(!t)return!1;for(const e in t)this._definitions.set(e,t[e]);return!0}onBadgePointLimitsEvent(t){const e=t.getParser();for(const i of e.data)this.setBadgePointLimit(i.badgeId,i.limit)}getBadgePointLimit(t){return this._badgePointLimits.get(t)||-1}setBadgePointLimit(t,e){this._badgePointLimits.set(t,e)}getRomanNumeral(t){return this._romanNumerals[Math.max(0,t-1)]}getPreviousLevelBadgeId(t){const e=new W_(t);return e.level--,e.getBadgeId}hasValue(t){return this._definitions.has(t)}getValue(t,e=!0){if(!t||!t.length)return null;const i=t.match(/\$\{.[^}]*\}/g);if(i&&i.length)for(const n of i)t=t.replace(n,this.getValue(n.slice(2,-1),e));let r=this._definitions.get(t)||null;if(!r&&(r=rt.definitions.get(t),r))return r;if(r&&e){const n=this._parameters.get(t);if(n)for(const[a,o]of n)r=r.replace("%"+a+"%",o)}return r||t}getValueWithParameter(t,e,i){const r=this.getValue(t,!1),n=r.replace("%"+e+"%",i);if(r.startsWith("%{")){const a=new RegExp("%{"+e.toUpperCase()+"\\|([^|]*)\\|([^|]*)\\|([^|]*)}"),o=r.match(a);if(!o)return n;let h=-1;switch(Number.parseInt(i)){case 0:h=1;break;case 1:h=2;break;default:case 2:h=3;break}if(h==-1||typeof o[h]>"u")return n;const c=o[h];if(c)return c.replace("%%",i)}return n}getValueWithParameters(t,e,i){let r=this.getValue(t,!1);if(e)for(let n=0;n<e.length;n++){const a=e[n],o=i[n];if(o!==void 0&&(r=r.replace("%"+a+"%",o),r.startsWith("%{"))){const h=new RegExp("%{"+a.toUpperCase()+"\\|([^|]*)\\|([^|]*)\\|([^|]*)}"),u=r.match(h);if(!u)continue;const c=parseInt(o);let l=-1;switch(c){case 0:l=1;break;case 1:l=2;break;case 2:default:l=3;break}if(l===-1||typeof u[l]>"u")continue;const _=u[l];_&&(r=_.replace("%%",o))}}return r}setValue(t,e){this._definitions.set(t,e)}registerParameter(t,e,i){if(!t||t.length===0||!e||e.length===0)return;let r=this._parameters.get(t);r||(r=new Map,this._parameters.set(t,r)),r.set(e,i)}getBadgeName(t){const e=new W_(t),i=["badge_name_"+t,"badge_name_"+e.base];let r=this.fixBadLocalization(this.getExistingKey(i));return r=r.replace("%roman%",this.getRomanNumeral(e.level)),r}getBadgeDesc(t){const e=new W_(t),i=["badge_desc_"+t,"badge_desc_"+e.base];let r=this.fixBadLocalization(this.getExistingKey(i));const n=this.getBadgePointLimit(t);return n>-1&&(r=r.replace("%limit%",n.toString())),r=r.replace("%roman%",this.getRomanNumeral(e.level)),r}getExistingKey(t){for(const e of t){const i=this.getValue(e);if(i!=e)return i}return""}fixBadLocalization(t){return t.replace("${","$").replace("{","$").replace("}","$")}}/*!
 * @pixi/canvas-display - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/canvas-display is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */pi.prototype._renderCanvas=function(t){};pi.prototype.renderCanvas=function(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable)){this._mask&&t.maskManager.pushMask(this._mask),this._renderCanvas(t);for(var e=0,i=this.children.length;e<i;++e)this.children[e].renderCanvas(t);this._mask&&t.maskManager.popMask(t)}};pe.prototype.renderCanvas=function(t){};/*!
 * @pixi/extract - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/extract is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var TK=new et,RK=4,OK=function(){function s(t){this.renderer=t}return s.prototype.image=function(t,e,i){var r=new Image;return r.src=this.base64(t,e,i),r},s.prototype.base64=function(t,e,i){return this.canvas(t).toDataURL(e,i)},s.prototype.canvas=function(t,e){var i=this._rawPixels(t,e),r=i.pixels,n=i.width,a=i.height,o=i.flipY,h=new Hg(n,a,1),u=h.context.getImageData(0,0,n,a);if(s.arrayPostDivide(r,u.data),h.context.putImageData(u,0,0),o){var c=new Hg(h.width,h.height,1);c.context.scale(1,-1),c.context.drawImage(h.canvas,0,-a),h.destroy(),h=c}return h.canvas},s.prototype.pixels=function(t,e){var i=this._rawPixels(t,e).pixels;return s.arrayPostDivide(i,i),i},s.prototype._rawPixels=function(t,e){var i=this.renderer,r,n=!1,a,o=!1;if(t)if(t instanceof xe)a=t;else{var h=i.context.webGLVersion>=2?i.multisample:oe.NONE;if(a=this.renderer.generateTexture(t,{multisample:h}),h!==oe.NONE){var u=xe.create({width:a.width,height:a.height});i.framebuffer.bind(a.framebuffer),i.framebuffer.blit(u.framebuffer),i.framebuffer.bind(null),a.destroy(!0),a=u}o=!0}a?(r=a.baseTexture.resolution,e=e??a.frame,n=!1,i.renderTexture.bind(a)):(r=i.resolution,e||(e=TK,e.width=i.width,e.height=i.height),n=!0,i.renderTexture.bind(null));var c=Math.round(e.width*r),l=Math.round(e.height*r),_=new Uint8Array(RK*c*l),d=i.gl;return d.readPixels(Math.round(e.x*r),Math.round(e.y*r),c,l,d.RGBA,d.UNSIGNED_BYTE,_),o&&a.destroy(!0),{pixels:_,width:c,height:l,flipY:n}},s.prototype.destroy=function(){this.renderer=null},s.arrayPostDivide=function(t,e){for(var i=0;i<t.length;i+=4){var r=e[i+3]=t[i+3];r!==0?(e[i]=Math.round(Math.min(t[i]*255/r,255)),e[i+1]=Math.round(Math.min(t[i+1]*255/r,255)),e[i+2]=Math.round(Math.min(t[i+2]*255/r,255))):(e[i]=t[i],e[i+1]=t[i+1],e[i+2]=t[i+2])}},s.extension={name:"extract",type:ve.RendererPlugin},s}();/*!
 * @pixi/graphics-extras - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/graphics-extras is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */function AK(s,t,e,i,r,n){return r===void 0&&(r=0),n===void 0&&(n=Math.PI*2),Math.abs(n-r)>=Math.PI*2?this.drawCircle(s,t,i).beginHole().drawCircle(s,t,e).endHole():(this.finishPoly(),this.arc(s,t,e,n,r,!0).arc(s,t,i,r,n,!1).finishPoly(),this)}function vK(s,t,e,i,r){if(r<=0)return this.drawRect(s,t,e,i);for(var n=Math.min(r,Math.min(e,i)/2),a=s+e,o=t+i,h=[s+n,t,a-n,t,a,t+n,a,o-n,a-n,o,s+n,o,s,o-n,s,t+n],u=h.length-1;u>=2;u-=2)h[u]===h[u-2]&&h[u-1]===h[u-3]&&h.splice(u-1,2);return this.drawPolygon(h)}function SK(s,t,e,i,r){if(r===0)return this.drawRect(s,t,e,i);var n=Math.min(e,i)/2,a=Math.min(n,Math.max(-n,r)),o=s+e,h=t+i,u=a<0?-a:0,c=Math.abs(a);return this.moveTo(s,t+c).arcTo(s+u,t+u,s+c,t,c).lineTo(o-c,t).arcTo(o-u,t+u,o,t+c,c).lineTo(o,h-c).arcTo(o-u,h-u,s+e-c,h,c).lineTo(s+c,h).arcTo(s+u,h-u,s,h-c,c).closePath()}function yK(s,t,e,i,r){r===void 0&&(r=0),i=Math.max(i|0,3);for(var n=-1*Math.PI/2+r,a=Math.PI*2/i,o=[],h=0;h<i;h++){var u=h*a+n;o.push(s+e*Math.cos(u),t+e*Math.sin(u))}return this.drawPolygon(o)}function CK(s,t,e,i,r,n){if(n===void 0&&(n=0),i=Math.max(i|0,3),r<=0)return this.drawRegularPolygon(s,t,e,i,n);var a=e*Math.sin(Math.PI/i)-.001;r=Math.min(r,a);for(var o=-1*Math.PI/2+n,h=Math.PI*2/i,u=(i-2)*Math.PI/i/2,c=0;c<i;c++){var l=c*h+o,_=s+e*Math.cos(l),d=t+e*Math.sin(l),g=l+Math.PI+u,m=l-Math.PI-u,p=_+r*Math.cos(g),T=d+r*Math.sin(g),A=_+r*Math.cos(m),O=d+r*Math.sin(m);c===0?this.moveTo(p,T):this.lineTo(p,T),this.quadraticCurveTo(_,d,A,O)}return this.closePath()}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var zd=function(s,t){return zd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])},zd(s,t)};function MK(s,t){zd(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var NK=function(s){MK(t,s);function t(e,i,r,n,a,o){o===void 0&&(o=0);var h=this;a=a||n/2;for(var u=-1*Math.PI/2+o,c=r*2,l=Bo/c,_=[],d=0;d<c;d++){var g=d%2?a:n,m=d*l+u;_.push(e+g*Math.cos(m),i+g*Math.sin(m))}return h=s.call(this,_)||this,h}return t}(du);function PK(s,t,e,i,r,n){return n===void 0&&(n=0),this.drawPolygon(new NK(s,t,e,i,r,n))}Object.defineProperties(Na.prototype,{drawTorus:{value:AK},drawChamferRect:{value:vK},drawFilletRect:{value:SK},drawRegularPolygon:{value:yK},drawRoundedPolygon:{value:CK},drawStar:{value:PK}});/*!
 * @pixi/math-extras - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/math-extras is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var sA={add:function(s,t){return t||(t=new H),t.x=this.x+s.x,t.y=this.y+s.y,t},subtract:function(s,t){return t||(t=new H),t.x=this.x-s.x,t.y=this.y-s.y,t},multiply:function(s,t){return t||(t=new H),t.x=this.x*s.x,t.y=this.y*s.y,t},multiplyScalar:function(s,t){return t||(t=new H),t.x=this.x*s,t.y=this.y*s,t},dot:function(s){return this.x*s.x+this.y*s.y},cross:function(s){return this.x*s.y-this.y*s.x},normalize:function(s){s||(s=new H);var t=Math.sqrt(this.x*this.x+this.y*this.y);return s.x=this.x/t,s.y=this.y/t,s},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},magnitudeSquared:function(){return this.x*this.x+this.y*this.y},project:function(s,t){t||(t=new H);var e=(this.x*s.x+this.y*s.y)/(s.x*s.x+s.y*s.y);return t.x=s.x*e,t.y=s.y*e,t},reflect:function(s,t){t||(t=new H);var e=this.x*s.x+this.y*s.y;return t.x=this.x-2*e*s.x,t.y=this.y-2*e*s.y,t}};Object.assign(H.prototype,sA);Object.assign(aa.prototype,sA);et.prototype.containsRect=function(t){return t.width<=0||t.height<=0?t.x>this.x&&t.y>this.y&&t.right<this.right&&t.bottom<this.bottom:t.x>=this.x&&t.y>=this.y&&t.right<=this.right&&t.bottom<=this.bottom};et.prototype.equals=function(t){return t===this?!0:t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height};et.prototype.intersection=function(t,e){e||(e=new et);var i=this.x<t.x?t.x:this.x,r=this.right>t.right?t.right:this.right;if(r<=i)return e.x=e.y=e.width=e.height=0,e;var n=this.y<t.y?t.y:this.y,a=this.bottom>t.bottom?t.bottom:this.bottom;return a<=n?(e.x=e.y=e.width=e.height=0,e):(e.x=i,e.y=n,e.width=r-i,e.height=a-n,e)};et.prototype.union=function(t,e){e||(e=new et);var i=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),a=Math.max(this.y+this.height,t.y+t.height);return e.x=i,e.y=n,e.width=r-i,e.height=a-n,e};/*!
 * @pixi/mixin-cache-as-bitmap - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/mixin-cache-as-bitmap is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var iA=new wt;pe.prototype._cacheAsBitmap=!1;pe.prototype._cacheData=null;pe.prototype._cacheAsBitmapResolution=null;pe.prototype._cacheAsBitmapMultisample=oe.NONE;var bK=function(){function s(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}return s}();Object.defineProperties(pe.prototype,{cacheAsBitmapResolution:{get:function(){return this._cacheAsBitmapResolution},set:function(s){s!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=s,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get:function(){return this._cacheAsBitmapMultisample},set:function(s){s!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=s,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(s){if(this._cacheAsBitmap!==s){this._cacheAsBitmap=s;var t;s?(this._cacheData||(this._cacheData=new bK),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}}});pe.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))};pe.prototype._initCachedDisplayObject=function(t){var e;if(!(this._cacheData&&this._cacheData.sprite)){var i=this.alpha;this.alpha=1,t.batch.flush();var r=this.getLocalBounds(null,!0).clone();if(this.filters&&this.filters.length){var n=this.filters[0].padding;r.pad(n)}r.ceil(Z.RESOLUTION);var a=t.renderTexture.current,o=t.renderTexture.sourceFrame.clone(),h=t.renderTexture.destinationFrame.clone(),u=t.projection.transform,c=xe.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:(e=this.cacheAsBitmapMultisample)!==null&&e!==void 0?e:t.multisample}),l="cacheAsBitmap_"+Mn();this._cacheData.textureCacheId=l,Yt.addToCache(c.baseTexture,l),ut.addToCache(c,l);var _=this.transform.localTransform.copyTo(iA).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:c,clear:!0,transform:_,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=u,t.renderTexture.bind(a,o,h),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;var d=new Wt(c);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-(r.x/r.width),d.anchor.y=-(r.y/r.height),d.alpha=i,d._bounds=this._bounds,this._cacheData.sprite=d,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=d.containsPoint.bind(d)}};pe.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))};pe.prototype._initCachedDisplayObjectCanvas=function(t){if(!(this._cacheData&&this._cacheData.sprite)){var e=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;var r=t.context,n=t._projTransform;e.ceil(Z.RESOLUTION);var a=xe.create({width:e.width,height:e.height}),o="cacheAsBitmap_"+Mn();this._cacheData.textureCacheId=o,Yt.addToCache(a.baseTexture,o),ut.addToCache(a,o);var h=iA;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=e.x,h.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:a,clear:!0,transform:h,skipUpdateTransform:!1}),t.context=r,t._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;var u=new Wt(a);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(e.x/e.width),u.anchor.y=-(e.y/e.height),u.alpha=i,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=u.containsPoint.bind(u)}};pe.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};pe.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};pe.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Yt.removeFromCache(this._cacheData.textureCacheId),ut.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};pe.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};/*!
 * @pixi/mixin-get-child-by-name - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/mixin-get-child-by-name is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */pe.prototype.name=null;pi.prototype.getChildByName=function(t,e){for(var i=0,r=this.children.length;i<r;i++)if(this.children[i].name===t)return this.children[i];if(e)for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i];if(n.getChildByName){var a=n.getChildByName(t,!0);if(a)return a}}return null};/*!
 * @pixi/mixin-get-global-position - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/mixin-get-global-position is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */pe.prototype.getGlobalPosition=function(t,e){return t===void 0&&(t=new H),e===void 0&&(e=!1),this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};function DK(s){var t=this.constructor;return this.then(function(e){return t.resolve(s()).then(function(){return e})},function(e){return t.resolve(s()).then(function(){return t.reject(e)})})}function LK(s){var t=this;return new t(function(e,i){if(!(s&&typeof s.length<"u"))return i(new TypeError(typeof s+" "+s+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var r=Array.prototype.slice.call(s);if(r.length===0)return e([]);var n=r.length;function a(h,u){if(u&&(typeof u=="object"||typeof u=="function")){var c=u.then;if(typeof c=="function"){c.call(u,function(l){a(h,l)},function(l){r[h]={status:"rejected",reason:l},--n===0&&e(r)});return}}r[h]={status:"fulfilled",value:u},--n===0&&e(r)}for(var o=0;o<r.length;o++)a(o,r[o])})}function rA(s,t){this.name="AggregateError",this.errors=s,this.message=t||""}rA.prototype=Error.prototype;function UK(s){var t=this;return new t(function(e,i){if(!(s&&typeof s.length<"u"))return i(new TypeError("Promise.any accepts an array"));var r=Array.prototype.slice.call(s);if(r.length===0)return i();for(var n=[],a=0;a<r.length;a++)try{t.resolve(r[a]).then(e).catch(function(o){n.push(o),n.length===r.length&&i(new rA(n,"All promises were rejected"))})}catch(o){i(o)}})}var xK=setTimeout;function nA(s){return!!(s&&typeof s.length<"u")}function FK(){}function wK(s,t){return function(){s.apply(t,arguments)}}function ue(s){if(!(this instanceof ue))throw new TypeError("Promises must be constructed via new");if(typeof s!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],oA(s,this)}function aA(s,t){for(;s._state===3;)s=s._value;if(s._state===0){s._deferreds.push(t);return}s._handled=!0,ue._immediateFn(function(){var e=s._state===1?t.onFulfilled:t.onRejected;if(e===null){(s._state===1?Yd:eh)(t.promise,s._value);return}var i;try{i=e(s._value)}catch(r){eh(t.promise,r);return}Yd(t.promise,i)})}function Yd(s,t){try{if(t===s)throw new TypeError("A promise cannot be resolved with itself.");if(t&&(typeof t=="object"||typeof t=="function")){var e=t.then;if(t instanceof ue){s._state=3,s._value=t,Wd(s);return}else if(typeof e=="function"){oA(wK(e,t),s);return}}s._state=1,s._value=t,Wd(s)}catch(i){eh(s,i)}}function eh(s,t){s._state=2,s._value=t,Wd(s)}function Wd(s){s._state===2&&s._deferreds.length===0&&ue._immediateFn(function(){s._handled||ue._unhandledRejectionFn(s._value)});for(var t=0,e=s._deferreds.length;t<e;t++)aA(s,s._deferreds[t]);s._deferreds=null}function GK(s,t,e){this.onFulfilled=typeof s=="function"?s:null,this.onRejected=typeof t=="function"?t:null,this.promise=e}function oA(s,t){var e=!1;try{s(function(i){e||(e=!0,Yd(t,i))},function(i){e||(e=!0,eh(t,i))})}catch(i){if(e)return;e=!0,eh(t,i)}}ue.prototype.catch=function(s){return this.then(null,s)};ue.prototype.then=function(s,t){var e=new this.constructor(FK);return aA(this,new GK(s,t,e)),e};ue.prototype.finally=DK;ue.all=function(s){return new ue(function(t,e){if(!nA(s))return e(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(s);if(i.length===0)return t([]);var r=i.length;function n(o,h){try{if(h&&(typeof h=="object"||typeof h=="function")){var u=h.then;if(typeof u=="function"){u.call(h,function(c){n(o,c)},e);return}}i[o]=h,--r===0&&t(i)}catch(c){e(c)}}for(var a=0;a<i.length;a++)n(a,i[a])})};ue.any=UK;ue.allSettled=LK;ue.resolve=function(s){return s&&typeof s=="object"&&s.constructor===ue?s:new ue(function(t){t(s)})};ue.reject=function(s){return new ue(function(t,e){e(s)})};ue.race=function(s){return new ue(function(t,e){if(!nA(s))return e(new TypeError("Promise.race accepts an array"));for(var i=0,r=s.length;i<r;i++)ue.resolve(s[i]).then(t,e)})};ue._immediateFn=typeof setImmediate=="function"&&function(s){setImmediate(s)}||function(s){xK(s,0)};ue._unhandledRejectionFn=function(t){typeof console<"u"&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var _p=Object.getOwnPropertySymbols,BK=Object.prototype.hasOwnProperty,HK=Object.prototype.propertyIsEnumerable;function VK(s){if(s==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(s)}function kK(){try{if(!Object.assign)return!1;var s=new String("abc");if(s[5]="de",Object.getOwnPropertyNames(s)[0]==="5")return!1;for(var t={},e=0;e<10;e++)t["_"+String.fromCharCode(e)]=e;var i=Object.getOwnPropertyNames(t).map(function(n){return t[n]});if(i.join("")!=="0123456789")return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(n){r[n]=n}),Object.keys(Object.assign({},r)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var jK=kK()?Object.assign:function(s,t){for(var e,i=VK(s),r,n=1;n<arguments.length;n++){e=Object(arguments[n]);for(var a in e)BK.call(e,a)&&(i[a]=e[a]);if(_p){r=_p(e);for(var o=0;o<r.length;o++)HK.call(e,r[o])&&(i[r[o]]=e[r[o]])}}return i};const zK=uf(jK);/*!
 * @pixi/polyfill - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/polyfill is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */typeof globalThis>"u"&&(typeof self<"u"?self.globalThis=self:typeof global<"u"&&(global.globalThis=global));globalThis.Promise||(globalThis.Promise=ue);Object.assign||(Object.assign=zK);var YK=16;Date.now&&Date.prototype.getTime||(Date.now=function(){return new Date().getTime()});if(!(globalThis.performance&&globalThis.performance.now)){var WK=Date.now();globalThis.performance||(globalThis.performance={}),globalThis.performance.now=function(){return Date.now()-WK}}var X_=Date.now(),cp=["ms","moz","webkit","o"];for(var K_=0;K_<cp.length&&!globalThis.requestAnimationFrame;++K_){var q_=cp[K_];globalThis.requestAnimationFrame=globalThis[q_+"RequestAnimationFrame"],globalThis.cancelAnimationFrame=globalThis[q_+"CancelAnimationFrame"]||globalThis[q_+"CancelRequestAnimationFrame"]}globalThis.requestAnimationFrame||(globalThis.requestAnimationFrame=function(s){if(typeof s!="function")throw new TypeError(s+"is not a function");var t=Date.now(),e=YK+X_-t;return e<0&&(e=0),X_=t,globalThis.self.setTimeout(function(){X_=Date.now(),s(performance.now())},e)});globalThis.cancelAnimationFrame||(globalThis.cancelAnimationFrame=function(s){return clearTimeout(s)});Math.sign||(Math.sign=function(t){return t=Number(t),t===0||isNaN(t)?t:t>0?1:-1});Number.isInteger||(Number.isInteger=function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t});globalThis.ArrayBuffer||(globalThis.ArrayBuffer=Array);globalThis.Float32Array||(globalThis.Float32Array=Array);globalThis.Uint32Array||(globalThis.Uint32Array=Array);globalThis.Uint16Array||(globalThis.Uint16Array=Array);globalThis.Uint8Array||(globalThis.Uint8Array=Array);globalThis.Int32Array||(globalThis.Int32Array=Array);/*!
 * @pixi/sprite-tiling - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/sprite-tiling is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Xd=function(s,t){return Xd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])},Xd(s,t)};function hA(s,t){Xd(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var no=new H,XK=function(s){hA(t,s);function t(e,i,r){i===void 0&&(i=100),r===void 0&&(r=100);var n=s.call(this,e)||this;return n.tileTransform=new xp,n._width=i,n._height=r,n.uvMatrix=n.texture.uvMatrix||new Wp(e),n.pluginName="tilingSprite",n.uvRespectAnchor=!1,n}return Object.defineProperty(t.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(e){this.uvMatrix.clampMargin=e,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(e){this.tileTransform.scale.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(e){this.tileTransform.position.copyFrom(e)},enumerable:!1,configurable:!0}),t.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},t.prototype._render=function(e){var i=this._texture;!i||!i.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this))},t.prototype._calculateBounds=function(){var e=this._width*-this._anchor._x,i=this._height*-this._anchor._y,r=this._width*(1-this._anchor._x),n=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,e,i,r,n)},t.prototype.getLocalBounds=function(e){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new et),e=this._localBoundsRect),this._bounds.getRectangle(e)):s.prototype.getLocalBounds.call(this,e)},t.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,no);var i=this._width,r=this._height,n=-i*this.anchor._x;if(no.x>=n&&no.x<n+i){var a=-r*this.anchor._y;if(no.y>=a&&no.y<a+r)return!0}return!1},t.prototype.destroy=function(e){s.prototype.destroy.call(this,e),this.tileTransform=null,this.uvMatrix=null},t.from=function(e,i){var r=e instanceof ut?e:ut.from(e,i);return new t(r,i.width,i.height)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e},enumerable:!1,configurable:!0}),t}(Wt),KK=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`,dp=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,qK=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,ZK=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,QK=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,lu=new wt,JK=function(s){hA(t,s);function t(e){var i=s.call(this,e)||this;return e.runners.contextChange.add(i),i.quad=new Vp,i.state=ah.for2d(),i}return t.prototype.contextChange=function(){var e=this.renderer,i={globals:e.globalUniforms};this.simpleShader=vn.from(dp,KK,i),this.shader=e.context.webGLVersion>1?vn.from(ZK,QK,i):vn.from(dp,qK,i)},t.prototype.render=function(e){var i=this.renderer,r=this.quad,n=r.vertices;n[0]=n[6]=e._width*-e.anchor.x,n[1]=n[3]=e._height*-e.anchor.y,n[2]=n[4]=e._width*(1-e.anchor.x),n[5]=n[7]=e._height*(1-e.anchor.y);var a=e.uvRespectAnchor?e.anchor.x:0,o=e.uvRespectAnchor?e.anchor.y:0;n=r.uvs,n[0]=n[6]=-a,n[1]=n[3]=-o,n[2]=n[4]=1-a,n[5]=n[7]=1-o,r.invalidate();var h=e._texture,u=h.baseTexture,c=u.alphaMode>0,l=e.tileTransform.localTransform,_=e.uvMatrix,d=u.isPowerOfTwo&&h.frame.width===u.width&&h.frame.height===u.height;d&&(u._glTextures[i.CONTEXT_UID]?d=u.wrapMode!==qi.CLAMP:u.wrapMode===qi.CLAMP&&(u.wrapMode=qi.REPEAT));var g=d?this.simpleShader:this.shader,m=h.width,p=h.height,T=e._width,A=e._height;lu.set(l.a*m/T,l.b*m/A,l.c*p/T,l.d*p/A,l.tx/T,l.ty/A),lu.invert(),d?lu.prepend(_.mapCoord):(g.uniforms.uMapCoord=_.mapCoord.toArray(!0),g.uniforms.uClampFrame=_.uClampFrame,g.uniforms.uClampOffset=_.uClampOffset),g.uniforms.uTransform=lu.toArray(!0),g.uniforms.uColor=$0(e.tint,e.worldAlpha,g.uniforms.uColor,c),g.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),g.uniforms.uSampler=h,i.shader.bind(g),i.geometry.bind(r),this.state.blendMode=J0(e.blendMode,c),i.state.set(this.state),i.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},t.extension={name:"tilingSprite",type:ve.RendererPlugin},t}(Tl);er.add(Zp,OK,JK,Qb,tN,KM,rC);class fp{constructor(){this.id=0,this.data=null,this.image=null}getImage(){return this.image?this.image:this.data?qt.generateImage(this.data):null}}class Qe extends me{constructor(t){super(null,null),this._type=t}get type(){return this._type}}Qe.IMAGE_LOADED="ROAUM_IMAGE_LOADED";Qe.IMAGE_LOADING_FAILED="ROAUM_IMAGE_FAILED";class de extends me{constructor(){super(null,null)}}class uA extends de{constructor(t,e){super(),this._itemType=t,this._itemName=e}get itemType(){return this._itemType}get itemName(){return this._itemName}}class $f extends de{constructor(t=0){super(),this._numberOfWords=t}get numberOfWords(){return this._numberOfWords}}class lA extends de{constructor(t=0){super(),this._danceStyle=t}get danceStyle(){return this._danceStyle}}class _A extends de{constructor(t,e=0){super(),this._effect=t,this._delayMilliseconds=e}get effect(){return this._effect}get delayMilliseconds(){return this._delayMilliseconds}}class cA extends de{constructor(t){super(),this._gainedExperience=t}get gainedExperience(){return this._gainedExperience}}class dA extends de{constructor(t=0){super(),this._expressionType=t}get expressionType(){return this._expressionType}}class ol extends de{constructor(t,e=null,i=null,r=!1){super(),this._figure=t,this._gender=e,this._subType=i,this._isRiding=r}get figure(){return this._figure}get gender(){return this._gender}get subType(){return this._subType}get isRiding(){return this._isRiding}}class fA extends de{constructor(t=0){super(),this._level=t}get level(){return this._level}}class gA extends de{constructor(t=0){super(),this._gesture=t}get gesture(){return this._gesture}}class $K extends de{constructor(t){super(),this._guideStatus=t}get guideStatus(){return this._guideStatus}}class EA extends de{constructor(t=!1){super(),this._isMuted=t}get isMuted(){return this._isMuted}}class pA extends de{}class mA extends de{constructor(t){super(),this._gesture=t}get gesture(){return this._gesture}}class IA extends de{constructor(t){super(),this._value=t}get value(){return this._value}}class TA extends de{constructor(t){super(),this._isPlayingGame=t}get isPlayingGame(){return this._isPlayingGame}}class tg extends de{constructor(t,e=""){super(),this._postureType=t,this._parameter=e}get postureType(){return this._postureType}get parameter(){return this._parameter}}class hl extends de{constructor(t){super(),this._selected=t}get selected(){return this._selected}}class RA extends de{constructor(t=0){super(),this._signType=t}get signType(){return this._signType}}class eg extends de{constructor(t=!1){super(),this._isSleeping=t}get isSleeping(){return this._isSleeping}}class OA extends de{constructor(t=!1){super(),this._isTyping=t}get isTyping(){return this._isTyping}}class Dr extends me{constructor(t,e,i,r=!1){super(t,i),this._targetLocation=e,this._isSlide=r}get targetLocation(){return this._targetLocation?this._targetLocation:this.location}get isSlide(){return this._isSlide}}class ul extends Dr{constructor(t,e,i,r,n,a){super(t,e,i),this._headDirection=r,this._canStandUp=n,this._baseY=a}get headDirection(){return this._headDirection}get canStandUp(){return this._canStandUp}get baseY(){return this._baseY}}class AA extends de{constructor(t){super(),this._itemType=t}get itemType(){return this._itemType}}class Ft extends me{constructor(t,e,i=null){super(null,null),this._state=t,this._data=e,this._extra=i}get state(){return this._state}get data(){return this._data}get extra(){return this._extra}}class ba extends me{constructor(t,e){super(null,null),this._badgeId=t,this._assetName=e}get badgeId(){return this._badgeId}get assetName(){return this._assetName}}ba.BADGE_LOADED="ROGBUM_BADGE_LOADED";class vA extends me{constructor(t,e,i){super(t,e),this._height=i}get height(){return this._height}}class sg extends me{constructor(t){super(null,null),this._data=t}get data(){return this._data}}class SA extends me{constructor(t,e){super(null,null),this._numberKey=t,this._numberValue=e}get numberKey(){return this._numberKey}get numberValue(){return this._numberValue}}class ll extends me{constructor(t,e,i,r){super(null,null),this._type=t,this._color=e,this._light=i,this._backgroundOnly=r}get type(){return this._type}get color(){return this._color}get light(){return this._light}get backgroundOnly(){return this._backgroundOnly}}ll.BACKGROUND_COLOR="RORCUM_BACKGROUND_COLOR";class zi extends me{constructor(t,e,i=0,r=0,n=0,a=0){super(null,null),this._type=t,this._id=e,this._x=i,this._y=r,this._width=n,this._height=a}get type(){return this._type}get id(){return this._id}get x(){return this._x}get y(){return this._y}get width(){return this._width}get height(){return this._height}}zi.ADD="ORPFHUM_ADD";zi.REMOVE="ORPFHUM_REMOVE";const yA=class extends me{constructor(s){super(null,null),this._type=yA.UPDATE_MAP,this._mapData=s}get type(){return this._type}get mapData(){return this._mapData}};let ig=yA;ig.UPDATE_MAP="RORMUM_UPDATE_MAP";class Ce extends me{constructor(t,e,i=null,r=null,n="window"){super(null,null),this._type=t,this._maskId=e,this._maskType=i,this._maskLocation=r?new S(r.x,r.y,r.z):null,this._maskCategory=n}get type(){return this._type}get maskId(){return this._maskId}get maskType(){return this._maskType}get maskLocation(){return this._maskLocation}get maskCategory(){return this._maskCategory}}Ce.ADD_MASK="RORMUM_ADD_MASK";Ce.REMOVE_MASK="RORMUM_ADD_MASK";Ce.DOOR="door";Ce.WINDOW="window";Ce.HOLE="hole";class Yi extends me{constructor(t,e){super(null,null),this._type=t,this._value=e}get type(){return this._type}get value(){return this._value}}Yi.WALL_THICKNESS="RORPPUM_WALL_THICKNESS";Yi.FLOOR_THICKNESS="RORPVUM_FLOOR_THICKNESS";class Wi extends me{constructor(t,e){super(null,null),this._type=t,this._visible=e}get type(){return this._type}get visible(){return this._visible}}Wi.WALL_VISIBILITY="RORPVUM_WALL_VISIBILITY";Wi.FLOOR_VISIBILITY="RORPVUM_FLOOR_VISIBILITY";class ye extends me{constructor(t,e){super(null,null),this._type=t,this._value=e}get type(){return this._type}get value(){return this._value}}ye.ROOM_WALL_UPDATE="RORUM_ROOM_WALL_UPDATE";ye.ROOM_FLOOR_UPDATE="RORUM_ROOM_FLOOR_UPDATE";ye.ROOM_LANDSCAPE_UPDATE="RORUM_ROOM_LANDSCAPE_UPDATE";class sh extends de{constructor(t){super(),this._selected=t}get selected(){return this._selected}}class Zn extends me{constructor(t,e,i,r,n=!1){super(t,null),this._height=e,this._visible=i,this._sourceEventId=r,this._toggleVisibility=n}get height(){return this._height}get visible(){return this._visible}get sourceEventId(){return this._sourceEventId}get toggleVisibility(){return this._toggleVisibility}}class Xi extends me{constructor(t){super(null,null),this._type=t}get type(){return this._type}}Xi.ENABLED="ROVUM_ENABLED";Xi.DISABLED="ROVUM_DISABLED";const Kd=class extends bl{constructor(){super(),this._liftAmount=0,this._location=new S,this._locationDelta=new S,this._lastUpdateTime=0,this._changeTime=0,this._updateInterval=Kd.DEFAULT_UPDATE_INTERVAL}onDispose(){this._liftAmount=0,super.onDispose()}update(s){super.update(s);const t=this.getLocationOffset(),e=this.object&&this.object.model;if(e&&(t?this._liftAmount!==t.z&&(this._liftAmount=t.z,e.setValue(I.FURNITURE_LIFT_AMOUNT,this._liftAmount)):this._liftAmount!==0&&(this._liftAmount=0,e.setValue(I.FURNITURE_LIFT_AMOUNT,this._liftAmount))),this._locationDelta.length>0||t){const i=Kd.TEMP_VECTOR;let r=this.time-this._changeTime;r===this._updateInterval>>1&&r++,r>this._updateInterval&&(r=this._updateInterval),this._locationDelta.length>0?(i.assign(this._locationDelta),i.multiply(r/this._updateInterval),i.add(this._location)):i.assign(this._location),t&&i.add(t),this.object.setLocation(i),r===this._updateInterval&&(this._locationDelta.x=0,this._locationDelta.y=0,this._locationDelta.z=0)}this._lastUpdateTime=this.time}setObject(s){super.setObject(s),s&&this._location.assign(s.getLocation())}processUpdateMessage(s){if(s&&(super.processUpdateMessage(s),s.location&&this._location.assign(s.location),s instanceof Dr))return this.processMoveMessage(s)}processMoveMessage(s){!s||!this.object||!s.location||(this._changeTime=this._lastUpdateTime,this._locationDelta.assign(s.targetLocation),this._locationDelta.subtract(this._location))}getLocationOffset(){return null}get lastUpdateTime(){return this._lastUpdateTime}set updateInterval(s){s<=0&&(s=1),this._updateInterval=s}};let Lr=Kd;Lr.DEFAULT_UPDATE_INTERVAL=500;Lr.TEMP_VECTOR=new S;const Ze=class extends Lr{constructor(){super(),this._selected=!1,this._reportedLocation=null,this._effectChangeTimeStamp=0,this._newEffect=0,this._blinkingStartTimestamp=_t()+this.randomBlinkStartTimestamp(),this._blinkingEndTimestamp=0,this._talkingEndTimestamp=0,this._talkingPauseStartTimestamp=0,this._talkingPauseEndTimestamp=0,this._carryObjectStartTimestamp=0,this._carryObjectEndTimestamp=0,this._allowUseCarryObject=!1,this._animationEndTimestamp=0,this._signEndTimestamp=0,this._gestureEndTimestamp=0,this._numberValueEndTimestamp=0}getEventTypes(){const s=[$.CLICK,$.DOUBLE_CLICK,Xe.POSITION_CHANGED,$.MOUSE_ENTER,$.MOUSE_LEAVE,G.MOUSE_BUTTON,G.MOUSE_ARROW];return this.mergeTypes(super.getEventTypes(),s)}dispose(){this._selected&&this.object&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new Xe(Xe.OBJECT_REMOVED,this.object)),super.dispose(),this._reportedLocation=null}update(s){if(super.update(s),this._selected&&this.object&&this.eventDispatcher){const e=this.object.getLocation();(!this._reportedLocation||this._reportedLocation.x!==e.x||this._reportedLocation.y!==e.y||this._reportedLocation.z!==e.z)&&(this._reportedLocation||(this._reportedLocation=new S),this._reportedLocation.assign(e),this.eventDispatcher.dispatchEvent(new Xe(Xe.POSITION_CHANGED,this.object)))}const t=this.object&&this.object.model;t&&this.updateModel(this.time,t)}updateModel(s,t){this._talkingEndTimestamp>0&&(s>this._talkingEndTimestamp?(t.setValue(I.FIGURE_TALK,0),this._talkingEndTimestamp=0,this._talkingPauseStartTimestamp=0,this._talkingPauseEndTimestamp=0):!this._talkingPauseEndTimestamp&&!this._talkingPauseStartTimestamp?(this._talkingPauseStartTimestamp=s+this.randomTalkingPauseStartTimestamp(),this._talkingPauseEndTimestamp=this._talkingPauseStartTimestamp+this.randomTalkingPauseEndTimestamp()):this._talkingPauseStartTimestamp>0&&s>this._talkingPauseStartTimestamp?(t.setValue(I.FIGURE_TALK,0),this._talkingPauseStartTimestamp=0):this._talkingPauseEndTimestamp>0&&s>this._talkingPauseEndTimestamp&&(t.setValue(I.FIGURE_TALK,1),this._talkingPauseEndTimestamp=0)),this._animationEndTimestamp>0&&s>this._animationEndTimestamp&&(t.setValue(I.FIGURE_EXPRESSION,0),this._animationEndTimestamp=0),this._gestureEndTimestamp>0&&s>this._gestureEndTimestamp&&(t.setValue(I.FIGURE_GESTURE,0),this._gestureEndTimestamp=0),this._signEndTimestamp>0&&s>this._signEndTimestamp&&(t.setValue(I.FIGURE_SIGN,-1),this._signEndTimestamp=0),this._carryObjectEndTimestamp>0&&s>this._carryObjectEndTimestamp&&(t.setValue(I.FIGURE_CARRY_OBJECT,0),t.setValue(I.FIGURE_USE_OBJECT,0),this._carryObjectStartTimestamp=0,this._carryObjectEndTimestamp=0,this._allowUseCarryObject=!1),this._allowUseCarryObject&&s-this._carryObjectStartTimestamp>5e3&&((s-this._carryObjectStartTimestamp)%1e4<1e3?t.setValue(I.FIGURE_USE_OBJECT,1):t.setValue(I.FIGURE_USE_OBJECT,0)),this._blinkingStartTimestamp>-1&&s>this._blinkingStartTimestamp&&(t.setValue(I.FIGURE_BLINK,1),this._blinkingStartTimestamp=s+this.randomBlinkStartTimestamp(),this._blinkingEndTimestamp=s+this.randomBlinkEndTimestamp()),this._blinkingEndTimestamp>0&&s>this._blinkingEndTimestamp&&(t.setValue(I.FIGURE_BLINK,0),this._blinkingEndTimestamp=0),this._effectChangeTimeStamp>0&&s>this._effectChangeTimeStamp&&(t.setValue(I.FIGURE_EFFECT,this._newEffect),this._effectChangeTimeStamp=0),this._numberValueEndTimestamp>0&&s>this._numberValueEndTimestamp&&(t.setValue(I.FIGURE_NUMBER_VALUE,0),this._numberValueEndTimestamp=0)}processUpdateMessage(s){if(!s||!this.object)return;super.processUpdateMessage(s);const t=this.object&&this.object.model;if(t){if(s instanceof tg){t.setValue(I.FIGURE_POSTURE,s.postureType),t.setValue(I.FIGURE_POSTURE_PARAMETER,s.parameter);return}if(s instanceof $f){t.setValue(I.FIGURE_TALK,1),this._talkingEndTimestamp=this.time+s.numberOfWords*1e3;return}if(s instanceof OA){t.setValue(I.FIGURE_IS_TYPING,s.isTyping?1:0);return}if(s instanceof EA){t.setValue(I.FIGURE_IS_MUTED,s.isMuted?1:0);return}if(s instanceof TA){t.setValue(I.FIGURE_IS_PLAYING_GAME,s.isPlayingGame?1:0);return}if(s instanceof ul){t.setValue(I.HEAD_DIRECTION,s.headDirection),t.setValue(I.FIGURE_CAN_STAND_UP,s.canStandUp),t.setValue(I.FIGURE_VERTICAL_OFFSET,s.baseY);return}if(s instanceof gA){t.setValue(I.FIGURE_GESTURE,s.gesture),this._gestureEndTimestamp=this.time+3e3;return}if(s instanceof dA){t.setValue(I.FIGURE_EXPRESSION,s.expressionType),this._animationEndTimestamp=x.getExpressionTimeout(t.getValue(I.FIGURE_EXPRESSION)),this._animationEndTimestamp>-1&&(this._animationEndTimestamp+=this.time);return}if(s instanceof lA){t.setValue(I.FIGURE_DANCE,s.danceStyle);return}if(s instanceof eg){t.setValue(I.FIGURE_SLEEP,s.isSleeping?1:0),s.isSleeping?this._blinkingStartTimestamp=-1:this._blinkingStartTimestamp=this.time+this.randomBlinkStartTimestamp();return}if(s instanceof IA){t.setValue(I.FIGURE_NUMBER_VALUE,s.value),this._numberValueEndTimestamp=this.time+3e3;return}if(s instanceof _A){this.updateAvatarEffect(s.effect,s.delayMilliseconds,t);return}if(s instanceof uA){t.setValue(I.FIGURE_CARRY_OBJECT,s.itemType),t.setValue(I.FIGURE_USE_OBJECT,0),s.itemType===0?(this._carryObjectStartTimestamp=0,this._carryObjectEndTimestamp=0,this._allowUseCarryObject=!1):(this._carryObjectStartTimestamp=this.time,s.itemType<Ze.MAX_HAND_ID?(this._carryObjectEndTimestamp=0,this._allowUseCarryObject=s.itemType<=Ze.MAX_HAND_USE_ID):(this._carryObjectEndTimestamp=this._carryObjectStartTimestamp+1500,this._allowUseCarryObject=!1));return}if(s instanceof AA){t.setValue(I.FIGURE_USE_OBJECT,s.itemType);return}if(s instanceof RA){t.setValue(I.FIGURE_SIGN,s.signType),this._signEndTimestamp=this.time+5e3;return}if(s instanceof fA){t.setValue(I.FIGURE_FLAT_CONTROL,s.level);return}if(s instanceof ol){t.setValue(I.FIGURE,s.figure),t.setValue(I.GENDER,s.gender);return}if(s instanceof hl){this._selected=s.selected,this._reportedLocation=null;return}if(s instanceof pA){t.setValue(I.OWN_USER,1);return}}}updateAvatarEffect(s,t,e){if(s===Ze.EFFECT_TYPE_SPLASH)this._effectChangeTimeStamp=_t()+Ze.EFFECT_SPLASH_LENGTH,this._newEffect=Ze.EFFECT_TYPE_SWIM;else if(s===Ze.EFFECT_TYPE_SPLASH_DARK)this._effectChangeTimeStamp=_t()+Ze.EFFECT_SPLASH_LENGTH,this._newEffect=Ze.EFFECT_TYPE_SWIM_DARK;else if(e.getValue(I.FIGURE_EFFECT)===Ze.EFFECT_TYPE_SWIM)this._effectChangeTimeStamp=_t()+Ze.EFFECT_SPLASH_LENGTH,this._newEffect=s,s=Ze.EFFECT_TYPE_SPLASH;else if(e.getValue(I.FIGURE_EFFECT)===Ze.EFFECT_TYPE_SWIM_DARK)this._effectChangeTimeStamp=_t()+Ze.EFFECT_SPLASH_LENGTH,this._newEffect=s,s=Ze.EFFECT_TYPE_SPLASH_DARK;else if(t===0)this._effectChangeTimeStamp=0;else{this._effectChangeTimeStamp=_t()+t,this._newEffect=s;return}e.setValue(I.FIGURE_EFFECT,s)}mouseEvent(s,t){let e=null;switch(s.type){case k.MOUSE_CLICK:e=$.CLICK;break;case k.DOUBLE_CLICK:e=$.DOUBLE_CLICK;break;case k.ROLL_OVER:e=$.MOUSE_ENTER,this.object.model&&this.object.model.setValue(I.FIGURE_HIGHLIGHT,1),this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new G(G.MOUSE_BUTTON,this.object));break;case k.ROLL_OUT:e=$.MOUSE_LEAVE,this.object.model&&this.object.model.setValue(I.FIGURE_HIGHLIGHT,0),this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new G(G.MOUSE_ARROW,this.object));break}e&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new $(e,this.object,s.eventId,s.altKey,s.ctrlKey,s.shiftKey,s.buttonDown))}randomTalkingPauseStartTimestamp(){return 100+Math.random()*200}randomTalkingPauseEndTimestamp(){return 75+Math.random()*75}randomBlinkStartTimestamp(){return 4500+Math.random()*1e3}randomBlinkEndTimestamp(){return 50+Math.random()*200}};let zr=Ze;zr.MAX_HAND_ID=999999999;zr.MAX_HAND_USE_ID=999;zr.EFFECT_TYPE_SPLASH=28;zr.EFFECT_SPLASH_LENGTH=500;zr.EFFECT_TYPE_SWIM=29;zr.EFFECT_TYPE_SPLASH_DARK=184;zr.EFFECT_TYPE_SWIM_DARK=185;const Us=class extends Lr{constructor(){super(),this._sizeX=0,this._sizeY=0,this._sizeZ=0,this._centerX=0,this._centerY=0,this._centerZ=0,this._directions=[],this._mouseOver=!1,this._locationOffset=new S,this._bouncingStep=0,this._storedRotateMessage=null,this._directionInitialized=!1,Us.BOUNCING_STEPS===-1&&(Us.BOUNCING_STEPS=rt.getValue("furni.rotation.bounce.steps",8)),Us.BOUNCING_Z===-1&&(Us.BOUNCING_Z=rt.getValue("furni.rotation.bounce.height",.0625))}getEventTypes(){const s=[Tt.STATE_CHANGE,$.CLICK,$.MOUSE_DOWN,$.MOUSE_DOWN_LONG,kt.ROOM_AD_TOOLTIP_SHOW,kt.ROOM_AD_TOOLTIP_HIDE,kt.ROOM_AD_FURNI_DOUBLE_CLICK,kt.ROOM_AD_FURNI_CLICK];return this.widget&&s.push(M.OPEN_WIDGET,M.CLOSE_WIDGET),this.contextMenu&&s.push(M.OPEN_FURNI_CONTEXT_MENU,M.CLOSE_FURNI_CONTEXT_MENU),this.mergeTypes(super.getEventTypes(),s)}initialize(s){if(!s)return;const t=this.object&&this.object.model;if(t){if(s.logic){if(s.logic.model){const e=s.logic.model.dimensions;e&&(this._sizeX=e.x,this._sizeY=e.y,this._sizeZ=e.z,this._centerX=this._sizeX/2,this._centerY=this._sizeY/2,this._centerZ=this._sizeZ/2);const i=s.logic.model.directions;if(i&&i.length){for(const r of i)this._directions.push(r);this._directions.sort((r,n)=>r-n)}}if(s.logic.customVars){const e=s.logic.customVars.variables;e&&e.length&&t.setValue(I.FURNITURE_CUSTOM_VARIABLES,e)}}t.setValue(I.FURNITURE_SIZE_X,this._sizeX),t.setValue(I.FURNITURE_SIZE_Y,this._sizeY),t.setValue(I.FURNITURE_SIZE_Z,this._sizeZ),t.setValue(I.FURNITURE_CENTER_X,this._centerX),t.setValue(I.FURNITURE_CENTER_Y,this._centerY),t.setValue(I.FURNITURE_CENTER_Z,this._centerZ),t.setValue(I.FURNITURE_ALLOWED_DIRECTIONS,this._directions),t.setValue(I.FURNITURE_ALPHA_MULTIPLIER,1)}}onDispose(){this._storedRotateMessage=null,this._directions=null,super.onDispose()}setObject(s){super.setObject(s),s&&s.getLocation().length&&(this._directionInitialized=!0)}getAdClickUrl(s){return s.getValue(I.FURNITURE_AD_URL)}handleAdClick(s,t,e){this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new kt(kt.ROOM_AD_FURNI_CLICK,this.object))}update(s){super.update(s),this._bouncingStep>0&&(this._bouncingStep++,this._bouncingStep>Us.BOUNCING_STEPS&&(this._bouncingStep=0))}processUpdateMessage(s){if(s instanceof Ft){this.processDataUpdateMessage(s);return}if(s instanceof vA){this.processObjectHeightUpdateMessage(s);return}if(s instanceof sg){this.processItemDataUpdateMessage(s);return}if(this._mouseOver=!1,s.location&&s.direction){if(!(s instanceof Dr)){const t=this.object.getDirection(),e=this.object.getLocation();t.x!==s.direction.x&&this._directionInitialized&&e.x===s.location.x&&e.y===s.location.y&&e.z===s.location.z&&(this._bouncingStep=1,this._storedRotateMessage=new me(s.location,s.direction),s=null)}this._directionInitialized=!0}if(s instanceof sh&&this.contextMenu&&this.eventDispatcher&&this.object){const t=s.selected?M.OPEN_FURNI_CONTEXT_MENU:M.CLOSE_FURNI_CONTEXT_MENU;this.eventDispatcher.dispatchEvent(new M(t,this.object))}super.processUpdateMessage(s)}processDataUpdateMessage(s){s&&(this.object.setState(s.state,0),s.data&&s.data.writeRoomObjectModel(this.object.model),s.extra!==null&&this.object.model.setValue(I.FURNITURE_EXTRAS,s.extra.toString()),this.object.model.setValue(I.FURNITURE_STATE_UPDATE_TIME,this.lastUpdateTime))}processObjectHeightUpdateMessage(s){s&&this.object.model.setValue(I.FURNITURE_SIZE_Z,s.height)}processItemDataUpdateMessage(s){s&&this.object.model.setValue(I.FURNITURE_ITEMDATA,s.data)}mouseEvent(s,t){const e=this.getAdClickUrl(this.object.model);switch(s.type){case k.MOUSE_MOVE:if(this.eventDispatcher){const i=new $($.MOUSE_MOVE,this.object,s.eventId,s.altKey,s.ctrlKey,s.shiftKey,s.buttonDown);i.localX=s.localX,i.localY=s.localY,i.spriteOffsetX=s.spriteOffsetX,i.spriteOffsetY=s.spriteOffsetY,this.eventDispatcher.dispatchEvent(i)}return;case k.ROLL_OVER:if(!this._mouseOver){if(this.eventDispatcher){e&&e.indexOf("http")===0&&this.eventDispatcher.dispatchEvent(new kt(kt.ROOM_AD_TOOLTIP_SHOW,this.object));const i=new $($.MOUSE_ENTER,this.object,s.eventId,s.altKey,s.ctrlKey,s.shiftKey,s.buttonDown);i.localX=s.localX,i.localY=s.localY,i.spriteOffsetX=s.spriteOffsetX,i.spriteOffsetY=s.spriteOffsetY,this.eventDispatcher.dispatchEvent(i)}this._mouseOver=!0}return;case k.ROLL_OUT:if(this._mouseOver){if(this.eventDispatcher){e&&e.indexOf("http")===0&&this.eventDispatcher.dispatchEvent(new kt(kt.ROOM_AD_TOOLTIP_HIDE,this.object));const i=new $($.MOUSE_LEAVE,this.object,s.eventId,s.altKey,s.ctrlKey,s.shiftKey,s.buttonDown);i.localX=s.localX,i.localY=s.localY,i.spriteOffsetX=s.spriteOffsetX,i.spriteOffsetY=s.spriteOffsetY,this.eventDispatcher.dispatchEvent(i)}this._mouseOver=!1}return;case k.DOUBLE_CLICK:this.useObject();return;case k.MOUSE_CLICK:if(this.eventDispatcher){const i=new $($.CLICK,this.object,s.eventId,s.altKey,s.ctrlKey,s.shiftKey,s.buttonDown);i.localX=s.localX,i.localY=s.localY,i.spriteOffsetX=s.spriteOffsetX,i.spriteOffsetY=s.spriteOffsetY,this.eventDispatcher.dispatchEvent(i),e&&e.indexOf("http")===0&&this.eventDispatcher.dispatchEvent(new kt(kt.ROOM_AD_TOOLTIP_HIDE,this.object)),e&&e.length&&this.handleAdClick(this.object.id,this.object.type,e)}return;case k.MOUSE_DOWN:if(this.eventDispatcher){const i=new $($.MOUSE_DOWN,this.object,s.eventId,s.altKey,s.ctrlKey,s.shiftKey,s.buttonDown);this.eventDispatcher.dispatchEvent(i)}return;case k.MOUSE_DOWN_LONG:if(this.eventDispatcher){const i=new $($.MOUSE_DOWN_LONG,this.object,s.eventId,s.altKey,s.ctrlKey,s.shiftKey,s.buttonDown);this.eventDispatcher.dispatchEvent(i)}return}}getLocationOffset(){return this._bouncingStep<=0?null:(this._locationOffset.x=0,this._locationOffset.y=0,this._bouncingStep<=Us.BOUNCING_STEPS/2?this._locationOffset.z=Us.BOUNCING_Z*this._bouncingStep:this._bouncingStep<=Us.BOUNCING_STEPS&&(this._storedRotateMessage&&(super.processUpdateMessage(this._storedRotateMessage),this._storedRotateMessage=null),this._locationOffset.z=Us.BOUNCING_Z*(Us.BOUNCING_STEPS-this._bouncingStep)),this._locationOffset)}useObject(){if(!this.object||!this.eventDispatcher)return;const s=this.getAdClickUrl(this.object.model);s&&s.length&&this.eventDispatcher.dispatchEvent(new kt(kt.ROOM_AD_FURNI_DOUBLE_CLICK,this.object,null,s)),this.widget&&this.eventDispatcher.dispatchEvent(new M(M.OPEN_WIDGET,this.object)),this.eventDispatcher.dispatchEvent(new Tt(Tt.STATE_CHANGE,this.object))}tearDown(){this.object.model.getValue(I.FURNITURE_REAL_ROOM_OBJECT)===1&&(this.widget&&this.eventDispatcher.dispatchEvent(new M(M.CLOSE_WIDGET,this.object)),this.contextMenu&&this.eventDispatcher.dispatchEvent(new M(M.CLOSE_FURNI_CONTEXT_MENU,this.object))),super.tearDown()}};let yt=Us;yt.BOUNCING_STEPS=-1;yt.BOUNCING_Z=-1;class CA extends yt{getEventTypes(){const t=[M.BADGE_DISPLAY_ENGRAVING,gi.LOAD_BADGE];return this.mergeTypes(super.getEventTypes(),t)}processUpdateMessage(t){if(super.processUpdateMessage(t),!!this.object){if(t instanceof Ft){const e=t.data;e instanceof Ma&&this.updateBadge(e.getValue(1));return}if(t instanceof ba){t.assetName!=="loading_icon"&&(this.object.model.setValue(I.FURNITURE_BADGE_ASSET_NAME,t.assetName),this.object.model.setValue(I.FURNITURE_BADGE_IMAGE_STATUS,1),this.update(_t()));return}}}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.BADGE_DISPLAY_ENGRAVING,this.object))}updateBadge(t){t!==""&&this.eventDispatcher&&(this.object.model.setValue(I.FURNITURE_BADGE_IMAGE_STATUS,-1),this.eventDispatcher.dispatchEvent(new gi(gi.LOAD_BADGE,this.object,t,!1)))}}const on=class extends CA{getEventTypes(){const s=[M.ACHIEVEMENT_RESOLUTION_OPEN,M.ACHIEVEMENT_RESOLUTION_ENGRAVING,M.ACHIEVEMENT_RESOLUTION_FAILED,gi.LOAD_BADGE];return this.mergeTypes(super.getEventTypes(),s)}processUpdateMessage(s){if(super.processUpdateMessage(s),s instanceof ba&&s.assetName!=="loading_icon"&&this.object.model.setValue(I.FURNITURE_BADGE_VISIBLE_IN_STATE,on.BADGE_VISIBLE_IN_STATE),s instanceof sh){if(!this.eventDispatcher||!this.object)return;this.eventDispatcher.dispatchEvent(new M(M.CLOSE_FURNI_CONTEXT_MENU,this.object))}}useObject(){if(!this.object||!this.eventDispatcher)return;let s=null;switch(this.object.getState(0)){case on.STATE_RESOLUTION_NOT_STARTED:case on.STATE_RESOLUTION_IN_PROGRESS:s=new M(M.ACHIEVEMENT_RESOLUTION_OPEN,this.object);break;case on.STATE_RESOLUTION_ACHIEVED:s=new M(M.ACHIEVEMENT_RESOLUTION_ENGRAVING,this.object);break;case on.STATE_RESOLUTION_FAILED:s=new M(M.ACHIEVEMENT_RESOLUTION_FAILED,this.object);break}s&&this.eventDispatcher.dispatchEvent(s)}updateBadge(s){s!==on.ACH_NOT_SET&&super.updateBadge(s)}};let Vn=on;Vn.STATE_RESOLUTION_NOT_STARTED=0;Vn.STATE_RESOLUTION_IN_PROGRESS=1;Vn.STATE_RESOLUTION_ACHIEVED=2;Vn.STATE_RESOLUTION_FAILED=3;Vn.ACH_NOT_SET="ach_0";Vn.BADGE_VISIBLE_IN_STATE=2;class t7 extends yt{constructor(){super(),this.onRoomToObjectOwnAvatarMoveEvent=this.onRoomToObjectOwnAvatarMoveEvent.bind(this)}initialize(t){super.initialize(t),this.eventDispatcher&&this.eventDispatcher.addEventListener(Qo.ROAME_MOVE_TO,this.onRoomToObjectOwnAvatarMoveEvent)}tearDown(){this.eventDispatcher&&this.eventDispatcher.removeEventListener(Qo.ROAME_MOVE_TO,this.onRoomToObjectOwnAvatarMoveEvent),super.tearDown()}onRoomToObjectOwnAvatarMoveEvent(t){if(!t||!this.object)return;const e=this.object.getLocation(),i=t.targetLocation;if(!i)return;let r=this.object.model.getValue(I.FURNITURE_SIZE_X),n=this.object.model.getValue(I.FURNITURE_SIZE_Y);const a=(Math.floor(this.object.getDirection().x)+45)%360/90;(a===1||a===3)&&([r,n]=[n,r]),i.x>=e.x&&i.x<e.x+r&&i.y>=e.y&&i.y<e.y+n?this.object.setState(1,0):this.object.setState(0,0)}}class e7 extends yt{getEventTypes(){const t=[M.CLOTHING_CHANGE];return this.mergeTypes(super.getEventTypes(),t)}initialize(t){super.initialize(t);const e=this.object.model.getValue(I.FURNITURE_DATA);this.updateClothingData(e)}processUpdateMessage(t){super.processUpdateMessage(t),t instanceof Ft&&t.data&&this.updateClothingData(t.data.getLegacyString())}updateClothingData(t){if(!t||!t.length)return;const[e,i]=t.split(",");e&&e.length&&this.object.model.setValue(I.FURNITURE_CLOTHING_BOY,e),i&&i.length&&this.object.model.setValue(I.FURNITURE_CLOTHING_GIRL,i)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.CLOTHING_CHANGE,this.object))}}class s7 extends yt{getEventTypes(){const t=[Tt.STATE_CHANGE];return this.mergeTypes(super.getEventTypes(),t)}mouseEvent(t,e){if(!t||!e||!this.object)return;let i=null;switch(t.type){case k.DOUBLE_CLICK:switch(t.spriteTag){case"start_stop":i=new Tt(Tt.STATE_CHANGE,this.object,1);break;case"reset":i=new Tt(Tt.STATE_CHANGE,this.object,2);break}if(this.eventDispatcher&&i){this.eventDispatcher.dispatchEvent(i);return}break}super.mouseEvent(t,e)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new Tt(Tt.STATE_CHANGE,this.object,1))}}class i7 extends yt{processUpdateMessage(t){super.processUpdateMessage(t),this.object&&this.object.model.getValue(I.FURNITURE_REAL_ROOM_OBJECT)===1&&this.object.model.setValue(Me.INFOSTAND_EXTRA_PARAM,Me.CRACKABLE_FURNI)}}class r7 extends yt{get widget(){return tt.CRAFTING}}class n7 extends yt{getEventTypes(){const t=[M.CREDITFURNI];return this.mergeTypes(super.getEventTypes(),t)}initialize(t){super.initialize(t);let e=0;t.logic&&t.logic.credits&&t.logic.credits!==""&&t.logic.credits.length>0&&(e=parseInt(t.logic.credits)),this.object.model.setValue(I.FURNITURE_CREDIT_VALUE,e)}useObject(){!this.object||!this.eventDispatcher||(this.eventDispatcher.dispatchEvent(new M(M.CREDITFURNI,this.object)),super.useObject())}}class le extends yt{getEventTypes(){const t=[G.MOUSE_BUTTON,G.MOUSE_ARROW];return this.mergeTypes(super.getEventTypes(),t)}mouseEvent(t,e){if(!(!t||!e||!this.object)){switch(t.type){case k.ROLL_OVER:this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new G(G.MOUSE_BUTTON,this.object));break;case k.ROLL_OUT:this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new G(G.MOUSE_ARROW,this.object));break}super.mouseEvent(t,e)}}}class a7 extends le{constructor(){super(...arguments),this._state=1}getEventTypes(){const t=[ki.PLAY_SOUND_AT_PITCH];return this.mergeTypes(super.getEventTypes(),t)}processUpdateMessage(t){super.processUpdateMessage(t),t instanceof Ft&&(this._state!==-1&&t.state!==this._state&&this.dispatchSoundEvent(this.object.location.z),this._state=t.state)}dispatchSoundEvent(t){const e=Math.pow(2,t-1.2);this.eventDispatcher.dispatchEvent(new ki(ki.PLAY_SOUND_AT_PITCH,this.object,"FURNITURE_cuckoo_clock",e))}}class o7 extends le{getEventTypes(){const t=[M.STACK_HEIGHT];return this.mergeTypes(super.getEventTypes(),t)}initialize(t){super.initialize(t),this.object&&this.object.model&&this.object.model.setValue(I.FURNITURE_ALWAYS_STACKABLE,1)}useObject(){!this.object||!this.eventDispatcher||(this.eventDispatcher.dispatchEvent(new M(M.STACK_HEIGHT,this.object)),super.useObject())}}class h7 extends yt{constructor(){super(),this._noTags=!1,this._noTagsLastStateActivate=!1}getEventTypes(){const t=[G.DICE_ACTIVATE,G.DICE_OFF];return this.mergeTypes(super.getEventTypes(),t)}mouseEvent(t,e){if(!t||!e||!this.object)return;let i=null;switch(t.type){case k.DOUBLE_CLICK:this._noTags?!this._noTagsLastStateActivate||this.object.getState(0)===0||this.object.getState(0)===100?(i=new G(G.DICE_ACTIVATE,this.object),this._noTagsLastStateActivate=!0):(i=new G(G.DICE_OFF,this.object),this._noTagsLastStateActivate=!1):t.spriteTag==="activate"||this.object.getState(0)===0||this.object.getState(0)===100?i=new G(G.DICE_ACTIVATE,this.object):t.spriteTag==="deactivate"&&(i=new G(G.DICE_OFF,this.object)),i&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(i);return}super.mouseEvent(t,e)}}class u7 extends yt{getEventTypes(){const t=[M.ECOTRONBOX];return this.mergeTypes(super.getEventTypes(),t)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.ECOTRONBOX,this.object))}}class l7 extends yt{constructor(){super(),this._showStateOnceRendered=!1,this._updateCount=0}getEventTypes(){const t=[M.INERNAL_LINK];return this.mergeTypes(super.getEventTypes(),t)}initialize(t){super.initialize(t),t.logic&&t.logic.action&&t.logic.action.startState===1&&(this._showStateOnceRendered=!0)}update(t){super.update(t),this._showStateOnceRendered&&(this._updateCount++,this._showStateOnceRendered&&this._updateCount>20&&(this.setAutomaticStateIndex(1),this._showStateOnceRendered=!1))}setAutomaticStateIndex(t){this.object&&this.object.model&&this.object.model.setValue(I.FURNITURE_AUTOMATIC_STATE_INDEX,t)}mouseEvent(t,e){!t||!e||(t.type===k.DOUBLE_CLICK&&this.setAutomaticStateIndex(0),super.mouseEvent(t,e))}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.INERNAL_LINK,this.object))}}class _7 extends yt{getEventTypes(){const t=[M.ROOM_LINK];return this.mergeTypes(super.getEventTypes(),t)}initialize(t){super.initialize(t),t.logic&&t.logic.action&&t.logic.action.link&&t.logic.action.link!==""&&t.logic.action.link.length>0&&this.object&&this.object.model&&this.object.model.setValue(I.FURNITURE_INTERNAL_LINK,t.logic.action.link)}onDispose(){this._timer&&(clearTimeout(this._timer),this._timer=null),super.onDispose()}setAutomaticStateIndex(t){this.object&&this.object.model&&this.object.model.setValue(I.FURNITURE_AUTOMATIC_STATE_INDEX,t)}useObject(){this.setAutomaticStateIndex(1),this._timer&&(clearTimeout(this._timer),this._timer=null),this._timer=setTimeout(()=>{this.setAutomaticStateIndex(0),this._timer=null},2500),!(!this.object||!this.eventDispatcher)&&this.eventDispatcher.dispatchEvent(new M(M.ROOM_LINK,this.object))}}class c7 extends yt{getEventTypes(){const t=[M.EFFECTBOX_OPEN_DIALOG];return this.mergeTypes(super.getEventTypes(),t)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.EFFECTBOX_OPEN_DIALOG,this.object))}get contextMenu(){return je.EFFECT_BOX}}class d7 extends le{getEventTypes(){const t=[M.EXTERNAL_IMAGE];return this.mergeTypes(super.getEventTypes(),t)}initialize(t){if(super.initialize(t),!!t&&this.object&&this.object.model){let e="";t.logic&&t.logic.maskType&&t.logic.maskType!==""&&t.logic.maskType.length>0&&(e=t.logic.maskType),this.object.model.setValue(I.FURNITURE_USES_PLANE_MASK,0),this.object.model.setValue(I.FURNITURE_PLANE_MASK_TYPE,e)}}useObject(){!this.object||!this.eventDispatcher||(this.eventDispatcher.dispatchEvent(new M(M.EXTERNAL_IMAGE,this.object)),super.useObject())}}class f7 extends yt{getEventTypes(){const t=[Tt.STATE_CHANGE];return this.mergeTypes(super.getEventTypes(),t)}initialize(t){super.initialize(t),t.logic&&t.logic.particleSystems&&t.logic.particleSystems.length&&this.object.model.setValue(I.FURNITURE_FIREWORKS_DATA,t.logic.particleSystems)}mouseEvent(t,e){if(!t||!e||!this.object)return;let i=null;switch(t.type){case k.DOUBLE_CLICK:switch(t.spriteTag){case"start_stop":i=new Tt(Tt.STATE_CHANGE,this.object,1);break;case"reset":i=new Tt(Tt.STATE_CHANGE,this.object,2);break}if(this.eventDispatcher&&i){this.eventDispatcher.dispatchEvent(i);return}break}super.mouseEvent(t,e)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new Tt(Tt.STATE_CHANGE,this.object,0))}}const fo=class extends le{constructor(){super(),this._currentState=-1,this._currentLocation=null}getEventTypes(){const s=[ze.ADD_HOLE,ze.REMOVE_HOLE];return this.mergeTypes(super.getEventTypes(),s)}onDispose(){this._currentState===fo.STATE_HOLE&&this.eventDispatcher.dispatchEvent(new ze(ze.REMOVE_HOLE,this.object)),super.onDispose()}update(s){super.update(s),this.handleAutomaticStateUpdate()}processUpdateMessage(s){if(super.processUpdateMessage(s),!this.object)return;s instanceof Ft&&this.handleStateUpdate(this.object.getState(0));const t=this.object.getLocation();this._currentLocation?(t.x!==this._currentLocation.x||t.y!==this._currentLocation.y)&&this._currentState===fo.STATE_HOLE&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new ze(ze.ADD_HOLE,this.object)):this._currentLocation=new S,this._currentLocation.assign(t)}handleStateUpdate(s){s!==this._currentState&&(this.eventDispatcher&&(s===fo.STATE_HOLE?this.eventDispatcher.dispatchEvent(new ze(ze.ADD_HOLE,this.object)):this._currentState===fo.STATE_HOLE&&this.eventDispatcher.dispatchEvent(new ze(ze.REMOVE_HOLE,this.object))),this._currentState=s)}handleAutomaticStateUpdate(){if(!this.object)return;const s=this.object.model;if(!s)return;const t=s.getValue(I.FURNITURE_AUTOMATIC_STATE_INDEX);isNaN(t)||this.handleStateUpdate(t%2)}};let MA=fo;MA.STATE_HOLE=0;const qd=class extends le{constructor(){super(...arguments),this._state=-1}initialize(s){super.initialize(s),this.object&&this.object.model.setValue(I.FURNITURE_FRIENDFURNI_ENGRAVING,this.engravingDialogType)}processUpdateMessage(s){if(s instanceof Ft){const t=s.data;t?this._state=t.state:this._state=s.state}super.processUpdateMessage(s)}getEventTypes(){const s=[M.FRIEND_FURNITURE_ENGRAVING];return this.mergeTypes(super.getEventTypes(),s)}useObject(){!this.object||!this.eventDispatcher||(this._state===qd.STATE_LOCKED?this.eventDispatcher.dispatchEvent(new M(M.FRIEND_FURNITURE_ENGRAVING,this.object)):super.useObject())}get engravingDialogType(){return 0}get contextMenu(){return this._state===qd.STATE_UNLOCKED?je.FRIEND_FURNITURE:je.DUMMY}};let Ch=qd;Ch.STATE_UNINITIALIZED=-1;Ch.STATE_UNLOCKED=0;Ch.STATE_LOCKED=1;const go=class extends le{getEventTypes(){const s=[gi.LOAD_BADGE,M.GUILD_FURNI_CONTEXT_MENU,M.CLOSE_FURNI_CONTEXT_MENU];return this.mergeTypes(super.getEventTypes(),s)}processUpdateMessage(s){if(super.processUpdateMessage(s),s instanceof Ft){const t=s.data;t instanceof Ma&&(this.updateGroupId(t.getValue(go.GROUPID_KEY)),this.updateBadge(t.getValue(go.BADGE_KEY)),this.updateColors(t.getValue(go.COLOR1_KEY),t.getValue(go.COLOR2_KEY)))}else s instanceof ba?s.assetName!=="loading_icon"&&(this.object.model.setValue(I.FURNITURE_GUILD_CUSTOMIZED_ASSET_NAME,s.assetName),this.update(_t())):s instanceof sh&&(s.selected||this.eventDispatcher.dispatchEvent(new M(M.CLOSE_FURNI_CONTEXT_MENU,this.object)))}updateGroupId(s){this.object.model.setValue(I.FURNITURE_GUILD_CUSTOMIZED_GUILD_ID,parseInt(s))}updateBadge(s){this.eventDispatcher.dispatchEvent(new gi(gi.LOAD_BADGE,this.object,s,!0))}updateColors(s,t){this.object.model.setValue(I.FURNITURE_GUILD_CUSTOMIZED_COLOR_1,parseInt(s,16)),this.object.model.setValue(I.FURNITURE_GUILD_CUSTOMIZED_COLOR_2,parseInt(t,16))}mouseEvent(s,t){if(!(!s||!t||!this.object)){switch(s.type){case k.MOUSE_CLICK:this.openContextMenu()}super.mouseEvent(s,t)}}openContextMenu(){this.eventDispatcher.dispatchEvent(new M(M.GUILD_FURNI_CONTEXT_MENU,this.object))}};let Va=go;Va.GROUPID_KEY=1;Va.BADGE_KEY=2;Va.COLOR1_KEY=3;Va.COLOR2_KEY=4;class g7 extends Va{getEventTypes(){const t=[M.INERNAL_LINK];return this.mergeTypes(super.getEventTypes(),t)}updateGroupId(t){super.updateGroupId(t),this.object.model.setValue(I.FURNITURE_INTERNAL_LINK,`groupforum/${t}`)}useObject(){!this.object||!this.eventDispatcher||(this.eventDispatcher.dispatchEvent(new M(M.INERNAL_LINK,this.object)),super.useObject())}}class E7 extends yt{getEventTypes(){const t=[G.USE_HABBOWHEEL];return this.mergeTypes(super.getEventTypes(),t)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new G(G.USE_HABBOWHEEL,this.object))}}const NA=class extends yt{constructor(){super(...arguments),this._state=-1}getEventTypes(){return[M.HIGH_SCORE_DISPLAY,M.HIDE_HIGH_SCORE_DISPLAY]}tearDown(){this.object.model.getValue(I.FURNITURE_REAL_ROOM_OBJECT)===1&&this.eventDispatcher.dispatchEvent(new M(M.HIDE_HIGH_SCORE_DISPLAY,this.object)),super.tearDown()}processUpdateMessage(s){super.processUpdateMessage(s),this.object.model.getValue(I.FURNITURE_REAL_ROOM_OBJECT)===1&&s instanceof Ft&&(s.state===NA.SHOW_WIDGET_IN_STATE?this.eventDispatcher.dispatchEvent(new M(M.HIGH_SCORE_DISPLAY,this.object)):this.eventDispatcher.dispatchEvent(new M(M.HIDE_HIGH_SCORE_DISPLAY,this.object)),this._state=s.state)}};let PA=NA;PA.SHOW_WIDGET_IN_STATE=1;class p7 extends yt{getEventTypes(){const t=[Tt.STATE_CHANGE];return this.mergeTypes(super.getEventTypes(),t)}mouseEvent(t,e){if(!t||!e||!this.object)return;let i=null;switch(t.type){case k.DOUBLE_CLICK:switch(t.spriteTag){case"off":i=new Tt(Tt.STATE_CHANGE,this.object,3);break}break;case k.MOUSE_CLICK:switch(t.spriteTag){case"inc":i=new Tt(Tt.STATE_CHANGE,this.object,2);break;case"dec":i=new Tt(Tt.STATE_CHANGE,this.object,1);break}break}if(this.eventDispatcher&&i){this.eventDispatcher.dispatchEvent(i);return}super.mouseEvent(t,e)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new Tt(Tt.STATE_CHANGE,this.object,3))}}class m7 extends Ch{get engravingDialogType(){return wn.HABBOWEEN}}class I7 extends le{constructor(){super(),this._nextState=0,this._nextStateTimestamp=0}update(t){if(this._nextStateTimestamp>0&&t>=this._nextStateTimestamp){this._nextStateTimestamp=0;const e=new _s;e.setString(this._nextState.toString()),super.processUpdateMessage(new Ft(this._nextState,e,this._nextStateExtra))}super.update(t)}processUpdateMessage(t){if(t instanceof Ft){this.processUpdate(t);return}super.processUpdateMessage(t)}processUpdate(t){if(!t)return;const e=~~(t.state/1e3),i=~~(t.state%1e3);if(i)this._nextState=e,this._nextStateExtra=t.extra,this._nextStateTimestamp=this.time+i;else{this._nextStateTimestamp=0;const r=new _s;r.setString(e.toString()),super.processUpdateMessage(new Ft(e,r,t.extra))}}}class T7 extends yt{constructor(){super(...arguments),this._showStateOnceRendered=!1,this._updateCount=0}getEventTypes(){const t=[M.INERNAL_LINK];return this.mergeTypes(super.getEventTypes(),t)}initialize(t){super.initialize(t),t.logic&&t.logic.action&&(this.object.model.setValue(I.FURNITURE_INTERNAL_LINK,t.logic.action.link),t.logic.action.startState===1&&(this._showStateOnceRendered=!0))}update(t){super.update(t),this._showStateOnceRendered&&(this._updateCount++,this._showStateOnceRendered&&this._updateCount===20&&(this.setAutomaticStateIndex(1),this._showStateOnceRendered=!1))}setAutomaticStateIndex(t){this.object&&this.object.model&&this.object.model.setValue(I.FURNITURE_AUTOMATIC_STATE_INDEX,t)}mouseEvent(t,e){!t||!e||(t.type===k.DOUBLE_CLICK&&this._showStateOnceRendered&&this.setAutomaticStateIndex(0),super.mouseEvent(t,e))}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.INERNAL_LINK,this.object))}}class R7 extends le{constructor(){super(...arguments),this._disposeEventsAllowed=!1,this._isInitialized=!1,this._currentState=-1}getEventTypes(){const t=[G.JUKEBOX_START,G.JUKEBOX_MACHINE_STOP,G.JUKEBOX_DISPOSE,G.JUKEBOX_INIT,M.JUKEBOX_PLAYLIST_EDITOR];return this.mergeTypes(super.getEventTypes(),t)}onDispose(){this.requestDispose(),super.onDispose()}processUpdateMessage(t){if(super.processUpdateMessage(t),this.object.model.getValue(I.FURNITURE_REAL_ROOM_OBJECT)===1&&(this._isInitialized||this.requestInit(),this.object.model.setValue(Me.INFOSTAND_EXTRA_PARAM,Me.JUKEBOX),t instanceof Ft)){const e=this.object.getState(0);e!==this._currentState&&(this._currentState=e,e===1?this.requestPlayList():e===0&&this.requestStopPlaying())}}requestInit(){!this.object||!this.eventDispatcher||(this._disposeEventsAllowed=!0,this.eventDispatcher.dispatchEvent(new G(G.JUKEBOX_INIT,this.object)),this._isInitialized=!0)}requestPlayList(){!this.object||!this.eventDispatcher||(this._disposeEventsAllowed=!0,this.eventDispatcher.dispatchEvent(new G(G.JUKEBOX_START,this.object)))}requestStopPlaying(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new G(G.JUKEBOX_MACHINE_STOP,this.object))}requestDispose(){!this._disposeEventsAllowed||!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new G(G.JUKEBOX_DISPOSE,this.object))}useObject(){!this.object||!this.eventDispatcher||(this.eventDispatcher.dispatchEvent(new M(M.JUKEBOX_PLAYLIST_EDITOR,this.object)),this.eventDispatcher.dispatchEvent(new Tt(Tt.STATE_CHANGE,this.object,-1)))}}class O7 extends Ch{get engravingDialogType(){return wn.LOVE_LOCK}}const yu=class extends yt{getEventTypes(){const s=[M.MANNEQUIN];return this.mergeTypes(super.getEventTypes(),s)}processUpdateMessage(s){super.processUpdateMessage(s),s instanceof Ft&&(s.data.writeRoomObjectModel(this.object.model),this.processObjectData())}processObjectData(){if(!this.object||!this.object.model)return;const s=new wr;s.initializeFromRoomObjectModel(this.object.model),this.object.model.setValue(I.FURNITURE_MANNEQUIN_GENDER,s.getValue(yu.GENDER)),this.object.model.setValue(I.FURNITURE_MANNEQUIN_FIGURE,s.getValue(yu.FIGURE)),this.object.model.setValue(I.FURNITURE_MANNEQUIN_NAME,s.getValue(yu.OUTFIT_NAME))}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.MANNEQUIN,this.object))}};let Kl=yu;Kl.GENDER="GENDER";Kl.FIGURE="FIGURE";Kl.OUTFIT_NAME="OUTFIT_NAME";class A7 extends le{getEventTypes(){const t=[M.MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG];return this.mergeTypes(super.getEventTypes(),t)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG,this.object))}get contextMenu(){return je.MONSTERPLANT_SEED}}class v7 extends le{initialize(t){super.initialize(t),this.object&&this.object.model&&this.object.model.setValue(I.FURNITURE_IS_VARIABLE_HEIGHT,1)}}class S7 extends le{getEventTypes(){const t=[M.MYSTERYBOX_OPEN_DIALOG];return this.mergeTypes(super.getEventTypes(),t)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.MYSTERYBOX_OPEN_DIALOG,this.object))}get contextMenu(){return je.MYSTERY_BOX}}class y7 extends le{getEventTypes(){const t=[M.MYSTERYTROPHY_OPEN_DIALOG];return this.mergeTypes(super.getEventTypes(),t)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.MYSTERYTROPHY_OPEN_DIALOG,this.object))}get contextMenu(){return je.MYSTERY_TROPHY}}class C7 extends yt{getEventTypes(){const t=[G.ENTER_ONEWAYDOOR];return this.mergeTypes(super.getEventTypes(),t)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new G(G.ENTER_ONEWAYDOOR,this.object))}}class M7 extends yt{getEventTypes(){const t=[M.PET_PRODUCT_MENU];return this.mergeTypes(super.getEventTypes(),t)}processUpdateMessage(t){super.processUpdateMessage(t),this.object&&this.object.model.getValue(I.FURNITURE_REAL_ROOM_OBJECT)===1&&this.object.model.setValue(Me.INFOSTAND_EXTRA_PARAM,Me.USABLE_PRODUCT)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.PET_PRODUCT_MENU,this.object))}}class N7 extends yt{getEventTypes(){const t=[M.PLACEHOLDER];return this.mergeTypes(super.getEventTypes(),t)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.PLACEHOLDER,this.object))}}class P7 extends yt{initialize(t){super.initialize(t),t.logic&&t.logic.planetSystems&&this.object.model.setValue(I.FURNITURE_PLANETSYSTEM_DATA,t.logic.planetSystems)}}const Qn=class extends yt{getEventTypes(){const s=[M.PRESENT];return this.mergeTypes(super.getEventTypes(),s)}initialize(s){super.initialize(s),s.logic&&s.logic.particleSystems&&s.logic.particleSystems.length&&this.object.model.setValue(I.FURNITURE_FIREWORKS_DATA,s.logic.particleSystems)}processUpdateMessage(s){super.processUpdateMessage(s),s instanceof Ft&&(s.data.writeRoomObjectModel(this.object.model),this.updateStuffData()),s instanceof SA&&s.numberKey===I.FURNITURE_DISABLE_PICKING_ANIMATION&&this.object.model.setValue(I.FURNITURE_DISABLE_PICKING_ANIMATION,s.numberValue)}updateStuffData(){if(!this.object||!this.object.model)return;const s=new wr;s.initializeFromRoomObjectModel(this.object.model);const t=s.getValue(Qn.MESSAGE),e=this.object.model.getValue(I.FURNITURE_DATA);!t&&typeof e=="string"?this.object.model.setValue(I.FURNITURE_DATA,e.substr(1)):this.object.model.setValue(I.FURNITURE_DATA,s.getValue(Qn.MESSAGE)),this.writeToModel(I.FURNITURE_TYPE_ID,s.getValue(Qn.PRODUCT_CODE)),this.writeToModel(I.FURNITURE_PURCHASER_NAME,s.getValue(Qn.PURCHASER_NAME)),this.writeToModel(I.FURNITURE_PURCHASER_FIGURE,s.getValue(Qn.PURCHASER_FIGURE))}writeToModel(s,t){t&&this.object.model.setValue(s,t)}mouseEvent(s,t){if(!(!s||!t||!this.object)){switch(s.type){case k.ROLL_OVER:this.eventDispatcher.dispatchEvent(new G(G.MOUSE_BUTTON,this.object));break;case k.ROLL_OUT:this.eventDispatcher.dispatchEvent(new G(G.MOUSE_ARROW,this.object));break}super.mouseEvent(s,t)}}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.PRESENT,this.object))}};let ka=Qn;ka.MESSAGE="MESSAGE";ka.PRODUCT_CODE="PRODUCT_CODE";ka.EXTRA_PARAM="EXTRA_PARAM";ka.PURCHASER_NAME="PURCHASER_NAME";ka.PURCHASER_FIGURE="PURCHASER_FIGURE";class b7 extends le{getEventTypes(){const t=[M.PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG];return this.mergeTypes(super.getEventTypes(),t)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG,this.object))}get contextMenu(){return je.PURCHASABLE_CLOTHING}}const Eo=class extends le{constructor(){super(),this.updateInterval=Lr.DEFAULT_UPDATE_INTERVAL,this._oldLocation=new S}processUpdateMessage(s){if(!s)return;const t=s instanceof Dr;if(this.object&&!t&&s.location){const e=this.object.getLocation(),i=S.dif(s.location,e);if(i&&Math.abs(i.x)<2&&Math.abs(i.y)<2){let r=e;(Math.abs(i.x)>1||Math.abs(i.y)>1)&&(r=S.sum(e,S.product(i,.5))),super.processUpdateMessage(new Dr(r,s.location,s.direction));return}}if(s.location&&!t&&super.processUpdateMessage(new Dr(s.location,s.location,s.direction)),s instanceof Ft){s.state>0?this.updateInterval=Lr.DEFAULT_UPDATE_INTERVAL/this.getUpdateIntervalValue(s.state):this.updateInterval=1,this.handleDataUpdate(s);return}t&&s.isSlide&&(this.updateInterval=Lr.DEFAULT_UPDATE_INTERVAL),super.processUpdateMessage(s)}getUpdateIntervalValue(s){return s/Eo.MAX_ANIMATION_COUNT}getAnimationValue(s){return s%Eo.MAX_ANIMATION_COUNT}handleDataUpdate(s){const t=this.getAnimationValue(s.state);if(t!==s.state){const e=new _s;e.setString(t.toString()),s=new Ft(t,e,s.extra)}super.processUpdateMessage(s)}update(s){this.object&&(this._oldLocation.assign(this.object.getLocation()),super.update(s),S.dif(this.object.getLocation(),this._oldLocation).length===0&&this.object.getState(0)!==Eo.ANIMATION_NOT_MOVING&&this.object.setState(Eo.ANIMATION_NOT_MOVING,0))}};let ql=Eo;ql.ANIMATION_NOT_MOVING=0;ql.ANIMATION_MOVING=1;ql.MAX_ANIMATION_COUNT=10;class D7 extends yt{getEventTypes(){const t=[Tt.STATE_RANDOM];return this.mergeTypes(super.getEventTypes(),t)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new Tt(Tt.STATE_RANDOM,this.object))}}class L7 extends le{get contextMenu(){return je.RANDOM_TELEPORT}}class U7 extends yt{getEventTypes(){const t=[Cs.RODRE_CURRENT_USER_ID];return this.mergeTypes(super.getEventTypes(),t)}update(t){if(super.update(t),this.object&&this.object.model){this.object.model.getValue(I.SESSION_CURRENT_USER_ID)||this.eventDispatcher.dispatchEvent(new Cs(Cs.RODRE_CURRENT_USER_ID,this.object));const e=this.object.model.getValue(I.FURNITURE_DATA).renterId,i=this.object.model.getValue(I.SESSION_CURRENT_USER_ID);e?parseInt(e)===i?this.object.setState(2,0):this.object.setState(1,0):this.object.setState(0,0)}}get widget(){return tt.RENTABLESPACE}}class x7 extends le{constructor(){super(),this._roomColorUpdated=!1}getEventTypes(){const t=[M.BACKGROUND_COLOR,Ir.ROOM_BACKGROUND_COLOR];return this.mergeTypes(super.getEventTypes(),t)}onDispose(){this._roomColorUpdated&&(this.eventDispatcher&&this.object&&this.object.model.getValue(I.FURNITURE_REAL_ROOM_OBJECT)===1&&this.eventDispatcher.dispatchEvent(new Ir(Ir.ROOM_BACKGROUND_COLOR,this.object,!1,0,0,0)),this._roomColorUpdated=!1),super.onDispose()}processUpdateMessage(t){super.processUpdateMessage(t),t instanceof Ft&&(t.data.writeRoomObjectModel(this.object.model),this.object.model.getValue(I.FURNITURE_REAL_ROOM_OBJECT)===1&&this.processColorUpdate())}processColorUpdate(){if(!this.object||!this.object.model)return;const t=new Zo;t.initializeFromRoomObjectModel(this.object.model);const e=t.getValue(0),i=t.getValue(1),r=t.getValue(2),n=t.getValue(3);e>-1&&i>-1&&r>-1&&n>-1&&(this.object.model.setValue(I.FURNITURE_ROOM_BACKGROUND_COLOR_HUE,i),this.object.model.setValue(I.FURNITURE_ROOM_BACKGROUND_COLOR_SATURATION,r),this.object.model.setValue(I.FURNITURE_ROOM_BACKGROUND_COLOR_LIGHTNESS,n),this.object.setState(e,0),this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new Ir(Ir.ROOM_BACKGROUND_COLOR,this.object,e===1,i,r,n)),this._roomColorUpdated=!0)}mouseEvent(t,e){if(!(!t||!e||!this.object)){switch(t.type){case k.DOUBLE_CLICK:this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new M(M.BACKGROUND_COLOR,this.object));return}super.mouseEvent(t,e)}}}var Sn={},bA={},Zi={};Object.defineProperty(Zi,"__esModule",{value:!0});Zi.loop=Zi.conditional=Zi.parse=void 0;var F7=function s(t,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:i;if(Array.isArray(e))e.forEach(function(a){return s(t,a,i,r)});else if(typeof e=="function")e(t,i,r,s);else{var n=Object.keys(e)[0];Array.isArray(e[n])?(r[n]={},s(t,e[n],i,r[n])):r[n]=e[n](t,i,r,s)}return i};Zi.parse=F7;var w7=function(t,e){return function(i,r,n,a){e(i,r,n)&&a(i,t,r,n)}};Zi.conditional=w7;var G7=function(t,e){return function(i,r,n,a){for(var o=[],h=i.pos;e(i,r,n);){var u={};if(a(i,t,r,u),i.pos===h)break;h=i.pos,o.push(u)}return o}};Zi.loop=G7;var ge={};Object.defineProperty(ge,"__esModule",{value:!0});ge.readBits=ge.readArray=ge.readUnsigned=ge.readString=ge.peekBytes=ge.readBytes=ge.peekByte=ge.readByte=ge.buildStream=void 0;var B7=function(t){return{data:t,pos:0}};ge.buildStream=B7;var DA=function(){return function(t){return t.data[t.pos++]}};ge.readByte=DA;var H7=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(e){return e.data[e.pos+t]}};ge.peekByte=H7;var Zl=function(t){return function(e){return e.data.subarray(e.pos,e.pos+=t)}};ge.readBytes=Zl;var V7=function(t){return function(e){return e.data.subarray(e.pos,e.pos+t)}};ge.peekBytes=V7;var k7=function(t){return function(e){return Array.from(Zl(t)(e)).map(function(i){return String.fromCharCode(i)}).join("")}};ge.readString=k7;var j7=function(t){return function(e){var i=Zl(2)(e);return t?(i[1]<<8)+i[0]:(i[0]<<8)+i[1]}};ge.readUnsigned=j7;var z7=function(t,e){return function(i,r,n){for(var a=typeof e=="function"?e(i,r,n):e,o=Zl(t),h=new Array(a),u=0;u<a;u++)h[u]=o(i);return h}};ge.readArray=z7;var Y7=function(t,e,i){for(var r=0,n=0;n<i;n++)r+=t[e+n]&&Math.pow(2,i-n-1);return r},W7=function(t){return function(e){for(var i=DA()(e),r=new Array(8),n=0;n<8;n++)r[7-n]=!!(i&1<<n);return Object.keys(t).reduce(function(a,o){var h=t[o];return h.length?a[o]=Y7(r,h.index,h.length):a[o]=r[h.index],a},{})}};ge.readBits=W7;(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var t=Zi,e=ge,i={blocks:function(_){for(var d=0,g=[],m=_.data.length,p=0,T=(0,e.readByte)()(_);T!==d&&T;T=(0,e.readByte)()(_)){if(_.pos+T>=m){var A=m-_.pos;g.push((0,e.readBytes)(A)(_)),p+=A;break}g.push((0,e.readBytes)(T)(_)),p+=T}for(var O=new Uint8Array(p),v=0,y=0;y<g.length;y++)O.set(g[y],v),v+=g[y].length;return O}},r=(0,t.conditional)({gce:[{codes:(0,e.readBytes)(2)},{byteSize:(0,e.readByte)()},{extras:(0,e.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,e.readUnsigned)(!0)},{transparentColorIndex:(0,e.readByte)()},{terminator:(0,e.readByte)()}]},function(l){var _=(0,e.peekBytes)(2)(l);return _[0]===33&&_[1]===249}),n=(0,t.conditional)({image:[{code:(0,e.readByte)()},{descriptor:[{left:(0,e.readUnsigned)(!0)},{top:(0,e.readUnsigned)(!0)},{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{lct:(0,e.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,t.conditional)({lct:(0,e.readArray)(3,function(l,_,d){return Math.pow(2,d.descriptor.lct.size+1)})},function(l,_,d){return d.descriptor.lct.exists}),{data:[{minCodeSize:(0,e.readByte)()},i]}]},function(l){return(0,e.peekByte)()(l)===44}),a=(0,t.conditional)({text:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{preData:function(_,d,g){return(0,e.readBytes)(g.text.blockSize)(_)}},i]},function(l){var _=(0,e.peekBytes)(2)(l);return _[0]===33&&_[1]===1}),o=(0,t.conditional)({application:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{id:function(_,d,g){return(0,e.readString)(g.blockSize)(_)}},i]},function(l){var _=(0,e.peekBytes)(2)(l);return _[0]===33&&_[1]===255}),h=(0,t.conditional)({comment:[{codes:(0,e.readBytes)(2)},i]},function(l){var _=(0,e.peekBytes)(2)(l);return _[0]===33&&_[1]===254}),u=[{header:[{signature:(0,e.readString)(3)},{version:(0,e.readString)(3)}]},{lsd:[{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{gct:(0,e.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,e.readByte)()},{pixelAspectRatio:(0,e.readByte)()}]},(0,t.conditional)({gct:(0,e.readArray)(3,function(l,_){return Math.pow(2,_.lsd.gct.size+1)})},function(l,_){return _.lsd.gct.exists}),{frames:(0,t.loop)([r,o,h,n,a],function(l){var _=(0,e.peekByte)()(l);return _===33||_===44})}],c=u;s.default=c})(bA);var Ql={};Object.defineProperty(Ql,"__esModule",{value:!0});Ql.deinterlace=void 0;var X7=function(t,e){for(var i=new Array(t.length),r=t.length/e,n=function(_,d){var g=t.slice(d*e,(d+1)*e);i.splice.apply(i,[_*e,e].concat(g))},a=[0,4,2,1],o=[8,8,4,2],h=0,u=0;u<4;u++)for(var c=a[u];c<r;c+=o[u])n(c,h),h++;return i};Ql.deinterlace=X7;var Jl={};Object.defineProperty(Jl,"__esModule",{value:!0});Jl.lzw=void 0;var K7=function(t,e,i){var r=4096,n=-1,a=i,o,h,u,c,l,_,d,C,g,m,y,p,N,L,b,P,T=new Array(i),A=new Array(r),O=new Array(r),v=new Array(r+1);for(p=t,h=1<<p,l=h+1,o=h+2,d=n,c=p+1,u=(1<<c)-1,g=0;g<h;g++)A[g]=0,O[g]=g;var y,C,N,L,P,b;for(y=C=N=L=P=b=0,m=0;m<a;){if(L===0){if(C<c){y+=e[b]<<C,C+=8,b++;continue}if(g=y&u,y>>=c,C-=c,g>o||g==l)break;if(g==h){c=p+1,u=(1<<c)-1,o=h+2,d=n;continue}if(d==n){v[L++]=O[g],d=g,N=g;continue}for(_=g,g==o&&(v[L++]=N,g=d);g>h;)v[L++]=O[g],g=A[g];N=O[g]&255,v[L++]=N,o<r&&(A[o]=d,O[o]=N,o++,!(o&u)&&o<r&&(c++,u+=o)),d=_}L--,T[P++]=v[L],m++}for(m=P;m<a;m++)T[m]=0;return T};Jl.lzw=K7;Object.defineProperty(Sn,"__esModule",{value:!0});var LA=Sn.decompressFrames=Sn.decompressFrame=UA=Sn.parseGIF=void 0,q7=t9(bA),Z7=Zi,Q7=ge,J7=Ql,$7=Jl;function t9(s){return s&&s.__esModule?s:{default:s}}var e9=function(t){var e=new Uint8Array(t);return(0,Z7.parse)((0,Q7.buildStream)(e),q7.default)},UA=Sn.parseGIF=e9,s9=function(t){for(var e=t.pixels.length,i=new Uint8ClampedArray(e*4),r=0;r<e;r++){var n=r*4,a=t.pixels[r],o=t.colorTable[a]||[0,0,0];i[n]=o[0],i[n+1]=o[1],i[n+2]=o[2],i[n+3]=a!==t.transparentIndex?255:0}return i},xA=function(t,e,i){if(!t.image){console.warn("gif frame does not have associated image.");return}var r=t.image,n=r.descriptor.width*r.descriptor.height,a=(0,$7.lzw)(r.data.minCodeSize,r.data.blocks,n);r.descriptor.lct.interlaced&&(a=(0,J7.deinterlace)(a,r.descriptor.width));var o={pixels:a,dims:{top:t.image.descriptor.top,left:t.image.descriptor.left,width:t.image.descriptor.width,height:t.image.descriptor.height}};return r.descriptor.lct&&r.descriptor.lct.exists?o.colorTable=r.lct:o.colorTable=e,t.gce&&(o.delay=(t.gce.delay||10)*10,o.disposalType=t.gce.extras.disposal,t.gce.extras.transparentColorGiven&&(o.transparentIndex=t.gce.transparentColorIndex)),i&&(o.patch=s9(o)),o};Sn.decompressFrame=xA;var i9=function(t,e){return t.frames.filter(function(i){return i.image}).map(function(i){return xA(i,t.gct,e)})};LA=Sn.decompressFrames=i9;const As=class extends yt{constructor(){super(),this._disableFurnitureSelection=!0,this._hasClickUrl=!1}getEventTypes(){const s=[kt.ROOM_AD_LOAD_IMAGE];return this.mergeTypes(super.getEventTypes(),s)}initialize(s){super.initialize(s),this._disableFurnitureSelection&&this.object.model.setValue(I.FURNITURE_SELECTION_DISABLED,1)}processUpdateMessage(s){super.processUpdateMessage(s),s instanceof Ft&&this.processAdDataUpdateMessage(s),s instanceof Qe&&this.processAdUpdate(s)}processAdDataUpdateMessage(s){if(!s)return;const t=new wr;t.initializeFromRoomObjectModel(this.object.model);const e=parseInt(t.getValue(As.STATE));!isNaN(e)&&this.object.getState(0)!==e&&this.object.setState(e,0);const i=t.getValue(As.IMAGEURL_KEY),r=this.object.model.getValue(I.FURNITURE_BRANDING_IMAGE_URL);(!r||r!==i)&&(this.object.model.setValue(I.FURNITURE_BRANDING_IMAGE_URL,i),this.object.model.setValue(I.FURNITURE_BRANDING_IMAGE_STATUS,0),this.downloadBackground());const n=t.getValue(As.CLICKURL_KEY);if(n){const c=this.object.model.getValue(I.FURNITURE_BRANDING_URL);(!c||c!==n)&&this.object.model&&this.object.model.setValue(I.FURNITURE_BRANDING_URL,n)}const a=parseInt(t.getValue(As.OFFSETX_KEY)),o=parseInt(t.getValue(As.OFFSETY_KEY)),h=parseInt(t.getValue(As.OFFSETZ_KEY));isNaN(a)||this.object.model.setValue(I.FURNITURE_BRANDING_OFFSET_X,a),isNaN(o)||this.object.model.setValue(I.FURNITURE_BRANDING_OFFSET_Y,o),isNaN(h)||this.object.model.setValue(I.FURNITURE_BRANDING_OFFSET_Z,h);let u=As.IMAGEURL_KEY+"="+(i!==null?i:"")+"	";this._hasClickUrl&&(u=u+(As.CLICKURL_KEY+"="+(n!==null?n:"")+"	")),u=u+(As.OFFSETX_KEY+"="+a+"	"),u=u+(As.OFFSETY_KEY+"="+o+"	"),u=u+(As.OFFSETZ_KEY+"="+h+"	"),this.object.model.setValue(Me.INFOSTAND_EXTRA_PARAM,Me.BRANDING_OPTIONS+u)}processAdUpdate(s){if(!(!s||!this.object))switch(s.type){case Qe.IMAGE_LOADED:this.object.model.setValue(I.FURNITURE_BRANDING_IMAGE_STATUS,1);break;case Qe.IMAGE_LOADING_FAILED:this.object.model.setValue(I.FURNITURE_BRANDING_IMAGE_STATUS,-1);break}}mouseEvent(s,t){!s||!t||s.type===k.MOUSE_MOVE||s.type===k.DOUBLE_CLICK||super.mouseEvent(s,t)}async downloadBackground(){const s=this.object&&this.object.model;if(!s)return;const t=s.getValue(I.FURNITURE_BRANDING_IMAGE_URL),e=s.getValue(I.FURNITURE_BRANDING_IMAGE_STATUS);if(!(!t||t===""||e===1))if(t.endsWith(".gif"))this.object.model.setValue(I.FURNITURE_BRANDING_IS_ANIMATED,!0),fetch(t).then(i=>i.arrayBuffer()).then(i=>UA(i)).then(i=>{const r=i.lsd.width,n=i.lsd.height,a=r*n,o=LA(i,!1),h=[],u=[];let c=new Uint8Array(a*4);for(let l=0;l<o.length;l++){l>0&&(c=c.slice(0));const _=o[l].pixels,d=o[l].colorTable,g=o[l].transparentIndex,m=o[l].dims;for(let T=0;T<m.height;T++)for(let A=0;A<m.width;A++){const O=_[T*m.width+A],v=(T+m.top)*r+(A+m.left);if(g!==O){const y=d[O];c[4*v]=y[0],c[4*v+1]=y[1],c[4*v+2]=y[2],c[4*v+3]=255}}const p=Yt.fromBuffer(c,r,n);h.push(new ut(p)),u.push(o[l].delay)}K.instance.roomEngine.roomContentLoader.createGifCollection(t,h,u),this.processUpdateMessage(new Qe(Qe.IMAGE_LOADED))}).catch(i=>{this.processUpdateMessage(new Qe(Qe.IMAGE_LOADING_FAILED))});else{const i=ys();if(!i)return;if(!i.getTexture(t)){await i.downloadAsset(t)?this.processUpdateMessage(new Qe(Qe.IMAGE_LOADED)):this.processUpdateMessage(new Qe(Qe.IMAGE_LOADING_FAILED));return}this.processUpdateMessage(new Qe(Qe.IMAGE_LOADED))}}};let Yr=As;Yr.STATE="state";Yr.IMAGEURL_KEY="imageUrl";Yr.CLICKURL_KEY="clickUrl";Yr.OFFSETX_KEY="offsetX";Yr.OFFSETY_KEY="offsetY";Yr.OFFSETZ_KEY="offsetZ";class r9 extends Yr{getAdClickUrl(t){return null}}class n9 extends Yr{constructor(){super(),this._hasClickUrl=!0}getAdClickUrl(t){return t.getValue(I.FURNITURE_BRANDING_URL)}handleAdClick(t,e,i){if(i.indexOf("http")===0){Ln.openWebPage(i);return}this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new kt(kt.ROOM_AD_FURNI_CLICK,this.object,"",i))}}class a9 extends yt{constructor(){super(),this._roomColorUpdated=!1}getEventTypes(){const t=[M.DIMMER,M.WIDGET_REMOVE_DIMMER,Oa.DIMMER_STATE];return this.mergeTypes(super.getEventTypes(),t)}onDispose(){this._roomColorUpdated&&this.eventDispatcher&&this.object&&(this.object.model.getValue(I.FURNITURE_REAL_ROOM_OBJECT)===1&&(this.eventDispatcher.dispatchEvent(new Oa(this.object,0,1,1,16777215,255)),this.eventDispatcher.dispatchEvent(new M(M.WIDGET_REMOVE_DIMMER,this.object))),this._roomColorUpdated=!1),super.onDispose()}processUpdateMessage(t){if(t instanceof Ft){if(t.data){const e=t.data.getLegacyString();this.object.model.getValue(I.FURNITURE_REAL_ROOM_OBJECT)===1&&this.processDimmerData(e),super.processUpdateMessage(new Ft(this.getStateFromDimmerData(e),t.data))}return}super.processUpdateMessage(t)}getStateFromDimmerData(t){if(!t)return 0;const e=t.split(",");return e.length>=5?parseInt(e[0])-1:0}processDimmerData(t){if(!t)return;const e=t.split(",");if(e.length>=5){const i=this.getStateFromDimmerData(t),r=parseInt(e[1]),n=parseInt(e[2]),a=e[3];let o=parseInt(a.substr(1),16),h=parseInt(e[4]);i||(o=16777215,h=255),this.eventDispatcher&&this.object&&(this.eventDispatcher.dispatchEvent(new Oa(this.object,i,r,n,o,h)),this._roomColorUpdated=!0)}}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.DIMMER,this.object))}update(t){super.update(t)}}const po=class extends yt{constructor(){super(),this._score=0,this._scoreIncreaser=50,this._scoreTimer=0}processUpdateMessage(s){if(s instanceof Ft)return this.updateScore(s.state);super.processUpdateMessage(s)}updateScore(s){this._score=s;const t=this.object.getState(0);if(this._score!==t){let e=this._score-t;e<0&&(e=-e),e*po.UPDATE_INTERVAL>po.MAX_UPDATE_TIME?this._scoreIncreaser=po.MAX_UPDATE_TIME/e:this._scoreIncreaser=po.UPDATE_INTERVAL,this._scoreTimer=_t()}}update(s){super.update(s);const t=this.object.getState(0);if(t!==this._score&&s>=this._scoreTimer+this._scoreIncreaser){const e=s-this._scoreTimer;let i=e/this._scoreIncreaser,r=1;this._score<t&&(r=-1),i>r*(this._score-t)&&(i=r*(this._score-t)),this.object.setState(t+r*i,0),this._scoreTimer=s-(e-i*this._scoreIncreaser)}}};let rg=po;rg.UPDATE_INTERVAL=50;rg.MAX_UPDATE_TIME=3e3;class o9 extends yt{processUpdateMessage(t){if(super.processUpdateMessage(t),this.object.model.getValue(I.FURNITURE_REAL_ROOM_OBJECT)===1){const e=this.object.model.getValue(I.FURNITURE_EXTRAS),i=parseInt(e);this.object.model.setValue(Me.INFOSTAND_EXTRA_PARAM,Me.SONGDISK+i)}}}const hr=class extends le{constructor(){super(...arguments),this._state=-1,this._sampleId=-1,this._noPitch=!1,this._lastLocZ=0}getEventTypes(){const s=[ne.ROOM_OBJECT_INITIALIZED,ne.ROOM_OBJECT_DISPOSED,ne.PLAY_SAMPLE,ne.CHANGE_PITCH];return this.mergeTypes(super.getEventTypes(),s)}initialize(s){super.initialize(s),s.logic&&s.logic.soundSample&&(this._sampleId=s.logic.soundSample.id,this._noPitch=s.logic.soundSample.noPitch),this.object.model.setValue(I.FURNITURE_SOUNDBLOCK_RELATIVE_ANIMATION_SPEED,1)}onDispose(){this._state!==hr.STATE_UNINITIALIZED&&this.eventDispatcher.dispatchEvent(new ne(ne.ROOM_OBJECT_DISPOSED,this.object,this._sampleId)),super.onDispose()}processUpdateMessage(s){super.processUpdateMessage(s),s instanceof Ft&&this.updateSoundBlockMessage(s)}updateSoundBlockMessage(s){if(!s)return;const t=this.object&&this.object.model,e=this.object&&this.object.location;!t||!e||(this._state===hr.STATE_UNINITIALIZED&&t.getValue(I.FURNITURE_REAL_ROOM_OBJECT)===1&&(this._lastLocZ=e.z,this.eventDispatcher.dispatchEvent(new ne(ne.ROOM_OBJECT_INITIALIZED,this.object,this._sampleId,this.getPitchForHeight(e.z)))),this._state!==hr.STATE_UNINITIALIZED&&t.getValue(I.FURNITURE_REAL_ROOM_OBJECT)===1&&this._lastLocZ!==e.z&&(this._lastLocZ=e.z,this.eventDispatcher.dispatchEvent(new ne(ne.CHANGE_PITCH,this.object,this._sampleId,this.getPitchForHeight(e.z)))),this._state!==hr.STATE_UNINITIALIZED&&s.state!==this._state&&this.playSoundAt(e.z),this._state=s.state)}playSoundAt(s){if(!this.object)return;const t=this.getPitchForHeight(s);this.object.model.setValue(I.FURNITURE_SOUNDBLOCK_RELATIVE_ANIMATION_SPEED,t),this.eventDispatcher.dispatchEvent(new ne(ne.PLAY_SAMPLE,this.object,this._sampleId,t))}getPitchForHeight(s){if(this._noPitch)return 1;let t=s*2;return t>hr.HIGHEST_SEMITONE&&(t=Math.min(0,hr.LOWEST_SEMITONE+(t-hr.HIGHEST_SEMITONE-1))),Math.pow(2,t/12)}};let $l=hr;$l.HIGHEST_SEMITONE=12;$l.LOWEST_SEMITONE=-12;$l.STATE_UNINITIALIZED=-1;class h9 extends le{constructor(){super(...arguments),this._disposeEventsAllowed=!1,this._isInitialized=!1,this._currentState=-1}getEventTypes(){const t=[G.SOUND_MACHINE_START,G.SOUND_MACHINE_STOP,G.SOUND_MACHINE_DISPOSE,G.SOUND_MACHINE_INIT];return this.mergeTypes(super.getEventTypes(),t)}onDispose(){this.requestDispose(),super.onDispose()}processUpdateMessage(t){if(super.processUpdateMessage(t),this.object.model.getValue(I.FURNITURE_REAL_ROOM_OBJECT)===1&&(this._isInitialized||this.requestInit(),this.object.model.setValue(Me.INFOSTAND_EXTRA_PARAM,Me.JUKEBOX),t instanceof Ft)){const e=this.object.getState(0);e!==this._currentState&&(this._currentState=e,e===1?this.requestPlayList():e===0&&this.requestStopPlaying())}}requestInit(){!this.object||!this.eventDispatcher||(this._disposeEventsAllowed=!0,this.eventDispatcher.dispatchEvent(new G(G.SOUND_MACHINE_INIT,this.object)),this._isInitialized=!0)}requestPlayList(){!this.object||!this.eventDispatcher||(this._disposeEventsAllowed=!0,this.eventDispatcher.dispatchEvent(new G(G.SOUND_MACHINE_START,this.object)))}requestStopPlaying(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new G(G.SOUND_MACHINE_STOP,this.object))}requestDispose(){!this._disposeEventsAllowed||!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new G(G.SOUND_MACHINE_DISPOSE,this.object))}}const FA=class extends yt{getEventTypes(){const s=[M.STICKIE,G.STICKIE];return this.mergeTypes(super.getEventTypes(),s)}initialize(s){super.initialize(s),this.updateColor(),this.object&&this.object.model.setValue(I.FURNITURE_IS_STICKIE,"")}processUpdateMessage(s){super.processUpdateMessage(s),s instanceof sg&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new M(M.STICKIE,this.object)),this.updateColor()}updateColor(){if(!this.object)return;const s=this.object.model.getValue(I.FURNITURE_DATA);let t=FA.STICKIE_COLORS.indexOf(s);t<0&&(t=3),this.object.model.setValue(I.FURNITURE_COLOR,t+1)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new G(G.STICKIE,this.object))}};let wA=FA;wA.STICKIE_COLORS=["9CCEFF","FF9CFF","9CFF9C","FFFF33"];class u9 extends yt{getEventTypes(){const t=[M.TROPHY];return this.mergeTypes(super.getEventTypes(),t)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.TROPHY,this.object))}}const mo=class extends le{constructor(){super(),this._total=0,this._lastUpdate=0,this._interval=33}processUpdateMessage(s){if(super.processUpdateMessage(s),s instanceof Ft){const t=s.data;if(!t)return;this.updateTotal(t.result)}}updateTotal(s){if(this._total=s,!this._lastUpdate){this.object.model.setValue(I.FURNITURE_VOTE_COUNTER_COUNT,s),this._lastUpdate=_t();return}if(this._total!==this.currentTotal){const t=Math.abs(this._total-this.currentTotal);t*mo.UPDATE_INTERVAL>mo.MAX_UPDATE_TIME?this._interval=mo.MAX_UPDATE_TIME/t:this._interval=mo.UPDATE_INTERVAL,this._lastUpdate=_t()}}update(s){if(super.update(s),this.object&&this.currentTotal!==this._total&&s>=this._lastUpdate+this._interval){const t=s-this._lastUpdate;let e=t/this._interval,i=1;this._total<this.currentTotal&&(i=-1),e>i*(this._total-this.currentTotal)&&(e=i*(this._total-this.currentTotal)),this.object.model.setValue(I.FURNITURE_VOTE_COUNTER_COUNT,this.currentTotal+i*e),this._lastUpdate=s-(t-e*this._interval)}}get currentTotal(){return this.object.model.getValue(I.FURNITURE_VOTE_COUNTER_COUNT)}};let ng=mo;ng.UPDATE_INTERVAL=33;ng.MAX_UPDATE_TIME=1e3;class l9 extends le{processUpdateMessage(t){if(super.processUpdateMessage(t),!!this.object&&t instanceof Ft){const e=t.data;e instanceof Yu&&this.object.model.setValue(I.FURNITURE_VOTE_MAJORITY_RESULT,e.result)}}}class _9 extends le{mouseEvent(t,e){!t||!e||(t.type===k.DOUBLE_CLICK&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new Tt(Tt.STATE_CHANGE,this.object)),super.mouseEvent(t,e))}}class c9 extends le{initialize(t){super.initialize(t);let e="";t.logic&&t.logic.maskType&&t.logic.maskType!==""&&t.logic.maskType.length>0&&(e=t.logic.maskType),this.object.model.setValue(I.FURNITURE_USES_PLANE_MASK,1),this.object.model.setValue(I.FURNITURE_PLANE_MASK_TYPE,e)}}class d9 extends yt{getEventTypes(){const t=[M.YOUTUBE,Cs.RODRE_URL_PREFIX];return this.mergeTypes(super.getEventTypes(),t)}update(t){super.update(t),this.object.model.getValue(I.SESSION_URL_PREFIX)||this.eventDispatcher.dispatchEvent(new Cs(Cs.RODRE_URL_PREFIX,this.object))}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new M(M.YOUTUBE,this.object))}}class f9 extends Lr{constructor(){super(),this._selected=!1,this._reportedLocation=null,this._postureIndex=0,this._gestureIndex=0,this._headDirectionDelta=0,this._directions=[],this._talkingEndTimestamp=0,this._gestureEndTimestamp=0,this._expressionEndTimestamp=0}getEventTypes(){const t=[$.CLICK,Xe.POSITION_CHANGED];return this.mergeTypes(super.getEventTypes(),t)}initialize(t){if(!t)return;const e=this.object&&this.object.model;if(e){if(t.logic&&t.logic.model){const i=t.logic.model.directions;if(i&&i.length){for(const r of i)this._directions.push(r);this._directions.sort()}}e.setValue(I.PET_ALLOWED_DIRECTIONS,this._directions)}}dispose(){this._selected&&this.object&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new Xe(Xe.OBJECT_REMOVED,this.object)),this._directions=null,this._reportedLocation=null}update(t){if(super.update(t),this._selected&&this.object&&this.eventDispatcher){const e=this.object.getLocation();(!this._reportedLocation||this._reportedLocation.x!==e.x||this._reportedLocation.y!==e.y||this._reportedLocation.z!==e.z)&&(this._reportedLocation||(this._reportedLocation=new S),this._reportedLocation.assign(e),this.eventDispatcher.dispatchEvent(new Xe(Xe.POSITION_CHANGED,this.object)))}this.object&&this.object.model&&this.updateModel(t,this.object.model)}updateModel(t,e){this._gestureEndTimestamp>0&&t>this._gestureEndTimestamp&&(e.setValue(I.FIGURE_GESTURE,null),this._gestureEndTimestamp=0),this._talkingEndTimestamp>0&&t>this._talkingEndTimestamp&&(e.setValue(I.FIGURE_TALK,0),this._talkingEndTimestamp=0),this._expressionEndTimestamp>0&&t>this._expressionEndTimestamp&&(e.setValue(I.FIGURE_EXPRESSION,0),this._expressionEndTimestamp=0)}processUpdateMessage(t){if(!t||!this.object)return;super.processUpdateMessage(t);const e=this.object&&this.object.model;if(e){if(t instanceof ul){e.setValue(I.HEAD_DIRECTION,t.headDirection);return}if(t instanceof ol){const i=new gl(t.figure);e.setValue(I.FIGURE,t.figure),e.setValue(I.RACE,t.subType),e.setValue(I.PET_PALETTE_INDEX,i.paletteId),e.setValue(I.PET_COLOR,i.color),e.setValue(I.PET_TYPE,i.typeId),e.setValue(I.PET_CUSTOM_LAYER_IDS,i.customLayerIds),e.setValue(I.PET_CUSTOM_PARTS_IDS,i.customPartIds),e.setValue(I.PET_CUSTOM_PALETTE_IDS,i.customPaletteIds),e.setValue(I.PET_IS_RIDING,t.isRiding?1:0);return}if(t instanceof tg){e.setValue(I.FIGURE_POSTURE,t.postureType);return}if(t instanceof $f){e.setValue(I.FIGURE_TALK,1),this._talkingEndTimestamp=this.time+t.numberOfWords*1e3;return}if(t instanceof eg){e.setValue(I.FIGURE_SLEEP,t.isSleeping?1:0);return}if(t instanceof mA){e.setValue(I.FIGURE_GESTURE,t.gesture),this._gestureEndTimestamp=this.time+3e3;return}if(t instanceof hl){this._selected=t.selected,this._reportedLocation=null;return}if(t instanceof cA){e.setValue(I.FIGURE_EXPERIENCE_TIMESTAMP,this.time),e.setValue(I.FIGURE_GAINED_EXPERIENCE,t.gainedExperience);return}}}mouseEvent(t,e){let i=null;switch(t.type){case k.MOUSE_CLICK:i=$.CLICK;break;case k.DOUBLE_CLICK:break;case k.MOUSE_DOWN:{this.object.model.getValue(I.PET_TYPE)===St.MONSTERPLANT&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new $($.MOUSE_DOWN,this.object,t.eventId,t.altKey,t.ctrlKey,t.shiftKey,t.buttonDown));break}}i&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new $(i,this.object,t.eventId,t.altKey,t.ctrlKey,t.shiftKey,t.buttonDown))}}class GA{constructor(){this._width=0,this._height=0,this._wallHeight=0,this._fixedWallsHeight=0,this._tileMap=[],this._holeMap=[],this._doors=[],this._dimensions={minX:0,maxX:0,minY:0,maxY:0},this._restrictsDragging=!1,this._restrictedScale=1,this._restrictsScaling=!1}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get wallHeight(){return this._wallHeight}set wallHeight(t){this._wallHeight=t}get fixedWallsHeight(){return this._fixedWallsHeight}set fixedWallsHeight(t){this._fixedWallsHeight=t}get tileMap(){return this._tileMap}get holeMap(){return this._holeMap}get doors(){return this._doors}get dimensions(){return this._dimensions}get restrictsDragging(){return this._restrictsDragging}set restrictsDragging(t){this._restrictsDragging=t}get restrictsScaling(){return this._restrictsScaling}set restrictsScaling(t){this._restrictsScaling=t}get restrictedScale(){return this._restrictedScale}set restrictedScale(t){this._restrictedScale=t}}class Dn{constructor(t,e,i){this.type=t,this.loc=e,this.category=i}get loc(){return this._loc}set loc(t){this._loc||(this._loc=new S),this._loc.assign(t)}get type(){return this._type}set type(t){this._type=t}get category(){return this._category}set category(t){this._category=t}dispose(){this._loc=null}}Dn.WINDOW="window";Dn.HOLE="hole";class g9{constructor(){this._masks=[]}get masks(){return this._masks}}class BA{constructor(){this._masks=new Map}get maskCount(){return this._masks.size}dispose(){this._masks&&(this.reset(),this._masks=null)}initialize(t){if(!t)return!1;if(this._masks.clear(),t.masks.length)for(const e of t.masks){if(!e)continue;const i=e.locations.length?e.locations[0]:null;i&&this._masks.set(e.id,new Dn(e.type,i,e.category))}return!0}reset(){for(const t of this._masks.values())t&&t.dispose();this._masks.clear()}addMask(t,e,i,r){const n=new Dn(e,i,r);this._masks.delete(t),this._masks.set(t,n)}removeMask(t){const e=this._masks.get(t);return e?(this._masks.delete(t),e.dispose(),!0):!1}getXML(){const t=new g9;for(const[e,i]of this._masks.entries()){if(!i)continue;const r=this.getMaskType(i),n=this.getMaskCategory(i),a=this.getMaskLocation(i);if(r&&n&&a){const o={id:e,type:r,category:n,locations:[{x:a.x,y:a.y,z:a.z}]};t.masks.push(o)}}return t}getMaskLocation(t){return t?t.loc:null}getMaskType(t){return t?t.type:null}getMaskCategory(t){return t?t.category:null}get masks(){return this._masks}}class E9{constructor(t,e,i,r){this._leftSideLoc=0,this._rightSideLoc=0,this._leftSideLength=0,this._rightSideLength=0,this._leftSideLoc=t,this._rightSideLoc=e,this._leftSideLength=i,this._rightSideLength=r}get leftSideLoc(){return this._leftSideLoc}get rightSideLoc(){return this._rightSideLoc}get leftSideLength(){return this._leftSideLength}get rightSideLength(){return this._rightSideLength}}class Kt{constructor(t,e,i,r,n){this._type=0,this._loc=null,this._leftSide=null,this._rightSide=null,this._normal=null,this._normalDirection=null;let a,o,h,u,c,l,_,d;if(this._secondaryNormals=[],this._masks=[],this._loc=new S,this._loc.assign(e),this._leftSide=new S,this._leftSide.assign(i),this._rightSide=new S,this._rightSide.assign(r),this._type=t,i!=null&&r!=null&&(this._normal=S.crossProduct(i,r),a=0,o=0,h=0,u=0,c=0,this.normal.x!=0||this.normal.y!=0?(u=this.normal.x,c=this.normal.y,a=360+Math.atan2(c,u)/Math.PI*180,a>=360&&(a=a-360),u=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y),c=this.normal.z,o=360+Math.atan2(c,u)/Math.PI*180,o>=360&&(o=o-360)):this.normal.z<0?o=90:o=270,this._normalDirection=new S(a,o,h)),n!=null&&n.length>0)for(l=0;l<n.length;)_=n[l],_!=null&&_.length>0&&(d=new S,d.assign(_),d.multiply(1/d.length),this._secondaryNormals.push(d)),l++}get type(){return this._type}get loc(){return this._loc}get leftSide(){return this._leftSide}get rightSide(){return this._rightSide}get normal(){return this._normal}get normalDirection(){return this._normalDirection}get secondaryNormalCount(){return this._secondaryNormals.length}get maskCount(){return this._masks.length}getSecondaryNormal(t){if(t<0||t>=this.secondaryNormalCount)return null;const e=new S;return e.assign(this._secondaryNormals[t]),e}addMask(t,e,i,r){const n=new E9(t,e,i,r);this._masks.push(n)}getMask(t){return t<0||t>=this.maskCount?null:this._masks[t]}getMaskLeftSideLoc(t){const e=this.getMask(t);return e!=null?e.leftSideLoc:-1}getMaskRightSideLoc(t){const e=this.getMask(t);return e!=null?e.rightSideLoc:-1}getMaskLeftSideLength(t){const e=this.getMask(t);return e!=null?e.leftSideLength:-1}getMaskRightSideLength(t){const e=this.getMask(t);return e!=null?e.rightSideLength:-1}}Kt.PLANE_UNDEFINED=0;Kt.PLANE_FLOOR=1;Kt.PLANE_WALL=2;Kt.PLANE_LANDSCAPE=3;Kt.PLANE_BILLBOARD=4;class p9{constructor(t,e,i,r){this._x=t,this._y=e,this._width=i,this._height=r}get x(){return this._x}get y(){return this._y}get width(){return this._width}get height(){return this._height}}const Zd=class{constructor(){this._corners=[],this._endPoints=[],this._directions=[],this._lengths=[],this._leftTurns=[],this._borders=[],this._hideWalls=[],this._manuallyLeftCut=[],this._manuallyRightCut=[],this._addDuplicates=!1,this._count=0}addWall(s,t,e,i,r){(this._addDuplicates||this.checkIsNotDuplicate(s,t,e,i,r))&&(this._corners.push(s),this._directions.push(t),this._lengths.push(e),this._borders.push(i),this._leftTurns.push(r),this._hideWalls.push(!1),this._manuallyLeftCut.push(!1),this._manuallyRightCut.push(!1),this._count++)}checkIsNotDuplicate(s,t,e,i,r){let n=0;for(;n<this._count;){if(this._corners[n].x==s.x&&this._corners[n].y==s.y&&this._directions[n]==t&&this._lengths[n]==e&&this._borders[n]==i&&this._leftTurns[n]==r)return!1;n++}return!0}get count(){return this._count}getCorner(s){return this._corners[s]}getEndPoint(s){return this.calculateWallEndPoints(),this._endPoints[s]}getLength(s){return this._lengths[s]}getDirection(s){return this._directions[s]}getBorder(s){return this._borders[s]}getHideWall(s){return this._hideWalls[s]}getLeftTurn(s){return this._leftTurns[s]}getManuallyLeftCut(s){return this._manuallyLeftCut[s]}getManuallyRightCut(s){return this._manuallyRightCut[s]}setHideWall(s,t){this._hideWalls[s]=t}setLength(s,t){t<this._lengths[s]&&(this._lengths[s]=t,this._manuallyRightCut[s]=!0)}moveCorner(s,t){let e;if(t>0&&t<this._lengths[s]){const i=this._corners[s];e=Zd.WALL_DIRECTION_VECTORS[this.getDirection(s)],this._corners[s]=new H(i.x+t*e.x,i.y+t*e.y),this._lengths[s]=this._lengths[s]-t,this._manuallyLeftCut[s]=!0}}calculateWallEndPoints(){let s,t,e,i,r;if(this._endPoints.length!=this.count)for(this._endPoints=[],s=0;s<this.count;)t=this.getCorner(s),e=new H(t.x,t.y),i=Zd.WALL_DIRECTION_VECTORS[this.getDirection(s)],r=this.getLength(s),e.x=e.x+i.x*r,e.y=e.y+i.y*r,this._endPoints.push(e),s++}};let si=Zd;si.WALL_DIRECTION_VECTORS=[new S(1,0,0),new S(0,1,0),new S(-1,0,0),new S(0,-1,0)];si.WALL_NORMAL_VECTORS=[new S(0,1,0),new S(-1,0,0),new S(0,-1,0),new S(1,0,0)];const Pt=class{constructor(){this._width=0,this._height=0,this._minX=0,this._maxX=0,this._minY=0,this._maxY=0,this._fixedWallHeight=-1,this._floorHeight=0,this._restrictsScaling=!1,this._restrictedScale=1,this._tileMatrix=[],this._tileMatrixOriginal=[],this._planes=[],this._floorHoleMatrix=[],this._wallHeight=3.6,this._wallThicknessMultiplier=1,this._floorThicknessMultiplier=1,this._floorHoles=new Map}static getFloorHeight(s){const t=s.length;if(!t)return 0;let e=0,i=0;for(;i<t;){const r=s[i];let n=0;for(;n<r.length;){const a=r[n];a>e&&(e=a),n++}i++}return e}static findEntranceTile(s){if(!s)return null;const t=s.length;if(!t)return null;const e=[];let i=0;for(;i<t;){const r=s[i];if(!r||!r.length)return null;let n=0;for(;n<r.length;){if(r[n]>=0){e.push(n);break}n++}e.length<i+1&&e.push(r.length+1),i++}for(i=1;i<e.length-1;){if(Math.trunc(e[i])<=Math.trunc(e[i-1])-1&&Math.trunc(e[i])<=Math.trunc(e[i+1])-1)return new H(Math.trunc(e[i]|0),i);i++}return null}static expandFloorTiles(s){let t,e,i,r,n,a,o,h,u,c,l,_;const d=s.length,g=s[0].length,m=[];for(e=0;e<d*4;)m[e]=[],e++;let p=0;for(e=0;e<d;){for(n=0,t=0;t<g;){if(a=s[e][t],a<0||a<=255)for(r=0;r<4;){for(i=0;i<4;)m[p+r]===void 0&&(m[p+r]=[]),m[p+r][n+i]=a<0?a:a*4,i++;r++}else{for(o=(a&255)*4,h=o+(a>>11&1)*3,u=o+(a>>10&1)*3,c=o+(a>>9&1)*3,l=o+(a>>8&1)*3,i=0;i<3;)_=i+1,m[p][n+i]=(h*(3-i)+u*i)/3,m[p+3][n+_]=(c*(3-_)+l*_)/3,m[p+_][n]=(h*(3-_)+c*_)/3,m[p+i][n+3]=(u*(3-i)+l*i)/3,i++;m[p+1][n+1]=h>o?o+2:o+1,m[p+1][n+2]=u>o?o+2:o+1,m[p+2][n+1]=c>o?o+2:o+1,m[p+2][n+2]=l>o?o+2:o+1}n=n+4,t++}p=p+4,e++}return m}static addTileTypes(s){let t,e,i,r,n,a,o,h,u,c,l,_,d;const g=s.length-1,m=s[0].length-1;for(e=1;e<g;){for(t=1;t<m;)i=s[e][t],i<0||(r=s[e-1][t-1]&255,n=s[e-1][t]&255,a=s[e-1][t+1]&255,o=s[e][t-1]&255,h=s[e][t+1]&255,u=s[e+1][t-1]&255,c=s[e+1][t]&255,l=s[e+1][t+1]&255,_=i+1,d=(r==_||n==_||o==_?8:0)|(a==_||n==_||h==_?4:0)|(u==_||c==_||o==_?2:0)|(l==_||c==_||h==_?1:0),d==15&&(d=0),s[e][t]=i|d<<8),t++;e++}}static unpadHeightMap(s){s.shift(),s.pop();for(const t of s)t.shift(),t.pop()}static padHeightMap(s){const t=[],e=[];for(const i of s)i.push(Pt.TILE_BLOCKED),i.unshift(Pt.TILE_BLOCKED);for(const i of s[0])t.push(Pt.TILE_BLOCKED),e.push(Pt.TILE_BLOCKED);s.push(e),s.unshift(t)}get minX(){return this._minX}get maxX(){return this._maxX}get minY(){return this._minY}get maxY(){return this._maxY}get tileMapWidth(){return this._width}get tileMapHeight(){return this._height}get planeCount(){return this._planes.length}get floorHeight(){return this._fixedWallHeight!=-1?this._fixedWallHeight:this._floorHeight}get wallHeight(){return this._fixedWallHeight!=-1?this._fixedWallHeight+3.6:this._wallHeight}set wallHeight(s){s<0&&(s=0),this._wallHeight=s}get wallThicknessMultiplier(){return this._wallThicknessMultiplier}set wallThicknessMultiplier(s){s<0&&(s=0),this._wallThicknessMultiplier=s}get floorThicknessMultiplier(){return this._floorThicknessMultiplier}set floorThicknessMultiplier(s){s<0&&(s=0),this._floorThicknessMultiplier=s}dispose(){this._planes=null,this._tileMatrix=null,this._tileMatrixOriginal=null,this._floorHoleMatrix=null,this._floorHoles!=null&&(this._floorHoles.clear(),this._floorHoles=null)}reset(){this._planes=[],this._tileMatrix=[],this._tileMatrixOriginal=[],this._width=0,this._height=0,this._minX=0,this._maxX=0,this._minY=0,this._maxY=0,this._floorHeight=0,this._floorHoleMatrix=[]}initializeTileMap(s,t){s<0&&(s=0),t<0&&(t=0),this._tileMatrix=[],this._tileMatrixOriginal=[],this._floorHoleMatrix=[];let e=0;for(;e<t;){const i=[],r=[],n=[];let a=0;for(;a<s;)i[a]=Pt.TILE_BLOCKED,r[a]=Pt.TILE_BLOCKED,n[a]=!1,a++;this._tileMatrix.push(i),this._tileMatrixOriginal.push(r),this._floorHoleMatrix.push(n),e++}return this._width=s,this._height=t,this._minX=this._width,this._maxX=-1,this._minY=this._height,this._maxY=-1,!0}setTileHeight(s,t,e){let i,r,n,a,o;if(s>=0&&s<this._width&&t>=0&&t<this._height){if(i=this._tileMatrix[t],i[s]=e,e>=0)s<this._minX&&(this._minX=s),s>this._maxX&&(this._maxX=s),t<this._minY&&(this._minY=t),t>this._maxY&&(this._maxY=t);else{if(s==this._minX||s==this._maxX){for(r=!1,n=this._minY;n<this._maxY;){if(this.getTileHeightInternal(s,n)>=0){r=!0;break}n++}r||(s==this._minX&&this._minX++,s==this._maxX&&this._maxX--)}if(t==this._minY||t==this._maxY){for(a=!1,o=this._minX;o<this._maxX;){if(this.getTileHeight(o,t)>=0){a=!0;break}o++}a||(t==this._minY&&this._minY++,t==this._maxY&&this._maxY--)}}return!0}return!1}getTileHeight(s,t){if(s<0||s>=this._width||t<0||t>=this._height)return Pt.TILE_BLOCKED;const e=this._tileMatrix[t];return e[s]===void 0?0:Math.abs(e[s])}getTileHeightOriginal(s,t){return s<0||s>=this._width||t<0||t>=this._height?Pt.TILE_BLOCKED:this._floorHoleMatrix[t][s]?Pt.TILE_HOLE:this._tileMatrixOriginal[t][s]}getTileHeightInternal(s,t){return s<0||s>=this._width||t<0||t>=this._height?Pt.TILE_BLOCKED:this._tileMatrix[t][s]}initializeFromTileData(s=-1){let t,e;for(this._fixedWallHeight=s,e=0;e<this._height;){for(t=0;t<this._width;)this._tileMatrixOriginal[e]===void 0&&(this._tileMatrixOriginal[e]=[]),this._tileMatrixOriginal[e][t]=this._tileMatrix[e][t],t++;e++}const i=Pt.findEntranceTile(this._tileMatrix);for(e=0;e<this._height;){for(t=0;t<this._width;)this._floorHoleMatrix[e]===void 0&&(this._floorHoleMatrix[e]=[]),this._floorHoleMatrix[e][t]&&this.setTileHeight(t,e,Pt.TILE_HOLE),t++;e++}return this.initialize(i)}initialize(s){let t=0;s!=null&&(t=this.getTileHeight(s.x,s.y),this.setTileHeight(s.x,s.y,Pt.TILE_BLOCKED)),this._floorHeight=Pt.getFloorHeight(this._tileMatrix),this.createWallPlanes();const e=[];for(const r of this._tileMatrix)e.push(r.concat());Pt.padHeightMap(e),Pt.addTileTypes(e),Pt.unpadHeightMap(e);const i=Pt.expandFloorTiles(e);return this.extractPlanes(i),s!=null&&(this.setTileHeight(s.x,s.y,t),this.addFloor(new S(s.x+.5,s.y+.5,t),new S(-1,0,0),new S(0,-1,0),!1,!1,!1,!1)),!0}generateWallData(s,t){let e,i,r,n,a;const o=new si,h=[this.extractTopWall.bind(this),this.extractRightWall.bind(this),this.extractBottomWall.bind(this),this.extractLeftWall.bind(this)];let u=0,c=new H(s.x,s.y),l=0;for(;l++<1e3;){if(e=!1,i=!1,r=u,(c.x<this.minX||c.x>this.maxX||c.y<this.minY||c.y>this.maxY)&&(e=!0),n=h[u](c,t),n==null)return null;if(a=Math.abs(n.x-c.x)+Math.abs(n.y-c.y),c.x==n.x||c.y==n.y?(u=(u-1+h.length)%h.length,a=a+1,i=!0):(u=(u+1)%h.length,a--),o.addWall(c,r,a,e,i),n.x==s.x&&n.y==s.y&&(n.x!=c.x||n.y!=c.y))break;c=n}return o.count==0?null:o}hidePeninsulaWallChains(s){let t,e,i,r,n=0;const a=s.count;for(;n<a;){const o=n;for(t=n,e=0,i=!1;!s.getBorder(n)&&n<a;)s.getLeftTurn(n)?e++:e>0&&e--,e>1&&(i=!0),t=n,n++;if(i)for(r=o;r<=t;)s.setHideWall(r,!0),r++;n++}}updateWallsNextToHoles(s){let t,e,i,r,n,a,o;const h=s.count;let u=0;for(;u<h;){if(!s.getHideWall(u)){for(t=s.getCorner(u),e=s.getDirection(u),i=s.getLength(u),r=si.WALL_DIRECTION_VECTORS[e],n=si.WALL_NORMAL_VECTORS[e],a=0,o=0;o<i;){if(this.getTileHeightInternal(t.x+o*r.x-n.x,t.y+o*r.y-n.y)==Pt.TILE_HOLE){if(o>0&&a==0){s.setLength(u,o);break}a++}else if(a>0){s.moveCorner(u,a);break}o++}a==i&&s.setHideWall(u,!0)}u++}}resolveOriginalWallIndex(s,t,e){let i,r,n,a,o,h;const u=Math.min(s.y,t.y),c=Math.max(s.y,t.y),l=Math.min(s.x,t.x),_=Math.max(s.x,t.x),d=e.count;let g=0;for(;g<d;){if(i=e.getCorner(g),r=e.getEndPoint(g),s.x==t.x){if(i.x==s.x&&r.x==s.x&&(n=Math.min(i.y,r.y),a=Math.max(i.y,r.y),n<=u&&c<=a))return g}else if(s.y==t.y&&i.y==s.y&&r.y==s.y&&(o=Math.min(i.x,r.x),h=Math.max(i.x,r.x),o<=l&&_<=h))return g;g++}return-1}hideOriginallyHiddenWalls(s,t){let e,i,r,n,a;const o=s.count;let h=0;for(;h<o;)s.getHideWall(h)||(e=s.getCorner(h),i=new H(e.x,e.y),r=si.WALL_DIRECTION_VECTORS[s.getDirection(h)],n=s.getLength(h),i.x=i.x+r.x*n,i.y=i.y+r.y*n,a=this.resolveOriginalWallIndex(e,i,t),a>=0?t.getHideWall(a)&&s.setHideWall(h,!0):s.setHideWall(h,!0)),h++}checkWallHiding(s,t){this.hidePeninsulaWallChains(t),this.updateWallsNextToHoles(s),this.hideOriginallyHiddenWalls(s,t)}addWalls(s,t){const e=s.count,i=t.count;let r=0;for(;r<e;){if(!s.getHideWall(r)){const n=s.getCorner(r),a=s.getDirection(r),o=s.getLength(r),h=si.WALL_DIRECTION_VECTORS[a],u=si.WALL_NORMAL_VECTORS[a];let c=-1,l=0;for(;l<o;){const b=this.getTileHeightInternal(n.x+l*h.x+u.x,n.y+l*h.y+u.y);b>=0&&(b<c||c<0)&&(c=b),l++}const _=c;let d=new S(n.x,n.y,_);d=S.sum(d,S.product(u,.5)),d=S.sum(d,S.product(h,-.5));const g=this.wallHeight+Math.min(Pt.MAX_WALL_ADDITIONAL_HEIGHT,this.floorHeight)-c,m=S.product(h,-o),p=new S(0,0,g);d=S.dif(d,m);const T=this.resolveOriginalWallIndex(n,s.getEndPoint(r),t);let A=0,O=0;T>=0?(A=t.getDirection((T+1)%i),O=t.getDirection((T-1+i)%i)):(A=s.getDirection((r+1)%e),O=s.getDirection((r-1+e)%e));let v=null;(A-a+4)%4==3?v=si.WALL_NORMAL_VECTORS[A]:(a-O+4)%4==3&&(v=si.WALL_NORMAL_VECTORS[O]);const y=s.getLeftTurn(r),C=s.getLeftTurn((r-1+e)%e),N=s.getHideWall((r+1)%e),L=s.getManuallyLeftCut(r),P=s.getManuallyRightCut(r);this.addWall(d,m,p,v,!C||L,!y||P,!N)}r++}}createWallPlanes(){const s=this._tileMatrix;if(s==null)return!1;let t,e,i;const r=s.length;let n=0;if(r==0)return!1;for(t=0;t<r;){if(i=s[t],i==null||i.length==0)return!1;n>0?n=Math.min(n,i.length):n=i.length,t++}const a=Math.min(Pt.MAX_WALL_ADDITIONAL_HEIGHT,this._fixedWallHeight!=-1?this._fixedWallHeight:Pt.getFloorHeight(s)),o=this.minX;let h=this.minY;for(h=this.minY;h<=this.maxY;){if(this.getTileHeightInternal(o,h)>Pt.TILE_HOLE){h--;break}h++}if(h>this.maxY)return!1;const u=new H(o,h),c=this.generateWallData(u,!0),l=this.generateWallData(u,!1);for(c!=null&&(c.count,l.count,this.checkWallHiding(c,l),this.addWalls(c,l)),e=0;e<this.tileMapHeight;){for(t=0;t<this.tileMapWidth;)this.getTileHeightInternal(t,e)<0&&this.setTileHeight(t,e,-(a+this.wallHeight)),t++;e++}return!0}extractTopWall(s,t){if(s==null)return null;let e=1,i=Pt.TILE_HOLE;for(t||(i=Pt.TILE_BLOCKED);e<1e3;){if(this.getTileHeightInternal(s.x+e,s.y)>i)return new H(s.x+e-1,s.y);if(this.getTileHeightInternal(s.x+e,s.y+1)<=i)return new H(s.x+e,s.y+1);e++}return null}extractRightWall(s,t){if(s==null)return null;let e=1,i=Pt.TILE_HOLE;for(t||(i=Pt.TILE_BLOCKED);e<1e3;){if(this.getTileHeightInternal(s.x,s.y+e)>i)return new H(s.x,s.y+(e-1));if(this.getTileHeightInternal(s.x-1,s.y+e)<=i)return new H(s.x-1,s.y+e);e++}return null}extractBottomWall(s,t){if(s==null)return null;let e=1,i=Pt.TILE_HOLE;for(t||(i=Pt.TILE_BLOCKED);e<1e3;){if(this.getTileHeightInternal(s.x-e,s.y)>i)return new H(s.x-(e-1),s.y);if(this.getTileHeightInternal(s.x-e,s.y-1)<=i)return new H(s.x-e,s.y-1);e++}return null}extractLeftWall(s,t){if(s==null)return null;let e=1,i=Pt.TILE_HOLE;for(t||(i=Pt.TILE_BLOCKED);e<1e3;){if(this.getTileHeightInternal(s.x,s.y-e)>i)return new H(s.x,s.y-(e-1));if(this.getTileHeightInternal(s.x+1,s.y-e)<=i)return new H(s.x+1,s.y-e);e++}return null}addWall(s,t,e,i,r,n,a){this.addPlane(Kt.PLANE_WALL,s,t,e,[i]),this.addPlane(Kt.PLANE_LANDSCAPE,s,t,e,[i]);const o=Pt.WALL_THICKNESS*this._wallThicknessMultiplier,h=Pt.FLOOR_THICKNESS*this._floorThicknessMultiplier,u=S.crossProduct(t,e),c=S.product(u,1/u.length*-o);if(this.addPlane(Kt.PLANE_WALL,S.sum(s,e),t,c,[u,i]),r&&this.addPlane(Kt.PLANE_WALL,S.sum(S.sum(s,t),e),S.product(e,-(e.length+h)/e.length),c,[u,i]),n&&(this.addPlane(Kt.PLANE_WALL,S.sum(s,S.product(e,-h/e.length)),S.product(e,(e.length+h)/e.length),c,[u,i]),a)){const l=S.product(t,o/t.length);this.addPlane(Kt.PLANE_WALL,S.sum(S.sum(s,e),S.product(l,-1)),l,c,[u,t,i])}}addFloor(s,t,e,i,r,n,a){let o,h,u;this.addPlane(Kt.PLANE_FLOOR,s,t,e)!=null&&(o=Pt.FLOOR_THICKNESS*this._floorThicknessMultiplier,h=new S(0,0,o),u=S.dif(s,h),n&&this.addPlane(Kt.PLANE_FLOOR,u,t,h),a&&this.addPlane(Kt.PLANE_FLOOR,S.sum(u,S.sum(t,e)),S.product(t,-1),h),i&&this.addPlane(Kt.PLANE_FLOOR,S.sum(u,e),S.product(e,-1),h),r&&this.addPlane(Kt.PLANE_FLOOR,S.sum(u,t),e,h))}initializeFromMapData(s){if(!s)return!1;this.reset(),this.resetFloorHoles();const t=s.width,e=s.height,i=s.wallHeight,r=s.fixedWallsHeight;if(this.initializeTileMap(t,e),s.tileMap){let n=0;for(;n<s.tileMap.length;){const a=s.tileMap[n];if(a){let o=0;for(;o<a.length;){const h=a[o];h&&this.setTileHeight(o,n,h.height),o++}}n++}}if(s.holeMap&&s.holeMap.length){let n=0;for(;n<s.holeMap.length;){const a=s.holeMap[n];a&&(this.addFloorHole(a.id,a.x,a.y,a.width,a.height),n++)}this.initializeHoleMap()}return this.wallHeight=i,this.restrictsDragging=s.restrictsDragging,this.restrictsScaling=s.restrictsScaling,this.restrictedScale=s.restrictedScale,this.initializeFromTileData(r),!0}addPlane(s,t,e,i,r=null){if(e.length==0||i.length==0)return null;const n=new Kt(s,t,e,i,r);return this._planes.push(n),n}getMapData(){const s=new GA;s.width=this._width,s.height=this._height,s.wallHeight=this._wallHeight,s.fixedWallsHeight=this._fixedWallHeight,s.dimensions.minX=this.minX,s.dimensions.maxX=this.maxX,s.dimensions.minY=this.minY,s.dimensions.maxY=this.maxY,s.restrictsDragging=this.restrictsDragging,s.restrictsScaling=this.restrictsScaling,s.restrictedScale=this.restrictedScale;let t=0;for(;t<this._height;){const e=[],i=this._tileMatrixOriginal[t];let r=0;for(;r<this._width;){const n=i[r];e.push({height:n}),r++}s.tileMap.push(e),t++}for(const[e,i]of this._floorHoles.entries())i&&s.holeMap.push({id:e,x:i.x,y:i.y,width:i.width,height:i.height});return s}getPlaneLocation(s){if(s<0||s>=this.planeCount)return null;const t=this._planes[s];return t?t.loc:null}getPlaneNormal(s){if(s<0||s>=this.planeCount)return null;const t=this._planes[s];return t?t.normal:null}getPlaneLeftSide(s){if(s<0||s>=this.planeCount)return null;const t=this._planes[s];return t?t.leftSide:null}getPlaneRightSide(s){if(s<0||s>=this.planeCount)return null;const t=this._planes[s];return t?t.rightSide:null}getPlaneNormalDirection(s){if(s<0||s>=this.planeCount)return null;const t=this._planes[s];return t?t.normalDirection:null}getPlaneSecondaryNormals(s){let t,e;if(s<0||s>=this.planeCount)return null;const i=this._planes[s];if(i!=null){for(t=[],e=0;e<i.secondaryNormalCount;)t.push(i.getSecondaryNormal(e)),e++;return t}return null}getPlaneType(s){if(s<0||s>=this.planeCount)return Kt.PLANE_UNDEFINED;const t=this._planes[s];return t?t.type:Kt.PLANE_UNDEFINED}getPlaneMaskCount(s){if(s<0||s>=this.planeCount)return 0;const t=this._planes[s];return t?t.maskCount:0}getPlaneMaskLeftSideLoc(s,t){if(s<0||s>=this.planeCount)return-1;const e=this._planes[s];return e?e.getMaskLeftSideLoc(t):-1}getPlaneMaskRightSideLoc(s,t){if(s<0||s>=this.planeCount)return-1;const e=this._planes[s];return e?e.getMaskRightSideLoc(t):-1}getPlaneMaskLeftSideLength(s,t){if(s<0||s>=this.planeCount)return-1;const e=this._planes[s];return e?e.getMaskLeftSideLength(t):-1}getPlaneMaskRightSideLength(s,t){if(s<0||s>=this.planeCount)return-1;const e=this._planes[s];return e?e.getMaskRightSideLength(t):-1}addFloorHole(s,t,e,i,r){this.removeFloorHole(s),this._floorHoles.set(s,new p9(t,e,i,r))}removeFloorHole(s){this._floorHoles.delete(s)}resetFloorHoles(){this._floorHoles.clear()}initializeHoleMap(){let s,t,e,i,r,n,a,o;for(t=0;t<this._height;){for(e=this._floorHoleMatrix[t],s=0;s<this._width;)e[s]=!1,s++;t++}for(const h of this._floorHoles.values())if(i=h,i!=null)for(r=i.x,n=i.x+i.width-1,a=i.y,o=i.y+i.height-1,r=r<0?0:r,n=n>=this._width?this._width-1:n,a=a<0?0:a,o=o>=this._height?this._height-1:o,t=a;t<=o;){for(e=this._floorHoleMatrix[t],s=r;s<=n;)e[s]=!0,s++;t++}}extractPlanes(s){let t,e,i,r,n,a,o,h,u,c,l,_,d,g,m;const p=s.length,T=s[0].length,A=[];let O=0;for(;O<p;)A[O]=[],O++;let v=0;for(;v<p;){for(t=0;t<T;){if(e=s[v][t],!(e<0||A[v][t])){for(n=t==0||s[v][t-1]!=e,a=v==0||s[v-1][t]!=e,i=t+1;i<T&&!(s[v][i]!=e||A[v][i]||v>0&&s[v-1][i]==e==a);)i++;for(o=i==T||s[v][i]!=e,l=!1,r=v+1;r<p&&!l;){for(h=s[r][t]!=e,l=h||t>0&&s[r][t-1]==e==n||i<T&&s[r][i]==e==o,u=t;u<i;){if(s[r][u]==e==h){l=!0,i=u;break}u++}if(l)break;r++}for(h=h||r==p,o=i==T||s[v][i]!=e,c=v;c<r;){for(u=t;u<i;)A[c][u]=!0,u++;c++}_=t/4-.5,d=v/4-.5,g=(i-t)/4,m=(r-v)/4,this.addFloor(new S(_+g,d+m,e/4),new S(-g,0,0),new S(0,-m,0),o,n,h,a)}t++}v++}}get restrictsDragging(){return this._restrictsDragging}set restrictsDragging(s){this._restrictsDragging=s}get restrictsScaling(){return this._restrictsScaling}set restrictsScaling(s){this._restrictsScaling=s}get restrictedScale(){return this._restrictedScale}set restrictedScale(s){this._restrictedScale=s}};let ae=Pt;ae.FLOOR_THICKNESS=.25;ae.WALL_THICKNESS=.25;ae.MAX_WALL_ADDITIONAL_HEIGHT=20;ae.TILE_BLOCKED=-110;ae.TILE_HOLE=-100;class m9 extends bl{constructor(){super(),this._planeParser=new ae,this._planeBitmapMaskParser=new BA,this._color=16777215,this._light=255,this._originalColor=16777215,this._originalLight=255,this._targetColor=16777215,this._targetLight=255,this._colorChangedTime=0,this._colorTransitionLength=1500,this._lastHoleUpdate=0,this._needsMapUpdate=!1,this._skipColorTransition=!1}getEventTypes(){const t=[$.MOUSE_MOVE,$.CLICK];return this.mergeTypes(super.getEventTypes(),t)}dispose(){super.dispose(),this._planeParser&&(this._planeParser.dispose(),this._planeParser=null),this._planeBitmapMaskParser&&(this._planeBitmapMaskParser.dispose(),this._planeBitmapMaskParser=null)}initialize(t){!t||!this.object||t instanceof GA&&this._planeParser.initializeFromMapData(t)&&(this.object.model.setValue(I.ROOM_MAP_DATA,t),this.object.model.setValue(I.ROOM_BACKGROUND_COLOR,16777215),this.object.model.setValue(I.ROOM_FLOOR_VISIBILITY,1),this.object.model.setValue(I.ROOM_WALL_VISIBILITY,1),this.object.model.setValue(I.ROOM_LANDSCAPE_VISIBILITY,1),this._skipColorTransition=rt.getValue("room.color.skip.transition")===!0)}update(t){if(super.update(t),this.updateBackgroundColor(t),this._needsMapUpdate){if(this._lastHoleUpdate&&t-this._lastHoleUpdate<5)return;const e=this.object&&this.object.model;if(e){const i=this._planeParser.getMapData();e.setValue(I.ROOM_MAP_DATA,i),e.setValue(I.ROOM_FLOOR_HOLE_UPDATE_TIME,t),this._planeParser.initializeFromMapData(i)}this._lastHoleUpdate=0,this._needsMapUpdate=!1}}updateBackgroundColor(t){if(!this.object||!this._colorChangedTime)return;let e=this._color,i=this._light;if(t-this._colorChangedTime>=this._colorTransitionLength)e=this._targetColor,i=this._targetLight,this._colorChangedTime=0;else{let n=this._originalColor>>16&255,a=this._originalColor>>8&255,o=this._originalColor&255;const h=this._targetColor>>16&255,u=this._targetColor>>8&255,c=this._targetColor&255,l=(t-this._colorChangedTime)/this._colorTransitionLength;n=n+(h-n)*l,a=a+(u-a)*l,o=o+(c-o)*l,e=(n<<16)+(a<<8)+o,i=this._originalLight+(this._targetLight-this._originalLight)*l,this._color=e,this._light=i}let r=Zu.rgbToHSL(e);r=(r&16776960)+i,e=Zu.hslToRGB(r),this.object.model&&this.object.model.setValue(I.ROOM_BACKGROUND_COLOR,e)}processUpdateMessage(t){if(!t||!this.object)return;const e=this.object.model;if(e){if(t instanceof ye){this.onObjectRoomUpdateMessage(t,e);return}if(t instanceof Ce){this.onObjectRoomMaskUpdateMessage(t,e);return}if(t instanceof Wi){this.onObjectRoomPlaneVisibilityUpdateMessage(t,e);return}if(t instanceof Yi){this.onObjectRoomPlanePropertyUpdateMessage(t,e);return}if(t instanceof zi){this.onObjectRoomFloorHoleUpdateMessage(t,e);return}if(t instanceof ll){this.onObjectRoomColorUpdateMessage(t,e);return}t instanceof ig&&this.onObjectRoomMapUpdateMessage(t)}}onObjectRoomUpdateMessage(t,e){switch(t.type){case ye.ROOM_FLOOR_UPDATE:e.setValue(I.ROOM_FLOOR_TYPE,t.value);return;case ye.ROOM_WALL_UPDATE:e.setValue(I.ROOM_WALL_TYPE,t.value);return;case ye.ROOM_LANDSCAPE_UPDATE:e.setValue(I.ROOM_LANDSCAPE_TYPE,t.value);return}}onObjectRoomMaskUpdateMessage(t,e){let i=null,r=!1;switch(t.type){case Ce.ADD_MASK:i=Dn.WINDOW,t.maskCategory===Ce.HOLE&&(i=Dn.HOLE),this._planeBitmapMaskParser.addMask(t.maskId,t.maskType,t.maskLocation,i),r=!0;break;case Ce.REMOVE_MASK:r=this._planeBitmapMaskParser.removeMask(t.maskId);break}r&&e.setValue(I.ROOM_PLANE_MASK_XML,this._planeBitmapMaskParser.getXML())}onObjectRoomPlaneVisibilityUpdateMessage(t,e){let i=0;switch(t.visible&&(i=1),t.type){case Wi.FLOOR_VISIBILITY:e.setValue(I.ROOM_FLOOR_VISIBILITY,i);return;case Wi.WALL_VISIBILITY:e.setValue(I.ROOM_WALL_VISIBILITY,i),e.setValue(I.ROOM_LANDSCAPE_VISIBILITY,i);return}}onObjectRoomPlanePropertyUpdateMessage(t,e){switch(t.type){case Yi.FLOOR_THICKNESS:e.setValue(I.ROOM_FLOOR_THICKNESS,t.value);return;case Yi.WALL_THICKNESS:e.setValue(I.ROOM_WALL_THICKNESS,t.value);return}}onObjectRoomFloorHoleUpdateMessage(t,e){switch(t.type){case zi.ADD:this._planeParser.addFloorHole(t.id,t.x,t.y,t.width,t.height),this._needsMapUpdate=!0;return;case zi.REMOVE:this._planeParser.removeFloorHole(t.id),this._needsMapUpdate=!0;return}this._lastHoleUpdate=this.time}onObjectRoomColorUpdateMessage(t,e){!t||!e||(this._originalColor=this._color,this._originalLight=this._light,this._targetColor=t.color,this._targetLight=t.light,this._colorChangedTime=this.time,this._skipColorTransition?this._colorTransitionLength=0:this._colorTransitionLength=1500,e.setValue(I.ROOM_COLORIZE_BG_ONLY,t.backgroundOnly))}onObjectRoomMapUpdateMessage(t){!t||!t.mapData||(this.object.model.setValue(I.ROOM_MAP_DATA,t.mapData),this.object.model.setValue(I.ROOM_FLOOR_HOLE_UPDATE_TIME,this.time),this._planeParser.initializeFromMapData(t.mapData))}mouseEvent(t,e){if(!t||!e||!this.object||!this.object.model)return;const i=t.spriteTag;let r=0;if(i&&i.indexOf("@")>=0&&(r=parseInt(i.substr(i.indexOf("@")+1))),r<1||r>this._planeParser.planeCount){t.type===k.ROLL_OUT&&this.object.model.setValue(I.ROOM_SELECTED_PLANE,0);return}r--;let n=null;const a=this._planeParser.getPlaneLocation(r),o=this._planeParser.getPlaneLeftSide(r),h=this._planeParser.getPlaneRightSide(r),u=this._planeParser.getPlaneNormalDirection(r),c=this._planeParser.getPlaneType(r);if(a==null||o==null||h==null||u==null)return;const l=o.length,_=h.length;if(l==0||_==0)return;const d=t.screenX,g=t.screenY,m=new H(d,g);if(n=e.getPlanePosition(m,a,o,h),!n){this.object.model.setValue(I.ROOM_SELECTED_PLANE,0);return}const p=S.product(o,n.x/l);p.add(S.product(h,n.y/_)),p.add(a);const T=p.x,A=p.y,O=p.z;if(n.x>=0&&n.x<l&&n.y>=0&&n.y<_)this.object.model.setValue(I.ROOM_SELECTED_X,T),this.object.model.setValue(I.ROOM_SELECTED_Y,A),this.object.model.setValue(I.ROOM_SELECTED_Z,O),this.object.model.setValue(I.ROOM_SELECTED_PLANE,r+1);else{this.object.model.setValue(I.ROOM_SELECTED_PLANE,0);return}let v=null;switch(t.type===k.MOUSE_MOVE||t.type===k.ROLL_OVER?v=$.MOUSE_MOVE:t.type===k.MOUSE_CLICK&&(v=$.CLICK),t.type){case k.MOUSE_MOVE:case k.ROLL_OVER:case k.MOUSE_CLICK:{let y=null;if(c===Kt.PLANE_FLOOR)y=new vi(v,this.object,t.eventId,T,A,O,t.altKey,t.ctrlKey,t.shiftKey,t.buttonDown);else if(c===Kt.PLANE_WALL||c===Kt.PLANE_LANDSCAPE){let C=90;u&&(C=u.x+90,C>360&&(C-=360));const N=o.length*n.x/l,L=h.length*n.y/_;y=new Kn(v,this.object,t.eventId,a,o,h,N,L,C,t.altKey,t.ctrlKey,t.shiftKey,t.buttonDown)}this.eventDispatcher&&this.eventDispatcher.dispatchEvent(y);return}}}}class I9 extends bl{initialize(t){this.object&&(this.object.model.setValue(I.FURNITURE_ALPHA_MULTIPLIER,1),this.object.setState(1,0))}processUpdateMessage(t){if(super.processUpdateMessage(t),t instanceof Xi&&this.object)switch(t.type){case Xi.ENABLED:this.object.setState(0,0);return;case Xi.DISABLED:this.object.setState(1,0);return}}}const Jn=class extends bl{constructor(){super(),this._lastEventId=null,this._isHidden=!1}initialize(s){this.object&&(this.object.model.setValue(I.FURNITURE_ALPHA_MULTIPLIER,1),this.object.setState(Jn.CURSOR_HIDDEN_STATE,0))}processUpdateMessage(s){s instanceof Zn&&(this._lastEventId&&this._lastEventId===s.sourceEventId||(s.toggleVisibility&&(this._isHidden=!this._isHidden),super.processUpdateMessage(s),this.object&&(this._isHidden?this.object.setState(Jn.CURSOR_HIDDEN_STATE,0):s.visible?(this.object.model.setValue(I.TILE_CURSOR_HEIGHT,s.height),this.object.setState(s.height>.8?Jn.CURSOR_HEIGHT_STATE:Jn.CURSOR_VISIBLE_STATE)):this.object.setState(Jn.CURSOR_HIDDEN_STATE,0)),this._lastEventId=s.sourceEventId))}};let t_=Jn;t_.CURSOR_VISIBLE_STATE=0;t_.CURSOR_HIDDEN_STATE=1;t_.CURSOR_HEIGHT_STATE=6;class HA{constructor(t,e,i){this._id=t,this._type=e,this._visualization=i}dispose(){this._visualization=null}update(t,e){}animate(t){return!1}get id(){return this._id}get type(){return this._type}get visualization(){return this._visualization}}const ur=class extends HA{constructor(s,t,e){super(s,t,e),this._asset=null,this._startTime=_t(),this._delta=0,this._offsetY=0,this._scale=0,this._state=0}update(s,t){if(!s)return;this._scale=t;let e=64,i=0;if(t<48?(this._asset=this.visualization.getAvatarRenderAsset("avatar_addition_user_blowkiss_small"),this.visualization.angle===90||this.visualization.angle===270?i=0:this.visualization.angle===135||this.visualization.angle===180||this.visualization.angle===225?i=6:i=-6,this._offsetY=-38,e=32):(this._asset=this.visualization.getAvatarRenderAsset("avatar_addition_user_blowkiss"),this.visualization.angle===90||this.visualization.angle===270?i=-3:this.visualization.angle===135||this.visualization.angle===180||this.visualization.angle===225?i=22:i=-30,this._offsetY=-70),this.visualization.posture===x.POSTURE_SIT?this._offsetY+=e/2:this.visualization.posture===x.POSTURE_LAY&&(this._offsetY+=e),this._asset){s.texture=this._asset,s.offsetX=i,s.offsetY=this._offsetY,s.relativeDepth=-.02,s.alpha=0;const r=this._delta;this.animate(s),this._delta=r}}animate(s){if(!s)return!1;if(this._asset&&(s.texture=this._asset),this._state===ur.STATE_DELAY)return _t()-this._startTime<ur.DELAY_BEFORE_ANIMATION?!1:(this._state=ur.STATE_FADE_IN,s.alpha=0,s.visible=!0,this._delta=0,!0);if(this._state===ur.STATE_FADE_IN)return this._delta+=.1,s.offsetY=this._offsetY,s.alpha=Math.pow(this._delta,.9)*255,this._delta>=1&&(s.alpha=255,this._delta=0,this._state=ur.STATE_FLOAT),!0;if(this._state===ur.STATE_FLOAT){const t=Math.pow(this._delta,.9);this._delta+=.05;const e=this._scale<48?-30:-40;return s.offsetY=this._offsetY+(this._delta<1?t:1)*e,s.alpha=(1-t)*255,s.alpha<=0&&(s.visible=!1,this._state=ur.STATE_COMPLETE),!0}return!1}};let ja=ur;ja.DELAY_BEFORE_ANIMATION=300;ja.STATE_DELAY=0;ja.STATE_FADE_IN=1;ja.STATE_FLOAT=2;ja.STATE_COMPLETE=3;class za{static getExpressionAddition(t,e,i){switch(e){case this.BLOW:return new ja(t,this.BLOW,i);default:return new HA(t,e,i)}}}za.WAVE=1;za.BLOW=2;za.LAUGH=3;za.CRY=4;za.IDLE=5;const xs=class{constructor(s,t){this._id=s,this._visualization=t,this._asset=null,this._startTime=_t(),this._offsetY=0,this._scale=0,this._state=0}dispose(){this._visualization=null,this._asset=null}getSpriteAssetName(s){let t="left";return(this._visualization.angle===135||this._visualization.angle===180||this._visualization.angle===225||this._visualization.angle===270)&&(t="right"),"avatar_addition_user_idle_"+t+"_"+s+(this._scale<48?"_small":"")}update(s,t){if(!s)return;this._scale=t,this._asset=this._visualization.getAvatarRenderAsset(this.getSpriteAssetName(this._state===xs.STATE_FRAME_A?1:2));let e=64,i=0;t<48?(this._visualization.angle===135||this._visualization.angle===180||this._visualization.angle===225||this._visualization.angle===270?i=10:i=-16,this._offsetY=-38,e=32):(this._visualization.angle===135||this._visualization.angle===180||this._visualization.angle===225||this._visualization.angle===270?i=22:i=-30,this._offsetY=-70),this._visualization.posture===x.POSTURE_SIT?this._offsetY+=e/2:this._visualization.posture===x.POSTURE_LAY&&(this._offsetY+=e-.3*e),this._asset&&(s.texture=this._asset,s.offsetX=i,s.offsetY=this._offsetY,s.relativeDepth=-.02,s.alpha=0)}animate(s){if(!s)return!1;const t=_t();return this._state===xs.STATE_DELAY&&t-this._startTime>=xs.DELAY_BEFORE_ANIMATION&&(this._state=xs.STATE_FRAME_A,this._startTime=t,this._asset=this._visualization.getAvatarRenderAsset(this.getSpriteAssetName(1))),this._state===xs.STATE_FRAME_A&&t-this._startTime>=xs.DELAY_PER_FRAME&&(this._state=xs.STATE_FRAME_B,this._startTime=t,this._asset=this._visualization.getAvatarRenderAsset(this.getSpriteAssetName(2))),this._state===xs.STATE_FRAME_B&&t-this._startTime>=xs.DELAY_PER_FRAME&&(this._state=xs.STATE_FRAME_A,this._startTime=t,this._asset=this._visualization.getAvatarRenderAsset(this.getSpriteAssetName(1))),this._asset?(s.texture=this._asset,s.alpha=255,s.visible=!0):s.visible=!1,!1}get id(){return this._id}};let Ya=xs;Ya.DELAY_BEFORE_ANIMATION=2e3;Ya.DELAY_PER_FRAME=2e3;Ya.STATE_DELAY=0;Ya.STATE_FRAME_A=1;Ya.STATE_FRAME_B=2;const Io=class{constructor(s){this._id=s,this._asset=null,this._disposed=!1}dispose(){this._asset=null}update(s,t){if(s){if(!this._asset){const e=new Wt(ut.WHITE);e.alpha=0,e.width=Io.WIDTH,e.height=Io.HEIGHT,this._asset=qt.generateTexture(e)}s.visible=!0,s.texture=this._asset,s.offsetX=Io.OFFSET_X,s.offsetY=Io.OFFSET_Y,s.alphaTolerance=Ms.MATCH_ALL_PIXELS}}animate(s){return!1}get id(){return this._id}};let Mh=Io;Mh.WIDTH=46;Mh.HEIGHT=60;Mh.OFFSET_X=-23;Mh.OFFSET_Y=-48;class T9{constructor(t,e,i){this._id=t,this._visualization=e,this._asset=null,this._relativeDepth=0,this._status=i}dispose(){this._visualization=null,this._asset=null}update(t,e){if(!t)return;t.visible=!0,t.relativeDepth=this._relativeDepth,t.alpha=255;let i=64,r=0,n=0;this._asset=this._visualization.getAvatarRenderAsset(this._status===Gs.GUIDE?"avatar_addition_user_guide_bubble":"avatar_addition_user_guide_requester_bubble"),e<48?(r=-19,n=-80,i=32):(r=-19,n=-120),this._visualization.posture===x.POSTURE_SIT?n+=i/2:this._visualization.posture===x.POSTURE_LAY&&(n+=e),this._asset&&(t.texture=this._asset,t.offsetX=r,t.offsetY=n,t.relativeDepth=-.02+0)}animate(t){return this._asset&&t&&(t.texture=this._asset),!1}get id(){return this._id}get relativeDepth(){return this._relativeDepth}set relativeDepth(t){this._relativeDepth=t}}class R9{constructor(t,e){this._id=t,this._visualization=e,this._asset=null}dispose(){this._visualization=null,this._asset=null}update(t,e){if(!t)return;let i=64,r=0,n=0;e<48?(this._asset=this._visualization.getAvatarRenderAsset("avatar_addition_user_muted_small"),i=32,r=-12,n=-66):(this._asset=this._visualization.getAvatarRenderAsset("avatar_addition_user_muted"),r=-15,n=-110),this._visualization.posture===x.POSTURE_SIT?n+=i/2:this._visualization.posture===x.POSTURE_LAY&&(n+=e),this._asset?(t.visible=!0,t.texture=this._asset,t.offsetX=r,t.offsetY=n,t.relativeDepth=-.02):t.visible=!1}animate(t){return this._asset&&t&&(t.texture=this._asset),!1}get id(){return this._id}}class O9{constructor(t,e,i){this._id=t,this._visualization=i,this._asset=null,this._scale=0,this._number=e,this._numberValueFadeDirection=0,this._numberValueMoving=!1,this._numberValueMoveCounter=0}dispose(){this._visualization=null,this._asset=null}update(t,e){if(!t)return;this._scale=e;let i=64,r=0,n=0;this._number>0?(e<48?(this._asset=this._visualization.getAvatarRenderAsset("avatar_addition_number_"+this._number+"_small"),i=32,r=-6,n=-52):(this._asset=this._visualization.getAvatarRenderAsset("avatar_addition_number_"+this._number),r=-8,n=-105),this._visualization.posture===x.POSTURE_SIT?n+=i/2:this._visualization.posture===x.POSTURE_LAY&&(n+=e),this._asset?(t.visible=!0,t.texture=this._asset,t.offsetX=r,t.offsetY=n,t.relativeDepth=-.01,t.alpha=0,this._numberValueFadeDirection=1,this._numberValueMoving=!0,this._numberValueMoveCounter=0):t.visible=!1):t.visible&&(this._numberValueFadeDirection=-1)}animate(t){if(!t)return!1;this._asset&&(t.texture=this._asset);let e=t.alpha,i=!1;if(this._numberValueMoving){if(this._numberValueMoveCounter++,this._numberValueMoveCounter<10)return!1;if(this._numberValueFadeDirection<0)this._scale<48?t.offsetY-=2:t.offsetY-=4;else{let r=4;this._scale<48&&(r=8),this._numberValueMoveCounter%r||(t.offsetY--,i=!0)}}return this._numberValueFadeDirection>0?(e<255&&(e+=32),e>=255&&(e=255,this._numberValueFadeDirection=0),t.alpha=e,!0):this._numberValueFadeDirection<0?(e>=0&&(e-=32),e<=0&&(this._numberValueFadeDirection=0,this._numberValueMoving=!1,e=0,t.visible=!1),t.alpha=e,!0):i}get id(){return this._id}}class A9{constructor(t,e){this._id=t,this._visualization=e,this._asset=null,this._relativeDepth=0}dispose(){this._visualization=null,this._asset=null}update(t,e){if(!t)return;t.visible=!0,t.relativeDepth=this._relativeDepth,t.alpha=255;let i=64,r=0,n=0;e<48?(this._asset=this._visualization.getAvatarRenderAsset("avatar_addition_user_typing_small"),r=3,n=-42,i=32):(this._asset=this._visualization.getAvatarRenderAsset("avatar_addition_user_typing"),r=14,n=-83),this._visualization.posture===x.POSTURE_SIT?n+=i/2:this._visualization.posture===x.POSTURE_LAY&&(n+=e),this._asset&&(t.texture=this._asset,t.offsetX=r,t.offsetY=n,t.relativeDepth=-.02+0)}animate(t){return this._asset&&t&&(t.texture=this._asset),!1}get id(){return this._id}get relativeDepth(){return this._relativeDepth}set relativeDepth(t){this._relativeDepth=t}}class _l extends cs{constructor(){super()}initialize(t){return!0}onDispose(){this._avatarRenderer=null}createAvatarImage(t,e,i=null,r=null,n=null){let a=null;return e>48?a=this._avatarRenderer.createAvatarImage(t,ui.LARGE,i,r,n):a=this._avatarRenderer.createAvatarImage(t,ui.SMALL,i,r,n),a}getAvatarRendererAsset(t){return this._avatarRenderer?this._avatarRenderer.assets.getTexture(t):null}get avatarManager(){return this._avatarRenderer}set avatarManager(t){this._avatarRenderer=t}get layerCount(){return 0}}const it=class extends fh{constructor(){super(),this._data=null,this._avatarImage=null,this._cachedAvatars=new Ee,this._cachedAvatarEffects=new Ee,this._shadow=null,this._lastUpdate=-1e3,this._disposed=!1,this._figure=null,this._gender=null,this._direction=-1,this._headDirection=-1,this._posture="",this._postureParameter="",this._canStandUp=!1,this._postureOffset=0,this._verticalOffset=0,this._angle=-1,this._headAngle=-1,this._talk=!1,this._expression=0,this._sleep=!1,this._blink=!1,this._gesture=0,this._sign=-1,this._highlightEnabled=!1,this._highlight=!1,this._dance=0,this._effect=0,this._carryObject=0,this._useObject=0,this._ownUser=!1,this._isLaying=!1,this._layInside=!1,this._isAnimating=!1,this._extraSpritesStartIndex=2,this._forcedAnimFrames=0,this._updatesUntilFrameUpdate=0,this._isAvatarReady=!1,this._needsUpdate=!1,this._geometryUpdateCounter=-1,this._additions=new Map}initialize(s){return s instanceof _l?(this._data=s,this.createSprites(it.INITIAL_RESERVED_SPRITES),super.initialize(s),!0):!1}dispose(){this._disposed||(super.dispose(),this._avatarImage&&this._avatarImage.dispose(),this._shadow=null,this._disposed=!0)}update(s,t,e,i){if(!this.object||!s||!this._data||t<this._lastUpdate+it.UPDATE_TIME_INCREASER)return;this._lastUpdate+=it.UPDATE_TIME_INCREASER,this._lastUpdate+it.UPDATE_TIME_INCREASER<t&&(this._lastUpdate=t-it.UPDATE_TIME_INCREASER);const r=this.object.model,n=s.scale,a=this._effect;let o=!1,h=!1,u=!1,c=!1;const l=this.updateModel(r,n);if(l||n!==this._scale||!this._avatarImage){if(n!==this._scale&&(o=!0,this.updateScale(n)),a!==this._effect&&(h=!0),o||!this._avatarImage||h){if(this._avatarImage=this.createAvatarImage(n,this._effect),!this._avatarImage)return;u=!0;const g=this.getSprite(it.AVATAR_LAYER_ID);g&&this._avatarImage&&this._avatarImage.isPlaceholder()?g.alpha=150:g&&(g.alpha=255)}if(!this._avatarImage)return;if(h&&this._avatarImage.animationHasResetOnToggle&&this._avatarImage.resetAnimationFrameCounter(),this.updateShadow(n),c=this.updateObject(this.object,s,e,!0),this.processActionsForAvatar(this._avatarImage),this._additions){let g=this._extraSpritesStartIndex;for(const m of this._additions.values())m.update(this.getSprite(g++),n)}this._scale=n}else c=this.updateObject(this.object,s,e);if(this._additions){let g=this._extraSpritesStartIndex;for(const m of this._additions.values())m.animate(this.getSprite(g++))&&this.updateSpriteCounter++}const _=c||l||o,d=(this._isAnimating||this._forcedAnimFrames>0)&&e;if(_&&(this._forcedAnimFrames=it.ANIMATION_FRAME_UPDATE_INTERVAL),_||d){if(this.updateSpriteCounter++,this._forcedAnimFrames--,this._updatesUntilFrameUpdate--,this._updatesUntilFrameUpdate<=0||o||l||u)this._avatarImage.updateAnimationByFrames(1),this._updatesUntilFrameUpdate=it.ANIMATION_FRAME_UPDATE_INTERVAL;else return;let g=this._avatarImage.getCanvasOffsets();(!g||g.length<3)&&(g=it.DEFAULT_CANVAS_OFFSETS);const m=this.getSprite(it.SPRITE_INDEX_AVATAR);if(m){const O=this.object.model.getValue(I.FIGURE_HIGHLIGHT_ENABLE)===1&&this.object.model.getValue(I.FIGURE_HIGHLIGHT)===1,v=this._avatarImage.getImage(We.FULL,O);v&&(m.texture=v,O||(m.filters=[])),m.texture&&(m.offsetX=-1*n/2+g[0]-(m.texture.width-n)/2,m.offsetY=-m.texture.height+n/4+g[1]+this._postureOffset),this._isLaying?this._layInside?m.relativeDepth=-.5:m.relativeDepth=it.AVATAR_SPRITE_LAYING_DEPTH+g[2]:m.relativeDepth=it.AVATAR_SPRITE_DEFAULT_DEPTH+g[2],this._ownUser?(m.relativeDepth-=it.AVATAR_OWN_DEPTH_ADJUST,m.spriteType=es.AVATAR_OWN):m.spriteType=es.AVATAR}const p=this.getAddition(it.TYPING_BUBBLE_ID);p&&(this._isLaying?p.relativeDepth=it.AVATAR_SPRITE_LAYING_DEPTH-.01+g[2]:p.relativeDepth=it.AVATAR_SPRITE_DEFAULT_DEPTH-.01+g[2]),this._isAnimating=this._avatarImage.isAnimating();let T=it.INITIAL_RESERVED_SPRITES;const A=this._avatarImage.getDirection();for(const O of this._avatarImage.getSprites())if(O.id===it.AVATAR){const v=this.getSprite(it.SPRITE_INDEX_AVATAR);if(v){const y=this._avatarImage.getLayerData(O);let C=O.getDirectionOffsetX(A),N=O.getDirectionOffsetY(A);y&&(C+=y.dx,N+=y.dy),n<48&&(C/=2,N/=2),this._canStandUp||(v.offsetX+=C,v.offsetY+=N)}}else{const v=this.getSprite(T);if(v){v.alphaTolerance=Ms.MATCH_NOTHING,v.visible=!0;const y=this._avatarImage.getLayerData(O);let C=0,N=O.getDirectionOffsetX(A),L=O.getDirectionOffsetY(A);const P=O.getDirectionOffsetZ(A);let b=0;O.hasDirections&&(b=A),y&&(C=y.animationFrame,N+=y.dx,L+=y.dy,b+=y.dd),n<48&&(N/=2,L/=2),b<0?b+=8:b>7&&(b-=8);const w=this._avatarImage.getScale()+"_"+O.member+"_"+b+"_"+C,q=this._avatarImage.getAsset(w);if(!q)continue;v.texture=q.texture,v.offsetX=q.offsetX-n/2+N,v.offsetY=q.offsetY+L,v.flipH=q.flipH,O.hasStaticY?v.offsetY+=this._verticalOffset*n/(2*it.BASE_Y_SCALE):v.offsetY+=this._postureOffset,this._isLaying?v.relativeDepth=it.AVATAR_SPRITE_LAYING_DEPTH-.001*this.totalSprites*P:v.relativeDepth=it.AVATAR_SPRITE_DEFAULT_DEPTH-.001*this.totalSprites*P,O.ink===33?v.blendMode=J.ADD:v.blendMode=J.NORMAL}T++}}}createAvatarImage(s,t){let e=null,i="avatarImage"+s.toString();if(t?(i+="-"+t,e=this._cachedAvatarEffects.getValue(i)):e=this._cachedAvatars.getValue(i),!e&&(e=this._data.createAvatarImage(this._figure,s,this._gender,this,this),e))if(!t)this._cachedAvatars.add(i,e);else{if(this._cachedAvatarEffects.length>=it.MAX_EFFECT_CACHE){const r=this._cachedAvatarEffects.remove(this._cachedAvatarEffects.getKey(0));r&&r.dispose()}this._cachedAvatarEffects.add(i,e)}return e}updateObject(s,t,e,i=!1){if(!i&&this.updateObjectCounter===s.updateCounter&&this._geometryUpdateCounter===t.updateId)return!1;let r=s.getDirection().x-t.direction.x,n=this._headDirection-t.direction.x;return this._posture==="float"&&(n=r),r=(r%360+360)%360,n=(n%360+360)%360,this._posture==="sit"&&this._canStandUp&&(r-=r%90-45,n-=n%90-45),(r!==this._angle||i)&&(e=!0,this._angle=r,r=r-(135-22.5),r=(r+360)%360,this._avatarImage.setDirectionAngle(We.FULL,r)),(n!==this._headAngle||i)&&(e=!0,this._headAngle=n,this._headAngle!==this._angle&&(n=n-(135-22.5),n=(n+360)%360,this._avatarImage.setDirectionAngle(We.HEAD,n))),this._geometryUpdateCounter=t.updateId,this.updateObjectCounter=this.object.updateCounter,e}updateModel(s,t){if(!s||this.updateModelCounter===s.updateCounter)return!1;let e=!1;const i=s.getValue(I.FIGURE_TALK)>0;i!==this._talk&&(this._talk=i,e=!0);const r=s.getValue(I.FIGURE_EXPRESSION);r!==this._expression&&(this._expression=r,e=!0);const n=s.getValue(I.FIGURE_SLEEP)>0;n!==this._sleep&&(this._sleep=n,e=!0);const a=s.getValue(I.FIGURE_BLINK)>0;a!==this._blink&&(this._blink=a,e=!0);const o=s.getValue(I.FIGURE_GESTURE)||0;o!==this._gesture&&(this._gesture=o,e=!0);const h=s.getValue(I.FIGURE_POSTURE);h!==this._posture&&(this._posture=h,e=!0);const u=s.getValue(I.FIGURE_POSTURE_PARAMETER);u!==this._postureParameter&&(this._postureParameter=u,e=!0);const c=s.getValue(I.FIGURE_CAN_STAND_UP);c!==this._canStandUp&&(this._canStandUp=c,e=!0);const l=s.getValue(I.FIGURE_VERTICAL_OFFSET)*it.BASE_Y_SCALE;l!==this._verticalOffset&&(this._verticalOffset=l,e=!0);const _=s.getValue(I.FIGURE_DANCE)||0;_!==this._dance&&(this._dance=_,e=!0);const d=s.getValue(I.FIGURE_EFFECT)||0;d!==this._effect&&(this._effect=d,e=!0);const g=s.getValue(I.FIGURE_CARRY_OBJECT)||0;g!==this._carryObject&&(this._carryObject=g,e=!0);const m=s.getValue(I.FIGURE_USE_OBJECT)||0;m!==this._useObject&&(this._useObject=m,e=!0);const p=s.getValue(I.HEAD_DIRECTION);p!==this._headDirection&&(this._headDirection=p,e=!0),this._carryObject>0&&m>0?this._useObject!==this._carryObject&&(this._useObject=this._carryObject,e=!0):this._useObject!==0&&(this._useObject=0,e=!0);let T=this.getAddition(it.FLOATING_IDLE_Z_ID);this._sleep?(T||(T=this.addAddition(new Ya(it.FLOATING_IDLE_Z_ID,this))),e=!0):T&&this.removeAddition(it.FLOATING_IDLE_Z_ID);const A=s.getValue(I.FIGURE_IS_MUTED)>0;let O=this.getAddition(it.MUTED_BUBBLE_ID);if(A)O||(O=this.addAddition(new R9(it.MUTED_BUBBLE_ID,this))),e=!0;else{O&&(this.removeAddition(it.MUTED_BUBBLE_ID),e=!0);const dt=s.getValue(I.FIGURE_IS_TYPING)>0;let j=this.getAddition(it.TYPING_BUBBLE_ID);dt?(j||(j=this.addAddition(new A9(it.TYPING_BUBBLE_ID,this))),e=!0):j&&(this.removeAddition(it.TYPING_BUBBLE_ID),e=!0)}const v=s.getValue(I.FIGURE_GUIDE_STATUS)||0;v!==Gs.NONE?(this.removeAddition(it.GUIDE_BUBBLE_ID),this.addAddition(new T9(it.GUIDE_BUBBLE_ID,this,v)),e=!0):this.getAddition(it.GUIDE_BUBBLE_ID)&&(this.removeAddition(it.GUIDE_BUBBLE_ID),e=!0);const y=s.getValue(I.FIGURE_IS_PLAYING_GAME)>0;let C=this.getAddition(it.GAME_CLICK_TARGET_ID);y?(C||(C=this.addAddition(new Mh(it.GAME_CLICK_TARGET_ID))),e=!0):C&&this.removeAddition(it.GAME_CLICK_TARGET_ID);const N=s.getValue(I.FIGURE_NUMBER_VALUE);let L=this.getAddition(it.NUMBER_BUBBLE_ID);N>0?(L||(L=this.addAddition(new O9(it.NUMBER_BUBBLE_ID,N,this))),e=!0):L&&this.removeAddition(it.NUMBER_BUBBLE_ID);let P=this.getAddition(it.EXPRESSION_ID);this._expression>0?P||(P=za.getExpressionAddition(it.EXPRESSION_ID,this._expression,this),P&&this.addAddition(P)):P&&this.removeAddition(it.EXPRESSION_ID),this.updateScale(t);const b=s.getValue(I.GENDER);b!==this._gender&&(this._gender=b,e=!0),this.updateFigure(s.getValue(I.FIGURE))&&(e=!0);let w=s.getValue(I.FIGURE_SIGN);w===null&&(w=-1),this._sign!==w&&(this._sign=w,e=!0);const q=s.getValue(I.FIGURE_HIGHLIGHT_ENABLE)>0;if(q!==this._highlightEnabled&&(this._highlightEnabled=q,e=!0),this._highlightEnabled){const dt=s.getValue(I.FIGURE_HIGHLIGHT)>0;dt!==this._highlight&&(this._highlight=dt,e=!0)}const ht=s.getValue(I.OWN_USER)>0;return ht!==this._ownUser&&(this._ownUser=ht,e=!0),this.updateModelCounter=s.updateCounter,e}setDirection(s){this._direction!==s&&(this._direction=s,this._needsUpdate=!0)}updateScale(s){s<48&&(this._blink=!1),this._posture==="sit"||this._posture==="lay"?this._postureOffset=s/2:this._postureOffset=0,this._layInside=!1,this._isLaying=!1,this._posture==="lay"&&(this._isLaying=!0,parseInt(this._postureParameter)<0&&(this._layInside=!0))}processActionsForAvatar(s){if(!s)return;if(s.initActionAppends(),s.appendAction(x.POSTURE,this._posture,this._postureParameter),this._gesture>0&&this._avatarImage.appendAction(x.GESTURE,x.getGesture(this._gesture)),this._dance>0&&this._avatarImage.appendAction(x.DANCE,this._dance),this._sign>-1&&this._avatarImage.appendAction(x.SIGN,this._sign),this._carryObject>0&&this._avatarImage.appendAction(x.CARRY_OBJECT,this._carryObject),this._useObject>0&&this._avatarImage.appendAction(x.USE_OBJECT,this._useObject),this._talk&&this._avatarImage.appendAction(x.TALK),(this._sleep||this._blink)&&this._avatarImage.appendAction(x.SLEEP),this._expression>0){const e=x.getExpression(this._expression);if(e!=="")switch(e){case x.DANCE:this._avatarImage.appendAction(x.DANCE,2);break;default:this._avatarImage.appendAction(e);break}}this._effect>0&&this._avatarImage.appendAction(x.EFFECT,this._effect),s.endActionAppends(),this._isAnimating=s.isAnimating();let t=it.INITIAL_RESERVED_SPRITES;for(const e of this._avatarImage.getSprites())e.id!==it.AVATAR&&t++;if(t!==this.totalSprites&&this.createSprites(t),this._extraSpritesStartIndex=t,this._additions)for(const e of this._additions.values())this.createSprite()}updateFigure(s){return this._figure===s?!1:(this._figure=s,this.clearAvatar(),!0)}resetFigure(s){this.clearAvatar()}resetEffect(s){this.clearAvatar()}clearAvatar(){for(const t of this._cachedAvatars.getValues())t&&t.dispose();for(const t of this._cachedAvatarEffects.getValues())t&&t.dispose();this._cachedAvatars.reset(),this._cachedAvatarEffects.reset(),this._avatarImage=null;const s=this.getSprite(it.AVATAR_LAYER_ID);s&&(s.texture=ut.EMPTY,s.alpha=255)}getAddition(s){if(!this._additions)return null;const t=this._additions.get(s);return t||null}addAddition(s){if(!this.getAddition(s.id))return this._additions.set(s.id,s),s}removeAddition(s){const t=this.getAddition(s);t&&(this._additions.delete(t.id),t.dispose())}updateShadow(s){this._shadow=null;const t=this.getSprite(it.SHADOW_LAYER_ID);if(!t)return;let e=this._posture==="mv"||this._posture==="std"||this._posture==="sit"&&this._canStandUp;if(this._effect===it.SNOWBOARDING_EFFECT&&(e=!1),e){if(t.visible=!0,!this._shadow||s!==this._scale){let i=0,r=0;s<48?(t.libraryAssetName="sh_std_sd_1_0_0",this._shadow=this._avatarImage.getAsset(t.libraryAssetName),i=-8,r=this._canStandUp?6:-3):(t.libraryAssetName="h_std_sd_1_0_0",this._shadow=this._avatarImage.getAsset(t.libraryAssetName),i=-17,r=this._canStandUp?10:-7),this._shadow?(t.texture=this._shadow.texture,t.offsetX=i,t.offsetY=r,t.alpha=50,t.relativeDepth=1):t.visible=!1}}else this._shadow=null,t.visible=!1}getAvatarRenderAsset(s){return this._data?this._data.getAvatarRendererAsset(s):null}get direction(){return this._direction}get posture(){return this._posture}get angle(){return this._angle}get disposed(){return this._disposed}};let _e=it;_e.AVATAR="avatar";_e.FLOATING_IDLE_Z_ID=1;_e.TYPING_BUBBLE_ID=2;_e.EXPRESSION_ID=3;_e.NUMBER_BUBBLE_ID=4;_e.GAME_CLICK_TARGET_ID=5;_e.MUTED_BUBBLE_ID=6;_e.GUIDE_BUBBLE_ID=7;_e.OWN_USER_ID=4;_e.UPDATE_TIME_INCREASER=41;_e.AVATAR_LAYER_ID=0;_e.SHADOW_LAYER_ID=1;_e.SNOWBOARDING_EFFECT=97;_e.INITIAL_RESERVED_SPRITES=2;_e.ANIMATION_FRAME_UPDATE_INTERVAL=2;_e.DEFAULT_CANVAS_OFFSETS=[0,0,0];_e.MAX_EFFECT_CACHE=2;_e.SPRITE_INDEX_AVATAR=0;_e.BASE_Y_SCALE=1e3;_e.AVATAR_SPRITE_DEFAULT_DEPTH=-.01;_e.AVATAR_OWN_DEPTH_ADJUST=.001;_e.AVATAR_SPRITE_LAYING_DEPTH=-.409;const Mi=class{static allocate(s,t,e,i,r,n,a=-1,o=0){const h=Mi.POOL.length?Mi.POOL.pop():new Mi;return i<1&&(i=1),r<0&&(r=Mi.FRAME_REPEAT_FOREVER),h._id=s,h._x=t||0,h._y=e||0,h._repeats=i,h._frameRepeats=r,h._remainingFrameRepeats=r,h._isLastFrame=n,h._isRecycled=!1,a>=0?(h._activeSequence=a,h._activeSequenceOffset=o):(h._activeSequence=-1,h._activeSequenceOffset=0),h}get id(){return this._id>=0?this._id:-this._id*Math.random()}get x(){return this._x}get y(){return this._y}get repeats(){return this._repeats}get frameRepeats(){return this._frameRepeats}get isLastFrame(){return this._isLastFrame}get remainingFrameRepeats(){return this._frameRepeats<0?Mi.FRAME_REPEAT_FOREVER:this._remainingFrameRepeats}set remainingFrameRepeats(s){s<0&&(s=0),this._frameRepeats>0&&s>this._frameRepeats&&(s=this._frameRepeats),this._remainingFrameRepeats=s}get activeSequence(){return this._activeSequence}get activeSequenceOffset(){return this._activeSequenceOffset}recycle(){this._isRecycled||(this._isRecycled=!0,Mi.POOL.length<Mi.POOL_SIZE_LIMIT&&Mi.POOL.push(this))}};let Ei=Mi;Ei.FRAME_REPEAT_FOREVER=-1;Ei.SEQUENCE_NOT_DEFINED=-1;Ei.POOL_SIZE_LIMIT=3e3;Ei.POOL=[];class VA{constructor(t,e,i,r,n,a){this._id=0,this._x=0,this._y=0,this._randomX=0,this._randomY=0,this._repeats=1,this._id=t,this._x=e,this._y=i,this._randomX=r,this._randomY=n,this._repeats=a}get id(){return this._id}hasDirectionalOffsets(){return!1}getX(t){return this._x}getY(t){return this._y}get x(){return this._x}get y(){return this._x}get randomX(){return this._randomX}get randomY(){return this._randomY}get repeats(){return this._repeats}}class v9 extends VA{constructor(t,e,i,r,n,a,o){super(t,e,i,r,n,o),this._directionalOffsets=a}hasDirectionalOffsets(){return this._directionalOffsets!==null}getX(t){return this._directionalOffsets?this._directionalOffsets.getXOffset(t,super.getX(t)):super.getX(t)}getY(t){return this._directionalOffsets?this._directionalOffsets.getYOffset(t,super.getY(t)):super.getY(t)}}class S9{constructor(t,e){this._frames=[],this._frameIndexes=[],this._frameRepeats=[],this._isRandom=e,this._loopCount=t<1?1:t}get isRandom(){return this._isRandom}get frameCount(){return this._frameIndexes.length*this._loopCount}dispose(){this._frames=[]}initialize(){let t=this._frameIndexes.length-1,e=-1,i=1;for(;t>=0;)this._frameIndexes[t]===e?i++:(e=this._frameIndexes[t],i=1),this._frameRepeats[t]=i,t--}addFrame(t,e,i,r,n,a){let o=1;if(this._frames.length>0){const u=this._frames[this._frames.length-1];u.id===t&&!u.hasDirectionalOffsets()&&u.x===e&&u.y===i&&u.randomX===r&&r===0&&u.randomY===n&&n===0&&(o+=u.repeats,this._frames.pop())}const h=a?new v9(t,e,i,r,n,a,o):new VA(t,e,i,r,n,o);this._frames.push(h),this._frameIndexes.push(this._frames.length-1),this._frameRepeats.push(1)}getFrame(t){return!this._frames.length||t<0||t>=this.frameCount?null:this._frames[this._frameIndexes[t%this._frameIndexes.length]]}getFrameIndex(t){return t<0||t>=this.frameCount?-1:(this._isRandom&&(t=Math.round(Math.random()*this._frameIndexes.length),t===this._frameIndexes.length&&t--),t)}getRepeats(t){return t<0||t>=this.frameCount?0:this._frameRepeats[t%this._frameRepeats.length]}}class y9{constructor(t,e,i){this._frameSequences=[],this._frameCount=-1,this._loopCount=t<0?0:t,this._frameRepeat=e<1?1:e,this._isRandom=i}get frameCount(){return this._frameCount<0&&this.calculateLength(),this._frameCount}dispose(){if(!(!this._frameSequences||!this._frameSequences.length)){for(const t of this._frameSequences)t&&t.dispose();this._frameSequences=[]}}addFrameSequence(t,e){const i=new S9(t,e);return this._frameSequences.push(i),i}calculateLength(){this._frameCount=0;for(const t of this._frameSequences)t&&(this._frameCount+=t.frameCount)}getFrame(t,e){if(this._frameCount<1)return null;if(e=e/this._frameRepeat,!this._isRandom){const n=Math.floor(e/this._frameCount);e=Math.floor(e%this._frameCount);let a=!1,o=null;(this._loopCount>0&&n>=this._loopCount||this._loopCount<=0&&this._frameCount===1)&&(e=this._frameCount-1,a=!0);let h=0,u=0;for(;u<this._frameSequences.length;){if(o=this._frameSequences[u],o){if(e<h+o.frameCount)break;h+=o.frameCount}u++}return this.getFrameFromSpecificSequence(t,o,u,e-h,a)}const i=Math.trunc(this._frameSequences.length*Math.random()),r=this._frameSequences[i];return r.frameCount<1?null:this.getFrameFromSpecificSequence(t,r,i,0,!1)}getFrameFromSequence(t,e,i,r){if(e<0||e>=this._frameSequences.length)return null;const n=this._frameSequences[e];return n?i>=n.frameCount?this.getFrame(t,r):this.getFrameFromSpecificSequence(t,n,e,i,!1):null}getFrameFromSpecificSequence(t,e,i,r,n){if(!e)return null;const a=e.getFrameIndex(r),o=e.getFrame(a);if(!o)return null;let h=o.getX(t),u=o.getY(t);const c=o.randomX,l=o.randomY;let _=o.repeats,d=!1;c&&(h=Math.trunc(h+c*Math.random())),l&&(u=Math.trunc(u+l*Math.random())),_>1&&(_=e.getRepeats(a));let g=this._frameRepeat*_;return n&&(g=Ei.FRAME_REPEAT_FOREVER),!this._isRandom&&!e.isRandom&&i===this._frameSequences.length-1&&r===e.frameCount-1&&(d=!0),Ei.allocate(o.id,h,u,_,g,d,i,r)}}class kA{constructor(){this._offsetX=new Map,this._offsetY=new Map}getXOffset(t,e){const i=this._offsetX.get(t);return i??e}getYOffset(t,e){const i=this._offsetY.get(t);return i??e}setDirection(t,e,i){this._offsetX.set(t,e),this._offsetY.set(t,i)}}const $n=class{constructor(){this._layers=new Map,this._frameCount=-1,this._randomStart=!1,this._immediateChanges=null}static getTransitionToAnimationId(s){return $n.TRANSITION_TO_ANIMATION_OFFSET+s}static getTransitionFromAnimationId(s){return $n.TRANSITION_FROM_ANIMATION_OFFSET+s}static isTransitionToAnimation(s){return s>=$n.TRANSITION_TO_ANIMATION_OFFSET&&s<$n.TRANSITION_FROM_ANIMATION_OFFSET}static isTransitionFromAnimation(s){return s>=$n.TRANSITION_FROM_ANIMATION_OFFSET}dispose(){for(const s of this._layers.values())s&&s.dispose();this._layers.clear(),this._immediateChanges=null}setImmediateChanges(s){this._immediateChanges=s}isImmediateChange(s){return!(!this._immediateChanges||this._immediateChanges.indexOf(s)===-1)}getStartFrame(s){return this._randomStart?Math.random()*this._frameCount:0}initialize(s){if(s.randomStart&&(this._randomStart=!0),s.layers)for(const t in s.layers){const e=s.layers[t];if(!e)return!1;const i=parseInt(t),r=e.loopCount!==void 0?e.loopCount:1,n=e.frameRepeat!==void 0?e.frameRepeat:1,a=e.random!==void 0&&e.random!==0;if(!this.addLayer(i,r,n,a,e))return!1}return!0}addLayer(s,t,e,i,r){const n=new y9(t,e,i);if(r.frameSequences)for(const o in r.frameSequences){const h=r.frameSequences[o];if(!h)continue;const u=h.loopCount!==void 0?h.loopCount:1,c=h.random!==void 0&&h.random!==0,l=n.addFrameSequence(u,c);if(h.frames)for(const _ in h.frames){const d=h.frames[_];if(!d)return n.dispose(),!1;l.addFrame(d.id,d.x||0,d.y||0,d.randomX||0,d.randomY||0,this.readDirectionalOffsets(d))}l.initialize()}n.calculateLength(),this._layers.set(s,n);const a=n.frameCount;return a>this._frameCount&&(this._frameCount=a),!0}readDirectionalOffsets(s){let t=null;if(s&&s.offsets)for(const e in s.offsets){const i=s.offsets[e];i&&(t||(t=new kA),t.setDirection(i.direction,i.x,i.y))}return t}getFrame(s,t,e){const i=this._layers.get(t);return i?i.getFrame(s,e):null}getFrameFromSequence(s,t,e,i,r){const n=this._layers.get(t);return n?n.getFrameFromSequence(s,e,i,r):null}};let fe=$n;fe.TRANSITION_TO_ANIMATION_OFFSET=1e6;fe.TRANSITION_FROM_ANIMATION_OFFSET=2e6;fe.DEFAULT_FRAME_NUMBER=0;const Qd=class{constructor(s){this._colors=[],this.createColors(s)}createColors(s){if(s)for(let t=0;t<s;t++)this._colors.push(Qd.DEFAULT_COLOR)}dispose(){this._colors=[]}getLayerColor(s){const t=this._colors[s];return t||Qd.DEFAULT_COLOR}setColorLayer(s,t){this._colors[s]&&(this._colors[s]=t)}};let Da=Qd;Da.DEFAULT_COLOR=16777215;const lr=class{constructor(){this._tag=lr.DEFAULT_TAG,this._ink=lr.DEFAULT_INK,this._alpha=lr.DEFAULT_ALPHA,this._ignoreMouse=lr.DEFAULT_IGNORE_MOUSE,this._xOffset=lr.DEFAULT_XOFFSET,this._yOffset=lr.DEFAULT_YOFFSET,this._zOffset=lr.DEFAULT_ZOFFSET}setFromLayer(s){s&&(this._tag=s.tag,this._ink=s.ink,this._alpha=s.alpha,this._ignoreMouse=s.ignoreMouse,this._xOffset=s.xOffset,this._yOffset=s.yOffset,this._zOffset=s.zOffset)}get tag(){return this._tag}set tag(s){this._tag=s}get ink(){return this._ink}set ink(s){this._ink=s}get alpha(){return this._alpha}set alpha(s){this._alpha=s}get ignoreMouse(){return this._ignoreMouse}set ignoreMouse(s){this._ignoreMouse=s}get xOffset(){return this._xOffset}set xOffset(s){this._xOffset=s}get yOffset(){return this._yOffset}set yOffset(s){this._yOffset=s}get zOffset(){return this._zOffset}set zOffset(s){this._zOffset=s}};let ct=lr;ct.DEFAULT_COUNT=0;ct.DEFAULT_DIRECTION=0;ct.DEFAULT_TAG="";ct.DEFAULT_INK=J.NORMAL;ct.DEFAULT_ALPHA=255;ct.DEFAULT_IGNORE_MOUSE=!1;ct.DEFAULT_XOFFSET=0;ct.DEFAULT_YOFFSET=0;ct.DEFAULT_ZOFFSET=0;class mn{constructor(t){this._layers=[],this.createLayers(t)}createLayers(t){if(t)for(let e=0;e<t;e++)this._layers.push(new ct)}dispose(){this._layers=[]}setFromDirection(t){if(!t)return;const e=this.layerCount;if(e===t.layerCount)for(let i=0;i<e;i++){const r=this.getLayer(i),n=t.getLayer(i);r&&r.setFromLayer(n)}}getLayer(t){const e=this._layers[t];return e||null}getLayerTag(t){const e=this.getLayer(t);return e?e.tag:ct.DEFAULT_TAG}setLayerTag(t,e){const i=this.getLayer(t);i&&(i.tag=e)}getLayerInk(t){const e=this.getLayer(t);return e?e.ink:ct.DEFAULT_INK}setLayerInk(t,e){const i=this.getLayer(t);i&&(isNaN(e)||(i.ink=e))}getLayerAlpha(t){const e=this.getLayer(t);return e?e.alpha:ct.DEFAULT_ALPHA}setLayerAlpha(t,e){const i=this.getLayer(t);i&&(isNaN(e)||(i.alpha=e))}getLayerIgnoreMouse(t){const e=this.getLayer(t);return e?e.ignoreMouse:ct.DEFAULT_IGNORE_MOUSE}setLayerIgnoreMouse(t,e){const i=this.getLayer(t);i&&(i.ignoreMouse=e||!1)}getLayerXOffset(t){const e=this.getLayer(t);return e?e.xOffset:ct.DEFAULT_XOFFSET}setLayerXOffset(t,e){const i=this.getLayer(t);i&&(isNaN(e)||(i.xOffset=e))}getLayerYOffset(t){const e=this.getLayer(t);return e?e.yOffset:ct.DEFAULT_YOFFSET}setLayerYOffset(t,e){const i=this.getLayer(t);i&&(isNaN(e)||(i.yOffset=e))}getLayerZOffset(t){const e=this.getLayer(t);return e?e.zOffset:ct.DEFAULT_ZOFFSET}setLayerZOffset(t,e){const i=this.getLayer(t);i&&(isNaN(e)||(i.zOffset=e))}get layerCount(){return this._layers.length}}mn.USE_DEFAULT_DIRECTION=-1;const Jd=class{constructor(s,t){this._layerCount=s<0?0:s>Jd.MAX_LAYERS?Jd.MAX_LAYERS:s,this._angle=t<1?1:t>360?360:t,this._defaultDirection=new mn(this._layerCount),this._directions=new Map,this._colors=[],this._lastDirectionData=null,this._lastDirection=-1}dispose(){this._defaultDirection&&this._defaultDirection.dispose();for(const s of this._directions.values())s&&s.dispose();for(const s of this._colors)s&&s.dispose();this.reset()}reset(){this._defaultDirection=null,this._colors=[],this._lastDirectionData=null,this._lastDirection=-1,this._directions.clear()}processLayers(s){return s?this.setDirectionLayers(this._defaultDirection,s):!1}processDirections(s){if(!s)return!1;for(const t in s){const e=s[t];if(!e)continue;const i=parseInt(t);if(this._directions.get(i))return!1;const r=new mn(this._layerCount);r.setFromDirection(this._defaultDirection),this.setDirectionLayers(r,e.layers),this._directions.set(i,r),this._lastDirectionData=null,this._lastDirection=-1}return!0}processColors(s){if(!s)return!1;for(const t in s){const e=s[t];if(!e)continue;const i=parseInt(t);if(this._colors[i])return!1;const r=new Da(this._layerCount);for(const n in e.layers){const a=e.layers[n];if(!a)continue;const o=parseInt(n),h=a.color;r.setColorLayer(o,h)}this._colors[i]=r}return!0}setDirectionLayers(s,t){if(!s||!t)return!1;for(const e in t){const i=t[e];if(!i)continue;const r=parseInt(e);if(r<0||r>=this._layerCount)return!1;i.ink!==void 0&&s.setLayerInk(r,eL.inkToBlendMode(i.ink)),i.tag!==void 0&&s.setLayerTag(r,i.tag),i.alpha!==void 0&&s.setLayerAlpha(r,i.alpha),i.ignoreMouse!==void 0&&s.setLayerIgnoreMouse(r,i.ignoreMouse),i.x!==void 0&&s.setLayerXOffset(r,i.x),i.y!==void 0&&s.setLayerYOffset(r,i.y),i.z!==void 0&&s.setLayerZOffset(r,i.z/-1e3)}return!0}getValidDirection(s){if(this._directions.get(s))return s;s=(s%360+360)%360;let e=-1,i=-1;for(const r of this._directions.keys()){let n=(r*this._angle-s+360)%360;n>180&&(n=360-n),(n<e||e<0)&&(e=n,i=r)}return i>=0?Math.trunc(i):0}getDirectionData(s){if(s===this._lastDirection&&this._lastDirectionData)return this._lastDirectionData;let t=this._directions.get(s);return t||(t=this._defaultDirection),this._lastDirection=s,this._lastDirectionData=t,this._lastDirectionData}getLayerTag(s,t){const e=this.getDirectionData(s);return e?e.getLayerTag(t):ct.DEFAULT_TAG}getLayerInk(s,t){const e=this.getDirectionData(s);return e?e.getLayerInk(t):ct.DEFAULT_INK}getLayerAlpha(s,t){const e=this.getDirectionData(s);return e?e.getLayerAlpha(t):ct.DEFAULT_ALPHA}getLayerColor(s,t){const e=this._colors[t];return e?e.getLayerColor(s):Da.DEFAULT_COLOR}getLayerIgnoreMouse(s,t){const e=this.getDirectionData(s);return e?e.getLayerIgnoreMouse(t):ct.DEFAULT_IGNORE_MOUSE}getLayerXOffset(s,t){const e=this.getDirectionData(s);return e?e.getLayerXOffset(t):ct.DEFAULT_XOFFSET}getLayerYOffset(s,t){const e=this.getDirectionData(s);return e?e.getLayerYOffset(t):ct.DEFAULT_YOFFSET}getLayerZOffset(s,t){const e=this.getDirectionData(s);return e?e.getLayerZOffset(t):ct.DEFAULT_ZOFFSET}get layerCount(){return this._layerCount}};let ag=Jd;ag.MAX_LAYERS=26;class cl extends ag{constructor(t,e){super(t,e),this._animations=new Map,this._animationIds=[]}dispose(){super.dispose();for(const t of this._animations.values())t&&t.dispose();this._animations.clear(),this._animationIds=[]}defineAnimations(t){if(!t)return!0;for(const e in t){const i=t[e];if(!i)return!1;let r=parseInt(e.split("_")[0]),n=!1;const a=i.transitionTo,o=i.transitionFrom;a!==void 0&&(r=fe.getTransitionToAnimationId(a),n=!0),o!==void 0&&(r=fe.getTransitionFromAnimationId(o),n=!0);const h=this.createAnimationData();if(!h.initialize(i))return h.dispose(),!1;const u=i.immediateChangeFrom;if(u!==void 0){const c=u.split(","),l=[];for(const _ of c){const d=parseInt(_);l.indexOf(d)===-1&&l.push(d)}h.setImmediateChanges(l)}this._animations.set(r,h),n||this._animationIds.push(r)}return!0}createAnimationData(){return new fe}hasAnimation(t){return!!this._animations.get(t)}getAnimationCount(){return this._animationIds.length||0}getAnimationId(t){const e=this.getAnimationCount();return t<0||e<=0?0:this._animationIds[t%e]}isImmediateChange(t,e){const i=this._animations.get(t);return i?i.isImmediateChange(e):!1}getStartFrame(t,e){const i=this._animations.get(t);return i?i.getStartFrame(e):0}getFrame(t,e,i,r){const n=this._animations.get(t);return n?n.getFrame(e,i,r):null}getFrameFromSequence(t,e,i,r,n,a){const o=this._animations.get(t);return o?o.getFrameFromSequence(e,i,r,n,a):null}}class jA{constructor(){this._animationId=-1,this._animationAfterTransitionId=0,this._animationOver=!1,this._frameCounter=0,this._frames=[],this._lastFramePlayed=[],this._animationPlayed=[],this._layerCount=0}get animationOver(){return this._animationOver}set animationOver(t){this._animationOver=t}get frameCounter(){return this._frameCounter}set frameCounter(t){this._frameCounter=t}get animationId(){return this._animationId}set animationId(t){t!==this._animationId&&(this._animationId=t,this.resetAnimationFrames(!1))}get animationAfterTransitionId(){return this._animationAfterTransitionId}set animationAfterTransitionId(t){this._animationAfterTransitionId=t}dispose(){this.recycleFrames(),this._frames=null,this._lastFramePlayed=null,this._animationPlayed=null}setLayerCount(t){this._layerCount=t,this.resetAnimationFrames()}resetAnimationFrames(t=!0){(t||!this._frames)&&(this.recycleFrames(),this._frames=[]),this._lastFramePlayed=[],this._animationPlayed=[],this._animationOver=!1,this._frameCounter=0;let e=0;for(;e<this._layerCount;){if(t||this._frames.length<=e)this._frames[e]=null;else{const i=this._frames[e];i&&(i.recycle(),this._frames[e]=Ei.allocate(i.id,i.x,i.y,i.repeats,0,i.isLastFrame))}this._lastFramePlayed[e]=!1,this._animationPlayed[e]=!1,e++}}recycleFrames(){if(!(!this._frames||!this._frames.length))for(const t of this._frames)t&&t.recycle()}getFrame(t){return t<0||t>=this._layerCount?null:this._frames[t]}setFrame(t,e){if(t<0||t>=this._layerCount)return;const i=this._frames[t];i&&i.recycle(),this._frames[t]=e}getAnimationPlayed(t){return t<0||t>=this._layerCount?!0:this._animationPlayed[t]}setAnimationPlayed(t,e){t<0||t>=this._layerCount||(this._animationPlayed[t]=e)}getLastFramePlayed(t){return t<0||t>=this._layerCount?!0:this._lastFramePlayed[t]}setLastFramePlayed(t,e){t<0||t>=this._layerCount||(this._lastFramePlayed[t]=e)}}const zA=class extends cl{constructor(s,t){super(s,t),this._posturesToAnimations=new Map,this._gesturesToAnimations=new Map,this._defaultPosture=null}processPostures(s){if(!s||(s.defaultPosture&&s.defaultPosture.length&&(this._defaultPosture=s.defaultPosture),!s.postures))return!1;for(const t of s.postures)this._posturesToAnimations.get(t.id)||(this._defaultPosture===null&&(this._defaultPosture=t.id),this._posturesToAnimations.set(t.id,t.animationId));return this._posturesToAnimations.get(this._defaultPosture)!==void 0}processGestures(s){if(!s)return!1;for(const t of s)this._gesturesToAnimations.get(t.id)||this._gesturesToAnimations.set(t.id,t.animationId);return!0}postureToAnimation(s){return this._posturesToAnimations.get(s)||(s=this._defaultPosture),this._posturesToAnimations.get(s)}getGestureDisabled(s){return s==="ded"}gestureToAnimation(s){return this._gesturesToAnimations.get(s)?this._gesturesToAnimations.get(s):zA.DEFAULT}animationToPosture(s,t){if(s>=0&&s<this._posturesToAnimations.size){const e=this._posturesToAnimations.keys();for(;;){const i=e.next();if(i.done)return null;if(s<=0)return i.value;--s}}return t?this._defaultPosture:null}animationToGesture(s){if(s>=0&&s<this._gesturesToAnimations.size){const t=this._gesturesToAnimations.keys();for(;;){const e=t.next();if(e.done)return null;if(s<=0)return e.value;--s}}return null}getGestureForAnimationId(s){for(const t of this._gesturesToAnimations.keys())if(this._gesturesToAnimations.get(t)===s)return t;return null}get totalPostures(){return this._posturesToAnimations.size}get totalGestures(){return this._gesturesToAnimations.size}};let ta=zA;ta.DEFAULT=-1;class Qi{constructor(){this._type="",this._sizes=[],this._sizeDatas=new Map,this._lastSize=-1,this._lastSizeScale=-1,this._lastSizeData=null,this._lastSizeDataScale=-1}initialize(t){return this.reset(),t?(this._type=t.name,this.defineVisualizations(t.visualizations)?!0:(this.reset(),!1)):!1}dispose(){if(this._sizeDatas&&this._sizeDatas.size){for(const t of this._sizeDatas.values())t&&t.dispose();this._sizeDatas=null}this._lastSizeData=null,this._sizes=null}reset(){if(this._type="",this._sizeDatas&&this._sizeDatas.size)for(const t of this._sizeDatas.values())t&&t.dispose();this._sizeDatas.clear(),this._sizes=[],this._lastSizeData=null,this._lastSizeDataScale=-1}createSizeData(t,e,i){return new ag(e,i)}defineVisualizations(t){if(!t)return!1;for(const e in t){const i=t[e],r=i.layerCount,n=i.angle;let a=i.size;if(a<1&&(a=1),this._sizeDatas.get(a))return!1;const o=this.createSizeData(a,r,n);if(!o)return!1;for(const h in i){const u=i[h];if(!this.processVisualElement(o,h,u))return o.dispose(),!1}this._sizeDatas.set(a,o),this._sizes.push(a)}return this._sizes.sort(),!0}processVisualElement(t,e,i){if(!t||!e||!i)return!1;switch(e){case"layers":if(!t.processLayers(i))return!1;break;case"directions":if(!t.processDirections(i))return!1;break;case"colors":if(!t.processColors(i))return!1;break}return!0}getValidSize(t){if(t===this._lastSizeScale)return this._lastSize;const e=this.getSizeIndex(t);let i=-1;return e<this._sizes.length&&(i=this._sizes[e]),this._lastSizeScale=t,this._lastSize=i,i}getSizeIndex(t){if(t<=0)return 0;let e=0,i=1;for(;i<this._sizes.length;){if(this._sizes[i]>t){this._sizes[i]/t<t/this._sizes[i-1]&&(e=i);break}e=i,i++}return e}getSizeData(t){if(t===this._lastSizeDataScale)return this._lastSizeData;const e=this.getSizeIndex(t);return e<this._sizes.length?this._lastSizeData=this._sizeDatas.get(this._sizes[e]):this._lastSizeData=null,this._lastSizeDataScale=t,this._lastSizeData}getLayerCount(t){const e=this.getSizeData(t);return e?e.layerCount:ct.DEFAULT_COUNT}getValidDirection(t,e){const i=this.getSizeData(t);return i?i.getValidDirection(e):ct.DEFAULT_DIRECTION}getLayerTag(t,e,i){const r=this.getSizeData(t);return r?r.getLayerTag(e,i):ct.DEFAULT_TAG}getLayerInk(t,e,i){const r=this.getSizeData(t);return r?r.getLayerInk(e,i):ct.DEFAULT_INK}getLayerAlpha(t,e,i){const r=this.getSizeData(t);return r?r.getLayerAlpha(e,i):ct.DEFAULT_ALPHA}getLayerColor(t,e,i){const r=this.getSizeData(t);return r?r.getLayerColor(e,i):Da.DEFAULT_COLOR}getLayerIgnoreMouse(t,e,i){const r=this.getSizeData(t);return r?r.getLayerIgnoreMouse(e,i):ct.DEFAULT_IGNORE_MOUSE}getLayerXOffset(t,e,i){const r=this.getSizeData(t);return r?r.getLayerXOffset(e,i):ct.DEFAULT_XOFFSET}getLayerYOffset(t,e,i){const r=this.getSizeData(t);return r?r.getLayerYOffset(e,i):ct.DEFAULT_YOFFSET}getLayerZOffset(t,e,i){const r=this.getSizeData(t);return r?r.getLayerZOffset(e,i):ct.DEFAULT_ZOFFSET}get type(){return this._type}}Qi.LAYER_LETTERS=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];class og extends Qi{createSizeData(t,e,i){return new cl(e,i)}processVisualElement(t,e,i){if(!t||!e||!i)return!1;switch(e){case"animations":if(!(t instanceof cl)||!t.defineAnimations(i))return!1;break;default:if(!super.processVisualElement(t,e,i))return!1;break}return!0}hasAnimation(t,e){const i=this.getSizeData(t);return i?i.hasAnimation(e):null}getAnimationCount(t){const e=this.getSizeData(t);return e?e.getAnimationCount():null}getAnimationId(t,e){const i=this.getSizeData(t);return i?i.getAnimationId(e):null}isImmediateChange(t,e,i){const r=this.getSizeData(t);return r?r.isImmediateChange(e,i):null}getStartFrame(t,e,i){const r=this.getSizeData(t);return r?r.getStartFrame(e,i):null}getFrame(t,e,i,r,n){const a=this.getSizeData(t);return a?a.getFrame(e,i,r,n):null}getFrameFromSequence(t,e,i,r,n,a,o){const h=this.getSizeData(t);return h?h.getFrameFromSequence(e,i,r,n,a,o):null}}const YA=class extends fh{constructor(){super(),this._data=null,this._type=null,this._direction=0,this._lastCameraAngle=NaN,this._selectedColor=0,this._furnitureLift=0,this._alphaMultiplier=1,this._alphaChanged=!1,this._clickUrl=null,this._clickHandling=!1,this._cacheDirection=-1,this._cacheScale=0,this._cacheSize=-1,this._layerCount=0,this._shadowLayerIndex=-1,this._updatedLayers=[],this._assetNames=[],this._spriteTags=[],this._spriteInks=[],this._spriteAlphas=[],this._spriteColors=[],this._spriteMouseCaptures=[],this._spriteXOffsets=[],this._spriteYOffsets=[],this._spriteZOffsets=[],this._animationNumber=0}initialize(s){return this.reset(),s instanceof Qi?(this._type=s.type,this._data=s,!0):!1}dispose(){super.dispose(),this._data=null,this._updatedLayers=null,this._assetNames=null,this._spriteTags=null,this._spriteInks=null,this._spriteAlphas=null,this._spriteColors=null,this._spriteMouseCaptures=null,this._spriteXOffsets=null,this._spriteYOffsets=null,this._spriteZOffsets=null}reset(){super.reset(),this.setDirection(-1),this._data=null,this._updatedLayers=[],this._assetNames=[],this._spriteTags=[],this._spriteInks=[],this._spriteAlphas=[],this._spriteColors=[],this._spriteMouseCaptures=[],this._spriteXOffsets=[],this._spriteYOffsets=[],this._spriteZOffsets=[],this.createSprites(0)}resetLayers(s,t){this._cacheDirection===t&&this._cacheScale===s||(this._updatedLayers=[],this._assetNames=[],this._spriteTags=[],this._spriteInks=[],this._spriteAlphas=[],this._spriteColors=[],this._spriteMouseCaptures=[],this._spriteXOffsets=[],this._spriteYOffsets=[],this._spriteZOffsets=[],this._cacheDirection=t,this._cacheScale=s,this._cacheSize=this.getValidSize(s),this.setLayerCount((this._data&&this._data.getLayerCount(s)||0)+this.getAdditionalLayerCount()))}update(s,t,e,i){if(!s)return;const r=s.scale;let n=!1;this.updateObject(r,s.direction.x)&&(n=!0),this.updateModel(r)&&(n=!0);let a=0;i?this._animationNumber=this._animationNumber|this.updateAnimation(r):(a=this.updateAnimation(r)|this._animationNumber,this._animationNumber=0),(n||a!==0)&&(this.updateSprites(r,n,a),this._scale=r,this.updateSpriteCounter++)}updateObject(s,t){if(!this.object||this.updateObjectCounter===this.object.updateCounter&&s===this._scale&&this._lastCameraAngle===t)return!1;let e=this.object.getDirection().x-(t+135);if(e=(e%360+360)%360,this._data){const i=this._data.getValidDirection(s,e);this.setDirection(i)}return this._lastCameraAngle=t,this._scale=s,this.updateObjectCounter=this.object.updateCounter,this.resetLayers(s,this._direction),!0}updateModel(s){const t=this.object&&this.object.model;if(!t||this.updateModelCounter===t.updateCounter)return!1;this._selectedColor=t.getValue(I.FURNITURE_COLOR),this._clickUrl=t.getValue(I.FURNITURE_AD_URL),this._clickHandling=this._clickUrl&&this._clickUrl!==""&&this._clickUrl.indexOf("http")===0||!1,this._furnitureLift=t.getValue(I.FURNITURE_LIFT_AMOUNT)||0;let e=t.getValue(I.FURNITURE_ALPHA_MULTIPLIER);return isNaN(e)&&(e=1),this._alphaMultiplier!==e&&(this._alphaMultiplier=e,this._alphaChanged=!0),this.updateModelCounter=t.updateCounter,!0}updateSprites(s,t,e){if(this._layerCount!==this.totalSprites&&this.createSprites(this._layerCount),t){let i=this.totalSprites-1;for(;i>=0;)this.updateSprite(s,i),i--}else{let i=0;for(;e>0;)e&&this.updateSprite(s,i),i++,e=e>>1}this._alphaChanged=!1}updateSprite(s,t){const e=this.getSpriteAssetName(s,t),i=this.getSprite(t);if(e&&i){const r=this.getAsset(e,t);if(r&&r.texture){i.visible=!0,i.type=this._type,i.texture=r.texture,i.flipH=r.flipH,i.flipV=r.flipV,i.direction=this._direction;let n=0;t!==this._shadowLayerIndex?(i.tag=this.getLayerTag(s,this._direction,t),i.alpha=this.getLayerAlpha(s,this._direction,t),i.color=this.getLayerColor(s,t,this._selectedColor),i.offsetX=r.offsetX+this.getLayerXOffset(s,this._direction,t),i.offsetY=r.offsetY+this.getLayerYOffset(s,this._direction,t),i.blendMode=this.getLayerInk(s,this._direction,t),i.alphaTolerance=this.getLayerIgnoreMouse(s,this._direction,t)?Ms.MATCH_NOTHING:Ms.MATCH_OPAQUE_PIXELS,n=this.getLayerZOffset(s,this._direction,t),n=n-t*.001):(i.offsetX=r.offsetX,i.offsetY=r.offsetY+this.getLayerYOffset(s,this._direction,t),i.alpha=48*this._alphaMultiplier,i.alphaTolerance=Ms.MATCH_NOTHING,n=1),i.relativeDepth=n*YA.DEPTH_MULTIPLIER,i.name=e,i.libraryAssetName=this.getLibraryAssetNameForSprite(r,i),i.posture=this.getPostureForAsset(s,r.source),i.clickHandling=this._clickHandling}else this.resetSprite(i)}else i&&this.resetSprite(i)}getLibraryAssetNameForSprite(s,t){return s.source}getPostureForAssetFile(s,t){return null}resetSprite(s){s&&(s.texture=null,s.libraryAssetName="",s.posture="",s.tag="",s.offsetX=0,s.offsetY=0,s.flipH=!1,s.flipV=!1,s.relativeDepth=0,s.clickHandling=!1)}getSpriteAssetName(s,t){if(!this._data||t>=Qi.LAYER_LETTERS.length)return"";let e=this._assetNames[t],i=this._updatedLayers[t];return(!e||!e.length)&&(e=this.cacheSpriteAssetName(s,t,!0),i=this._cacheSize!==1),i&&(e+=this.getFrameNumber(s,t)),e}cacheSpriteAssetName(s,t,e){this._type;const i=e?this._cacheSize:this.getValidSize(s);let r="";const n=i!==1;if(t!==this._shadowLayerIndex?r=Qi.LAYER_LETTERS[t]||"":r="sd",r==="")return null;const a=this._type+(n?"_"+i+"_"+r+"_"+this._direction+"_":"_icon_"+r);return e&&(this._assetNames[t]=a,this._updatedLayers[t]=n),a}getLayerTag(s,t,e){const i=this._spriteTags[e];if(i!==void 0)return i;if(!this._data)return ct.DEFAULT_TAG;const r=this._data.getLayerTag(s,t,e);return this._spriteTags[e]=r,r}getLayerInk(s,t,e){const i=this._spriteInks[e];if(i!==void 0)return i;if(!this._data)return ct.DEFAULT_INK;const r=this._data.getLayerInk(s,t,e);return this._spriteInks[e]=r,r}getLayerAlpha(s,t,e){if(!this._alphaChanged){const r=this._spriteAlphas[e];if(r!==void 0)return r}if(!this._data)return ct.DEFAULT_ALPHA;let i=this._data.getLayerAlpha(s,t,e);return this._alphaMultiplier!==null&&(i=i*this._alphaMultiplier),this._spriteAlphas[e]=i,i}getLayerColor(s,t,e){const i=this._spriteColors[t];if(i!==void 0)return i;if(!this._data)return Da.DEFAULT_COLOR;const r=this._data.getLayerColor(s,t,e);return this._spriteColors[t]=r,r}getLayerIgnoreMouse(s,t,e){const i=this._spriteMouseCaptures[e];if(i!==void 0)return i;if(!this._data)return ct.DEFAULT_IGNORE_MOUSE;const r=this._data.getLayerIgnoreMouse(s,t,e);return this._spriteMouseCaptures[e]=r,r}getLayerXOffset(s,t,e){const i=this._spriteXOffsets[e];if(i!==void 0)return i;if(!this._data)return ct.DEFAULT_XOFFSET;const r=this._data.getLayerXOffset(s,t,e);return this._spriteXOffsets[e]=r,r}getLayerYOffset(s,t,e){if(e===this._shadowLayerIndex)return Math.ceil(this._furnitureLift*(s/2));const i=this._spriteYOffsets[e];if(i!==void 0)return i;if(!this._data)return ct.DEFAULT_YOFFSET;const r=this._data.getLayerYOffset(s,t,e);return this._spriteYOffsets[e]=r,r}getLayerZOffset(s,t,e){const i=this._spriteZOffsets[e];if(i!==void 0)return i;if(!this._data)return ct.DEFAULT_ZOFFSET;const r=this._data.getLayerZOffset(s,t,e);return this._spriteZOffsets[e]=r,r}getValidSize(s){return this._data?this._data.getValidSize(s):s}setLayerCount(s){this._layerCount=s,this._shadowLayerIndex=s-this.getAdditionalLayerCount()}setDirection(s){this._direction!==s&&(this._direction=s)}getAdditionalLayerCount(){return 1}updateAnimation(s){return 0}getFrameNumber(s,t){return 0}getPostureForAsset(s,t){return null}getAsset(s,t=-1){return this.asset?this.asset.getAsset(s):null}get direction(){return this._direction}get data(){return this._data}};let nr=YA;nr.DEPTH_MULTIPLIER=Math.sqrt(.5);nr.TYPE=F.FURNITURE_STATIC;const $d=class extends nr{constructor(){super(),this._state=-1,this._frameIncrease=1,this._animationData=new jA,this._animationScale=0,this._animationChangeTime=0,this._animatedLayerCount=0,this._directionChanged=!1}initialize(s){return s instanceof og?super.initialize(s):!1}dispose(){super.dispose(),this._animationData&&(this._animationData.dispose(),this._animationData=null)}get animatedLayerCount(){return this._animatedLayerCount}get animationId(){return this._animationData.animationId}getAnimationId(s){return this.animationId!==$d.DEFAULT_ANIMATION_ID&&this.data.hasAnimation(this._animationScale,this.animationId)?this.animationId:$d.DEFAULT_ANIMATION_ID}updateObject(s,t){if(super.updateObject(s,t)){const e=this.object.getState(0);return e!==this._state&&(this.setAnimation(e),this._state=e,this._animationChangeTime=this.object.model.getValue(I.FURNITURE_STATE_UPDATE_TIME)||0),!0}return!1}updateModel(s){if(super.updateModel(s)){if(this.usesAnimationResetting()){const e=this.object.model.getValue(I.FURNITURE_STATE_UPDATE_TIME);e>this._animationChangeTime&&(this._animationChangeTime=e,this.setAnimation(this._state))}const t=this.object.model.getValue(I.FURNITURE_AUTOMATIC_STATE_INDEX);if(!isNaN(t)){const e=this.data.getAnimationId(this._animationScale,t);this.setAnimation(e)}return!0}return!1}isPlayingTransition(s,t){return!(!fe.isTransitionFromAnimation(s.animationId)&&!fe.isTransitionToAnimation(s.animationId)||t!==s.animationAfterTransitionId||s.animationOver)}getCurrentState(s){const t=s.animationId;return!fe.isTransitionFromAnimation(t)&&!fe.isTransitionToAnimation(t)?t:s.animationAfterTransitionId}setAnimation(s){this.data&&this.setSubAnimation(this._animationData,s,this._state>=0)}setSubAnimation(s,t,e=!0){const i=s.animationId;if(e){if(this.isPlayingTransition(s,t))return!1;const r=this.getCurrentState(s);if(t!==r){if(!this.data.isImmediateChange(this._animationScale,t,r)){let n=fe.getTransitionFromAnimationId(r);this.data.hasAnimation(this._animationScale,n)?(s.animationAfterTransitionId=t,t=n):(n=fe.getTransitionToAnimationId(t),this.data.hasAnimation(this._animationScale,n)&&(s.animationAfterTransitionId=t,t=n))}}else if(fe.isTransitionFromAnimation(s.animationId)){const n=fe.getTransitionToAnimationId(t);this.data.hasAnimation(this._animationScale,n)&&(s.animationAfterTransitionId=t,t=n)}else if(!fe.isTransitionToAnimation(s.animationId)&&this.usesAnimationResetting()){const n=fe.getTransitionFromAnimationId(r);if(this.data.hasAnimation(this._animationScale,n))s.animationAfterTransitionId=t,t=n;else{const a=fe.getTransitionToAnimationId(t);this.data.hasAnimation(this._animationScale,a)&&(s.animationAfterTransitionId=t,t=a)}}}return i!==t?(s.animationId=t,!0):!1}getLastFramePlayed(s){return this._animationData.getLastFramePlayed(s)}resetAllAnimationFrames(){this._animationData&&this._animationData.setLayerCount(this._animatedLayerCount)}updateAnimation(s){if(!this.data)return 0;s!==this._animationScale&&(this._animationScale=s,this._animatedLayerCount=this.data.getLayerCount(s),this.resetAllAnimationFrames());const t=this.updateAnimations(s);return this._directionChanged=!1,t}updateAnimations(s){if(this._animationData.animationOver&&!this._directionChanged)return 0;const t=this.updateFramesForAnimation(this._animationData,s);return this._animationData.animationOver&&(fe.isTransitionFromAnimation(this._animationData.animationId)||fe.isTransitionToAnimation(this._animationData.animationId))&&(this.setAnimation(this._animationData.animationAfterTransitionId),this._animationData.animationOver=!1),t}updateFramesForAnimation(s,t){if(s.animationOver&&!this._directionChanged)return 0;const e=this.getAnimationId(s);let i=s.frameCounter;i||(i=this.data.getStartFrame(t,e,this._direction)),i+=this.frameIncrease,s.frameCounter=i,s.animationOver=!0;let r=!1,n=this._animatedLayerCount-1,a=0,o=1<<this._animatedLayerCount-1;for(;n>=0;){let h=0;if(r=s.getAnimationPlayed(n),!r||this._directionChanged){let u=s.getLastFramePlayed(n),c=s.getFrame(n);c&&c.isLastFrame&&c.remainingFrameRepeats<=this.frameIncrease&&(u=!0),(this._directionChanged||!c||c.remainingFrameRepeats>=0&&(c.remainingFrameRepeats=c.remainingFrameRepeats-this.frameIncrease)<=0)&&(h=Ei.SEQUENCE_NOT_DEFINED,c&&(h=c.activeSequence),h===Ei.SEQUENCE_NOT_DEFINED?c=this.data.getFrame(t,e,this._direction,n,i):c=this.data.getFrameFromSequence(t,e,this._direction,n,h,c.activeSequenceOffset+c.repeats,i),s.setFrame(n,c),a=a|o),!c||c.remainingFrameRepeats==Ei.FRAME_REPEAT_FOREVER?(u=!0,r=!0):s.animationOver=!1,s.setLastFramePlayed(n,u),s.setAnimationPlayed(n,r)}o=o>>1,n--}return a}getFrameNumber(s,t){const e=this._animationData.getFrame(t);return e?e.id:super.getFrameNumber(s,t)}getLayerXOffset(s,t,e){const i=super.getLayerXOffset(s,t,e),r=this._animationData.getFrame(e);return r?i+r.x:i}getLayerYOffset(s,t,e){const i=super.getLayerYOffset(s,t,e),r=this._animationData.getFrame(e);return r?i+r.y:i}usesAnimationResetting(){return!1}setDirection(s){this._direction!==s&&(super.setDirection(s),this._directionChanged=!0)}get frameIncrease(){return this._frameIncrease}get data(){return this._data}};let ce=$d;ce.TYPE=F.FURNITURE_ANIMATED;ce.DEFAULT_ANIMATION_ID=0;const Cu=class extends ce{constructor(){super(),this._badgeId="",this._badgeAssetNameNormalScale="",this._badgeAssetNameSmallScale="",this._badgeVisibleInState=-1}updateModel(s){let t=super.updateModel(s);const e=this.object.model.getValue(I.FURNITURE_BADGE_IMAGE_STATUS),i=this.object.model.getValue(I.FURNITURE_BADGE_ASSET_NAME);if(e===-1)this._badgeAssetNameNormalScale="",this._badgeAssetNameSmallScale="";else if(e===1&&i!==this._badgeId){this._badgeId=i,this._badgeAssetNameNormalScale=this._badgeId,this._badgeAssetNameSmallScale===""&&(this._badgeAssetNameSmallScale=this._badgeAssetNameNormalScale+"_32");const r=this.object.model.getValue(I.FURNITURE_BADGE_VISIBLE_IN_STATE);isNaN(r)||(this._badgeVisibleInState=r),t=!0}return t}getSpriteAssetName(s,t){return this.getLayerTag(s,this.direction,t)!==Cu.BADGE||this._badgeVisibleInState!==-1&&this.object.getState(0)!==this._badgeVisibleInState?super.getSpriteAssetName(s,t):s===32?this._badgeAssetNameSmallScale:this._badgeAssetNameNormalScale}getLayerXOffset(s,t,e){let i=super.getLayerXOffset(s,t,e);if(this.getLayerTag(s,t,e)===Cu.BADGE){const r=this.getAsset(s===32?this._badgeAssetNameSmallScale:this._badgeAssetNameNormalScale,e);r&&(s===64?i+=(40-r.width)/2:i+=(20-r.width)/2)}return i}getLayerYOffset(s,t,e){let i=super.getLayerYOffset(s,t,e);if(this.getLayerTag(s,t,e)===Cu.BADGE){const r=this.getAsset(s===32?this._badgeAssetNameSmallScale:this._badgeAssetNameNormalScale,e);r&&(s===64?i+=(40-r.height)/2:i+=(20-r.height)/2)}return i}};let WA=Cu;WA.BADGE="BADGE";const hn=class extends nr{constructor(){super(),this._imageUrl=null,this._shortUrl=null,this._imageReady=!1,this._isAnimated=!1,this._gifCollection=null,this._offsetX=0,this._offsetY=0,this._offsetZ=0,this._currentFrame=-1,this._totalFrames=-1}dispose(){super.dispose(),this._imageUrl&&this.asset&&this.asset.disposeAsset(this._imageUrl)}updateObject(s,t){return super.updateObject(s,t)?(this._imageReady&&this.checkAndCreateImageForCurrentState(),!0):!1}updateModel(s){const t=super.updateModel(s);if(t&&(this._offsetX=this.object.model.getValue(I.FURNITURE_BRANDING_OFFSET_X)||0,this._offsetY=this.object.model.getValue(I.FURNITURE_BRANDING_OFFSET_Y)||0,this._offsetZ=this.object.model.getValue(I.FURNITURE_BRANDING_OFFSET_Z)||0,this._isAnimated=this.object.model.getValue(I.FURNITURE_BRANDING_IS_ANIMATED)||!1),this._imageReady){if(this.checkIfImageChanged())return this._imageReady=!1,this._imageUrl=null,!0}else if(this._imageReady=this.checkIfImageReady(),this._imageReady)return this.checkAndCreateImageForCurrentState(),!0;return t}checkIfImageChanged(){const s=this.object.model.getValue(I.FURNITURE_BRANDING_IMAGE_URL);return s&&s===this._imageUrl?!1:(this._gifCollection,this.asset&&this.asset.disposeAsset(this._imageUrl),!0)}checkIfImageReady(){if(!(this.object&&this.object.model))return!1;const t=this.object.model.getValue(I.FURNITURE_BRANDING_IMAGE_URL);if(!t||this._imageUrl&&this._imageUrl===t)return!1;if(this.object.model.getValue(I.FURNITURE_BRANDING_IMAGE_STATUS)===1){let i=null;if(this._isAnimated){const r=K.instance.roomEngine.roomContentLoader.getGifCollection(t);r&&(this._gifCollection=r,i=r.textures[0])}else i=ys().getTexture(t);return i?(this.imageReady(i,t),!0):!1}return!1}imageReady(s,t){if(!s){this._imageUrl=null;return}this._imageUrl=t}checkAndCreateImageForCurrentState(){if(this._isAnimated){this.buildAssetsForGif();return}if(!this._imageUrl)return;const s=ys().getTexture(this._imageUrl);if(!s)return;const t=this.object.getState(0);this.addBackgroundAsset(s,t,0)}buildAssetsForGif(){if(!this._gifCollection)return;const s=this._gifCollection.textures,t=this._gifCollection.durations;if(!s.length||!t.length||s.length!==t.length)return;const e=this.object.getState(0);for(let i=0;i<s.length;i++){const r=s[i];t[i],r&&this.addBackgroundAsset(r,e,i)}this._currentFrame=-1,this._totalFrames=s.length}addBackgroundAsset(s,t,e){let i=0,r=0,n=!1,a=!1;switch(t){case hn.STATE_0:i=0,r=0,n=!1,a=!1;break;case hn.STATE_1:i=-s.width,r=0,n=!0,a=!1;break;case hn.STATE_2:i=-s.width,r=-s.height,n=!0,a=!0;break;case hn.STATE_3:i=0,r=-s.height,n=!1,a=!0;break}this.asset.addAsset(`${this._imageUrl}_${e}`,s,!0,i,r,n,a)}getSpriteAssetName(s,t){return this.getLayerTag(s,this._direction,t)===hn.BRANDED_IMAGE&&this._imageUrl?`${this._imageUrl}_${this.getFrameNumber(s,t)}`:super.getSpriteAssetName(s,t)}updateAnimation(s){return!this._imageReady||!this._isAnimated||this._totalFrames<=0?0:1}getFrameNumber(s,t){if(!this._imageReady||!this._isAnimated||this._totalFrames<=0)return 0;if(this.getLayerTag(s,this._direction,t)===hn.BRANDED_IMAGE&&this._imageUrl){let i=this._currentFrame;return i<0?i=0:i+=1,i===this._totalFrames&&(i=0),this._currentFrame=i,this._currentFrame}return 0}};let Wr=hn;Wr.BRANDED_IMAGE="branded_image";Wr.STATE_0=0;Wr.STATE_1=1;Wr.STATE_2=2;Wr.STATE_3=3;class XA extends Wr{getLayerXOffset(t,e,i){return super.getLayerXOffset(t,e,i)+this._offsetX}getLayerYOffset(t,e,i){return super.getLayerYOffset(t,e,i)+this._offsetY}getLayerZOffset(t,e,i){return super.getLayerZOffset(t,e,i)+this._offsetZ}}const Mu=class extends ce{constructor(){super(),this._stateQueue=[],this._running=!1}setAnimation(s){if(s===-1&&!this._running){this._running=!0,this._stateQueue=[],this._stateQueue.push(Mu.ANIMATION_ID_ROLL);return}if(s>=0&&s<=7){if(this._running){this._running=!1,this._stateQueue=[],this._stateQueue.push(Mu.ANIMATION_ID_OFFSET_SLOW1),this._stateQueue.push(Mu.ANIMATION_ID_OFFSET_SLOW2+s),this._stateQueue.push(s);return}super.setAnimation(s)}}updateAnimation(s){return this.getLastFramePlayed(0)&&this._stateQueue.length&&super.setAnimation(this._stateQueue.shift()),super.updateAnimation(s)}};let e_=Mu;e_.ANIMATION_ID_OFFSET_SLOW1=20;e_.ANIMATION_ID_OFFSET_SLOW2=9;e_.ANIMATION_ID_ROLL=-1;class C9 extends nr{}const To=class extends ce{getFrameNumber(s,t){const e=this.getLayerTag(s,this.direction,t),i=this.object.getState(0);switch(e){case To.SECONDS_SPRITE:return Math.floor(i%60%10);case To.TEN_SECONDS_SPRITE:return Math.floor(i%60/10);case To.MINUTES_SPRITE:return Math.floor(i/60%10);case To.TEN_MINUTES_SPRITE:return Math.floor(i/60/10%10);default:return super.getFrameNumber(s,t)}}get animationId(){return 0}};let Nh=To;Nh.SECONDS_SPRITE="seconds_sprite";Nh.TEN_SECONDS_SPRITE="ten_seconds_sprite";Nh.MINUTES_SPRITE="minutes_sprite";Nh.TEN_MINUTES_SPRITE="ten_minutes_sprite";class M9 extends fh{}const tf=class extends ce{constructor(){super(),this._thumbnailAssetNameNormal=null,this._thumbnailImageNormal=null,this._thumbnailDirection=-1,this._thumbnailChanged=!1,this._hasOutline=!1}get hasThumbnailImage(){return this._thumbnailImageNormal!=null}setThumbnailImages(s){this._thumbnailImageNormal=s,this._thumbnailChanged=!0}updateModel(s){const t=super.updateModel(s);return!this._thumbnailChanged&&this._thumbnailDirection===this.direction?t:(this.refreshThumbnail(),!0)}refreshThumbnail(){this.asset!=null&&(this._thumbnailImageNormal?this.addThumbnailAsset(this._thumbnailImageNormal,64):this.asset.disposeAsset(this.getThumbnailAssetName(64)),this._thumbnailChanged=!1,this._thumbnailDirection=this.direction)}addThumbnailAsset(s,t){let e=0;for(;e<this.totalSprites;){if(this.getLayerTag(t,this.direction,e)===tf.THUMBNAIL){const i=this.cacheSpriteAssetName(t,e,!1)+this.getFrameNumber(t,e),r=this.getAsset(i,e);if(r){const n=this.generateTransformedThumbnail(s,r),a=this.getThumbnailAssetName(t);this.asset.disposeAsset(a),this.asset.addAsset(a,n,!0,r.offsetX,r.offsetY,!1,!1)}return}e++}}generateTransformedThumbnail(s,t){if(this._hasOutline){const a=new se,o=new se(wm.WHITE);o.tint=0,o.width=s.width+40,o.height=s.height+40;const h=new se(s),u=(o.width-h.width)/2,c=(o.height-h.height)/2;h.position.set(u,c),a.addChild(o,h),s=qt.generateTexture(a)}const e=1.1,i=new wt,r=t.width/s.width;switch(this.direction){case 2:i.a=r,i.b=-.5*r,i.c=0,i.d=r*e,i.tx=0,i.ty=.5*r*s.width;break;case 0:case 4:i.a=r,i.b=.5*r,i.c=0,i.d=r*e,i.tx=0,i.ty=0;break;default:i.a=r,i.b=0,i.c=0,i.d=r,i.tx=0,i.ty=0}const n=new se(s);return n.transform.setFromMatrix(i),qt.generateTexture(n)}getSpriteAssetName(s,t){return this._thumbnailImageNormal&&this.getLayerTag(s,this.direction,t)===tf.THUMBNAIL?this.getThumbnailAssetName(s):super.getSpriteAssetName(s,t)}getThumbnailAssetName(s){return this._thumbnailAssetNameNormal=this.getFullThumbnailAssetName(this.object.id,64),this._thumbnailAssetNameNormal}getFullThumbnailAssetName(s,t){return[this._type,s,"thumb",t].join("_")}};let hg=tf;hg.THUMBNAIL="THUMBNAIL";class KA extends hg{constructor(){super(),this._cachedUrl=null,this._hasOutline=!0}updateModel(t){if(this.object){const e=this.getThumbnailURL();if(this._cachedUrl!==e)if(this._cachedUrl=e,this._cachedUrl&&this._cachedUrl!==""){const i=new Image;i.src=e,i.crossOrigin="*",i.onload=()=>{const r=ut.from(i);r.baseTexture.scaleMode=hs.LINEAR,this.setThumbnailImages(r)}}else this.setThumbnailImages(null)}return super.updateModel(t)}getThumbnailURL(){throw new Error("This method must be overridden!")}}class N9 extends KA{constructor(){super(),this._url=null,this._typePrefix=null}getThumbnailURL(){if(!this.object)return null;if(this._url)return this._url;const t=this.object.model.getValue(I.FURNITURE_DATA);if(!t||t==="")return null;this.object.type.indexOf("")>=0&&(this._typePrefix=this.object.type.indexOf("")>=0?"":"postcards/selfie/");let i=JSON.parse(t).w||"";return i=this.buildThumbnailUrl(i),this._url=i,this._url}buildThumbnailUrl(t){return t=t.replace(".png","_small.png"),t.indexOf(".png")===-1&&(t=t+"_small.png"),t}}class gp{constructor(){this._hasMoved=!1,this._age=0,this._isEmitter=!1,this._fade=!1,this._alphaMultiplier=1}init(t,e,i,r,n,a,o,h=!1,u=null,c=!1){this._x=t,this._y=e,this._z=i,this._particleDirection=new Ts(r.x,r.y,r.z),this._particleDirection.scaleBy(n),this._lastX=this._x-this._particleDirection.x*a,this._lastY=this._y-this._particleDirection.y*a,this._lastZ=this._z-this._particleDirection.z*a,this._age=0,this._hasMoved=!1,this._lifeTime=o,this._isEmitter=h,this._frames=u,this._fade=c,this._alphaMultiplier=1,this._fadeTime=.5+Math.random()*.5}dispose(){this._particleDirection=null}update(){this._age++,this._age===this._lifeTime&&this.ignite(),this._fade&&this._age/this._lifeTime>this._fadeTime&&(this._alphaMultiplier=(this._lifeTime-this._age)/(this._lifeTime*(1-this._fadeTime)))}getAsset(){return this._frames&&this._frames.length>0?this._frames[this._age%this._frames.length]:null}ignite(){}get fade(){return this._fade}get alphaMultiplier(){return this._alphaMultiplier}get direction(){return this._particleDirection}get age(){return this._age}get isEmitter(){return this._isEmitter}get isAlive(){return this._age<=this._lifeTime}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get z(){return this._z}set z(t){this._z=t}get lastX(){return this._lastX}set lastX(t){this._hasMoved=!0,this._lastX=t}get lastY(){return this._lastY}set lastY(t){this._hasMoved=!0,this._lastY=t}get lastZ(){return this._lastZ}set lastZ(t){this._hasMoved=!0,this._lastZ=t}get hasMoved(){return this._hasMoved}toString(){return[this._x,this._y,this._z].toString()}copy(t,e){this._x=t._x*e,this._y=t._y*e,this._z=t._z*e,this._lastX=t._lastX*e,this._lastY=t._lastY*e,this._lastZ=t._lastZ*e,this._hasMoved=t.hasMoved,this._particleDirection=t._particleDirection,this._age=t._age,this._lifeTime=t._lifeTime,this._isEmitter=t._isEmitter,this._fade=t._fade,this._fadeTime=t._fadeTime,this._alphaMultiplier=t._alphaMultiplier}}const Nu=class extends gp{constructor(s="",t=-1){super(),this._roomObjectSpriteId=-1,this._timeStep=.1,this._fuseTime=10,this._energy=1,this._hasIgnited=!1,this._burstPulse=1,this._particles=[],this._name=s,this._roomObjectSpriteId=t,this._particleConfigurations=[]}dispose(){for(const s of this._particles)s.dispose();this._particles=null,this._particleConfigurations=null,super.dispose()}setup(s,t,e,i,r,n,a,o,h,u){this._maxNumberOfParticles=s,this._particlesPerFrame=t,this._force=e,this._emitterDirection=i,this._emitterDirection.normalize(),this._gravity=r,this._airFriction=n,this._explosionShape=a,this._fuseTime=h,this._energy=o,this._burstPulse=u,this.reset()}reset(){for(const s of this._particles)s.dispose();this._particles=[],this._emittedParticles=0,this._hasIgnited=!1,this.init(0,0,0,this._emitterDirection,this._force,this._timeStep,this._fuseTime,!0)}copyStateFrom(s,t){super.copy(s,t),this._force=s._force,this._emitterDirection=s._emitterDirection,this._gravity=s._gravity,this._airFriction=s._airFriction,this._explosionShape=s._explosionShape,this._fuseTime=s._fuseTime,this._energy=s._energy,this._burstPulse=s._burstPulse,this._timeStep=s._timeStep,this._hasIgnited=s._hasIgnited}configureParticle(s,t,e,i){const r={};r.lifeTime=s,r.isEmitter=t,r.frames=e,r.fade=i,this._particleConfigurations.push(r)}ignite(){this._hasIgnited=!0,this._emittedParticles<this._maxNumberOfParticles&&this.age>1&&this.releaseParticles(this,this.direction)}releaseParticles(s,t=null){t||(t=new Ts);const e=new Ts,i=this.getRandomParticleConfiguration();let r=0;for(;r<this._particlesPerFrame;){switch(this._explosionShape){case Nu.CONE:e.x=this.randomBoolean(.5)?Math.random():-Math.random(),e.y=-(Math.random()+1),e.z=this.randomBoolean(.5)?Math.random():-Math.random();break;case Nu.PLANE:e.x=this.randomBoolean(.5)?Math.random():-Math.random(),e.y=0,e.z=this.randomBoolean(.5)?Math.random():-Math.random();break;case Nu.SPHERE:e.x=this.randomBoolean(.5)?Math.random():-Math.random(),e.y=this.randomBoolean(.5)?Math.random():-Math.random(),e.z=this.randomBoolean(.5)?Math.random():-Math.random();break}e.normalize();const n=new gp;let a=0,o=!1,h=!1,u=[];i?(a=Math.floor(Math.random()*i.lifeTime+10),o=i.isEmitter,u=i.frames,h=i.fade):(a=Math.trunc(Math.floor(Math.random()*20+10)),o=!1,u=[]),n.init(s.x,s.y,s.z,e,this._energy,this._timeStep,a,o,u,h),this._particles.push(n),this._emittedParticles++,r++}}getRandomParticleConfiguration(){const s=Math.trunc(Math.floor(Math.random()*this._particleConfigurations.length));return this._particleConfigurations[s]}update(){super.update(),this.accumulateForces(),this.verlet(),this.satisfyConstraints(),!this.isAlive&&this._emittedParticles<this._maxNumberOfParticles&&this.age%this._burstPulse===0&&this.releaseParticles(this,this.direction)}verlet(){if(this.isAlive||this._emittedParticles<this._maxNumberOfParticles){const t=this.x,e=this.y,i=this.z;this.x=(2-this._airFriction)*this.x-(1-this._airFriction)*this.lastX,this.y=(2-this._airFriction)*this.y-(1-this._airFriction)*this.lastY+this._gravity*this._timeStep*this._timeStep,this.z=(2-this._airFriction)*this.z-(1-this._airFriction)*this.lastZ,this.lastX=t,this.lastY=e,this.lastZ=i}const s=[];for(const t of this._particles){t.update();const e=t.x,i=t.y,r=t.z;t.x=(2-this._airFriction)*t.x-(1-this._airFriction)*t.lastX,t.y=(2-this._airFriction)*t.y-(1-this._airFriction)*t.lastY+this._gravity*this._timeStep*this._timeStep,t.z=(2-this._airFriction)*t.z-(1-this._airFriction)*t.lastZ,t.lastX=e,t.lastY=i,t.lastZ=r,(t.y>10||!t.isAlive)&&s.push(t)}for(const t of s)t.isEmitter,this._particles.splice(this._particles.indexOf(t),1),t.dispose()}satisfyConstraints(){}accumulateForces(){for(const s of this._particles);}get particles(){return this._particles}get hasIgnited(){return this._hasIgnited}randomBoolean(s){return Math.random()<s}get roomObjectSpriteId(){return this._roomObjectSpriteId}};let s_=Nu;s_.CONE="cone";s_.PLANE="plane";s_.SPHERE="sphere";class P9{constructor(t){this._canvasId=-1,this._hasIgnited=!1,this._centerX=0,this._centerY=0,this._scaleMultiplier=1,this._blend=1,this._bgColor=4278190080,this._isDone=!1,this._emitters=new Ee,this._visualization=t,this._blackOverlayAlphaTransform=new Cc,this._blackOverlayAlphaTransform.alpha=1,this._particleColorTransform=new Cc,this._identityMatrix=new wt,this._translationMatrix=new wt}dispose(){for(const t of this._emitters.getValues())t.dispose();this._emitters=null,this._canvasTexture&&(this._canvasTexture.destroy(),this._canvasTexture=null),this._blackOverlay&&(this._blackOverlay.destroy(),this._blackOverlay=null),this._emptySprite&&(this._emptySprite.destroy(),this._emptySprite=null),this._blackOverlayAlphaTransform=null,this._particleColorTransform=null,this._identityMatrix=null,this._translationMatrix=null}reset(){this._currentEmitter&&this._currentEmitter.reset(),this._currentEmitter=null,this._hasIgnited=!1,this._isDone=!1,this.updateCanvas()}setAnimation(t){this._currentEmitter&&this._currentEmitter.reset(),this._currentEmitter=this._emitters.getValue(t),this._hasIgnited=!1,this._isDone=!1,this.updateCanvas()}updateCanvas(){if(!(!this._currentEmitter||this._canvasId===-1)&&(this._roomSprite=this._visualization.getSprite(this._canvasId),this._roomSprite&&this._roomSprite.texture)){if(this._roomSprite.width<=1||this._roomSprite.height<=1)return;this._canvasTexture&&(this._canvasTexture.width!==this._roomSprite.width||this._canvasTexture.height!==this._roomSprite.height)&&(this._canvasTexture=null),this.clearCanvas(),this._centerX=-this._roomSprite.offsetX,this._centerY=-this._roomSprite.offsetY,this._roomSprite.texture=this._canvasTexture}}getLayerYOffset(t,e,i){return this._currentEmitter&&this._currentEmitter.roomObjectSpriteId===i?this._currentEmitter.y*this._scaleMultiplier:0}controlsSprite(t){return this._currentEmitter?this._currentEmitter.roomObjectSpriteId==t:!1}updateSprites(){!this._currentEmitter||!this._roomSprite||(this._canvasTexture&&this._roomSprite.texture!==this._canvasTexture&&(this._roomSprite.texture=this._canvasTexture),this._hasIgnited&&this._currentEmitter.roomObjectSpriteId>=0&&(this._visualization.getSprite(this._currentEmitter.roomObjectSpriteId).visible=!1))}updateAnimation(){if(!this._currentEmitter||!this._roomSprite||this._isDone)return;const t=10;!this._hasIgnited&&this._currentEmitter.hasIgnited&&(this._hasIgnited=!0);const e=this._offsetY*this._scaleMultiplier;if(this._currentEmitter.update(),this._hasIgnited){this._currentEmitter.roomObjectSpriteId>=0&&(this._visualization.getSprite(this._currentEmitter.roomObjectSpriteId).visible=!1),this._canvasTexture||this.updateCanvas(),this.clearCanvas();for(const i of this._currentEmitter.particles){const r=this._centerX+(i.x-i.z)*t/10*this._scaleMultiplier,n=this._centerY-e+(i.y+(i.x+i.z)/2)*t/10*this._scaleMultiplier,a=i.getAsset();if(a&&a.texture)if(i.fade&&i.alphaMultiplier<1){this._translationMatrix.identity(),this._translationMatrix.translate(r+a.offsetX,n+a.offsetY);const o=new se(a.texture);this._particleColorTransform.alpha=i.alphaMultiplier,o.filters=[this._particleColorTransform],Ae.instance.renderer.render(o,{renderTexture:this._canvasTexture,transform:this._translationMatrix,clear:!1})}else{const o=new zu(r+a.offsetX,n+a.offsetY),h=new se(a.texture);h.x=o.x,h.y=o.y,Ae.instance.renderer.render(h,{renderTexture:this._canvasTexture,clear:!1})}else{const o=new se(ut.WHITE);o.tint=16777215,o.x=r-1,o.y=n-1,o.width=2,o.height=2,Ae.instance.renderer.render(o,{renderTexture:this._canvasTexture,clear:!1})}}if(!this._currentEmitter.particles.length){this._isDone=!0;return}}}parseData(t){this._size=t.size,this._canvasId=t.canvasId!==void 0?t.canvasId:-1,this._offsetY=t.offsetY!==void 0?t.offsetY:10,this._scaleMultiplier=this._size/64,this._blend=t.blend!==void 0?t.blend:1,this._blend=Math.min(this._blend,1),this._blackOverlayAlphaTransform.alpha=this._blend;const e=t.bgColor!==void 0?t.bgColor:"0";if(this._bgColor=parseInt(e,16)||0,!(!t.emitters||!t.emitters.length))for(const i of t.emitters){const r=i.id,n=i.name,a=i.spriteId,o=new s_(n,a);this._emitters.add(r,o);const h=i.maxNumParticles,u=i.particlesPerFrame,c=i.burstPulse!==void 0?i.burstPulse:1,l=i.fuseTime,_=i.simulation.force,d=i.simulation.direction,g=i.simulation.gravity,m=i.simulation.airFriction,p=i.simulation.shape,T=i.simulation.energy;for(const A of i.particles){const O=A.lifeTime,v=A.isEmitter||!1,y=A.fade||!1,C=[];for(const N of A.frames)C.push(this._visualization.asset.getAsset(N));o.configureParticle(O,v,C,y)}o.setup(h,u,_,new Ts(0,d,0),g,m,p,T,l,c)}}copyStateFrom(t){let e=0;t._emitters&&t._currentEmitter&&(e=t._emitters.getKey(t._emitters.getValues().indexOf(t._currentEmitter))),this.setAnimation(e),this._currentEmitter&&this._currentEmitter.copyStateFrom(t._currentEmitter,t._size/this._size),this._canvasTexture=null}clearCanvas(){this._emptySprite||(this._emptySprite=new se(ut.EMPTY),this._emptySprite.alpha=0),this._canvasTexture?Ae.instance.renderer.render(this._emptySprite,{renderTexture:this._canvasTexture,clear:!0}):this._canvasTexture=xe.create({width:this._roomSprite.width,height:this._roomSprite.height})}}class qA extends ce{dispose(){if(super.dispose(),this._currentParticleSystem=null,this._particleSystems){for(const t of this._particleSystems.getValues())t.dispose();this._particleSystems=null}}updateObject(t,e){if(super.updateObject(t,e)){if(!this._particleSystems)this.readDefinition(),this._particleSystems?this._currentParticleSystem=this._particleSystems.getValue(t):Y.log("ERROR Particle systems could not be read!",this.object.type);else if(t!==this._scale||this._particleSystems.getValue(t)!==this._currentParticleSystem){const i=this._particleSystems.getValue(t);i.copyStateFrom(this._currentParticleSystem),this._currentParticleSystem&&this._currentParticleSystem.reset(),this._currentParticleSystem=i}return!0}return!1}updateSprites(t,e,i){super.updateSprites(t,e,i),this._currentParticleSystem&&this._currentParticleSystem.updateSprites()}updateAnimation(t){return this._currentParticleSystem&&this._currentParticleSystem.updateAnimation(),super.updateAnimation(t)}setAnimation(t){this._currentParticleSystem&&this._currentParticleSystem.setAnimation(t),super.setAnimation(t)}getLayerYOffset(t,e,i){return this._currentParticleSystem&&this._currentParticleSystem.controlsSprite(i)?this._currentParticleSystem.getLayerYOffset(t,e,i):super.getLayerYOffset(t,e,i)}readDefinition(){if(!this.object||!this.object.model)return!1;const t=this.object.model.getValue(I.FURNITURE_FIREWORKS_DATA);if(!t||!t.length)return!1;this._particleSystems=new Ee;for(const e of t){const i=e.size,r=new P9(this);r.parseData(e),this._particleSystems.add(i,r)}return!0}}const Pu=class extends qA{constructor(){super(...arguments),this._packetType=0,this._ribbonType=0,this._lastAnimationId=0}update(s,t,e,i){this.updatePresentWrap(),super.update(s,t,e,i)}updatePresentWrap(){if(!this.object)return;const s=1e3,t=this.object.model.getValue(I.FURNITURE_EXTRAS),e=parseInt(t),i=Math.floor(e/s),r=e%s;this._packetType=i>Pu.MAX_PACKET_TYPE_VALUE?0:i,this._ribbonType=r>Pu.MAX_RIBBON_TYPE_VALUE?0:r}getFrameNumber(s,t){if(this._lastAnimationId===Pu.PRESENT_DEFAULT_STATE){if(t<=1)return this._packetType;if(t===2)return this._ribbonType}return super.getFrameNumber(s,t)}getSpriteAssetName(s,t){const e=this.getValidSize(s);let i=this._type,r="";t<this.spriteCount-1?r=String.fromCharCode("a".charCodeAt(0)+t):r="sd";const n=this.getFrameNumber(s,t);return i=i+("_"+e+"_"+r+"_"+this.direction),i=i+("_"+n),i}setAnimation(s){this._lastAnimationId=s,super.setAnimation(s)}};let i_=Pu;i_.PRESENT_DEFAULT_STATE=0;i_.MAX_PACKET_TYPE_VALUE=9;i_.MAX_RIBBON_TYPE_VALUE=11;class b9 extends nr{constructor(){super(...arguments),this._packetType=0,this._ribbonType=0}update(t,e,i,r){this.updatePresentWrap(),super.update(t,e,i,r)}updatePresentWrap(){if(!this.object)return;const t=this.object.model.getValue(I.FURNITURE_EXTRAS),e=1e3,i=parseInt(t);this._packetType=Math.floor(i/e),this._ribbonType=i%e}getFrameNumber(t,e){return e<=1?this._packetType:this._ribbonType}getSpriteAssetName(t,e){const i=this.getValidSize(t);let r=this._type,n="";e<this.spriteCount-1?n=String.fromCharCode("a".charCodeAt(0)+e):n="sd";const a=this.getFrameNumber(t,e);return r=r+("_"+i+"_"+n+"_"+this.direction),r=r+("_"+a),r}}const Ni=class extends ce{constructor(){super(),this._color1=Ni.DEFAULT_COLOR_1,this._color2=Ni.DEFAULT_COLOR_2,this._badgeAssetNameNormalScale="",this._badgeAssetNameSmallScale=""}updateModel(s){const t=super.updateModel(s);if(this._badgeAssetNameNormalScale===""){const r=this.object.model.getValue(I.FURNITURE_GUILD_CUSTOMIZED_ASSET_NAME);r&&(this._badgeAssetNameNormalScale=r,this._badgeAssetNameSmallScale=this._badgeAssetNameNormalScale+"_32")}const e=this.object.model.getValue(I.FURNITURE_GUILD_CUSTOMIZED_COLOR_1);this._color1=e||Ni.DEFAULT_COLOR_1;const i=this.object.model.getValue(I.FURNITURE_GUILD_CUSTOMIZED_COLOR_2);return this._color2=i||Ni.DEFAULT_COLOR_2,t}getLayerColor(s,t,e){switch(this.getLayerTag(s,this._direction,t)){case Ni.PRIMARY_COLOUR_SPRITE_TAG:return this._color1;case Ni.SECONDARY_COLOUR_SPRITE_TAG:return this._color2}return super.getLayerColor(s,t,e)}getSpriteAssetName(s,t){return this.getLayerTag(s,this._direction,t)===Ni.BADGE?s===32?this._badgeAssetNameSmallScale:this._badgeAssetNameNormalScale:super.getSpriteAssetName(s,t)}getLibraryAssetNameForSprite(s,t){return t.tag===Ni.BADGE?"%group.badge.url%"+t.libraryAssetName.replace("badge_",""):super.getLibraryAssetNameForSprite(s,t)}};let Wa=Ni;Wa.PRIMARY_COLOUR_SPRITE_TAG="COLOR1";Wa.SECONDARY_COLOUR_SPRITE_TAG="COLOR2";Wa.BADGE="BADGE";Wa.DEFAULT_COLOR_1=15658734;Wa.DEFAULT_COLOR_2=4934475;const ea=class extends hg{updateModel(s){const t=super.updateModel(s);if(!this.hasThumbnailImage){const r=this.object.model.getValue(I.FURNITURE_GUILD_CUSTOMIZED_ASSET_NAME);r&&r.length&&this.setThumbnailImages(this.getBitmapAsset(r))}const e=this.object.model.getValue(I.FURNITURE_GUILD_CUSTOMIZED_COLOR_1);this._color1=e||ea.DEFAULT_COLOR_1;const i=this.object.model.getValue(I.FURNITURE_GUILD_CUSTOMIZED_COLOR_2);return this._color2=i||ea.DEFAULT_COLOR_2,t}generateTransformedThumbnail(s,t){const i=new wt,r=t.width/s.width;switch(this.direction){case 2:i.a=r,i.b=-.5*r,i.c=0,i.d=r*1.1,i.tx=0,i.ty=.5*r*s.width;break;case 0:case 4:i.a=r,i.b=.5*r,i.c=0,i.d=r*1.1,i.tx=0,i.ty=0;break;default:i.a=r,i.b=0,i.c=0,i.d=r,i.tx=0,i.ty=0}const n=new se(s);return n.transform.setFromMatrix(i),n.position.set(0),qt.generateTexture(n)}getLayerColor(s,t,e){switch(this.getLayerTag(s,this._direction,t)){case ea.PRIMARY_COLOUR_SPRITE_TAG:return this._color1;case ea.SECONDARY_COLOUR_SPRITE_TAG:return this._color2}return super.getLayerColor(s,t,e)}getLibraryAssetNameForSprite(s,t){return t.tag===ea.THUMBNAIL&&this.object&&this.object.model.getValue(I.FURNITURE_GUILD_CUSTOMIZED_ASSET_NAME)?"%group.badge.url%"+this.object.model.getValue(I.FURNITURE_GUILD_CUSTOMIZED_ASSET_NAME):super.getLibraryAssetNameForSprite(s,t)}getBitmapAsset(s){const t=this.asset.getAsset(s);return!t||!t.texture?null:t.texture}};let Ph=ea;Ph.PRIMARY_COLOUR_SPRITE_TAG="COLOR1";Ph.SECONDARY_COLOUR_SPRITE_TAG="COLOR2";Ph.DEFAULT_COLOR_1=15658734;Ph.DEFAULT_COLOR_2=4934475;const sa=class extends ce{constructor(){super(),this._stateQueue=[],this._running=!1}setAnimation(s){if(s===-1&&!this._running){this._running=!0,this._stateQueue=[],this._stateQueue.push(sa.ANIMATION_ID_START_ROLL),this._stateQueue.push(sa.ANIMATION_ID_ROLL);return}if(s>0&&s<=sa.ANIMATION_ID_OFFSET_SLOW1){if(this._running){this._running=!1,this._stateQueue=[],this._stateQueue.push(sa.ANIMATION_ID_OFFSET_SLOW1+s),this._stateQueue.push(sa.ANIMATION_ID_OFFSET_SLOW2+s),this._stateQueue.push(s);return}super.setAnimation(s)}}updateAnimation(s){return this.getLastFramePlayed(1)&&this.getLastFramePlayed(2)&&this.getLastFramePlayed(3)&&this._stateQueue.length&&super.setAnimation(this._stateQueue.shift()),super.updateAnimation(s)}};let bh=sa;bh.ANIMATION_ID_OFFSET_SLOW1=10;bh.ANIMATION_ID_OFFSET_SLOW2=20;bh.ANIMATION_ID_START_ROLL=31;bh.ANIMATION_ID_ROLL=32;class D9 extends XA{constructor(){super(...arguments),this._needsTransform=!0}transformGifTextures(t){if(!this._gifCollection)return;const e=this._gifCollection.textures;if(e.length){for(let i=0;i<e.length;i++){const r=e[i];if(!r||!this.getAsset(`${this._imageUrl}_${i}`))continue;const a=1.1,o=new wt,h=t.width/r.width;switch(this.direction){case 2:o.a=h,o.b=-.5*h,o.c=0,o.d=h*a,o.tx=0,o.ty=.5*h*r.width;break;case 0:case 4:o.a=h,o.b=.5*h,o.c=0,o.d=h*a,o.tx=0,o.ty=0;break;default:o.a=h,o.b=0,o.c=0,o.d=h,o.tx=0,o.ty=0}const u=new se(r),c=xe.create({width:t.width+o.tx,height:t.height+o.ty});Ae.instance.renderer.render(u,{renderTexture:c,clear:!0,transform:o}),this.asset.disposeAsset(`${this._imageUrl}_${i}`),this.asset.addAsset(`${this._imageUrl}_${i}`,c,!0,t.x,t.y,t.flipH,t.flipV)}this._needsTransform=!1}}generateTransformedImage(t,e){const r=new wt,n=e.width/t.width;switch(this.direction){case 2:r.a=n,r.b=-.5*n,r.c=0,r.d=n*1.1,r.tx=0,r.ty=.5*n*t.width;break;case 0:case 4:r.a=n,r.b=.5*n,r.c=0,r.d=n*1.1,r.tx=0,r.ty=0;break;default:r.a=n,r.b=0,r.c=0,r.d=n,r.tx=0,r.ty=0}const a=new se(t),o=xe.create({width:e.width+r.tx,height:e.height+r.ty});Ae.instance.renderer.render(a,{renderTexture:o,clear:!0,transform:r}),this.asset.disposeAsset(`${this._imageUrl}_0`),this.asset.addAsset(`${this._imageUrl}_0`,o,!0,a.x,a.y,e.flipH,e.flipV),this._needsTransform=!1}checkAndCreateImageForCurrentState(){super.checkAndCreateImageForCurrentState(),this._needsTransform=!0}getSpriteAssetName(t,e){return this.getLayerTag(t,this._direction,e)===Wr.BRANDED_IMAGE&&this._imageUrl?(this._needsTransform&&(this._isAnimated?this.transformGifTextures(this.getAsset(super.getSpriteAssetName(t,e))):this.generateTransformedImage(ys().getTexture(this._imageUrl),this.getAsset(super.getSpriteAssetName(t,e)))),`${this._imageUrl}_${this.getFrameNumber(t,e)}`):super.getSpriteAssetName(t,e)}}class ef extends Qi{constructor(){super(),this._avatarData=new _l}dispose(){super.dispose(),this._avatarData&&(this._avatarData.dispose(),this._avatarData=null)}createAvatarImage(t,e,i=null,r=null,n=null){return this._avatarData.createAvatarImage(t,e,i,r,n)}set avatarManager(t){this._avatarData.avatarManager=t}}const bu=class extends nr{constructor(){super(),this._mannequinScale=-1,this._figure=null,this._gender=null,this._dynamicAssetName=null,this._needsUpdate=!1,this._placeHolderFigure="hd-99999-99998",this._disposed=!1}initialize(s){return s instanceof ef?super.initialize(s):!1}dispose(){this._disposed||(this._disposed=!0,this._dynamicAssetName&&this.asset&&(this.asset.disposeAsset(this._dynamicAssetName),this._dynamicAssetName=null),super.dispose())}updateObject(s,t){const e=super.updateObject(s,t);return e&&this._mannequinScale!==s&&(this._mannequinScale=s,this.updateAvatar()),e}updateModel(s){let t=super.updateModel(s);if(t){const e=this.object.model.getValue(I.FURNITURE_MANNEQUIN_FIGURE)||null;e&&(this._figure=e+"."+this._placeHolderFigure,this._gender=this.object.model.getValue(I.FURNITURE_MANNEQUIN_GENDER)||null,this.updateAvatar())}return t=t||this._needsUpdate,this._needsUpdate=!1,t}updateAvatar(s=!1){if(!this.avatarExists()||s){const t=this.data.createAvatarImage(this._figure,this._mannequinScale,this._gender,this);t&&(t.setDirection(We.FULL,this.direction),this._dynamicAssetName&&this.asset.disposeAsset(this._dynamicAssetName),this.asset.addAsset(this.getAvatarAssetName(),t.getImage(We.FULL,!1,1,!1),!0),this._dynamicAssetName=this.getAvatarAssetName(),this._needsUpdate=!0,t.dispose())}}avatarExists(){return this._figure&&this.getAsset(this.getAvatarAssetName())!==null}getAvatarAssetName(){return"mannequin_"+this._figure+"_"+this._mannequinScale+"_"+this.direction+"_"+this.object.id}resetFigure(s){s===this._figure&&this.updateAvatar(!0)}getSpriteAssetName(s,t){const e=this.getLayerTag(s,this.direction,t);return this._figure&&e===bu.AVATAR_IMAGE_SPRITE_TAG&&this.avatarExists()?this.getAvatarAssetName():super.getSpriteAssetName(s,t)}getLayerXOffset(s,t,e){return this.getLayerTag(s,t,e)===bu.AVATAR_IMAGE_SPRITE_TAG&&this.avatarExists()?-this.getSprite(e).width/2:super.getLayerXOffset(s,t,e)}getLayerYOffset(s,t,e){return this.getLayerTag(s,t,e)===bu.AVATAR_IMAGE_SPRITE_TAG&&this.avatarExists()?-this.getSprite(e).height:super.getLayerYOffset(s,t,e)}get disposed(){return this._disposed}get data(){return this._data}};let ZA=bu;ZA.AVATAR_IMAGE_SPRITE_TAG="avatar_image";const un=class extends ce{constructor(){super(),this._animOffsetIndex=[]}updateAnimation(s){this._animSpeedIndex||this.initItems(s);let t=this.getSprite(2);return t&&(this._animOffsetIndex[0]=this.getNewPoint(s,0)),t=this.getSprite(3),t&&(this._animOffsetIndex[1]=this.getNewPoint(s,1)),super.updateAnimation(s)}getNewPoint(s,t){let e=0,i=this._animPhaseIndex[t],r=this._animDirectionIndex[t];const n=this._animSpeedIndex[t],a=this._animFactorIndex[t];let o=1;s==32?(e=un.AREA_DIAMETER_SMALL,o=.5):e=un.AREA_DIAMETER_LARGE;const h=i+r*n;Math.abs(h)>=e&&(r>0?i=i-(h-e):i=i+(-e-h),r=-r,this._animDirectionIndex[t]=r);const u=(e-Math.abs(i))*a;let c=r*Math.sin(Math.abs(i/4))*u;return r>0?c=c-u:c=c+u,i=i+r*n*o,this._animPhaseIndex[t]=i,Math.trunc(c)==0&&(this._animFactorIndex[t]=this.getRandomAmplitudeFactor()),new zu(i,c)}initItems(s){let t;s===32?t=un.AREA_DIAMETER_SMALL:t=un.AREA_DIAMETER_LARGE,this._animPhaseIndex=[],this._animPhaseIndex.push(Math.random()*t*1.5),this._animPhaseIndex.push(Math.random()*t*1.5),this._animDirectionIndex=[],this._animDirectionIndex.push(1),this._animDirectionIndex.push(-1),this._animSpeedIndex=[],this._animSpeedIndex.push(un.ANIM_SPEED_FAST),this._animSpeedIndex.push(un.ANIM_SPEED_SLOW),this._animFactorIndex=[],this._animFactorIndex.push(this.getRandomAmplitudeFactor()),this._animFactorIndex.push(this.getRandomAmplitudeFactor())}getLayerXOffset(s,t,e){return(e===2||e===3)&&this._animOffsetIndex.length==2?this._animOffsetIndex[e-2].x:super.getLayerXOffset(s,t,e)}getLayerYOffset(s,t,e){return(e===2||e===3)&&this._animOffsetIndex.length==2?this._animOffsetIndex[e-2].y:super.getLayerYOffset(s,t,e)}getRandomAmplitudeFactor(){return Math.random()*30/100+.15}};let Xa=un;Xa.UPDATE_INTERVAL=2;Xa.AREA_DIAMETER_SMALL=15;Xa.AREA_DIAMETER_LARGE=31;Xa.ANIM_SPEED_FAST=2;Xa.ANIM_SPEED_SLOW=1;const QA=class{constructor(s,t,e,i,r,n){this._name=s,this._index=t,this._radius=e,this._arcSpeed=i*Math.PI*2/360,this._arcOffset=r*Math.PI*2/360,this._height=n,this._position=0,this._positionVector=new S(0,0,0),this._children=[]}dispose(){for(;this._children.length>0;)this._children.shift().dispose()}update(s,t,e){this._position=this._position+this._arcSpeed/QA.SYSTEM_TEMPO,s[this._index]=this.getPositionVector(t,e);for(const i of this._children)i.update(s,this._positionVector,e)}getPositionVector(s,t){const e=this._radius*Math.cos(this._position+this._arcOffset),i=this._radius*Math.sin(this._position+this._arcOffset);return this._positionVector.x=(e-i)*(t/2),this._positionVector.y=(i+e)*(t/2)*.5-this._height*(t/2),this._positionVector.z=-Math.trunc(4*(e+i)-.7),s&&this._positionVector.add(s),this._positionVector}addChild(s){this._children.indexOf(s)>=0||this._children.push(s)}hasChild(s){return!!this.getChild(s)}getChild(s){for(const t of this._children){if(t.name===s)return t;if(t.hasChild(s))return t.getChild(s)}return null}get name(){return this._name}};let JA=QA;JA.SYSTEM_TEMPO=30;class L9 extends ce{constructor(){super(),this._offsetArray=[],this._rootPosition=new S}dispose(){if(this._planetIndex)for(;this._planetIndex.length>0;)this._planetIndex.shift().dispose();this._planetIndex=null,this._planetNameIndex=null}updateAnimation(t){if(!this._planetIndex&&this.spriteCount>0&&!this.processPlanets())return 0;if(this._planetIndex){for(const e of this._planetIndex)e.update(this._offsetArray,this._rootPosition,t);return super.updateAnimation(t)}return 0}getLayerXOffset(t,e,i){return this._offsetArray[i]?this._offsetArray[i].x:super.getLayerXOffset(t,e,i)}getLayerYOffset(t,e,i){return this._offsetArray[i]?this._offsetArray[i].y:super.getLayerYOffset(t,e,i)}getLayerZOffset(t,e,i){return this._offsetArray[i]?this._offsetArray[i].z:super.getLayerZOffset(t,e,i)}processPlanets(){if(!this.object||!this.object.model)return;const t=this.object.model.getValue(I.FURNITURE_PLANETSYSTEM_DATA);if(!t)return!1;this._planetIndex=[],this._planetNameIndex=[];for(const e of t)this.getSprite(e.id)&&this.addPlanet(e.name,e.id,e.parent,e.radius||0,e.arcSpeed||0,e.arcOffset||0,e.height||0);return!0}addPlanet(t,e,i,r,n,a,o){if(!this._planetIndex)return;const h=new JA(t,e,r,n,a,o),u=this.getPlanet(i);u?u.addChild(h):(this._planetIndex.push(h),this._planetNameIndex.push(t))}getPlanet(t){for(const e of this._planetIndex){if(e.name===t)return e;if(e.hasChild(t))return e.getChild(t)}return null}}class U9 extends ce{}const Du=class extends ce{constructor(){super(),this._stateQueue=[],this._animationCounter=-1}setAnimation(s){return s===Du.ANIMATION_ID_ROLL_ONCE&&(this._stateQueue=[],this._stateQueue.push(Du.ANIMATION_ID_NORMAL),this._animationCounter=Du.ANIMATION_DURATION),super.setAnimation(s)}updateAnimation(s){return this._animationCounter>0&&this._animationCounter--,this._animationCounter||this._stateQueue.length&&super.setAnimation(this._stateQueue.shift()),super.updateAnimation(s)}usesAnimationResetting(){return!0}};let Dh=Du;Dh.ANIMATION_ID_ROLL=3;Dh.ANIMATION_ID_ROLL_ONCE=2;Dh.ANIMATION_ID_NORMAL=1;Dh.ANIMATION_DURATION=15;class x9 extends ce{usesAnimationResetting(){return!0}}class F9 extends Wr{imageReady(t,e){super.imageReady(t,e),t&&this.setImageOffset(t.width,t.height)}setImageOffset(t,e){const i=new kA;i.setDirection(1,0,-e),i.setDirection(3,0,0),i.setDirection(5,-t,0),i.setDirection(7,-t,-e),i.setDirection(4,-t/2,-e/2),this._imageOffset=i}getLayerXOffset(t,e,i){if(this._imageOffset){const r=this._imageOffset.getXOffset(e,0);if(r!==void 0)return r+this._offsetX}return super.getLayerXOffset(t,e,i)+this._offsetX}getLayerYOffset(t,e,i){if(this._imageOffset){const r=this._imageOffset.getYOffset(e,0);if(r!==void 0)return r+this._offsetY}return super.getLayerYOffset(t,e,i)+this._offsetY}getLayerZOffset(t,e,i){return super.getLayerZOffset(t,e,i)+-this._offsetZ}getLayerIgnoreMouse(t,e,i){return!0}}const Ro=class extends ce{getFrameNumber(s,t){const e=this.getLayerTag(s,this.direction,t),i=this.object.getState(0);switch(e){case Ro.ONES_SPRITE:return Math.floor(i%10);case Ro.TENS_SPRITE:return Math.floor(i/10%10);case Ro.HUNDREDS_SPRITE:return Math.floor(i/100%10);case Ro.THOUSANDS_SPRITE:return Math.floor(i/1e3%10);default:return super.getFrameNumber(s,t)}}};let Lh=Ro;Lh.ONES_SPRITE="ones_sprite";Lh.TENS_SPRITE="tens_sprite";Lh.HUNDREDS_SPRITE="hundreds_sprite";Lh.THOUSANDS_SPRITE="thousands_sprite";class w9 extends ce{constructor(){super(...arguments),this._internalFrameIncreaseCounter=0}updateAnimations(t){return this._internalFrameIncreaseCounter=this._internalFrameIncreaseCounter+this.object.model.getValue(I.FURNITURE_SOUNDBLOCK_RELATIVE_ANIMATION_SPEED),this._frameIncrease=this._internalFrameIncreaseCounter,this._internalFrameIncreaseCounter=this._internalFrameIncreaseCounter-this._frameIncrease,super.updateAnimations(t)}}class G9 extends nr{getLayerColor(t,e,i){return this._data?this._data.getLayerColor(t,e,i):Da.DEFAULT_COLOR}}const Fs=class extends ce{constructor(){super(),this._stateQueue=[],this._running=!1,super.setAnimation(Fs.ANIMATION_ID_OFF)}setAnimation(s){if(s===0&&!this._running){this._running=!0,this._stateQueue=[],this._stateQueue.push(Fs.ANIMATION_ID_START_ROLL),this._stateQueue.push(Fs.ANIMATION_ID_ROLL);return}if(s>0&&s<=Fs.ANIMATION_ID_OFFSET_SLOW2){if(this._running){this._running=!1,this._stateQueue=[],this.direction===2?(this._stateQueue.push(Fs.ANIMATION_ID_OFFSET_SLOW1+5),this._stateQueue.push(Fs.ANIMATION_ID_OFFSET_SLOW2+5)):(this._stateQueue.push(Fs.ANIMATION_ID_OFFSET_SLOW1+s),this._stateQueue.push(Fs.ANIMATION_ID_OFFSET_SLOW2+s)),this._stateQueue.push(Fs.ANIMATION_ID_OFF);return}super.setAnimation(Fs.ANIMATION_ID_OFF)}}updateAnimation(s){return this.getLastFramePlayed(11)&&this._stateQueue.length&&super.setAnimation(this._stateQueue.shift()),super.updateAnimation(s)}};let Ka=Fs;Ka.ANIMATION_ID_OFFSET_SLOW1=20;Ka.ANIMATION_ID_OFFSET_SLOW2=10;Ka.ANIMATION_ID_START_ROLL=31;Ka.ANIMATION_ID_ROLL=32;Ka.ANIMATION_ID_OFF=30;const _r=class extends ce{updateObject(s,t){return super.updateObject(s,t),!0}getFrameNumber(s,t){const e=this.object.model.getValue(I.FURNITURE_VOTE_COUNTER_COUNT);switch(this.getLayerTag(s,this.direction,t)){case _r.ONES_SPRITE:return e%10;case _r.TENS_SPRITE:return e/10%10;case _r.HUNDREDS_SPRITE:return e/100%10;default:return super.getFrameNumber(s,t)}}getLayerAlpha(s,t,e){if(this.object.model.getValue(I.FURNITURE_VOTE_COUNTER_COUNT)===_r.HIDE_COUNTER_SCORE)switch(this.getLayerTag(s,t,e)){case _r.ONES_SPRITE:case _r.TENS_SPRITE:case _r.HUNDREDS_SPRITE:return 0}return super.getLayerAlpha(s,t,e)}};let Uh=_r;Uh.ONES_SPRITE="ones_sprite";Uh.TENS_SPRITE="tens_sprite";Uh.HUNDREDS_SPRITE="hundreds_sprite";Uh.HIDE_COUNTER_SCORE=-1;const Pi=class extends ce{getFrameNumber(s,t){const e=this.object.model.getValue(I.FURNITURE_VOTE_MAJORITY_RESULT);switch(this.getLayerTag(s,this.direction,t)){case Pi.ONES_SPRITE:return e%10;case Pi.TENS_SPRITE:return e/10%10;case Pi.HUNDREDS_SPRITE:return e/100%10;default:return super.getFrameNumber(s,t)}}getLayerAlpha(s,t,e){const i=this.object.model.getValue(I.FURNITURE_VOTE_MAJORITY_RESULT);if(Pi.HIDE_RESULTS_STATES.indexOf(this.object.getState(0))!==-1||i===Pi.HIDE_RESULTS_VALUE)switch(this.getLayerTag(s,t,e)){case Pi.ONES_SPRITE:case Pi.TENS_SPRITE:case Pi.HUNDREDS_SPRITE:return 0}return super.getLayerAlpha(s,t,e)}};let qa=Pi;qa.ONES_SPRITE="ones_sprite";qa.TENS_SPRITE="tens_sprite";qa.HUNDREDS_SPRITE="hundreds_sprite";qa.HIDE_RESULTS_STATES=[-1,1];qa.HIDE_RESULTS_VALUE=-1;class B9 extends ce{}const $A=class extends KA{getThumbnailURL(){if(!this.object)return null;const s=this.object.model.getValue(I.FURNITURE_DATA);return s&&s[$A.THUMBNAIL_URL]||null}};let tv=$A;tv.THUMBNAIL_URL="THUMBNAIL_URL";/*!
 * @pixi/text - v6.5.9
 * Compiled Wed, 25 Jan 2023 05:01:45 UTC
 *
 * @pixi/text is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var sf=function(s,t){return sf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])},sf(s,t)};function H9(s,t){sf(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var dl;(function(s){s[s.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",s[s.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"})(dl||(dl={}));var Z_={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:dl.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},V9=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Ep=function(){function s(t){this.styleID=0,this.reset(),J_(this,t,t)}return s.prototype.clone=function(){var t={};return J_(t,this,Z_),new s(t)},s.prototype.reset=function(){J_(this,Z_,Z_)},Object.defineProperty(s.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"breakWords",{get:function(){return this._breakWords},set:function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(t){var e=Q_(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"fill",{get:function(){return this._fill},set:function(t){var e=Q_(t);this._fill!==e&&(this._fill=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(t){k9(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"leading",{get:function(){return this._leading},set:function(t){this._leading!==t&&(this._leading=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"stroke",{get:function(){return this._stroke},set:function(t){var e=Q_(t);this._stroke!==e&&(this._stroke=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"trim",{get:function(){return this._trim},set:function(t){this._trim!==t&&(this._trim=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)},enumerable:!1,configurable:!0}),s.prototype.toFontString=function(){var t=typeof this.fontSize=="number"?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var i=e.length-1;i>=0;i--){var r=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&V9.indexOf(r)<0&&(r='"'+r+'"'),e[i]=r}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},s}();function pp(s){return typeof s=="number"?Pp(s):(typeof s=="string"&&s.indexOf("0x")===0&&(s=s.replace("0x","#")),s)}function Q_(s){if(Array.isArray(s)){for(var t=0;t<s.length;++t)s[t]=pp(s[t]);return s}else return pp(s)}function k9(s,t){if(!Array.isArray(s)||!Array.isArray(t)||s.length!==t.length)return!1;for(var e=0;e<s.length;++e)if(s[e]!==t[e])return!1;return!0}function J_(s,t,e){for(var i in e)Array.isArray(t[i])?s[i]=t[i].slice():s[i]=t[i]}var _u={willReadFrequently:!0},Xr=function(){function s(t,e,i,r,n,a,o,h,u){this.text=t,this.style=e,this.width=i,this.height=r,this.lines=n,this.lineWidths=a,this.lineHeight=o,this.maxLineWidth=h,this.fontProperties=u}return s.measureText=function(t,e,i,r){r===void 0&&(r=s._canvas),i=i??e.wordWrap;var n=e.toFontString(),a=s.measureFont(n);a.fontSize===0&&(a.fontSize=e.fontSize,a.ascent=e.fontSize);var o=r.getContext("2d",_u);o.font=n;for(var h=i?s.wordWrap(t,e,r):t,u=h.split(/(?:\r\n|\r|\n)/),c=new Array(u.length),l=0,_=0;_<u.length;_++){var d=o.measureText(u[_]).width+(u[_].length-1)*e.letterSpacing;c[_]=d,l=Math.max(l,d)}var g=l+e.strokeThickness;e.dropShadow&&(g+=e.dropShadowDistance);var m=e.lineHeight||a.fontSize+e.strokeThickness,p=Math.max(m,a.fontSize+e.strokeThickness)+(u.length-1)*(m+e.leading);return e.dropShadow&&(p+=e.dropShadowDistance),new s(t,e,g,p,u,c,m+e.leading,l,a)},s.wordWrap=function(t,e,i){i===void 0&&(i=s._canvas);for(var r=i.getContext("2d",_u),n=0,a="",o="",h=Object.create(null),u=e.letterSpacing,c=e.whiteSpace,l=s.collapseSpaces(c),_=s.collapseNewlines(c),d=!l,g=e.wordWrapWidth+u,m=s.tokenize(t),p=0;p<m.length;p++){var T=m[p];if(s.isNewline(T)){if(!_){o+=s.addLine(a),d=!l,a="",n=0;continue}T=" "}if(l){var A=s.isBreakingSpace(T),O=s.isBreakingSpace(a[a.length-1]);if(A&&O)continue}var v=s.getFromCache(T,u,h,r);if(v>g)if(a!==""&&(o+=s.addLine(a),a="",n=0),s.canBreakWords(T,e.breakWords))for(var y=s.wordWrapSplit(T),C=0;C<y.length;C++){for(var N=y[C],L=1;y[C+L];){var P=y[C+L],b=N[N.length-1];if(!s.canBreakChars(b,P,T,C,e.breakWords))N+=P;else break;L++}C+=N.length-1;var w=s.getFromCache(N,u,h,r);w+n>g&&(o+=s.addLine(a),d=!1,a="",n=0),a+=N,n+=w}else{a.length>0&&(o+=s.addLine(a),a="",n=0);var q=p===m.length-1;o+=s.addLine(T,!q),d=!1,a="",n=0}else v+n>g&&(d=!1,o+=s.addLine(a),a="",n=0),(a.length>0||!s.isBreakingSpace(T)||d)&&(a+=T,n+=v)}return o+=s.addLine(a,!1),o},s.addLine=function(t,e){return e===void 0&&(e=!0),t=s.trimRight(t),t=e?t+`
`:t,t},s.getFromCache=function(t,e,i,r){var n=i[t];if(typeof n!="number"){var a=t.length*e;n=r.measureText(t).width+a,i[t]=n}return n},s.collapseSpaces=function(t){return t==="normal"||t==="pre-line"},s.collapseNewlines=function(t){return t==="normal"},s.trimRight=function(t){if(typeof t!="string")return"";for(var e=t.length-1;e>=0;e--){var i=t[e];if(!s.isBreakingSpace(i))break;t=t.slice(0,-1)}return t},s.isNewline=function(t){return typeof t!="string"?!1:s._newlines.indexOf(t.charCodeAt(0))>=0},s.isBreakingSpace=function(t,e){return typeof t!="string"?!1:s._breakingSpaces.indexOf(t.charCodeAt(0))>=0},s.tokenize=function(t){var e=[],i="";if(typeof t!="string")return e;for(var r=0;r<t.length;r++){var n=t[r],a=t[r+1];if(s.isBreakingSpace(n,a)||s.isNewline(n)){i!==""&&(e.push(i),i=""),e.push(n);continue}i+=n}return i!==""&&e.push(i),e},s.canBreakWords=function(t,e){return e},s.canBreakChars=function(t,e,i,r,n){return!0},s.wordWrapSplit=function(t){return t.split("")},s.measureFont=function(t){if(s._fonts[t])return s._fonts[t];var e={ascent:0,descent:0,fontSize:0},i=s._canvas,r=s._context;r.font=t;var n=s.METRICS_STRING+s.BASELINE_SYMBOL,a=Math.ceil(r.measureText(n).width),o=Math.ceil(r.measureText(s.BASELINE_SYMBOL).width),h=Math.ceil(s.HEIGHT_MULTIPLIER*o);o=o*s.BASELINE_MULTIPLIER|0,i.width=a,i.height=h,r.fillStyle="#f00",r.fillRect(0,0,a,h),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(n,0,o);var u=r.getImageData(0,0,a,h).data,c=u.length,l=a*4,_=0,d=0,g=!1;for(_=0;_<o;++_){for(var m=0;m<l;m+=4)if(u[d+m]!==255){g=!0;break}if(!g)d+=l;else break}for(e.ascent=o-_,d=c-l,g=!1,_=h;_>o;--_){for(var m=0;m<l;m+=4)if(u[d+m]!==255){g=!0;break}if(!g)d-=l;else break}return e.descent=_-o,e.fontSize=e.ascent+e.descent,s._fonts[t]=e,e},s.clearMetrics=function(t){t===void 0&&(t=""),t?delete s._fonts[t]:s._fonts={}},Object.defineProperty(s,"_canvas",{get:function(){if(!s.__canvas){var t=void 0;try{var e=new OffscreenCanvas(0,0),i=e.getContext("2d",_u);if(i&&i.measureText)return s.__canvas=e,e;t=Z.ADAPTER.createCanvas()}catch{t=Z.ADAPTER.createCanvas()}t.width=t.height=10,s.__canvas=t}return s.__canvas},enumerable:!1,configurable:!0}),Object.defineProperty(s,"_context",{get:function(){return s.__context||(s.__context=s._canvas.getContext("2d",_u)),s.__context},enumerable:!1,configurable:!0}),s}();Xr._fonts={};Xr.METRICS_STRING="|ÉqÅ";Xr.BASELINE_SYMBOL="M";Xr.BASELINE_MULTIPLIER=1.4;Xr.HEIGHT_MULTIPLIER=2;Xr._newlines=[10,13];Xr._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var j9={texture:!0,children:!1,baseTexture:!0},z9=function(s){H9(t,s);function t(e,i,r){var n=this,a=!1;r||(r=Z.ADAPTER.createCanvas(),a=!0),r.width=3,r.height=3;var o=ut.from(r);return o.orig=new et,o.trim=new et,n=s.call(this,o)||this,n._ownCanvas=a,n.canvas=r,n.context=r.getContext("2d",{willReadFrequently:!0}),n._resolution=Z.RESOLUTION,n._autoResolution=!0,n._text=null,n._style=null,n._styleListener=null,n._font="",n.text=e,n.style=i,n.localStyleID=-1,n}return t.prototype.updateText=function(e){var i=this._style;if(this.localStyleID!==i.styleID&&(this.dirty=!0,this.localStyleID=i.styleID),!(!this.dirty&&e)){this._font=this._style.toFontString();var r=this.context,n=Xr.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),a=n.width,o=n.height,h=n.lines,u=n.lineHeight,c=n.lineWidths,l=n.maxLineWidth,_=n.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,a)+i.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+i.padding*2)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=i.strokeThickness,r.textBaseline=i.textBaseline,r.lineJoin=i.lineJoin,r.miterLimit=i.miterLimit;for(var d,g,m=i.dropShadow?2:1,p=0;p<m;++p){var T=i.dropShadow&&p===0,A=T?Math.ceil(Math.max(1,o)+i.padding*2):0,O=A*this._resolution;if(T){r.fillStyle="black",r.strokeStyle="black";var v=i.dropShadowColor,y=Gu(typeof v=="number"?v:Z0(v)),C=i.dropShadowBlur*this._resolution,N=i.dropShadowDistance*this._resolution;r.shadowColor="rgba("+y[0]*255+","+y[1]*255+","+y[2]*255+","+i.dropShadowAlpha+")",r.shadowBlur=C,r.shadowOffsetX=Math.cos(i.dropShadowAngle)*N,r.shadowOffsetY=Math.sin(i.dropShadowAngle)*N+O}else r.fillStyle=this._generateFillStyle(i,h,n),r.strokeStyle=i.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;var L=(u-_.fontSize)/2;(!t.nextLineHeightBehavior||u-_.fontSize<0)&&(L=0);for(var P=0;P<h.length;P++)d=i.strokeThickness/2,g=i.strokeThickness/2+P*u+_.ascent+L,i.align==="right"?d+=l-c[P]:i.align==="center"&&(d+=(l-c[P])/2),i.stroke&&i.strokeThickness&&this.drawLetterSpacing(h[P],d+i.padding,g+i.padding-A,!0),i.fill&&this.drawLetterSpacing(h[P],d+i.padding,g+i.padding-A)}this.updateTexture()}},t.prototype.drawLetterSpacing=function(e,i,r,n){n===void 0&&(n=!1);var a=this._style,o=a.letterSpacing,h=t.experimentalLetterSpacing&&("letterSpacing"in CanvasRenderingContext2D.prototype||"textLetterSpacing"in CanvasRenderingContext2D.prototype);if(o===0||h){h&&(this.context.letterSpacing=o,this.context.textLetterSpacing=o),n?this.context.strokeText(e,i,r):this.context.fillText(e,i,r);return}for(var u=i,c=Array.from?Array.from(e):e.split(""),l=this.context.measureText(e).width,_=0,d=0;d<c.length;++d){var g=c[d];n?this.context.strokeText(g,u,r):this.context.fillText(g,u,r);for(var m="",p=d+1;p<c.length;++p)m+=c[p];_=this.context.measureText(m).width,u+=l-_+o,l=_}},t.prototype.updateTexture=function(){var e=this.canvas;if(this._style.trim){var i=sC(e);i.data&&(e.width=i.width,e.height=i.height,this.context.putImageData(i.data,0,0))}var r=this._texture,n=this._style,a=n.trim?0:n.padding,o=r.baseTexture;r.trim.width=r._frame.width=e.width/this._resolution,r.trim.height=r._frame.height=e.height/this._resolution,r.trim.x=-a,r.trim.y=-a,r.orig.width=r._frame.width-a*2,r.orig.height=r._frame.height-a*2,this._onTextureUpdate(),o.setRealSize(e.width,e.height,this._resolution),r.updateUvs(),this.dirty=!1},t.prototype._render=function(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),s.prototype._render.call(this,e)},t.prototype.updateTransform=function(){this.updateText(!0),s.prototype.updateTransform.call(this)},t.prototype.getBounds=function(e,i){return this.updateText(!0),this._textureID===-1&&(e=!1),s.prototype.getBounds.call(this,e,i)},t.prototype.getLocalBounds=function(e){return this.updateText(!0),s.prototype.getLocalBounds.call(this,e)},t.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)},t.prototype._generateFillStyle=function(e,i,r){var n=e.fill;if(Array.isArray(n)){if(n.length===1)return n[0]}else return n;var a,o=e.dropShadow?e.dropShadowDistance:0,h=e.padding||0,u=this.canvas.width/this._resolution-o-h*2,c=this.canvas.height/this._resolution-o-h*2,l=n.slice(),_=e.fillGradientStops.slice();if(!_.length)for(var d=l.length+1,g=1;g<d;++g)_.push(g/d);if(l.unshift(n[0]),_.unshift(0),l.push(n[n.length-1]),_.push(1),e.fillGradientType===dl.LINEAR_VERTICAL){a=this.context.createLinearGradient(u/2,h,u/2,c+h);for(var m=r.fontProperties.fontSize+e.strokeThickness,g=0;g<i.length;g++){var p=r.lineHeight*(g-1)+m,T=r.lineHeight*g,A=T;g>0&&p>T&&(A=(T+p)/2);var O=T+m,v=r.lineHeight*(g+1),y=O;g+1<i.length&&v<O&&(y=(O+v)/2);for(var C=(y-A)/c,N=0;N<l.length;N++){var L=0;typeof _[N]=="number"?L=_[N]:L=N/l.length;var P=Math.min(1,Math.max(0,A/c+L*C));P=Number(P.toFixed(5)),a.addColorStop(P,l[N])}}}else{a=this.context.createLinearGradient(h,c/2,u+h,c/2);for(var b=l.length+1,w=1,g=0;g<l.length;g++){var q=void 0;typeof _[g]=="number"?q=_[g]:q=w/b,a.addColorStop(q,l[g]),w++}}return a},t.prototype.destroy=function(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},j9,e),s.prototype.destroy.call(this,e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(t.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(e){this.updateText(!0);var i=na(this.scale.x)||1;this.scale.x=i*e/this._texture.orig.width,this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(e){this.updateText(!0);var i=na(this.scale.y)||1;this.scale.y=i*e/this._texture.orig.height,this._height=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this._style},set:function(e){e=e||{},e instanceof Ep?this._style=e:this._style=new Ep(e),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolution",{get:function(){return this._resolution},set:function(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)},enumerable:!1,configurable:!0}),t.nextLineHeightBehavior=!1,t.experimentalLetterSpacing=!1,t}(Wt);class Y9{constructor(t){this._sprite=new se(t),this._texture=null,this._amount=-1,this._alpha=0}renderBubble(t){if(!this._sprite||this._amount===t)return null;const e=new Hs;e.addChild(this._sprite);const i=new z9("+"+t,{fontFamily:"Arial",fontSize:9,fill:16777215,align:"center"});return i.anchor.x=.5,i.x=this._sprite.width/2,i.y=19,e.addChild(i),this._texture?Ae.instance.renderer.render(e,{renderTexture:this._texture,clear:!0}):this._texture=qt.generateTexture(e),this._texture}get amount(){return this._amount}set amount(t){this._amount=t}get alpha(){return this._alpha}set alpha(t){this._alpha=t}}class ev extends og{constructor(){super(),this._isAllowedToTurnHead=!0}createSizeData(t,e,i){return t>1?new ta(e,i):new cl(e,i)}defineVisualizations(t){return this._isAllowedToTurnHead=!0,super.defineVisualizations(t)}processVisualElement(t,e,i){if(!t||!e||!i)return!1;switch(e){case"postures":if(!(t instanceof ta)||!t.processPostures(i))return!1;break;case"gestures":if(!(t instanceof ta)||!t.processGestures(i))return!1;break;default:if(!super.processVisualElement(t,e,i))return!1;break}return!0}postureToAnimation(t,e){const i=this.getSizeData(t);return i?i.postureToAnimation(e):ta.DEFAULT}getGestureDisabled(t,e){const i=this.getSizeData(t);return i?i.getGestureDisabled(e):!1}gestureToAnimation(t,e){const i=this.getSizeData(t);return i?i.gestureToAnimation(e):ta.DEFAULT}animationToPosture(t,e,i){const r=this.getSizeData(t);return r?r.animationToPosture(e,i):null}animationToGesture(t,e){const i=this.getSizeData(t);return i?i.animationToGesture(e):null}getGestureForAnimationId(t,e){const i=this.getSizeData(t);return i?i.getGestureForAnimationId(e):null}totalPostures(t){const e=this.getSizeData(t);return e?e.totalPostures:0}totalGestures(t){const e=this.getSizeData(t);return e?e.totalGestures:0}get isAllowedToTurnHead(){return this._isAllowedToTurnHead}}const Ge=class extends ce{constructor(){for(super(),this._posture="",this._gesture="",this._isSleeping=!1,this._headDirection=-1,this._headOnly=!1,this._nonHeadSprites=[],this._headSprites=[],this._saddleSprites=[],this._animationOver=!1,this._paletteIndex=-1,this._paletteName="",this._customLayerIds=[],this._customPartIds=[],this._customPaletteIds=[],this._isRiding=!1,this._color=16777215,this._experience=0,this._experienceTimestamp=0,this._experienceData=null,this._previousAnimationDirection=-1,this._animationStates=[];this._animationStates.length<Ge.ANIMATION_INDEX_COUNT;)this._animationStates.push(new jA)}initialize(s){if(!(s instanceof ev))return!1;const t=this.getPetAdditionAsset(Ge.PET_EXPERIENCE_BUBBLE);return t&&(this._experienceData=new Y9(t)),super.initialize(s)}dispose(){if(super.dispose(),this._animationStates){for(;this._animationStates.length;){const s=this._animationStates[0];s&&s.dispose(),this._animationStates.pop()}this._animationStates=null}}getAnimationId(s){return s.animationId}update(s,t,e,i){super.update(s,t,e,i),this.updateExperienceBubble(t)}updateExperienceBubble(s){if(this._experienceData&&(this._experienceData.alpha=0,this._experienceTimestamp)){const t=s-this._experienceTimestamp;t<Ge.EXPERIENCE_BUBBLE_VISIBLE_IN_MS?this._experienceData.alpha=Math.sin(t/Ge.EXPERIENCE_BUBBLE_VISIBLE_IN_MS*Math.PI)*255:this._experienceTimestamp=0;const e=this.getSprite(this.totalSprites-1);if(e){if(this._experienceData.alpha>0){const i=this._experienceData.renderBubble(this._experience);if(i){e.texture=i,e.offsetX=-20,e.offsetY=-80,e.alpha=this._experienceData.alpha,e.visible=!0,e.relativeDepth=-.2;return}}e.texture=null,e.visible=!1}}}updateModel(s){const t=this.object&&this.object.model;if(!t||this.updateModelCounter===t.updateCounter)return!1;const e=t.getValue(I.FIGURE_POSTURE),i=t.getValue(I.FIGURE_GESTURE);this.setPostureAndGesture(e,i);let r=t.getValue(I.FURNITURE_ALPHA_MULTIPLIER)||null;(r===null||isNaN(r))&&(r=1),this._alphaMultiplier!==r&&(this._alphaMultiplier=r,this._alphaChanged=!0),this._isSleeping=t.getValue(I.FIGURE_SLEEP)>0;const n=t.getValue(I.HEAD_DIRECTION);!isNaN(n)&&this.data.isAllowedToTurnHead?this._headDirection=n:this._headDirection=this.object.getDirection().x,this._experience=t.getValue(I.FIGURE_GAINED_EXPERIENCE),this._experienceTimestamp=t.getValue(I.FIGURE_EXPERIENCE_TIMESTAMP);const a=t.getValue(I.PET_PALETTE_INDEX),o=t.getValue(I.PET_CUSTOM_LAYER_IDS),h=t.getValue(I.PET_CUSTOM_PARTS_IDS),u=t.getValue(I.PET_CUSTOM_PALETTE_IDS),c=t.getValue(I.PET_IS_RIDING),l=t.getValue(I.PET_HEAD_ONLY),_=t.getValue(I.PET_COLOR);return a!==this._paletteIndex&&(this._paletteIndex=a,this._paletteName=this._paletteIndex.toString()),this._customLayerIds=o||[],this._customPartIds=h||[],this._customPaletteIds=u||[],this._isRiding=!isNaN(c)&&c>0,this._headOnly=!isNaN(l)&&l>0,!isNaN(_)&&this._color!==_&&(this._color=_),this.updateModelCounter=t.updateCounter,!0}updateAnimation(s){if(this.object){const t=this.object.getDirection().x;t!==this._previousAnimationDirection&&(this._previousAnimationDirection=t,this.resetAllAnimationFrames())}return super.updateAnimation(s)}setPostureAndGesture(s,t){this.data&&(s!==this._posture&&(this._posture=s,this.setAnimationForIndex(Ge.POSTURE_ANIMATION_INDEX,this.data.postureToAnimation(this._scale,s))),this.data.getGestureDisabled(this._scale,s)&&(t=null),t!==this._gesture&&(this._gesture=t,this.setAnimationForIndex(Ge.GESTURE_ANIMATION_INDEX,this.data.gestureToAnimation(this._scale,t))))}getAnimationStateData(s){return s>=0&&s<this._animationStates.length?this._animationStates[s]:null}setAnimationForIndex(s,t){const e=this.getAnimationStateData(s);e&&this.setSubAnimation(e,t)&&(this._animationOver=!1)}resetAllAnimationFrames(){this._animationOver=!1;let s=this._animationStates.length-1;for(;s>=0;){const t=this._animationStates[s];t&&t.setLayerCount(this.animatedLayerCount),s--}}updateAnimations(s){if(this._animationOver)return 0;let t=!0,e=0,i=0;for(;i<this._animationStates.length;){const r=this._animationStates[i];if(r&&!r.animationOver){const n=this.updateFramesForAnimation(r,s);e=e|n,r.animationOver?(fe.isTransitionFromAnimation(r.animationId)||fe.isTransitionToAnimation(r.animationId))&&(this.setAnimationForIndex(i,r.animationAfterTransitionId),t=!1):t=!1}i++}return this._animationOver=t,e}getSpriteAssetName(s,t){if(this._headOnly&&this.isNonHeadSprite(t)||this._isRiding&&this._parser3(t))return null;const e=this.totalSprites;if(t<e-Ge.ADDITIONAL_SPRITE_COUNT){const i=this.getValidSize(s);if(t<e-(1+Ge.ADDITIONAL_SPRITE_COUNT)){if(t>=Qi.LAYER_LETTERS.length)return null;const r=Qi.LAYER_LETTERS[t];return i===1?this._type+"_icon_"+r:this._type+"_"+i+"_"+r+"_"+this.getDirection(s,t)+"_"+this.getFrameNumber(i,t)}return this._type+"_"+i+"_sd_"+this.getDirection(s,t)+"_0"}return null}getLayerColor(s,t,e){return t<this.totalSprites-Ge.ADDITIONAL_SPRITE_COUNT?this._color:16777215}getLayerXOffset(s,t,e){let i=super.getLayerXOffset(s,t,e),r=this._animationStates.length-1;for(;r>=0;){const n=this._animationStates[r];if(n){const a=n.getFrame(e);a&&(i+=a.x)}r--}return i}getLayerYOffset(s,t,e){let i=super.getLayerYOffset(s,t,e),r=this._animationStates.length-1;for(;r>=0;){const n=this._animationStates[r];if(n){const a=n.getFrame(e);a&&(i+=a.y)}r--}return i}getLayerZOffset(s,t,e){return this.data?this.data.getLayerZOffset(s,this.getDirection(s,e),e):ct.DEFAULT_ZOFFSET}getDirection(s,t){return this.isHeadSprite(t)?this.data.getValidDirection(s,this._headDirection):this._direction}getFrameNumber(s,t){let e=this._animationStates.length-1;for(;e>=0;){const i=this._animationStates[e];if(i){const r=i.getFrame(t);if(r)return r.id}e--}return super.getFrameNumber(s,t)}isHeadSprite(s){if(this._headSprites[s]===void 0){const t=this.data.getLayerTag(this._scale,mn.USE_DEFAULT_DIRECTION,s)===Ge.HEAD,e=this.data.getLayerTag(this._scale,mn.USE_DEFAULT_DIRECTION,s)===Ge.HAIR;t||e?this._headSprites[s]=!0:this._headSprites[s]=!1}return this._headSprites[s]}isNonHeadSprite(s){if(this._nonHeadSprites[s]===void 0)if(s<this.totalSprites-(1+Ge.ADDITIONAL_SPRITE_COUNT)){const t=this.data.getLayerTag(this._scale,mn.USE_DEFAULT_DIRECTION,s);t&&t.length>0&&t!==Ge.HEAD&&t!==Ge.HAIR?this._nonHeadSprites[s]=!0:this._nonHeadSprites[s]=!1}else this._nonHeadSprites[s]=!0;return this._nonHeadSprites[s]}_parser3(s){return this._saddleSprites[s]===void 0&&(this.data.getLayerTag(this._scale,mn.USE_DEFAULT_DIRECTION,s)===Ge.SADDLE?this._saddleSprites[s]=!0:this._saddleSprites[s]=!1),this._saddleSprites[s]}getAsset(s,t=-1){if(!this.asset)return null;const e=this._customLayerIds.indexOf(t);let i=this._paletteName,r=-1,n=-1;return e>-1&&(r=this._customPartIds[e],n=this._customPaletteIds[e],i=n>-1?n.toString():this._paletteName),!isNaN(r)&&r>-1&&(s=s+"_"+r),this.asset.getAssetWithPalette(s,i)}getAdditionalLayerCount(){return super.getAdditionalLayerCount()+Ge.ADDITIONAL_SPRITE_COUNT}setLayerCount(s){super.setLayerCount(s),this._headSprites=[]}getPostureForAsset(s,t){const e=t.split("_");let i=e.length,r=0;for(;r<e.length;){if(e[r]==="64"||e[r]==="32"){i=r+3;break}r++}let n=null;if(i<e.length){let a=e[i];a=a.split("@")[0],n=this.data.animationToPosture(s,parseInt(a)/100,!1),n||(n=this.data.getGestureForAnimationId(s,parseInt(a)/100))}return n}getPetAdditionAsset(s){return ys().getTexture(s)}get data(){return this._data}};let qs=Ge;qs.TYPE=F.PET_ANIMATED;qs.HEAD="head";qs.SADDLE="saddle";qs.HAIR="hair";qs.ADDITIONAL_SPRITE_COUNT=1;qs.EXPERIENCE_BUBBLE_VISIBLE_IN_MS=1e3;qs.PET_EXPERIENCE_BUBBLE="avatar_addition_pet_experience_bubble";qs.POSTURE_ANIMATION_INDEX=0;qs.GESTURE_ANIMATION_INDEX=1;qs.ANIMATION_INDEX_COUNT=2;class ug{constructor(t,e=-1,i=1,r=-1,n=1){this._normalMinX=e,this._normalMaxX=i,this._normalMinY=r,this._normalMaxY=n,this._asset=t}get asset(){return this._asset}get normalMinX(){return this._normalMinX}get normalMaxX(){return this._normalMaxX}get normalMinY(){return this._normalMinY}get normalMaxY(){return this._normalMaxY}dispose(){this._asset=null}}ug.MIN_NORMAL_COORDINATE_VALUE=-1;ug.MAX_NORMAL_COORDINATE_VALUE=1;class In{constructor(){this._bitmaps=[]}dispose(){for(const t of this._bitmaps)t&&t.dispose();this._bitmaps=null}addBitmap(t,e=-1,i=1,r=-1,n=1){this._bitmaps.push(new ug(t,e,i,r,n))}getAsset(t){if(!t)return null;for(const e of this._bitmaps)if(e&&t.x>=e.normalMinX&&t.x<=e.normalMaxX&&t.y>=e.normalMinY&&t.y<=e.normalMaxY)return e.asset;return null}}In.MIN_NORMAL_COORDINATE_VALUE=-1;In.MAX_NORMAL_COORDINATE_VALUE=1;class W9{constructor(){this._sizes=[],this._maskVisualizations=new Map,this._assetNames=new Map,this._lastMaskVisualization=null,this._lastSize=-1}dispose(){if(this._maskVisualizations){for(const t of this._maskVisualizations.values())t&&t.dispose();this._maskVisualizations=null}this._lastMaskVisualization=null,this._sizes=null}createMaskVisualization(t){if(this._maskVisualizations.get(t))return null;const i=new In;return this._maskVisualizations.set(t,i),this._sizes.push(t),this._sizes.sort(),i}getSizeIndex(t){let e=0,i=1;for(;i<this._sizes.length;){if(this._sizes[i]>t){this._sizes[i]-t<t-this._sizes[i-1]&&(e=i);break}e=i,i++}return e}getMaskVisualization(t){if(t===this._lastSize)return this._lastMaskVisualization;const e=this.getSizeIndex(t);return e<this._sizes.length?this._lastMaskVisualization=this._maskVisualizations.get(this._sizes[e]):this._lastMaskVisualization=null,this._lastSize=t,this._lastMaskVisualization}getGraphicAsset(t,e){const i=this.getMaskVisualization(t);return i?i.getAsset(e):null}getAssetName(t){return this._assetNames&&this._assetNames.get(t)||null}setAssetName(t,e){this._assetNames&&this._assetNames.set(t,e)}}class X9{constructor(){this._assetCollection=null,this._masks=new Map,this._data=null}get data(){return this._data}dispose(){if(this._assetCollection=null,this._data=null,this._masks&&this._masks.size){for(const t of this._masks.values())t&&t.dispose();this._masks.clear()}}initialize(t){this._data=t}initializeAssetCollection(t){this.data&&(this._assetCollection=t,this.parseMasks(this.data,t))}parseMasks(t,e){if(!(!t||!e)&&t.masks&&t.masks.length){let i=0;for(;i<t.masks.length;){const r=t.masks[i];if(r){const n=r.id;if(this._masks.get(n))continue;const o=new W9;if(r.visualizations&&r.visualizations.length){let h=0;for(;h<r.visualizations.length;){const u=r.visualizations[h];if(u){const c=u.size,l=o.createMaskVisualization(c);if(l){const _=this.parseMaskBitmaps(u.bitmaps,l,e);o.setAssetName(c,_)}}h++}}this._masks.set(n,o)}i++}}}parseMaskBitmaps(t,e,i){if(!t||!t.length)return null;let r=null;for(const n of t){if(!n)continue;const a=n.assetName,o=i.getAsset(a);if(!o)continue;let h=In.MIN_NORMAL_COORDINATE_VALUE,u=In.MAX_NORMAL_COORDINATE_VALUE,c=In.MIN_NORMAL_COORDINATE_VALUE,l=In.MAX_NORMAL_COORDINATE_VALUE;n.normalMinX!==void 0&&(h=n.normalMinX),n.normalMaxX!==void 0&&(u=n.normalMaxX),n.normalMinY!==void 0&&(c=n.normalMinY),n.normalMaxY!==void 0&&(l=n.normalMaxY),o.flipH||(r=a),e.addBitmap(o,h,u,c,l)}return r}updateMask(t,e,i,r,n,a){const o=this._masks.get(e);if(!o)return!0;const h=o.getGraphicAsset(i,r);if(!h)return!0;const u=h.texture;if(!u)return!0;const c=new H(n+h.offsetX,a+h.offsetY),l=new wt;let _=1,d=1,g=0,m=0,p=c.x+g,T=c.y+m;return h.flipH&&(_=-1,g=u.width,p=c.x+g-u.width),h.flipV&&(d=-1,m=u.height,T=c.y+m-u.height),l.scale(_,d),l.translate(p,T),Ae.instance.renderer.render(new Wt(u),{renderTexture:t,clear:!1,transform:l}),!0}getMask(t){return!this._masks||!this._masks.size?null:this._masks.get(t)||null}}class Oo{constructor(t=null,e=0,i=!1){this._assetNames=[],this._maskAssetNames=[],this._maskAssetLocations=[],this._maskAssetFlipHs=[],this._maskAssetFlipVs=[],t!=null&&(this._maskAssetNames=t._maskAssetNames,this._maskAssetLocations=t._maskAssetLocations,this._maskAssetFlipHs=t._maskAssetFlipHs,this._maskAssetFlipVs=t._maskAssetFlipVs),this._color=e,this._alignBottom=i}addMask(t,e,i,r){this._maskAssetNames.push(t),this._maskAssetLocations.push(e),this._maskAssetFlipHs.push(i),this._maskAssetFlipVs.push(r)}addAssetColumn(t){this._assetNames.push(t)}set z(t){this._z=t}get z(){return this._z}set cornerPoints(t){this._points=t}get cornerPoints(){return this._points}get color(){return this._color}get maskAssetNames(){return this._maskAssetNames}get maskAssetLocations(){return this._maskAssetLocations}get maskAssetFlipHs(){return this._maskAssetFlipHs}get maskAssetFlipVs(){return this._maskAssetFlipVs}isBottomAligned(){return this._alignBottom}get assetNameColumns(){return this._assetNames}}class K9{constructor(t,e,i,r,n){this._x=t,this._y=e,this._speedX=i,this._speedY=r,this._asset=n,isNaN(this._x)&&(this._x=0),isNaN(this._y)&&(this._y=0),isNaN(this._speedX)&&(this._speedX=0),isNaN(this._speedY)&&(this._speedY=0)}get bitmapData(){return this._asset}dispose(){this._asset=null}getPosition(t,e,i,r,n){let a=this._x,o=this._y;i>0&&(a=a+this._speedX/i*n/1e3),r>0&&(o=o+this._speedY/r*n/1e3);const h=Math.trunc(a%1*t),u=Math.trunc(o%1*e);return new H(h,u)}}const lg=class{constructor(s,t,e,i=0){this._material=s,this._offset=i,this._align=e,this._color=t,this._isDisposed=!1}get offset(){return this._offset}get align(){return this._align}get disposed(){return this._isDisposed}dispose(){this._isDisposed=!0,this._material=null,this.clearCache()}clearCache(){}render(s,t,e,i,r,n,a,o,h){const u=this._color>>16,c=this._color>>8&255,l=this._color&255,_=u<255||c<255||l<255;if(this._material){const d=this._material.render(s,t,_?null:e,i,r,n,a,o,h+this.offset,this.align===lg.ALIGN_TOP);if(d&&_){const g=new Wt(d);_&&(g.tint=this._color),t.writeToRenderTexture(g,e,!1)}}else{const d=t.createAndFillRenderTexture(i,r,s,this._color);t.writeToRenderTexture(new Wt(d),e,!1)}return e}getMaterial(){return this._material}getColor(){return this._color}};let ls=lg;ls.DEFAULT_OFFSET=0;ls.ALIGN_TOP=1;ls.ALIGN_BOTTOM=2;ls.ALIGN_DEFAULT=lg.ALIGN_TOP;class q9{constructor(t,e,i){this._layers=[],this._geometry=i,this._cachedBitmapNormal=new S,this._isCached=!1,this._hasAnimationLayers=!1,e<0&&(e=0);let r=0;for(;r<e;)this._layers.push(null),r++}get geometry(){return this._geometry}get hasAnimationLayers(){return this._hasAnimationLayers}dispose(){if(this._layers&&this._layers.length){for(const t of this._layers)t&&t.dispose();this._layers=null}this._geometry=null,this._cachedBitmapNormal&&(this._cachedBitmapNormal=null)}clearCache(){if(this._isCached){if(this._cachedBitmapNormal&&this._cachedBitmapNormal.assign(new S),this._layers&&this._layers.length)for(const t of this._layers){if(!t)continue;t.clearCache()}this._isCached=!1}}setLayer(t,e,i,r,n=0){if(t<0||t>this._layers.length)return!1;let a=this._layers[t];return a&&a.dispose(),a=new ls(e,i,r,n),this._layers[t]=a,!0}setAnimationLayer(t,e,i){if(t<0||t>this._layers.length)return!1;let r=this._layers[t];return r&&r.dispose(),r=new mp(e,i),this._layers[t]=r,this._hasAnimationLayers=!0,!0}getLayers(){return this._layers}render(t,e,i,r,n,a,o,h=0,u=0,c=0,l=0,_=0,d=0,g=0){r<1&&(r=1),n<1&&(n=1),(!i||i.width!==r||i.height!==n)&&(i=null),this._isCached=!0;const m=e.createAndFillRenderTexture(r,n,t);if(this._cachedBitmapNormal.assign(a),this._layers&&this._layers.length)for(const p of this._layers)p&&(p instanceof ls?p.render(`${t}:${this._layers.indexOf(p)}`,e,m,r,n,a,o,h,u):p instanceof mp&&p.render(e,m,r,n,a,h,u,c,l,_,d,g));return m}}class _g{constructor(){this._planeVisualizations=new Map,this._sizes=[],this._lastPlaneVisualization=null,this._lastSize=-1}isStatic(t){return!0}dispose(){for(const t of this._planeVisualizations.values())t&&t.dispose();this._planeVisualizations=null,this._lastPlaneVisualization=null,this._sizes=null,this._lastSize=-1}clearCache(){for(const t of this._planeVisualizations.values())t&&t.clearCache()}createPlaneVisualization(t,e,i){if(this._planeVisualizations.get(t.toString()))return null;const n=new q9(t,e,i);return this._planeVisualizations.set(t.toString(),n),this._sizes.push(t),this._sizes.sort(),n}getSizeIndex(t){let e=0,i=1;for(;i<this._sizes.length;){if(this._sizes[i]>t){this._sizes[i]-t<t-this._sizes[i-1]&&(e=i);break}e=i,i++}return e}getPlaneVisualization(t){if(t===this._lastSize)return this._lastPlaneVisualization;const e=this.getSizeIndex(t);return e<this._sizes.length?this._lastPlaneVisualization=this._planeVisualizations.get(this._sizes[e].toString()):this._lastPlaneVisualization=null,this._lastSize=t,this._lastPlaneVisualization}getLayers(){return this.getPlaneVisualization(this._lastSize).getLayers()}}class yn extends _g{render(t,e,i,r,n,a,o,h,u,c){const l=this.getPlaneVisualization(a);if(!l||!l.geometry)return null;const _=l.geometry.getScreenPoint(new S(0,0,0)),d=l.geometry.getScreenPoint(new S(0,n/l.geometry.scale,0)),g=l.geometry.getScreenPoint(new S(r/l.geometry.scale,0,0));let m=0,p=0;if(_&&d&&g){r=Math.round(Math.abs(_.x-g.x)),n=Math.round(Math.abs(_.x-d.x));const T=_.x-l.geometry.getScreenPoint(new S(1,0,0)).x;m=u*Math.trunc(Math.abs(T)),p=c*Math.trunc(Math.abs(T))}return l.render(t,e,i,r,n,o,h,m,p)}}yn.DEFAULT_COLOR=16777215;yn.HORIZONTAL_ANGLE_DEFAULT=45;yn.VERTICAL_ANGLE_DEFAULT=30;class fl{constructor(t,e){this._texture=t,this._timeStamp=e}dispose(){this._texture=null}get texture(){return this._texture}get timeStamp(){return this._timeStamp}}const Be=class{constructor(){this._seed=1,this._modulus=16777216,this._multiplier=69069,this._increment=5}static setSeed(s=1){Be._randomizer||(Be._randomizer=new Be),Be._randomizer.seed=s}static setModulus(s=16777216){Be._randomizer||(Be._randomizer=new Be),Be._randomizer.modulus=s}static getValues(s,t,e){return Be._randomizer||(Be._randomizer=new Be),Be._randomizer.getRandomValues(s,t,e)}static getArray(s,t){return Be._randomizer||(Be._randomizer=new Be),Be._randomizer.getRandomArray(s,t)}set seed(s){this._seed=s}set modulus(s){s<1&&(s=1),this._modulus=s}dispose(){}getRandomValues(s,t,e){const i=[];let r=0;for(;r<s;)i.push(this.iterateScaled(t,e-t)),r++;return i}getRandomArray(s,t){if(s>t||t>1e3)return null;const e=[];let i=0;for(;i<=t;)e.push(i),i++;const r=[];let n=0;for(;n<s;){const a=this.iterateScaled(0,e.length-1);r.push(e[a]),e.splice(a,1),n++}return r}iterate(){let s=dv(Math.trunc(this._multiplier*this._seed)+this._increment);return s<0&&(s=-s),s=s%this._modulus,this._seed=s,s}iterateScaled(s,t){let e=this.iterate();return t<1?s:(e=Math.trunc(s+e/this._modulus*t),e)}};let tr=Be;tr.DEFAULT_SEED=1;tr.DEFAULT_MODULUS=16777216;tr._randomizer=null;const cr=class{constructor(s,t,e=1){if(this._cells=[],this._repeatMode=e,this._width=s<1?1:s,this._cachedBitmapData=null,this._cachedBitmapNormal=null,this._cachedBitmapDataOffsetX=0,this._cachedBitmapDataOffsetY=0,this._isCached=!1,this._isStatic=!0,t&&t.length){let i=0;for(;i<t.length;){const r=t[i];r&&(this._cells.push(r),r.isStatic||(this._isStatic=!1)),i++}}}get isStatic(){return this._isStatic}isRepeated(){return this._repeatMode!==cr.REPEAT_MODE_NONE}get width(){return this._width}dispose(){if(this._cells&&this._cells.length){for(const s of this._cells)s&&s.dispose();this._cells=null}this._cachedBitmapData=null,this._cachedBitmapNormal&&(this._cachedBitmapNormal=null)}clearCache(){if(this._isCached){if(this._cachedBitmapData&&(this._cachedBitmapData=null),this._cachedBitmapNormal&&(this._cachedBitmapNormal.x=0,this._cachedBitmapNormal.y=0,this._cachedBitmapNormal.z=0),this._cells&&this._cells.length)for(const s of this._cells)s&&s.clearCache();this._isCached=!1}}render(s,t,e,i,r,n){if(this._repeatMode===cr.REPEAT_MODE_NONE&&(e=this.getCellsHeight(this._cells,i)),this._cachedBitmapNormal||(this._cachedBitmapNormal=new S),this.isStatic){if(this._cachedBitmapData){if(this._cachedBitmapData.height===e&&S.isEqual(this._cachedBitmapNormal,i)&&this._cachedBitmapDataOffsetX===r&&this._cachedBitmapDataOffsetY===n)return this._cachedBitmapData;this._cachedBitmapData=null}}else this._cachedBitmapData=null;if(this._isCached=!0,this._cachedBitmapData||(this._cachedBitmapData=t.createRenderTexture(this._width,e,`${s}:column`)),this._cachedBitmapNormal.assign(i),this._cachedBitmapDataOffsetX=r,this._cachedBitmapDataOffsetY=n,!this._cells.length)return this._cachedBitmapData;switch(this._repeatMode){case cr.REPEAT_MODE_NONE:this.renderRepeatNone(i);break;case cr.REPEAT_MODE_BORDERS:this.renderRepeatBorders(i);break;case cr.REPEAT_MODE_CENTER:this.renderRepeatCenter(i);break;case cr.REPEAT_MODE_FIRST:this.renderRepeatFirst(i);break;case cr.REPEAT_MODE_LAST:this.renderRepeatLast(i);break;default:this.renderRepeatAll(i,r,n);break}return this._cachedBitmapData}getCellsHeight(s,t){if(!s||!s.length)return 0;let e=0,i=0;for(;i<s.length;){const r=s[i];r&&(e+=r.getHeight(t)),i++}return e}renderCells(s,t,e,i,r=0,n=0){if(!s||!s.length||!this._cachedBitmapData)return t;let a=0;for(;a<s.length;){let o=null;if(e?o=s[a]:o=s[s.length-1-a],o){const h=o.render(i,r,n);if(h&&(e||(t-=h.height),h.y=t,qt.writeToRenderTexture(h,this._cachedBitmapData,!1),e&&(t=t+h.height),e&&t>=this._cachedBitmapData.height||!e&&t<=0))return t}a++}return t}renderRepeatNone(s){!this._cells.length||!this._cachedBitmapData||this.renderCells(this._cells,0,!0,s)}renderRepeatAll(s,t,e){if(!this._cells.length||!this._cachedBitmapData)return;let i=0;for(;i<this._cachedBitmapData.height;)if(i=this.renderCells(this._cells,i,!0,s,t,e),!i)return}renderRepeatBorders(s){if(!this._cells.length||!this._cachedBitmapData)return;const t=[];let e=0,i=1;for(;i<this._cells.length-1;){const o=this._cells[i];if(o){const h=o.getHeight(s);h>0&&(e=e+h,t.push(o))}i++}if(this._cells.length==1){const o=this._cells[0];if(o){const h=o.getHeight(s);h>0&&(e=e+h,t.push(o))}}let r=this._cachedBitmapData.height-e>>1,n=this.renderCells(t,r,!0,s),a=this._cells[0];if(a){const o=[a];for(;r>=0;)r=this.renderCells(o,r,!1,s)}if(a=this._cells[this._cells.length-1],a){const o=[a];for(;n<this._cachedBitmapData.height;)n=this.renderCells(o,n,!0,s)}}renderRepeatCenter(s){if(!this._cells.length||!this._cachedBitmapData)return;const t=[],e=[];let i=0,r=0,n=0;for(;n<this._cells.length>>1;){const h=this._cells[n];if(h){const u=h.getHeight(s);u>0&&(i=i+u,t.push(h))}n++}for(n=(this._cells.length>>1)+1;n<this._cells.length;){const h=this._cells[n];if(h){const u=h.getHeight(s);u>0&&(r=r+u,e.push(h))}n++}let a=0,o=this._cachedBitmapData.height;if(i+r>this._cachedBitmapData.height&&(a=i+r-this._cachedBitmapData.height,o=o+(a-(a>>1))),a==0){const h=this._cells[this._cells.length>>1];if(h){const u=h.getHeight(s);if(u>0){const c=this._cachedBitmapData.height-(i+r),l=Math.ceil(c/u)*u;let _=i-(l-c>>1);const d=_+l,g=[h];for(;_<d;)_=this.renderCells(g,_,!0,s)}}}this.renderCells(t,0,!0,s),this.renderCells(e,o,!1,s)}renderRepeatFirst(s){if(!this._cells.length||!this._cachedBitmapData)return;let t=this.renderCells(this._cells,this._cachedBitmapData.height,!1,s);const e=this._cells[0];if(!e)return;const i=[e];for(;t>=0;)t=this.renderCells(i,t,!1,s)}renderRepeatLast(s){if(!this._cells.length||!this._cachedBitmapData)return;let t=this.renderCells(this._cells,0,!0,s);const e=this._cells[this._cells.length-1];if(!e)return;const i=[e];for(;t<this._cachedBitmapData.height;)t=this.renderCells(i,t,!0,s)}getCells(){return this._cells}};let as=cr;as.REPEAT_MODE_NONE=0;as.REPEAT_MODE_ALL=1;as.REPEAT_MODE_BORDERS=2;as.REPEAT_MODE_CENTER=3;as.REPEAT_MODE_FIRST=4;as.REPEAT_MODE_LAST=5;const Je=class{constructor(s,t=1,e=1,i=-1,r=1,n=-1,a=1){this._repeatMode=1,this._align=1,this._cachedBitmapNormal=null,this._cachedBitmapHeight=0,this._isCached=!1,this._isStatic=!0,this._normalMinX=-1,this._normalMaxX=1,this._normalMinY=-1,this._normalMaxY=1,this._columns=[],s<1&&(s=1);let o=0;for(;o<s;)this._columns.push(null),o++;this._repeatMode=t,this._align=e,this._normalMinX=i,this._normalMaxX=r,this._normalMinY=n,this._normalMaxY=a,this._repeatMode===Je.REPEAT_MODE_RANDOM&&(this._isStatic=!1)}static nextRandomColumnIndex(s){return tr.getValues(1,0,s*17631)[0]%s}get normalMinX(){return this._normalMinX}get normalMaxX(){return this._normalMaxX}get normalMinY(){return this._normalMinY}get normalMaxY(){return this._normalMaxY}isBottomAligned(){return this._align===Je.ALIGN_BOTTOM}get isStatic(){return this._isStatic}dispose(){this._cachedBitmapNormal&&(this._cachedBitmapNormal=null)}clearCache(){if(this._isCached){if(this._cachedBitmapNormal&&(this._cachedBitmapNormal.x=0,this._cachedBitmapNormal.y=0,this._cachedBitmapNormal.z=0),this._columns&&this._columns.length)for(const s of this._columns)s&&s.clearCache();this._isCached=!1}}createColumn(s,t,e,i=1){if(s<0||s>=this._columns.length)return!1;const r=new as(t,e,i),n=this._columns[s];return n&&n.dispose(),this._columns[s]=r,r&&!r.isStatic&&(this._isStatic=!1),!0}render(s,t,e,i,r,n,a,o,h,u){if(i<1&&(i=1),r<1&&(r=1),this._cachedBitmapNormal||(this._cachedBitmapNormal=new S),this.isStatic){if(this._cachedBitmapData){if(this._cachedBitmapData.baseTexture&&this._cachedBitmapData.width===i&&this._cachedBitmapData.height===r&&S.isEqual(this._cachedBitmapNormal,n))return e?(this.copyCachedBitmapOnCanvas(e,this._cachedBitmapHeight,h,u),e):this._cachedBitmapData;this._cachedBitmapData=null}}else this._cachedBitmapData=null;if(this._isCached=!0,this._cachedBitmapNormal.assign(n),!a)return this._cachedBitmapHeight=r,this._cachedBitmapData?t.clearAndFillRenderTexture(this._cachedBitmapData):this._cachedBitmapData=t.createAndFillRenderTexture(i,r,`${s}:matrix`),this._cachedBitmapData;this._cachedBitmapData||(this._cachedBitmapHeight=r,this._cachedBitmapData=t.createRenderTexture(i,r,`${s}:matrix`),t.clearRenderTexture(this._cachedBitmapData));const c=[];let l=0;for(;l<this._columns.length;){const d=this._columns[l];if(d){const g=d.render(s,t,r,n,o,h);g&&c.push(g)}l++}if(!c.length)return e||this._cachedBitmapData;let _=0;switch(this._repeatMode){case Je.REPEAT_MODE_BORDERS:Y.log("REPEAT_MODE_BORDERS");break;case Je.REPEAT_MODE_CENTER:Y.log("REPEAT_MODE_CENTER");break;case Je.REPEAT_MODE_FIRST:Y.log("REPEAT_MODE_FIRST");break;case Je.REPEAT_MODE_LAST:Y.log("REPEAT_MODE_LAST");break;case Je.REPEAT_MODE_RANDOM:_=this.renderRepeatRandom(this._cachedBitmapData,c);break;default:_=this.renderRepeatAll(this._cachedBitmapData,c);break}return this._cachedBitmapHeight=_,e?(this.copyCachedBitmapOnCanvas(e,_,h,u),e):this._cachedBitmapData}copyCachedBitmapOnCanvas(s,t,e,i){if(!s||!this._cachedBitmapData||s===this._cachedBitmapData)return;i||(e=s.height-t-e);let r=null;this._align===Je.ALIGN_TOP?r=new et(0,0,this._cachedBitmapData.width,this._cachedBitmapHeight):r=new et(0,this._cachedBitmapData.height-this._cachedBitmapHeight,this._cachedBitmapData.width,this._cachedBitmapHeight);const n=new xe(this._cachedBitmapData.baseTexture,r),a=new Wt(n);a.position.set(0,e),qt.writeToRenderTexture(a,s,!1)}getColumnsWidth(s){if(!s||!s.length)return 0;let t=0;for(const e of s)e&&(t+=e.width);return t}renderColumns(s,t,e,i){if(!s||!t||!t.length)return new H(e,0);let r=0,n=0;for(;n<t.length;){const a=i?t[n]:t[t.length-1-n];if(a){i||(e=e-a.width);let o=0;this._align==Je.ALIGN_BOTTOM&&(o=s.height-a.height);const h=new Wt(a);if(h.position.set(e,o),qt.writeToRenderTexture(h,s,!1),a.height>r&&(r=a.height),i&&(e=e+a.width),i&&e>=s.width||!i&&e<=0)return new H(e,r)}n++}return new H(e,r)}renderRepeatAll(s,t){if(!s||!t||!t.length)return 0;this.getColumnsWidth(t);let e=0,i=0;for(;e<s.width;){const r=this.renderColumns(s,t,e,!0);if(e=r.x,r.y>i&&(i=r.y),!r.x)return i}return i}renderRepeatRandom(s,t){if(!s||!t||!t.length)return 0;let e=0,i=0;for(;i<s.width;){const r=t[Je.nextRandomColumnIndex(t.length)];if(r!=null){const n=this.renderColumns(s,[r],i,!0);i=n.x,n.y>e&&(e=n.y)}else return e}return e}getColumns(s){if(this._repeatMode===Je.REPEAT_MODE_RANDOM){const t=[];let e=0;for(;e<s;){const i=this._columns[Je.nextRandomColumnIndex(this._columns.length)];if(i)if(t.push(i),i.width>1)e+=i.width;else break;else break}return t}return this._columns}};let Xt=Je;Xt.REPEAT_MODE_ALL=1;Xt.REPEAT_MODE_BORDERS=2;Xt.REPEAT_MODE_CENTER=3;Xt.REPEAT_MODE_FIRST=4;Xt.REPEAT_MODE_LAST=5;Xt.REPEAT_MODE_RANDOM=6;Xt.REPEAT_MODE_DEFAULT=Je.REPEAT_MODE_ALL;Xt.MIN_NORMAL_COORDINATE_VALUE=-1;Xt.MAX_NORMAL_COORDINATE_VALUE=1;Xt.ALIGN_TOP=1;Xt.ALIGN_BOTTOM=2;Xt.ALIGN_DEFAULT=Je.ALIGN_TOP;class cg{constructor(){this._planeMaterialItems=[],this._isCached=!1}dispose(){if(this._planeMaterialItems&&this._planeMaterialItems.length){for(const t of this._planeMaterialItems)t&&t.dispose();this._planeMaterialItems=null}this._isCached=!1}clearCache(){if(this._isCached){if(this._planeMaterialItems&&this._planeMaterialItems.length)for(const t of this._planeMaterialItems)t&&t.clearCache();this._isCached=!1}}addMaterialCellMatrix(t,e,i,r=-1,n=1,a=-1,o=1){const h=new Xt(t,e,i,r,n,a,o);return this._planeMaterialItems.push(h),h}getMaterialCellMatrix(t){if(!t)return null;if(this._planeMaterialItems&&this._planeMaterialItems.length){for(const e of this._planeMaterialItems)if(e&&t.x>=e.normalMinX&&t.x<=e.normalMaxX&&t.y>=e.normalMinY&&t.y<=e.normalMaxY)return e}return null}render(t,e,i,r,n,a,o,h,u,c){r<1&&(r=1),n<1&&(n=1);const l=this.getMaterialCellMatrix(a);return l?(this._isCached=!0,l.render(t,e,i,r,n,a,o,h,u,c)):null}}cg.MIN_NORMAL_COORDINATE_VALUE=-1;cg.MAX_NORMAL_COORDINATE_VALUE=1;class Z9{constructor(t,e=null,i=null,r=0){if(this._extraItemCount=0,this._texture=t,this._extraItemOffsets=[],this._extraItemAssets=[],this._extraItemCount=0,e&&e.length&&r>0){let n=0;for(;n<e.length;){const a=e[n];a&&this._extraItemAssets.push(a),n++}if(this._extraItemAssets.length){if(i){let a=0;for(;a<i.length;){const o=i[a];o&&this._extraItemOffsets.push(new H(o.x,o.y)),a++}}this._extraItemCount=r}}}get isStatic(){return this._extraItemCount===0}dispose(){this._texture&&(this._texture.dispose(),this._texture=null),this._extraItemAssets=null,this._extraItemOffsets=null,this._extraItemCount=0}clearCache(){}getHeight(t){if(this._texture){const e=this._texture.getBitmap(t);if(e)return e.height}return 0}render(t,e,i){if(!this._texture)return null;const r=this._texture.getBitmap(t);if(!r)return null;const n=new XK(r,r.width,r.height);if(e!==0||i!==0){for(;e<0;)e+=r.width;for(;i<0;)i+=r.height;n.tilePosition.set(e%r.width,i%r.height),n.uvRespectAnchor=!0,e&&(n.anchor.x=1,n.scale.x=-1),i&&(n.anchor.y=1,n.scale.y=-1)}if(!this.isStatic){const a=Math.min(this._extraItemCount,this._extraItemOffsets.length),o=Math.max(this._extraItemCount,this._extraItemOffsets.length),h=tr.getArray(this._extraItemCount,o);let u=0;for(;u<a;){const c=this._extraItemOffsets[h[u]],l=this._extraItemAssets[u%this._extraItemAssets.length];if(c&&l){const _=l.texture;if(_){let d=l.offsetX,g=l.offsetY,m=1,p=1,T=0,A=0;l.flipH&&(m=-1,T=_.width,d=-(l.width+l.x)),l.flipV&&(p=-1,A=_.height,g=-(l.height+l.y));const O=new H(c.x+d,c.y+g),v=new wt;let y=O.x+T;y=y>>1<<1,v.scale(m,p),v.translate(y,O.y+A);const C=new Wt(_);C.transform.setFromMatrix(v),n.addChild(C)}}u++}}return n}getAssetName(t){return this._texture==null?null:this._texture.getAssetName(t)}}class dg{constructor(t,e=-1,i=1,r=-1,n=1,a=null){this._bitmap=t,this._normalMinX=e,this._normalMaxX=i,this._normalMinY=r,this._normalMaxY=n,this._assetName=a}get bitmap(){return this._bitmap}get normalMinX(){return this._normalMinX}get normalMaxX(){return this._normalMaxX}get normalMinY(){return this._normalMinY}get normalMaxY(){return this._normalMaxY}get assetName(){return this._assetName}dispose(){this._bitmap=null}}dg.MIN_NORMAL_COORDINATE_VALUE=-1;dg.MAX_NORMAL_COORDINATE_VALUE=1;class cn{constructor(){this._bitmaps=[]}dispose(){if(this._bitmaps){for(const t of this._bitmaps)t&&t.dispose();this._bitmaps=null}}addBitmap(t,e=-1,i=1,r=-1,n=1,a=null){this._bitmaps.push(new dg(t,e,i,r,n,a))}getBitmap(t){const e=this.getPlaneTextureBitmap(t);return e?e.bitmap:null}getPlaneTextureBitmap(t){if(!t)return null;for(const e of this._bitmaps)if(e&&t.x>=e.normalMinX&&t.x<=e.normalMaxX&&t.y>=e.normalMinY&&t.y<=e.normalMaxY)return e;return null}getAssetName(t){const e=this.getPlaneTextureBitmap(t);return e?e.assetName:null}}cn.MIN_NORMAL_COORDINATE_VALUE=-1;cn.MAX_NORMAL_COORDINATE_VALUE=1;const sv=class{constructor(){this._assetCollection=null,this._textures=new Map,this._materials=new Map,this._planes=new Map,this._geometries=new Map,this._data=null}get data(){return this._data}get assetCollection(){return this._assetCollection}initializeDimensions(s,t){return!0}dispose(){if(this._planes){for(const s of this._planes.values())s&&s.dispose();this._planes=null}if(this._materials&&(this.resetMaterials(),this._materials=null),this._textures&&(this.resetTextures(),this._textures=null),this._geometries){for(const s of this._geometries.values())s&&s.dispose();this._geometries=null}this._data=null,this._assetCollection=null}clearCache(){for(const s of this._planes.values())s&&s.clearCache();for(const s of this._materials.values())s&&s.clearCache()}initialize(s){this._data=s}reinitialize(){this.resetTextures(),this.resetMaterials(),this.initializeAll()}resetMaterials(){for(const s of this._materials.values())s&&s.dispose();this._materials.clear()}resetTextures(){for(const s of this._textures.values())s&&s.dispose();this._textures.clear()}getTexture(s){return this._textures.get(s)}getMaterial(s){return this._materials.get(s)}getPlane(s){return this._planes.get(s)}addPlane(s,t){return t?this._planes.get(s)?!1:(this._planes.set(s,t),!0):!1}initializeAssetCollection(s){this._data&&(this._assetCollection=s,this.initializeAll())}initializeAll(){this._data&&(this.initializeTexturesAndMaterials(),this.initializePlanes())}initializeTexturesAndMaterials(){this._data.textures&&this._data.textures.length&&this.parseTextures(this._data.textures,this.assetCollection),this._data.materials&&this._data.materials.length&&this.parsePlaneMaterials(this._data.materials)}initializePlanes(){}parseTextures(s,t){if(!(!s||!t)&&s.length)for(const e of s){if(!e)continue;const i=e.id;if(!this._textures.get(i)){const r=new cn;if(e.bitmaps&&e.bitmaps.length)for(const n of e.bitmaps){if(!n)continue;const a=n.assetName;let o=cn.MIN_NORMAL_COORDINATE_VALUE,h=cn.MAX_NORMAL_COORDINATE_VALUE,u=cn.MIN_NORMAL_COORDINATE_VALUE,c=cn.MAX_NORMAL_COORDINATE_VALUE;n.normalMinX!==void 0&&(o=n.normalMinX),n.normalMaxX!==void 0&&(h=n.normalMaxX),n.normalMinY!==void 0&&(u=n.normalMinY),n.normalMaxY!==void 0&&(c=n.normalMaxY);const l=t.getAsset(a);if(l){const _=l.texture;if(_){let d=_;l.flipH?d=tL.getFlipHBitmapData(_):d=d.clone(),r.addBitmap(d,o,h,u,c,a)}}}this._textures.set(i,r)}}}parsePlaneMaterials(s){if(!(!s||!s.length))for(const t of s){if(!t)continue;const e=t.id,i=new cg;if(t.matrices&&t.matrices.length)for(const r of t.matrices){if(!r)continue;let n=Xt.REPEAT_MODE_DEFAULT,a=Xt.ALIGN_DEFAULT,o=Xt.MIN_NORMAL_COORDINATE_VALUE,h=Xt.MAX_NORMAL_COORDINATE_VALUE,u=Xt.MIN_NORMAL_COORDINATE_VALUE,c=Xt.MAX_NORMAL_COORDINATE_VALUE;switch(r.normalMinX!==void 0&&(o=r.normalMinX),r.normalMaxX!==void 0&&(h=r.normalMaxX),r.normalMinY!==void 0&&(u=r.normalMinY),r.normalMaxY!==void 0&&(c=r.normalMaxY),r.repeatMode){case"borders":n=Xt.REPEAT_MODE_BORDERS;break;case"center":n=Xt.REPEAT_MODE_CENTER;break;case"first":n=Xt.REPEAT_MODE_FIRST;break;case"last":n=Xt.REPEAT_MODE_LAST;break;case"random":n=Xt.REPEAT_MODE_RANDOM;break;default:n=Xt.REPEAT_MODE_DEFAULT;break}switch(r.align){case"top":a=Xt.ALIGN_TOP;break;case"bottom":a=Xt.ALIGN_BOTTOM;break;default:a=Xt.ALIGN_DEFAULT;break}if(r.columns&&r.columns.length){const l=i.addMaterialCellMatrix(r.columns.length,n,a,o,h,u,c);let _=0;for(;_<r.columns.length;){const d=r.columns[_];d&&this.parsePlaneMaterialCellColumn(d,l,_),_++}}}this._materials.set(e,i)}}parsePlaneMaterialCellColumn(s,t,e){if(!s||!t)return;let i=as.REPEAT_MODE_ALL;const r=s.width,n=this.parsePlaneMaterialCells(s);switch(s.repeatMode){case"borders":i=as.REPEAT_MODE_BORDERS;break;case"center":i=as.REPEAT_MODE_CENTER;break;case"first":i=as.REPEAT_MODE_FIRST;break;case"last":i=as.REPEAT_MODE_LAST;break;case"none":i=as.REPEAT_MODE_NONE;break;default:i=as.REPEAT_MODE_ALL;break}t.createColumn(e,r,n,i)}parsePlaneMaterialCells(s){if(!s||!s.cells||!s.cells.length)return null;const t=[];let e=0;for(;e<s.cells.length;){const i=s.cells[e];if(i){const r=i.textureId;let n=null,a=null,o=null,h=0;if(i.extraData){const l=i.extraData.extraItemTypes,_=i.extraData.offsets;l&&_&&l.length&&_.length&&(n=this.parseExtraItemTypes(l),a=this.parseExtraItemOffsets(_),h=a.length,i.extraData.limitMax!==void 0&&(h=i.extraData.limitMax))}if(n&&n.length){o=[];for(const l of n){if(!l)continue;const _=this._assetCollection.getAsset(l);_&&o.push(_)}}const u=this.getTexture(r),c=new Z9(u,o,a,h);t.push(c)}e++}return!t||!t.length?null:t}parseExtraItemTypes(s){const t=[];if(s&&s.length){let e=0;for(;e<s.length;){const i=s[e];i&&t.push(i),e++}}return t}parseExtraItemOffsets(s){const t=[];if(s&&s.length){let e=0;for(;e<s.length;){const[i,r]=s[e];t.push(new H(i,r)),e++}}return t}getGeometry(s,t,e){t=Math.abs(t),t>90&&(t=90),e=Math.abs(e),e>90&&(e=90);const i=`${s}_${Math.round(t)}_${Math.round(e)}`;let r=this._geometries.get(i);return r||(r=new bn(s,new S(t,e),new S(-10,0,0)),this._geometries.set(i,r),r)}parseVisualizations(s,t){if(!(!s||!t)&&t&&t.length)for(const e of t){if(!e)continue;const i=e.size;let r=yn.HORIZONTAL_ANGLE_DEFAULT,n=yn.VERTICAL_ANGLE_DEFAULT;e.horizontalAngle!==void 0&&(r=e.horizontalAngle),e.verticalAngle!==void 0&&(n=e.verticalAngle);const a=e.allLayers,o=s.createPlaneVisualization(i,a&&a.length||0,this.getGeometry(i,r,n));if(o&&a&&a.length){let h=0;for(;h<a.length;){const u=a[h];if(u){let c=null,l=ls.ALIGN_DEFAULT,_=yn.DEFAULT_COLOR,d=ls.DEFAULT_OFFSET;u.materialId&&(c=this.getMaterial(u.materialId)),u.color&&(_=u.color),u.offset&&(d=u.offset),u.align&&(u.align==="bottom"?l=ls.ALIGN_BOTTOM:u.align=="top"&&(l=ls.ALIGN_TOP)),o.setLayer(h,c,_,l,d)}h++}}}}render(s,t,e,i,r,n,a,o,h,u=0,c=0,l=0,_=0,d=0){return null}getTextureIdentifier(s,t){return s.toString()}getLayers(s){let t=this.getPlane(s);return t||(t=this.getPlane(sv.DEFAULT)),t.getLayers()}};let La=sv;La.DEFAULT="default";class Q9 extends La{initializePlanes(){if(!this.data)return;const t=this.data.planes;t&&t.length&&this.parseFloors(t)}parseFloors(t){if(t)for(const e in t){const i=t[e];if(!i)continue;const r=i.id,n=i.visualizations,a=new yn;this.parseVisualizations(a,n),this.addPlane(r,a)||a.dispose()}}render(t,e,i,r,n,a,o,h,u,c=0,l=0,_=0,d=0,g=0){let m=this.getPlane(r);if(m||(m=this.getPlane(La.DEFAULT)),!m)return null;i&&e.clearAndFillRenderTexture(i);let p=m.render(t,e,i,n,a,o,h,u,c,l);return p&&p!==i&&(p=new xe(p.baseTexture),!p)?null:new fl(p,-1)}}class r_ extends _g{render(t,e,i,r,n,a,o,h){const u=this.getPlaneVisualization(a);if(!u||!u.geometry)return null;const c=u.geometry.getScreenPoint(new S(0,0,0)),l=u.geometry.getScreenPoint(new S(0,0,n/u.geometry.scale)),_=u.geometry.getScreenPoint(new S(0,r/u.geometry.scale,0));return c&&l&&_&&(r=Math.round(Math.abs(c.x-_.x)),n=Math.round(Math.abs(c.y-l.y))),u.render(t,e,i,r,n,o,h)}}r_.DEFAULT_COLOR=16777215;r_.HORIZONTAL_ANGLE_DEFAULT=45;r_.VERTICAL_ANGLE_DEFAULT=30;class J9 extends La{initializePlanes(){if(!this.data)return;const t=this.data.planes;t&&t.length&&this.parseWalls(t)}parseWalls(t){if(t)for(const e in t){const i=t[e];if(!i)continue;const r=i.id,n=i.visualizations,a=new r_;this.parseVisualizations(a,n),this.addPlane(r,a)||a.dispose()}}render(t,e,i,r,n,a,o,h,u,c=0,l=0,_=0,d=0,g=0){let m=this.getPlane(r);if(m||(m=this.getPlane(La.DEFAULT)),!m)return null;i&&e.clearAndFillRenderTexture(i);let p=m.render(t,e,i,n,a,o,h,u);return p&&p!==i&&(p=new xe(p.baseTexture),!p)?null:new fl(p,-1)}getTextureIdentifier(t,e){return e?`${t}_${e.x}_${e.y}_${e.z}`:super.getTextureIdentifier(t,e)}}class Tn extends _g{constructor(){super(...arguments),this._width=0,this._height=0}isStatic(t){const e=this.getPlaneVisualization(t);return e?!e.hasAnimationLayers:super.isStatic(t)}initializeDimensions(t,e){t<0&&(t=0),e<0&&(e=0),(t!==this._width||e!==this._height)&&(this._width=t,this._height=e)}render(t,e,i,r,n,a,o,h,u,c,l,_,d){const g=this.getPlaneVisualization(a);if(!g||!g.geometry)return null;const m=g.geometry.getScreenPoint(new S(0,0,0)),p=g.geometry.getScreenPoint(new S(0,0,1)),T=g.geometry.getScreenPoint(new S(0,1,0));if(m&&p&&T){r=Math.round(Math.abs((m.x-T.x)*r/g.geometry.scale)),n=Math.round(Math.abs((m.y-p.y)*n/g.geometry.scale));const A=Math.trunc(u*Math.abs(m.x-T.x)),O=Math.trunc(c*Math.abs(m.y-p.y)),v=Math.trunc(l*Math.abs(m.x-T.x)),y=Math.trunc(_*Math.abs(m.y-p.y));return g.render(t,e,i,r,n,o,h,A,O,v,y,l,_,d)}return null}}Tn.DEFAULT_COLOR=16777215;Tn.HORIZONTAL_ANGLE_DEFAULT=45;Tn.VERTICAL_ANGLE_DEFAULT=30;const ia=class extends La{constructor(){super(...arguments),this._landscapeWidth=0,this._landscapeHeight=0,this._cachedBitmap=null}initializeDimensions(s,t){return s<0&&(s=0),t<0&&(t=0),this._landscapeWidth=s,this._landscapeHeight=t,!0}initializePlanes(){if(!this.data)return;const s=this.data.planes;s&&s.length&&this.parseLandscapes(s)}parseLandscapes(s){if(!s)return;const t=Math.trunc(Math.random()*654321);for(const e in s){const i=s[e];if(!i)continue;const r=i.id,n=i.animatedVisualization,a=new Tn;for(const o of n){if(!o)continue;const h=o.size;let u=Tn.HORIZONTAL_ANGLE_DEFAULT,c=Tn.VERTICAL_ANGLE_DEFAULT;o.horizontalAngle!==void 0&&(u=o.horizontalAngle),o.verticalAngle!==void 0&&(c=o.verticalAngle);const l=o.allLayers.length??0,_=a.createPlaneVisualization(h,l||0,this.getGeometry(h,u,c));if(_){tr.setSeed(t);let d=0;for(;d<l;){const g=o.allLayers[d];if(g){if(g.items===void 0){const m=g;let p=null,T=ls.ALIGN_DEFAULT,A=Tn.DEFAULT_COLOR,O=ls.DEFAULT_OFFSET;m.materialId&&(p=this.getMaterial(m.materialId)),m.color&&(A=m.color),m.offset&&(O=m.offset),m.align&&(m.align==="bottom"?T=ls.ALIGN_BOTTOM:m.align==="top"&&(T=ls.ALIGN_TOP)),_.setLayer(d,p,A,T,O)}else{const p=g.items,T=[];if(p&&p.length){for(const A of p)if(A){A.id;const O=A.assetId,v=this.getCoordinateValue(A.x||"",A.randomX||""),y=this.getCoordinateValue(A.y||"",A.randomY||""),C=A.speedX,N=A.speedY;T.push({asset:O,x:v,y,speedX:C,speedY:N})}}_.setAnimationLayer(d,T,this.assetCollection)}d++}}}}this.addPlane(r,a)||a.dispose()}}getCoordinateValue(s,t){let e=0;if(s.length>0&&s.charAt(s.length-1)==="%"&&(s=s.substr(0,s.length-1),e=parseFloat(s)/100),t.length>0){const n=tr.getValues(1,0,1e4)[0]/1e4;t.charAt(t.length-1)==="%"&&(t=t.substr(0,t.length-1),e=e+n*parseFloat(t)/100)}return e}render(s,t,e,i,r,n,a,o,h,u=0,c=0,l=0,_=0,d=0){let g=this.getPlane(i);if(g||(g=this.getPlane(ia.DEFAULT)),!g)return null;e&&t.clearRenderTexture(e);let m=g.render(s,t,e,r,n,a,o,h,u,c,l,_,d);if(m&&m!==e&&(m=new xe(m.baseTexture),!m))return null;let p=null;return!g.isStatic(a)&&ia.UPDATE_INTERVAL>0?p=new fl(m,Math.round(d/ia.UPDATE_INTERVAL)*ia.UPDATE_INTERVAL+ia.UPDATE_INTERVAL):p=new fl(m,-1),p}getTextureIdentifier(s,t){return t?t.x<0?s+"_0":s+"_1":super.getTextureIdentifier(s,t)}};let xh=ia;xh.LANDSCAPES_ENABLED=!0;xh.LANDSCAPE_DEFAULT_COLOR=8828617;xh.UPDATE_INTERVAL=500;class mp{constructor(t,e){if(this._color=0,this._isDisposed=!1,this._color=0,this._isDisposed=!1,this._items=[],t&&e)for(const i of t){if(!i)continue;const r=i.asset;if(r){const n=e.getAsset(r);n&&this._items.push(new K9(i.x,i.y,i.speedX,i.speedY,n))}}}get disposed(){return this._isDisposed}dispose(){if(this._isDisposed=!0,this._items){for(const t of this._items)t&&t.dispose();this._items=[]}}clearCache(){}render(t,e,i,r,n,a,o,h,u,c,l,_){if(h>0&&u>0){let d=0;for(;d<this._items.length;){const g=this._items[d];if(g){const m=g.getPosition(h,u,c,l,_);if(m.x=Math.trunc(m.x-a),m.y=Math.trunc(m.y-o),g.bitmapData){if(m.x>-g.bitmapData.width&&m.x<e.width&&m.y>-g.bitmapData.height&&m.y<e.height){const p=new Wt(g.bitmapData.texture);p.position.set(m.x,m.y),t.writeToRenderTexture(p,e,!1)}if(m.x-h>-g.bitmapData.width&&m.x-h<e.width&&m.y>-g.bitmapData.height&&m.y<e.height){const p=new Wt(g.bitmapData.texture);p.position.set(m.x-h,m.y),t.writeToRenderTexture(p,e,!1)}if(m.x>-g.bitmapData.width&&m.x<e.width&&m.y-u>-g.bitmapData.height&&m.y-u<e.height){const p=new Wt(g.bitmapData.texture);p.position.set(m.x,m.y-u),t.writeToRenderTexture(p,e,!1)}if(m.x-h>-g.bitmapData.width&&m.x-h<e.width&&m.y-u>-g.bitmapData.height&&m.y-u<e.height){const p=new Wt(g.bitmapData.texture);p.position.set(m.x-h,m.y-u),t.writeToRenderTexture(p,e,!1)}}}d++}}return e}}class Ip{constructor(t,e,i){this._type=t,this._leftSideLoc=e,this._rightSideLoc=i}get type(){return this._type}get leftSideLoc(){return this._leftSideLoc}get rightSideLoc(){return this._rightSideLoc}}class Tp{constructor(t,e,i,r){this._leftSideLoc=t,this._rightSideLoc=e,this._leftSideLength=i,this._rightSideLength=r}get leftSideLoc(){return this._leftSideLoc}get rightSideLoc(){return this._rightSideLoc}get leftSideLength(){return this._leftSideLength}get rightSideLength(){return this._rightSideLength}}const dr=class{constructor(s,t,e,i,r,n,a,o,h,u=0,c=0,l=0,_=0){if(this._maskManager=null,this._width=0,this._height=0,this._textureCache=s,this._secondaryNormals=[],this._bitmapMasks=[],this._rectangleMasks=[],this._bitmapMasksOld=[],this._rectangleMasksOld=[],this._randomSeed=h,this._bitmapData=null,this._maskBitmapData=null,this._maskChanged=!1,this._activeTexture=null,this._origin=new S,this._origin.assign(t),this._location=new S,this._location.assign(e),this._leftSide=new S,this._leftSide.assign(i),this._rightSide=new S,this._rightSide.assign(r),this._normal=S.crossProduct(this._leftSide,this._rightSide),this._normal.length>0&&this._normal.multiply(1/this._normal.length),o!=null)for(const d of o){if(!d)continue;const g=new S;g.assign(d),this._secondaryNormals.push(g)}this._disposed=!1,this._isVisible=!1,this._id=null,this._hasTexture=!0,this._geometryUpdateId=-1,this._offset=new H,this._relativeDepth=0,this._type=n,this._color=0,this._rasterizer=null,this._canBeVisible=!0,this._cornerA=new S,this._cornerB=new S,this._cornerC=new S,this._cornerD=new S,this._width=0,this._height=0,this._textureOffsetX=u,this._textureOffsetY=c,this._textureMaxX=l,this._textureMaxY=_,this._useMask=a,this._uniqueId=++dr._uniqueIdCounter}static blend(s,t){return Zu.colorize(t,s|4278190080)&16777215}set canBeVisible(s){s!==this._canBeVisible&&(this._canBeVisible||this.resetTextureCache(),this._canBeVisible=s)}get canBeVisible(){return this._canBeVisible}get bitmapData(){return!this.visible||!this._bitmapData?null:this._bitmapData}get maskBitmapData(){return!this.visible||!this._maskBitmapData?null:this._maskBitmapData}get visible(){return this._isVisible&&this._canBeVisible}get offset(){return this._offset}get relativeDepth(){return this._relativeDepth}get color(){return this._color}set color(s){this._color=s}get type(){return this._type}get leftSide(){return this._leftSide}get rightSide(){return this._rightSide}get location(){return this._location}get normal(){return this._normal}get hasTexture(){return this._hasTexture}set hasTexture(s){this._hasTexture=s}set rasterizer(s){this._rasterizer=s}set maskManager(s){this._maskManager=s}set id(s){s!==this._id&&(this.resetTextureCache(),this._id=s)}get uniqueId(){return this._uniqueId}dispose(){this._activeTexture=null,this._location=null,this._origin=null,this._leftSide=null,this._rightSide=null,this._normal=null,this._rasterizer=null,this._cornerA=null,this._cornerB=null,this._cornerC=null,this._cornerD=null,this._bitmapMasks=null,this._rectangleMasks=null,this._maskPixels=null,this._maskBitmapData&&(this._maskBitmapData.destroy(!0),this._maskBitmapData=null),this._disposed=!0}copyBitmapData(s){return!this.visible||!this._bitmapData||!s||this._bitmapData.width!==s.width||this._bitmapData.height!==s.height?null:s}resetTextureCache(s=null){this._activeTexture=null}getTextureIdentifier(s){return this._rasterizer?this._rasterizer.getTextureIdentifier(s,this.normal):s.toString()}needsNewTexture(s,t){if(!s)return!1;const e=this._activeTexture;return this.updateMaskChangeStatus(),!!(this._canBeVisible&&(!e||e.timeStamp>=0&&t>e.timeStamp||this._maskChanged))}getTexture(s,t){if(!s)return null;let e=null;if(this.needsNewTexture(s,t)){this.getTextureIdentifier(s.scale);const i=this._leftSide.length*s.scale,r=this._rightSide.length*s.scale,n=s.getCoordinatePosition(this._normal);e=this._rasterizer.render(this._uniqueId.toString(),this._textureCache,null,this._id,i,r,s.scale,n,this._hasTexture,this._textureOffsetX,this._textureOffsetY,this._textureMaxX,this._textureMaxY,t),e&&this.updateMask(e.texture,s)}else this._activeTexture&&(e=this._activeTexture);return e?(this._activeTexture=e,e.texture):null}resolveMasks(s){if(!this._useMask)return null;const t=new Oo,e=0;for(;e<this._bitmapMasks.length;){const i=this._bitmapMasks[e];if(i){const r=this._maskManager.getMask(i.type);if(r){const n=r.getAssetName(s.scale);if(n){const a=s.getCoordinatePosition(this._normal),o=r.getGraphicAsset(s.scale,a);if(o){const h=this._maskBitmapData.width*(1-i.leftSideLoc/this._leftSide.length),u=this._maskBitmapData.height*(1-i.rightSideLoc/this._rightSide.length);t.addMask(n,new H(h+o.offsetX,u+o.offsetY),o.flipH,o.flipV)}}}}}return t}screenWidth(s){const t=s.getScreenPoint(new S(0,0,0)),e=s.getScreenPoint(new S(0,1,0));return Math.round(this._leftSide.length*Math.abs(t.x-e.x))}getDrawingDatas(s){const t=[];if(this._isVisible){const e=this.resolveMasks(s),i=this._rasterizer.getLayers(this._id);for(const r of i)if(this._hasTexture&&r.getMaterial()){const n=s.getCoordinatePosition(this._normal),a=r.getMaterial().getMaterialCellMatrix(n),o=new Oo(e,dr.blend(this._color,r.getColor()),a.isBottomAligned());tr.setSeed(this._randomSeed);for(const h of a.getColumns(this.screenWidth(s))){const u=[];for(const c of h.getCells()){const l=c.getAssetName(n);l&&u.push(l)}u.length>0&&(h.isRepeated()||u.push(""),o.addAssetColumn(u))}o.assetNameColumns.length>0&&t.push(o)}else{const n=new Oo(e,dr.blend(this._color,r.getColor()));t.push(n)}t.length||t.push(new Oo(e,this._color))}return t}update(s,t){if(!s||this._disposed)return!1;let e=!1;if(this._geometryUpdateId!=s.updateId&&(e=!0),(!e||!this._canBeVisible)&&!this.visible)return!1;if(e){this._activeTexture=null;let i=0;if(i=S.cosAngle(s.directionAxis,this.normal),i>-.001)return this._isVisible?(this._isVisible=!1,!0):!1;let r=0;for(;r<this._secondaryNormals.length;){if(i=S.cosAngle(s.directionAxis,this._secondaryNormals[r]),i>-.001)return this._isVisible?(this._isVisible=!1,!0):!1;r++}this.updateCorners(s);const a=s.getScreenPosition(this._origin).z;let o=Math.max(this._cornerA.z,this._cornerB.z,this._cornerC.z,this._cornerD.z)-a;this._type===dr.TYPE_FLOOR&&(o=o-(this._location.z+Math.min(0,this._leftSide.z,this._rightSide.z))*8),this._type===dr.TYPE_LANDSCAPE&&(o=o+.02),this._relativeDepth=o,this._isVisible=!0,this._geometryUpdateId=s.updateId}if(e||this.needsNewTexture(s,t)){if(!this._bitmapData||this._width!==this._bitmapData.width||this._height!==this._bitmapData.height){if(this._bitmapData)if(this._width!==this._bitmapData.width||this._height!==this._bitmapData.height){if(this._bitmapData.destroy(),this._bitmapData=null,this._width<1||this._height<1)return!0;this._bitmapData=this._textureCache.createAndFillRenderTexture(this._width,this._height)}else{if(this._width<1||this._height<1)return this._bitmapData.destroy(),this._bitmapData=null,!0;this._textureCache.clearAndFillRenderTexture(this._bitmapData)}else{if(this._width<1||this._height<1)return!1;this._bitmapData=this._textureCache.createAndFillRenderTexture(this._width,this._height)}if(!this._bitmapData)return!1}else this._textureCache.clearAndFillRenderTexture(this._bitmapData);tr.setSeed(this._randomSeed);const i=this.getTexture(s,t);if(i)this.renderTexture(s,i);else return this.dispose(),!1;return i!==null||e}return!1}updateCorners(s){this._cornerA.assign(s.getScreenPosition(this._location)),this._cornerB.assign(s.getScreenPosition(S.sum(this._location,this._rightSide))),this._cornerC.assign(s.getScreenPosition(S.sum(S.sum(this._location,this._leftSide),this._rightSide))),this._cornerD.assign(s.getScreenPosition(S.sum(this._location,this._leftSide))),this._offset=s.getScreenPoint(this._origin),this._cornerA.x=Math.round(this._cornerA.x),this._cornerA.y=Math.round(this._cornerA.y),this._cornerB.x=Math.round(this._cornerB.x),this._cornerB.y=Math.round(this._cornerB.y),this._cornerC.x=Math.round(this._cornerC.x),this._cornerC.y=Math.round(this._cornerC.y),this._cornerD.x=Math.round(this._cornerD.x),this._cornerD.y=Math.round(this._cornerD.y),this._offset.x=Math.round(this._offset.x),this._offset.y=Math.round(this._offset.y);const t=Math.min(this._cornerA.x,this._cornerB.x,this._cornerC.x,this._cornerD.x),e=Math.max(this._cornerA.x,this._cornerB.x,this._cornerC.x,this._cornerD.x)-t,i=Math.min(this._cornerA.y,this._cornerB.y,this._cornerC.y,this._cornerD.y),r=Math.max(this._cornerA.y,this._cornerB.y,this._cornerC.y,this._cornerD.y)-i;this._offset.x=this._offset.x-t,this._cornerA.x=this._cornerA.x-t,this._cornerB.x=this._cornerB.x-t,this._cornerC.x=this._cornerC.x-t,this._cornerD.x=this._cornerD.x-t,this._offset.y=this._offset.y-i,this._cornerA.y=this._cornerA.y-i,this._cornerB.y=this._cornerB.y-i,this._cornerC.y=this._cornerC.y-i,this._cornerD.y=this._cornerD.y-i,this._width=e,this._height=r}getMatrixForDimensions(s,t){let e=this._cornerD.x-this._cornerC.x,i=this._cornerD.y-this._cornerC.y,r=this._cornerB.x-this._cornerC.x,n=this._cornerB.y-this._cornerC.y;(this._type===dr.TYPE_WALL||this._type===dr.TYPE_LANDSCAPE)&&(Math.abs(r-s)<=1&&(r=s),Math.abs(n-s)<=1&&(n=s),Math.abs(e-t)<=1&&(e=t),Math.abs(i-t)<=1&&(i=t));const a=r/s,o=n/s,h=e/t,u=i/t,c=new wt(a,o,h,u);return c.translate(this._cornerC.x,this._cornerC.y),c}renderTexture(s,t){this._cornerA==null||this._cornerB==null||this._cornerC==null||this._cornerD==null||t==null||this._bitmapData==null||this.draw(t,this.getMatrixForDimensions(t.width,t.height))}draw(s,t){this._textureCache.writeToRenderTexture(new Wt(s),this._bitmapData,!0,t)}resetBitmapMasks(){this._disposed||!this._useMask||!this._bitmapMasks.length||(this._maskChanged=!0,this._bitmapMasks=[])}addBitmapMask(s,t,e){if(!this._useMask)return!1;for(const r of this._bitmapMasks)if(r&&r.type===s&&r.leftSideLoc===t&&r.rightSideLoc===e)return!1;const i=new Ip(s,t,e);return this._bitmapMasks.push(i),this._maskChanged=!0,!0}resetRectangleMasks(){!this._useMask||!this._rectangleMasks.length||(this._maskChanged=!0,this._rectangleMasks=[])}addRectangleMask(s,t,e,i){if(this._useMask){for(const n of this._rectangleMasks)if(n&&n.leftSideLoc===s&&n.rightSideLoc===t&&n.leftSideLength===e&&n.rightSideLength===i)return!1;const r=new Tp(s,t,e,i);return this._rectangleMasks.push(r),this._maskChanged=!0,!0}return!1}updateMaskChangeStatus(){if(!this._maskChanged)return;let s=!0;if(this._bitmapMasks.length===this._bitmapMasksOld.length)for(const t of this._bitmapMasks){if(!t)continue;let e=!1;for(const i of this._bitmapMasksOld)if(i&&i.type===t.type&&i.leftSideLoc===t.leftSideLoc&&i.rightSideLoc===t.rightSideLoc){e=!0;break}if(!e){s=!1;break}}else s=!1;this._rectangleMasks.length>this._rectangleMasksOld.length&&(s=!1),s&&(this._maskChanged=!1)}updateMask(s,t){if(!s||!t||!this._useMask||!this._bitmapMasks.length&&!this._rectangleMasks.length&&!this._maskChanged||!this._maskManager)return;const e=s.width,i=s.height;if(this.updateMaskChangeStatus(),(!this._maskBitmapData||this._maskBitmapData.width!==e||this._maskBitmapData.height!==i)&&(this._maskBitmapData=this._textureCache.createAndFillRenderTexture(e,i,"mask"),this._maskChanged=!0),this._maskChanged){this._bitmapMasksOld=[],this._rectangleMasksOld=[],this._maskBitmapData&&this._textureCache.clearAndFillRenderTexture(this._maskBitmapData),this.resetTextureCache(s);const r=t.getCoordinatePosition(this._normal);let n=null,a=0,o=0,h=0;for(;h<this._bitmapMasks.length;){const u=this._bitmapMasks[h];u&&(n=u.type,a=this._maskBitmapData.width-this._maskBitmapData.width*u.leftSideLoc/this._leftSide.length,o=this._maskBitmapData.height-this._maskBitmapData.height*u.rightSideLoc/this._rightSide.length,this._maskManager.updateMask(this._maskBitmapData,n,t.scale,r,a,o),this._bitmapMasksOld.push(new Ip(n,u.leftSideLoc,u.rightSideLoc))),h++}for(h=0;h<this._rectangleMasks.length;){const u=this._rectangleMasks[h];if(u){a=this._maskBitmapData.width-this._maskBitmapData.width*u.leftSideLoc/this._leftSide.length,o=this._maskBitmapData.height-this._maskBitmapData.height*u.rightSideLoc/this._rightSide.length;const c=this._maskBitmapData.width*u.leftSideLength/this._leftSide.length,l=this._maskBitmapData.height*u.rightSideLength/this._rightSide.length,_=new Wt(ut.WHITE);_.tint=0,_.width=c,_.height=l,_.position.set(a-c,o-l),this._textureCache.writeToRenderTexture(_,this._maskBitmapData,!1),this._rectangleMasksOld.push(new Tp(u.leftSideLength,u.rightSideLoc,u.leftSideLength,u.rightSideLength))}h++}this._maskPixels=this._textureCache.getPixels(this._maskBitmapData),this._maskChanged=!1}this.combineTextureMask(s,this._maskPixels)}combineTextureMask(s,t){var n,a;if(!s||!t)return;const e=this._textureCache.getPixels(s);for(let o=0;o<e.length;o+=4){const h=t[o],u=t[o+1],c=t[o+2];t[o+3],!h&&!u&&!c&&(e[o+3]=0)}const i=(n=s.baseTexture._glTextures[1])==null?void 0:n.texture,r=(a=Ae.instance.renderer)==null?void 0:a.gl;!i||!r||(r.bindTexture(r.TEXTURE_2D,i),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,s.width,s.height,0,r.RGBA,r.UNSIGNED_BYTE,e),r.bindTexture(r.TEXTURE_2D,null))}};let Ot=dr;Ot.ZERO_POINT=new H(0,0);Ot.TYPE_UNDEFINED=0;Ot.TYPE_WALL=1;Ot.TYPE_FLOOR=2;Ot.TYPE_LANDSCAPE=3;Ot._uniqueIdCounter=1;class iv extends cs{constructor(){super(),this._wallRasterizer=new J9,this._floorRasterizer=new Q9,this._landscapeRasterizer=new xh,this._maskManager=new X9,this._initialized=!1}initialize(t){if(!t.roomVisualization)return!1;const e=t.roomVisualization.wallData;e&&this._wallRasterizer.initialize(e);const i=t.roomVisualization.floorData;i&&this._floorRasterizer.initialize(i);const r=t.roomVisualization.landscapeData;r&&this._landscapeRasterizer.initialize(r);const n=t.roomVisualization.maskData;return n&&this._maskManager.initialize(n),!0}onDispose(){this._wallRasterizer&&(this._wallRasterizer.dispose(),this._wallRasterizer=null),this._floorRasterizer&&(this._floorRasterizer.dispose(),this._floorRasterizer=null),this._landscapeRasterizer&&(this._landscapeRasterizer.dispose(),this._landscapeRasterizer=null),this._maskManager&&(this._maskManager.dispose(),this._maskManager=null),super.onDispose()}setGraphicAssetCollection(t){this._initialized||(this._wallRasterizer.initializeAssetCollection(t),this._floorRasterizer.initializeAssetCollection(t),this._landscapeRasterizer.initializeAssetCollection(t),this._maskManager.initializeAssetCollection(t),this._initialized=!0)}clearCache(){this._wallRasterizer&&this._wallRasterizer.clearCache(),this._floorRasterizer&&this._floorRasterizer.clearCache(),this._landscapeRasterizer&&this._landscapeRasterizer.clearCache()}get wallRasterizer(){return this._wallRasterizer}get floorRasterizer(){return this._floorRasterizer}get landscapeRasterizer(){return this._landscapeRasterizer}get maskManager(){return this._maskManager}}const Pe=class extends fh{constructor(){super(),this._data=null,this._roomPlaneParser=new ae,this._roomPlaneBitmapMaskParser=new BA,this._geometryUpdateId=-1,this._directionX=0,this._directionY=0,this._directionZ=0,this._floorThickness=1,this._wallThickness=1,this._holeUpdateTime=NaN,this._planes=[],this._visiblePlanes=[],this._visiblePlaneSpriteNumbers=[],this._roomScale=0,this._lastUpdateTime=-1e3,this._updateIntervalTime=250,this._wallType=null,this._floorType=null,this._landscapeType=null,this._colorBackgroundOnly=!0,this._color=16777215,this._redColor=255,this._greenColor=255,this._blueColor=255,this._typeVisibility=[],this._assetUpdateCounter=0,this._maskData=null,this._isPlaneSet=!1,this._textureCache=new Bm,this._typeVisibility[Ot.TYPE_UNDEFINED]=!1,this._typeVisibility[Ot.TYPE_FLOOR]=!0,this._typeVisibility[Ot.TYPE_WALL]=!0,this._typeVisibility[Ot.TYPE_LANDSCAPE]=!0}initialize(s){return s instanceof iv?(this._data=s,super.initialize(s),this._data.setGraphicAssetCollection(this.asset),!0):!1}dispose(){super.dispose(),this.clearPlanes(),this._planes=null,this._visiblePlanes=null,this._visiblePlaneSpriteNumbers=null,this._roomPlaneParser&&(this._roomPlaneParser.dispose(),this._roomPlaneParser=null),this._roomPlaneBitmapMaskParser&&(this._roomPlaneBitmapMaskParser.dispose(),this._roomPlaneBitmapMaskParser=null),this._data&&(this._data.clearCache(),this._data=null),this._textureCache&&this._textureCache.clearCache()}reset(){super.reset(),this._floorType=null,this._wallType=null,this._landscapeType=null,this._maskData=null,this._geometryUpdateId=-1,this._roomScale=0}update(s,t,e,i){if(!this.object||!s)return;const r=this.updateGeometry(s),n=this.object.model;let a=!1;if(this.updateThickness(n)&&(a=!0),this.updateHole(n)&&(a=!0),this.initializeRoomPlanes(),a=this.updateMasks(n),!(t<this._lastUpdateTime+this._updateIntervalTime&&!r&&!a)){if(this.updatePlaneTexturesAndVisibilities(n)&&(a=!0),this.updatePlanes(s,r,t)&&(a=!0),a){let o=0;for(;o<this._visiblePlanes.length;){const h=this._visiblePlaneSpriteNumbers[o],u=this.getSprite(h),c=this._visiblePlanes[o];if(u&&c&&c.type!==Ot.TYPE_LANDSCAPE)if(this._colorBackgroundOnly){let l=c.color;const _=(l&255)*this._redColor/255,d=(l>>8&255)*this._greenColor/255,g=(l>>16&255)*this._blueColor/255;l=(l>>24<<24)+(g<<16)+(d<<8)+_,u.color=l}else u.color=c.color;o++}this.updateSpriteCounter++}this.updateModelCounter=n.updateCounter,this._lastUpdateTime=t}}updateGeometry(s){if(!s||this._geometryUpdateId===s.updateId)return!1;this._geometryUpdateId=s.updateId,this._boundingRectangle=null;const t=s.direction;return t&&(t.x!==this._directionX||t.y!==this._directionY||t.z!==this._directionZ||s.scale!==this._roomScale)?(this._directionX=t.x,this._directionY=t.y,this._directionZ=t.z,this._roomScale=s.scale,!0):!1}updateThickness(s){if(this.updateModelCounter===s.updateCounter)return!1;const t=s.getValue(I.ROOM_FLOOR_THICKNESS),e=s.getValue(I.ROOM_WALL_THICKNESS);return!isNaN(t)&&!isNaN(e)&&(t!==this._floorThickness||e!==this._wallThickness)?(this._floorThickness=t,this._wallThickness=e,this.clearPlanes(),!0):!1}updateHole(s){if(this.updateModelCounter===s.updateCounter)return!1;const t=s.getValue(I.ROOM_FLOOR_HOLE_UPDATE_TIME);return!isNaN(t)&&t!==this._holeUpdateTime?(this._holeUpdateTime=t,this.clearPlanes(),!0):!1}updateMasks(s){if(this.updateModelCounter===s.updateCounter)return!1;let t=!1;const e=s.getValue(I.ROOM_PLANE_MASK_XML);e!==this._maskData&&(this.updatePlaneMasks(e),this._maskData=e,t=!0);const i=s.getValue(I.ROOM_BACKGROUND_COLOR);i!==this._color&&(this._color=i,this._redColor=this._color&255,this._greenColor=this._color>>8&255,this._blueColor=this._color>>16&255,t=!0);const r=s.getValue(I.ROOM_COLORIZE_BG_ONLY)||!1;return r!==this._colorBackgroundOnly&&(this._colorBackgroundOnly=r,t=!0),t}updatePlaneTexturesAndVisibilities(s){if(this.updateModelCounter===s.updateCounter)return!1;const t=s.getValue(I.ROOM_FLOOR_TYPE),e=s.getValue(I.ROOM_WALL_TYPE),i=s.getValue(I.ROOM_LANDSCAPE_TYPE),r=s.getValue(I.ROOM_FLOOR_VISIBILITY)===1,n=s.getValue(I.ROOM_WALL_VISIBILITY)===1,a=s.getValue(I.ROOM_LANDSCAPE_VISIBILITY)===1;return this.updatePlaneTypes(t,e,i)||this.updatePlaneVisibility(r,n,a)}clearPlanes(){if(this._planes){for(;this._planes.length;){const s=this._planes[0];s&&s.dispose(),this._planes.pop()}this._planes=[],this._planes=[]}this._isPlaneSet=!1,this._assetUpdateCounter=this._assetUpdateCounter+1,this.reset()}initializeRoomPlanes(){if(!this.object||this._isPlaneSet)return;isNaN(this._floorThickness)||(this._roomPlaneParser.floorThicknessMultiplier=this._floorThickness),isNaN(this._wallThickness)||(this._roomPlaneParser.wallThicknessMultiplier=this._wallThickness);const s=this.object.model.getValue(I.ROOM_MAP_DATA);if(!this._roomPlaneParser.initializeFromMapData(s))return;const t=this.getLandscapeWidth(),e=this.getLandscapeHeight();let i=0,r=this.object.model.getValue(I.ROOM_RANDOM_SEED),n=0;for(;n<this._roomPlaneParser.planeCount;){const a=this._roomPlaneParser.getPlaneLocation(n),o=this._roomPlaneParser.getPlaneLeftSide(n),h=this._roomPlaneParser.getPlaneRightSide(n),u=this._roomPlaneParser.getPlaneSecondaryNormals(n),c=this._roomPlaneParser.getPlaneType(n);let l=null;if(a&&o&&h){const _=S.crossProduct(o,h);if(r=dv(Math.trunc(r*7613+517)>>>0),l=null,c===Kt.PLANE_FLOOR){const d=a.x+o.x+.5,g=a.y+h.y+.5,m=Math.trunc(d)-d,p=Math.trunc(g)-g;l=new Ot(this._textureCache,this.object.getLocation(),a,o,h,Ot.TYPE_FLOOR,!0,u,r,-m,-p),_.z!==0?l.color=Pe.FLOOR_COLOR:l.color=_.x!==0?Pe.FLOOR_COLOR_RIGHT:Pe.FLOOR_COLOR_LEFT,this._data&&(l.rasterizer=this._data.floorRasterizer)}else c===Kt.PLANE_WALL?(l=new Ot(this._textureCache,this.object.getLocation(),a,o,h,Ot.TYPE_WALL,!0,u,r),(o.length<1||h.length<1)&&(l.hasTexture=!1),_.x===0&&_.y===0?l.color=Pe.WALL_COLOR_BORDER:_.y>0?l.color=Pe.WALL_COLOR_TOP:_.y===0?l.color=Pe.WALL_COLOR_SIDE:l.color=Pe.WALL_COLOR_BOTTOM,this._data&&(l.rasterizer=this._data.wallRasterizer)):c===Kt.PLANE_LANDSCAPE?(l=new Ot(this._textureCache,this.object.getLocation(),a,o,h,Ot.TYPE_LANDSCAPE,!0,u,r,i,0,t,e),_.y>0?l.color=Pe.LANDSCAPE_COLOR_TOP:_.y==0?l.color=Pe.LANDSCAPE_COLOR_SIDE:l.color=Pe.LANDSCAPE_COLOR_BOTTOM,this._data&&(l.rasterizer=this._data.landscapeRasterizer),i=i+o.length):c==Kt.PLANE_BILLBOARD&&(l=new Ot(this._textureCache,this.object.getLocation(),a,o,h,Ot.TYPE_WALL,!0,u,r),(o.length<1||h.length<1)&&(l.hasTexture=!1),_.x==0&&_.y==0?l.color=Pe.WALL_COLOR_BORDER:_.y>0?l.color=Pe.WALL_COLOR_TOP:_.y==0?l.color=Pe.WALL_COLOR_SIDE:l.color=Pe.WALL_COLOR_BOTTOM);if(l){l.maskManager=this._data.maskManager;let d=0;for(;d<this._roomPlaneParser.getPlaneMaskCount(n);){const g=this._roomPlaneParser.getPlaneMaskLeftSideLoc(n,d),m=this._roomPlaneParser.getPlaneMaskRightSideLoc(n,d),p=this._roomPlaneParser.getPlaneMaskLeftSideLength(n,d),T=this._roomPlaneParser.getPlaneMaskRightSideLength(n,d);l.addRectangleMask(g,m,p,T),d++}this._planes.push(l)}}else return;n++}this._isPlaneSet=!0,this.defineSprites()}defineSprites(){this.createSprites(this._planes.length);let s=0;for(;s<this._planes.length;){const t=this._planes[s],e=this.getSprite(s);t&&e&&t.leftSide&&t.rightSide&&(t.type===Ot.TYPE_WALL&&(t.leftSide.length<1||t.rightSide.length<1)?e.alphaTolerance=Ms.MATCH_NOTHING:e.alphaTolerance=Ms.MATCH_OPAQUE_PIXELS,t.type===Ot.TYPE_WALL?e.tag="plane.wall@"+(s+1):t.type===Ot.TYPE_FLOOR?e.tag="plane.floor@"+(s+1):e.tag="plane@"+(s+1),e.spriteType=es.ROOM_PLANE),s++}}getLandscapeWidth(){let s=0,t=0;for(;t<this._roomPlaneParser.planeCount;){if(this._roomPlaneParser.getPlaneType(t)===Kt.PLANE_LANDSCAPE){const i=this._roomPlaneParser.getPlaneLeftSide(t);s+=i.length}t++}return s}getLandscapeHeight(){let s=0,t=0;for(;t<this._roomPlaneParser.planeCount;){if(this._roomPlaneParser.getPlaneType(t)===Kt.PLANE_LANDSCAPE){const i=this._roomPlaneParser.getPlaneRightSide(t);i.length>s&&(s=i.length)}t++}return s>5&&(s=5),s}updatePlaneTypes(s,t,e){if(s!==this._floorType?this._floorType=s:s=null,t!==this._wallType?this._wallType=t:t=null,e!==this._landscapeType?this._landscapeType=e:e=null,!s&&!t&&!e)return!1;let i=0;for(;i<this._planes.length;){const r=this._planes[i];r&&(r.type===Ot.TYPE_FLOOR&&s?r.id=s:r.type===Ot.TYPE_WALL&&t?r.id=t:r.type===Ot.TYPE_LANDSCAPE&&e&&(r.id=e)),i++}return!0}updatePlaneVisibility(s,t,e){return s===this._typeVisibility[Ot.TYPE_FLOOR]&&t===this._typeVisibility[Ot.TYPE_WALL]&&e===this._typeVisibility[Ot.TYPE_LANDSCAPE]?!1:(this._typeVisibility[Ot.TYPE_FLOOR]=s,this._typeVisibility[Ot.TYPE_WALL]=t,this._typeVisibility[Ot.TYPE_LANDSCAPE]=e,this._visiblePlanes=[],this._visiblePlaneSpriteNumbers=[],!0)}updatePlanes(s,t,e){if(!s||!this.object)return!1;this._assetUpdateCounter++,t&&(this._visiblePlanes=[],this._visiblePlaneSpriteNumbers=[]);const i=this._visiblePlanes.length>0;let r=this._visiblePlanes;this._visiblePlanes.length||(r=this._planes);let n=0,a=!1,o=0;for(;o<r.length;){let h=o;i&&(h=this._visiblePlaneSpriteNumbers[o]);const u=this.getSprite(h);if(u){const c=r[o];c?(u.id=c.uniqueId,c.update(s,e)&&(c.visible&&(n=c.relativeDepth+this.floorRelativeDepth+h/1e3,c.type!==Ot.TYPE_FLOOR&&(n=c.relativeDepth+this.wallRelativeDepth+h/1e3,(c.leftSide.length<1||c.rightSide.length<1)&&(n=n+Pe.ROOM_DEPTH_OFFSET*.5)),this.updateSprite(u,s,c,`plane ${h} ${s.scale}`,n)),a=!0),u.visible!=(c.visible&&this._typeVisibility[c.type])&&(u.visible=!u.visible,a=!0),u.visible&&(i||(this._visiblePlanes.push(c),this._visiblePlaneSpriteNumbers.push(o)))):(u.id=0,u.visible&&(u.visible=!1,a=!0))}o++}return a}updatePlaneMasks(s){if(!s)return;this._roomPlaneBitmapMaskParser.initialize(s);const t=[],e=[];let i=!1,r=0;for(;r<this._planes.length;){const n=this._planes[r];n&&(n.resetBitmapMasks(),n.type===Ot.TYPE_LANDSCAPE&&t.push(r)),r++}for(const n of this._roomPlaneBitmapMaskParser.masks.values()){const a=this._roomPlaneBitmapMaskParser.getMaskType(n),o=this._roomPlaneBitmapMaskParser.getMaskLocation(n),h=this._roomPlaneBitmapMaskParser.getMaskCategory(n);if(o){let u=0;for(;u<this._planes.length;){const c=this._planes[u];if((c.type===Ot.TYPE_WALL||c.type===Ot.TYPE_LANDSCAPE)&&c&&c.location&&c.normal){const l=S.dif(o,c.location);if(Math.abs(S.scalarProjection(l,c.normal))<.01&&c.leftSide&&c.rightSide){const d=S.scalarProjection(l,c.leftSide),g=S.scalarProjection(l,c.rightSide);c.type===Ot.TYPE_WALL||c.type===Ot.TYPE_LANDSCAPE&&h===Dn.HOLE?c.addBitmapMask(a,d,g):c.type===Ot.TYPE_LANDSCAPE&&(c.canBeVisible||(i=!0),c.canBeVisible=!0,e.push(u))}}u++}}}for(r=0;r<t.length;){const n=t[r];if(e.indexOf(n)<0){const a=this._planes[n];a.canBeVisible=!1,i=!0}r++}i&&(this._visiblePlanes=[],this._visiblePlaneSpriteNumbers=[])}updateSprite(s,t,e,i,r){const n=e.offset;s.offsetX=-n.x,s.offsetY=-n.y,s.relativeDepth=r,s.color=e.color,s.texture=e.bitmapData,s.name=i+"_"+this._assetUpdateCounter}getBoundingRectangle(){return this._boundingRectangle||(this._boundingRectangle=super.getBoundingRectangle()),new et(this._boundingRectangle.x,this._boundingRectangle.y,this._boundingRectangle.width,this._boundingRectangle.height)}get planes(){const s=[];for(const t of this._visiblePlanes)s.push(t);return s}get floorRelativeDepth(){return Pe.ROOM_DEPTH_OFFSET+.1}get wallRelativeDepth(){return Pe.ROOM_DEPTH_OFFSET+.5}};let Ls=Pe;Ls.FLOOR_COLOR=16777215;Ls.FLOOR_COLOR_LEFT=14540253;Ls.FLOOR_COLOR_RIGHT=12303291;Ls.WALL_COLOR_TOP=16777215;Ls.WALL_COLOR_SIDE=13421772;Ls.WALL_COLOR_BOTTOM=10066329;Ls.WALL_COLOR_BORDER=10066329;Ls.LANDSCAPE_COLOR_TOP=16777215;Ls.LANDSCAPE_COLOR_SIDE=13421772;Ls.LANDSCAPE_COLOR_BOTTOM=10066329;Ls.ROOM_DEPTH_OFFSET=1e3;class $9 extends ce{constructor(){super(),this._tileHeight=0}getLayerYOffset(t,e,i){return i===1?(this._tileHeight=this.object.model.getValue(I.TILE_CURSOR_HEIGHT),-this._tileHeight*32):super.getLayerYOffset(t,e,i)}}const rv=class{constructor(){this._visualizationDatas=new Map}getVisualization(s){const t=this.getVisualizationType(s);return t?new t:null}getVisualizationType(s){if(!s)return null;let t=null;switch(s){case F.ROOM:t=Ls;break;case F.TILE_CURSOR:t=$9;break;case F.USER:case F.BOT:case F.RENTABLE_BOT:t=_e;break;case F.PET_ANIMATED:t=qs;break;case F.FURNITURE_STATIC:t=nr;break;case F.FURNITURE_ANIMATED:t=ce;break;case F.FURNITURE_RESETTING_ANIMATED:t=x9;break;case F.FURNITURE_BADGE_DISPLAY:t=WA;break;case F.FURNITURE_BG:t=F9;break;case F.FURNITURE_BB:t=XA;break;case F.FURNITURE_ISOMETRIC_BB:t=D9;break;case F.FURNITURE_BOTTLE:t=e_;break;case F.FURNITURE_BUILDER_PLACEHOLDER:t=C9;break;case F.FURNITURE_COUNTER_CLOCK:t=Nh;break;case F.FURNITURE_CUBOID:t=M9;break;case F.FURNITURE_EXTERNAL_IMAGE:t=N9;break;case F.FURNITURE_FIREWORKS:t=qA;break;case F.FURNITURE_GIFT_WRAPPED_FIREWORKS:t=i_;break;case F.FURNITURE_GIFT_WRAPPED:t=b9;break;case F.FURNITURE_GUILD_CUSTOMIZED:t=Wa;break;case F.FURNITURE_GUILD_ISOMETRIC_BADGE:t=Ph;break;case F.FURNITURE_HABBOWHEEL:t=bh;break;case F.FURNITURE_MANNEQUIN:t=ZA;break;case F.FURNITURE_PARTY_BEAMER:t=Xa;break;case F.FURNITURE_PLANET_SYSTEM:t=L9;break;case F.FURNITURE_POSTER:t=U9;break;case F.FURNITURE_QUEUE_TILE:t=Dh;break;case F.FURNITURE_SCORE_BOARD:t=Lh;break;case F.FURNITURE_SOUNDBLOCK:t=w9;break;case F.FURNITURE_STICKIE:t=G9;break;case F.FURNITURE_VAL_RANDOMIZER:t=Ka;break;case F.FURNITURE_VOTE_COUNTER:t=Uh;break;case F.FURNITURE_VOTE_MAJORITY:t=qa;break;case F.FURNITURE_WATER_AREA:t=B9;break;case F.FURNITURE_YOUTUBE:t=tv;break}return t||(Y.log("Unknown Visualization",s),null)}getVisualizationData(s,t,e){const i=this._visualizationDatas.get(s);if(i)return i;let r=null;switch(t){case F.FURNITURE_STATIC:case F.FURNITURE_GIFT_WRAPPED:case F.FURNITURE_BB:case F.FURNITURE_ISOMETRIC_BB:case F.FURNITURE_BG:case F.FURNITURE_STICKIE:case F.FURNITURE_BUILDER_PLACEHOLDER:r=new Qi;break;case F.FURNITURE_ANIMATED:case F.FURNITURE_RESETTING_ANIMATED:case F.FURNITURE_POSTER:case F.FURNITURE_HABBOWHEEL:case F.FURNITURE_VAL_RANDOMIZER:case F.FURNITURE_BOTTLE:case F.FURNITURE_PLANET_SYSTEM:case F.FURNITURE_QUEUE_TILE:case F.FURNITURE_PARTY_BEAMER:case F.FURNITURE_COUNTER_CLOCK:case F.FURNITURE_WATER_AREA:case F.FURNITURE_SCORE_BOARD:case F.FURNITURE_FIREWORKS:case F.FURNITURE_GIFT_WRAPPED_FIREWORKS:case F.FURNITURE_GUILD_CUSTOMIZED:case F.FURNITURE_GUILD_ISOMETRIC_BADGE:case F.FURNITURE_VOTE_COUNTER:case F.FURNITURE_VOTE_MAJORITY:case F.FURNITURE_SOUNDBLOCK:case F.FURNITURE_BADGE_DISPLAY:case F.FURNITURE_EXTERNAL_IMAGE:case F.FURNITURE_YOUTUBE:case F.TILE_CURSOR:r=new og;break;case F.FURNITURE_MANNEQUIN:r=new ef;break;case F.ROOM:r=new iv;break;case F.USER:case F.BOT:case F.RENTABLE_BOT:r=new _l;break;case F.PET_ANIMATED:r=new ev;break}return r?r.initialize(e)?((r instanceof _l||r instanceof ef)&&(r.avatarManager=K.instance.avatar),rv.CACHING_ENABLED&&this._visualizationDatas.set(s,r),r):(r.dispose(),null):null}};let nv=rv;nv.CACHING_ENABLED=!0;class Vt{}Vt.ROOM_MIN_X="room_min_x";Vt.ROOM_MAX_X="room_max_x";Vt.ROOM_MIN_Y="room_min_y";Vt.ROOM_MAX_Y="room_max_y";Vt.ROOM_IS_PUBLIC="room_is_public";Vt.ROOM_Z_SCALE="room_z_scale";Vt.AD_DISPLAY_DELAY="ad_display_delay";Vt.IS_PLAYING_GAME="is_playing_game";Vt.RESTRICTS_DRAGGING="restricts_dragging";Vt.RESTRICTS_SCALING="restricts_scaling";Vt.RESTRICTED_SCALE="room_scale";class tq{constructor(t,e){this._width=t,this._height=e,this._heights=[],this._isNotStackable=[],this._isRoomTile=[];let i=t*e;for(;i>0;)this._heights.push(0),this._isNotStackable.push(!1),this._isRoomTile.push(!1),i--}dispose(){this._width=0,this._height=0,this._height=null,this._isNotStackable=null,this._isRoomTile=null}validPosition(t,e){return t>=0&&t<this._width&&e>=0&&e<this._height}getTileHeight(t,e){return this.validPosition(t,e)?this._heights[e*this._width+t]:0}setTileHeight(t,e,i){this.validPosition(t,e)&&(this._heights[e*this._width+t]=i)}setStackingBlocked(t,e,i){this.validPosition(t,e)&&(this._isNotStackable[e*this._width+t]=i)}setIsRoomTile(t,e,i){this.validPosition(t,e)&&(this._isRoomTile[e*this._width+t]=i)}validateLocation(t,e,i,r,n,a,o,h,u,c=-1){let l=0,_=0;if(!this.validPosition(t,e)||!this.validPosition(t+i-1,e+r-1))return!1;(n<0||n>=this._width)&&(n=0),(a<0||a>=this._height)&&(a=0),o=Math.min(o,this._width-n),h=Math.min(h,this._height-a),c===-1&&(c=this.getTileHeight(t,e));let d=e;for(;d<e+r;){for(l=t;l<t+i;){if(l<n||l>=n+o||d<a||d>=a+h){if(_=d*this._width+l,u){if(!this._isRoomTile[_])return!1}else if(this._isNotStackable[_]||!this._isRoomTile[_]||Math.abs(this._heights[_]-c)>.01)return!1}l++}d++}return!0}get width(){return this._width}get height(){return this._height}}const bi=class{constructor(){this._isDisposed=!1,this._scale=64,this._heightMap=[],this._width=0,this._height=0,this._floorHeight=0}get disposed(){return this._isDisposed}get scale(){return this._scale}set scale(s){this._scale=s}dispose(){this.reset(),this._isDisposed=!0}initialize(s,t,e){if(s<=this._width&&t<=this._height){this._width=s,this._height=t,this._floorHeight=e;return}this.reset();let i=0;for(;i<t;){const r=[];this._heightMap.push(r);let n=0;for(;n<s;)r.push(0),n++;i++}this._width=s,this._height=t,this._floorHeight=e}reset(){this._heightMap=[]}setHeight(s,t,e){if(s<0||s>=this._width||t<0||t>=this._height)return!1;const i=this._heightMap[t];return i?(i[s]=e,!0):!1}getHeight(s,t){if(s<0||s>=this._width||t<0||t>=this._height)return 0;const e=this._heightMap[t];return e?e[s]:0}getLocation(s,t,e,i,r){if(s==0&&t==0){s=this._width,t=this._height;const u=Math.round(this.scale/10);if(r==bi.R){let c=this._width-1;for(;c>=0;){let l=1;for(;l<this._height;){if(this.getHeight(c,l)<=this._floorHeight){l-1<t&&(s=c,t=l-1);break}l++}c--}i=i+(this.scale/4-u/2),e=e+this.scale/2}else{let c=this._height-1;for(;c>=0;){let l=1;for(;l<this._width;){if(this.getHeight(l,c)<=this._floorHeight){l-1<s&&(s=l-1,t=c);break}l++}c--}i=i+(this.scale/4-u/2),e=e-u}}let n=s,a=t,o=this.getHeight(s,t);return r==bi.R?(n=n+(e/(this._scale/2)-.5),a=a+.5,o=o-(i-e/2)/(this._scale/2)):(a=a+((this._scale/2-e)/(this._scale/2)-.5),n=n+.5,o=o-(i-(this._scale/2-e)/2)/(this._scale/2)),new S(n,a,o)}getLocationOldFormat(s,t,e){let i,r,n=0,a=0;r=Math.ceil(s),n=r-s;let o,h,u,c=0;for(i=0;i<this._width;){if(r>=0&&r<this._height){if(this.getHeight(i,r)<=this._floorHeight){o=i-1,h=r,a=i,e=bi.L;break}if(this.getHeight(i,r+1)<=this._floorHeight){o=i,h=r,a=h-s,e=bi.R;break}}r++,i++}const l=this.scale/2*n;let _=-a*this.scale/2;return _=_+-t*18/32*this.scale/2,c=this.getHeight(o,h),u=c*this.scale/2+_,e==bi.R?u=u+n*this.scale/4:u=u+(1-n)*this.scale/4,this.getLocation(o,h,l,u,e)}getOldLocation(s,t){if(s==null)return null;let e=0,i=0,r=0,n=0,a="",o=0;if(t==90)e=Math.floor(s.x-.5),i=Math.floor(s.y+.5),o=this.getHeight(e,i),r=this._scale/2-(s.y-i+.5)*(this._scale/2),n=(o-s.z)*(this._scale/2)+(this._scale/2-r)/2,a=bi.L;else if(t==180)e=Math.floor(s.x+.5),i=Math.floor(s.y-.5),o=this.getHeight(e,i),r=(s.x+.5-e)*(this._scale/2),n=(o-s.z)*(this._scale/2)+r/2,a=bi.R;else return null;return[e,i,r,n,a]}getOldLocationString(s,t){const e=this.getOldLocation(s,t);if(e==null)return null;const i=Math.trunc(e[0]),r=Math.trunc(e[1]),n=Math.trunc(e[2]),a=Math.trunc(e[3]),o=e[4];return":w="+i+","+r+" l="+n+","+a+" "+o}getDirection(s){return s==bi.R?180:90}getFloorAltitude(s,t){const e=this.getHeight(s,t),i=e+1;return e+(Math.trunc(this.getHeight(s-1,t-1))==i||Math.trunc(this.getHeight(s,t-1))==i||Math.trunc(this.getHeight(s+1,t-1))==i||Math.trunc(this.getHeight(s-1,t))==i||Math.trunc(this.getHeight(s+1,t))==i||Math.trunc(this.getHeight(s-1,t+1))==i||Math.trunc(this.getHeight(s,t+1))==i||Math.trunc(this.getHeight(s+1,t+1))==i?.5:0)}isRoomTile(s,t){return s>=0&&s<this._width&&t>=0&&t<this._height&&this._heightMap[t][s]>=0}};let Za=bi;Za.DEFAULT_SCALE=32;Za.L="l";Za.R="r";const av=class{constructor(){this._targetId=-1,this._targetCategory=-2,this._targetLoc=null,this._moveDistance=0,this._previousMoveSpeed=0,this._maintainPreviousMoveSpeed=!1,this._currentLoc=null,this._limitedLocX=!1,this._limitedLocY=!1,this._centeredLocX=!1,this._centeredLocY=!1,this._screenWd=0,this._screenHt=0,this._scale=0,this._roomWd=0,this._roomHt=0,this._geometryUpdateId=-1,this._scaleChanged=!1,this._targetObjectLoc=new S}get location(){return this._currentLoc}get targetId(){return this._targetId}set targetId(s){this._targetId=s}get targetCategory(){return this._targetCategory}set targetCategory(s){this._targetCategory=s}get targetObjectLoc(){return this._targetObjectLoc}set targetObjectLoc(s){this._targetObjectLoc.assign(s)}get limitedLocationX(){return this._limitedLocX}set limitedLocationX(s){this._limitedLocX=s}get limitedLocationY(){return this._limitedLocY}set limitedLocationY(s){this._limitedLocY=s}get centeredLocX(){return this._centeredLocX}set centeredLocX(s){this._centeredLocX=s}get centeredLocY(){return this._centeredLocY}set centeredLocY(s){this._centeredLocY=s}get screenWd(){return this._screenWd}set screenWd(s){this._screenWd=s}get screenHt(){return this._screenHt}set screenHt(s){this._screenHt=s}get scale(){return this._scale}set scale(s){this._scale!=s&&(this._scale=s,this._scaleChanged=!0)}get roomWd(){return this._roomWd}set roomWd(s){this._roomWd=s}get roomHt(){return this._roomHt}set roomHt(s){this._roomHt=s}get geometryUpdateId(){return this._geometryUpdateId}set geometryUpdateId(s){this._geometryUpdateId=s}get isMoving(){return this._targetLoc!=null&&this._currentLoc!=null}set target(s){let t;this._targetLoc==null&&(this._targetLoc=new S),(this._targetLoc.x!=s.x||this._targetLoc.y!=s.y||this._targetLoc.z!=s.z)&&(this._targetLoc.assign(s),t=S.dif(this._targetLoc,this._currentLoc),this._moveDistance=t.length,this._maintainPreviousMoveSpeed=!0)}dispose(){this._targetLoc=null,this._currentLoc=null}initializeLocation(s){this._currentLoc==null&&(this._currentLoc=new S,this._currentLoc.assign(s))}resetLocation(s){this._currentLoc==null&&(this._currentLoc=new S),this._currentLoc.assign(s)}update(s,t){let e,i,r,n,a;if(this._followDuration>0&&this._targetLoc!=null&&this._currentLoc!=null){if(this._scaleChanged){this._scaleChanged=!1,this._currentLoc=this._targetLoc,this._targetLoc=null;return}e=S.dif(this._targetLoc,this._currentLoc),e.length>this._moveDistance&&(this._moveDistance=e.length),e.length<=t?(this._currentLoc=this._targetLoc,this._targetLoc=null,this._previousMoveSpeed=0):(i=Math.sin(Math.PI*e.length/this._moveDistance),r=t*.5,n=this._moveDistance/av.MOVE_SPEED_DENOMINATOR,a=r+(n-r)*i,this._maintainPreviousMoveSpeed&&(a<this._previousMoveSpeed?(a=this._previousMoveSpeed,a>e.length&&(a=e.length)):this._maintainPreviousMoveSpeed=!1),this._previousMoveSpeed=a,e.divide(e.length),e.multiply(a),this._currentLoc=S.sum(this._currentLoc,e))}}reset(){this._geometryUpdateId=-1}activateFollowing(s){this._followDuration=s}};let ov=av;ov.MOVE_SPEED_DENOMINATOR=12;class Rp{constructor(t,e){this._roomId=t,this._data=e,this._floorType=null,this._wallType=null,this._landscapeType=null}get roomId(){return this._roomId}get data(){return this._data}get floorType(){return this._floorType}set floorType(t){this._floorType=t}get wallType(){return this._wallType}set wallType(t){this._wallType=t}get landscapeType(){return this._landscapeType}set landscapeType(t){this._landscapeType=t}}class $_{constructor(t,e,i,r,n,a,o,h=NaN,u=-1,c=0,l=0,_="",d=!0,g=!0,m=-1){this._id=t,this._typeId=e,this._type=i,this._state=a,this._data=o,this._extra=h,this._expiryTime=u,this._usagePolicy=c,this._ownerId=l,this._ownerName=_,this._synchronized=d,this._realRoomObject=g,this._sizeZ=m,this._location=new S,this._direction=new S,this._location.assign(r),this._direction.assign(n)}get id(){return this._id}get typeId(){return this._typeId}get type(){return this._type}get location(){return this._location}get direction(){return this._direction}get state(){return this._state}get data(){return this._data}get extra(){return this._extra}get expiryTime(){return this._expiryTime}get usagePolicy(){return this._usagePolicy}get ownerId(){return this._ownerId}get ownerName(){return this._ownerName}get synchronized(){return this._synchronized}get realRoomObject(){return this._realRoomObject}get sizeZ(){return this._sizeZ}}class eq{constructor(t,e){this._tileObjectMap=new Map;let i=0;for(;i<e;)this._tileObjectMap.set(i,new Map),i++;this._width=t,this._height=e}clear(){for(const t of this._tileObjectMap.values())t&&t.clear();this._tileObjectMap.clear()}populate(t){this.clear();for(const e of t)this.addRoomObject(e)}dispose(){this._tileObjectMap=null,this._width=0,this._height=0}getObjectIntTile(t,e){if(t>=0&&t<this._width&&e>=0&&e<this._height){const i=this._tileObjectMap.get(e);if(i)return i.get(t)}return null}setObjectInTile(t,e,i){if(!i.isReady){Y.log("Assigning non initialized object to tile object map!");return}if(t>=0&&t<this._width&&e>=0&&e<this._height){const r=this._tileObjectMap.get(e);r&&r.set(t,i)}}addRoomObject(t){if(!t||!t.model||!t.isReady)return;const e=t.getLocation(),i=t.getDirection();if(!e||!i)return;let r=t.model.getValue(I.FURNITURE_SIZE_X),n=t.model.getValue(I.FURNITURE_SIZE_Y);r<1&&(r=1),n<1&&(n=1);const a=Math.trunc(i.x+45)%360/90;(a===1||a===3)&&([r,n]=[n,r]);let o=e.y;for(;o<e.y+n;){let h=e.x;for(;h<e.x+r;){const u=this.getObjectIntTile(h,o);(!u||u!==t&&u.getLocation().z<=e.z)&&this.setObjectInTile(h,o,t),h++}o++}}}class sq{constructor(t){this._roomId=t,this._modelName=null,this._legacyGeometry=new Za,this._tileObjectMap=null,this._roomCamera=new ov,this._selectedObject=null,this._placedObject=null,this._furnitureStackingHeightMap=null,this._floorStack=new Map,this._wallStack=new Map,this._mouseButtonCursorOwners=[]}dispose(){}setModelName(t){this._modelName=t}setSelectedObject(t){this._selectedObject&&this._selectedObject.dispose(),this._selectedObject=t}setPlacedObject(t){this._placedObject&&this._placedObject.dispose(),this._placedObject=t}setFurnitureStackingHeightMap(t){this._furnitureStackingHeightMap&&this._furnitureStackingHeightMap.dispose(),this._furnitureStackingHeightMap=t,this._tileObjectMap&&this._tileObjectMap.dispose(),this._furnitureStackingHeightMap&&(this._tileObjectMap=new eq(this._furnitureStackingHeightMap.width,this._furnitureStackingHeightMap.height))}addPendingFurnitureFloor(t){t&&(this._floorStack.delete(t.id),this._floorStack.set(t.id,t))}removePendingFunitureFloor(t){const e=this._floorStack.get(t);return e?(this._floorStack.delete(t),e):null}getPendingFurnitureFloor(t){const e=this._floorStack.get(t);return e?(this._floorStack.delete(t),e):null}getNextPendingFurnitureFloor(){if(!this._floorStack.size)return null;const t=this._floorStack.keys();return this.getPendingFurnitureFloor(t.next().value)}addPendingFurnitureWall(t){t&&(this._wallStack.delete(t.id),this._wallStack.set(t.id,t))}removePendingFurnitureWall(t){const e=this._wallStack.get(t);return e?(this._wallStack.delete(t),e):null}getPendingFurnitureWall(t){const e=this._wallStack.get(t);return e?(this._wallStack.delete(t),e):null}getNextPendingFurnitureWall(){if(!this._wallStack.size)return null;const t=this._wallStack.keys();return this.getPendingFurnitureWall(t.next().value)}addButtonMouseCursorOwner(t){return this._mouseButtonCursorOwners.indexOf(t)===-1?(this._mouseButtonCursorOwners.push(t),!0):!1}removeButtonMouseCursorOwner(t){const e=this._mouseButtonCursorOwners.indexOf(t);return e>-1?(this._mouseButtonCursorOwners.splice(e,1),!0):!1}hasButtonMouseCursorOwners(){return this._mouseButtonCursorOwners.length>0}get roomId(){return this._roomId}get modelName(){return this._modelName}get legacyGeometry(){return this._legacyGeometry}get tileObjectMap(){return this._tileObjectMap}get roomCamera(){return this._roomCamera}get selectedObject(){return this._selectedObject}get placedObject(){return this._placedObject}get furnitureStackingHeightMap(){return this._furnitureStackingHeightMap}}class iq{constructor(t,e){this._object=t,this._groupBadge=e}get object(){return this._object}get groupBadge(){return this._groupBadge}}class tc{constructor(t,e,i,r,n,a=0,o=null,h=null,u=-1,c=-1,l=null){this._id=0,this._category=0,this._operation="",this._loc=null,this._dir=null,this._typeId=0,this._instanceData=null,this._stuffData=null,this._state=-1,this._animFrame=-1,this._posture=null,this._id=t,this._category=e,this._operation=i,this._loc=new S,this._loc.assign(r),this._dir=new S,this._dir.assign(n),this._typeId=a,this._instanceData=o,this._stuffData=h,this._state=u,this._animFrame=c,this._posture=l}get id(){return this._id}get category(){return this._category}get operation(){return this._operation}get loc(){return this._loc}get dir(){return this._dir}get typeId(){return this._typeId}get instanceData(){return this._instanceData}get stuffData(){return this._stuffData}get state(){return this._state}get animFrame(){return this._animFrame}get posture(){return this._posture}dispose(){this._loc=null,this._dir=null}}const ei=class{constructor(){this.spriteCount=0,this.externalImageCount=0}static addMannequinSprites(s,t){const e=[];for(const i of s)if(i)if(i.type==="boutique_mannequin1"&&i.name.indexOf("mannequin_")===0){const r=t.getRoomObject(t.activeRoomId,i.objectId,D.FLOOR);if(r){const n=r.visualization.getSpriteList();if(n)for(const a of n)a.x=a.x+(i.x+i.width/2+ei.MANNEQUIN_MAGIC_X_OFFSET),a.y=a.y+(i.y+i.height+ei.MANNEQUIN_MAGIC_Y_OFFSET),a.z=a.z+i.z,e.push(a)}}else e.push(i);return e}static sortSpriteDataObjects(s,t){return s.z<t.z?1:(s.z>t.z,-1)}static isSpriteInViewPort(s,t,e){return!0}static sortQuadPoints(s,t,e,i){const r=[];if(s.x==t.x?r.push(s,e,t,i):s.x==e.x?r.push(s,t,e,i):t.x<s.x&&t.y>s.y||t.x>s.x&&t.y<s.y?r.push(s,e,t,i):r.push(s,t,e,i),r[0].x<r[1].x){let n=r[0];r[0]=r[1],r[1]=n,n=r[2],r[2]=r[3],r[3]=n}if(r[0].y<r[2].y){let n=r[0];r[0]=r[2],r[2]=n,n=r[1],r[1]=r[3],r[3]=n}return r}getFurniData(s,t,e,i){const r=[];let n=t.getSortableSpriteList();const a=e.getRoomObjects(e.activeRoomId,D.UNIT);for(const o of a)if(o.id!==i){const h=o.visualization.getSpriteList();if(h){let u=0,c=0;for(const _ of n)if(_.name==="avatar_"+o.id){u=_.z,c=_.y+_.height-t.geometry.scale/4;break}const l=e.getRoomObjectScreenLocation(e.activeRoomId,o.id,D.UNIT,t.id);if(l){c===0&&(c=l.y);for(const _ of h)_.x=_.x+(l.x-t.screenOffsetX),_.y=_.y+c,_.z=_.z+u,(_.name.indexOf("h_std_fx29_")===0||_.name.indexOf("h_std_fx185_")===0)&&(_.y=_.y+ei.AVATAR_WATER_EFFECT_MAGIC_Y_OFFSET),n.push(_)}}}n=ei.addMannequinSprites(n,e),n.sort(ei.sortSpriteDataObjects);for(const o of n)o.name!==null&&o.name.length>0&&o.name.indexOf("tile_cursor_")!==0&&ei.isSpriteInViewPort(o,s,t)&&(i<0||o.objectId!=i)&&(r.push(this.getSpriteDataObject(o,s,t,e)),this.maxZ||(this.maxZ=o.z),this.spriteCount++);return JSON.stringify(r)}getRoomRenderingModifiers(s){return JSON.stringify(new Object)}getSpriteDataObject(s,t,e,i){let r=[];const n={};let a=s.name;return s.name.indexOf("@")!==-1&&(r=s.name.split("@"),a=r[0],r[1]),n.name=a,n.x=s.x-t.x,n.y=s.y-t.y,n.x=n.x+e.screenOffsetX,n.y=n.y+e.screenOffsetY,n.z=s.z,s.alpha&&s.alpha.toString()!=="255"&&(n.alpha=s.alpha),s.flipH&&(n.flipH=s.flipH),s.skew&&(n.skew=s.skew),s.frame&&(n.frame=s.frame),s.color&&s.color.length>0&&(n.color=parseInt(s.color)),s.blendMode&&s.blendMode!=="normal"&&(n.blendMode=s.blendMode),a.indexOf("http")===0&&(n.width=s.width,n.height=s.height,this.externalImageCount++,this.externalImageCount>ei.MAX_EXTERNAL_IMAGE_COUNT&&(n.name="box")),s.posture&&(n.posture=s.posture),n}makeBackgroundPlane(s,t,e){const i=new H(0,0),r=new H(s.width,0),n=new H(0,s.height),a=new H(s.width,s.height),o=ei.sortQuadPoints(i,r,n,a);let h=0;e.length>0?(h=e[0].z,this.maxZ&&(h=Math.max(this.maxZ,h))):h=this.maxZ?this.maxZ:0,h=h+(this.spriteCount*1.776104+e.length*2.31743);const u=new Oo(null,t);return u.cornerPoints=o,u.z=h,u}sortRoomPlanes(s,t,e){const i=new Map;let r=1;this.maxZ&&(r=r+this.maxZ);for(const o of s){const h={plane:o,z:r};i.set(o.uniqueId,h)}const n=t.getPlaneSortableSprites();n.sort((o,h)=>h.z-o.z),n.reverse();let a=[];for(const o of n){const h=o.sprite;if(h){const u=i.get(h.id);u&&(i.delete(h.id),u.z=o.z,a.push(u))}}return a=a.concat(Array.from(i.values())),a}getRoomPlanes(s,t,e,i){const r=[],a=e.getRoomObject(e.activeRoomId,Os.ROOM_OBJECT_ID,D.ROOM).visualization;if(a){const o=t.geometry,h=this.sortRoomPlanes(a.planes,t,e),u=Ae.instance.stage;for(const c of h){const l=c.plane,_=[],d=S.sum(l.location,l.leftSide),g=o.getScreenPoint(l.location),m=o.getScreenPoint(d),p=o.getScreenPoint(S.sum(l.location,l.rightSide)),T=o.getScreenPoint(S.sum(d,l.rightSide));_.push(g,m,p,T);let A=0,O=0;for(const v of _)v.x+=u.width/2,v.y+=u.height/2,v.x+=t.screenOffsetX,v.y+=t.screenOffsetY,v.x+=-s.x,v.y+=-s.y,v.x<0?A--:v.x>=s.width&&A++,v.y<0?O--:v.y>=s.height&&O++;if(!(Math.abs(A)===4||Math.abs(O)===4)){const v=ei.sortQuadPoints(g,m,p,T);for(const y of l.getDrawingDatas(o))y.cornerPoints=v,y.z=c.z,r.push(y)}}r.unshift(this.makeBackgroundPlane(s,i,r))}return r}};let Fh=ei;Fh.MANNEQUIN_MAGIC_X_OFFSET=1;Fh.MANNEQUIN_MAGIC_Y_OFFSET=-16;Fh.AVATAR_WATER_EFFECT_MAGIC_Y_OFFSET=-52;Fh.MAX_EXTERNAL_IMAGE_COUNT=30;class rq extends cs{constructor(t){super(),this._connection=null,this._roomCreator=t,this._planeParser=new ae,this._latestEntryTileEvent=null,this._currentRoomId=0,this._ownUserId=0,this._initialConnection=!0,this._guideId=-1,this._requesterId=-1}onDispose(){super.onDispose(),this._connection=null,this._roomCreator=null,this._latestEntryTileEvent=null,this._planeParser&&(this._planeParser.dispose(),this._planeParser=null)}setConnection(t){this._connection||!t||(this._connection=t,this._connection.addMessageEvent(new nl(this.onUserInfoEvent.bind(this))),this._connection.addMessageEvent(new Pa(this.onRoomReadyMessageEvent.bind(this))),this._connection.addMessageEvent(new Pd(this.onRoomPaintEvent.bind(this))),this._connection.addMessageEvent(new yd(this.onRoomModelEvent.bind(this))),this._connection.addMessageEvent(new Md(this.onRoomHeightMapEvent.bind(this))),this._connection.addMessageEvent(new Nd(this.onRoomHeightMapUpdateEvent.bind(this))),this._connection.addMessageEvent(new bd(this.onRoomThicknessEvent.bind(this))),this._connection.addMessageEvent(new Cd(this.onRoomDoorEvent.bind(this))),this._connection.addMessageEvent(new cd(this.onRoomRollingEvent.bind(this))),this._connection.addMessageEvent(new _d(this.onObjectsDataUpdateEvent.bind(this))),this._connection.addMessageEvent(new md(this.onFurnitureAliasesEvent.bind(this))),this._connection.addMessageEvent(new fd(this.onFurnitureFloorAddEvent.bind(this))),this._connection.addMessageEvent(new gd(this.onFurnitureFloorEvent.bind(this))),this._connection.addMessageEvent(new Ed(this.onFurnitureFloorRemoveEvent.bind(this))),this._connection.addMessageEvent(new pd(this.onFurnitureFloorUpdateEvent.bind(this))),this._connection.addMessageEvent(new Od(this.onFurnitureWallAddEvent.bind(this))),this._connection.addMessageEvent(new Ad(this.onFurnitureWallEvent.bind(this))),this._connection.addMessageEvent(new vd(this.onFurnitureWallRemoveEvent.bind(this))),this._connection.addMessageEvent(new Sd(this.onFurnitureWallUpdateEvent.bind(this))),this._connection.addMessageEvent(new Id(this.onFurnitureDataEvent.bind(this))),this._connection.addMessageEvent(new Td(this.onItemDataUpdateMessageEvent.bind(this))),this._connection.addMessageEvent(new Rd(this.onOneWayDoorStatusMessageEvent.bind(this))),this._connection.addMessageEvent(new el(this.onRoomUnitDanceEvent.bind(this))),this._connection.addMessageEvent(new Ld(this.onRoomUnitEffectEvent.bind(this))),this._connection.addMessageEvent(new sl(this.onRoomUnitEvent.bind(this))),this._connection.addMessageEvent(new Ud(this.onRoomUnitExpressionEvent.bind(this))),this._connection.addMessageEvent(new xd(this.onRoomUnitHandItemEvent.bind(this))),this._connection.addMessageEvent(new Fd(this.onRoomUnitIdleEvent.bind(this))),this._connection.addMessageEvent(new il(this.onRoomUnitInfoEvent.bind(this))),this._connection.addMessageEvent(new wd(this.onRoomUnitNumberEvent.bind(this))),this._connection.addMessageEvent(new rl(this.onRoomUnitRemoveEvent.bind(this))),this._connection.addMessageEvent(new Gd(this.onRoomUnitStatusEvent.bind(this))),this._connection.addMessageEvent(new Xf(this.onRoomUnitChatEvent.bind(this))),this._connection.addMessageEvent(new $u(this.onRoomUnitChatEvent.bind(this))),this._connection.addMessageEvent(new tl(this.onRoomUnitChatEvent.bind(this))),this._connection.addMessageEvent(new Dd(this.onRoomUnitTypingEvent.bind(this))),this._connection.addMessageEvent(new Ju(this.onPetFigureUpdateEvent.bind(this))),this._connection.addMessageEvent(new eR(this.onPetExperienceEvent.bind(this))),this._connection.addMessageEvent(new rR(this.onYouArePlayingGameEvent.bind(this))),this._connection.addMessageEvent(new dd(this.onDiceValueMessageEvent.bind(this))),this._connection.addMessageEvent(new Zf(this.onIgnoreResultEvent.bind(this))),this._connection.addMessageEvent(new LT(this.onGuideSessionStartedMessageEvent.bind(this))),this._connection.addMessageEvent(new bT(this.onGuideSessionEndedMessageEvent.bind(this))),this._connection.addMessageEvent(new DT(this.onGuideSessionErrorMessageEvent.bind(this))))}setRoomId(t){this._currentRoomId!==0&&this._roomCreator&&this._roomCreator.destroyRoom(this._currentRoomId),this._currentRoomId=t,this._latestEntryTileEvent=null}clearRoomId(){this._currentRoomId=0,this._latestEntryTileEvent=null}onUserInfoEvent(t){if(!(t instanceof nl)||!t.connection)return;const e=t.getParser();e&&(this._ownUserId=e.userInfo.userId)}onRoomReadyMessageEvent(t){const e=t.getParser();if(this._currentRoomId!==e.roomId&&this.setRoomId(e.roomId),this._roomCreator&&this._roomCreator.setRoomInstanceModelName(e.roomId,e.name),this._initialConnection){t.connection.send(new gO),this._initialConnection=!1;return}t.connection.send(new jd)}onRoomPaintEvent(t){if(!(t instanceof Pd))return;const e=t.getParser();if(!e)return;const i=e.floorType,r=e.wallType,n=e.landscapeType;this._roomCreator&&this._roomCreator.updateRoomInstancePlaneType(this._currentRoomId,i,r,n)}onRoomModelEvent(t){if(!(t instanceof yd)||!t.connection||!this._roomCreator)return;const e=t.getParser();if(!e)return;const i=this._roomCreator.getLegacyWallGeometry(this._currentRoomId);if(!i)return;this._planeParser.reset();const r=e.width,n=e.height;this._planeParser.initializeTileMap(r,n);let a=null;this._latestEntryTileEvent&&(a=this._latestEntryTileEvent.getParser());let o=-1,h=-1,u=0,c=0,l=0;for(;l<n;){let g=0;for(;g<r;){const m=e.getHeight(g,l);(l>0&&l<n-1||g>0&&g<r-1)&&m!=ae.TILE_BLOCKED&&(a==null||g==a.x&&l==a.y)&&(e.getHeight(g,l-1)==ae.TILE_BLOCKED&&e.getHeight(g-1,l)==ae.TILE_BLOCKED&&e.getHeight(g,l+1)==ae.TILE_BLOCKED&&(o=g+.5,h=l,u=m,c=90),e.getHeight(g,l-1)==ae.TILE_BLOCKED&&e.getHeight(g-1,l)==ae.TILE_BLOCKED&&e.getHeight(g+1,l)==ae.TILE_BLOCKED&&(o=g,h=l+.5,u=m,c=180)),this._planeParser.setTileHeight(g,l,m),g++}l++}this._planeParser.setTileHeight(Math.floor(o),Math.floor(h),u),this._planeParser.initializeFromTileData(e.wallHeight),this._planeParser.setTileHeight(Math.floor(o),Math.floor(h),u+this._planeParser.wallHeight),e.scale===64?(this._planeParser.restrictsDragging=!0,this._planeParser.restrictsScaling=!0,this._planeParser.restrictedScale=.5):(this._planeParser.restrictsDragging=!1,this._planeParser.restrictsScaling=!1,this._planeParser.restrictedScale=1),i.scale=Za.DEFAULT_SCALE,i.initialize(r,n,this._planeParser.floorHeight);let _=e.height-1;for(;_>=0;){let g=e.width-1;for(;g>=0;)i.setHeight(g,_,this._planeParser.getTileHeight(g,_)),g--;_--}const d=this._planeParser.getMapData();d.doors.push({x:o,y:h,z:u,dir:c}),this._roomCreator.createRoomInstance(this._currentRoomId,d)}onRoomHeightMapEvent(t){if(!(t instanceof Md)||!t.connection||!this._roomCreator)return;const e=t.getParser();if(!e)return;const i=e.width,r=e.height,n=new tq(i,r);let a=0;for(;a<r;){let o=0;for(;o<i;)n.setTileHeight(o,a,e.getTileHeight(o,a)),n.setStackingBlocked(o,a,e.getStackingBlocked(o,a)),n.setIsRoomTile(o,a,e.isRoomTile(o,a)),o++;a++}this._roomCreator.setFurnitureStackingHeightMap(this._currentRoomId,n)}onRoomHeightMapUpdateEvent(t){if(!(t instanceof Nd)||!t.connection||!this._roomCreator)return;const e=t.getParser();if(!e)return;const i=this._roomCreator.getFurnitureStackingHeightMap(this._currentRoomId);if(i){for(;e.next();)i.setTileHeight(e.x,e.y,e.tileHeight()),i.setStackingBlocked(e.x,e.y,e.isStackingBlocked()),i.setIsRoomTile(e.x,e.y,e.isRoomTile());this._roomCreator.refreshTileObjectMap(this._currentRoomId,"RoomMessageHandler.onRoomHeightMapUpdateEvent()")}}onRoomThicknessEvent(t){if(!(t instanceof bd))return;const e=t.getParser();if(!e)return;const i=!e.hideWalls,r=!0,n=e.thicknessWall,a=e.thicknessFloor;this._roomCreator&&(this._roomCreator.updateRoomInstancePlaneVisibility(this._currentRoomId,i,r),this._roomCreator.updateRoomInstancePlaneThickness(this._currentRoomId,n,a))}onRoomDoorEvent(t){t instanceof Cd&&(this._latestEntryTileEvent=t)}onRoomRollingEvent(t){if(!(t instanceof cd)||!t.connection||!this._roomCreator)return;const e=t.getParser();this._roomCreator.updateRoomObjectFloor(this._currentRoomId,e.rollerId,null,null,1,null),this._roomCreator.updateRoomObjectFloor(this._currentRoomId,e.rollerId,null,null,2,null);const i=e.itemsRolling;if(i&&i.length)for(const n of i)n&&this._roomCreator.rollRoomObjectFloor(this._currentRoomId,n.id,n.location,n.targetLocation);const r=e.unitRolling;if(r){this._roomCreator.updateRoomObjectUserLocation(this._currentRoomId,r.id,r.location,r.targetLocation);const n=this._roomCreator.getRoomObjectUser(this._currentRoomId,r.id);if(n&&n.type!==ft.MONSTER_PLANT){let a="std";switch(r.movementType){case Hi.MOVE:a="mv";break;case Hi.SLIDE:a="std";break}this._roomCreator.updateRoomObjectUserPosture(this._currentRoomId,r.id,a)}}}onObjectsDataUpdateEvent(t){if(!(t instanceof _d)||!t.connection||!this._roomCreator)return;const e=t.getParser();if(e)for(const i of e.objects)this._roomCreator.updateRoomObjectFloor(this._currentRoomId,i.id,null,null,i.state,i.data)}onFurnitureAliasesEvent(t){!(t instanceof md)||!t.connection||!this._roomCreator||(t.getParser().aliases,this._connection.send(new jd))}onFurnitureFloorAddEvent(t){if(!(t instanceof fd)||!t.connection||!this._roomCreator)return;const e=t.getParser().item;e&&this.addRoomObjectFurnitureFloor(this._currentRoomId,e)}onFurnitureFloorEvent(t){if(!(t instanceof gd)||!t.connection||!this._roomCreator)return;const e=t.getParser();if(!e)return;const i=e.items.length;let r=0;for(;r<i;){const n=e.items[r];n&&this.addRoomObjectFurnitureFloor(this._currentRoomId,n),r++}}onFurnitureFloorRemoveEvent(t){if(!(t instanceof Ed)||!t.connection||!this._roomCreator)return;const e=t.getParser();e&&(e.delay>0?setTimeout(()=>{this._roomCreator.removeRoomObjectFloor(this._currentRoomId,e.itemId,e.isExpired?-1:e.userId,!0)},e.delay):this._roomCreator.removeRoomObjectFloor(this._currentRoomId,e.itemId,e.isExpired?-1:e.userId,!0))}onFurnitureFloorUpdateEvent(t){if(!(t instanceof pd)||!t.connection||!this._roomCreator)return;const e=t.getParser().item;if(!e)return;const i=new S(e.x,e.y,e.z),r=new S(e.direction);this._roomCreator.updateRoomObjectFloor(this._currentRoomId,e.itemId,i,r,e.data.state,e.data,e.extra),this._roomCreator.updateRoomObjectFloorHeight(this._currentRoomId,e.itemId,e.stackHeight),this._roomCreator.updateRoomObjectFloorExpiration(this._currentRoomId,e.itemId,e.expires)}onFurnitureWallAddEvent(t){if(!(t instanceof Od)||!t.connection||!this._roomCreator)return;const e=t.getParser().item;e&&this.addRoomObjectFurnitureWall(this._currentRoomId,e)}onFurnitureWallEvent(t){if(!(t instanceof Ad)||!t.connection||!this._roomCreator)return;const e=t.getParser();if(!e)return;const i=e.items.length;let r=0;for(;r<i;){const n=e.items[r];n&&this.addRoomObjectFurnitureWall(this._currentRoomId,n),r++}}onFurnitureWallRemoveEvent(t){if(!(t instanceof vd)||!t.connection||!this._roomCreator)return;const e=t.getParser();e&&this._roomCreator.removeRoomObjectWall(this._currentRoomId,e.itemId,e.userId)}onFurnitureWallUpdateEvent(t){if(!(t instanceof Sd)||!t.connection||!this._roomCreator)return;const e=this._roomCreator.getLegacyWallGeometry(this._currentRoomId);if(!e)return;const i=t.getParser().item;if(!i)return;const r=e.getLocation(i.width,i.height,i.localX,i.localY,i.direction),n=new S(e.getDirection(i.direction));this._roomCreator.updateRoomObjectWall(this._currentRoomId,i.itemId,r,n,i.state,i.stuffData),this._roomCreator.updateRoomObjectWallExpiration(this._currentRoomId,i.itemId,i.secondsToExpiration)}onFurnitureDataEvent(t){if(!(t instanceof Id)||!t.connection||!this._roomCreator)return;const e=t.getParser();this._roomCreator.updateRoomObjectFloor(this._currentRoomId,e.furnitureId,null,null,e.objectData.state,e.objectData)}onItemDataUpdateMessageEvent(t){if(!(t instanceof Td)||!t.connection||!this._roomCreator)return;const e=t.getParser();this._roomCreator.updateRoomObjectWallItemData(this._currentRoomId,e.furnitureId,e.data)}onOneWayDoorStatusMessageEvent(t){if(!(t instanceof Rd)||!t.connection||!this._roomCreator)return;const e=t.getParser();this._roomCreator.updateRoomObjectFloor(this._currentRoomId,e.itemId,null,null,e.state,new _s)}onDiceValueMessageEvent(t){if(!(t instanceof dd)||!t.connection||!this._roomCreator)return;const e=t.getParser();this._roomCreator.updateRoomObjectFloor(this._currentRoomId,e.itemId,null,null,e.value,new _s)}onRoomUnitDanceEvent(t){!(t instanceof el)||!t.connection||!this._roomCreator||this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,t.getParser().unitId,I.FIGURE_DANCE,t.getParser().danceId)}onRoomUnitEffectEvent(t){!(t instanceof Ld)||!t.connection||!this._roomCreator||this._roomCreator.updateRoomObjectUserEffect(this._currentRoomId,t.getParser().unitId,t.getParser().effectId,t.getParser().delay)}onRoomUnitEvent(t){if(!(t instanceof sl)||!t.connection||!this._roomCreator)return;const e=t.getParser().users;if(!(!e||!e.length)){for(const i of e){if(!i)continue;const r=new S(i.x,i.y,i.z),n=new S(i.dir);this._roomCreator.addRoomObjectUser(this._currentRoomId,i.roomIndex,r,n,i.dir,i.userType,i.figure),i.webID===this._ownUserId&&(this._roomCreator.setRoomSessionOwnUser(this._currentRoomId,i.roomIndex),this._roomCreator.updateRoomObjectUserOwn(this._currentRoomId,i.roomIndex)),this._roomCreator.updateRoomObjectUserFigure(this._currentRoomId,i.roomIndex,i.figure,i.sex,i.subType,i.isRiding),ft.getTypeString(i.userType)===ft.PET&&this._roomCreator.getPetTypeId(i.figure)===St.MONSTERPLANT&&this._roomCreator.updateRoomObjectUserPosture(this._currentRoomId,i.roomIndex,i.petPosture),this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,i.roomIndex,I.FIGURE_IS_MUTED,this._roomCreator.sessionDataManager.isUserIgnored(i.name)?1:0)}this.updateGuideMarker()}}onRoomUnitExpressionEvent(t){!(t instanceof Ud)||!t.connection||!this._roomCreator||this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,t.getParser().unitId,I.FIGURE_EXPRESSION,t.getParser().expression)}onRoomUnitHandItemEvent(t){!(t instanceof xd)||!t.connection||!this._roomCreator||this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,t.getParser().unitId,I.FIGURE_CARRY_OBJECT,t.getParser().handId)}onRoomUnitIdleEvent(t){!(t instanceof Fd)||!t.connection||!this._roomCreator||this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,t.getParser().unitId,I.FIGURE_SLEEP,t.getParser().isIdle?1:0)}onRoomUnitInfoEvent(t){!(t instanceof il)||!t.connection||!this._roomCreator||this._roomCreator.updateRoomObjectUserFigure(this._currentRoomId,t.getParser().unitId,t.getParser().figure,t.getParser().gender)}onRoomUnitNumberEvent(t){if(!(t instanceof wd)||!t.connection||!this._roomCreator)return;const e=t.getParser();e&&this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,e.unitId,I.FIGURE_NUMBER_VALUE,e.value)}onRoomUnitRemoveEvent(t){!(t instanceof rl)||!t.connection||!this._roomCreator||(this._roomCreator.removeRoomObjectUser(this._currentRoomId,t.getParser().unitId),this.updateGuideMarker())}onRoomUnitStatusEvent(t){if(!(t instanceof Gd)||!t.connection||!this._roomCreator)return;const e=t.getParser().statuses;if(!e||!e.length)return;const i=this._roomCreator.getRoomInstance(this._currentRoomId);if(!i)return;const r=i.model.getValue(Vt.ROOM_Z_SCALE)||1;for(const n of e){if(!n)continue;let a=n.height;a&&(a=a/r);const o=new S(n.x,n.y,n.z+a),h=new S(n.direction);let u=null;n.didMove&&(u=new S(n.targetX,n.targetY,n.targetZ)),this._roomCreator.updateRoomObjectUserLocation(this._currentRoomId,n.id,o,u,n.canStandUp,a,h,n.headDirection),this._roomCreator.updateRoomObjectUserFlatControl(this._currentRoomId,n.id,null);let c=!0,l=!1,_=I.STD,d="";if(n.actions&&n.actions.length){for(const g of n.actions)if(g)switch(g.action){case"flatctrl":this._roomCreator.updateRoomObjectUserFlatControl(this._currentRoomId,n.id,g.value);break;case"sign":n.actions.length===1&&(c=!1),this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,n.id,I.FIGURE_SIGN,parseInt(g.value));break;case"gst":n.actions.length===1&&(c=!1),this._roomCreator.updateRoomObjectUserPetGesture(this._currentRoomId,n.id,g.value);break;case"wav":case"mv":l=!0,_=g.action,d=g.value;break;case"trd":break;default:l=!0,_=g.action,d=g.value;break}}l?this._roomCreator.updateRoomObjectUserPosture(this._currentRoomId,n.id,_,d):c&&this._roomCreator.updateRoomObjectUserPosture(this._currentRoomId,n.id,I.STD,"")}this.updateGuideMarker()}onRoomUnitChatEvent(t){if(!t.connection||!this._roomCreator)return;const e=t.getParser();e&&(this._roomCreator.updateRoomObjectUserGesture(this._currentRoomId,e.roomIndex,e.gesture),this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,e.roomIndex,I.FIGURE_TALK,e.message.length/10))}onRoomUnitTypingEvent(t){!(t instanceof Dd)||!t.connection||!this._roomCreator||this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,t.getParser().unitId,I.FIGURE_IS_TYPING,t.getParser().isTyping?1:0)}onPetFigureUpdateEvent(t){if(!(t instanceof Ju)||!t.connection||!this._roomCreator)return;const e=t.getParser();e&&this._roomCreator.updateRoomObjectUserFigure(this._currentRoomId,e.roomIndex,e.figureData.figuredata,"","",e.isRiding)}onPetExperienceEvent(t){const e=t.getParser();e&&this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,e.roomIndex,I.FIGURE_GAINED_EXPERIENCE,e.gainedExperience)}onYouArePlayingGameEvent(t){if(!t)return;const e=t.getParser();e&&this._roomCreator.setRoomEngineGameMode(this._currentRoomId,e.isPlaying)}addRoomObjectFurnitureFloor(t,e){if(!e||!this._roomCreator)return;const i=new S(e.x,e.y,e.z),r=new S(e.direction);e.spriteName?this._roomCreator.addFurnitureFloorByTypeName(t,e.itemId,e.spriteName,i,r,e.state,e.data,e.extra,e.expires,e.usagePolicy,e.userId,e.username,!0,!0,e.stackHeight):this._roomCreator.addFurnitureFloor(t,e.itemId,e.spriteId,i,r,e.state,e.data,e.extra,e.expires,e.usagePolicy,e.userId,e.username,!0,!0,e.stackHeight)}addRoomObjectFurnitureWall(t,e){if(!e||!this._roomCreator)return;const i=this._roomCreator.getLegacyWallGeometry(t);if(!i)return;let r=null;e.isOldFormat||(r=i.getLocation(e.width,e.height,e.localX,e.localY,e.direction));const n=new S(i.getDirection(e.direction));this._roomCreator.addFurnitureWall(t,e.itemId,e.spriteId,r,n,e.state,e.stuffData,e.secondsToExpiration,e.usagePolicy,e.userId,e.username)}onIgnoreResultEvent(t){if(!t)return;const e=t.getParser();if(!e)return;const i=this._roomCreator.roomSessionManager.getSession(this._currentRoomId);if(!i)return;const r=i.userDataManager.getUserDataByName(e.name);if(r)switch(e.result){case 1:case 2:this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,r.roomIndex,I.FIGURE_IS_MUTED,1);return;case 3:this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,r.roomIndex,I.FIGURE_IS_MUTED,0);return}}onGuideSessionStartedMessageEvent(t){const e=t.getParser();this._guideId=e.guideUserId,this._requesterId=e.requesterUserId,this.updateGuideMarker()}onGuideSessionEndedMessageEvent(t){this.removeGuideMarker()}onGuideSessionErrorMessageEvent(t){this.removeGuideMarker()}updateGuideMarker(){const t=this._roomCreator.sessionDataManager.userId;this.setUserGuideStatus(this._guideId,this._requesterId===t?Gs.GUIDE:Gs.NONE),this.setUserGuideStatus(this._requesterId,this._guideId===t?Gs.REQUESTER:Gs.NONE)}removeGuideMarker(){this.setUserGuideStatus(this._guideId,Gs.NONE),this.setUserGuideStatus(this._requesterId,Gs.NONE),this._guideId=-1,this._requesterId=-1}setUserGuideStatus(t,e){if(!this._roomCreator||!this._roomCreator.roomSessionManager)return;const i=this._roomCreator.roomSessionManager.getSession(this._currentRoomId);if(!i)return;const r=i.userDataManager.getDataByType(t,Vs.USER);r&&this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,r.roomIndex,I.FIGURE_GUIDE_STATUS,e)}get currentRoomId(){return this._currentRoomId}}class nq extends cs{constructor(t){super(),this._roomEngine=t,this._eventIds=new Map,this._selectedAvatarId=-1,this._selectedObjectId=-1,this._selectedObjectCategory=-2,this._whereYouClickIsWhereYouGo=!0,this._objectPlacementSource=null,this.onRoomEngineObjectEvent=this.onRoomEngineObjectEvent.bind(this),this._roomEngine.events.addEventListener(Q.ADDED,this.onRoomEngineObjectEvent)}dispose(){this._eventIds&&(this._eventIds=null),this._roomEngine.events.removeEventListener(Q.ADDED,this.onRoomEngineObjectEvent),this._roomEngine=null}onRoomEngineObjectEvent(t){let e=this.getSelectedRoomObjectData(t.roomId);if(e&&e.operation===at.OBJECT_PLACE&&e.id===t.objectId){const i=this._roomEngine.getRoomObject(t.roomId,e.id,e.category);if(i&&i.model&&e.category===D.FLOOR){const r=i.model.getValue(I.FURNITURE_ALLOWED_DIRECTIONS);if(r&&r.length){const n=new S(r[0]);if(i.setDirection(n),this.updateSelectedObjectData(t.roomId,e.id,e.category,e.loc,n,e.operation,e.typeId,e.instanceData,e.stuffData,e.state,e.animFrame,e.posture),e=this.getSelectedRoomObjectData(t.roomId),!e)return}}this.setFurnitureAlphaMultiplier(i,.5)}}processRoomCanvasMouseEvent(t,e,i){if(!t||!e||Ue.isRunning())return;const r=e.type;let n=this._roomEngine.getRoomObjectCategoryForType(r);if(n!==D.ROOM&&(!this._roomEngine.isPlayingGame()||n!==D.UNIT)&&(n=D.MINIMUM),this.getMouseEventId(n,t.type)===t.eventId){if(t.type===k.MOUSE_CLICK||t.type===k.DOUBLE_CLICK||t.type===k.MOUSE_DOWN||t.type===k.MOUSE_UP||t.type===k.MOUSE_MOVE)return}else t.eventId&&this.setMouseEventId(n,t.type,t.eventId);e.mouseHandler&&e.mouseHandler.mouseEvent(t,i)}processRoomObjectPlacement(t,e,i,r,n,a=null,o=null,h=-1,u=-1,c=null){this._objectPlacementSource=t;const l=new S(-100,-100),_=new S(0);return this.setSelectedRoomObjectData(e,i,r,l,_,at.OBJECT_PLACE,n,a,o,h,u,c),this._roomEngine&&(this._roomEngine.setObjectMoverIconSprite(n,r,!1,a,o,h,u,c),this._roomEngine.setObjectMoverIconSpriteVisible(!1)),!0}cancelRoomObjectInsert(t){return this.resetSelectedObjectData(t),!0}getMouseEventId(t,e){const i=this._eventIds.get(t);return i&&i.get(e)||null}setMouseEventId(t,e,i){let r=this._eventIds.get(t);r||(r=new Map,this._eventIds.set(t,r)),r.delete(e),r.set(e,i)}handleRoomObjectEvent(t,e){if(t){if(t instanceof $){this.handleRoomObjectMouseEvent(t,e);return}switch(t.type){case Tt.STATE_CHANGE:case Tt.STATE_RANDOM:this.onRoomObjectStateChangedEvent(t,e);return;case Oa.DIMMER_STATE:this.onRoomObjectDimmerStateUpdateEvent(t,e);return;case Xe.POSITION_CHANGED:case Xe.OBJECT_REMOVED:this.handleSelectedObjectRemove(t,e);return;case M.OPEN_WIDGET:case M.CLOSE_WIDGET:case M.OPEN_FURNI_CONTEXT_MENU:case M.CLOSE_FURNI_CONTEXT_MENU:case M.PLACEHOLDER:case M.CREDITFURNI:case M.STACK_HEIGHT:case M.EXTERNAL_IMAGE:case M.STICKIE:case M.PRESENT:case M.TROPHY:case M.TEASER:case M.ECOTRONBOX:case M.DIMMER:case M.WIDGET_REMOVE_DIMMER:case M.CLOTHING_CHANGE:case M.JUKEBOX_PLAYLIST_EDITOR:case M.MANNEQUIN:case M.PET_PRODUCT_MENU:case M.GUILD_FURNI_CONTEXT_MENU:case M.MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG:case M.PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG:case M.BACKGROUND_COLOR:case M.MYSTERYBOX_OPEN_DIALOG:case M.EFFECTBOX_OPEN_DIALOG:case M.MYSTERYTROPHY_OPEN_DIALOG:case M.ACHIEVEMENT_RESOLUTION_OPEN:case M.ACHIEVEMENT_RESOLUTION_ENGRAVING:case M.ACHIEVEMENT_RESOLUTION_FAILED:case M.FRIEND_FURNITURE_CONFIRM:case M.FRIEND_FURNITURE_ENGRAVING:case M.BADGE_DISPLAY_ENGRAVING:case M.HIGH_SCORE_DISPLAY:case M.HIDE_HIGH_SCORE_DISPLAY:case M.INERNAL_LINK:case M.ROOM_LINK:case M.YOUTUBE:this.onRoomObjectWidgetRequestEvent(t,e);return;case G.DICE_ACTIVATE:case G.DICE_OFF:case G.USE_HABBOWHEEL:case G.STICKIE:case G.ENTER_ONEWAYDOOR:this.onRoomObjectFurnitureActionEvent(t,e);return;case G.SOUND_MACHINE_INIT:case G.SOUND_MACHINE_START:case G.SOUND_MACHINE_STOP:case G.SOUND_MACHINE_DISPOSE:this.handleObjectSoundMachineEvent(t,e);return;case G.JUKEBOX_INIT:case G.JUKEBOX_START:case G.JUKEBOX_MACHINE_STOP:case G.JUKEBOX_DISPOSE:this.handleObjectJukeboxEvent(t,e);return;case ze.ADD_HOLE:case ze.REMOVE_HOLE:this.onRoomObjectFloorHoleEvent(t,e);return;case kt.ROOM_AD_FURNI_CLICK:case kt.ROOM_AD_FURNI_DOUBLE_CLICK:case kt.ROOM_AD_TOOLTIP_SHOW:case kt.ROOM_AD_TOOLTIP_HIDE:case kt.ROOM_AD_LOAD_IMAGE:this.onRoomObjectRoomAdEvent(t,e);return;case gi.LOAD_BADGE:this.onRoomObjectBadgeAssetEvent(t,e);return;case G.MOUSE_ARROW:case G.MOUSE_BUTTON:this.handleMousePointer(t,e);return;case ki.PLAY_SOUND:case ki.PLAY_SOUND_AT_PITCH:this.handleRoomObjectPlaySoundEvent(t,e);return;case ne.ROOM_OBJECT_INITIALIZED:case ne.ROOM_OBJECT_DISPOSED:case ne.PLAY_SAMPLE:case ne.CHANGE_PITCH:this.handleRoomObjectSamplePlaybackEvent(t,e);return;case Ir.ROOM_BACKGROUND_COLOR:this.onHSLColorEnableEvent(t,e);return;case Cs.RODRE_CURRENT_USER_ID:case Cs.RODRE_URL_PREFIX:this.onRoomObjectDataRequestEvent(t,e);return;default:Y.warn("Unhandled Event",t.constructor.name,"Object ID",t.object.id);return}}}handleRoomObjectMouseEvent(t,e){if(!(!t||!t.type))switch(t.type){case $.CLICK:this.handleRoomObjectMouseClickEvent(t,e);return;case $.DOUBLE_CLICK:this.handleRoomObjectMouseDoubleClickEvent(t,e);return;case $.MOUSE_MOVE:this.handleRoomObjectMouseMoveEvent(t,e);return;case $.MOUSE_DOWN:this.handleRoomObjectMouseDownEvent(t,e);return;case $.MOUSE_DOWN_LONG:this.handleRoomObjectMouseDownLongEvent(t,e);return;case $.MOUSE_ENTER:this.handleRoomObjectMouseEnterEvent(t,e);return;case $.MOUSE_LEAVE:this.handleRoomObjectMouseLeaveEvent(t,e);return}}handleRoomObjectMouseClickEvent(t,e){if(!t)return;let i=at.OBJECT_UNDEFINED;const r=this.getSelectedRoomObjectData(e);r&&(i=r.operation);let n=!1,a=!1;this._whereYouClickIsWhereYouGo&&(!i||i===at.OBJECT_UNDEFINED)&&(n=this.handleMoveTargetFurni(e,t));const o=this._roomEngine.getRoomObjectCategoryForType(t.objectType);switch(i){case at.OBJECT_MOVE:o===D.ROOM?r&&this.modifyRoomObject(e,r.id,r.category,at.OBJECT_MOVE_TO):o===D.UNIT&&(r&&t.objectType===ft.MONSTER_PLANT&&this.modifyRoomObject(e,r.id,r.category,at.OBJECT_MOVE_TO),t.eventId&&this.setMouseEventId(D.ROOM,k.MOUSE_CLICK,t.eventId),this.placeObjectOnUser(e,t.objectId,o)),a=!0,t.objectId!==-1&&this.setSelectedObject(e,t.objectId,o);break;case at.OBJECT_PLACE:if(o===D.ROOM)this.placeObject(e,t instanceof vi,t instanceof Kn);else if(o===D.UNIT)switch(t.objectType){case ft.MONSTER_PLANT:case ft.RENTABLE_BOT:this.placeObject(e,t instanceof vi,t instanceof Kn);break;default:t.eventId&&this.setMouseEventId(D.ROOM,k.MOUSE_CLICK,t.eventId),this.placeObjectOnUser(e,t.objectId,o);break}break;case at.OBJECT_UNDEFINED:o===D.ROOM?!n&&t instanceof vi&&this.onRoomObjectTileMouseEvent(e,t):(this.setSelectedObject(e,t.objectId,o),a=!1,o===D.UNIT?(t.ctrlKey&&!t.altKey&&!t.shiftKey&&t.objectType===ft.RENTABLE_BOT?this.modifyRoomObject(e,t.objectId,o,at.OBJECT_PICKUP_BOT):t.ctrlKey&&!t.altKey&&!t.shiftKey&&t.objectType===ft.MONSTER_PLANT?this.modifyRoomObject(e,t.objectId,o,at.OBJECT_PICKUP_PET):!t.ctrlKey&&!t.altKey&&t.shiftKey&&t.objectType===ft.MONSTER_PLANT&&this.modifyRoomObject(e,t.objectId,o,at.OBJECT_ROTATE_POSITIVE),this._roomEngine.isPlayingGame()?a=!0:n=!0):(o===D.FLOOR||o===D.WALL)&&(t.altKey||t.ctrlKey||t.shiftKey)&&(!t.ctrlKey&&!t.altKey&&t.shiftKey?o===D.FLOOR&&this._roomEngine.events&&this._roomEngine.events.dispatchEvent(new Q(Q.REQUEST_ROTATE,e,t.objectId,o)):t.ctrlKey&&!t.altKey&&!t.shiftKey&&this.modifyRoomObject(e,t.objectId,o,at.OBJECT_PICKUP),this._roomEngine.isPlayingGame()?a=!0:n=!0),t.eventId&&(n&&this.setMouseEventId(D.ROOM,k.MOUSE_CLICK,t.eventId),a&&this.setMouseEventId(D.MINIMUM,k.MOUSE_CLICK,t.eventId)));break}if(o===D.ROOM){const h=this.getMouseEventId(D.MINIMUM,k.MOUSE_CLICK),u=this.getMouseEventId(D.UNIT,k.MOUSE_CLICK);h!==t.eventId&&u!==t.eventId&&!a&&(this.deselectObject(e),this._roomEngine.events&&this._roomEngine.events.dispatchEvent(new Q(Q.DESELECTED,e,-1,D.MINIMUM)),this.setSelectedAvatar(e,0,!1))}}handleRoomObjectMouseDoubleClickEvent(t,e){const i=t.objectId,r=t.objectType,n=this._roomEngine.getRoomObjectCategoryForType(r);this._roomEngine.events&&this._roomEngine.events.dispatchEvent(new Q(Q.DOUBLE_CLICK,e,i,n))}handleRoomObjectMouseMoveEvent(t,e){if(!t)return;let i=at.OBJECT_UNDEFINED;const r=this.getSelectedRoomObjectData(e);r&&(i=r.operation);const n=this._roomEngine.getRoomObjectCategoryForType(t.objectType);if(this._roomEngine){const a=this._roomEngine.getRoomObjectCursor(e);if(a&&a.logic){let o=null;t instanceof vi?o=this.handleMouseOverTile(t,e):t.object&&t.object.id!==-1?this._whereYouClickIsWhereYouGo&&(o=this.handleMouseOverObject(n,e,t)):o=new Zn(null,0,!1,t.eventId),a.processUpdateMessage(o)}}switch(i){case at.OBJECT_MOVE:n===D.ROOM&&this.handleObjectMove(t,e);return;case at.OBJECT_PLACE:n===D.ROOM&&this.handleObjectPlace(t,e);return}}handleRoomObjectMouseDownEvent(t,e){if(!t)return;let i=at.OBJECT_UNDEFINED;const r=this.getSelectedRoomObjectData(e);r&&(i=r.operation);const n=this._roomEngine.getRoomObjectCategoryForType(t.objectType);switch(i){case at.OBJECT_UNDEFINED:(n===D.FLOOR||n===D.WALL||t.objectType===ft.MONSTER_PLANT)&&(t.altKey&&!t.ctrlKey&&!t.shiftKey||this.decorateModeMove(t))&&this._roomEngine.events&&this._roomEngine.events.dispatchEvent(new Q(Q.REQUEST_MOVE,e,t.objectId,n));return}}handleRoomObjectMouseDownLongEvent(t,e){if(!t)return;let i=at.OBJECT_UNDEFINED;const r=this.getSelectedRoomObjectData(e);r&&(i=r.operation);const n=this._roomEngine.getRoomObjectCategoryForType(t.objectType);switch(i){case at.OBJECT_UNDEFINED:(n===D.FLOOR||n===D.WALL||t.objectType===ft.MONSTER_PLANT)&&(!t.ctrlKey&&!t.shiftKey||this.decorateModeMove(t))&&this._roomEngine.events&&this._roomEngine.events.dispatchEvent(new Q(Q.REQUEST_MANIPULATION,e,t.objectId,n));return}}handleRoomObjectMouseEnterEvent(t,e){const i=t.objectId,r=t.objectType,n=this._roomEngine.getRoomObjectCategoryForType(r);this._roomEngine.events&&this._roomEngine.events.dispatchEvent(new Q(Q.MOUSE_ENTER,e,i,n))}handleRoomObjectMouseLeaveEvent(t,e){const i=t.objectId,r=t.objectType,n=this._roomEngine.getRoomObjectCategoryForType(r);if(n!==D.ROOM&&n===D.UNIT){const a=this._roomEngine.getRoomObjectCursor(e);a&&a.processUpdateMessage(new Ft(0,null))}this._roomEngine.events&&this._roomEngine.events.dispatchEvent(new Q(Q.MOUSE_LEAVE,e,i,n))}onRoomObjectStateChangedEvent(t,e){if(t)switch(t.type){case Tt.STATE_CHANGE:this.changeObjectState(e,t.object.id,t.object.type,t.state,!1);return;case Tt.STATE_RANDOM:this.changeObjectState(e,t.object.id,t.object.type,t.state,!0);return}}onRoomObjectDimmerStateUpdateEvent(t,e){if(t)switch(t.type){case Oa.DIMMER_STATE:this._roomEngine.events.dispatchEvent(new sI(e,t.state,t.presetId,t.effectId,t.color,t.brightness));return}}handleSelectedObjectRemove(t,e){if(!(!t||!this._roomEngine))switch(t.type){case Xe.POSITION_CHANGED:{const i=t.objectId,r=t.objectType,n=this._roomEngine.getRoomObjectCategoryForType(r),a=this._roomEngine.getRoomObject(e,i,n),o=this._roomEngine.getRoomObjectSelectionArrow(e);if(a&&o&&o.logic){const h=a.getLocation();o.logic.processUpdateMessage(new me(h,null))}return}case Xe.OBJECT_REMOVED:this.setSelectedAvatar(e,0,!1);return}}onRoomObjectWidgetRequestEvent(t,e){if(!t||!this._roomEngine)return;const i=t.objectId,r=t.objectType,n=this._roomEngine.getRoomObjectCategoryForType(r),a=this._roomEngine.events;if(a&&!bf.isRoomPreviewerId(e))switch(t.type){case M.OPEN_WIDGET:a.dispatchEvent(new B(B.OPEN_WIDGET,e,i,n,t.object.logic.widget));return;case M.CLOSE_WIDGET:a.dispatchEvent(new B(B.CLOSE_WIDGET,e,i,n,t.object.logic.widget));return;case M.OPEN_FURNI_CONTEXT_MENU:a.dispatchEvent(new B(B.OPEN_FURNI_CONTEXT_MENU,e,i,n,t.object.logic.contextMenu));return;case M.CLOSE_FURNI_CONTEXT_MENU:a.dispatchEvent(new B(B.CLOSE_FURNI_CONTEXT_MENU,e,i,n));return;case M.PLACEHOLDER:a.dispatchEvent(new B(B.REQUEST_PLACEHOLDER,e,i,n));return;case M.CREDITFURNI:a.dispatchEvent(new B(B.REQUEST_CREDITFURNI,e,i,n));return;case M.STACK_HEIGHT:a.dispatchEvent(new B(B.REQUEST_STACK_HEIGHT,e,i,n));return;case M.EXTERNAL_IMAGE:a.dispatchEvent(new B(B.REQUEST_EXTERNAL_IMAGE,e,i,n));return;case M.STICKIE:a.dispatchEvent(new B(B.REQUEST_STICKIE,e,i,n));return;case M.PRESENT:a.dispatchEvent(new B(B.REQUEST_PRESENT,e,i,n));return;case M.TROPHY:a.dispatchEvent(new B(B.REQUEST_TROPHY,e,i,n));return;case M.TEASER:a.dispatchEvent(new B(B.REQUEST_TEASER,e,i,n));return;case M.ECOTRONBOX:a.dispatchEvent(new B(B.REQUEST_ECOTRONBOX,e,i,n));return;case M.DIMMER:a.dispatchEvent(new B(B.REQUEST_DIMMER,e,i,n));return;case M.WIDGET_REMOVE_DIMMER:a.dispatchEvent(new B(B.REMOVE_DIMMER,e,i,n));return;case M.CLOTHING_CHANGE:a.dispatchEvent(new B(B.REQUEST_CLOTHING_CHANGE,e,i,n));return;case M.JUKEBOX_PLAYLIST_EDITOR:a.dispatchEvent(new B(B.REQUEST_PLAYLIST_EDITOR,e,i,n));return;case M.MANNEQUIN:a.dispatchEvent(new B(B.REQUEST_MANNEQUIN,e,i,n));return;case M.PET_PRODUCT_MENU:a.dispatchEvent(new Wu(Wu.USE_PRODUCT_FROM_ROOM,e,i,n));return;case M.GUILD_FURNI_CONTEXT_MENU:this._roomEngine.connection.send(new EO(t.objectId,t.object.model.getValue(I.FURNITURE_GUILD_CUSTOMIZED_GUILD_ID)));return;case M.MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG:a.dispatchEvent(new B(B.REQUEST_MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG,e,i,n));return;case M.PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG:a.dispatchEvent(new B(B.REQUEST_PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG,e,i,n));return;case M.BACKGROUND_COLOR:a.dispatchEvent(new B(B.REQUEST_BACKGROUND_COLOR,e,i,n));return;case M.MYSTERYBOX_OPEN_DIALOG:a.dispatchEvent(new B(B.REQUEST_MYSTERYBOX_OPEN_DIALOG,e,i,n));return;case M.EFFECTBOX_OPEN_DIALOG:a.dispatchEvent(new B(B.REQUEST_EFFECTBOX_OPEN_DIALOG,e,i,n));return;case M.MYSTERYTROPHY_OPEN_DIALOG:a.dispatchEvent(new B(B.REQUEST_MYSTERYTROPHY_OPEN_DIALOG,e,i,n));return;case M.ACHIEVEMENT_RESOLUTION_OPEN:this._roomEngine.connection.send(new yR(t.objectId,0));return;case M.ACHIEVEMENT_RESOLUTION_ENGRAVING:a.dispatchEvent(new B(B.REQUEST_ACHIEVEMENT_RESOLUTION_ENGRAVING,e,i,n));return;case M.ACHIEVEMENT_RESOLUTION_FAILED:a.dispatchEvent(new B(B.REQUEST_ACHIEVEMENT_RESOLUTION_FAILED,e,i,n));return;case M.FRIEND_FURNITURE_CONFIRM:a.dispatchEvent(new B(B.REQUEST_FRIEND_FURNITURE_CONFIRM,e,i,n));return;case M.FRIEND_FURNITURE_ENGRAVING:a.dispatchEvent(new B(B.REQUEST_FRIEND_FURNITURE_ENGRAVING,e,i,n));return;case M.BADGE_DISPLAY_ENGRAVING:a.dispatchEvent(new B(B.REQUEST_BADGE_DISPLAY_ENGRAVING,e,i,n));return;case M.HIGH_SCORE_DISPLAY:a.dispatchEvent(new B(B.REQUEST_HIGH_SCORE_DISPLAY,e,i,n));return;case M.HIDE_HIGH_SCORE_DISPLAY:a.dispatchEvent(new B(B.REQUEST_HIDE_HIGH_SCORE_DISPLAY,e,i,n));return;case M.INERNAL_LINK:a.dispatchEvent(new B(B.REQUEST_INTERNAL_LINK,e,i,n));return;case M.ROOM_LINK:a.dispatchEvent(new B(B.REQUEST_ROOM_LINK,e,i,n));return;case M.YOUTUBE:a.dispatchEvent(new B(B.REQUEST_YOUTUBE,e,i,n));return}}onRoomObjectFurnitureActionEvent(t,e){t&&this.useObject(e,t.object.id,t.object.type,t.type)}handleObjectSoundMachineEvent(t,e){if(!t)return;const i=this._roomEngine.getRoomObjectCategoryForType(t.objectType),r=this.getSelectedRoomObjectData(e);if(!(r&&r.category===i&&r.id===t.objectId&&r.operation===at.OBJECT_PLACE))switch(t.type){case G.SOUND_MACHINE_INIT:this._roomEngine.events.dispatchEvent(new xt(xt.SOUND_MACHINE_INIT,e,t.objectId,i));return;case G.SOUND_MACHINE_START:this._roomEngine.events.dispatchEvent(new xt(xt.SOUND_MACHINE_SWITCHED_ON,e,t.objectId,i));return;case G.SOUND_MACHINE_STOP:this._roomEngine.events.dispatchEvent(new xt(xt.SOUND_MACHINE_SWITCHED_OFF,e,t.objectId,i));return;case G.SOUND_MACHINE_DISPOSE:this._roomEngine.events.dispatchEvent(new xt(xt.SOUND_MACHINE_DISPOSE,e,t.objectId,i));return}}handleObjectJukeboxEvent(t,e){if(!t)return;const i=this._roomEngine.getRoomObjectCategoryForType(t.objectType),r=this.getSelectedRoomObjectData(e);if(!(r&&r.category===i&&r.id===t.objectId&&r.operation===at.OBJECT_PLACE))switch(t.type){case G.JUKEBOX_INIT:this._roomEngine.events.dispatchEvent(new xt(xt.JUKEBOX_INIT,e,t.objectId,i));return;case G.JUKEBOX_START:this._roomEngine.events.dispatchEvent(new xt(xt.JUKEBOX_SWITCHED_ON,e,t.objectId,i));return;case G.JUKEBOX_MACHINE_STOP:this._roomEngine.events.dispatchEvent(new xt(xt.JUKEBOX_SWITCHED_OFF,e,t.objectId,i));return;case G.JUKEBOX_DISPOSE:this._roomEngine.events.dispatchEvent(new xt(xt.JUKEBOX_DISPOSE,e,t.objectId,i));return}}onRoomObjectFloorHoleEvent(t,e){if(t)switch(t.type){case ze.ADD_HOLE:this._roomEngine.addRoomInstanceFloorHole(e,t.objectId);return;case ze.REMOVE_HOLE:this._roomEngine.removeRoomInstanceFloorHole(e,t.objectId);return}}onRoomObjectRoomAdEvent(t,e){if(!t)return;let i=null;switch(t.type){case kt.ROOM_AD_FURNI_CLICK:this._roomEngine.events.dispatchEvent(t),t.clickUrl&&t.clickUrl.length>0&&K.instance.createLinkEvent(t.clickUrl),i=Sr.FURNI_CLICK;break;case kt.ROOM_AD_FURNI_DOUBLE_CLICK:if(t.clickUrl&&t.clickUrl.length>0){const r="CATALOG_PAGE";t.clickUrl.indexOf(r)===0&&K.instance.createLinkEvent(t.clickUrl.substr(r.length))}i=Sr.FURNI_DOUBLE_CLICK;break;case kt.ROOM_AD_TOOLTIP_SHOW:i=Sr.TOOLTIP_SHOW;break;case kt.ROOM_AD_TOOLTIP_HIDE:i=Sr.TOOLTIP_HIDE;break}i&&this._roomEngine.events.dispatchEvent(new Q(i,e,t.objectId,this._roomEngine.getRoomObjectCategoryForType(t.objectType)))}onRoomObjectBadgeAssetEvent(t,e){if(!(!t||!this._roomEngine))switch(t.type){case gi.LOAD_BADGE:{const i=t.objectId,r=t.objectType,n=this._roomEngine.getRoomObjectCategoryForType(r);this._roomEngine.loadRoomObjectBadgeImage(e,i,n,t.badgeId,t.groupBadge);return}}}handleMousePointer(t,e){t&&this._roomEngine.updateMousePointer(t.type,t.objectId,t.objectType)}handleRoomObjectPlaySoundEvent(t,e){const i=this._roomEngine.getRoomObjectCategoryForType(t.objectType);switch(t.type){case ki.PLAY_SOUND:this._roomEngine.events.dispatchEvent(new ca(ca.PLAY_SOUND,e,t.objectId,i,t.soundId,t.pitch));return;case ki.PLAY_SOUND_AT_PITCH:this._roomEngine.events.dispatchEvent(new ca(ca.PLAY_SOUND_AT_PITCH,e,t.objectId,i,t.soundId,t.pitch));return}}handleRoomObjectSamplePlaybackEvent(t,e){if(!t)return;const i=this._roomEngine.getRoomObjectCategoryForType(t.objectType);switch(t.type){case ne.ROOM_OBJECT_INITIALIZED:this._roomEngine.events.dispatchEvent(new $e($e.ROOM_OBJECT_INITIALIZED,e,t.objectId,i,t.sampleId,t.pitch));break;case ne.ROOM_OBJECT_DISPOSED:this._roomEngine.events.dispatchEvent(new $e($e.ROOM_OBJECT_DISPOSED,e,t.objectId,i,t.sampleId,t.pitch));break;case ne.PLAY_SAMPLE:this._roomEngine.events.dispatchEvent(new $e($e.PLAY_SAMPLE,e,t.objectId,i,t.sampleId,t.pitch));break;case ne.CHANGE_PITCH:this._roomEngine.events.dispatchEvent(new $e($e.CHANGE_PITCH,e,t.objectId,i,t.sampleId,t.pitch));break}}onHSLColorEnableEvent(t,e){if(!(!t||!this._roomEngine))switch(t.type){case Ir.ROOM_BACKGROUND_COLOR:this._roomEngine.events.dispatchEvent(new wc(wc.ROOM_BACKGROUND_COLOR,e,t.enable,t.hue,t.saturation,t.lightness));return}}onRoomObjectDataRequestEvent(t,e){if(!(!t||!this._roomEngine||!t.object))switch(t.type){case Cs.RODRE_CURRENT_USER_ID:t.object.model.setValue(I.SESSION_CURRENT_USER_ID,this._roomEngine.sessionDataManager.userId);return;case Cs.RODRE_URL_PREFIX:t.object.model.setValue(I.SESSION_URL_PREFIX,rt.getValue("url.prefix"));return}}onRoomObjectTileMouseEvent(t,e){if(!this._roomEngine||this._roomEngine.isDecorating||!this._roomEngine.roomSessionManager)return;const i=this._roomEngine.roomSessionManager.getSession(t);!i||i.isSpectator||this.sendWalkUpdate(e.tileXAsInt,e.tileYAsInt)}handleObjectMove(t,e){if(!t||!this._roomEngine||!this._roomEngine.events)return;const r=this.getSelectedRoomObjectData(e);if(!r)return;const n=this._roomEngine.getRoomObject(e,r.id,r.category);if(!n)return;let a=!0;if(r.category===D.FLOOR||r.category===D.UNIT){const o=this._roomEngine.getFurnitureStackingHeightMap(e);t instanceof vi&&this.handleFurnitureMove(n,r,Math.trunc(t.tileX+.5),Math.trunc(t.tileY+.5),o)||(this.handleFurnitureMove(n,r,r.loc.x,r.loc.y,o),a=!1)}else if(r.category===D.WALL){if(a=!1,t instanceof Kn){const o=t.wallLocation,h=t.wallWidth,u=t.wallHeight,c=t.x,l=t.y,_=t.direction;this.handleWallItemMove(n,r,o,h,u,c,l,_)&&(a=!0)}a||(n.setLocation(r.loc),n.setDirection(r.dir)),this._roomEngine.updateRoomObjectMask(e,r.id,a)}a?(this.setFurnitureAlphaMultiplier(n,.5),this._roomEngine.setObjectMoverIconSpriteVisible(!1)):(this.setFurnitureAlphaMultiplier(n,0),this._roomEngine.setObjectMoverIconSpriteVisible(!0))}handleObjectPlace(t,e){if(!t||!this._roomEngine||!this._roomEngine.events)return;let r=this.getSelectedRoomObjectData(e);if(!r)return;let n=this._roomEngine.getRoomObject(e,r.id,r.category);if(!n){if(t instanceof vi){if(r.category===D.FLOOR)this._roomEngine.addFurnitureFloor(e,r.id,r.typeId,r.loc,r.dir,0,r.stuffData,parseFloat(r.instanceData),-1,0,0,"",!1);else if(r.category===D.UNIT){this._roomEngine.addRoomObjectUser(e,r.id,new S,new S(180),180,r.typeId,r.instanceData);const a=this._roomEngine.getRoomObject(e,r.id,r.category);a&&r.posture&&a.model.setValue(I.FIGURE_POSTURE,r.posture)}}else t instanceof Kn&&r.category===D.WALL&&this._roomEngine.addFurnitureWall(e,r.id,r.typeId,r.loc,r.dir,0,r.instanceData,0);if(n=this._roomEngine.getRoomObject(e,r.id,r.category),n&&r.category===D.FLOOR){const a=n.model.getValue(I.FURNITURE_ALLOWED_DIRECTIONS);if(a&&a.length){const o=new S(a[0]);if(n.setDirection(o),this.updateSelectedObjectData(e,r.id,r.category,r.loc,o,r.operation,r.typeId,r.instanceData,r.stuffData,r.state,r.animFrame,r.posture),r=this.getSelectedRoomObjectData(e),!r)return}}this.setFurnitureAlphaMultiplier(n,.5),this._roomEngine.setObjectMoverIconSpriteVisible(!0)}if(n){let a=!0;const o=this._roomEngine.getFurnitureStackingHeightMap(e);if(r.category===D.FLOOR)t instanceof vi&&this.handleFurnitureMove(n,r,Math.trunc(t.tileX+.5),Math.trunc(t.tileY+.5),o)||(this._roomEngine.removeRoomObjectFloor(e,r.id),a=!1);else if(r.category===D.WALL){if(a=!1,t instanceof Kn){const h=t.wallLocation,u=t.wallWidth,c=t.wallHeight,l=t.x,_=t.y,d=t.direction;this.handleWallItemMove(n,r,h,u,c,l,_,d)&&(a=!0)}a||this._roomEngine.removeRoomObjectWall(e,r.id),this._roomEngine.updateRoomObjectMask(e,r.id,a)}else r.category===D.UNIT&&(t instanceof vi&&this.handleUserPlace(n,Math.trunc(t.tileX+.5),Math.trunc(t.tileY+.5),this._roomEngine.getLegacyWallGeometry(e))||(this._roomEngine.removeRoomObjectUser(e,r.id),a=!1));this._roomEngine.setObjectMoverIconSpriteVisible(!a)}}handleFurnitureMove(t,e,i,r,n){if(!t||!e)return!1;const a=new S;a.assign(t.getDirection()),t.setDirection(e.dir);const o=new S(i,r,0),h=new S;h.assign(t.getDirection());let u=this.validateFurnitureLocation(t,o,e.loc,e.dir,n);return u||(h.x=this.getValidRoomObjectDirection(t,!0),t.setDirection(h),u=this.validateFurnitureLocation(t,o,e.loc,e.dir,n)),u?(t.setLocation(u),h&&t.setDirection(h),!0):(t.setDirection(a),!1)}handleWallItemMove(t,e,i,r,n,a,o,h){if(!t||!e)return!1;const u=new S(h),c=this.validateWallItemLocation(t,i,r,n,a,o,e);return c?(t.setLocation(c),t.setDirection(u),!0):!1}validateFurnitureLocation(t,e,i,r,n){if(!t||!t.model||!e)return null;let a=null;const o=t.getDirection();if(!o||!i||!r)return null;if(e.x===i.x&&e.y===i.y&&o.x===r.x)return a=new S,a.assign(i),a;let h=t.model.getValue(I.FURNITURE_SIZE_X),u=t.model.getValue(I.FURNITURE_SIZE_Y);h<1&&(h=1),u<1&&(u=1);const c=i.x,l=i.y;let _=h,d=u,g=0,m=Math.trunc(Math.trunc(o.x+45)%360/90);if((m===1||m===3)&&(g=h,h=u,u=g),m=Math.trunc(Math.trunc(r.x+45)%360/90),(m===1||m===3)&&(g=_,_=d,d=g),n&&e){const p=t.model.getValue(I.FURNITURE_ALWAYS_STACKABLE)===1;return n.validateLocation(e.x,e.y,h,u,c,l,_,d,p)?new S(e.x,e.y,n.getTileHeight(e.x,e.y)):null}return null}validateWallItemLocation(t,e,i,r,n,a,o){if(t==null||t.model==null||e==null||i==null||r==null||o==null)return null;const h=t.model.getValue(I.FURNITURE_SIZE_X),u=t.model.getValue(I.FURNITURE_SIZE_Z),c=t.model.getValue(I.FURNITURE_CENTER_Z);if((n<h/2||n>i.length-h/2||a<c||a>r.length-(u-c))&&(n<h/2&&n<=i.length-h/2?n=h/2:n>=h/2&&n>i.length-h/2&&(n=i.length-h/2),a<c&&a<=r.length-(u-c)?a=c:a>=c&&a>r.length-(u-c)&&(a=r.length-(u-c))),n<h/2||n>i.length-h/2||a<c||a>r.length-(u-c))return null;let l=S.sum(S.product(i,n/i.length),S.product(r,a/r.length));return l=S.sum(e,l),l}changeObjectState(t,e,i,r,n){const a=this._roomEngine.getRoomObjectCategoryForType(i);this.changeRoomObjectState(t,e,a,r,n)}useObject(t,e,i,r){if(!(!this._roomEngine||!this._roomEngine.connection))switch(r){case G.DICE_ACTIVATE:this._roomEngine.connection.send(new RO(e));return;case G.DICE_OFF:this._roomEngine.connection.send(new OO(e));return;case G.USE_HABBOWHEEL:this._roomEngine.connection.send(new TO(e));return;case G.STICKIE:this._roomEngine.connection.send(new rO(e));return;case G.ENTER_ONEWAYDOOR:this._roomEngine.connection.send(new AO(e));return}}changeRoomObjectState(t,e,i,r,n){return!this._roomEngine||!this._roomEngine.connection||(i===D.FLOOR?n?this._roomEngine.connection.send(new vO(e,r)):this._roomEngine.connection.send(new Qf(e,r)):i===D.WALL&&this._roomEngine.connection.send(new SO(e,r))),!0}sendWalkUpdate(t,e){!this._roomEngine||!this._roomEngine.connection||this._roomEngine.connection.send(new HO(t,e))}handleMouseOverObject(t,e,i){if(t!==D.FLOOR)return null;const r=this._roomEngine.getRoomObject(e,i.objectId,D.FLOOR);if(!r)return null;const n=this.getActiveSurfaceLocation(r,i);if(!n||!this._roomEngine.getFurnitureStackingHeightMap(e))return null;const o=n.x,h=n.y,u=n.z;return new Zn(new S(o,h,r.getLocation().z),u,!0,i.eventId)}handleMoveTargetFurni(t,e){if(e.objectType===ft.USER||e.objectType===ft.PET||e.objectType===ft.BOT||e.objectType===ft.RENTABLE_BOT||e.objectType===ft.MONSTER_PLANT)return;const i=this._roomEngine.getRoomObject(t,e.objectId,D.FLOOR),r=this.getActiveSurfaceLocation(i,e);return r?(this.sendWalkUpdate(r.x,r.y),!0):!1}getActiveSurfaceLocation(t,e){if(!t||!e)return null;const i=this._roomEngine.sessionDataManager.getFloorItemDataByName(t.type);if(!i||!i.canStandOn&&!i.canSitOn&&!i.canLayOn)return null;const r=t.model;if(!r)return null;const n=t.getLocation(),a=t.getDirection();let o=r.getValue(I.FURNITURE_SIZE_X),h=r.getValue(I.FURNITURE_SIZE_Y);const u=r.getValue(I.FURNITURE_SIZE_Z);(a.x===90||a.x===270)&&([o,h]=[h,o]),o<1&&(o=1),h<1&&(h=1);const c=this._roomEngine.getActiveRoomInstanceRenderingCanvas();if(!c)return null;const l=c.geometry.scale,_=i.canSitOn?.5:0,d=(l/2+e.spriteOffsetX+e.localX)/(l/4),g=(e.spriteOffsetY+e.localY+(u-_)*l/2)/(l/4),m=(d+2*g)/4,p=(d-2*g)/4,T=Math.floor(n.x+m),A=Math.floor(n.y-p+1);let O=!1;(T<n.x||T>=n.x+o||A<n.y||A>=n.y+h)&&(O=!0);const v=i.canSitOn?u-.5:u;return O?null:new S(T,A,v)}handleMouseOverTile(t,e){if(this._whereYouClickIsWhereYouGo)return new Zn(new S(t.tileXAsInt,t.tileYAsInt,t.tileZAsInt),0,!0,t.eventId);const i=this._roomEngine.getRoomObjectCursor(e);if(i&&i.visualization){const r=t.tileXAsInt,n=t.tileYAsInt,a=t.tileZAsInt;if(this._roomEngine.getRoomInstance(e)){const h=this._roomEngine.getRoomTileObjectMap(e);if(h){const u=h.getObjectIntTile(r,n),c=this._roomEngine.getFurnitureStackingHeightMap(e);if(c){if(u&&u.model&&u.model.getValue(I.FURNITURE_IS_VARIABLE_HEIGHT)>0){const l=c.getTileHeight(r,n),_=this._roomEngine.getLegacyWallGeometry(e).getHeight(r,n);return new Zn(new S(r,n,a),l-_,!0,t.eventId)}return new Zn(new S(r,n,a),0,!0,t.eventId)}}}}return null}placeObject(t,e,i){const r=this.getSelectedRoomObjectData(t);if(!r)return;let n=null,a=r.id;const o=r.category;let h=0,u=0,c=0,l=0,_="";if(this._roomEngine&&this._roomEngine.connection&&(n=this._roomEngine.getRoomObject(t,a,o),n)){const d=n.getLocation();if(l=n.getDirection().x,o===D.FLOOR||o===D.UNIT)h=d.x,u=d.y,c=d.z;else if(o===D.WALL){h=d.x,u=d.y,c=d.z;const g=this._roomEngine.getLegacyWallGeometry(t);g&&(_=g.getOldLocationString(d,l))}l=(l/45%8+8)%8,a<0&&o===D.UNIT&&(a=a*-1),this._objectPlacementSource!==yf.CATALOG&&(o===D.UNIT?r.typeId===Vs.PET?this._roomEngine.connection.send(new aO(a,Math.trunc(h),Math.trunc(u))):r.typeId===Vs.RENTABLE_BOT&&this._roomEngine.connection.send(new tO(a,Math.trunc(h),Math.trunc(u))):n.model.getValue(I.FURNITURE_IS_STICKIE)!==void 0?this._roomEngine.connection.send(new IO(a,_)):this._roomEngine.connection.send(new mO(a,o,_,Math.trunc(h),Math.trunc(u),l)))}if(this._roomEngine.setPlacedRoomObjectData(t,new tc(r.id,r.category,null,r.dir,null)),this.resetSelectedObjectData(t),this._roomEngine&&this._roomEngine.events){const d=n&&n.id===r.id;this._roomEngine.events.dispatchEvent(new rD(Q.PLACED,t,a,o,_,h,u,c,l,d,e,i,r.instanceData))}}modifyRoomObject(t,e,i,r){if(!this._roomEngine)return!1;const n=this._roomEngine.getRoomObject(t,e,i);if(!n)return!1;let a=!0;switch(r){case at.OBJECT_ROTATE_POSITIVE:case at.OBJECT_ROTATE_NEGATIVE:if(this._roomEngine.connection){let o=0;r==at.OBJECT_ROTATE_NEGATIVE?o=this.getValidRoomObjectDirection(n,!1):o=this.getValidRoomObjectDirection(n,!0);const h=n.getLocation().x,u=n.getLocation().y;if(this.isValidLocation(n,new S(o),this._roomEngine.getFurnitureStackingHeightMap(t)))if(o=Math.trunc(o/45),n.type===ft.MONSTER_PLANT){const c=this._roomEngine.roomSessionManager.getSession(t);if(c){const l=c.userDataManager.getUserDataByIndex(e);l&&this._roomEngine.connection.send(new Vd(l.webID,Math.trunc(h),Math.trunc(u),o))}}else this._roomEngine.connection.send(new kd(e,h,u,o))}break;case at.OBJECT_EJECT:case at.OBJECT_PICKUP:this._roomEngine.connection&&this._roomEngine.connection.send(new pO(i,e));break;case at.OBJECT_PICKUP_PET:if(this._roomEngine.connection){const o=this._roomEngine.roomSessionManager.getSession(t);if(o){const h=o.userDataManager.getUserDataByIndex(e);o.pickupPet(h.webID)}}break;case at.OBJECT_PICKUP_BOT:if(this._roomEngine.connection){const o=this._roomEngine.roomSessionManager.getSession(t);if(o){const h=o.userDataManager.getUserDataByIndex(e);o.pickupBot(h.webID)}}break;case at.OBJECT_MOVE:a=!1,this.setFurnitureAlphaMultiplier(n,.5),this.setSelectedRoomObjectData(t,n.id,i,n.getLocation(),n.getDirection(),r),this._roomEngine.setObjectMoverIconSprite(n.id,i,!0),this._roomEngine.setObjectMoverIconSpriteVisible(!1);break;case at.OBJECT_MOVE_TO:{const o=this.getSelectedRoomObjectData(t);if(this.updateSelectedObjectData(t,o.id,o.category,o.loc,o.dir,at.OBJECT_MOVE_TO,o.typeId,o.instanceData,o.stuffData,o.state,o.animFrame,o.posture),this.setFurnitureAlphaMultiplier(n,1),this._roomEngine.removeObjectMoverIconSprite(),this._roomEngine.connection){if(i===D.FLOOR){const h=n.getDirection().x%360,u=n.getLocation(),c=h/45;this._roomEngine.connection.send(new kd(e,u.x,u.y,c))}else if(i===D.WALL){const h=n.getDirection().x%360,u=this._roomEngine.getLegacyWallGeometry(t);if(u){const c=u.getOldLocationString(n.getLocation(),h);c&&this._roomEngine.connection.send(new MO(e,c))}}else if(i===D.UNIT){const h=n.getDirection().x%360,u=n.getLocation(),c=h/45;parseInt(n.model.getValue(I.RACE));const l=this._roomEngine.roomSessionManager.getSession(t);if(l){const _=l.userDataManager.getUserDataByIndex(e);_&&this._roomEngine.connection.send(new Vd(_.webID,u.x,u.y,c))}}}break}}return a&&this.resetSelectedObjectData(t),!0}modifyRoomObjectDataWithMap(t,e,i,r,n){if(!this._roomEngine||!this._roomEngine.getRoomObject(t,e,i))return!1;switch(r){case at.OBJECT_SAVE_STUFF_DATA:this._roomEngine.connection&&this._roomEngine.connection.send(new _O(e,n));break}return!0}modifyWallItemData(t,e,i,r){return!this._roomEngine||!this._roomEngine.connection?!1:(this._roomEngine.connection.send(new lO(e,i,r)),!0)}deleteWallItem(t,e){return!this._roomEngine||!this._roomEngine.connection?!1:(this._roomEngine.connection.send(new hO(e)),!0)}getValidRoomObjectDirection(t,e){if(!t||!t.model)return 0;let i=0,r=0,n=[];t.type===ft.MONSTER_PLANT?n=t.model.getValue(I.PET_ALLOWED_DIRECTIONS):n=t.model.getValue(I.FURNITURE_ALLOWED_DIRECTIONS);let a=t.getDirection().x;if(n&&n.length){if(i=n.indexOf(a),i<0){for(i=0,r=0;r<n.length&&!(a<=n[r]);)i++,r++;i=i%n.length}e?i=(i+1)%n.length:i=(i-1+n.length)%n.length,a=n[i]}return a}isValidLocation(t,e,i){if(!t||!t.model||!e)return!1;const r=t.getDirection(),n=t.getLocation();if(!r||!n)return!1;if(r.x%180===e.x%180)return!0;let a=t.model.getValue(I.FURNITURE_SIZE_X),o=t.model.getValue(I.FURNITURE_SIZE_Y);a<1&&(a=1),o<1&&(o=1);let h=a,u=o,c=Math.trunc(Math.trunc(e.x+45)%360/90);if((c===1||c===3)&&([a,o]=[o,a]),c=Math.trunc(Math.trunc(r.x+45)%360/90),(c===1||c===3)&&([h,u]=[u,h]),i&&n){const l=t.model.getValue(I.FURNITURE_ALWAYS_STACKABLE)===1;if(i.validateLocation(n.x,n.y,a,o,n.x,n.y,h,u,l,n.z))return!0}return!1}placeObjectOnUser(t,e,i){const r=this.getSelectedRoomObjectData(t);!r||!this._roomEngine.getRoomObject(t,e,i)||!this._roomEngine||!this._roomEngine.events||this._roomEngine.events.dispatchEvent(new nD(Q.PLACED_ON_USER,t,e,i,r.id,r.category))}setSelectedObject(t,e,i){if(!this._roomEngine)return;const r=this._roomEngine.events;if(r)switch(i){case D.UNIT:case D.FLOOR:case D.WALL:if(i===D.UNIT)this.deselectObject(t),this.setSelectedAvatar(t,e,!0);else if(this.setSelectedAvatar(t,0,!1),e!==this._selectedObjectId){this.deselectObject(t);const n=this._roomEngine.getRoomObject(t,e,i);n&&n.logic&&(n.logic.processUpdateMessage(new sh(!0)),this._selectedObjectId=e,this._selectedObjectCategory=i)}r.dispatchEvent(new Q(Q.SELECTED,t,e,i));return}}deselectObject(t){if(this._selectedObjectId===-1)return;const e=this._roomEngine.getRoomObject(t,this._selectedObjectId,this._selectedObjectCategory);e&&e.logic&&(e.logic.processUpdateMessage(new sh(!1)),this._selectedObjectId=-1,this._selectedObjectCategory=D.MINIMUM)}setSelectedAvatar(t,e,i){if(!this._roomEngine)return;const r=D.UNIT,n=this._roomEngine.getRoomObject(t,this._selectedAvatarId,r);n&&n.logic&&(n.logic.processUpdateMessage(new hl(!1)),this._selectedAvatarId=-1);let a=!1;if(i){const h=this._roomEngine.getRoomObject(t,e,r);if(h&&h.logic){h.logic.processUpdateMessage(new hl(!0)),a=!0,this._selectedAvatarId=e;const u=h.getLocation();u&&this._roomEngine.connection.send(new wO(~~u.x,~~u.y))}}const o=this._roomEngine.getRoomObjectSelectionArrow(t);o&&o.logic&&(a&&!this._roomEngine.isPlayingGame()?o.logic.processUpdateMessage(new Xi(Xi.ENABLED)):o.logic.processUpdateMessage(new Xi(Xi.DISABLED)))}resetSelectedObjectData(t){if(!this._roomEngine)return;this._roomEngine.removeObjectMoverIconSprite();const e=this.getSelectedRoomObjectData(t);if(e){if(e.operation===at.OBJECT_MOVE||e.operation===at.OBJECT_MOVE_TO){const i=this._roomEngine.getRoomObject(t,e.id,e.category);i&&e.operation!==at.OBJECT_MOVE_TO&&(i.setLocation(e.loc),i.setDirection(e.dir)),this.setFurnitureAlphaMultiplier(i,1),e.category===D.WALL&&this._roomEngine.updateRoomObjectMask(t,e.id,!0),this.updateSelectedObjectData(t,e.id,e.category,e.loc,e.dir,at.OBJECT_MOVE,e.typeId,e.instanceData,e.stuffData,e.state,e.animFrame,e.posture)}else if(e.operation===at.OBJECT_PLACE){const i=e.id;switch(e.category){case D.FLOOR:this._roomEngine.removeRoomObjectFloor(t,i);break;case D.WALL:this._roomEngine.removeRoomObjectWall(t,i);break;case D.UNIT:this._roomEngine.removeRoomObjectUser(t,i);break}}this._roomEngine.setSelectedRoomObjectData(t,null)}}getSelectedRoomObjectData(t){return this._roomEngine?this._roomEngine.getSelectedRoomObjectData(t):null}setFurnitureAlphaMultiplier(t,e){!t||!t.model||t.model.setValue(I.FURNITURE_ALPHA_MULTIPLIER,e)}decorateModeMove(t){return this._roomEngine.isDecorating&&!(t.ctrlKey||t.shiftKey)}cancelRoomObjectPlacement(t){return this.resetSelectedObjectData(t),!0}setSelectedRoomObjectData(t,e,i,r,n,a,o=0,h=null,u=null,c=-1,l=-1,_=null){if(this.resetSelectedObjectData(t),!this._roomEngine)return;const d=new tc(e,i,a,r,n,o,h,u,c,l,_);this._roomEngine.setSelectedRoomObjectData(t,d)}updateSelectedObjectData(t,e,i,r,n,a,o=0,h=null,u=null,c=-1,l=-1,_=null){if(!this._roomEngine)return null;const d=new tc(e,i,a,r,n,o,h,u,c,l,_);this._roomEngine.setSelectedRoomObjectData(t,d)}handleUserPlace(t,e,i,r){return r.isRoomTile(e,i)?(t.setLocation(new S(e,i,r.getHeight(e,i))),!0):!1}get engine(){return this._roomEngine}get selectedAvatarId(){return this._selectedAvatarId}}class aq{constructor(){this._events=new Rs,this._cachedEvents=new Map,this._registeredEvents=new Map,this._functions=[]}getLogic(t){const e=this.getLogicType(t);if(!e)return null;const i=new e;if(!i)return null;if(i.eventDispatcher=this._events,!this._cachedEvents.get(t)){this._cachedEvents.set(t,!0);const r=i.getEventTypes();for(const n of r)n&&this.registerEventType(n)}return i}registerEventType(t){if(!this._registeredEvents.get(t)){this._registeredEvents.set(t,!0);for(const e of this._functions)e&&this._events.addEventListener(t,e)}}registerEventFunction(t){if(t&&!(this._functions.indexOf(t)>=0)){this._functions.push(t);for(const e of this._registeredEvents.keys())e&&this._events.addEventListener(e,t)}}removeEventFunction(t){if(!t)return;const e=this._functions.indexOf(t);if(e!==-1){this._functions.splice(e,1);for(const i of this._registeredEvents.keys())i&&this._events.removeEventListener(i,t)}}getLogicType(t){if(!t)return null;let e=null;switch(t){case U.ROOM:e=m9;break;case U.TILE_CURSOR:e=t_;break;case U.SELECTION_ARROW:e=I9;break;case U.USER:case U.BOT:case U.RENTABLE_BOT:e=zr;break;case U.PET:e=f9;break;case U.FURNITURE_BASIC:e=yt;break;case U.FURNITURE_BADGE_DISPLAY:e=CA;break;case U.FURNITURE_CHANGE_STATE_WHEN_STEP_ON:e=t7;break;case U.FURNITURE_COUNTER_CLOCK:e=s7;break;case U.FURNITURE_CRACKABLE:e=i7;break;case U.FURNITURE_CREDIT:e=n7;break;case U.FURNITURE_CUSTOM_STACK_HEIGHT:e=o7;break;case U.FURNITURE_DICE:e=h7;break;case U.FURNITURE_EDITABLE_INTERNAL_LINK:e=l7;break;case U.FURNITURE_EDITABLE_ROOM_LINK:e=_7;break;case U.FURNITURE_EXTERNAL_IMAGE_WALLITEM:e=d7;break;case U.FURNITURE_FIREWORKS:e=f7;break;case U.FURNITURE_FLOOR_HOLE:e=MA;break;case U.FURNITURE_GUILD_CUSTOMIZED:e=Va;break;case U.FURNITURE_HIGH_SCORE:e=PA;break;case U.FURNITURE_HOCKEY_SCORE:e=p7;break;case U.FURNITURE_ES:e=I7;break;case U.FURNITURE_MANNEQUIN:e=Kl;break;case U.FURNITURE_MULTIHEIGHT:e=v7;break;case U.FURNITURE_MULTISTATE:e=le;break;case U.FURNITURE_ONE_WAY_DOOR:e=C7;break;case U.FURNITURE_PET_CUSTOMIZATION:e=M7;break;case U.FURNITURE_PRESENT:e=ka;break;case U.FURNITURE_PURCHASABLE_CLOTHING:e=b7;break;case U.FURNITURE_PUSHABLE:e=ql;break;case U.FURNITURE_BACKGROUND_COLOR:e=x7;break;case U.FURNITURE_BG:e=r9;break;case U.FURNITURE_BB:e=n9;break;case U.FURNITURE_ROOMDIMMER:e=a9;break;case U.FURNITURE_SCORE:e=rg;break;case U.FURNITURE_SOUNDBLOCK:e=$l;break;case U.FURNITURE_STICKIE:e=wA;break;case U.FURNITURE_TROPHY:e=u9;break;case U.FURNITURE_VOTE_COUNTER:e=ng;break;case U.FURNITURE_VOTE_MAJORITY:e=l9;break;case U.FURNITURE_WINDOW:e=c9;break;case U.FURNITURE_LOVELOCK:e=O7;break;case U.FURNITURE_YOUTUBE:e=d9;break;case U.FURNITURE_CRAFTING_GIZMO:e=r7;break;case U.FURNITURE_RENTABLE_SPACE:e=U7;break;case U.FURNITURE_EFFECTBOX:e=c7;break;case U.FURNITURE_MONSTERPLANT_SEED:e=A7;break;case U.FURNITURE_MYSTERYBOX:e=S7;break;case U.FURNITURE_MYSTERYTROPHY:e=y7;break;case U.FURNITURE_RANDOM_TELEPORT:e=L7;break;case U.FURNITURE_CLOTHING_CHANGE:e=e7;break;case U.FURNITURE_CUCKOO_CLOCK:e=a7;break;case U.FURNITURE_ECOTRON_BOX:e=u7;break;case U.FURNITURE_GROUP_FORUM_TERMINAL:e=g7;break;case U.FURNITURE_HWEEN_LOVELOCK:e=m7;break;case U.FURNITURE_INTERNAL_LINK:e=T7;break;case U.FURNITURE_JUKEBOX:e=R7;break;case U.FURNITURE_PLACEHOLDER:e=N7;break;case U.FURNITURE_PLANET_SYSTEM:e=P7;break;case U.FURNITURE_RANDOMSTATE:e=D7;break;case U.FURNITURE_SONG_DISK:e=o9;break;case U.FURNITURE_SOUND_MACHINE:e=h9;break;case U.FURNITURE_WELCOME_GIFT:e=_9;break;case U.FURNITURE_ACHIEVEMENT_RESOLUTION:e=Vn;break;case U.FURNITURE_HABBOWHEEL:e=E7;break;default:e=yt;break}return e||(Y.warn("Unknown Logic",t),null)}get events(){return this._events}}const Ht=class extends mi{constructor(s){super(),this._communication=s,this._sessionDataManager=null,this._roomSessionManager=null,this._roomManager=null,this._roomObjectEventHandler=new nq(this),this._roomMessageHandler=new rq(this),this._roomContentLoader=new Is,this._ready=!1,this._roomContentLoaderReady=!1,this._activeRoomId=-1,this._activeRoomActiveCanvas=-1,this._roomInstanceDatas=new Map,this._roomDatas=new Map,this._roomRendererFactory=new nL,this._visualizationFactory=new nv,this._logicFactory=new aq,this._activeRoomActiveCanvasMouseX=0,this._activeRoomActiveCanvasMouseY=0,this._activeRoomIsDragged=!1,this._activeRoomWasDragged=!1,this._activeRoomDragStartX=0,this._activeRoomDragStartY=0,this._activeRoomDragX=0,this._activeRoomDragY=0,this._skipFurnitureCreationForNextFrame=!1,this._mouseCursorUpdate=!1,this._imageObjectIdBank=null,this._imageCallbacks=new Map,this._thumbnailCallbacks=new Map,this._roomDraggingAlwaysCenters=!1,this._roomAllowsDragging=!0,this._badgeListenerObjects=new Map,this.runVisibilityUpdate=this.runVisibilityUpdate.bind(this),this.processRoomObjectEvent=this.processRoomObjectEvent.bind(this),this.onRoomSessionEvent=this.onRoomSessionEvent.bind(this),this.onRoomContentLoaderReadyEvent=this.onRoomContentLoaderReadyEvent.bind(this),this.onBadgeImageReadyEvent=this.onBadgeImageReadyEvent.bind(this)}onInit(){this._ready||(this._imageObjectIdBank=new np(1e3),this._thumbnailObjectIdBank=new np(1e3),this._logicFactory.registerEventFunction(this.processRoomObjectEvent),this._roomManager&&(this._roomManager.setContentLoader(this._roomContentLoader),this._roomManager.addUpdateCategory(D.FLOOR),this._roomManager.addUpdateCategory(D.WALL),this._roomManager.addUpdateCategory(D.UNIT),this._roomManager.addUpdateCategory(D.CURSOR),this._roomManager.addUpdateCategory(D.ROOM)),this._roomMessageHandler.setConnection(this._communication.connection),this._roomContentLoader.initialize(this.events),this._roomContentLoader.setSessionDataManager(this._sessionDataManager),this._roomContentLoader.setIconListener(this),this._roomSessionManager&&(this._roomSessionManager.events.addEventListener(nt.STARTED,this.onRoomSessionEvent),this._roomSessionManager.events.addEventListener(nt.ENDED,this.onRoomSessionEvent)),this.events.addEventListener(Is.LOADER_READY,this.onRoomContentLoaderReadyEvent),Bi().add(this.update,this),document.addEventListener("visibilitychange",this.runVisibilityUpdate))}onDispose(){if(this._ready){for(const[s,t]of this._roomInstanceDatas)this.removeRoomInstance(s);document.removeEventListener("visibilitychange",this.runVisibilityUpdate),Bi().remove(this.update,this),this._roomObjectEventHandler&&this._roomObjectEventHandler.dispose(),this._roomMessageHandler&&this._roomMessageHandler.dispose(),this._roomContentLoader&&this._roomContentLoader.dispose(),this.events.removeEventListener(Is.LOADER_READY,this.onRoomContentLoaderReadyEvent),this._roomSessionManager&&(this._roomSessionManager.events.removeEventListener(nt.STARTED,this.onRoomSessionEvent),this._roomSessionManager.events.removeEventListener(nt.ENDED,this.onRoomSessionEvent)),super.onDispose()}}onRoomSessionEvent(s){if(s instanceof nt)switch(s.type){case nt.STARTED:this._roomMessageHandler&&this._roomMessageHandler.setRoomId(s.session.roomId);return;case nt.ENDED:this._roomMessageHandler&&(this._roomMessageHandler.clearRoomId(),this.removeRoomInstance(s.session.roomId));return}}onRoomContentLoaderReadyEvent(s){this._roomContentLoaderReady=!0,this._roomManager.init()}setActiveRoomId(s){this._activeRoomId=s}destroyRoom(s){this.removeRoomInstance(s)}getRoomInstance(s){return this._roomManager&&this._roomManager.getRoomInstance(this.getRoomId(s))||null}removeRoomInstance(s){this.getRoomInstance(s)&&this._roomManager&&this._roomManager.removeRoomInstance(this.getRoomId(s));const e=this._roomInstanceDatas.get(s);e&&(this._roomInstanceDatas.delete(e.roomId),e.dispose()),this.events.dispatchEvent(new Mt(Mt.DISPOSED,s))}createRoomInstance(s,t){let e="111",i="201",r="1";if(!this._ready){let o=this._roomDatas.get(s);o&&(this._roomDatas.delete(s),e=o.floorType,i=o.wallType,r=o.landscapeType),o=new Rp(s,t),o.floorType=e,o.wallType=i,o.landscapeType=r,this._roomDatas.set(s,o),Y.warn("Room Engine not initilized yet, can not create room. Room data stored for later initialization.");return}if(!t){Y.warn("Room property messages");return}const n=this._roomDatas.get(s);n&&(this._roomDatas.delete(s),n.floorType&&(e=n.floorType),n.wallType&&(i=n.wallType),n.landscapeType&&(r=n.landscapeType)),this.setupRoomInstance(s,t,e,i,r,this.getRoomInstanceModelName(s))&&(t.restrictsDragging?this._roomAllowsDragging=!1:this._roomAllowsDragging=!0,this.events.dispatchEvent(new Mt(Mt.INITIALIZED,s)))}setupRoomInstance(s,t,e,i,r,n){if(!this._ready||!this._roomManager)return;const a=this._roomManager.createRoomInstance(this.getRoomId(s));if(!a)return null;const o=D.ROOM,h=a.createRoomObjectAndInitalize(Ht.ROOM_OBJECT_ID,Ht.ROOM_OBJECT_TYPE,o);if(a.model.setValue(Vt.ROOM_IS_PUBLIC,0),a.model.setValue(Vt.ROOM_Z_SCALE,1),t&&(a.model.setValue(Vt.RESTRICTS_DRAGGING,t.restrictsDragging),a.model.setValue(Vt.RESTRICTS_SCALING,t.restrictsScaling),a.model.setValue(Vt.RESTRICTED_SCALE,t.restrictedScale),t.dimensions)){const l=t.dimensions.minX,_=t.dimensions.maxX,d=t.dimensions.minY,g=t.dimensions.maxY;a.model.setValue(Vt.ROOM_MIN_X,l),a.model.setValue(Vt.ROOM_MAX_X,_),a.model.setValue(Vt.ROOM_MIN_Y,d),a.model.setValue(Vt.ROOM_MAX_Y,g);const m=Math.trunc(l*423+_*671+d*913+g*7509);h&&h.model&&h.model.setValue(I.ROOM_RANDOM_SEED,m)}const u=h&&h.logic||null;if(u&&(u.initialize(t),e&&(u.processUpdateMessage(new ye(ye.ROOM_FLOOR_UPDATE,e)),a.model.setValue(I.ROOM_FLOOR_TYPE,e)),i&&(u.processUpdateMessage(new ye(ye.ROOM_WALL_UPDATE,i)),a.model.setValue(I.ROOM_WALL_TYPE,i)),r&&(u.processUpdateMessage(new ye(ye.ROOM_LANDSCAPE_UPDATE,r)),a.model.setValue(I.ROOM_LANDSCAPE_TYPE,r))),t&&t.doors.length){let c=0;for(;c<t.doors.length;){const l=t.doors[c];if(l){const _=l.x,d=l.y,g=l.z,m=l.dir,p=Ce.DOOR,T="door_"+c,A=new S(_,d,g);u.processUpdateMessage(new Ce(Ce.ADD_MASK,T,p,A,Ce.HOLE)),(m===90||m===180)&&(m===90&&(a.model.setValue(I.ROOM_DOOR_X,_-.5),a.model.setValue(I.ROOM_DOOR_Y,d)),m===180&&(a.model.setValue(I.ROOM_DOOR_X,_),a.model.setValue(I.ROOM_DOOR_Y,d-.5)),a.model.setValue(I.ROOM_DOOR_Z,g),a.model.setValue(I.ROOM_DOOR_DIR,m))}c++}}return a.createRoomObjectAndInitalize(Ht.CURSOR_OBJECT_ID,Ht.CURSOR_OBJECT_TYPE,D.CURSOR),rt.getValue("enable.avatar.arrow",!1)&&a.createRoomObjectAndInitalize(Ht.ARROW_OBJECT_ID,Ht.ARROW_OBJECT_TYPE,D.CURSOR),a}getRoomInstanceDisplay(s,t,e,i,r){const n=this.getRoomInstance(s);if(!n)return null;let a=n.renderer;if(!a&&(a=this._roomRendererFactory.createRenderer(),!a))return null;a.roomObjectVariableAccurateZ=I.OBJECT_ACCURATE_Z_VALUE,n.setRenderer(a);const o=a.createCanvas(t,e,i,r);if(!o)return null;if(n.model.getValue(Vt.RESTRICTS_SCALING)){let u=n.model.getValue(Vt.RESTRICTED_SCALE);u||(u=1),o.setScale(u),o.restrictsScaling=!0}else o.restrictsScaling=!1;if(o.setMouseListener(this._roomObjectEventHandler),o.geometry){o.geometry.z_scale=n.model.getValue(Vt.ROOM_Z_SCALE);const u=n.model.getValue(I.ROOM_DOOR_X),c=n.model.getValue(I.ROOM_DOOR_Y),l=n.model.getValue(I.ROOM_DOOR_Z),_=n.model.getValue(I.ROOM_DOOR_DIR),d=new S(u,c,l);let g=null;_===90&&(g=new S(-2e3,0,0)),_===180&&(g=new S(0,-2e3,0)),o.geometry.setDisplacement(d,g);const m=o.master;if(m){const p=new se(ut.EMPTY);p.name=Ht.OVERLAY,p.interactive=!1,m.addChild(p)}}return o.master}setRoomInstanceRenderingCanvasMask(s,t,e){const i=this.getRoomInstanceRenderingCanvas(s,t);i&&i.setMask(e)}setRoomInstanceRenderingCanvasScale(s,t,e,i=null,r=null,n=!1,a=!1){const o=this.getRoomInstanceRenderingCanvas(s,t);if(o){if(o.restrictsScaling&&!n)return;o.setScale(e,i,r,n,a),this.events.dispatchEvent(new Mt(Mt.ROOM_ZOOMED,s))}}getRoomInstanceRenderingCanvas(s,t=-1){const e=this.getRoomInstance(s);if(!e)return null;const i=e.renderer;if(!i)return null;t===-1&&(t=this._activeRoomActiveCanvas);const r=i.getCanvas(t);return r||null}getActiveRoomInstanceRenderingCanvas(){return this.getRoomInstanceRenderingCanvas(this._activeRoomId,this._activeRoomActiveCanvas)}getRoomInstanceRenderingCanvasOffset(s,t=-1){t===-1&&(t=this._activeRoomActiveCanvas);const e=this.getRoomInstanceRenderingCanvas(s,t);return e?new H(e.screenOffsetX,e.screenOffsetY):null}setRoomInstanceRenderingCanvasOffset(s,t,e){const i=this.getRoomInstanceRenderingCanvas(s,t);if(!i||!e)return!1;const r=~~e.x,n=~~e.y;if(!(i.screenOffsetX===r&&i.screenOffsetY===n))return this.events.dispatchEvent(new tI(s,-(i.screenOffsetX-r),-(i.screenOffsetY-n))),i.screenOffsetX=r,i.screenOffsetY=n,!0}getRoomInstanceRenderingCanvasScale(s=-1e3,t=-1){s===-1e3&&(s=this._activeRoomId),t===-1&&(t=this._activeRoomActiveCanvas);const e=this.getRoomInstanceRenderingCanvas(s,t);return e?e.scale:1}initializeRoomInstanceRenderingCanvas(s,t,e,i){const r=this.getRoomInstanceRenderingCanvas(s,t);r&&r.initialize(e,i)}getRoomInstanceGeometry(s,t=-1){const e=this.getRoomInstance(s);if(!e)return null;const i=e.renderer;if(!i)return null;t===-1&&(t=this._activeRoomActiveCanvas);const r=i.getCanvas(t);return r?r.geometry:null}getRoomInstanceVariable(s,t){const e=this.getRoomInstance(s);return e&&e.model&&e.model.getValue(t)||null}updateRoomInstancePlaneVisibility(s,t,e=!0){const i=this.getRoomOwnObject(s);return i?(i.processUpdateMessage(new Wi(Wi.WALL_VISIBILITY,t)),i.processUpdateMessage(new Wi(Wi.FLOOR_VISIBILITY,e)),!0):!1}updateRoomInstancePlaneThickness(s,t,e){const i=this.getRoomOwnObject(s);return i?(i.processUpdateMessage(new Yi(Yi.WALL_THICKNESS,t)),i.processUpdateMessage(new Yi(Yi.FLOOR_THICKNESS,e)),!0):!1}updateRoomInstancePlaneType(s,t=null,e=null,i=null,r=!1){const n=this.getRoomOwnObject(s),a=this.getRoomInstance(s);if(!n){let o=this._roomDatas.get(s);return o||(o=new Rp(s,null),this._roomDatas.set(s,o)),t&&(o.floorType=t),e&&(o.wallType=e),i&&(o.landscapeType=i),!0}return t&&(a&&!r&&a.model.setValue(I.ROOM_FLOOR_TYPE,t),n.processUpdateMessage(new ye(ye.ROOM_FLOOR_UPDATE,t))),e&&(a&&!r&&a.model.setValue(I.ROOM_WALL_TYPE,e),n.processUpdateMessage(new ye(ye.ROOM_WALL_UPDATE,e))),i&&(a&&!r&&a.model.setValue(I.ROOM_LANDSCAPE_TYPE,i),n.processUpdateMessage(new ye(ye.ROOM_LANDSCAPE_UPDATE,i))),!0}updateObjectRoomColor(s,t,e,i){const r=this.getRoomOwnObject(s);if(!r||!r.logic)return!1;const n=new ll(ll.BACKGROUND_COLOR,t,e,i);return r.logic.processUpdateMessage(n),this.events.dispatchEvent(new Jm(s,t,e,i)),!0}addRoomInstanceFloorHole(s,t){if(t<0)return;const e=this.getRoomOwnObject(s),i=this.getRoomObjectFloor(s,t);if(e&&e.logic&&i&&i.model){const r=i.getLocation(),n=i.model.getValue(I.FURNITURE_SIZE_X),a=i.model.getValue(I.FURNITURE_SIZE_Y);e.processUpdateMessage(new zi(zi.ADD,t,r.x,r.y,n,a))}}removeRoomInstanceFloorHole(s,t){if(t<0)return;const e=this.getRoomOwnObject(s);e&&e.processUpdateMessage(new zi(zi.REMOVE,t))}setRoomEngineGameMode(s,t){const e=this.getRoomInstance(s);if(!e)return;const i=t?1:0;e.model.setValue(Vt.IS_PLAYING_GAME,i),i===0?this.events.dispatchEvent(new Mt(Mt.NORMAL_MODE,s)):this.events.dispatchEvent(new Mt(Mt.GAME_MODE,s))}isRoomIdPlayingGame(s){const t=this.getRoomInstance(s);return t?t.model.getValue(Vt.IS_PLAYING_GAME)>0:!1}isPlayingGame(){return this.isRoomIdPlayingGame(this._activeRoomId)}disableUpdate(s){s?Bi().remove(this.update,this):(Bi().remove(this.update,this),Bi().add(this.update,this))}runUpdate(){this.update(1)}runVisibilityUpdate(){document.hidden||this.update(1,!0)}update(s,t=!1){this._roomManager&&(s=_t(),Ue.turnVisualizationOn(),this.processPendingFurniture(),this._roomManager.update(s,t),this.updateRoomCameras(s),this._mouseCursorUpdate&&this.setPointer(),Ue.turnVisualizationOff())}setPointer(){this._mouseCursorUpdate=!1;const s=this.getRoomInstanceData(this._activeRoomId);s&&s.hasButtonMouseCursorOwners()?document.body.style.cursor="pointer":document.body.style.cursor="auto"}processPendingFurniture(){if(this._skipFurnitureCreationForNextFrame){this._skipFurnitureCreationForNextFrame=!1;return}const s=new Date().valueOf(),t=5;for(const e of this._roomInstanceDatas.values()){if(!e)continue;let i=null,r=0,n=!1;for(;i=e.getNextPendingFurnitureFloor();)if(n=this.processPendingFurnitureFloor(e.roomId,i.id,i),!(++r%t)&&new Date().valueOf()-s>=40){this._skipFurnitureCreationForNextFrame=!0;break}for(;!this._skipFurnitureCreationForNextFrame&&(i=e.getNextPendingFurnitureWall());)if(n=this.processPendingFurnitureWall(e.roomId,i.id,i),!(++r%t)&&new Date().valueOf()-s>=40){this._skipFurnitureCreationForNextFrame=!0;break}if(n&&this._roomManager&&(this._roomManager.getRoomInstance(this.getRoomId(e.roomId)).hasUninitializedObjects()||this.objectsInitialized(e.roomId.toString())),this._skipFurnitureCreationForNextFrame)return}}onRoomEngineInitalized(s){if(s){this._ready=!0,this.events.dispatchEvent(new Mt(Mt.ENGINE_INITIALIZED,0));for(const t of this._roomDatas.values())t&&this.createRoomInstance(t.roomId,t.data)}}processPendingFurnitureFloor(s,t,e){if(!e){const o=this.getRoomInstanceData(s);if(o&&(e=o.getPendingFurnitureFloor(t)),!e)return!1}let i=e.type;i||(i=this.getFurnitureFloorName(e.typeId));const r=this.createRoomObjectFloor(s,t,i);if(!r)return!1;const n=r.model;if(n&&(n.setValue(I.FURNITURE_COLOR,this.getFurnitureFloorColorIndex(e.typeId)),n.setValue(I.FURNITURE_TYPE_ID,e.typeId),n.setValue(I.FURNITURE_AD_URL,this.getRoomObjectAdUrl(e.type)),n.setValue(I.FURNITURE_REAL_ROOM_OBJECT,e.realRoomObject?1:0),n.setValue(I.FURNITURE_EXPIRY_TIME,e.expiryTime),n.setValue(I.FURNITURE_EXPIRTY_TIMESTAMP,_t()),n.setValue(I.FURNITURE_USAGE_POLICY,e.usagePolicy),n.setValue(I.FURNITURE_OWNER_ID,e.ownerId),n.setValue(I.FURNITURE_OWNER_NAME,e.ownerName)),!this.updateRoomObjectFloor(s,t,e.location,e.direction,e.state,e.data,e.extra)||e.sizeZ>=0&&!this.updateRoomObjectFloorHeight(s,t,e.sizeZ))return!1;this.events&&this.events.dispatchEvent(new Q(Q.ADDED,s,t,D.FLOOR));const a=this.getPlacedRoomObjectData(s);return a&&a.id===t&&a.category===D.FLOOR&&this.selectRoomObject(s,t,D.FLOOR),r.isReady&&e.synchronized&&this.addObjectToTileMap(s,r),!0}processPendingFurnitureWall(s,t,e){if(!e){const h=this.getRoomInstanceData(s);if(h&&(e=h.getPendingFurnitureWall(t)),!e)return!1}let i="";e.data&&(i=e.data.getLegacyString());let r=this.getFurnitureWallName(e.typeId,i);r||(r="");const n=this.createRoomObjectWall(s,t,r);if(!n)return!1;const a=n.model;if(a&&(a.setValue(I.FURNITURE_COLOR,this.getFurnitureWallColorIndex(e.typeId)),a.setValue(I.FURNITURE_TYPE_ID,e.typeId),a.setValue(I.FURNITURE_AD_URL,this.getRoomObjectAdUrl(e.type)),a.setValue(I.FURNITURE_REAL_ROOM_OBJECT,e.realRoomObject?1:0),a.setValue(I.OBJECT_ACCURATE_Z_VALUE,1),a.setValue(I.FURNITURE_EXPIRY_TIME,e.expiryTime),a.setValue(I.FURNITURE_EXPIRTY_TIMESTAMP,_t()),a.setValue(I.FURNITURE_USAGE_POLICY,e.usagePolicy),a.setValue(I.FURNITURE_OWNER_ID,e.ownerId),a.setValue(I.FURNITURE_OWNER_NAME,e.ownerName)),!this.updateRoomObjectWall(s,t,e.location,e.direction,e.state,i))return!1;this.events&&this.events.dispatchEvent(new Q(Q.ADDED,s,t,D.WALL));const o=this.getPlacedRoomObjectData(s);return o&&Math.abs(o.id)===t&&o.category===D.WALL&&this.selectRoomObject(s,t,D.WALL),!0}setRoomSessionOwnUser(s,t){if(!this._roomSessionManager)return;const e=this._roomSessionManager.getSession(s);e&&e.setOwnRoomIndex(t);const i=this.getRoomCamera(s);i&&(i.targetId=t,i.targetCategory=D.UNIT,i.activateFollowing(this.cameraFollowDuration))}get cameraFollowDuration(){return 1e3}updateRoomCameras(s){for(const t of this._roomInstanceDatas.values()){if(!t)continue;const e=t.roomCamera;if(!e)continue;let i=null;const r=this.getRoomObject(t.roomId,e.targetId,e.targetCategory);r&&(i=r.getLocation()),i&&(t.roomId!==this._activeRoomId||!this._activeRoomIsDragged)&&this.updateRoomCamera(t.roomId,1,i,s)}if(this._activeRoomWasDragged){const t=this.getRoomInstanceRenderingCanvas(this._activeRoomId,1);t&&this.setRoomInstanceRenderingCanvasOffset(this._activeRoomId,1,new H(t.screenOffsetX+this._activeRoomDragX,t.screenOffsetY+this._activeRoomDragY)),this._activeRoomDragX=0,this._activeRoomDragY=0}}updateRoomCamera(s,t,e,i){const r=this.getRoomInstanceRenderingCanvas(s,t),n=this.getRoomInstanceData(s);if(!r||!n||r.scale!==1)return;const a=r.geometry,o=n.roomCamera,h=this.getRoomInstance(s);if(!a||!o||!h)return;const u=this.getRoomCanvasRectangle(s,t);if(!u)return;let c=Math.floor(e.z)+1;const l=Math.round(u.width),_=Math.round(u.height),d=this.getCanvasBoundingRectangle(t);if(d&&(d.right<0||d.bottom<0||d.left>=l||d.top>=_)&&o.reset(),o.screenWd!==l||o.screenHt!==_||o.scale!==a.scale||o.geometryUpdateId!==a.updateId||!S.isEqual(e,o.targetObjectLoc)||o.isMoving){o.targetObjectLoc=e;const g=new S;g.assign(e),g.x=Math.round(g.x),g.y=Math.round(g.y);const m=h.model.getValue(Vt.ROOM_MIN_X)-.5,p=h.model.getValue(Vt.ROOM_MIN_Y)-.5,T=h.model.getValue(Vt.ROOM_MAX_X)+.5,A=h.model.getValue(Vt.ROOM_MAX_Y)+.5,O=Math.round((m+T)/2),v=Math.round((p+A)/2),y=2;let C=new H(g.x-O,g.y-v);const N=a.scale/Math.sqrt(2),L=N/2,P=new wt;P.rotate(-(a.direction.x+90)/180*Math.PI),C=P.apply(C),C.y=C.y*(L/N);const b=u.width/2/N-1,w=u.height/2/L-1;let q=0,ht=0,dt=0,j=0,V=a.getScreenPoint(new S(O,v,y));if(!V)return;if(V.x=V.x+Math.round(u.width/2),V.y=V.y+Math.round(u.height/2),d)if(d.x+=-r.screenOffsetX,d.y+=-r.screenOffsetY,d.width>1&&d.height>1)q=(d.left-V.x-a.scale*.25)/N,dt=(d.right-V.x+a.scale*.25)/N,ht=(d.top-V.y-a.scale*.5)/L,j=(d.bottom-V.y+a.scale*.5)/L;else{a.adjustLocation(new S(-30,-30),25);return}else{a.adjustLocation(new S(0,0),25);return}let Dt=!1,Fe=!1,qe=!1,X=!1;Math.round((dt-q)*N)<u.width?(c=2,C.x=(dt+q)/2,qe=!0):(C.x>dt-b&&(C.x=dt-b,Dt=!0),C.x<q+b&&(C.x=q+b,Dt=!0)),Math.round((j-ht)*L)<u.height?(c=2,C.y=(j+ht)/2,X=!0):(C.y>j-w&&(C.y=j-w,Fe=!0),C.y<ht+w&&(C.y=ht+w,Fe=!0),Fe&&(C.y=C.y/(L/N))),P.invert(),C=P.apply(C),C.x=C.x+O,C.y=C.y+v;let Et=.35,pt=.2,Gt=.2;const jt=10,Jt=10;if(Gt*l>100&&(Gt=100/l),Et*_>150&&(Et=150/_),pt*_>150&&(pt=150/_),o.limitedLocationX&&o.screenWd==l&&o.screenHt==_&&(Gt=0),o.limitedLocationY&&o.screenWd==l&&o.screenHt==_&&(Et=0,pt=0),u.width=u.width*(1-Gt*2),u.height=u.height*(1-(Et+pt)),u.width<jt&&(u.width=jt),u.height<Jt&&(u.height=Jt),Et+pt>0?(u.x+=-u.width/2,u.y+=-u.height*(pt/(Et+pt))):(u.x+=-u.width/2,u.y+=-u.height/2),V=a.getScreenPoint(g),!V)return;if(V){V.x=V.x+r.screenOffsetX,V.y=V.y+r.screenOffsetY,g.z=c,g.x=Math.round(C.x*2)/2,g.y=Math.round(C.y*2)/2,o.location||(a.location=g,this.useOffsetScrolling?o.initializeLocation(new S(0,0,0)):o.initializeLocation(g));const ee=a.getScreenPoint(g),Ne=new S(0,0,0);ee&&(Ne.x=ee.x,Ne.y=ee.y),(V.x<u.left||V.x>u.right)&&!o.centeredLocX||(V.y<u.top||V.y>u.bottom)&&!o.centeredLocY||qe&&!o.centeredLocX&&o.screenWd!=l||X&&!o.centeredLocY&&o.screenHt!=_||o.roomWd!=d.width||o.roomHt!=d.height||o.screenWd!=l||o.screenHt!=_?(o.limitedLocationX=Dt,o.limitedLocationY=Fe,this.useOffsetScrolling?o.target=Ne:o.target=g):(Dt||(o.limitedLocationX=!1),Fe||(o.limitedLocationY=!1))}o.centeredLocX=qe,o.centeredLocY=X,o.screenWd=l,o.screenHt=_,o.scale=a.scale,o.geometryUpdateId=a.updateId,o.roomWd=d.width,o.roomHt=d.height,this._sessionDataManager.isCameraFollowDisabled||(this.useOffsetScrolling?o.update(i,8):o.update(i,.5)),this.useOffsetScrolling?this.setRoomInstanceRenderingCanvasOffset(this.activeRoomId,1,new H(-o.location.x,-o.location.y)):a.adjustLocation(o.location,25)}else o.limitedLocationX=!1,o.limitedLocationY=!1,o.centeredLocX=!1,o.centeredLocY=!1}getRoomCanvasRectangle(s,t){const e=this.getRoomInstanceRenderingCanvas(s,t);return e?new et(0,0,e.width,e.height):null}getRoomObjectBoundingRectangle(s,t,e,i){const r=this.getRoomInstanceGeometry(s,i);if(!r)return null;const n=this.getRoomObject(s,t,e);if(!n)return null;const a=n.visualization;if(!a)return null;const o=a.getBoundingRectangle(),h=this.getRoomInstanceRenderingCanvas(s,i),u=h?h.scale:1,c=r.getScreenPoint(n.getLocation());return!c||(c.x=Math.round(c.x),c.y=Math.round(c.y),o.x=o.x*u,o.y=o.y*u,o.width=o.width*u,o.height=o.height*u,c.x=c.x*u,c.y=c.y*u,o.x+=c.x,o.y+=c.y,!h)?null:(o.x+=Math.round(h.width/2)+h.screenOffsetX,o.y+=Math.round(h.height/2)+h.screenOffsetY,o)}getCanvasBoundingRectangle(s){return this.getRoomObjectBoundingRectangle(this._activeRoomId,Ht.ROOM_OBJECT_ID,D.ROOM,s)}getFurnitureFloorName(s){return this._roomContentLoader?this._roomContentLoader.getFurnitureFloorNameForTypeId(s):null}getFurnitureWallName(s,t=null){return this._roomContentLoader?this._roomContentLoader.getFurnitureWallNameForTypeId(s,t):null}getFurnitureFloorColorIndex(s){return this._roomContentLoader?this._roomContentLoader.getFurnitureFloorColorIndex(s):null}getFurnitureWallColorIndex(s){return this._roomContentLoader?this._roomContentLoader.getFurnitureWallColorIndex(s):null}getRoomInstanceData(s){const t=this._roomInstanceDatas.get(s);if(t)return t;const e=new sq(s);return this._roomInstanceDatas.set(e.roomId,e),e}getRoomInstanceModelName(s){const t=this.getRoomInstanceData(s);return t?t.modelName:null}setRoomInstanceModelName(s,t){const e=this.getRoomInstanceData(s);e&&e.setModelName(t)}getRoomTileObjectMap(s){const t=this.getRoomInstanceData(s);return t?t.tileObjectMap:null}getCurrentRoomCamera(){return this.getRoomCamera(this._activeRoomId)}getRoomCamera(s){const t=this.getRoomInstanceData(s);return t?t.roomCamera:null}getSelectedRoomObjectData(s){const t=this.getRoomInstanceData(s);return t?t.selectedObject:null}setSelectedRoomObjectData(s,t){const e=this.getRoomInstanceData(s);if(!e)return null;e.setSelectedObject(t),t&&e.setPlacedObject(null)}getPlacedRoomObjectData(s){const t=this.getRoomInstanceData(s);return t?t.placedObject:null}setPlacedRoomObjectData(s,t){const e=this.getRoomInstanceData(s);if(!e)return null;e.setPlacedObject(t)}cancelRoomObjectPlacement(){this._roomObjectEventHandler&&this._roomObjectEventHandler.cancelRoomObjectPlacement(this._activeRoomId)}getFurnitureStackingHeightMap(s){const t=this.getRoomInstanceData(s);return t?t.furnitureStackingHeightMap:null}setFurnitureStackingHeightMap(s,t){const e=this.getRoomInstanceData(s);if(!e)return null;e.setFurnitureStackingHeightMap(t)}getLegacyWallGeometry(s){const t=this.getRoomInstanceData(s);return t?t.legacyGeometry:null}createRoomObjectAndInitialize(s,t,e,i){const r=this.getRoomInstance(s);return r?r.createRoomObjectAndInitalize(t,e,i):null}getTotalObjectsForManager(s,t){const e=this.getRoomInstance(s);return e?e.getTotalObjectsForManager(t):0}getRoomObject(s,t,e){if(!this._ready)return null;let i=this.getRoomId(s);return s===0&&(i=Ht.TEMPORARY_ROOM),this.getObject(i,t,e)}getObject(s,t,e){let i=null;if(this._roomManager&&(i=this._roomManager.getRoomInstance(s)),!i)return null;let r=i.getRoomObject(t,e);if(!r)switch(e){case D.FLOOR:this.processPendingFurnitureFloor(this.getRoomIdFromString(s),t,null),r=i.getRoomObject(t,e);break;case D.WALL:this.processPendingFurnitureWall(this.getRoomIdFromString(s),t,null),r=i.getRoomObject(t,e);break}return r}getRoomObjectByIndex(s,t,e){const i=this.getRoomInstance(s);return i?i.getRoomObjectByIndex(t,e):null}getRoomObjectCategoryForType(s){return!s||!this._roomContentLoader?D.MINIMUM:this._roomContentLoader.getCategoryForType(s)}getRoomObjectCursor(s){return this.getObject(this.getRoomId(s),Ht.CURSOR_OBJECT_ID,D.CURSOR)}getRoomObjectSelectionArrow(s){return this.getObject(this.getRoomId(s),Ht.ARROW_OBJECT_ID,D.CURSOR)}getRoomOwnObject(s){return this.getObject(this.getRoomId(s),Ht.ROOM_OBJECT_ID,D.ROOM)}getRoomObjectUser(s,t){return this.getObject(this.getRoomId(s),t,D.UNIT)}removeRoomObjectUser(s,t){return this.removeRoomObject(s,t,D.UNIT)}createRoomObjectUser(s,t,e){return this.createRoomObjectAndInitialize(s,t,e,D.UNIT)}getRoomObjectFloor(s,t){return this.getObject(this.getRoomId(s),t,D.FLOOR)}createRoomObjectFloor(s,t,e){return this.createRoomObjectAndInitialize(s,t,e,D.FLOOR)}removeRoomObjectFloor(s,t,e=-1,i=!1){const r=this.getRoomInstanceData(s);if(r&&r.removePendingFunitureFloor(t),this._sessionDataManager&&e===this._sessionDataManager.userId&&!of.isBuilderClubId(t)){const n=this.getRoomObject(s,t,D.FLOOR);if(n){const a=this.getRoomObjectScreenLocation(s,t,D.FLOOR,this._activeRoomActiveCanvas);if(a&&!(n.model.getValue(I.FURNITURE_DISABLE_PICKING_ANIMATION)===1)){const h=n.model.getValue(I.FURNITURE_TYPE_ID),u=n.model.getValue(I.FURNITURE_EXTRAS),c=n.model.getValue(I.FURNITURE_DATA_FORMAT),l=vr.getData(c),_=this.getFurnitureFloorIcon(h,null,u,l).data;if(_){const d=qt.generateImage(_);if(this.events){const g=new Fc(d,a.x,a.y);g.iconName=$i.INVENTORY,this.events.dispatchEvent(g)}}}}}this.removeRoomObject(s,t,D.FLOOR),this.setMouseDefault(s,D.FLOOR,t),i&&this.refreshTileObjectMap(s,"RoomEngine.disposeObjectFurniture()")}getRoomObjectWall(s,t){return this.getObject(this.getRoomId(s),t,D.WALL)}removeRoomObjectWall(s,t,e=-1){if(this._sessionDataManager&&e===this._sessionDataManager.userId&&!of.isBuilderClubId(t)){const i=this.getRoomObject(s,t,D.WALL);if(i&&i.type.indexOf("post_it")===-1&&i.type.indexOf("external_image_wallitem")===-1){const r=this.getRoomObjectScreenLocation(s,t,D.WALL,this._activeRoomActiveCanvas);if(r){const n=i.model.getValue(I.FURNITURE_TYPE_ID),a=i.model.getValue(I.FURNITURE_DATA),o=this.getFurnitureWallIcon(n,null,a).data;if(o){const h=qt.generateImage(o);if(this.events){const u=new Fc(h,r.x,r.y);u.iconName=$i.INVENTORY,this.events.dispatchEvent(u)}}}}}this.removeRoomObject(s,t,D.WALL),this.updateRoomObjectMask(s,t,!1),this.setMouseDefault(s,D.WALL,t)}createRoomObjectWall(s,t,e){return this.createRoomObjectAndInitialize(s,t,e,D.WALL)}removeRoomObject(s,t,e){const i=this.getRoomInstance(s);if(!i)return null;i.removeRoomObject(t,e),this.events&&this.events.dispatchEvent(new Q(Q.REMOVED,s,t,e))}addFurnitureFloor(s,t,e,i,r,n,a,o=NaN,h=-1,u=0,c=0,l="",_=!0,d=!0,g=-1){const m=this.getRoomInstanceData(s);if(!m)return!1;const p=new $_(t,e,null,i,r,n,a,o,h,u,c,l,_,d,g);return m.addPendingFurnitureFloor(p),!0}addFurnitureFloorByTypeName(s,t,e,i,r,n,a,o=NaN,h=-1,u=0,c=0,l="",_=!0,d=!0,g=-1){const m=this.getRoomInstanceData(s);if(!m)return!1;const p=new $_(t,0,e,i,r,n,a,o,h,u,c,l,_,d,g);return m.addPendingFurnitureFloor(p),!0}addFurnitureWall(s,t,e,i,r,n,a,o=-1,h=0,u=0,c="",l=!0){const _=this.getRoomInstanceData(s);if(!_)return!1;const d=new _s;d.setString(a);const g=new $_(t,e,null,i,r,n,d,NaN,o,h,u,c,!0,l);return _.addPendingFurnitureWall(g),!0}updateRoomObjectFloor(s,t,e,i,r,n,a=null){const o=this.getRoomObjectFloor(s,t);return o?(o.processUpdateMessage(new me(e,i)),o.processUpdateMessage(new Ft(r,n,a)),!0):!1}updateRoomObjectWall(s,t,e,i,r,n=null){const a=this.getRoomObjectWall(s,t);if(!a||!a.logic)return!1;const o=new me(e,i),h=new _s,u=new Ft(r,h);return h.setString(n),a.logic.processUpdateMessage(o),a.logic.processUpdateMessage(u),this.updateRoomObjectMask(s,t),!0}updateRoomObjectWallItemData(s,t,e){const i=this.getRoomObjectWall(s,t);return!i||!i.logic?!1:(i.logic.processUpdateMessage(new sg(e)),!0)}updateRoomObjectFloorHeight(s,t,e){const i=this.getRoomObjectFloor(s,t);return i?(i.processUpdateMessage(new vA(null,null,e)),!0):!1}updateRoomObjectFloorExpiration(s,t,e){const i=this.getRoomObjectFloor(s,t);return i?(i.model.setValue(I.FURNITURE_EXPIRY_TIME,e),i.model.setValue(I.FURNITURE_EXPIRTY_TIMESTAMP,_t()),!0):!1}updateRoomObjectWallExpiration(s,t,e){const i=this.getRoomObjectWall(s,t);return i?(i.model.setValue(I.FURNITURE_EXPIRY_TIME,e),i.model.setValue(I.FURNITURE_EXPIRTY_TIMESTAMP,_t()),!0):!1}updateRoomObjectMask(s,t,e=!0){const i=D.WALL+"_"+t,r=this.getRoomObjectWall(s,t);let n=null;if(r&&r.model){if(r.model.getValue(I.FURNITURE_USES_PLANE_MASK)>0){const o=r.model.getValue(I.FURNITURE_PLANE_MASK_TYPE),h=r.getLocation();e?n=new Ce(Ce.ADD_MASK,i,o,h):n=new Ce(Ce.REMOVE_MASK,i)}}else n=new Ce(Ce.REMOVE_MASK,i);const a=this.getRoomOwnObject(s);a&&a.logic&&n&&a.logic.processUpdateMessage(n)}rollRoomObjectFloor(s,t,e,i){const r=this.getRoomObjectFloor(s,t);r&&r.processUpdateMessage(new Dr(e,i,null,!!i))}updateRoomObjectWallLocation(s,t,e){const i=this.getRoomObjectWall(s,t);return i?(i.logic&&i.logic.processUpdateMessage(new Dr(e,null,null)),this.updateRoomObjectMask(s,t),!0):!1}addRoomObjectUser(s,t,e,i,r,n,a){if(this.getRoomObjectUser(s,t))return!1;let h=ft.getTypeString(n);h===ft.PET&&(h=this.getPetType(a));const u=this.createRoomObjectUser(s,t,h);return u?(u.processUpdateMessage(new ul(this.fixedUserLocation(s,e),null,i,r,!1,0)),a&&u.processUpdateMessage(new ol(a)),this.events&&this.events.dispatchEvent(new Q(Q.ADDED,s,t,D.UNIT)),!0):!1}updateRoomObjectUserLocation(s,t,e,i,r=!1,n=0,a=null,o=NaN){const h=this.getRoomObjectUser(s,t);if(!h)return!1;e||(e=h.getLocation()),a||(a=h.getDirection()),isNaN(o)&&(o=h.model.getValue(I.HEAD_DIRECTION)),h.processUpdateMessage(new ul(this.fixedUserLocation(s,e),this.fixedUserLocation(s,i),a,o,r,n));const u=this._roomSessionManager&&this._roomSessionManager.getSession(s)||null;return u&&u.ownRoomIndex===t&&this._logicFactory.events.dispatchEvent(new Qo(Qo.ROAME_MOVE_TO,i)),!0}fixedUserLocation(s,t){if(!t)return null;const e=this.getFurnitureStackingHeightMap(s),i=this.getLegacyWallGeometry(s);if(!e||!i)return t;let r=t.z;const n=e.getTileHeight(t.x,t.y),a=i.getHeight(t.x,t.y);return Math.abs(r-n)<.1&&Math.abs(n-a)<.1&&(r=i.getFloorAltitude(t.x,t.y)),new S(t.x,t.y,r)}updateRoomObjectUserAction(s,t,e,i,r=null){const n=this.getRoomObjectUser(s,t);if(!n)return!1;let a=null;switch(e){case I.FIGURE_TALK:a=new $f(i);break;case I.FIGURE_SLEEP:a=new eg(i===1);break;case I.FIGURE_IS_TYPING:a=new OA(i===1);break;case I.FIGURE_IS_MUTED:a=new EA(i===1);break;case I.FIGURE_CARRY_OBJECT:a=new uA(i,r);break;case I.FIGURE_USE_OBJECT:a=new AA(i);break;case I.FIGURE_DANCE:a=new lA(i);break;case I.FIGURE_GAINED_EXPERIENCE:a=new cA(i);break;case I.FIGURE_NUMBER_VALUE:a=new IA(i);break;case I.FIGURE_SIGN:a=new RA(i);break;case I.FIGURE_EXPRESSION:a=new dA(i);break;case I.FIGURE_IS_PLAYING_GAME:a=new TA(i===1);break;case I.FIGURE_GUIDE_STATUS:a=new $K(i);break}return a?(n.processUpdateMessage(a),!0):!1}updateRoomObjectUserFigure(s,t,e,i=null,r=null,n=!1){const a=this.getRoomObjectUser(s,t);return a?(a.processUpdateMessage(new ol(e,i,r,n)),!0):!1}updateRoomObjectUserFlatControl(s,t,e){const i=this.getRoomObjectUser(s,t);return i?(i.processUpdateMessage(new fA(parseInt(e))),!0):!1}updateRoomObjectUserEffect(s,t,e,i=0){const r=this.getRoomObjectUser(s,t);return r?(r.processUpdateMessage(new _A(e,i)),!0):!1}updateRoomObjectUserGesture(s,t,e){const i=this.getRoomObjectUser(s,t);return i?(i.processUpdateMessage(new gA(e)),!0):!1}updateRoomObjectUserPetGesture(s,t,e){const i=this.getRoomObjectUser(s,t);return i?(i.processUpdateMessage(new mA(e)),!0):!1}updateRoomObjectUserPosture(s,t,e,i=null){const r=this.getRoomObjectUser(s,t);return r?(r.processUpdateMessage(new tg(e,i)),!0):!1}updateRoomObjectUserOwn(s,t){const e=this.getRoomObjectUser(s,t);e&&e.processUpdateMessage(new pA)}useRoomObject(s,t){const e=this.getRoomObject(this._activeRoomId,s,t);if(e){const i=e.logic;if(i)return i.useObject(),!0}return!1}objectInitialized(s,t,e){const i=this.getRoomIdFromString(s);e===D.WALL&&this.updateRoomObjectMask(i,t);const r=this.getRoomObject(i,t,e);if(r&&r.model&&r.logic){const n=r.model.getValue(I.FURNITURE_DATA_FORMAT);if(!isNaN(n)){const a=vr.getData(n);a.initializeFromRoomObjectModel(r.model),r.processUpdateMessage(new Ft(r.getState(0),a))}this.events.dispatchEvent(new Q(Q.CONTENT_UPDATED,i,t,e))}s!==Ht.TEMPORARY_ROOM&&this.addObjectToTileMap(i,r)}changeObjectModelData(s,t,e,i,r){const n=this.getObject(this.getRoomId(s),t,e);if(!n||!n.logic)return!1;const a=new SA(i,r);return n.processUpdateMessage(a),!0}changeObjectState(s,t,e){const i=this.getObject(this.getRoomId(s),t,e);if(!i||!i.model)return;let r=i.model.getValue(I.FURNITURE_AUTOMATIC_STATE_INDEX);isNaN(r)?r=1:r=r+1,i.model.setValue(I.FURNITURE_AUTOMATIC_STATE_INDEX,r);const n=i.model.getValue(I.FURNITURE_DATA_FORMAT),a=vr.getData(n);a.initializeFromRoomObjectModel(i.model),i.logic&&i.logic.processUpdateMessage(new Ft(r,a))}loadRoomObjectBadgeImage(s,t,e,i,r=!0){if(!this._sessionDataManager)return;let n=null;if(s===0){const o=this._roomManager.getRoomInstance(Ht.TEMPORARY_ROOM);o&&(n=o.getRoomObject(t,e))}else n=this.getRoomObjectFloor(s,t);if(!n||!n.logic)return;let a=r?this._sessionDataManager.loadGroupBadgeImage(i):this._sessionDataManager.loadBadgeImage(i);if(a)this.putBadgeInObjectAssets(n,i,r);else{a="loading_icon",this._badgeListenerObjects||(this._badgeListenerObjects=new Map),this._badgeListenerObjects.size||this._sessionDataManager.events.addEventListener(Jo.IMAGE_READY,this.onBadgeImageReadyEvent);let o=this._badgeListenerObjects.get(i);o||(o=[]),o.push(new iq(n,r)),this._badgeListenerObjects.set(i,o)}n.logic.processUpdateMessage(new ba(i,a))}onBadgeImageReadyEvent(s){if(!this._sessionDataManager)return;const t=this._badgeListenerObjects&&this._badgeListenerObjects.get(s.badgeId);if(t){for(const e of t){if(!e)continue;this.putBadgeInObjectAssets(e.object,s.badgeId,e.groupBadge);const i=e.groupBadge?this._sessionDataManager.loadGroupBadgeImage(s.badgeId):this._sessionDataManager.loadBadgeImage(s.badgeId);e.object&&e.object.logic&&e.object.logic.processUpdateMessage(new ba(s.badgeId,i))}this._badgeListenerObjects.delete(s.badgeId),this._badgeListenerObjects.size||this._sessionDataManager.events.removeEventListener(Jo.IMAGE_READY,this.onBadgeImageReadyEvent)}}putBadgeInObjectAssets(s,t,e=!1){if(!this._roomContentLoader||!this._sessionDataManager)return;const i=e?this._sessionDataManager.loadGroupBadgeImage(t):this._sessionDataManager.loadBadgeImage(t),r=e?this._sessionDataManager.getGroupBadgeImage(t):this._sessionDataManager.getBadgeImage(t);r&&this._roomContentLoader.addAssetToCollection(s.type,i,r,!1)}dispatchMouseEvent(s,t,e,i,r,n,a,o){const h=this.getRoomInstanceRenderingCanvas(this._activeRoomId,s);if(!h)return;const u=this.getRenderingCanvasOverlay(h),c=this.getOverlayIconSprite(u,Ht.OBJECT_ICON_SPRITE);if(c){const l=c.getLocalBounds();c.x=t-l.width/2,c.y=e-l.height/2}if(!this.handleRoomDragging(h,t,e,i,r,n,a)&&!h.handleMouseEvent(t,e,i,r,n,a,o)){let l=null;i===k.MOUSE_CLICK?(this.events&&this.events.dispatchEvent(new Q(Q.DESELECTED,this._activeRoomId,-1,D.MINIMUM)),l=$.CLICK):i===k.MOUSE_MOVE?l=$.MOUSE_MOVE:i===k.MOUSE_DOWN?l=$.MOUSE_DOWN:i===k.MOUSE_DOWN_LONG?l=$.MOUSE_DOWN_LONG:i===k.MOUSE_UP&&(l=$.MOUSE_UP),this._roomObjectEventHandler.handleRoomObjectEvent(new $(l,this.getRoomObject(this._activeRoomId,Ht.ROOM_OBJECT_ID,D.ROOM),null,r),this._activeRoomId)}this._activeRoomActiveCanvas=s,this._activeRoomActiveCanvasMouseX=t,this._activeRoomActiveCanvasMouseY=e}handleRoomDragging(s,t,e,i,r,n,a){let o=t-this._activeRoomActiveCanvasMouseX,h=e-this._activeRoomActiveCanvasMouseY;if(i===k.MOUSE_DOWN)!r&&!n&&!a&&!this.isDecorating&&this._roomAllowsDragging&&(this._activeRoomIsDragged=!0,this._activeRoomWasDragged=!1,this._activeRoomDragStartX=this._activeRoomActiveCanvasMouseX,this._activeRoomDragStartY=this._activeRoomActiveCanvasMouseY);else if(i===k.MOUSE_UP){if(this._activeRoomIsDragged&&(this._activeRoomIsDragged=!1,this._activeRoomWasDragged)){const u=this.getRoomInstanceData(this._activeRoomId);if(u){const c=u.roomCamera;c&&(this.useOffsetScrolling&&(c.isMoving||(c.centeredLocX=!1,c.centeredLocY=!1),c.resetLocation(new S(-s.screenOffsetX,-s.screenOffsetY))),this._roomDraggingAlwaysCenters&&c.reset())}}}else if(i===k.MOUSE_MOVE)this._activeRoomIsDragged&&(this._activeRoomWasDragged||(o=t-this._activeRoomDragStartX,h=e-this._activeRoomDragStartY,(o<=-Ht.DRAG_THRESHOLD||o>=Ht.DRAG_THRESHOLD||h<=-Ht.DRAG_THRESHOLD||h>=Ht.DRAG_THRESHOLD)&&(this._activeRoomWasDragged=!0),o=0,h=0),(o!=0||h!=0)&&(this._activeRoomDragX+=o,this._activeRoomDragY+=h,this._activeRoomWasDragged=!0));else if((i===k.MOUSE_CLICK||i===k.DOUBLE_CLICK)&&(this._activeRoomIsDragged=!1,this._activeRoomWasDragged))return this._activeRoomWasDragged=!1,!0;return!1}updateMousePointer(s,t,e){const i=this.getRoomObjectCategoryForType(e);switch(s){case G.MOUSE_BUTTON:this.setMouseButton(this._activeRoomId,i,t);return;default:this.setMouseDefault(this._activeRoomId,i,t);return}}setMouseButton(s,t,e){if(!this._roomSessionManager)return;const i=this._roomSessionManager.getSession(s);if(i&&(t!==D.FLOOR&&t!==D.WALL||i.controllerLevel>=ms.GUEST)){const r=this.getRoomInstanceData(s);r&&r.addButtonMouseCursorOwner(t+"_"+e)&&(this._mouseCursorUpdate=!0)}}setMouseDefault(s,t,e){if(!this._roomSessionManager)return;const i=this.getRoomInstanceData(s);i&&i.removeButtonMouseCursorOwner(t+"_"+e)&&(this._mouseCursorUpdate=!0)}processRoomObjectOperation(s,t,e){if(!this._roomObjectEventHandler)return!1;this._roomObjectEventHandler.modifyRoomObject(this._activeRoomId,s,t,e)}modifyRoomObjectDataWithMap(s,t,e,i){if(!this._roomObjectEventHandler)return!1;t===D.FLOOR&&this._roomObjectEventHandler.modifyRoomObjectDataWithMap(this._activeRoomId,s,t,e,i)}modifyRoomObjectData(s,t,e,i){if(!this._roomObjectEventHandler)return!1;t===D.WALL&&this._roomObjectEventHandler.modifyWallItemData(this._activeRoomId,s,e,i)}processRoomObjectEvent(s){if(!this._roomObjectEventHandler)return;const t=this.getRoomObjectRoomId(s.object);if(!t)return;const e=this.getRoomIdFromString(t);this._roomObjectEventHandler.handleRoomObjectEvent(s,e)}processRoomObjectPlacement(s,t,e,i,r=null,n=null,a=-1,o=-1,h=null){const u=this.getRoomInstance(this._activeRoomId);return!u||u.model.getValue(Vt.ROOM_IS_PUBLIC)!==0||!this._roomObjectEventHandler?!1:this._roomObjectEventHandler.processRoomObjectPlacement(s,this._activeRoomId,t,e,i,r,n,a,o,h)}getRoomObjectScreenLocation(s,t,e,i=-1){i==-1&&(i=this._activeRoomActiveCanvas);const r=this.getRoomInstanceGeometry(s,i);if(!r)return null;const n=this.getRoomObject(s,t,e);if(!n)return null;const a=r.getScreenPoint(n.getLocation());if(!a)return null;const o=this.getRoomInstanceRenderingCanvas(s,i);return o?(a.x=a.x*o.scale,a.y=a.y*o.scale,a.x+=o.width/2+o.screenOffsetX,a.y+=o.height/2+o.screenOffsetY,a.x=Math.round(a.x),a.y=Math.round(a.y),a):null}selectRoomObject(s,t,e){this._roomObjectEventHandler&&this._roomObjectEventHandler.setSelectedObject(s,t,e)}setSelectedAvatar(s,t){this._roomObjectEventHandler||this._roomObjectEventHandler.setSelectedAvatar(s,t,!0)}cancelRoomObjectInsert(){this._roomObjectEventHandler&&this._roomObjectEventHandler.cancelRoomObjectInsert(this._activeRoomId)}addOverlayIconSprite(s,t,e,i=1){if(!s||!e)return;let r=this.getOverlayIconSprite(s,t);return r?null:(r=new se(e),r.name=t,r.scale.set(i),s.addChild(r),r)}onRoomContentLoaded(s,t,e){if(!this._roomContentLoader||s===-1)return;this._thumbnailObjectIdBank.freeNumber(s-1);const i=this._thumbnailCallbacks.get(t);if(i){this._thumbnailCallbacks.delete(t);const r=this._roomContentLoader.getImage(t);if(r)for(const n of i)n&&n.imageReady(s,null,r)}}setObjectMoverIconSprite(s,t,e,i=null,r=null,n=-1,a=-1,o=null){let h=null,u=0,c=null;const l=1;if(e)c=this.getRoomObjectImage(this._activeRoomId,s,t,new S,1,null);else if(this._roomContentLoader)if(t===D.FLOOR?(h=this._roomContentLoader.getFurnitureFloorNameForTypeId(s),u=this._roomContentLoader.getFurnitureFloorColorIndex(s)):t===D.WALL&&(h=this._roomContentLoader.getFurnitureWallNameForTypeId(s,i),u=this._roomContentLoader.getFurnitureWallColorIndex(s)),t===D.UNIT)if(h=ft.getTypeString(s),h==="pet"){h=this.getPetType(i);const m=new gl(i);c=this.getRoomObjectPetImage(m.typeId,m.paletteId,m.color,new S(180),64,null,!0,0,m.customParts,o)}else c=this.getGenericRoomObjectImage(h,i,new S(180),64,null,0,null,r,n,a,o);else c=this.getGenericRoomObjectImage(h,u.toString(),new S,1,null,0,i,r,n,a,o);if(!c||!c.data)return;const _=this.getActiveRoomInstanceRenderingCanvas();if(!_)return;const d=this.getRenderingCanvasOverlay(_);this.removeOverlayIconSprite(d,Ht.OBJECT_ICON_SPRITE);const g=this.addOverlayIconSprite(d,Ht.OBJECT_ICON_SPRITE,c.data,l);g&&(g.x=this._activeRoomActiveCanvasMouseX-c.data.width/2,g.y=this._activeRoomActiveCanvasMouseY-c.data.height/2)}getRoomObjectImage(s,t,e,i,r,n,a=0){if(!this._roomManager)return null;let o=-1,h=null,u=null,c="",l=null;const _=this.getRoomId(s),d=this._roomManager.getRoomInstance(_);if(d){const g=d.getRoomObject(t,e);if(g&&g.model)switch(o=g.id,h=g.type,e){case D.FLOOR:case D.WALL:{c=g.model.getValue(I.FURNITURE_COLOR).toString(),l=g.model.getValue(I.FURNITURE_EXTRAS);const m=g.model.getValue(I.FURNITURE_DATA_FORMAT);m!==_s.FORMAT_KEY&&(u=vr.getData(m),u.initializeFromRoomObjectModel(g.model));break}case D.UNIT:c=g.model.getValue(I.FIGURE);break}}return this.getGenericRoomObjectImage(h,c,i,r,n,a,l,u,-1,-1,null,o)}getFurnitureFloorIconUrl(s){let t=null,e="";return this._roomContentLoader?(t=this._roomContentLoader.getFurnitureFloorNameForTypeId(s),e=this._roomContentLoader.getFurnitureFloorColorIndex(s).toString(),this._roomContentLoader.getAssetIconUrl(t,e)):null}getFurnitureFloorIcon(s,t,e=null,i=null){return this.getFurnitureFloorImage(s,new S,1,t,0,e,-1,-1,i)}getFurnitureWallIconUrl(s,t=null){let e=null,i="";return this._roomContentLoader?(e=this._roomContentLoader.getFurnitureWallNameForTypeId(s,t),i=this._roomContentLoader.getFurnitureWallColorIndex(s).toString(),this._roomContentLoader.getAssetIconUrl(e,i)):null}getFurnitureWallIcon(s,t,e=null){return this.getFurnitureWallImage(s,new S,1,t,0,e)}getFurnitureFloorImage(s,t,e,i,r=0,n=null,a=-1,o=-1,h=null){let u=null,c="";return this._roomContentLoader&&(u=this._roomContentLoader.getFurnitureFloorNameForTypeId(s),c=this._roomContentLoader.getFurnitureFloorColorIndex(s).toString()),e===1&&i?this.getGenericRoomObjectThumbnail(u,c,i,n,h):this.getGenericRoomObjectImage(u,c,t,e,i,r,n,h,a,o)}getFurnitureWallImage(s,t,e,i,r=0,n=null,a=-1,o=-1){let h=null,u="";return this._roomContentLoader&&(h=this._roomContentLoader.getFurnitureWallNameForTypeId(s),u=this._roomContentLoader.getFurnitureWallColorIndex(s).toString()),e===1&&i?this.getGenericRoomObjectThumbnail(h,u,i,n,null):this.getGenericRoomObjectImage(h,u,t,e,i,r,n,null,a,o)}getRoomObjectPetImage(s,t,e,i,r,n,a=!1,o=0,h=null,u=null){let c=null,l=s+" "+t+" "+e.toString(16);if(a&&(l=l+" head"),h){l=l+(" "+h.length);for(const _ of h)l=l+(" "+_.layerId+" "+_.partId+" "+_.paletteId)}return this._roomContentLoader&&(c=this._roomContentLoader.getPetNameForType(s)),this.getGenericRoomObjectImage(c,l,i,r,n,o,null,null,-1,-1,u)}getGenericRoomObjectImage(s,t,e,i,r,n=0,a=null,o=null,h=-1,u=-1,c=null,l=-1){if(!this._roomManager)return null;const _=new fp;if(_.id=-1,!this._ready||!s)return _;let d=this._roomManager.getRoomInstance(Ht.TEMPORARY_ROOM);if(!d&&(d=this._roomManager.createRoomInstance(Ht.TEMPORARY_ROOM),!d))return _;let g=this._imageObjectIdBank.reserveNumber();const m=this.getRoomObjectCategoryForType(s);if(g<0)return _;g++;const p=d.createRoomObjectAndInitalize(g,s,m);if(!p||!p.model||!p.logic)return _;const T=p.model;switch(m){case D.FLOOR:case D.WALL:T.setValue(I.FURNITURE_COLOR,parseInt(t)),T.setValue(I.FURNITURE_EXTRAS,a);break;case D.UNIT:if(s===ft.USER||s===ft.BOT||s===ft.RENTABLE_BOT||s===ft.PET)T.setValue(I.FIGURE,t);else{const y=new gl(t);T.setValue(I.PET_PALETTE_INDEX,y.paletteId),T.setValue(I.PET_COLOR,y.color),y.headOnly&&T.setValue(I.PET_HEAD_ONLY,1),y.hasCustomParts&&(T.setValue(I.PET_CUSTOM_LAYER_IDS,y.customLayerIds),T.setValue(I.PET_CUSTOM_PARTS_IDS,y.customPartIds),T.setValue(I.PET_CUSTOM_PALETTE_IDS,y.customPaletteIds)),c&&T.setValue(I.FIGURE_POSTURE,c)}break}p.setDirection(e);const A=p.visualization;if(!A)return d.removeRoomObject(g,m),_;(h>-1||o)&&(o&&o.getLegacyString()!==""?p.logic.processUpdateMessage(new Ft(parseInt(o.getLegacyString()),o)):p.logic.processUpdateMessage(new Ft(h,o)));const O=new bn(i,new S(-135,30,0),new S(11,11,5));if(A.update(O,0,!0,!1),u>0){let y=0;for(;y<u;)A.update(O,0,!0,!1),y++}const v=A.getImage(n,l);if(_.data=v,_.id=g,!this.isRoomContentTypeLoaded(s)&&r){let y=this._imageCallbacks.get(g.toString());y||(y=[],this._imageCallbacks.set(g.toString(),y)),y.push(r),T.setValue(I.IMAGE_QUERY_SCALE,i)}else d.removeRoomObject(g,m),this._imageObjectIdBank.freeNumber(g-1),_.id=0;return O.dispose(),_}getGenericRoomObjectThumbnail(s,t,e,i=null,r=null){if(!this._roomManager)return null;const n=new fp;if(n.id=-1,!this._ready||!s)return n;let a=this._roomManager.getRoomInstance(Ht.TEMPORARY_ROOM);if(!a&&(a=this._roomManager.createRoomInstance(Ht.TEMPORARY_ROOM),!a))return n;let o=this._thumbnailObjectIdBank.reserveNumber();if(this.getRoomObjectCategoryForType(s),o<0)return n;o++,n.id=o,n.data=null,n.image=null;const h=[s,t].join("_"),u=this._roomContentLoader.getImage(h);if(!u&&e){let c=this._thumbnailCallbacks.get(h);c||(c=[],this._thumbnailCallbacks.set(h,c),this._roomContentLoader.downloadImage(o,s,t,null)),c.push(e)}else u&&(n.image=u),this._thumbnailObjectIdBank.freeNumber(o-1),n.id=0;return n}initalizeTemporaryObjectsByType(s,t){const e=this._roomManager.getRoomInstance(Ht.TEMPORARY_ROOM);if(!e||!this._roomContentLoader)return;const i=this._roomContentLoader.getCategoryForType(s),r=e.getManager(i);let n=null,a=0;if(r&&r.objects.length){for(const o of r.objects.getValues())if(o&&o.model&&o.type===s){const h=o.id,u=o.visualization;let c=null;if(u){const _=o.model.getValue(I.IMAGE_QUERY_SCALE);n&&a!==_&&(n.dispose(),n=null),n||(a=_,n=new bn(_,new S(-135,30,0),new S(11,11,5))),u.update(n,0,!0,!1),c=u.image}e.removeRoomObject(h,i),this._imageObjectIdBank.freeNumber(h-1);const l=this._imageCallbacks.get(h.toString());if(l){this._imageCallbacks.delete(h.toString());for(const _ of l)_&&(c?_.imageReady(h,c):_.imageFailed(h))}}}n&&n.dispose()}setObjectMoverIconSpriteVisible(s){const t=this.getActiveRoomInstanceRenderingCanvas();if(!t)return;const e=this.getRenderingCanvasOverlay(t),i=this.getOverlayIconSprite(e,Ht.OBJECT_ICON_SPRITE);i&&(i.visible=s)}removeObjectMoverIconSprite(){const s=this.getActiveRoomInstanceRenderingCanvas();if(!s)return;const t=this.getRenderingCanvasOverlay(s);this.removeOverlayIconSprite(t,Ht.OBJECT_ICON_SPRITE)}getRenderingCanvasOverlay(s){if(!s)return null;const t=s.master;return t&&t.getChildByName(Ht.OVERLAY)||null}removeOverlayIconSprite(s,t){if(!s)return!1;let e=s.children.length-1;for(;e>=0;){const i=s.getChildAt(e);if(i&&i.name===t){if(s.removeChildAt(e),i.children.length){const r=i.getChildAt(0);r.parent.removeChild(r),r.destroy()}return!0}e--}return!1}getOverlayIconSprite(s,t){if(!s)return null;let e=s.children.length-1;for(;e>=0;){const i=s.getChildAt(e);if(i&&i.name===t)return i;e--}return null}getRoomObjects(s,t){if(this._ready){const e=this.getRoomId(s),i=this._roomManager.getRoomInstance(e);if(i)return i.getRoomObjectsForCategory(t)}return[]}addObjectToTileMap(s,t){const e=this.getRoomInstanceData(s).tileObjectMap;e&&e.addRoomObject(t)}refreshTileObjectMap(s,t){const e=this.getRoomInstanceData(s).tileObjectMap;e&&e.populate(this.getRoomObjects(s,D.FLOOR))}getRenderRoomMessage(s,t,e=!1,i=!0,r=!1,n=-1){let a=null;if(n>-1?a=this.getRoomInstanceRenderingCanvas(this._activeRoomId,n):a=this.getActiveRoomInstanceRenderingCanvas(),!a)return null;r&&a.skipSpriteVisibilityChecking();let o=-1;!i&&this._roomSessionManager.getSession(this._activeRoomId)!=null&&(o=this._roomSessionManager.getSession(this._activeRoomId).ownRoomIndex);const h=new Fh,u=h.getFurniData(s,a,this,o),c=h.getRoomRenderingModifiers(this),l=h.getRoomPlanes(s,a,this,t);return r&&a.resumeSpriteVisibilityChecking(),Y.log(u,c,l),null}createTextureFromRoom(s,t=-1,e=null){let i=null;t>-1?i=this.getRoomInstanceRenderingCanvas(this._activeRoomId,t):i=this.getActiveRoomInstanceRenderingCanvas();let r=null;return e?r=qt.generateTexture(i.master,e):r=i.getDisplayAsTexture(),r}saveTextureAsScreenshot(s,t=!1){let e=null;t?e=new Bd:e=new al,e.assignBitmap(s),this._communication.connection.send(e)}saveBase64AsScreenshot(s,t=!1){let e=null;t?e=new Bd:e=new al,e.assignBase64(s),this._communication.connection.send(e)}objectsInitialized(s){const t=this.getRoomIdFromString(s);this.events.dispatchEvent(new Mt(Mt.OBJECTS_INITIALIZED,t))}getRoomId(s){return s.toString()}getRoomIdFromString(s){if(!s)return-1;const t=s.split("_");return t.length<=0?-1:parseInt(t[0])||0}getRoomObjectRoomId(s){return!s||!s.model?null:s.model.getValue(I.OBJECT_ROOM_ID)}getRoomObjectAdUrl(s){return this._roomContentLoader.getRoomObjectAdUrl(s)}getPetTypeId(s){let t=-1;if(s){const e=s.split(" ");e.length>1&&(t=parseInt(e[0]))}return t}getPetType(s){if(!s)return null;const t=s.split(" ");if(t.length>1){const e=parseInt(t[0]);return this._roomContentLoader?this._roomContentLoader.getPetNameForType(e):"pet"}return null}isRoomContentTypeLoaded(s){return this._roomContentLoader?this._roomContentLoader.getCollection(s)!==null:!1}getPetColorResult(s,t){return this._roomContentLoader?this._roomContentLoader.getPetColorResult(s,t):null}getPetColorResultsForTag(s,t){return this._roomContentLoader?this._roomContentLoader.getPetColorResultsForTag(s,t):null}deleteRoomObject(s,t){return!this._roomObjectEventHandler||t!==D.WALL?!1:this._roomObjectEventHandler.deleteWallItem(this._activeRoomId,s)}get connection(){return this._communication.connection}get sessionDataManager(){return this._sessionDataManager}set sessionDataManager(s){this._sessionDataManager=s}get roomSessionManager(){return this._roomSessionManager}set roomSessionManager(s){this._roomSessionManager=s}get roomManager(){return this._roomManager}set roomManager(s){this._roomManager=s}get objectEventHandler(){return this._roomObjectEventHandler}get roomRendererFactory(){return this._roomRendererFactory}get visualizationFactory(){return this._visualizationFactory}get logicFactory(){return this._logicFactory}get activeRoomId(){return this._activeRoomId}get ready(){return this._ready}get roomContentLoader(){return this._roomContentLoader}get isDecorating(){if(!this._roomSessionManager)return!1;const s=this._roomSessionManager.getSession(this._activeRoomId);return s&&s.isDecorating||!1}get useOffsetScrolling(){return!0}get selectedAvatarId(){return this._roomObjectEventHandler?this._roomObjectEventHandler.selectedAvatarId:-1}getRoomObjectCount(s,t){return this._roomManager==null?0:this._roomManager.getRoomInstance(s.toString()).getRoomObjectsForCategory(t).length}};let Os=Ht;Os.ROOM_OBJECT_ID=-1;Os.ROOM_OBJECT_TYPE="room";Os.CURSOR_OBJECT_ID=-2;Os.CURSOR_OBJECT_TYPE="tile_cursor";Os.ARROW_OBJECT_ID=-3;Os.ARROW_OBJECT_TYPE="selection_arrow";Os.OVERLAY="overlay";Os.OBJECT_ICON_SPRITE="object_icon_sprite";Os.DRAG_THRESHOLD=15;Os.TEMPORARY_ROOM="temporary_room";const z=class{constructor(s,t=1){this._previewRoomId=1,this._currentPreviewObjectType=0,this._currentPreviewObjectCategory=0,this._currentPreviewObjectData="",this._currentPreviewRectangle=null,this._currentPreviewCanvasWidth=0,this._currentPreviewCanvasHeight=0,this._currentPreviewScale=64,this._backgroundColor=305148561,this._backgroundSprite=null,this._disableUpdate=!1,this._roomEngine=s,this._planeParser=new ae,this._previewRoomId=bf.makeRoomPreviewerId(t),this._addViewOffset=new H(0,0),this.onRoomObjectAdded=this.onRoomObjectAdded.bind(this),this.onRoomInitializedonRoomInitialized=this.onRoomInitializedonRoomInitialized.bind(this),this.isRoomEngineReady&&this._roomEngine.events&&(this._roomEngine.events.addEventListener(Q.ADDED,this.onRoomObjectAdded),this._roomEngine.events.addEventListener(Q.CONTENT_UPDATED,this.onRoomObjectAdded),this._roomEngine.events.addEventListener(Mt.INITIALIZED,this.onRoomInitializedonRoomInitialized)),this.createRoomForPreview()}dispose(){this.reset(!0),this.isRoomEngineReady&&this._roomEngine.events&&(this._roomEngine.events.removeEventListener(Q.ADDED,this.onRoomObjectAdded),this._roomEngine.events.removeEventListener(Q.CONTENT_UPDATED,this.onRoomObjectAdded),this._roomEngine.events.removeEventListener(Mt.INITIALIZED,this.onRoomInitializedonRoomInitialized)),this._backgroundSprite&&(this._backgroundSprite.destroy(),this._backgroundSprite=null),this._planeParser&&(this._planeParser.dispose(),this._planeParser=null)}createRoomForPreview(){if(this.isRoomEngineReady){const t=new ae;t.initializeTileMap(7+2,7+2);let e=1;for(;e<1+7;){let i=1;for(;i<1+7;)t.setTileHeight(i,e,0),i++;e++}t.initializeFromTileData(),this._roomEngine.createRoomInstance(this._previewRoomId,t.getMapData()),t.dispose()}}reset(s){this.isRoomEngineReady&&(this._roomEngine.removeRoomObjectFloor(this._previewRoomId,z.PREVIEW_OBJECT_ID),this._roomEngine.removeRoomObjectWall(this._previewRoomId,z.PREVIEW_OBJECT_ID),this._roomEngine.removeRoomObjectUser(this._previewRoomId,z.PREVIEW_OBJECT_ID),s||this.updatePreviewRoomView()),this._currentPreviewObjectCategory=D.MINIMUM}updatePreviewModel(s,t,e=!0){const i=new wf;i.flush(),i.parseModel(s,t,e);const r=this._roomEngine.getLegacyWallGeometry(this._previewRoomId);if(!r)return;this._planeParser.reset();const n=i.width,a=i.height;this._planeParser.initializeTileMap(n,a);const o=null;let h=-1,u=-1,c=0,l=0,_=0;for(;_<a;){let p=0;for(;p<n;){const T=i.getHeight(p,_);(_>0&&_<a-1||p>0&&p<n-1)&&T!=ae.TILE_BLOCKED&&o==null&&(i.getHeight(p,_-1)==ae.TILE_BLOCKED&&i.getHeight(p-1,_)==ae.TILE_BLOCKED&&i.getHeight(p,_+1)==ae.TILE_BLOCKED&&(h=p+.5,u=_,c=T,l=90),i.getHeight(p,_-1)==ae.TILE_BLOCKED&&i.getHeight(p-1,_)==ae.TILE_BLOCKED&&i.getHeight(p+1,_)==ae.TILE_BLOCKED&&(h=p,u=_+.5,c=T,l=180)),this._planeParser.setTileHeight(p,_,T),p++}_++}this._planeParser.setTileHeight(Math.floor(h),Math.floor(u),c),this._planeParser.initializeFromTileData(i.wallHeight),this._planeParser.setTileHeight(Math.floor(h),Math.floor(u),c+this._planeParser.wallHeight),r.scale=Za.DEFAULT_SCALE,r.initialize(n,a,this._planeParser.floorHeight);let d=i.height-1;for(;d>=0;){let p=i.width-1;for(;p>=0;)r.setHeight(p,d,this._planeParser.getTileHeight(p,d)),p--;d--}const g=this._planeParser.getMapData();g.doors.push({x:h,y:u,z:c,dir:l});const m=this.getRoomPreviewOwnRoomObject();m&&m.processUpdateMessage(new ig(g))}addFurnitureIntoRoom(s,t,e=null,i=null){if(e||(e=new _s),this.isRoomEngineReady&&(this.reset(!1),this._currentPreviewObjectType=s,this._currentPreviewObjectCategory=D.FLOOR,this._currentPreviewObjectData="",this._roomEngine.addFurnitureFloor(this._previewRoomId,z.PREVIEW_OBJECT_ID,s,new S(z.PREVIEW_OBJECT_LOCATION_X,z.PREVIEW_OBJECT_LOCATION_Y,0),t,0,e,NaN,-1,0,-1,"",!0,!1))){this._previousAutomaticStateChangeTime=_t(),this._automaticStateChange=!0;const r=this._roomEngine.getRoomObject(this._previewRoomId,z.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory);return r&&i&&r.model.setValue(I.FURNITURE_EXTRAS,i),this.updatePreviewRoomView(),z.PREVIEW_OBJECT_ID}return-1}addWallItemIntoRoom(s,t,e){if(this.isRoomEngineReady){if(this._currentPreviewObjectCategory===D.WALL&&this._currentPreviewObjectType===s&&this._currentPreviewObjectData===e)return z.PREVIEW_OBJECT_ID;if(this.reset(!1),this._currentPreviewObjectType=s,this._currentPreviewObjectCategory=D.WALL,this._currentPreviewObjectData=e,this._roomEngine.addFurnitureWall(this._previewRoomId,z.PREVIEW_OBJECT_ID,s,new S(.5,2.3,1.8),t,0,e,0,0,-1,"",!1))return this._previousAutomaticStateChangeTime=_t(),this._automaticStateChange=!0,this.updatePreviewRoomView(),z.PREVIEW_OBJECT_ID}return-1}addAvatarIntoRoom(s,t){return this.isRoomEngineReady?(this.reset(!1),this._currentPreviewObjectType=1,this._currentPreviewObjectCategory=D.UNIT,this._currentPreviewObjectData=s,this._roomEngine.addRoomObjectUser(this._previewRoomId,z.PREVIEW_OBJECT_ID,new S(z.PREVIEW_OBJECT_LOCATION_X,z.PREVIEW_OBJECT_LOCATION_Y,0),new S(90,0,0),135,ft.getTypeNumber(ft.USER),s)&&(this._previousAutomaticStateChangeTime=_t(),this._automaticStateChange=!0,this.updateUserGesture(1),this.updateUserEffect(t),this.updateUserPosture("std")),this.updatePreviewRoomView(),z.PREVIEW_OBJECT_ID):-1}addPetIntoRoom(s){return this.isRoomEngineReady?(this.reset(!1),this._currentPreviewObjectType=1,this._currentPreviewObjectCategory=D.UNIT,this._currentPreviewObjectData=s,this._roomEngine.addRoomObjectUser(this._previewRoomId,z.PREVIEW_OBJECT_ID,new S(z.PREVIEW_OBJECT_LOCATION_X,z.PREVIEW_OBJECT_LOCATION_Y,0),new S(90,0,0),90,ft.getTypeNumber(ft.PET),s)&&(this._previousAutomaticStateChangeTime=_t(),this._automaticStateChange=!1,this.updateUserGesture(1),this.updateUserPosture("std")),this.updatePreviewRoomView(),z.PREVIEW_OBJECT_ID):-1}updateUserPosture(s,t=""){this.isRoomEngineReady&&this._roomEngine.updateRoomObjectUserPosture(this._previewRoomId,z.PREVIEW_OBJECT_ID,s,t)}updateUserGesture(s){this.isRoomEngineReady&&this._roomEngine.updateRoomObjectUserGesture(this._previewRoomId,z.PREVIEW_OBJECT_ID,s)}updateUserEffect(s){this.isRoomEngineReady&&this._roomEngine.updateRoomObjectUserEffect(this._previewRoomId,z.PREVIEW_OBJECT_ID,s)}updateObjectUserFigure(s,t=null,e=null,i=!1){return this.isRoomEngineReady?this._roomEngine.updateRoomObjectUserFigure(this._previewRoomId,z.PREVIEW_OBJECT_ID,s,t,e,i):!1}updateObjectUserAction(s,t,e=null){this.isRoomEngineReady&&this._roomEngine.updateRoomObjectUserAction(this._previewRoomId,z.PREVIEW_OBJECT_ID,s,t,e)}updateObjectStuffData(s){this.isRoomEngineReady&&this._roomEngine.updateRoomObjectFloor(this._previewRoomId,z.PREVIEW_OBJECT_ID,null,null,s.state,s)}changeRoomObjectState(){this.isRoomEngineReady&&(this._automaticStateChange=!1,this._currentPreviewObjectCategory!==D.UNIT&&this._roomEngine.changeObjectState(this._previewRoomId,z.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory))}changeRoomObjectDirection(){if(this.isRoomEngineReady){const s=this._roomEngine.getRoomObject(this._previewRoomId,z.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory);if(!s)return;const t=this._roomEngine.objectEventHandler.getValidRoomObjectDirection(s,!0);switch(this._currentPreviewObjectCategory){case D.FLOOR:{const e=new S(z.PREVIEW_OBJECT_LOCATION_X,z.PREVIEW_OBJECT_LOCATION_Y),i=new S(t,t,t);this._roomEngine.updateRoomObjectFloor(this._previewRoomId,z.PREVIEW_OBJECT_ID,e,i,null,null);return}case D.WALL:return}}}checkAutomaticRoomObjectStateChange(){if(this._automaticStateChange){const s=_t();s>this._previousAutomaticStateChangeTime+z.AUTOMATIC_STATE_CHANGE_INTERVAL&&(this._previousAutomaticStateChangeTime=s,this.isRoomEngineReady&&this._roomEngine.changeObjectState(this._previewRoomId,z.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory))}}getRoomCanvas(s,t){if(this.isRoomEngineReady){const e=this._roomEngine.getRoomInstanceDisplay(this._previewRoomId,z.PREVIEW_CANVAS_ID,s,t,this._currentPreviewScale);if(e&&this._backgroundColor!==null){let r=this._backgroundSprite;r||(r=new se(ut.WHITE),e.addChildAt(r,0)),r.width=s,r.height=t,r.tint=this._backgroundColor}this._roomEngine.setRoomInstanceRenderingCanvasMask(this._previewRoomId,z.PREVIEW_CANVAS_ID,!0);const i=this._roomEngine.getRoomInstanceGeometry(this._previewRoomId,z.PREVIEW_CANVAS_ID);return i&&i.adjustLocation(new S(z.PREVIEW_OBJECT_LOCATION_X,z.PREVIEW_OBJECT_LOCATION_Y,0),30),this._currentPreviewCanvasWidth=s,this._currentPreviewCanvasHeight=t,e}return null}modifyRoomCanvas(s,t){this.isRoomEngineReady&&(this._currentPreviewCanvasWidth=s,this._currentPreviewCanvasHeight=t,this._backgroundSprite&&(this._backgroundSprite.width=s,this._backgroundSprite.height=t),this._roomEngine.initializeRoomInstanceRenderingCanvas(this._previewRoomId,z.PREVIEW_CANVAS_ID,s,t))}set addViewOffset(s){this._addViewOffset=s}get addViewOffset(){return this._addViewOffset}updatePreviewObjectBoundingRectangle(s){const t=this._roomEngine.getRoomObjectBoundingRectangle(this._previewRoomId,z.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory,z.PREVIEW_CANVAS_ID);if(t&&s)if(t.x+=-(this._currentPreviewCanvasWidth>>1),t.y+=-(this._currentPreviewCanvasHeight>>1),t.x+=-s.x,t.y+=-s.y,!this._currentPreviewRectangle)this._currentPreviewRectangle=t;else{const e=this._currentPreviewRectangle.clone().enlarge(t);(e.width-this._currentPreviewRectangle.width>this._currentPreviewCanvasWidth-this._currentPreviewRectangle.width>>1||e.height-this._currentPreviewRectangle.height>this._currentPreviewCanvasHeight-this._currentPreviewRectangle.height>>1||this._currentPreviewRectangle.width<1||this._currentPreviewRectangle.height<1)&&(this._currentPreviewRectangle=e)}}validatePreviewSize(s){if(this._currentPreviewRectangle.width<1||this._currentPreviewRectangle.height<1)return s;if(this.isRoomEngineReady){const t=this._roomEngine.getRoomInstanceGeometry(this._previewRoomId,z.PREVIEW_CANVAS_ID);this._currentPreviewRectangle.width>this._currentPreviewCanvasWidth*(1+z.ALLOWED_IMAGE_CUT)||this._currentPreviewRectangle.height>this._currentPreviewCanvasHeight*(1+z.ALLOWED_IMAGE_CUT)?z.ZOOM_ENABLED?this._roomEngine.getRoomInstanceRenderingCanvasScale(this._previewRoomId,z.PREVIEW_CANVAS_ID)!==.5&&(this._roomEngine.setRoomInstanceRenderingCanvasScale(this._previewRoomId,z.PREVIEW_CANVAS_ID,.5,null,null),this._currentPreviewScale=z.SCALE_SMALL,this._currentPreviewNeedsZoomOut=!0,s.x=s.x>>1,s.y=s.y>>1,this._currentPreviewRectangle.x=this._currentPreviewRectangle.x>>2,this._currentPreviewRectangle.y=this._currentPreviewRectangle.y>>2,this._currentPreviewRectangle.width=this._currentPreviewRectangle.width>>2,this._currentPreviewRectangle.height=this._currentPreviewRectangle.height>>2):t.isZoomedIn()&&(t.performZoomOut(),this._currentPreviewScale=z.SCALE_SMALL,this._currentPreviewNeedsZoomOut=!0):this._currentPreviewNeedsZoomOut||(z.ZOOM_ENABLED?this._roomEngine.getRoomInstanceRenderingCanvasScale(this._previewRoomId,z.PREVIEW_CANVAS_ID)!==1&&(this._roomEngine.setRoomInstanceRenderingCanvasScale(this._previewRoomId,z.PREVIEW_CANVAS_ID,1,null,null),this._currentPreviewScale=z.SCALE_NORMAL):t.isZoomedIn()||(t.performZoomIn(),this._currentPreviewScale=z.SCALE_NORMAL))}return s}zoomIn(){this.isRoomEngineReady&&(z.ZOOM_ENABLED?this._roomEngine.setRoomInstanceRenderingCanvasScale(this._previewRoomId,z.PREVIEW_CANVAS_ID,1):this._roomEngine.getRoomInstanceGeometry(this._previewRoomId,z.PREVIEW_CANVAS_ID).performZoomIn()),this._currentPreviewScale=z.SCALE_NORMAL}zoomOut(){this.isRoomEngineReady&&(z.ZOOM_ENABLED?this._roomEngine.setRoomInstanceRenderingCanvasScale(this._previewRoomId,z.PREVIEW_CANVAS_ID,.5):this._roomEngine.getRoomInstanceGeometry(this._previewRoomId,z.PREVIEW_CANVAS_ID).performZoomOut()),this._currentPreviewScale=z.SCALE_SMALL}updateAvatarDirection(s,t){this.isRoomEngineReady&&this._roomEngine.updateRoomObjectUserLocation(this._previewRoomId,z.PREVIEW_OBJECT_ID,new S(z.PREVIEW_OBJECT_LOCATION_X,z.PREVIEW_OBJECT_LOCATION_Y,0),new S(z.PREVIEW_OBJECT_LOCATION_X,z.PREVIEW_OBJECT_LOCATION_Y,0),!1,0,new S(s*45,0,0),t*45)}updateObjectRoom(s=null,t=null,e=null,i=!1){return this.isRoomEngineReady?this._roomEngine.updateRoomInstancePlaneType(this._previewRoomId,s,t,e,i):!1}updateRoomWallsAndFloorVisibility(s,t=!0){this.isRoomEngineReady&&this._roomEngine.updateRoomInstancePlaneVisibility(this._previewRoomId,s,t)}getCanvasOffset(s){if(this._currentPreviewRectangle.width<1||this._currentPreviewRectangle.height<1)return s;let t=-(this._currentPreviewRectangle.left+this._currentPreviewRectangle.right)>>1,e=-(this._currentPreviewRectangle.top+this._currentPreviewRectangle.bottom)>>1;const i=this._currentPreviewCanvasHeight-this._currentPreviewRectangle.height>>1;i>10?e=e+Math.min(15,i-10):this._currentPreviewObjectCategory!==D.UNIT?e=e+(5-Math.max(0,i/2)):e=e-(5-Math.min(0,i/2)),e=e+this._addViewOffset.y,t=t+this._addViewOffset.x;const r=t-s.x,n=e-s.y;if(r!==0||n!==0){const a=Math.sqrt(r*r+n*n);return a>10&&(t=s.x+r*10/a,e=s.y+n*10/a),new H(t,e)}return null}updatePreviewRoomView(s=!1){if(!(this._disableUpdate&&!s)&&(this.checkAutomaticRoomObjectStateChange(),this.isRoomEngineReady)){let t=this._roomEngine.getRoomInstanceRenderingCanvasOffset(this._previewRoomId,z.PREVIEW_CANVAS_ID);if(t&&(this.updatePreviewObjectBoundingRectangle(t),this._currentPreviewRectangle)){const e=this._currentPreviewScale;t=this.validatePreviewSize(t);const i=this.getCanvasOffset(t);i&&this._roomEngine.setRoomInstanceRenderingCanvasOffset(this._previewRoomId,z.PREVIEW_CANVAS_ID,i),this._currentPreviewScale!==e&&(this._currentPreviewRectangle=null)}}}set disableUpdate(s){this._disableUpdate=s}set disableRoomEngineUpdate(s){this.isRoomEngineReady&&this._roomEngine.disableUpdate(s)}onRoomInitializedonRoomInitialized(s){if(s)switch(s.type){case Mt.INITIALIZED:s.roomId===this._previewRoomId&&this.isRoomEngineReady&&this._roomEngine.updateRoomInstancePlaneType(this._previewRoomId,"110","99999");return}}onRoomObjectAdded(s){if(s.roomId===this._previewRoomId&&s.objectId===z.PREVIEW_OBJECT_ID&&s.category===this._currentPreviewObjectCategory){this._currentPreviewRectangle=null,this._currentPreviewNeedsZoomOut=!1;const t=this._roomEngine.getRoomObject(s.roomId,s.objectId,s.category);if(t&&t.model&&s.category===D.WALL){const e=t.model.getValue(I.FURNITURE_SIZE_Z),i=t.model.getValue(I.FURNITURE_CENTER_Z);(e!==null||i!==null)&&this._roomEngine.updateRoomObjectWallLocation(s.roomId,s.objectId,new S(.5,2.3,(3.6-e)/2+i))}}}updateRoomEngine(){this.isRoomEngineReady&&this._roomEngine.runUpdate()}getRenderingCanvas(){const s=this._roomEngine.getRoomInstanceRenderingCanvas(this._previewRoomId,z.PREVIEW_CANVAS_ID);return s||null}getGenericRoomObjectImage(s,t,e,i,r,n=0,a=null,o=null,h=-1,u=-1,c=null){return this.isRoomEngineReady?this._roomEngine.getGenericRoomObjectImage(s,t,e,i,r,n,a,o,h,u,c):null}getRoomObjectImage(s,t,e,i=0){return this.isRoomEngineReady?this._roomEngine.getRoomObjectImage(this._previewRoomId,z.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory,s,t,e,i):null}getRoomObjectCurrentImage(){if(this.isRoomEngineReady){const s=this._roomEngine.getRoomObject(this._previewRoomId,z.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory);if(s&&s.visualization)return s.visualization.getImage(16777215,-1)}return null}getRoomPreviewObject(){if(this.isRoomEngineReady){const s=this._roomEngine.getRoomObject(this._previewRoomId,z.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory);if(s)return s}return null}getRoomPreviewOwnRoomObject(){if(this.isRoomEngineReady){const s=this._roomEngine.getRoomObject(this._previewRoomId,Os.ROOM_OBJECT_ID,D.ROOM);if(s)return s}return null}get isRoomEngineReady(){return this._roomEngine&&this._roomEngine.ready}get roomId(){return this._previewRoomId}get backgroundColor(){return this._backgroundColor}set backgroundColor(s){this._backgroundColor=s}get width(){return this._currentPreviewCanvasWidth}get height(){return this._currentPreviewCanvasHeight}};let Ti=z;Ti.SCALE_NORMAL=64;Ti.SCALE_SMALL=32;Ti.PREVIEW_COUNTER=0;Ti.PREVIEW_CANVAS_ID=1;Ti.PREVIEW_OBJECT_ID=1;Ti.PREVIEW_OBJECT_LOCATION_X=2;Ti.PREVIEW_OBJECT_LOCATION_Y=2;Ti.ALLOWED_IMAGE_CUT=.25;Ti.AUTOMATIC_STATE_CHANGE_INTERVAL=2500;Ti.ZOOM_ENABLED=!0;class Op{constructor(t,e){this._image=t,this._placeHolder=e}get image(){return this._image}get placeHolder(){return this._placeHolder}}class oq{constructor(t){this._code=t,this._parts=[]}get code(){return this._code}get parts(){return this._parts}}const ns=class{constructor(s,t=0,e=0,i=0){this.type=s,this.key=t,this.color=e,this.position=i}get code(){return this.key===0?null:ns.getCode(this.type,this.key,this.color,this.position)}static getCode(s,t,e,i){return(s===ns.BASE?s:t>=100?ns.SYMBOL_ALT:ns.SYMBOL)+(t<10?"0":"")+(s===ns.BASE?t:t>=100?t-100:t)+(e<10?"0":"")+e+i}calculatePosition(s){const t=this.calculateGridPos(this.position);let e=ns.CELL_WIDTH*t.x+ns.CELL_WIDTH/2-s.width/2,i=ns.CELL_HEIGHT*t.y+ns.CELL_HEIGHT/2-s.height/2;return e<0&&(e=0),e+s.width>ns.IMAGE_WIDTH&&(e=ns.IMAGE_WIDTH-s.width),i<0&&(i=0),i+s.height>ns.IMAGE_HEIGHT&&(i=ns.IMAGE_HEIGHT-s.height),new zu(Math.floor(e),Math.floor(i))}calculateGridPos(s){const t=new zu;return t.x=Math.floor(s%3),t.y=Math.floor(s/3),t}};let Ns=ns;Ns.BASE="b";Ns.SYMBOL="s";Ns.SYMBOL_ALT="t";Ns.BASE_PART=0;Ns.LAYER_PART=1;Ns.IMAGE_WIDTH=39;Ns.IMAGE_HEIGHT=39;Ns.CELL_WIDTH=13;Ns.CELL_HEIGHT=13;const Di=class{constructor(s,t){this._assets=s,this._sessionDataManager=t,this._groupBases=new Map,this._groupSymbols=new Map,this._groupPartColors=new Map,this._requestedBadges=new Map,this._groupBadgesQueue=new Map,this._readyToGenerateGroupBadges=!1}init(){if(this._sessionDataManager&&this._sessionDataManager.communication){this._messages=[new NT(this.onGroupBadgePartsEvent.bind(this))];for(const s of this._messages)this._sessionDataManager.communication.registerMessageEvent(s)}}dispose(){if(this._messages&&this._messages.length){for(const s of this._messages)this._sessionDataManager.communication.removeMessageEvent(s);this._messages=null}this._sessionDataManager=null}getBadgeImage(s,t=Di.NORMAL_BADGE,e=!0){let i=this.getBadgeTexture(s,t);return!i&&e&&(i=this.getBadgePlaceholder()),i}getBadgeInfo(s){const t=this.getBadgeTexture(s);return t?new Op(t,!1):new Op(this.getBadgePlaceholder(),!0)}loadBadgeImage(s,t=Di.NORMAL_BADGE){return this._assets.getTexture(this.getBadgeUrl(s,t))?s:(this.getBadgeTexture(s,t),null)}getBadgeTexture(s,t=Di.NORMAL_BADGE){const e=this.getBadgeUrl(s,t);if(!e||!e.length)return null;const i=this._assets.getTexture(e);if(i)return i.clone();if(t===Di.NORMAL_BADGE){if(this._requestedBadges.get(s))return null;this._requestedBadges.set(s,!0),this._assets.downloadAsset(e).then(r=>{if(!r)return;this._requestedBadges.delete(s);const n=this._assets.getTexture(e);n&&this._sessionDataManager&&this._sessionDataManager.events.dispatchEvent(new Jo(s,n.clone()))}).catch(r=>{})}else if(t===Di.GROUP_BADGE){if(this._groupBadgesQueue.get(s))return;this._groupBadgesQueue.set(s,!0),this._readyToGenerateGroupBadges&&this.loadGroupBadge(s)}return null}getBadgePlaceholder(){const s=rt.getValue("images.url")+"/loading_icon.png",t=this._assets.getTexture(s);return t?t.clone():null}getBadgeUrl(s,t=Di.NORMAL_BADGE){let e=null;switch(t){case Di.NORMAL_BADGE:e=rt.getValue("badge.asset.url").replace("%badgename%",s);break;case Di.GROUP_BADGE:e=s;break}return e}loadGroupBadge(s){const t=new oq(s),e=[...s.matchAll(/[b|s][0-9]{4,6}/g)];for(const i of e){const r=i[0],n=r.length===6,a=r[0],o=parseInt(r.slice(1,n?3:4)),h=parseInt(r.slice(n?3:4,n?5:6)),u=r.length<6?0:parseInt(r.slice(n?5:6,n?6:7)),c=new Ns(a,o,h,u);t.parts.push(c)}this.renderGroupBadge(t)}renderGroupBadge(s){const t=new Hs,e=new se(wm.EMPTY);e.width=Ns.IMAGE_WIDTH,e.height=Ns.IMAGE_HEIGHT,t.addChild(e);for(const r of s.parts){let n=!0;const a=r.type==="b"?this._groupBases.get(r.key):this._groupSymbols.get(r.key);if(a)for(const o of a){if(!o||!o.length)continue;const h=this._assets.getTexture(`badgepart_${o}`);if(!h)continue;const{x:u,y:c}=r.calculatePosition(h),l=new se(h);l.position.set(u,c),n&&(l.tint=parseInt(this._groupPartColors.get(r.color),16)),n=!1,t.addChild(l)}}this._requestedBadges.delete(s.code),this._groupBadgesQueue.delete(s.code);const i=qt.generateTexture(t);this._assets.setTexture(s.code,i),this._sessionDataManager&&this._sessionDataManager.events.dispatchEvent(new Jo(s.code,i))}onGroupBadgePartsEvent(s){if(!s)return;const t=s.getParser();if(t){t.bases.forEach((e,i)=>this._groupBases.set(i,e.map(r=>r.replace(".png","").replace(".gif","")))),t.symbols.forEach((e,i)=>this._groupSymbols.set(i,e.map(r=>r.replace(".png","").replace(".gif","")))),this._groupPartColors=t.partColors,this._readyToGenerateGroupBadges=!0;for(const e of this._groupBadgesQueue.keys())this.loadGroupBadge(e)}}get disposed(){return!!this._sessionDataManager}};let Ea=Di;Ea.GROUP_BADGE="group_badge";Ea.NORMAL_BADGE="normal_badge";class Ap{constructor(t,e,i,r,n,a,o,h,u,c,l,_,d,g,m,p,T,A,O,v,y,C,N,L,P,b,w,q,ht){this._type=t,this._id=e,this._fullName=i,this._className=r,this._category=n,this._revision=h,this._tileSizeX=u,this._tileSizeY=c,this._tileSizeZ=l,this._colors=_,this._hasIndexedColor=d,this._colourIndex=g,this._localizedName=a,this._description=o,this._adUrl=m,this._purchaseOfferId=p,this._purchaseCouldBeUsedForBuyout=T,this._rentOfferId=A,this._rentCouldBeUsedForBuyout=O,this._customParams=y,this._specialType=C,this._availableForBuildersClub=v,this._canStandOn=N,this._canSitOn=L,this._canLayOn=P,this._excludedFromDynamic=b,this._furniLine=w,this._environment=q,this._rare=ht}get type(){return this._type}get id(){return this._id}get className(){return this._className}set className(t){this._className=t}get fullName(){return this._fullName}get category(){return this._category}get hasIndexedColor(){return this._hasIndexedColor}get colorIndex(){return this._colourIndex}get revision(){return this._revision}get tileSizeX(){return this._tileSizeX}get tileSizeY(){return this._tileSizeY}get tileSizeZ(){return this._tileSizeZ}get colors(){return this._colors}get name(){return this._localizedName}get description(){return this._description}get adUrl(){return this._adUrl}get purchaseOfferId(){return this._purchaseOfferId}get customParams(){return this._customParams}get specialType(){return this._specialType}get rentOfferId(){return this._rentOfferId}get purchaseCouldBeUsedForBuyout(){return this._purchaseCouldBeUsedForBuyout}get rentCouldBeUsedForBuyout(){return this._rentCouldBeUsedForBuyout}get availableForBuildersClub(){return this._availableForBuildersClub}get canStandOn(){return this._canStandOn}get canSitOn(){return this._canSitOn}get canLayOn(){return this._canLayOn}get isExternalImage(){return this._className.indexOf("external_image")!==-1}get excludeDynamic(){return this._excludedFromDynamic}get furniLine(){return this._furniLine}get environment(){return this._environment}get rare(){return this._rare}}const rf=class extends Rs{constructor(s,t,e){super(),this._floorItems=s,this._wallItems=t,this._localization=e}loadFurnitureData(s){s&&fetch(s).then(t=>t.json()).then(t=>this.onFurnitureDataLoaded(t)).catch(t=>this.onFurnitureDataError(t))}onFurnitureDataLoaded(s){s&&((typeof s.roomitemtypes>"u"||typeof s.wallitemtypes>"u")&&Y.warn("Could not find `roomitemtypes` or `wallitemtypes` in furnidata."),s.roomitemtypes&&this.parseFloorItems(s.roomitemtypes),s.wallitemtypes&&this.parseWallItems(s.wallitemtypes),this.dispatchEvent(new Rt(rf.FURNITURE_DATA_READY)))}onFurnitureDataError(s){s&&(Y.error(s),this.dispatchEvent(new Rt(rf.FURNITURE_DATA_ERROR)))}parseFloorItems(s){if(!(!s||!s.furnitype))for(const t of s.furnitype){if(!t)continue;const e=[];if(t.partcolors)for(const h of t.partcolors.color){let u=h;u.charAt(0)==="#"&&(u=u.replace("#","")),e.push(parseInt(u,16))}const i=t.classname.split("*"),r=i[0],n=i.length>1?parseInt(i[1]):0,a=i.length>1,o=new Ap(pn.FLOOR,t.id,t.classname,r,t.category,t.name,t.description,t.revision,t.xdim,t.ydim,0,e,a,n,t.adurl,t.offerid,t.buyout,t.rentofferid,t.rentbuyout,t.bc,t.customparams,t.specialtype,t.canstandon,t.cansiton,t.canlayon,t.excludeddynamic,t.furniline,t.environment,t.rare);this._floorItems.set(o.id,o),this.updateLocalizations(o)}}parseWallItems(s){if(!(!s||!s.furnitype))for(const t of s.furnitype){if(!t)continue;const e=new Ap(pn.WALL,t.id,t.classname,t.classname,t.category,t.name,t.description,t.revision,0,0,0,null,!1,0,t.adurl,t.offerid,t.buyout,t.rentofferid,t.rentbuyout,t.bc,null,t.specialtype,!1,!1,!1,t.excludeddynamic,t.furniline,t.environment,t.rare);this._wallItems.set(e.id,e),this.updateLocalizations(e)}}updateLocalizations(s){if(this._localization)switch(s.type){case pn.FLOOR:this._localization.setValue("roomItem.name."+s.id,s.name),this._localization.setValue("roomItem.desc."+s.id,s.description);return;case pn.WALL:this._localization.setValue("wallItem.name."+s.id,s.name),this._localization.setValue("wallItem.desc."+s.id,s.description);return}}};let bo=rf;bo.FURNITURE_DATA_READY="FDP_FURNITURE_DATA_READY";bo.FURNITURE_DATA_ERROR="FDP_FURNITURE_DATA_ERROR";class hq{constructor(t){this._sessionDataManager=t,this._groupBadges=new Map}init(){if(this._sessionDataManager&&this._sessionDataManager.communication){this._messages=[new Pa(this.onRoomReadyMessageEvent.bind(this)),new TR(this.onGroupBadgesEvent.bind(this))];for(const t of this._messages)this._sessionDataManager.communication.registerMessageEvent(t)}}dispose(){if(!this.disposed){if(this._messages&&this._messages.length){for(const t of this._messages)this._sessionDataManager.communication.removeMessageEvent(t);this._messages=null}this._groupBadges=null,this._sessionDataManager=null}}onRoomReadyMessageEvent(t){this._sessionDataManager.send(new JO)}onGroupBadgesEvent(t){const e=t.getParser();for(const[i,r]of e.badges.entries())this._groupBadges.set(i,r)}getGroupBadge(t){return this._groupBadges.get(t)}get disposed(){return!!this._sessionDataManager}}class fg{}fg.NO_CLUB=0;fg.CLUB=1;fg.VIP=2;class Zs extends cs{constructor(t,e){super(),this._connection=t,this._listener=e,this._roomId=0}onDispose(){this._connection=null,this._listener=null}setRoomId(t){this._roomId=t}get connection(){return this._connection}get listener(){return this._listener}get roomId(){return this._roomId}}class uq extends Zs{constructor(t,e){super(t,e),t.addMessageEvent(new id(this.onRoomGenericError.bind(this)))}onRoomGenericError(t){if(!(t instanceof id))return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);if(!i)return;let r=null;switch(e.errorCode){case Cf.KICKED_OUT_OF_ROOM:r=Zt.RSEME_KICKED;break;default:return}!r||r.length==0||this.listener.events.dispatchEvent(new Zt(r,i))}}class lq extends Zs{constructor(t,e){super(t,e),t.addMessageEvent(new HT(this.onOpenPetPackageRequested.bind(this))),t.addMessageEvent(new VT(this.onOpenPetPackageResult.bind(this)))}onOpenPetPackageRequested(t){if(!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);i&&this.listener.events.dispatchEvent(new da(da.RSOPPE_OPEN_PET_PACKAGE_REQUESTED,i,e.objectId,e.figureData,0,null))}onOpenPetPackageResult(t){if(!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);i&&this.listener.events.dispatchEvent(new da(da.RSOPPE_OPEN_PET_PACKAGE_RESULT,i,e.objectId,null,e.nameValidationStatus,e.nameValidationInfo))}}class _q extends Zs{constructor(t,e){super(t,e),t.addMessageEvent(new zT(this.onPollContentsEvent.bind(this))),t.addMessageEvent(new WT(this.onPollOfferEvent.bind(this))),t.addMessageEvent(new YT(this.onPollErrorEvent.bind(this))),t.addMessageEvent(new QT(this.onStartRoomPollEvent.bind(this))),t.addMessageEvent(new ZT(this.onRoomPollResultEvent.bind(this)))}onPollContentsEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e)return;const i=t.getParser();if(!i)return;const r=new Fi(Fi.CONTENT,e,i.id);r.startMessage=i.startMessage,r.endMessage=i.endMessage,r.numQuestions=i.numQuestions,r.questionArray=i.questionArray,r.npsPoll=i.npsPoll,this.listener.events.dispatchEvent(r)}onPollOfferEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e)return;const i=t.getParser();if(!i)return;const r=new Fi(Fi.OFFER,e,i.id);r.summary=i.headline,r.summary=i.summary,this.listener.events.dispatchEvent(r)}onPollErrorEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e||!t.getParser())return;const r=new Fi(Fi.ERROR,e,-1);r.headline="???",r.summary="???",this.listener.events.dispatchEvent(r)}onStartRoomPollEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e)return;const i=t.getParser();if(!i)return;const r=new fa(fa.VOTE_QUESTION,e,i.question,i.choices);this.listener.events.dispatchEvent(r)}onRoomPollResultEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e)return;const i=t.getParser();if(!i)return;const r=new fa(fa.VOTE_RESULT,e,i.question,i.choices,i.SafeStr_7651,i.SafeStr_7654);this.listener.events.dispatchEvent(r)}}class cq extends Zs{constructor(t,e){super(t,e),t.addMessageEvent(new Xf(this.onRoomUnitChatEvent.bind(this))),t.addMessageEvent(new $u(this.onRoomUnitChatEvent.bind(this))),t.addMessageEvent(new tl(this.onRoomUnitChatEvent.bind(this))),t.addMessageEvent(new hR(this.onRoomUnitHandItemReceivedEvent.bind(this))),t.addMessageEvent(new SR(this.onRespectReceivedEvent.bind(this))),t.addMessageEvent(new AR(this.onPetRespectNoficationEvent.bind(this))),t.addMessageEvent(new vR(this.onPetSupplementedNotificationEvent.bind(this))),t.addMessageEvent(new aR(this.onFloodControlEvent.bind(this))),t.addMessageEvent(new oR(this.onRemainingMuteEvent.bind(this)))}onRoomUnitChatEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e)return;const i=t.getParser();if(!i)return;let r=It.CHAT_TYPE_SPEAK;t instanceof $u?r=It.CHAT_TYPE_SHOUT:t instanceof tl&&(r=It.CHAT_TYPE_WHISPER);const n=new It(It.CHAT_EVENT,e,i.roomIndex,i.message,r,i.bubble);this.listener.events.dispatchEvent(n)}onRoomUnitHandItemReceivedEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e)return;const i=t.getParser();i&&this.listener.events.dispatchEvent(new It(It.CHAT_EVENT,e,i.giverUserId,"",It.CHAT_TYPE_HAND_ITEM_RECEIVED,mr.GENERIC,null,i.handItemType))}onRespectReceivedEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e)return;const i=t.getParser();if(!i)return;const r=e.userDataManager.getUserData(i.userId);r&&this.listener.events.dispatchEvent(new It(It.CHAT_EVENT,e,r.roomIndex,"",It.CHAT_TYPE_RESPECT,mr.GENERIC))}onPetRespectNoficationEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e)return;const i=t.getParser();if(!i)return;const r=e.userDataManager.getPetData(i.petData.id);if(!r)return;let n=It.CHAT_TYPE_PETRESPECT;i.isTreat&&(n=It.CHAT_TYPE_PETTREAT),this.listener.events.dispatchEvent(new It(It.CHAT_EVENT,e,r.roomIndex,"",n,mr.GENERIC))}onPetSupplementedNotificationEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e)return;const i=t.getParser();if(!i)return;const r=e.userDataManager.getPetData(i.petId);if(!r)return;let n=-1;const a=e.userDataManager.getUserData(i.userId);a&&(n=a.roomIndex);let o=It.CHAT_TYPE_PETREVIVE;switch(i.supplementType){case br.REVIVE:o=It.CHAT_TYPE_PETREVIVE;break;case br.REBREED_FERTILIZER:o=It.CHAT_TYPE_PET_REBREED_FERTILIZE;break;case br.SPEED_FERTILIZER:o=It.CHAT_TYPE_PET_SPEED_FERTILIZE;break}this.listener.events.dispatchEvent(new It(It.CHAT_EVENT,e,r.roomIndex,"",o,mr.GENERIC,null,n))}onFloodControlEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e)return;const i=t.getParser();if(!i)return;const r=i.seconds;this.listener.events.dispatchEvent(new It(It.FLOOD_EVENT,e,-1,r.toString(),0,0))}onRemainingMuteEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e)return;const i=t.getParser();i&&this.listener.events.dispatchEvent(new It(It.CHAT_EVENT,e,e.ownRoomIndex,"",It.CHAT_TYPE_MUTE_REMAINING,mr.GENERIC,null,i.seconds))}}class dq extends Zs{constructor(t,e){super(t,e),t.addMessageEvent(new nd(this.onGetGuestRoomResultEvent.bind(this)))}onGetGuestRoomResultEvent(t){if(!(t instanceof nd))return;const e=t.getParser();if(!e||e.roomForward)return;const i=this.listener.getSession(this.roomId);if(!i)return;const r=e.data;i.tradeMode=r.tradeMode,i.isGuildRoom=r.habboGroupId!==0,i.doorMode=r.doorMode,i.allowPets=r.allowPets,i.moderationSettings=e.moderation,this.listener.events.dispatchEvent(new Hc(Hc.RSDUE_ALLOW_PETS,i)),this.listener.events.dispatchEvent(new nt(nt.ROOM_DATA,i))}}class fq extends Zs{constructor(t,e){super(t,e),t.addMessageEvent(new $T(this.onRoomDimmerPresets.bind(this)))}onRoomDimmerPresets(t){if(!t)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);if(!i)return;const r=new Gc(Gc.ROOM_DIMMER_PRESETS,i);r.selectedPresetId=e.selectedPresetId;let n=0;for(;n<e.presetCount;){const a=e.getPreset(n);a&&r.storePreset(a.id,a.type,a.color,a.brightness),n++}this.listener&&this.listener.events.dispatchEvent(r)}}class gq extends Zs{constructor(t,e){super(t,e),t.addMessageEvent(new hd(this.onRoomRightsEvent.bind(this))),t.addMessageEvent(new od(this.onRoomRightsClearEvent.bind(this))),t.addMessageEvent(new ud(this.onRoomRightsOwnerEvent.bind(this)))}onRoomRightsEvent(t){if(!(t instanceof hd))return;const e=this.listener.getSession(this.roomId);e&&e.setControllerLevel(t.getParser().controllerLevel)}onRoomRightsClearEvent(t){if(!(t instanceof od))return;const e=this.listener.getSession(this.roomId);e&&e.setControllerLevel(ms.NONE)}onRoomRightsOwnerEvent(t){if(!(t instanceof ud))return;const e=this.listener.getSession(this.roomId);e&&e.setRoomOwner()}}class Eq extends Zs{constructor(t,e){super(t,e),t&&t.addMessageEvent(new xT(this.onFurnitureGiftOpenedEvent.bind(this)))}onFurnitureGiftOpenedEvent(t){if(!t)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);i&&this.listener&&this.listener.events&&this.listener.events.dispatchEvent(new Bc(Bc.RSPE_PRESENT_OPENED,i,e.classId,e.itemType,e.productCode,e.placedItemId,e.placedItemType,e.placedInRoom,e.petFigureString))}}const Ao=class extends Zs{constructor(s,t){super(s,t),s.addMessageEvent(new ld(this.onRoomEnterEvent.bind(this))),s.addMessageEvent(new Pa(this.onRoomReadyMessageEvent.bind(this))),s.addMessageEvent(new sd(this.onDesktopViewEvent.bind(this))),s.addMessageEvent(new ad(this.onRoomDoorbellAcceptedEvent.bind(this))),s.addMessageEvent(new rd(this.onRoomDoorbellRejectedEvent.bind(this))),s.addMessageEvent(new nR(this.onYouAreSpectatorMessageEvent.bind(this)))}onRoomEnterEvent(s){s instanceof ld&&this.listener&&this.listener.sessionUpdate(this.roomId,Ao.RS_CONNECTED)}onRoomReadyMessageEvent(s){if(!(s instanceof Pa))return;const t=this.roomId,e=s.getParser().roomId;this.listener&&(this.listener.sessionReinitialize(t,e),this.listener.sessionUpdate(this.roomId,Ao.RS_READY))}onDesktopViewEvent(s){s instanceof sd&&this.listener&&this.listener.sessionUpdate(this.roomId,Ao.RS_DISCONNECTED)}onRoomDoorbellAcceptedEvent(s){if(!(s instanceof ad)||!this.listener)return;const t=s.getParser();if(!t)return;const e=t.userName;if(!e||!e.length)this.connection.send(new PO(this.roomId));else if(this.listener.events){const i=this.listener.getSession(this.roomId);if(!i)return;this.listener.events.dispatchEvent(new ji(ji.RSDE_ACCEPTED,i,e))}}onRoomDoorbellRejectedEvent(s){if(!(s instanceof rd)||!this.listener)return;const t=s.getParser();if(!t)return;const e=t.userName;if(!e||!e.length)this.listener.sessionUpdate(this.roomId,Ao.RS_DISCONNECTED);else if(this.listener.events){const i=this.listener.getSession(this.roomId);if(!i)return;this.listener.events.dispatchEvent(new ji(ji.RSDE_REJECTED,i,e))}}onYouAreSpectatorMessageEvent(s){if(this.listener){const t=this.listener.getSession(this.roomId);if(!t)return;t.isSpectator=!0,this.listener.events.dispatchEvent(new Vc(Vc.SPECTATOR_MODE,t))}}};let Rn=Ao;Rn.RS_CONNECTED="RS_CONNECTED";Rn.RS_READY="RS_READY";Rn.RS_DISCONNECTED="RS_DISCONNECTED";class pq{constructor(){this._adultLevel=7}get id(){return this._id}set id(t){this._id=t}get level(){return this._level}set level(t){this._level=t}get maximumLevel(){return this._maximumLevel}set maximumLevel(t){this._maximumLevel=t}get experience(){return this._experience}set experience(t){this._experience=t}get levelExperienceGoal(){return this._levelExperienceGoal}set levelExperienceGoal(t){this._levelExperienceGoal=t}get energy(){return this._energy}set energy(t){this._energy=t}get maximumEnergy(){return this._maximumEnergy}set maximumEnergy(t){this._maximumEnergy=t}get happyness(){return this._happyness}set happyness(t){this._happyness=t}get maximumHappyness(){return this._maximumHappyness}set maximumHappyness(t){this._maximumHappyness=t}get ownerId(){return this._ownerId}set ownerId(t){this._ownerId=t}get ownerName(){return this._ownerName}set ownerName(t){this._ownerName=t}get respect(){return this._respect}set respect(t){this._respect=t}get age(){return this._age}set age(t){this._age=t}get unknownRarity(){return this._unknownRarity}set unknownRarity(t){this._unknownRarity=t}get saddle(){return this._saddle}set saddle(t){this._saddle=t}get rider(){return this._rider}set rider(t){this._rider=t}get skillTresholds(){return this._skillThresholds}set skillTresholds(t){this._skillThresholds=t}get publiclyRideable(){return this._publiclyRideable}set publiclyRideable(t){this._publiclyRideable=t}get breedable(){return this._breedable}set breedable(t){this._breedable=t}get fullyGrown(){return this._fullyGrown}set fullyGrown(t){this._fullyGrown=t}get dead(){return this._dead}set dead(t){this._dead=t}get rarityLevel(){return this._rarityLevel}set rarityLevel(t){this._rarityLevel=t}get maximumTimeToLive(){return this._maximumTimeToLive}set maximumTimeToLive(t){this._maximumTimeToLive=t}get remainingTimeToLive(){return this._remainingTimeToLive}set remainingTimeToLive(t){this._remainingTimeToLive=t}get remainingGrowTime(){return this._remainingGrowTime}set remainingGrowTime(t){this._remainingGrowTime=t}get publiclyBreedable(){return this._publiclyBreedable}set publiclyBreedable(t){this._publiclyBreedable=t}get adultLevel(){return this._adultLevel}}class mq{constructor(t){this._roomIndex=-1,this._name="",this._type=0,this._sex="",this._figure="",this._custom="",this._webID=0,this._groupID=0,this._groupStatus=0,this._groupName="",this._ownerId=0,this._ownerName="",this._petLevel=0,this._rarityLevel=0,this._roomIndex=t}get roomIndex(){return this._roomIndex}get activityPoints(){return this._activityPoints}set activityPoints(t){this._activityPoints=t}get name(){return this._name}set name(t){this._name=t}get type(){return this._type}set type(t){this._type=t}get sex(){return this._sex}set sex(t){this._sex=t}get figure(){return this._figure}set figure(t){this._figure=t}get custom(){return this._custom}set custom(t){this._custom=t}get webID(){return this._webID}set webID(t){this._webID=t}get groupId(){return this._groupID}set groupId(t){this._groupID=t}get groupName(){return this._groupName}set groupName(t){this._groupName=t}get groupStatus(){return this._groupStatus}set groupStatus(t){this._groupStatus=t}get ownerId(){return this._ownerId}set ownerId(t){this._ownerId=t}get ownerName(){return this._ownerName}set ownerName(t){this._ownerName=t}get rarityLevel(){return this._rarityLevel}set rarityLevel(t){this._rarityLevel=t}get hasSaddle(){return this._hasSaddle}set hasSaddle(t){this._hasSaddle=t}get isRiding(){return this._isRiding}set isRiding(t){this._isRiding=t}get canBreed(){return this._canBreed}set canBreed(t){this._canBreed=t}get canHarvest(){return this._canHarvest}set canHarvest(t){this._canHarvest=t}get canRevive(){return this._canRevive}set canRevive(t){this._canRevive=t}get hasBreedingPermission(){return this._hasBreedingPermission}set hasBreedingPermission(t){this._hasBreedingPermission=t}get petLevel(){return this._petLevel}set petLevel(t){this._petLevel=t}get botSkills(){return this._botSkills}set botSkills(t){this._botSkills=t}get isModerator(){return this._isModerator}set isModerator(t){this._isModerator=t}}class Iq extends Zs{constructor(t,e){super(t,e),t.addMessageEvent(new sl(this.onRoomUnitEvent.bind(this))),t.addMessageEvent(new il(this.onRoomUnitInfoEvent.bind(this))),t.addMessageEvent(new rl(this.onRoomUnitRemoveEvent.bind(this))),t.addMessageEvent(new el(this.onRoomUnitDanceEvent.bind(this))),t.addMessageEvent(new pR(this.onUserCurrentBadgesEvent.bind(this))),t.addMessageEvent(new wT(this.onRoomDoorbellEvent.bind(this))),t.addMessageEvent(new qf(this.onUserNameChangeMessageEvent.bind(this))),t.addMessageEvent(new CT(this.onNewFriendRequestEvent.bind(this))),t.addMessageEvent(new sR(this.onPetInfoEvent.bind(this))),t.addMessageEvent(new iR(this.onPetStatusUpdateEvent.bind(this))),t.addMessageEvent(new az(this.onPetBreedingMessageEvent.bind(this))),t.addMessageEvent(new kT(this.onPetLevelUpdateMessageEvent.bind(this))),t.addMessageEvent(new Oj(this.onConfirmBreedingResultEvent.bind(this))),t.addMessageEvent(new Aj(this.onNestBreedingSuccessEvent.bind(this))),t.addMessageEvent(new Rj(this.onConfirmBreedingRequestEvent.bind(this))),t.addMessageEvent(new Ju(this.onPetFigureUpdateEvent.bind(this))),t.addMessageEvent(new tR(this.onPetBreedingResultEvent.bind(this))),t.addMessageEvent(new BT(this.onPetPlacingError.bind(this))),t.addMessageEvent(new GT(this.onBotError.bind(this))),t.addMessageEvent(new JT(this.onFavoriteMembershipUpdateMessageEvent.bind(this)))}onRoomUnitEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e)return;const i=t.getParser().users,r=[];if(i&&i.length)for(const n of i){if(!n)continue;const a=new mq(n.roomIndex);a.name=n.name,a.custom=n.custom,a.activityPoints=n.activityPoints,a.figure=n.figure,a.type=n.userType,a.webID=n.webID,a.groupId=n.groupID,a.groupName=n.groupName,a.groupStatus=n.groupStatus,a.sex=n.sex,a.ownerId=n.ownerId,a.ownerName=n.ownerName,a.rarityLevel=n.rarityLevel,a.hasSaddle=n.hasSaddle,a.isRiding=n.isRiding,a.canBreed=n.canBreed,a.canHarvest=n.canHarvest,a.canRevive=n.canRevive,a.hasBreedingPermission=n.hasBreedingPermission,a.petLevel=n.petLevel,a.botSkills=n.botSkills,a.isModerator=n.isModerator,e.userDataManager.getUserData(n.roomIndex)||r.push(a),e.userDataManager.updateUserData(a)}this.listener.events.dispatchEvent(new GI(e,r))}onRoomUnitInfoEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e)return;const i=t.getParser();i&&(e.userDataManager.updateFigure(i.unitId,i.figure,i.gender,!1,!1),e.userDataManager.updateMotto(i.unitId,i.motto),e.userDataManager.updateAchievementScore(i.unitId,i.achievementScore),this.listener.events.dispatchEvent(new HI(e,i.unitId,i.figure,i.gender,i.motto,i.achievementScore)))}onRoomUnitRemoveEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);e&&e.userDataManager.removeUserData(t.getParser().unitId)}onRoomUnitDanceEvent(t){if(!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);i&&this.listener.events.dispatchEvent(new fI(i,e.unitId,e.danceId))}onUserCurrentBadgesEvent(t){if(!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);i&&(i.userDataManager.setUserBadges(e.userId,e.badges),this.listener.events.dispatchEvent(new FI(i,e.userId,e.badges)))}onRoomDoorbellEvent(t){if(!this.listener)return;const e=t.getParser();if(!e)return;const i=e.userName;if(!i||!i.length)return;const r=this.listener.getSession(this.roomId);r&&this.listener.events.dispatchEvent(new ji(ji.DOORBELL,r,i))}onUserNameChangeMessageEvent(t){if(!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);i&&i.userDataManager.updateName(e.id,e.newName)}onNewFriendRequestEvent(t){if(!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);if(!i)return;const r=e.request;this.listener.events.dispatchEvent(new mI(i,r.requestId,r.requesterUserId,r.requesterName))}onPetInfoEvent(t){if(!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);if(!i)return;const r=new pq;r.id=e.id,r.level=e.level,r.maximumLevel=e.maximumLevel,r.experience=e.experience,r.levelExperienceGoal=e.levelExperienceGoal,r.energy=e.energy,r.maximumEnergy=e.maximumEnergy,r.happyness=e.happyness,r.maximumHappyness=e.maximumHappyness,r.ownerId=e.ownerId,r.ownerName=e.ownerName,r.respect=e.respect,r.age=e.age,r.unknownRarity=e.unknownRarity,r.saddle=e.saddle,r.rider=e.rider,r.breedable=e.breedable,r.fullyGrown=e.fullyGrown,r.rarityLevel=e.rarityLevel,r.dead=e.dead,r.skillTresholds=e.skillTresholds,r.publiclyRideable=e.publiclyRideable,r.maximumTimeToLive=e.maximumTimeToLive,r.remainingTimeToLive=e.remainingTimeToLive,r.remainingGrowTime=e.remainingGrowTime,r.publiclyBreedable=e.publiclyBreedable,this.listener.events.dispatchEvent(new NI(i,r))}onPetStatusUpdateEvent(t){if(!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);i&&(i.userDataManager.updatePetBreedingStatus(e.roomIndex,e.canBreed,e.canHarvest,e.canRevive,e.hasBreedingPermission),this.listener.events.dispatchEvent(new LI(i,e.petId,e.canBreed,e.canHarvest,e.canRevive,e.hasBreedingPermission)))}onPetBreedingMessageEvent(t){if(!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);i&&this.listener.events.dispatchEvent(new OI(i,e.state,e.ownPetId,e.otherPetId))}onPetLevelUpdateMessageEvent(t){if(!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);i&&(i.userDataManager.updatePetLevel(e.roomIndex,e.level),this.listener.events.dispatchEvent(new bI(i,e.petId,e.level)))}onConfirmBreedingResultEvent(t){if(!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);i&&this.listener.events.dispatchEvent(new cI(i,e.breedingNestStuffId,e.result))}onNestBreedingSuccessEvent(t){if(!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);i&&this.listener.events.dispatchEvent(new TI(i,e.petId,e.rarityCategory))}onConfirmBreedingRequestEvent(t){if(!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);i&&this.listener.events.dispatchEvent(new lI(i,e.nestId,e.pet1,e.pet2,e.rarityCategories,e.resultPetType))}onPetFigureUpdateEvent(t){if(!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);if(!i)return;const r=e.figureData.figuredata;i.userDataManager.updateFigure(e.roomIndex,r,"",e.hasSaddle,e.isRiding),this.listener.events.dispatchEvent(new CI(i,e.petId,r))}onPetBreedingResultEvent(t){if(!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);i&&this.listener.events.dispatchEvent(new vI(i,e.resultData,e.otherResultData))}onPetPlacingError(t){if(!t||!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);if(!i)return;let r=null;switch(e.errorCode){case 0:r=Zt.RSEME_PETS_FORBIDDEN_IN_HOTEL;break;case 1:r=Zt.RSEME_PETS_FORBIDDEN_IN_FLAT;break;case 2:r=Zt.RSEME_MAX_PETS;break;case 3:r=Zt.RSEME_NO_FREE_TILES_FOR_PET;break;case 4:r=Zt.RSEME_SELECTED_TILE_NOT_FREE_FOR_PET;break;case 5:r=Zt.RSEME_MAX_NUMBER_OF_OWN_PETS;break}!r||r.length==0||this.listener.events.dispatchEvent(new Zt(r,i))}onBotError(t){if(!t||!this.listener)return;const e=t.getParser();if(!e)return;const i=this.listener.getSession(this.roomId);if(!i)return;let r=null;switch(e.errorCode){case 0:r=Zt.RSEME_BOTS_FORBIDDEN_IN_HOTEL;break;case 1:r=Zt.RSEME_BOTS_FORBIDDEN_IN_FLAT;break;case 2:r=Zt.RSEME_BOT_LIMIT_REACHED;break;case 3:r=Zt.RSEME_SELECTED_TILE_NOT_FREE_FOR_BOT;break;case 4:r=Zt.RSEME_BOT_NAME_NOT_ACCEPTED;break}!r||r.length==0||this.listener.events.dispatchEvent(new Zt(r,i))}onFavoriteMembershipUpdateMessageEvent(t){if(!this.listener)return;const e=t.getParser(),i=this.listener.getSession(this.roomId);if(!i)return;const r=i.userDataManager.getUserDataByIndex(e.roomIndex);r&&(r.groupId=e.groupId,r.groupName=e.groupName,this.listener.events.dispatchEvent(new EI(i,e.roomIndex,e.groupId,e.status,e.groupName)))}}class Tq extends Zs{constructor(t,e){super(t,e),t.addMessageEvent(new KT(this.onQuestionEvent.bind(this))),t.addMessageEvent(new XT(this.onQuestionAnsweredEvent.bind(this))),t.addMessageEvent(new qT(this.onQuestionFinishedEvent.bind(this)))}onQuestionEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e)return;const i=t.getParser();if(!i)return;const r=new wi(wi.QUESTION,e,i.pollId);r.question=i.question,r.duration=i.duration,r.pollType=i.pollType,r.questionId=i.questionId,r.pollId=i.pollId,this.listener.events.dispatchEvent(r)}onQuestionAnsweredEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e)return;const i=t.getParser();if(!i)return;const r=new wi(wi.ANSWERED,e,i.userId);r.value=i.value,r.userId=i.userId,r.answerCounts=i.answerCounts,this.listener.events.dispatchEvent(r)}onQuestionFinishedEvent(t){if(!this.listener)return;const e=this.listener.getSession(this.roomId);if(!e)return;const i=t.getParser();if(!i)return;const r=new wi(wi.FINISHED,e);r.questionId=i.questionId,r.answerCounts=i.answerCounts,this.listener.events.dispatchEvent(r)}}class Rq{constructor(t){this._sessionDataManager=t,this._ignoredUsers=[]}init(){if(this._sessionDataManager&&this._sessionDataManager.communication){this._messages=[new RR(this.onIgnoredUsersEvent.bind(this)),new Zf(this.onIgnoreResultEvent.bind(this))];for(const t of this._messages)this._sessionDataManager.communication.registerMessageEvent(t)}}dispose(){if(!this.disposed){if(this._messages&&this._messages.length){for(const t of this._messages)this._sessionDataManager.communication.removeMessageEvent(t);this._messages=null}this._sessionDataManager=null}}requestIgnoredUsers(){this._sessionDataManager.send(new YO(this._sessionDataManager.userName))}onIgnoredUsersEvent(t){if(!t)return;const e=t.getParser();e&&(this._ignoredUsers=e.ignoredUsers)}onIgnoreResultEvent(t){if(!t)return;const e=t.getParser();if(!e)return;const i=e.name;switch(e.result){case 0:return;case 1:this.addUserToIgnoreList(i);return;case 2:this.addUserToIgnoreList(i),this._ignoredUsers.shift();return;case 3:this.removeUserFromIgnoreList(i);return}}addUserToIgnoreList(t){this._ignoredUsers.indexOf(t)<0&&this._ignoredUsers.push(t)}removeUserFromIgnoreList(t){const e=this._ignoredUsers.indexOf(t);e>=0&&this._ignoredUsers.splice(e,1)}ignoreUserId(t){this._sessionDataManager.send(new KO(t))}ignoreUser(t){this._sessionDataManager.send(new XO(t))}unignoreUser(t){this._sessionDataManager.send(new qO(t))}isIgnored(t){return this._ignoredUsers.indexOf(t)>=0}get disposed(){return!!this._sessionDataManager}}class Oq{constructor(t,e,i){this._type=t,this._name=e,this._description=i}get type(){return this._type}get name(){return this._name}get description(){return this._description}}const nf=class extends Rs{constructor(s){super(),this._products=s}dispose(){this._products=null}loadProductData(s){s&&fetch(s).then(t=>t.json()).then(t=>this.onProductDataLoadedEvent(t)).catch(t=>this.onProductDataError(t))}onProductDataLoadedEvent(s){s&&(this.parseProducts(s.productdata),this.dispatchEvent(new Rt(nf.PDP_PRODUCT_DATA_READY)))}onProductDataError(s){s&&this.dispatchEvent(new Rt(nf.PDP_PRODUCT_DATA_FAILED))}parseProducts(s){if(s)for(const t of s.product)t&&this._products.set(t.code,new Oq(t.code,t.name,t.description))}};let Do=nf;Do.PDP_PRODUCT_DATA_READY="PDP_PRODUCT_DATA_READY";Do.PDP_PRODUCT_DATA_FAILED="PDP_PRODUCT_DATA_FAILED";const vo=class extends cs{constructor(){super(),this._connection=null,this._userDataByType=new Map,this._userDataByRoomIndex=new Map,this._userBadges=new Map}onDispose(){this._connection=null}setConnection(s){this._connection=s}getUserData(s){return this.getDataByType(s,vo.TYPE_USER)}getPetData(s){return this.getDataByType(s,vo.TYPE_PET)}getBotData(s){return this.getDataByType(s,vo.TYPE_BOT)}getRentableBotData(s){return this.getDataByType(s,vo.TYPE_RENTABLE_BOT)}getDataByType(s,t){const e=this._userDataByType.get(t);if(!e)return null;const i=e.get(s);return i||null}getUserDataByIndex(s){const t=this._userDataByRoomIndex.get(s);return t||null}getUserDataByName(s){for(const t of this._userDataByRoomIndex.values())if(!(!t||t.name!==s))return t;return null}updateUserData(s){if(!s)return;this.removeUserData(s.roomIndex);let t=this._userDataByType.get(s.type);t||(t=new Map,this._userDataByType.set(s.type,t)),t.set(s.webID,s),this._userDataByRoomIndex.set(s.roomIndex,s)}removeUserData(s){const t=this.getUserDataByIndex(s);if(!t)return;this._userDataByRoomIndex.delete(s);const e=this._userDataByType.get(t.type);e&&e.delete(t.webID)}getUserBadges(s){this._connection&&this._connection.send(new ZO(s));const t=this._userBadges.get(s);return t||[]}setUserBadges(s,t){this._userBadges.set(s,t)}updateFigure(s,t,e,i,r){const n=this.getUserDataByIndex(s);n&&(n.figure=t,n.sex=e,n.hasSaddle=i,n.isRiding=r)}updateName(s,t){const e=this.getUserDataByIndex(s);e&&(e.name=t)}updateMotto(s,t){const e=this.getUserDataByIndex(s);e&&(e.custom=t)}updateAchievementScore(s,t){const e=this.getUserDataByIndex(s);e&&(e.activityPoints=t)}updatePetLevel(s,t){const e=this.getUserDataByIndex(s);e&&(e.petLevel=t)}updatePetBreedingStatus(s,t,e,i,r){const n=this.getUserDataByIndex(s);n&&(n.canBreed=t,n.canHarvest=e,n.canRevive=i,n.hasBreedingPermission=r)}requestPetInfo(s){!this._connection||!this.getPetData(s)||this._connection.send(new GR(s))}get connection(){return this._connection}};let wh=vo;wh.TYPE_USER=1;wh.TYPE_PET=2;wh.TYPE_BOT=3;wh.TYPE_RENTABLE_BOT=4;class Aq extends cs{constructor(){super(),this._connection=null,this._userData=new wh,this._roomId=0,this._password=null,this._state=nt.CREATED,this._tradeMode=Ml.NO_TRADING,this._doorMode=0,this._controllerLevel=ms.NONE,this._ownRoomIndex=-1,this._isGuildRoom=!1,this._isRoomOwner=!1,this._isDecorating=!1,this._isSpectator=!1,this._moderationSettings=null}onDispose(){this._userData&&(this._userData.dispose(),this._userData=null),this._connection=null}setConnection(t){this._connection||!t||(this._connection=t,this._userData&&this._userData.setConnection(t))}setControllerLevel(t){if(t>=ms.NONE&&t<=ms.MODERATOR){this._controllerLevel=t;return}this._controllerLevel=ms.NONE}setOwnRoomIndex(t){this._ownRoomIndex=t}setRoomOwner(){this._isRoomOwner=!0}start(){return this._state!==nt.CREATED||!this._connection?!1:(this._state=nt.STARTED,this.enterRoom())}enterRoom(){return this._connection?(this._connection.send(new XR(this._roomId,this._password)),!0):!1}reset(t){t!==this._roomId&&(this._roomId=t)}sendChatMessage(t,e){this._connection.send(new Jf(t,e))}sendShoutMessage(t,e){this._connection.send(new bO(t,e))}sendWhisperMessage(t,e,i){this._connection.send(new DO(t,e,i))}sendChatTypingMessage(t){t?this._connection.send(new LO):this._connection.send(new UO)}sendMottoMessage(t){this._connection.send(new QO(t))}sendDanceMessage(t){this._connection.send(new FO(t))}sendExpressionMessage(t){this._connection.send(new xO(t))}sendSignMessage(t){t<0||t>17||this._connection.send(new BO(t))}sendPostureMessage(t){this._connection.send(new GO(t))}sendDoorbellApprovalMessage(t,e){this._connection.send(new WR(t,e))}sendAmbassadorAlertMessage(t){this._connection.send(new KR(t))}sendKickMessage(t){this._connection.send(new QR(t))}sendMuteMessage(t,e){this._connection.send(new JR(t,e,this._roomId))}sendBanMessage(t,e){this._connection.send(new qR(t,this._roomId,e))}sendGiveRightsMessage(t){this._connection.send(new ZR(t))}sendTakeRightsMessage(t){this._connection.send(new $R(t))}sendPollStartMessage(t){this._connection.send(new zR(t))}sendPollRejectMessage(t){this._connection.send(new jR(t))}sendPollAnswerMessage(t,e,i){this._connection.send(new kR(t,e,i))}sendPeerUsersClassificationMessage(t){this._connection.send(new tA(t))}sendOpenPetPackageMessage(t,e){this._connection.send(new yO(t,e))}sendRoomUsersClassificationMessage(t){this._connection.send(new eA(t))}updateMoodlightData(t,e,i,r,n){let a="000000"+i.toString(16).toUpperCase();a="#"+a.substring(a.length-6),this.connection.send(new dO(t,e,a,r,n))}toggleMoodlightState(){this.connection.send(new fO)}pickupPet(t){this._connection&&this._connection.send(new oO(t))}pickupBot(t){this._connection&&this._connection.send(new eO(t))}requestMoodlightSettings(){this._connection&&this._connection.send(new cO)}openGift(t){this._connection.send(new CO(t))}mountPet(t){this._connection.send(new Hd(t,!0))}dismountPet(t){this._connection.send(new Hd(t,!1))}usePetProduct(t,e){this._connection.send(new VR(t,e))}removePetSaddle(t){this._connection.send(new wR(t))}togglePetBreeding(t){this._connection.send(new BR(t))}togglePetRiding(t){this._connection.send(new HR(t))}useMultistateItem(t){this._connection.send(new Qf(t))}harvestPet(t){this._connection.send(new nO(t))}compostPlant(t){this._connection.send(new iO(t))}requestPetCommands(t){this._connection.send(new xR(t))}sendScriptProceed(){this._connection.send(new UR)}sendUpdateClothingChangeFurniture(t,e,i){this._connection.send(new uO(t,e,i))}changeQueue(t){this._connection.send(new NO(t))}votePoll(t){this._connection.send(new YR(t))}get connection(){return this._connection}get userDataManager(){return this._userData}get roomId(){return this._roomId}set roomId(t){this._roomId=t}get password(){return this._password}set password(t){this._password=t}get state(){return this._state}get isPrivateRoom(){return!0}get tradeMode(){return this._tradeMode}set tradeMode(t){this._tradeMode=t}get doorMode(){return this._doorMode}set doorMode(t){this._doorMode=t}get allowPets(){return this._allowPets}set allowPets(t){this._allowPets=t}get controllerLevel(){return this._controllerLevel}get ownRoomIndex(){return this._ownRoomIndex}get isGuildRoom(){return this._isGuildRoom}set isGuildRoom(t){this._isGuildRoom=t}get isRoomOwner(){return this._isRoomOwner}get isDecorating(){return this._isDecorating}set isDecorating(t){this._isDecorating=t}get isSpectator(){return this._isSpectator}set isSpectator(t){this._isSpectator=t}get moderationSettings(){return this._moderationSettings}set moderationSettings(t){this._moderationSettings=t}}class vq extends mi{constructor(t,e){super(),this._communication=t,this._roomEngine=e,this._handlers=[],this._sessions=new Map,this._pendingSession=null,this._sessionStarting=!1,this._viewerSession=null,this.onRoomEngineEvent=this.onRoomEngineEvent.bind(this)}onInit(){this.createHandlers(),this.processPendingSession(),this._roomEngine.events.addEventListener(Mt.ENGINE_INITIALIZED,this.onRoomEngineEvent)}onDispose(){this._roomEngine.events.removeEventListener(Mt.ENGINE_INITIALIZED,this.onRoomEngineEvent),super.onDispose()}createHandlers(){const t=this._communication&&this._communication.connection;t&&this._handlers.push(new cq(t,this),new dq(t,this),new fq(t,this),new gq(t,this),new Rn(t,this),new Iq(t,this),new Eq(t,this),new uq(t,this),new Tq(t,this),new _q(t,this),new lq(t,this))}setHandlers(t){if(!(!this._handlers||!this._handlers.length))for(const e of this._handlers)e&&e.setRoomId(t.roomId)}onRoomEngineEvent(t){this.processPendingSession()}processPendingSession(){!this._pendingSession||!this._roomEngine.ready||(this.addSession(this._pendingSession),this._pendingSession=null)}getSession(t){const e=this._sessions.get(this.getRoomId(t));return e||null}createSession(t,e=null){const i=new Aq;return i.roomId=t,i.password=e,this.addSession(i)}addSession(t){return this._roomEngine.ready?(this._sessionStarting=!0,this._sessions.get(this.getRoomId(t.roomId))&&this.removeSession(t.roomId,!1),t.setConnection(this._communication.connection),this._sessions.set(this.getRoomId(t.roomId),t),this.events.dispatchEvent(new nt(nt.CREATED,t)),this._viewerSession=t,this.startSession(this._viewerSession),!0):(this._pendingSession=t,!1)}startSession(t){return t.state===nt.STARTED?!1:(this._sessionStarting=!1,t.start()?(this.events.dispatchEvent(new nt(nt.STARTED,t)),this.setHandlers(t),!0):(this.removeSession(t.roomId),!1))}removeSession(t,e=!0){const i=this.getSession(t);i&&(this._sessions.delete(this.getRoomId(t)),this.events.dispatchEvent(new nt(nt.ENDED,i,e)),i.dispose())}sessionUpdate(t,e){if(this.getSession(t))switch(e){case Rn.RS_CONNECTED:return;case Rn.RS_READY:return;case Rn.RS_DISCONNECTED:this.removeSession(t);return}}sessionReinitialize(t,e){const i=this.getSession(t);i&&(this._sessions.delete(this.getRoomId(t)),i.reset(e),this._sessions.set(this.getRoomId(e),i),this.setHandlers(i))}getRoomId(t){return"hard_coded_room_id"}get communication(){return this._communication}get roomEngine(){return this._roomEngine}get viewerSession(){return this._viewerSession}}const hv=class{static logEventLog(s){try{mt.available&&mt.call("logEventLog",s)}catch{Y.log("External interface not working, failed to log event log.")}}static openPage(s){try{mt.available&&mt.call("openPage",s)}catch{Y.log("Failed to open web page",s)}}static openWebPage(s){window.open(s)}static sendHeartBeat(){try{mt.available&&mt.call("heartBeat")}catch{Y.log("Failed to send heartbeat")}}static openWebPageAndMinimizeClient(s){try{mt.available&&hv.openPage(s)}catch{Y.log("Failed to open web page",s)}}static closeWebPageAndRestoreClient(){try{mt.available&&mt.call("closeWebPageAndRestoreClient")}catch{Y.log("Failed to close web page and restore client!")}}static openHabblet(s,t=null){try{mt.available&&mt.call("openHabblet",s,t)}catch{Y.log("Failed to open Habblet",s)}}static closeHabblet(s,t=null){try{mt.available&&mt.call("closeHabblet",s,t)}catch{Y.log("Failed to close Habblet",s)}}static send(s,t){try{mt.available&&mt.call("disconnect",s,t)}catch{Y.log("Failed to close send ")}}static showGame(s){try{mt.available&&mt.callGame("showGame",s)}catch(t){Y.log("Failed to open game",t)}}static hideGame(){try{mt.available&&mt.callGame("hideGame")}catch{Y.log("Failed to hide game")}}static open(s){try{mt.available&&mt.call("openExternalLink",escape(s))}catch{Y.log("External interface not working. Could not request to open: "+s)}}static roomVisited(s){try{mt.available&&mt.call("roomVisited",s)}catch{Y.log("External interface not working. Could not store last room visit.")}}static openMinimail(s){try{mt.available&&mt.call("openMinimail",s)}catch{Y.log("External interface not working. Could not open minimail.")}}static openNews(){try{mt.available&&mt.call("openNews")}catch{Y.log("External interface not working. Could not open news.")}}static closeNews(){try{mt.available&&mt.call("closeNews")}catch{Y.log("External interface not working. Could not close news.")}}static openAvatars(){try{mt.available&&mt.call("openAvatars")}catch{Y.log("External interface not working. Could not open avatars.")}}static openRoomEnterAd(){try{mt.available&&mt.call("openRoomEnterAd")}catch{Y.log("External interface not working. Could not open roomenterad.")}}static updateFigure(s){try{mt.available&&mt.call("updateFigure",s)}catch{Y.log("External interface not working. Could not update figure.")}}};let Ln=hv;Ln.ADVERTISEMENT="advertisement";Ln.OPENLINK="openlink";Ln.OPENROOM="openroom";class Sq extends mi{constructor(t){super(),this._communication=t,this.resetUserInfo(),this._ignoredUsersManager=new Rq(this),this._groupInformationManager=new hq(this),this._clubLevel=0,this._securityLevel=0,this._isAmbassador=!1,this._noobnessLevel=-1,this._isEmailVerified=!1,this._systemOpen=!1,this._systemShutdown=!1,this._isAuthenticHabbo=!1,this._isRoomCameraFollowDisabled=!1,this._uiFlags=0,this._floorItems=new Map,this._wallItems=new Map,this._products=new Map,this._furnitureData=null,this._furnitureReady=!1,this._productsReady=!1,this._furnitureListenersNotified=!1,this._pendingFurnitureListeners=[],this._pendingProductListeners=[],this._tags=[],this._badgeImageManager=null,this.onFurnitureDataReadyEvent=this.onFurnitureDataReadyEvent.bind(this),this.onProductDataReadyEvent=this.onProductDataReadyEvent.bind(this),this.onNitroSettingsEvent=this.onNitroSettingsEvent.bind(this)}onInit(){this.loadFurnitureData(),this.loadProductData(),this.loadBadgeImageManager(),this._ignoredUsersManager&&this._ignoredUsersManager.init(),this._groupInformationManager&&this._groupInformationManager.init(),this._communication.registerMessageEvent(new ST(this.onUserFigureEvent.bind(this))),this._communication.registerMessageEvent(new nl(this.onUserInfoEvent.bind(this))),this._communication.registerMessageEvent(new gR(this.onUserPermissionsEvent.bind(this))),this._communication.registerMessageEvent(new vT(this.onAvailabilityStatusMessageEvent.bind(this))),this._communication.registerMessageEvent(new jT(this.onPetRespectFailed.bind(this))),this._communication.registerMessageEvent(new zs(this.onChangeNameUpdateEvent.bind(this))),this._communication.registerMessageEvent(new qf(this.onUserNameChangeMessageEvent.bind(this))),this._communication.registerMessageEvent(new mR(this.onUserTags.bind(this))),this._communication.registerMessageEvent(new Pa(this.onRoomModelNameEvent.bind(this))),this._communication.registerMessageEvent(new OR(this.onInClientLinkEvent.bind(this))),this._communication.registerMessageEvent(new FT(this.onMysteryBoxKeysEvent.bind(this))),this._communication.registerMessageEvent(new PT(this.onNoobnessLevelMessageEvent.bind(this))),this._communication.registerMessageEvent(new ER(this.onAccountSafetyLockStatusChangeMessageEvent.bind(this))),this._communication.registerMessageEvent(new IR(this.onEmailStatus.bind(this))),K.instance.events.addEventListener(Ra.SETTINGS_UPDATED,this.onNitroSettingsEvent)}onDispose(){this.destroyFurnitureData(),this._ignoredUsersManager&&(this._ignoredUsersManager.dispose(),this._ignoredUsersManager=null),this._groupInformationManager&&(this._groupInformationManager.dispose(),this._groupInformationManager=null),K.instance.events.removeEventListener(Ra.SETTINGS_UPDATED,this.onNitroSettingsEvent),super.onDispose()}resetUserInfo(){this._userId=0,this._name=null,this._figure=null,this._gender=null,this._realName=null,this._canChangeName=!1,this._safetyLocked=!1}loadFurnitureData(){this.destroyFurnitureData(),this._furnitureData=new bo(this._floorItems,this._wallItems,K.instance.localization),this._furnitureData.addEventListener(bo.FURNITURE_DATA_READY,this.onFurnitureDataReadyEvent),this._furnitureData.loadFurnitureData(rt.getValue("furnidata.url"))}loadProductData(){this.destroyProductData(),this._productData=new Do(this._products),this._productData.addEventListener(Do.PDP_PRODUCT_DATA_READY,this.onProductDataReadyEvent),this._productData.loadProductData(rt.getValue("productdata.url"))}loadBadgeImageManager(){this._badgeImageManager||(this._badgeImageManager=new Ea(ys(),this),this._badgeImageManager.init())}hasProductData(t){return this._productsReady?!0:(t&&this._pendingProductListeners.indexOf(t)===-1&&this._pendingProductListeners.push(t),!1)}getAllFurnitureData(t){if(!this._furnitureReady)return this._pendingFurnitureListeners.indexOf(t)===-1&&this._pendingFurnitureListeners.push(t),null;const e=[];for(const i of this._floorItems.values())i&&e.push(i);for(const i of this._wallItems.values())i&&e.push(i);return e}removePendingFurniDataListener(t){if(!this._pendingFurnitureListeners)return;const e=this._pendingFurnitureListeners.indexOf(t);e!==-1&&this._pendingFurnitureListeners.splice(e,1)}onUserFigureEvent(t){!t||!t.connection||(this._figure=t.getParser().figure,this._gender=t.getParser().gender,Ln.updateFigure(this._figure))}onUserInfoEvent(t){if(!t||!t.connection)return;this.resetUserInfo();const e=t.getParser().userInfo;e&&(this._userId=e.userId,this._name=e.username,this._figure=e.figure,this._gender=e.gender,this._realName=e.realName,this._respectsReceived=e.respectsReceived,this._respectsLeft=e.respectsRemaining,this._respectsPetLeft=e.respectsPetRemaining,this._canChangeName=e.canChangeName,this._safetyLocked=e.safetyLocked,this._ignoredUsersManager&&this._ignoredUsersManager.requestIgnoredUsers())}onUserPermissionsEvent(t){!t||!t.connection||(this._clubLevel=t.getParser().clubLevel,this._securityLevel=t.getParser().securityLevel,this._isAmbassador=t.getParser().isAmbassador)}onAvailabilityStatusMessageEvent(t){if(!t||!t.connection)return;const e=t.getParser();e&&(this._systemOpen=e.isOpen,this._systemShutdown=e.onShutdown,this._isAuthenticHabbo=e.isAuthenticUser)}onPetRespectFailed(t){!t||!t.connection||this._respectsPetLeft++}onChangeNameUpdateEvent(t){if(!t||!t.connection)return;const e=t.getParser();e&&e.resultCode===zs.NAME_OK&&(this._canChangeName=!1,this.events.dispatchEvent(new kc(e.name)))}onUserNameChangeMessageEvent(t){if(!t||!t.connection)return;const e=t.getParser();e&&e.webId===this.userId&&(this._name=e.newName,this._canChangeName=!1,this.events.dispatchEvent(new kc(this._name)))}onUserTags(t){if(!t||!t.connection)return;const e=t.getParser();e&&(this._tags=e.tags)}onRoomModelNameEvent(t){if(!t)return;const e=t.getParser();e&&Ln.roomVisited(e.roomId)}onFurnitureDataReadyEvent(t){if(this._furnitureData.removeEventListener(bo.FURNITURE_DATA_READY,this.onFurnitureDataReadyEvent),this._furnitureReady=!0,!this._furnitureListenersNotified&&(this._furnitureListenersNotified=!0,this._pendingFurnitureListeners&&this._pendingFurnitureListeners.length))for(const e of this._pendingFurnitureListeners)e&&e.loadFurnitureData();this._pendingProductListeners=[]}onProductDataReadyEvent(t){this._productData.removeEventListener(Do.PDP_PRODUCT_DATA_READY,this.onProductDataReadyEvent),this._productsReady=!0;for(const e of this._pendingProductListeners)e&&e.loadProductData();this._pendingProductListeners=[]}onInClientLinkEvent(t){if(!t)return;const e=t.getParser();e&&K.instance.createLinkEvent(e.link)}onMysteryBoxKeysEvent(t){if(!t)return;const e=t.getParser();e&&this.events.dispatchEvent(new oI(e.boxColor,e.keyColor))}onNoobnessLevelMessageEvent(t){this._noobnessLevel=t.getParser().noobnessLevel,this._noobnessLevel!==Ta.OLD_IDENTITY&&rt.setValue("new.identity",1)}onAccountSafetyLockStatusChangeMessageEvent(t){if(!t)return;const e=t.getParser();e&&(this._safetyLocked=e.status==Ul.SAFETY_LOCK_STATUS_LOCKED)}onEmailStatus(t){if(!t)return;const e=t.getParser();e&&(this._isEmailVerified=e.isVerified)}onNitroSettingsEvent(t){this._isRoomCameraFollowDisabled=t.cameraFollow,this._uiFlags=t.flags,this.events.dispatchEvent(new jI(this._uiFlags))}destroyFurnitureData(){this._furnitureData&&(this._furnitureData.dispose(),this._furnitureData=null)}destroyProductData(){this._productData&&(this._productData.dispose(),this._productData=null)}getFloorItemData(t){const e=this._floorItems.get(t);return e||null}getFloorItemDataByName(t){if(!t||!this._floorItems||!this._floorItems.size)return null;for(const e of this._floorItems.values())if(!(!e||e.className!==t))return e}getWallItemData(t){const e=this._wallItems.get(t);return e||null}getWallItemDataByName(t){if(!t||!this._wallItems||!this._wallItems.size)return null;for(const e of this._wallItems.values())if(!(!e||e.className!==t))return e}getProductData(t){return this._productsReady||this.loadProductData(),this._products.get(t)}getBadgeUrl(t){return this._badgeImageManager.getBadgeUrl(t)}getGroupBadgeUrl(t){return this._badgeImageManager.getBadgeUrl(t,Ea.GROUP_BADGE)}getBadgeImage(t){return this._badgeImageManager.getBadgeImage(t)}getGroupBadgeImage(t){return this._badgeImageManager.getBadgeImage(t,Ea.GROUP_BADGE)}getUserTags(t){t<0||this.send(new WO(t))}loadBadgeImage(t){return this._badgeImageManager.loadBadgeImage(t)}loadGroupBadgeImage(t){return this._badgeImageManager.loadBadgeImage(t,Ea.GROUP_BADGE)}hasSecurity(t){return this._securityLevel>=t}giveRespect(t){t<0||this._respectsLeft<=0||(this.send(new $O(t)),this._respectsLeft--)}givePetRespect(t){t<0||this._respectsPetLeft<=0||(this.send(new FR(t)),this._respectsPetLeft--)}sendSpecialCommandMessage(t,e=0){this.send(new Jf(t))}ignoreUser(t){this._ignoredUsersManager&&this._ignoredUsersManager.ignoreUser(t)}unignoreUser(t){this._ignoredUsersManager&&this._ignoredUsersManager.unignoreUser(t)}isUserIgnored(t){return this._ignoredUsersManager&&this._ignoredUsersManager.isIgnored(t)}getGroupBadge(t){return this._groupInformationManager&&this._groupInformationManager.getGroupBadge(t)}send(t){this._communication.connection.send(t)}get communication(){return this._communication}get userId(){return this._userId}get userName(){return this._name}get figure(){return this._figure}get gender(){return this._gender}get realName(){return this._realName}get ignoredUsersManager(){return this._ignoredUsersManager}get groupInformationManager(){return this._groupInformationManager}get respectsReceived(){return this._respectsReceived}get respectsLeft(){return this._respectsLeft}get respectsPetLeft(){return this._respectsPetLeft}get canChangeName(){return this._canChangeName}get clubLevel(){return this._clubLevel}get securityLevel(){return this._securityLevel}get isAmbassador(){return this._isAmbassador}get isEmailVerified(){return this._isEmailVerified}get isNoob(){return this._noobnessLevel!==Ta.OLD_IDENTITY}get isRealNoob(){return this._noobnessLevel===Ta.REAL_NOOB}get isSystemOpen(){return this._systemOpen}get isSystemShutdown(){return this._systemShutdown}get isAuthenticHabbo(){return this._isAuthenticHabbo}get isModerator(){return this._securityLevel>=Ys.MODERATOR}get isCameraFollowDisabled(){return this._isRoomCameraFollowDisabled}get uiFlags(){return this._uiFlags}get tags(){return this._tags}}class uv extends zl{constructor(t,e,i,r,n=""){super(t,e,i,r),this._jukeboxDiskId=-1,this._songData=n}get id(){return this._id}get length(){return this._length}get name(){return this._name}get creator(){return this._creator}get songData(){return this._songData}set songData(t){this._songData=t}get diskId(){return this._jukeboxDiskId}set diskId(t){this._jukeboxDiskId=t}}class yq{constructor(t,e,i,r,n){this._songId=t,this._startPos=e,this._playLength=i,this._fadeInSeconds=r,this._fadeOutSeconds=n,this._playRequestTime=Date.now()}get songId(){return this._songId}get startPos(){return this._startPos<0?0:this._startPos+(Date.now()-this._playRequestTime)/1e3}get playLength(){return this._playLength}get playRequestTime(){return this._playRequestTime}get fadeInSeconds(){return this._fadeInSeconds}get fadeOutSeconds(){return this._fadeOutSeconds}}const lv=class extends Rt{constructor(s,t){super(lv.NOTIFY_PLAYED_SONG),this._name=s,this._creator=t}get name(){return this._name}get creator(){return this._creator}};let _v=lv;_v.NOTIFY_PLAYED_SONG="UIEW_NOTIFY_PLAYED_SONG";class Ki extends Rt{constructor(t,e,i,r){super(t),this._id=i,this._position=r,this._priority=e}get id(){return this._id}get position(){return this._position}get priority(){return this._priority}}Ki.NPE_USER_PLAY_SONG="NPE_USER_PLAY_SONG";Ki.NPW_USER_STOP_SONG="NPW_USER_STOP_SONG";Ki.NPE_SONG_CHANGED="NPE_SONG_CHANGED";class gr extends Rt{constructor(t){super(t)}}gr.PLUE_PLAY_LIST_UPDATED="PLUE_PLAY_LIST_UPDATED";gr.PLUE_PLAY_LIST_FULL="PLUE_PLAY_LIST_FULL";class So extends Rt{constructor(t){super(t)}}So.SDIR_SONG_DISK_INVENTORY_RECEIVENT_EVENT="SDIR_SONG_DISK_INVENTORY_RECEIVENT_EVENT";class ih extends Rt{constructor(t,e){super(t),this._id=e}get id(){return this._id}}ih.SIR_TRAX_SONG_INFO_RECEIVED="SIR_TRAX_SONG_INFO_RECEIVED";class rh extends Rt{constructor(t,e){super(t),this._id=e}get id(){return this._id}}rh.TRAX_SONG_COMPLETE="SME_TRAX_SONG_COMPLETE";class Ye{}Ye.PRIORITY_ROOM_PLAYLIST=0;Ye.PRIORITY_USER_PLAYLIST=1;Ye.PRIORITY_SONG_PLAY=2;Ye.PRIORITY_PURCHASE_PREVIEW=3;Ye.PRIORITY_COUNT=4;class Cq{constructor(){this._isPlaying=!1,this._disposed=!1,this._entries=[],this._missingSongInfo=[],this._messageEvents=[new cR(this.onNowPlayingMessageEvent.bind(this)),new _R(this.onJukeboxSongDisksMessageEvent.bind(this)),new lR(this.onJukeboxPlayListFullMessageEvent.bind(this))],this.onSongInfoReceivedEvent=this.onSongInfoReceivedEvent.bind(this)}init(){this._messageEvents.forEach(t=>K.instance.communication.connection.addMessageEvent(t)),K.instance.soundManager.events.addEventListener(ih.SIR_TRAX_SONG_INFO_RECEIVED,this.onSongInfoReceivedEvent)}get priority(){return Ye.PRIORITY_ROOM_PLAYLIST}onNowPlayingMessageEvent(t){const e=t.getParser();this._isPlaying=e.currentSongId!==-1,e.currentSongId>=0?(K.instance.soundManager.musicController.playSong(e.currentSongId,Ye.PRIORITY_ROOM_PLAYLIST,e.syncCount/1e3,0,1,1),this._currentEntryId=e.currentSongId):this.stopPlaying(),e.nextSongId>=0&&K.instance.soundManager.musicController.addSongInfoRequest(e.nextSongId),this._playPosition=e.currentPosition,K.instance.soundManager.events.dispatchEvent(new Ki(Ki.NPE_SONG_CHANGED,Ye.PRIORITY_ROOM_PLAYLIST,e.currentSongId,e.currentPosition))}onJukeboxSongDisksMessageEvent(t){const e=t.getParser();this._entries=[];for(let i=0;i<e.songDisks.length;i++){const r=e.songDisks.getWithIndex(i),n=e.songDisks.getKey(i);let a=K.instance.soundManager.musicController.getSongInfo(r);a==null&&(a=new uv(r,-1,null,null,null),this._missingSongInfo.indexOf(r)<0&&(this._missingSongInfo.push(r),K.instance.soundManager.musicController.requestSongInfoWithoutSamples(r))),a.diskId=n,this._entries.push(a)}this._missingSongInfo.length==0&&K.instance.soundManager.events.dispatchEvent(new gr(gr.PLUE_PLAY_LIST_UPDATED))}onJukeboxPlayListFullMessageEvent(t){K.instance.soundManager.events.dispatchEvent(new gr(gr.PLUE_PLAY_LIST_FULL))}onSongInfoReceivedEvent(t){for(let i=0;i<this.length;i++){const r=this._entries[i];if(r.id===t.id){const n=r.diskId,a=K.instance.soundManager.musicController.getSongInfo(t.id);a!=null&&(a.diskId=n,this._entries[i]=a);break}}const e=this._missingSongInfo.indexOf(t.id);e>=0&&this._missingSongInfo.splice(e,1),this._missingSongInfo.length==0&&K.instance.soundManager.events.dispatchEvent(new gr(gr.PLUE_PLAY_LIST_UPDATED))}stopPlaying(){K.instance.soundManager.musicController.stop(this.priority),this._currentEntryId=-1,this._playPosition=-1,this._isPlaying=!1}get length(){return this._entries?this._entries.length:0}get playPosition(){return this._playPosition}get nowPlayingSongId(){return this._currentEntryId}get isPlaying(){return this._isPlaying}get entries(){return this._entries}getEntry(t){return t<0||t>=this._entries.length?null:this._entries[t]}requestPlayList(){K.instance.communication.connection.send(new VO)}dispose(){this._disposed||(this._disposed=!0,this.stopPlaying(),K.instance.soundManager.events&&K.instance.soundManager.events.removeEventListener(ih.SIR_TRAX_SONG_INFO_RECEIVED,this.onSongInfoReceivedEvent),this._messageEvents.forEach(t=>K.instance.communication.connection.removeMessageEvent(t)),this._messageEvents=null)}}class Mq{constructor(t){this._id=t,this._items=[]}addChannelItem(t){this._items.push(t)}get items(){return this._items}}class Nq{constructor(t,e){this._id=t,this._length=e}get id(){return this._id}get length(){return this._length}}class af{constructor(t){this._channels=[],this._metaData=new Map;let e=[];const i=t.split(":"),r=i[i.length-1];if(r.indexOf("meta")>-1){const n=r.split(";");for(const a of n){const o=a.split(",");this._metaData.set(o[0],o[1])}e=i.slice(0,i.length-1)}else e=i;for(let n=0;n<e.length/2;n++)if(e[n*2].length>0){const a=parseInt(e[n*2]),o=e[n*2+1].split(";"),h=new Mq(a);for(const u of o){const c=u.split(",");if(c.length!==2)return;h.addChannelItem(new Nq(parseInt(c[0]),parseInt(c[1])))}this._channels.push(h)}}get channels(){return this._channels}getSampleIds(){const t=[];for(const e of this._channels)for(const i of e.items)t.indexOf(i.id)===-1&&t.push(i.id);return t}get hasMetaData(){return this._metaData.has("meta")}get metaCutMode(){return this._metaData.has("c")}get metaTempo(){const t=this._metaData.get("t");return t?parseInt(t):null}}var ln={};/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(s){(function(){var t=function(){this.init()};t.prototype={init:function(){var l=this||e;return l._counter=1e3,l._html5AudioPool=[],l.html5PoolSize=10,l._codecs={},l._howls=[],l._muted=!1,l._volume=1,l._canPlayEvent="canplaythrough",l._navigator=typeof window<"u"&&window.navigator?window.navigator:null,l.masterGain=null,l.noAudio=!1,l.usingWebAudio=!0,l.autoSuspend=!0,l.ctx=null,l.autoUnlock=!0,l._setup(),l},volume:function(l){var _=this||e;if(l=parseFloat(l),_.ctx||c(),typeof l<"u"&&l>=0&&l<=1){if(_._volume=l,_._muted)return _;_.usingWebAudio&&_.masterGain.gain.setValueAtTime(l,e.ctx.currentTime);for(var d=0;d<_._howls.length;d++)if(!_._howls[d]._webAudio)for(var g=_._howls[d]._getSoundIds(),m=0;m<g.length;m++){var p=_._howls[d]._soundById(g[m]);p&&p._node&&(p._node.volume=p._volume*l)}return _}return _._volume},mute:function(l){var _=this||e;_.ctx||c(),_._muted=l,_.usingWebAudio&&_.masterGain.gain.setValueAtTime(l?0:_._volume,e.ctx.currentTime);for(var d=0;d<_._howls.length;d++)if(!_._howls[d]._webAudio)for(var g=_._howls[d]._getSoundIds(),m=0;m<g.length;m++){var p=_._howls[d]._soundById(g[m]);p&&p._node&&(p._node.muted=l?!0:p._muted)}return _},stop:function(){for(var l=this||e,_=0;_<l._howls.length;_++)l._howls[_].stop();return l},unload:function(){for(var l=this||e,_=l._howls.length-1;_>=0;_--)l._howls[_].unload();return l.usingWebAudio&&l.ctx&&typeof l.ctx.close<"u"&&(l.ctx.close(),l.ctx=null,c()),l},codecs:function(l){return(this||e)._codecs[l.replace(/^x-/,"")]},_setup:function(){var l=this||e;if(l.state=l.ctx&&l.ctx.state||"suspended",l._autoSuspend(),!l.usingWebAudio)if(typeof Audio<"u")try{var _=new Audio;typeof _.oncanplaythrough>"u"&&(l._canPlayEvent="canplay")}catch{l.noAudio=!0}else l.noAudio=!0;try{var _=new Audio;_.muted&&(l.noAudio=!0)}catch{}return l.noAudio||l._setupCodecs(),l},_setupCodecs:function(){var l=this||e,_=null;try{_=typeof Audio<"u"?new Audio:null}catch{return l}if(!_||typeof _.canPlayType!="function")return l;var d=_.canPlayType("audio/mpeg;").replace(/^no$/,""),g=l._navigator?l._navigator.userAgent:"",m=g.match(/OPR\/([0-6].)/g),p=m&&parseInt(m[0].split("/")[1],10)<33,T=g.indexOf("Safari")!==-1&&g.indexOf("Chrome")===-1,A=g.match(/Version\/(.*?) /),O=T&&A&&parseInt(A[1],10)<15;return l._codecs={mp3:!!(!p&&(d||_.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!d,opus:!!_.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!_.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!_.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(_.canPlayType('audio/wav; codecs="1"')||_.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!_.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!_.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(_.canPlayType("audio/x-m4a;")||_.canPlayType("audio/m4a;")||_.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(_.canPlayType("audio/x-m4b;")||_.canPlayType("audio/m4b;")||_.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(_.canPlayType("audio/x-mp4;")||_.canPlayType("audio/mp4;")||_.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!O&&_.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!O&&_.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!_.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(_.canPlayType("audio/x-flac;")||_.canPlayType("audio/flac;")).replace(/^no$/,"")},l},_unlockAudio:function(){var l=this||e;if(!(l._audioUnlocked||!l.ctx)){l._audioUnlocked=!1,l.autoUnlock=!1,!l._mobileUnloaded&&l.ctx.sampleRate!==44100&&(l._mobileUnloaded=!0,l.unload()),l._scratchBuffer=l.ctx.createBuffer(1,1,22050);var _=function(d){for(;l._html5AudioPool.length<l.html5PoolSize;)try{var g=new Audio;g._unlocked=!0,l._releaseHtml5Audio(g)}catch{l.noAudio=!0;break}for(var m=0;m<l._howls.length;m++)if(!l._howls[m]._webAudio)for(var p=l._howls[m]._getSoundIds(),T=0;T<p.length;T++){var A=l._howls[m]._soundById(p[T]);A&&A._node&&!A._node._unlocked&&(A._node._unlocked=!0,A._node.load())}l._autoResume();var O=l.ctx.createBufferSource();O.buffer=l._scratchBuffer,O.connect(l.ctx.destination),typeof O.start>"u"?O.noteOn(0):O.start(0),typeof l.ctx.resume=="function"&&l.ctx.resume(),O.onended=function(){O.disconnect(0),l._audioUnlocked=!0,document.removeEventListener("touchstart",_,!0),document.removeEventListener("touchend",_,!0),document.removeEventListener("click",_,!0),document.removeEventListener("keydown",_,!0);for(var v=0;v<l._howls.length;v++)l._howls[v]._emit("unlock")}};return document.addEventListener("touchstart",_,!0),document.addEventListener("touchend",_,!0),document.addEventListener("click",_,!0),document.addEventListener("keydown",_,!0),l}},_obtainHtml5Audio:function(){var l=this||e;if(l._html5AudioPool.length)return l._html5AudioPool.pop();var _=new Audio().play();return _&&typeof Promise<"u"&&(_ instanceof Promise||typeof _.then=="function")&&_.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(l){var _=this||e;return l._unlocked&&_._html5AudioPool.push(l),_},_autoSuspend:function(){var l=this;if(!(!l.autoSuspend||!l.ctx||typeof l.ctx.suspend>"u"||!e.usingWebAudio)){for(var _=0;_<l._howls.length;_++)if(l._howls[_]._webAudio){for(var d=0;d<l._howls[_]._sounds.length;d++)if(!l._howls[_]._sounds[d]._paused)return l}return l._suspendTimer&&clearTimeout(l._suspendTimer),l._suspendTimer=setTimeout(function(){if(l.autoSuspend){l._suspendTimer=null,l.state="suspending";var g=function(){l.state="suspended",l._resumeAfterSuspend&&(delete l._resumeAfterSuspend,l._autoResume())};l.ctx.suspend().then(g,g)}},3e4),l}},_autoResume:function(){var l=this;if(!(!l.ctx||typeof l.ctx.resume>"u"||!e.usingWebAudio))return l.state==="running"&&l.ctx.state!=="interrupted"&&l._suspendTimer?(clearTimeout(l._suspendTimer),l._suspendTimer=null):l.state==="suspended"||l.state==="running"&&l.ctx.state==="interrupted"?(l.ctx.resume().then(function(){l.state="running";for(var _=0;_<l._howls.length;_++)l._howls[_]._emit("resume")}),l._suspendTimer&&(clearTimeout(l._suspendTimer),l._suspendTimer=null)):l.state==="suspending"&&(l._resumeAfterSuspend=!0),l}};var e=new t,i=function(l){var _=this;if(!l.src||l.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}_.init(l)};i.prototype={init:function(l){var _=this;return e.ctx||c(),_._autoplay=l.autoplay||!1,_._format=typeof l.format!="string"?l.format:[l.format],_._html5=l.html5||!1,_._muted=l.mute||!1,_._loop=l.loop||!1,_._pool=l.pool||5,_._preload=typeof l.preload=="boolean"||l.preload==="metadata"?l.preload:!0,_._rate=l.rate||1,_._sprite=l.sprite||{},_._src=typeof l.src!="string"?l.src:[l.src],_._volume=l.volume!==void 0?l.volume:1,_._xhr={method:l.xhr&&l.xhr.method?l.xhr.method:"GET",headers:l.xhr&&l.xhr.headers?l.xhr.headers:null,withCredentials:l.xhr&&l.xhr.withCredentials?l.xhr.withCredentials:!1},_._duration=0,_._state="unloaded",_._sounds=[],_._endTimers={},_._queue=[],_._playLock=!1,_._onend=l.onend?[{fn:l.onend}]:[],_._onfade=l.onfade?[{fn:l.onfade}]:[],_._onload=l.onload?[{fn:l.onload}]:[],_._onloaderror=l.onloaderror?[{fn:l.onloaderror}]:[],_._onplayerror=l.onplayerror?[{fn:l.onplayerror}]:[],_._onpause=l.onpause?[{fn:l.onpause}]:[],_._onplay=l.onplay?[{fn:l.onplay}]:[],_._onstop=l.onstop?[{fn:l.onstop}]:[],_._onmute=l.onmute?[{fn:l.onmute}]:[],_._onvolume=l.onvolume?[{fn:l.onvolume}]:[],_._onrate=l.onrate?[{fn:l.onrate}]:[],_._onseek=l.onseek?[{fn:l.onseek}]:[],_._onunlock=l.onunlock?[{fn:l.onunlock}]:[],_._onresume=[],_._webAudio=e.usingWebAudio&&!_._html5,typeof e.ctx<"u"&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(_),_._autoplay&&_._queue.push({event:"play",action:function(){_.play()}}),_._preload&&_._preload!=="none"&&_.load(),_},load:function(){var l=this,_=null;if(e.noAudio){l._emit("loaderror",null,"No audio support.");return}typeof l._src=="string"&&(l._src=[l._src]);for(var d=0;d<l._src.length;d++){var g,m;if(l._format&&l._format[d])g=l._format[d];else{if(m=l._src[d],typeof m!="string"){l._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}g=/^data:audio\/([^;,]+);/i.exec(m),g||(g=/\.([^.]+)$/.exec(m.split("?",1)[0])),g&&(g=g[1].toLowerCase())}if(g||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),g&&e.codecs(g)){_=l._src[d];break}}if(!_){l._emit("loaderror",null,"No codec support for selected audio sources.");return}return l._src=_,l._state="loading",window.location.protocol==="https:"&&_.slice(0,5)==="http:"&&(l._html5=!0,l._webAudio=!1),new r(l),l._webAudio&&a(l),l},play:function(l,_){var d=this,g=null;if(typeof l=="number")g=l,l=null;else{if(typeof l=="string"&&d._state==="loaded"&&!d._sprite[l])return null;if(typeof l>"u"&&(l="__default",!d._playLock)){for(var m=0,p=0;p<d._sounds.length;p++)d._sounds[p]._paused&&!d._sounds[p]._ended&&(m++,g=d._sounds[p]._id);m===1?l=null:g=null}}var T=g?d._soundById(g):d._inactiveSound();if(!T)return null;if(g&&!l&&(l=T._sprite||"__default"),d._state!=="loaded"){T._sprite=l,T._ended=!1;var A=T._id;return d._queue.push({event:"play",action:function(){d.play(A)}}),A}if(g&&!T._paused)return _||d._loadQueue("play"),T._id;d._webAudio&&e._autoResume();var O=Math.max(0,T._seek>0?T._seek:d._sprite[l][0]/1e3),v=Math.max(0,(d._sprite[l][0]+d._sprite[l][1])/1e3-O),y=v*1e3/Math.abs(T._rate),C=d._sprite[l][0]/1e3,N=(d._sprite[l][0]+d._sprite[l][1])/1e3;T._sprite=l,T._ended=!1;var L=function(){T._paused=!1,T._seek=O,T._start=C,T._stop=N,T._loop=!!(T._loop||d._sprite[l][2])};if(O>=N){d._ended(T);return}var P=T._node;if(d._webAudio){var b=function(){d._playLock=!1,L(),d._refreshBuffer(T);var dt=T._muted||d._muted?0:T._volume;P.gain.setValueAtTime(dt,e.ctx.currentTime),T._playStart=e.ctx.currentTime,typeof P.bufferSource.start>"u"?T._loop?P.bufferSource.noteGrainOn(0,O,86400):P.bufferSource.noteGrainOn(0,O,v):T._loop?P.bufferSource.start(0,O,86400):P.bufferSource.start(0,O,v),y!==1/0&&(d._endTimers[T._id]=setTimeout(d._ended.bind(d,T),y)),_||setTimeout(function(){d._emit("play",T._id),d._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?b():(d._playLock=!0,d.once("resume",b),d._clearTimer(T._id))}else{var w=function(){P.currentTime=O,P.muted=T._muted||d._muted||e._muted||P.muted,P.volume=T._volume*e.volume(),P.playbackRate=T._rate;try{var dt=P.play();if(dt&&typeof Promise<"u"&&(dt instanceof Promise||typeof dt.then=="function")?(d._playLock=!0,L(),dt.then(function(){d._playLock=!1,P._unlocked=!0,_?d._loadQueue():d._emit("play",T._id)}).catch(function(){d._playLock=!1,d._emit("playerror",T._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),T._ended=!0,T._paused=!0})):_||(d._playLock=!1,L(),d._emit("play",T._id)),P.playbackRate=T._rate,P.paused){d._emit("playerror",T._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}l!=="__default"||T._loop?d._endTimers[T._id]=setTimeout(d._ended.bind(d,T),y):(d._endTimers[T._id]=function(){d._ended(T),P.removeEventListener("ended",d._endTimers[T._id],!1)},P.addEventListener("ended",d._endTimers[T._id],!1))}catch(j){d._emit("playerror",T._id,j)}};P.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(P.src=d._src,P.load());var q=window&&window.ejecta||!P.readyState&&e._navigator.isCocoonJS;if(P.readyState>=3||q)w();else{d._playLock=!0,d._state="loading";var ht=function(){d._state="loaded",w(),P.removeEventListener(e._canPlayEvent,ht,!1)};P.addEventListener(e._canPlayEvent,ht,!1),d._clearTimer(T._id)}}return T._id},pause:function(l){var _=this;if(_._state!=="loaded"||_._playLock)return _._queue.push({event:"pause",action:function(){_.pause(l)}}),_;for(var d=_._getSoundIds(l),g=0;g<d.length;g++){_._clearTimer(d[g]);var m=_._soundById(d[g]);if(m&&!m._paused&&(m._seek=_.seek(d[g]),m._rateSeek=0,m._paused=!0,_._stopFade(d[g]),m._node))if(_._webAudio){if(!m._node.bufferSource)continue;typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),_._cleanBuffer(m._node)}else(!isNaN(m._node.duration)||m._node.duration===1/0)&&m._node.pause();arguments[1]||_._emit("pause",m?m._id:null)}return _},stop:function(l,_){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"stop",action:function(){d.stop(l)}}),d;for(var g=d._getSoundIds(l),m=0;m<g.length;m++){d._clearTimer(g[m]);var p=d._soundById(g[m]);p&&(p._seek=p._start||0,p._rateSeek=0,p._paused=!0,p._ended=!0,d._stopFade(g[m]),p._node&&(d._webAudio?p._node.bufferSource&&(typeof p._node.bufferSource.stop>"u"?p._node.bufferSource.noteOff(0):p._node.bufferSource.stop(0),d._cleanBuffer(p._node)):(!isNaN(p._node.duration)||p._node.duration===1/0)&&(p._node.currentTime=p._start||0,p._node.pause(),p._node.duration===1/0&&d._clearSound(p._node))),_||d._emit("stop",p._id))}return d},mute:function(l,_){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"mute",action:function(){d.mute(l,_)}}),d;if(typeof _>"u")if(typeof l=="boolean")d._muted=l;else return d._muted;for(var g=d._getSoundIds(_),m=0;m<g.length;m++){var p=d._soundById(g[m]);p&&(p._muted=l,p._interval&&d._stopFade(p._id),d._webAudio&&p._node?p._node.gain.setValueAtTime(l?0:p._volume,e.ctx.currentTime):p._node&&(p._node.muted=e._muted?!0:l),d._emit("mute",p._id))}return d},volume:function(){var l=this,_=arguments,d,g;if(_.length===0)return l._volume;if(_.length===1||_.length===2&&typeof _[1]>"u"){var m=l._getSoundIds(),p=m.indexOf(_[0]);p>=0?g=parseInt(_[0],10):d=parseFloat(_[0])}else _.length>=2&&(d=parseFloat(_[0]),g=parseInt(_[1],10));var T;if(typeof d<"u"&&d>=0&&d<=1){if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"volume",action:function(){l.volume.apply(l,_)}}),l;typeof g>"u"&&(l._volume=d),g=l._getSoundIds(g);for(var A=0;A<g.length;A++)T=l._soundById(g[A]),T&&(T._volume=d,_[2]||l._stopFade(g[A]),l._webAudio&&T._node&&!T._muted?T._node.gain.setValueAtTime(d,e.ctx.currentTime):T._node&&!T._muted&&(T._node.volume=d*e.volume()),l._emit("volume",T._id))}else return T=g?l._soundById(g):l._sounds[0],T?T._volume:0;return l},fade:function(l,_,d,g){var m=this;if(m._state!=="loaded"||m._playLock)return m._queue.push({event:"fade",action:function(){m.fade(l,_,d,g)}}),m;l=Math.min(Math.max(0,parseFloat(l)),1),_=Math.min(Math.max(0,parseFloat(_)),1),d=parseFloat(d),m.volume(l,g);for(var p=m._getSoundIds(g),T=0;T<p.length;T++){var A=m._soundById(p[T]);if(A){if(g||m._stopFade(p[T]),m._webAudio&&!A._muted){var O=e.ctx.currentTime,v=O+d/1e3;A._volume=l,A._node.gain.setValueAtTime(l,O),A._node.gain.linearRampToValueAtTime(_,v)}m._startFadeInterval(A,l,_,d,p[T],typeof g>"u")}}return m},_startFadeInterval:function(l,_,d,g,m,p){var T=this,A=_,O=d-_,v=Math.abs(O/.01),y=Math.max(4,v>0?g/v:g),C=Date.now();l._fadeTo=d,l._interval=setInterval(function(){var N=(Date.now()-C)/g;C=Date.now(),A+=O*N,A=Math.round(A*100)/100,O<0?A=Math.max(d,A):A=Math.min(d,A),T._webAudio?l._volume=A:T.volume(A,l._id,!0),p&&(T._volume=A),(d<_&&A<=d||d>_&&A>=d)&&(clearInterval(l._interval),l._interval=null,l._fadeTo=null,T.volume(d,l._id),T._emit("fade",l._id))},y)},_stopFade:function(l){var _=this,d=_._soundById(l);return d&&d._interval&&(_._webAudio&&d._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(d._interval),d._interval=null,_.volume(d._fadeTo,l),d._fadeTo=null,_._emit("fade",l)),_},loop:function(){var l=this,_=arguments,d,g,m;if(_.length===0)return l._loop;if(_.length===1)if(typeof _[0]=="boolean")d=_[0],l._loop=d;else return m=l._soundById(parseInt(_[0],10)),m?m._loop:!1;else _.length===2&&(d=_[0],g=parseInt(_[1],10));for(var p=l._getSoundIds(g),T=0;T<p.length;T++)m=l._soundById(p[T]),m&&(m._loop=d,l._webAudio&&m._node&&m._node.bufferSource&&(m._node.bufferSource.loop=d,d&&(m._node.bufferSource.loopStart=m._start||0,m._node.bufferSource.loopEnd=m._stop,l.playing(p[T])&&(l.pause(p[T],!0),l.play(p[T],!0)))));return l},rate:function(){var l=this,_=arguments,d,g;if(_.length===0)g=l._sounds[0]._id;else if(_.length===1){var m=l._getSoundIds(),p=m.indexOf(_[0]);p>=0?g=parseInt(_[0],10):d=parseFloat(_[0])}else _.length===2&&(d=parseFloat(_[0]),g=parseInt(_[1],10));var T;if(typeof d=="number"){if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"rate",action:function(){l.rate.apply(l,_)}}),l;typeof g>"u"&&(l._rate=d),g=l._getSoundIds(g);for(var A=0;A<g.length;A++)if(T=l._soundById(g[A]),T){l.playing(g[A])&&(T._rateSeek=l.seek(g[A]),T._playStart=l._webAudio?e.ctx.currentTime:T._playStart),T._rate=d,l._webAudio&&T._node&&T._node.bufferSource?T._node.bufferSource.playbackRate.setValueAtTime(d,e.ctx.currentTime):T._node&&(T._node.playbackRate=d);var O=l.seek(g[A]),v=(l._sprite[T._sprite][0]+l._sprite[T._sprite][1])/1e3-O,y=v*1e3/Math.abs(T._rate);(l._endTimers[g[A]]||!T._paused)&&(l._clearTimer(g[A]),l._endTimers[g[A]]=setTimeout(l._ended.bind(l,T),y)),l._emit("rate",T._id)}}else return T=l._soundById(g),T?T._rate:l._rate;return l},seek:function(){var l=this,_=arguments,d,g;if(_.length===0)l._sounds.length&&(g=l._sounds[0]._id);else if(_.length===1){var m=l._getSoundIds(),p=m.indexOf(_[0]);p>=0?g=parseInt(_[0],10):l._sounds.length&&(g=l._sounds[0]._id,d=parseFloat(_[0]))}else _.length===2&&(d=parseFloat(_[0]),g=parseInt(_[1],10));if(typeof g>"u")return 0;if(typeof d=="number"&&(l._state!=="loaded"||l._playLock))return l._queue.push({event:"seek",action:function(){l.seek.apply(l,_)}}),l;var T=l._soundById(g);if(T)if(typeof d=="number"&&d>=0){var A=l.playing(g);A&&l.pause(g,!0),T._seek=d,T._ended=!1,l._clearTimer(g),!l._webAudio&&T._node&&!isNaN(T._node.duration)&&(T._node.currentTime=d);var O=function(){A&&l.play(g,!0),l._emit("seek",g)};if(A&&!l._webAudio){var v=function(){l._playLock?setTimeout(v,0):O()};setTimeout(v,0)}else O()}else if(l._webAudio){var y=l.playing(g)?e.ctx.currentTime-T._playStart:0,C=T._rateSeek?T._rateSeek-T._seek:0;return T._seek+(C+y*Math.abs(T._rate))}else return T._node.currentTime;return l},playing:function(l){var _=this;if(typeof l=="number"){var d=_._soundById(l);return d?!d._paused:!1}for(var g=0;g<_._sounds.length;g++)if(!_._sounds[g]._paused)return!0;return!1},duration:function(l){var _=this,d=_._duration,g=_._soundById(l);return g&&(d=_._sprite[g._sprite][1]/1e3),d},state:function(){return this._state},unload:function(){for(var l=this,_=l._sounds,d=0;d<_.length;d++)_[d]._paused||l.stop(_[d]._id),l._webAudio||(l._clearSound(_[d]._node),_[d]._node.removeEventListener("error",_[d]._errorFn,!1),_[d]._node.removeEventListener(e._canPlayEvent,_[d]._loadFn,!1),_[d]._node.removeEventListener("ended",_[d]._endFn,!1),e._releaseHtml5Audio(_[d]._node)),delete _[d]._node,l._clearTimer(_[d]._id);var g=e._howls.indexOf(l);g>=0&&e._howls.splice(g,1);var m=!0;for(d=0;d<e._howls.length;d++)if(e._howls[d]._src===l._src||l._src.indexOf(e._howls[d]._src)>=0){m=!1;break}return n&&m&&delete n[l._src],e.noAudio=!1,l._state="unloaded",l._sounds=[],l=null,null},on:function(l,_,d,g){var m=this,p=m["_on"+l];return typeof _=="function"&&p.push(g?{id:d,fn:_,once:g}:{id:d,fn:_}),m},off:function(l,_,d){var g=this,m=g["_on"+l],p=0;if(typeof _=="number"&&(d=_,_=null),_||d)for(p=0;p<m.length;p++){var T=d===m[p].id;if(_===m[p].fn&&T||!_&&T){m.splice(p,1);break}}else if(l)g["_on"+l]=[];else{var A=Object.keys(g);for(p=0;p<A.length;p++)A[p].indexOf("_on")===0&&Array.isArray(g[A[p]])&&(g[A[p]]=[])}return g},once:function(l,_,d){var g=this;return g.on(l,_,d,1),g},_emit:function(l,_,d){for(var g=this,m=g["_on"+l],p=m.length-1;p>=0;p--)(!m[p].id||m[p].id===_||l==="load")&&(setTimeout(function(T){T.call(this,_,d)}.bind(g,m[p].fn),0),m[p].once&&g.off(l,m[p].fn,m[p].id));return g._loadQueue(l),g},_loadQueue:function(l){var _=this;if(_._queue.length>0){var d=_._queue[0];d.event===l&&(_._queue.shift(),_._loadQueue()),l||d.action()}return _},_ended:function(l){var _=this,d=l._sprite;if(!_._webAudio&&l._node&&!l._node.paused&&!l._node.ended&&l._node.currentTime<l._stop)return setTimeout(_._ended.bind(_,l),100),_;var g=!!(l._loop||_._sprite[d][2]);if(_._emit("end",l._id),!_._webAudio&&g&&_.stop(l._id,!0).play(l._id),_._webAudio&&g){_._emit("play",l._id),l._seek=l._start||0,l._rateSeek=0,l._playStart=e.ctx.currentTime;var m=(l._stop-l._start)*1e3/Math.abs(l._rate);_._endTimers[l._id]=setTimeout(_._ended.bind(_,l),m)}return _._webAudio&&!g&&(l._paused=!0,l._ended=!0,l._seek=l._start||0,l._rateSeek=0,_._clearTimer(l._id),_._cleanBuffer(l._node),e._autoSuspend()),!_._webAudio&&!g&&_.stop(l._id,!0),_},_clearTimer:function(l){var _=this;if(_._endTimers[l]){if(typeof _._endTimers[l]!="function")clearTimeout(_._endTimers[l]);else{var d=_._soundById(l);d&&d._node&&d._node.removeEventListener("ended",_._endTimers[l],!1)}delete _._endTimers[l]}return _},_soundById:function(l){for(var _=this,d=0;d<_._sounds.length;d++)if(l===_._sounds[d]._id)return _._sounds[d];return null},_inactiveSound:function(){var l=this;l._drain();for(var _=0;_<l._sounds.length;_++)if(l._sounds[_]._ended)return l._sounds[_].reset();return new r(l)},_drain:function(){var l=this,_=l._pool,d=0,g=0;if(!(l._sounds.length<_)){for(g=0;g<l._sounds.length;g++)l._sounds[g]._ended&&d++;for(g=l._sounds.length-1;g>=0;g--){if(d<=_)return;l._sounds[g]._ended&&(l._webAudio&&l._sounds[g]._node&&l._sounds[g]._node.disconnect(0),l._sounds.splice(g,1),d--)}}},_getSoundIds:function(l){var _=this;if(typeof l>"u"){for(var d=[],g=0;g<_._sounds.length;g++)d.push(_._sounds[g]._id);return d}else return[l]},_refreshBuffer:function(l){var _=this;return l._node.bufferSource=e.ctx.createBufferSource(),l._node.bufferSource.buffer=n[_._src],l._panner?l._node.bufferSource.connect(l._panner):l._node.bufferSource.connect(l._node),l._node.bufferSource.loop=l._loop,l._loop&&(l._node.bufferSource.loopStart=l._start||0,l._node.bufferSource.loopEnd=l._stop||0),l._node.bufferSource.playbackRate.setValueAtTime(l._rate,e.ctx.currentTime),_},_cleanBuffer:function(l){var _=this,d=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(e._scratchBuffer&&l.bufferSource&&(l.bufferSource.onended=null,l.bufferSource.disconnect(0),d))try{l.bufferSource.buffer=e._scratchBuffer}catch{}return l.bufferSource=null,_},_clearSound:function(l){var _=/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent);_||(l.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(l){this._parent=l,this.init()};r.prototype={init:function(){var l=this,_=l._parent;return l._muted=_._muted,l._loop=_._loop,l._volume=_._volume,l._rate=_._rate,l._seek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++e._counter,_._sounds.push(l),l.create(),l},create:function(){var l=this,_=l._parent,d=e._muted||l._muted||l._parent._muted?0:l._volume;return _._webAudio?(l._node=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),l._node.gain.setValueAtTime(d,e.ctx.currentTime),l._node.paused=!0,l._node.connect(e.masterGain)):e.noAudio||(l._node=e._obtainHtml5Audio(),l._errorFn=l._errorListener.bind(l),l._node.addEventListener("error",l._errorFn,!1),l._loadFn=l._loadListener.bind(l),l._node.addEventListener(e._canPlayEvent,l._loadFn,!1),l._endFn=l._endListener.bind(l),l._node.addEventListener("ended",l._endFn,!1),l._node.src=_._src,l._node.preload=_._preload===!0?"auto":_._preload,l._node.volume=d*e.volume(),l._node.load()),l},reset:function(){var l=this,_=l._parent;return l._muted=_._muted,l._loop=_._loop,l._volume=_._volume,l._rate=_._rate,l._seek=0,l._rateSeek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++e._counter,l},_errorListener:function(){var l=this;l._parent._emit("loaderror",l._id,l._node.error?l._node.error.code:0),l._node.removeEventListener("error",l._errorFn,!1)},_loadListener:function(){var l=this,_=l._parent;_._duration=Math.ceil(l._node.duration*10)/10,Object.keys(_._sprite).length===0&&(_._sprite={__default:[0,_._duration*1e3]}),_._state!=="loaded"&&(_._state="loaded",_._emit("load"),_._loadQueue()),l._node.removeEventListener(e._canPlayEvent,l._loadFn,!1)},_endListener:function(){var l=this,_=l._parent;_._duration===1/0&&(_._duration=Math.ceil(l._node.duration*10)/10,_._sprite.__default[1]===1/0&&(_._sprite.__default[1]=_._duration*1e3),_._ended(l)),l._node.removeEventListener("ended",l._endFn,!1)}};var n={},a=function(l){var _=l._src;if(n[_]){l._duration=n[_].duration,u(l);return}if(/^data:[^;]+;base64,/.test(_)){for(var d=atob(_.split(",")[1]),g=new Uint8Array(d.length),m=0;m<d.length;++m)g[m]=d.charCodeAt(m);h(g.buffer,l)}else{var p=new XMLHttpRequest;p.open(l._xhr.method,_,!0),p.withCredentials=l._xhr.withCredentials,p.responseType="arraybuffer",l._xhr.headers&&Object.keys(l._xhr.headers).forEach(function(T){p.setRequestHeader(T,l._xhr.headers[T])}),p.onload=function(){var T=(p.status+"")[0];if(T!=="0"&&T!=="2"&&T!=="3"){l._emit("loaderror",null,"Failed loading audio file with status: "+p.status+".");return}h(p.response,l)},p.onerror=function(){l._webAudio&&(l._html5=!0,l._webAudio=!1,l._sounds=[],delete n[_],l.load())},o(p)}},o=function(l){try{l.send()}catch{l.onerror()}},h=function(l,_){var d=function(){_._emit("loaderror",null,"Decoding audio data failed.")},g=function(m){m&&_._sounds.length>0?(n[_._src]=m,u(_,m)):d()};typeof Promise<"u"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(l).then(g).catch(d):e.ctx.decodeAudioData(l,g,d)},u=function(l,_){_&&!l._duration&&(l._duration=_.duration),Object.keys(l._sprite).length===0&&(l._sprite={__default:[0,l._duration*1e3]}),l._state!=="loaded"&&(l._state="loaded",l._emit("load"),l._loadQueue())},c=function(){if(e.usingWebAudio){try{typeof AudioContext<"u"?e.ctx=new AudioContext:typeof webkitAudioContext<"u"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var l=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),_=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),d=_?parseInt(_[1],10):null;if(l&&d&&d<9){var g=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!g&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};s.Howler=e,s.Howl=i,typeof Er<"u"?(Er.HowlerGlobal=t,Er.Howler=e,Er.Howl=i,Er.Sound=r):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=i,window.Sound=r)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var i=this;if(!i.ctx||!i.ctx.listener)return i;for(var r=i._howls.length-1;r>=0;r--)i._howls[r].stereo(e);return i},HowlerGlobal.prototype.pos=function(e,i,r){var n=this;if(!n.ctx||!n.ctx.listener)return n;if(i=typeof i!="number"?n._pos[1]:i,r=typeof r!="number"?n._pos[2]:r,typeof e=="number")n._pos=[e,i,r],typeof n.ctx.listener.positionX<"u"?(n.ctx.listener.positionX.setTargetAtTime(n._pos[0],Howler.ctx.currentTime,.1),n.ctx.listener.positionY.setTargetAtTime(n._pos[1],Howler.ctx.currentTime,.1),n.ctx.listener.positionZ.setTargetAtTime(n._pos[2],Howler.ctx.currentTime,.1)):n.ctx.listener.setPosition(n._pos[0],n._pos[1],n._pos[2]);else return n._pos;return n},HowlerGlobal.prototype.orientation=function(e,i,r,n,a,o){var h=this;if(!h.ctx||!h.ctx.listener)return h;var u=h._orientation;if(i=typeof i!="number"?u[1]:i,r=typeof r!="number"?u[2]:r,n=typeof n!="number"?u[3]:n,a=typeof a!="number"?u[4]:a,o=typeof o!="number"?u[5]:o,typeof e=="number")h._orientation=[e,i,r,n,a,o],typeof h.ctx.listener.forwardX<"u"?(h.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),h.ctx.listener.forwardY.setTargetAtTime(i,Howler.ctx.currentTime,.1),h.ctx.listener.forwardZ.setTargetAtTime(r,Howler.ctx.currentTime,.1),h.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),h.ctx.listener.upY.setTargetAtTime(a,Howler.ctx.currentTime,.1),h.ctx.listener.upZ.setTargetAtTime(o,Howler.ctx.currentTime,.1)):h.ctx.listener.setOrientation(e,i,r,n,a,o);else return u;return h},Howl.prototype.init=function(e){return function(i){var r=this;return r._orientation=i.orientation||[1,0,0],r._stereo=i.stereo||null,r._pos=i.pos||null,r._pannerAttr={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:360,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:360,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:0,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:"inverse",maxDistance:typeof i.maxDistance<"u"?i.maxDistance:1e4,panningModel:typeof i.panningModel<"u"?i.panningModel:"HRTF",refDistance:typeof i.refDistance<"u"?i.refDistance:1,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:1},r._onstereo=i.onstereo?[{fn:i.onstereo}]:[],r._onpos=i.onpos?[{fn:i.onpos}]:[],r._onorientation=i.onorientation?[{fn:i.onorientation}]:[],e.call(this,i)}}(Howl.prototype.init),Howl.prototype.stereo=function(e,i){var r=this;if(!r._webAudio)return r;if(r._state!=="loaded")return r._queue.push({event:"stereo",action:function(){r.stereo(e,i)}}),r;var n=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof i>"u")if(typeof e=="number")r._stereo=e,r._pos=[e,0,0];else return r._stereo;for(var a=r._getSoundIds(i),o=0;o<a.length;o++){var h=r._soundById(a[o]);if(h)if(typeof e=="number")h._stereo=e,h._pos=[e,0,0],h._node&&(h._pannerAttr.panningModel="equalpower",(!h._panner||!h._panner.pan)&&t(h,n),n==="spatial"?typeof h._panner.positionX<"u"?(h._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):h._panner.setPosition(e,0,0):h._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),r._emit("stereo",h._id);else return h._stereo}return r},Howl.prototype.pos=function(e,i,r,n){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"pos",action:function(){a.pos(e,i,r,n)}}),a;if(i=typeof i!="number"?0:i,r=typeof r!="number"?-.5:r,typeof n>"u")if(typeof e=="number")a._pos=[e,i,r];else return a._pos;for(var o=a._getSoundIds(n),h=0;h<o.length;h++){var u=a._soundById(o[h]);if(u)if(typeof e=="number")u._pos=[e,i,r],u._node&&((!u._panner||u._panner.pan)&&t(u,"spatial"),typeof u._panner.positionX<"u"?(u._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),u._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),u._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):u._panner.setPosition(e,i,r)),a._emit("pos",u._id);else return u._pos}return a},Howl.prototype.orientation=function(e,i,r,n){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"orientation",action:function(){a.orientation(e,i,r,n)}}),a;if(i=typeof i!="number"?a._orientation[1]:i,r=typeof r!="number"?a._orientation[2]:r,typeof n>"u")if(typeof e=="number")a._orientation=[e,i,r];else return a._orientation;for(var o=a._getSoundIds(n),h=0;h<o.length;h++){var u=a._soundById(o[h]);if(u)if(typeof e=="number")u._orientation=[e,i,r],u._node&&(u._panner||(u._pos||(u._pos=a._pos||[0,0,-.5]),t(u,"spatial")),typeof u._panner.orientationX<"u"?(u._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),u._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),u._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):u._panner.setOrientation(e,i,r)),a._emit("orientation",u._id);else return u._orientation}return a},Howl.prototype.pannerAttr=function(){var e=this,i=arguments,r,n,a;if(!e._webAudio)return e;if(i.length===0)return e._pannerAttr;if(i.length===1)if(typeof i[0]=="object")r=i[0],typeof n>"u"&&(r.pannerAttr||(r.pannerAttr={coneInnerAngle:r.coneInnerAngle,coneOuterAngle:r.coneOuterAngle,coneOuterGain:r.coneOuterGain,distanceModel:r.distanceModel,maxDistance:r.maxDistance,refDistance:r.refDistance,rolloffFactor:r.rolloffFactor,panningModel:r.panningModel}),e._pannerAttr={coneInnerAngle:typeof r.pannerAttr.coneInnerAngle<"u"?r.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:typeof r.pannerAttr.coneOuterAngle<"u"?r.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:typeof r.pannerAttr.coneOuterGain<"u"?r.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:typeof r.pannerAttr.distanceModel<"u"?r.pannerAttr.distanceModel:e._distanceModel,maxDistance:typeof r.pannerAttr.maxDistance<"u"?r.pannerAttr.maxDistance:e._maxDistance,refDistance:typeof r.pannerAttr.refDistance<"u"?r.pannerAttr.refDistance:e._refDistance,rolloffFactor:typeof r.pannerAttr.rolloffFactor<"u"?r.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:typeof r.pannerAttr.panningModel<"u"?r.pannerAttr.panningModel:e._panningModel});else return a=e._soundById(parseInt(i[0],10)),a?a._pannerAttr:e._pannerAttr;else i.length===2&&(r=i[0],n=parseInt(i[1],10));for(var o=e._getSoundIds(n),h=0;h<o.length;h++)if(a=e._soundById(o[h]),a){var u=a._pannerAttr;u={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:u.coneInnerAngle,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:u.coneOuterAngle,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:u.coneOuterGain,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:u.distanceModel,maxDistance:typeof r.maxDistance<"u"?r.maxDistance:u.maxDistance,refDistance:typeof r.refDistance<"u"?r.refDistance:u.refDistance,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:u.rolloffFactor,panningModel:typeof r.panningModel<"u"?r.panningModel:u.panningModel};var c=a._panner;c?(c.coneInnerAngle=u.coneInnerAngle,c.coneOuterAngle=u.coneOuterAngle,c.coneOuterGain=u.coneOuterGain,c.distanceModel=u.distanceModel,c.maxDistance=u.maxDistance,c.refDistance=u.refDistance,c.rolloffFactor=u.rolloffFactor,c.panningModel=u.panningModel):(a._pos||(a._pos=e._pos||[0,0,-.5]),t(a,"spatial"))}return e},Sound.prototype.init=function(e){return function(){var i=this,r=i._parent;i._orientation=r._orientation,i._stereo=r._stereo,i._pos=r._pos,i._pannerAttr=r._pannerAttr,e.call(this),i._stereo?r.stereo(i._stereo):i._pos&&r.pos(i._pos[0],i._pos[1],i._pos[2],i._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var i=this,r=i._parent;return i._orientation=r._orientation,i._stereo=r._stereo,i._pos=r._pos,i._pannerAttr=r._pannerAttr,i._stereo?r.stereo(i._stereo):i._pos?r.pos(i._pos[0],i._pos[1],i._pos[2],i._id):i._panner&&(i._panner.disconnect(0),i._panner=void 0,r._refreshBuffer(i)),e.call(this)}}(Sound.prototype.reset);var t=function(e,i){i=i||"spatial",i==="spatial"?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX<"u"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX<"u"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}})()})(ln);class Pq{constructor(t){this._sampleUrl=t,this._isPlaying=!1,this._startPos=0,this._currentPos=0,this._playLength=0,this._sequence=[],this._cache=new Map}async play(t,e,i=0,r=-1){this.reset(),this._currentSong=new af(t),this._startPos=Math.trunc(i),this._playLength=r,this._currentPos=this._startPos,this._currentSongId=e,await this.preload(),this._isPlaying=!0,this.tick(),this._tickerInterval=window.setInterval(()=>this.tick(),1e3)}reset(){this._isPlaying=!1,window.clearInterval(this._tickerInterval),ln.Howler.stop(),this._currentSongId=-1,this._currentSong=void 0,this._tickerInterval=void 0,this._startPos=0,this._playLength=0,this._sequence=[],this._currentPos=0}pause(){this._isPlaying=!1,ln.Howler.stop()}resume(){this._isPlaying=!0}stop(){const t=this._currentSongId;this.reset(),K.instance.soundManager.events.dispatchEvent(new rh(rh.TRAX_SONG_COMPLETE,t))}setVolume(t){ln.Howler.volume(t)}getVolume(){return ln.Howler.volume()}async getSample(t){let e=this._cache.get(t);return e||(e=await this.loadSong(t)),Promise.resolve(e)}async preload(){if(this._sequence=[],!!this._currentSong){for(const t of this._currentSong.channels){const e=[];for(const i of t.items){const r=await this.getSample(i.id),n=Math.ceil(i.length*2/Math.ceil(r.duration()));for(let a=0;a<n;a++)for(let o=0;o<Math.ceil(r.duration());o++)e.push({sampleId:i.id,offset:o})}this._sequence.push(e)}this._playLength<=0&&(this._playLength=Math.max(...this._sequence.map(t=>t.length)))}}async preloadSamplesForSong(t){const e=new af(t);await Promise.all(e.getSampleIds().map(i=>this.getSample(i)))}async loadSong(t){return new Promise((e,i)=>{const r=new ln.Howl({src:[this._sampleUrl.replace("%sample%",t.toString())],preload:!0});r.once("load",()=>{this._cache.set(t,r),e(r)}),r.once("loaderror",()=>{Y.error("failed to load sample "+t),i("failed to load sample "+t)})})}tick(){this._currentPos>this._playLength-1&&this.stop(),this._isPlaying&&(this._currentSong&&this.playPosition(this._currentPos),this._currentPos++)}playPosition(t){if(!(!this._currentSong||!this._sequence)&&ln.Howler._audioUnlocked)for(const e of this._sequence){const i=e[t];if(!i||i.sampleId===-1||i.sampleId===0)continue;const r=this._cache.get(i.sampleId);r&&(i.offset===0?r.play():r.playing()||(r.seek(i.offset),r.play()))}}}const Lu=class{constructor(){this._priorityPlaying=-1,this._requestNumberPlaying=-1,this._previousNotificationTime=-1,this._timerInstance=-1,this._songRequestList=[],this._requestedSongs=new Map,this._availableSongs=new Map,this._songDiskInventory=new Ee,this._songRequestsPerPriority=[],this._songRequestCountsPerPriority=[],this._diskInventoryMissingData=[],this._songIdPlaying=-1,this._previousNotifiedSongId=-1,this._messageEvents=[new dR(this.onTraxSongInfoMessageEvent.bind(this)),new fR(this.onSongDiskInventoryMessage.bind(this))],this.onJukeboxInit=this.onJukeboxInit.bind(this),this.onJukeboxDispose=this.onJukeboxDispose.bind(this),this.onSoundMachineInit=this.onSoundMachineInit.bind(this),this.onSoundMachineDispose=this.onSoundMachineDispose.bind(this),this.onTraxSongComplete=this.onTraxSongComplete.bind(this)}init(){this._timerInstance=window.setInterval(this.onTick.bind(this),1e3),this._musicPlayer=new Pq(K.instance.getConfiguration("external.samples.url")),this._messageEvents.forEach(s=>K.instance.communication.connection.addMessageEvent(s)),K.instance.roomEngine.events.addEventListener(xt.JUKEBOX_INIT,this.onJukeboxInit),K.instance.roomEngine.events.addEventListener(xt.JUKEBOX_DISPOSE,this.onJukeboxDispose),K.instance.roomEngine.events.addEventListener(xt.SOUND_MACHINE_INIT,this.onSoundMachineInit),K.instance.roomEngine.events.addEventListener(xt.SOUND_MACHINE_DISPOSE,this.onSoundMachineDispose),K.instance.soundManager.events.addEventListener(rh.TRAX_SONG_COMPLETE,this.onTraxSongComplete)}getRoomItemPlaylist(s){return this._roomItemPlaylist}get songDiskInventory(){return this._songDiskInventory}getSongDiskInventorySize(){return this._songDiskInventory.length}getSongDiskInventoryDiskId(s){return s>=0&&s<this._songDiskInventory.length?this._songDiskInventory.getKey(s):-1}getSongDiskInventorySongId(s){return s>=0&&s<this._songDiskInventory.length?this._songDiskInventory.getWithIndex(s):-1}getSongInfo(s){const t=this.getSongDataEntry(s);return t||this.requestSongInfoWithoutSamples(s),t}getSongIdPlayingAtPriority(s){return s!==this._priorityPlaying?-1:this._songIdPlaying}stop(s){const t=s===this._priorityPlaying,e=this.getTopRequestPriority()===s;t?(this.resetSongStartRequest(s),this.stopSongAtPriority(s)):(this.resetSongStartRequest(s),e&&this.reRequestSongAtPriority(this._priorityPlaying))}addSongInfoRequest(s){this.requestSong(s,!0)}requestSongInfoWithoutSamples(s){this.requestSong(s,!1)}requestUserSongDisks(){K.instance.communication.connection.send(new zO)}updateVolume(s){this._musicPlayer.setVolume(s)}dispose(){this._timerInstance&&(clearInterval(this._timerInstance),this._timerInstance=void 0),this._messageEvents.forEach(s=>K.instance.communication.connection.removeMessageEvent(s)),K.instance.roomEngine.events.removeEventListener(xt.JUKEBOX_INIT,this.onJukeboxInit),K.instance.roomEngine.events.removeEventListener(xt.JUKEBOX_DISPOSE,this.onJukeboxDispose),K.instance.roomEngine.events.removeEventListener(xt.SOUND_MACHINE_INIT,this.onSoundMachineInit),K.instance.roomEngine.events.removeEventListener(xt.SOUND_MACHINE_DISPOSE,this.onSoundMachineDispose),K.instance.soundManager.events.removeEventListener(rh.TRAX_SONG_COMPLETE,this.onTraxSongComplete)}get samplesIdsInUse(){let s,t,e=[];for(let i=0;i<this._songRequestsPerPriority.length;i++)if(this._songRequestsPerPriority[i]&&(s=this._songRequestsPerPriority[i],t=this._availableSongs.get(s.songId),t)){const r=t.songData;if(r.length>0){const n=new af(r);e=e.concat(n.getSampleIds())}}return e}onSongLoaded(s){const t=this.getTopRequestPriority();if(t>=0){const e=this.getSongIdRequestedAtPriority(t);s===e&&this.playSongObject(t,s)}}samplesUnloaded(s){throw new Error("Method not implemented.")}onTraxSongComplete(s){if(this.getSongIdPlayingAtPriority(this._priorityPlaying)===s.id){this.getTopRequestPriority()===this._priorityPlaying&&this.getSongRequestCountAtPriority(this._priorityPlaying)==this._requestNumberPlaying&&this.resetSongStartRequest(this._priorityPlaying);const t=this._priorityPlaying;this.playSongWithHighestPriority(),t>=Ye.PRIORITY_SONG_PLAY&&K.instance.soundManager.events.dispatchEvent(new Ki(Ki.NPW_USER_STOP_SONG,t,s.id,-1))}}onTraxSongInfoMessageEvent(s){const t=s.getParser();for(const e of t.songs){const i=!!this.getSongDataEntry(e.id);if(this.areSamplesRequested(e.id),!i){const r=new uv(e.id,e.length,e.name,e.creator,e.data);this._availableSongs.set(e.id,r);const n=this.getTopRequestPriority(),a=this.getSongIdRequestedAtPriority(n);for(e.id===a&&this.playSongObject(n,a),K.instance.soundManager.events.dispatchEvent(new ih(ih.SIR_TRAX_SONG_INFO_RECEIVED,e.id));this._diskInventoryMissingData.indexOf(e.id)!=-1;)this._diskInventoryMissingData.splice(this._diskInventoryMissingData.indexOf(e.id),1),this._diskInventoryMissingData.length===0&&K.instance.soundManager.events.dispatchEvent(new So(So.SDIR_SONG_DISK_INVENTORY_RECEIVENT_EVENT))}}}onSongDiskInventoryMessage(s){const t=s.getParser();this._songDiskInventory.reset();for(let e=0;e<t.songDiskCount;e++){const i=t.getDiskId(e),r=t.getSongId(e);this._songDiskInventory.add(i,r),this._availableSongs.get(r)||(this._diskInventoryMissingData.push(r),this.requestSongInfoWithoutSamples(r))}this._diskInventoryMissingData.length===0&&K.instance.soundManager.events.dispatchEvent(new So(So.SDIR_SONG_DISK_INVENTORY_RECEIVENT_EVENT))}onTick(){this._songRequestList.length!==0&&(K.instance.communication.connection.send(new jO(...this._songRequestList)),this._songRequestList=[])}requestSong(s,t){this._requestedSongs.get(s)===void 0&&(this._requestedSongs.set(s,t),this._songRequestList.push(s))}areSamplesRequested(s){return this._requestedSongs.get(s)?this._requestedSongs.get(s):!1}processSongEntryForPlaying(s,t=!0){return this.getSongDataEntry(s)?!0:(this.addSongInfoRequest(s),!1)}playSong(s,t,e=0,i=0,r=.5,n=.5){return!this.addSongStartRequest(t,s,e,i,r,n)||!this.processSongEntryForPlaying(s)?!1:(t>=this._priorityPlaying&&this.playSongObject(t,s),!0)}playSongObject(s,t){if(t===-1||s<0||s>=Ye.PRIORITY_COUNT)return!1;let e=!1;this.stopSongAtPriority(this._priorityPlaying)&&(e=!0);const i=this.getSongDataEntry(t);if(!i)return!1;if(e)return!0;this._musicPlayer.setVolume(K.instance.soundManager.traxVolume);let r=Lu.SKIP_POSITION_SET,n=0;const a=this.getSongStartRequest(s);return a&&(r=a.startPos,n=a.playLength,a.fadeInSeconds,a.fadeOutSeconds),r>=i.length/1e3?!1:(r<=Lu.SKIP_POSITION_SET&&(r=0),r=Math.trunc(r),this._priorityPlaying=s,this._requestNumberPlaying=this.getSongRequestCountAtPriority(s),this._songIdPlaying=t,this._priorityPlaying<=Lu.MAXIMUM_NOTIFY_PRIORITY&&this.notifySongPlaying(i),this._musicPlayer.preloadSamplesForSong(i.songData).then(()=>this._musicPlayer.play(i.songData,i.id,r,n)),s>Ye.PRIORITY_ROOM_PLAYLIST&&K.instance.soundManager.events.dispatchEvent(new Ki(Ki.NPE_USER_PLAY_SONG,s,i.id,-1)),!0)}notifySongPlaying(s){const e=Date.now();s.length>=8e3&&(this._previousNotifiedSongId!=s.id||e>this._previousNotificationTime+8e3)&&(K.instance.soundManager.events.dispatchEvent(new _v(s.name,s.creator)),this._previousNotifiedSongId=s.id,this._previousNotificationTime=e)}addSongStartRequest(s,t,e,i,r,n){if(s<0||s>=Ye.PRIORITY_COUNT)return!1;const a=new yq(t,e,i,r,n);return this._songRequestsPerPriority[s]=a,this._songRequestCountsPerPriority[s]=this._songRequestCountsPerPriority[s]+1,!0}getSongDataEntry(s){let t;return this._availableSongs&&(t=this._availableSongs.get(s)),t}getSongStartRequest(s){return this._songRequestsPerPriority[s]}getTopRequestPriority(){return this._songRequestsPerPriority.length-1}getSongIdRequestedAtPriority(s){return s<0||s>=Ye.PRIORITY_COUNT||!this._songRequestsPerPriority[s]?-1:this._songRequestsPerPriority[s].songId}getSongRequestCountAtPriority(s){return s<0||s>=Ye.PRIORITY_COUNT?-1:this._songRequestCountsPerPriority[s]}playSongWithHighestPriority(){let s;this._priorityPlaying=-1,this._songIdPlaying=-1,this._requestNumberPlaying=-1;let e=this.getTopRequestPriority();for(;e>=0;){if(s=this.getSongIdRequestedAtPriority(e),s>=0&&this.playSongObject(e,s))return;e--}}resetSongStartRequest(s){s>=0&&s<Ye.PRIORITY_COUNT&&(this._songRequestsPerPriority[s]=void 0)}reRequestSongAtPriority(s){this._songRequestCountsPerPriority[s]=this._songRequestCountsPerPriority[s]+1}stopSongAtPriority(s){if(s===this._priorityPlaying&&this._priorityPlaying>=0){const t=this.getSongIdPlayingAtPriority(s);if(t>=0)return this.getSongDataEntry(t),this._musicPlayer.stop(),!0}return!1}onSoundMachineInit(s){this.disposeRoomPlaylist()}onSoundMachineDispose(s){this.disposeRoomPlaylist()}onJukeboxInit(s){this.disposeRoomPlaylist(),this._roomItemPlaylist=new Cq,this._roomItemPlaylist.init(),K.instance.communication.connection.send(new kO)}onJukeboxDispose(s){this.disposeRoomPlaylist()}disposeRoomPlaylist(){this._roomItemPlaylist&&(this._roomItemPlaylist.dispose(),this._roomItemPlaylist=void 0)}};let gg=Lu;gg.SKIP_POSITION_SET=-1;gg.MAXIMUM_NOTIFY_PRIORITY=Ye.PRIORITY_ROOM_PLAYLIST;class bq extends mi{constructor(){super(),this._volumeSystem=.5,this._volumeFurni=.5,this._volumeTrax=.5,this._internalSamples=new Ee,this._furniSamples=new Ee,this._furnitureBeingPlayed=new Ee,this._musicController=new gg,this.onEvent=this.onEvent.bind(this)}onInit(){this._musicController.init(),K.instance.roomEngine.events.addEventListener($e.PLAY_SAMPLE,this.onEvent),K.instance.roomEngine.events.addEventListener(Q.REMOVED,this.onEvent),K.instance.roomEngine.events.addEventListener(Mt.DISPOSED,this.onEvent),K.instance.events.addEventListener(Ra.SETTINGS_UPDATED,this.onEvent),K.instance.events.addEventListener(Iu.PLAY_SOUND,this.onEvent)}onDispose(){this._musicController&&(this._musicController.dispose(),this._musicController=null),K.instance.roomEngine.events.removeEventListener($e.PLAY_SAMPLE,this.onEvent),K.instance.roomEngine.events.removeEventListener(Q.REMOVED,this.onEvent),K.instance.roomEngine.events.removeEventListener(Mt.DISPOSED,this.onEvent),K.instance.events.removeEventListener(Ra.SETTINGS_UPDATED,this.onEvent),K.instance.events.removeEventListener(Iu.PLAY_SOUND,this.onEvent)}onEvent(t){var e;switch(t.type){case $e.PLAY_SAMPLE:{const i=t;this.playFurniSample(i.objectId,i.sampleId,i.pitch);return}case Q.REMOVED:{const i=t;this.stopFurniSample(i.objectId);return}case Mt.DISPOSED:{this._furnitureBeingPlayed.getKeys().forEach(i=>{this.stopFurniSample(i)});return}case Ra.SETTINGS_UPDATED:{const i=t,r=i.volumeFurni!==this._volumeFurni,n=i.volumeTrax!==this._volumeTrax;this._volumeSystem=i.volumeSystem/100,this._volumeFurni=i.volumeFurni/100,this._volumeTrax=i.volumeTrax/100,r&&this.updateFurniSamplesVolume(this._volumeFurni),n&&((e=this._musicController)==null||e.updateVolume(this._volumeTrax));return}case Iu.PLAY_SOUND:{const i=t;this.playInternalSample(i.sampleCode);return}}}playSample(t,e,i=1){t.volume=e,t.currentTime=0;try{t.play()}catch(r){Y.error(r)}}playInternalSample(t){let e=this._internalSamples.getValue(t);if(!e){const i=rt.getValue("sounds.url");e=new Audio(i.replace("%sample%",t)),this._internalSamples.add(t,e)}this.playSample(e,this._volumeSystem)}playFurniSample(t,e,i){let r=this._furniSamples.getValue(e);if(!r){const n=rt.getValue("external.samples.url");r=new Audio(n.replace("%sample%",e.toString())),this._furniSamples.add(e,r)}this._furnitureBeingPlayed.hasKey(t)||this._furnitureBeingPlayed.add(t,e),r.onended=n=>{this.stopFurniSample(t)},r.onpause=n=>{this.stopFurniSample(t)},r.onerror=n=>{this.stopFurniSample(t)},this.playSample(r,this._volumeFurni,i)}stopInternalSample(t){const e=this._internalSamples.getValue(t);if(e)try{e.pause()}catch(i){Y.error(i)}}stopFurniSample(t){const e=this._furnitureBeingPlayed.getValue(t);if(!e)return;const i=this._furniSamples.getValue(e);if(this._furnitureBeingPlayed.remove(t),!!i)try{i.pause()}catch(r){Y.error(r)}}updateInternalSamplesVolume(t){this._internalSamples.getValues().forEach(e=>{e.volume=t})}updateFurniSamplesVolume(t){this._furniSamples.getValues().forEach(e=>{e.volume=t})}get traxVolume(){return this._volumeTrax}get musicController(){return this._musicController}}mt.available;Z.SCALE_MODE=window.devicePixelRatio%1?hs.LINEAR:hs.NEAREST;Z.ROUND_PIXELS=!0;Z.GC_MAX_IDLE=120;const _n=class{constructor(s,t){_n.INSTANCE||(_n.INSTANCE=this),this._application=new Ae(t),this._core=s,this._events=new Rs,this._communication=new pK(s.communication),this._localization=new IK(this._communication),this._avatar=new Ev,this._roomEngine=new Os(this._communication),this._sessionDataManager=new Sq(this._communication),this._roomSessionManager=new vq(this._communication,this._roomEngine),this._roomManager=new Gn(this._roomEngine,this._roomEngine.visualizationFactory,this._roomEngine.logicFactory),this._cameraManager=new uL,this._soundManager=new bq,this._linkTrackers=[],this._isReady=!1,this._isDisposed=!1,this._core.configuration.events.addEventListener(Tr.LOADED,this.onConfigurationLoadedEvent.bind(this)),this._roomEngine.events.addEventListener(Mt.ENGINE_INITIALIZED,this.onRoomEngineReady.bind(this))}static bootstrap(){_n.INSTANCE&&(_n.INSTANCE.dispose(),_n.INSTANCE=null);const s=document.createElement("canvas"),t=new this(new pD,{autoDensity:!1,width:window.innerWidth,height:window.innerHeight,resolution:window.devicePixelRatio,view:s});s.addEventListener("webglcontextlost",()=>t.events.dispatchEvent(new Rt(_n.WEBGL_CONTEXT_LOST)))}init(){if(!(this._isReady||this._isDisposed)){if(this._avatar&&this._avatar.init(),this._soundManager&&this._soundManager.init(),this._roomEngine&&(this._roomEngine.sessionDataManager=this._sessionDataManager,this._roomEngine.roomSessionManager=this._roomSessionManager,this._roomEngine.roomManager=this._roomManager,this._sessionDataManager&&this._sessionDataManager.init(),this._roomSessionManager&&this._roomSessionManager.init(),this._roomEngine.init()),!this._communication.connection)throw new Error("No connection found");new mK(this._communication.connection),this._isReady=!0}}dispose(){this._isDisposed||(this._roomManager&&(this._roomManager.dispose(),this._roomManager=null),this._roomSessionManager&&(this._roomSessionManager.dispose(),this._roomSessionManager=null),this._sessionDataManager&&(this._sessionDataManager.dispose(),this._sessionDataManager=null),this._roomEngine&&(this._roomEngine.dispose(),this._roomEngine=null),this._avatar&&(this._avatar.dispose(),this._avatar=null),this._soundManager&&(this._soundManager.dispose(),this._soundManager=null),this._communication&&(this._communication.dispose(),this._communication=null),this._application&&(this._application.destroy(),this._application=null),this._isDisposed=!0,this._isReady=!1)}onConfigurationLoadedEvent(s){Bi().maxFPS=rt.getValue("system.fps.max",24),Y.LOG_DEBUG=rt.getValue("system.log.debug",!0),Y.LOG_WARN=rt.getValue("system.log.warn",!1),Y.LOG_ERROR=rt.getValue("system.log.error",!1),Y.LOG_EVENTS=rt.getValue("system.log.events",!1),Y.LOG_PACKETS=rt.getValue("system.log.packets",!1),xh.LANDSCAPES_ENABLED=rt.getValue("room.landscapes.enabled",!0)}onRoomEngineReady(s){this.startSendingHeartBeat()}getConfiguration(s,t=null){return rt.getValue(s,t)}getLocalization(s){return this._localization.getValue(s)}getLocalizationWithParameter(s,t,e){return this._localization.getValueWithParameter(s,t,e)}getLocalizationWithParameters(s,t,e){return this._localization.getValueWithParameters(s,t,e)}addLinkEventTracker(s){this._linkTrackers.indexOf(s)>=0||this._linkTrackers.push(s)}removeLinkEventTracker(s){const t=this._linkTrackers.indexOf(s);t!==-1&&this._linkTrackers.splice(t,1)}createLinkEvent(s){if(!(!s||s===""))for(const t of this._linkTrackers){if(!t)continue;const e=t.eventUrlPrefix;e.length>0?s.substr(0,e.length)===e&&t.linkReceived(s):t.linkReceived(s)}}startSendingHeartBeat(){this.sendHeartBeat(),setInterval(this.sendHeartBeat,1e4)}sendHeartBeat(){Ln.sendHeartBeat()}get application(){return this._application}get core(){return this._core}get events(){return this._events}get localization(){return this._localization}get communication(){return this._communication}get avatar(){return this._avatar}get roomEngine(){return this._roomEngine}get sessionDataManager(){return this._sessionDataManager}get roomSessionManager(){return this._roomSessionManager}get roomManager(){return this._roomManager}get cameraManager(){return this._cameraManager}get soundManager(){return this._soundManager}get width(){return this._application.renderer.width}get height(){return this._application.renderer.height}get isReady(){return this._isReady}get isDisposed(){return this._isDisposed}static get instance(){return this.INSTANCE||null}};let K=_n;K.WEBGL_CONTEXT_LOST="NE_WEBGL_CONTEXT_LOST";K.WEBGL_UNAVAILABLE="NE_WEBGL_UNAVAILABLE";K.READY="NE_READY!";K.INSTANCE=null;const At=class{static format(s,t="",e=3){return s>e*At.YEAR?At.getLocalization("friendlytime.years"+t,Math.round(s/At.YEAR)):s>e*At.MONTH?At.getLocalization("friendlytime.months"+t,Math.round(s/At.MONTH)):s>e*At.DAY?At.getLocalization("friendlytime.days"+t,Math.round(s/At.DAY)):s>e*At.HOUR?At.getLocalization("friendlytime.hours"+t,Math.round(s/At.HOUR)):s>e*At.MINUTE?At.getLocalization("friendlytime.minutes"+t,Math.round(s/At.MINUTE)):At.getLocalization("friendlytime.seconds"+t,Math.round(s))}static shortFormat(s,t="",e=3){return s>e*At.YEAR?At.getLocalization("friendlytime.years.short"+t,Math.round(s/At.YEAR)):s>e*At.MONTH?At.getLocalization("friendlytime.months.short"+t,Math.round(s/At.MONTH)):s>e*At.DAY?At.getLocalization("friendlytime.days.short"+t,Math.round(s/At.DAY)):s>e*At.HOUR?At.getLocalization("friendlytime.hours.short"+t,Math.round(s/At.HOUR)):s>e*At.MINUTE?At.getLocalization("friendlytime.minutes.short"+t,Math.round(s/At.MINUTE)):At.getLocalization("friendlytime.seconds.short"+t,Math.round(s))}static getLocalization(s,t){return K.instance.getLocalizationWithParameter(s,"amount",t.toString())}};let Qa=At;Qa.MINUTE=60;Qa.HOUR=60*At.MINUTE;Qa.DAY=24*At.HOUR;Qa.WEEK=7*At.DAY;Qa.MONTH=30*At.DAY;Qa.YEAR=365*At.DAY;const cv=class{static isBuilderClubId(s){return s>=cv.BUILDER_CLUB_FURNI_ID_BASE}};let of=cv;of.BUILDER_CLUB_FURNI_ID_BASE=2147418112;const Dq=s=>s>>>0,dv=s=>{const t=Dq(s);return t>=Math.pow(2,31)?t-Math.pow(2,32):t};class Eg{constructor(t){if(this._id=t.id,this._isMain=t.main||!1,this._avatarSets=new Map,this._bodyParts=[],this._allBodyParts=[],t.avatarSets&&t.avatarSets.length>0)for(const i of t.avatarSets){if(!i)continue;const r=new Eg(i);this._avatarSets.set(r.id,r)}if(t.bodyParts&&t.bodyParts.length>0)for(const i of t.bodyParts)i&&this._bodyParts.push(i.id);let e=this._bodyParts.concat();for(const i of this._avatarSets.values())i&&(e=e.concat(i.getBodyParts()));this._allBodyParts=e}findAvatarSet(t){if(t===this._id)return this;for(const e of this._avatarSets.values())if(e&&e.findAvatarSet(t))return e;return null}getBodyParts(){return this._allBodyParts.concat()}get id(){return this._id}get isMain(){if(this._isMain)return!0;for(const t of this._avatarSets.values())if(t&&t.isMain)return!0;return!1}}class Ts{constructor(t=0,e=0,i=0){this._x=t,this._y=e,this._z=i}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static cross(t,e){const i=new Ts;return i.x=t.y*e.z-t.z*e.y,i.y=t.z*e.x-t.x*e.z,i.z=t.x*e.y-t.y*e.x,i}static subtract(t,e){return new Ts(t.x-e.x,t.y-e.y,t.z-e.z)}dot(t){return this._x*t.x+this._y*t.y+this._z*t.z}cross(t){const e=new Ts;return e.x=this._y*t.z-this._z*t.y,e.y=this._z*t.x-this._x*t.z,e.z=this._x*t.y-this._y*t.x,e}subtract(t){this._x=this._x-t.x,this._y=this._y-t.y,this._z=this._z-t.z}add(t){this._x=this._x+t.x,this._y=this._y+t.y,this._z=this._z+t.z}normalize(){const t=1/this.length();this._x=this._x*t,this._y=this._y*t,this._z=this._z*t}scaleBy(t){this._x*=t,this._y*=t,this._z*=t}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)}toString(){return"Vector3D: ("+this._x+","+this._y+","+this._z+")"}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get z(){return this._z}set z(t){this._z=t}}class fv{constructor(t,e,i){this._location=new Ts(t,e,i),this._transformedLocation=new Ts,this._needsTransformation=!1,(t!=0||e!=0||i!=0)&&(this._needsTransformation=!0)}get location(){return this._location}get transformedLocation(){return this._transformedLocation}applyTransform(t){this._needsTransformation&&(this._transformedLocation=t.vectorMultiplication(this._location))}}class vp extends fv{constructor(t,e=!1){super(parseFloat(t.x),parseFloat(t.y),parseFloat(t.z)),this._id=t.id,this._radius=parseFloat(t.radius),this._normal=new Ts(parseFloat(t.nx),parseFloat(t.ny),parseFloat(t.nz)),this._isDoubleSided=t.double||!1,this._isDynamic=e}getDistance(t){const e=Math.abs(t.z-this.transformedLocation.z-this._radius),i=Math.abs(t.z-this.transformedLocation.z+this._radius);return Math.min(e,i)}get id(){return this._id}get normal(){return this._normal}get isDoubleSided(){return this._isDoubleSided}toString(){return this._id+": "+this.location+" - "+this.transformedLocation}get isDynamic(){return this._isDynamic}}class Lq extends fv{constructor(t){if(super(parseFloat(t.x),parseFloat(t.y),parseFloat(t.z)),this._id=t.id,this._radius=parseFloat(t.radius),this._parts=new Map,this._dynamicParts=new Map,t.items&&t.items.length>0)for(const e of t.items){if(!e)continue;const i=new vp(e);this._parts.set(i.id,i)}}getDynamicParts(t){const e=this._dynamicParts.get(t),i=[];if(e)for(const r in e){const n=e[r];n&&i.push(n)}return i}getPartIds(t){const e=[];for(const i of this._parts.values())i&&e.push(i.id);if(t){const i=this._dynamicParts.get(t);if(i)for(const r in i){const n=i[r];n&&e.push(n.id)}}return e}removeDynamicParts(t){return this._dynamicParts.delete(t),!0}addPart(t,e){if(this.hasPart(t.id,e))return!1;let i=this._dynamicParts.get(e);return i||(i={},this._dynamicParts.set(e,i)),i[t.id]=new vp(t,!0),!0}hasPart(t,e){let i=this._parts.get(t)||null;return!i&&this._dynamicParts.get(e)!==void 0&&(i=this._dynamicParts.get(e)[t]||null),i!==null}getParts(t,e,i,r){const n=[];for(const h of this._parts.values())h&&(h.applyTransform(t),n.push([h.getDistance(e),h]));const a=this._dynamicParts.get(r);if(a)for(const h in a){const u=a[h];u&&(u.applyTransform(t),n.push([u.getDistance(e),u]))}n.sort((h,u)=>{const c=h[0],l=u[0];return c<l?-1:c>l?1:0});const o=[];for(const h of n)h&&o.push(h[1].id);return o}getDistance(t){const e=Math.abs(t.z-this.transformedLocation.z-this._radius),i=Math.abs(t.z-this.transformedLocation.z+this._radius);return Math.min(e,i)}get id(){return this._id}get radius(){return this._radius}}const ii=class{constructor(s=0,t=0,e=0,i=0,r=0,n=0,a=0,o=0,h=0){this._data=[s,t,e,i,r,n,a,o,h]}static getXRotationMatrix(s){const t=s*Math.PI/180,e=Math.cos(t),i=Math.sin(t);return new ii(1,0,0,0,e,-i,0,i,e)}static getYRotationMatrix(s){const t=s*Math.PI/180,e=Math.cos(t),i=Math.sin(t);return new ii(e,0,i,0,1,0,-i,0,e)}static getZRotationMatrix(s){const t=s*Math.PI/180,e=Math.cos(t),i=Math.sin(t);return new ii(e,-i,0,i,e,0,0,0,1)}identity(){return this._data=[1,0,0,0,1,0,0,0,1],this}vectorMultiplication(s){const t=s.x*this._data[0]+s.y*this._data[3]+s.z*this._data[6],e=s.x*this._data[1]+s.y*this._data[4]+s.z*this._data[7],i=s.x*this._data[2]+s.y*this._data[5]+s.z*this._data[8];return new Ts(t,e,i)}multiply(s){const t=this._data[0]*s.data[0]+this._data[1]*s.data[3]+this._data[2]*s.data[6],e=this._data[0]*s.data[1]+this._data[1]*s.data[4]+this._data[2]*s.data[7],i=this._data[0]*s.data[2]+this._data[1]*s.data[5]+this._data[2]*s.data[8],r=this._data[3]*s.data[0]+this._data[4]*s.data[3]+this._data[5]*s.data[6],n=this._data[3]*s.data[1]+this._data[4]*s.data[4]+this._data[5]*s.data[7],a=this._data[3]*s.data[2]+this._data[4]*s.data[5]+this._data[5]*s.data[8],o=this._data[6]*s.data[0]+this._data[7]*s.data[3]+this._data[8]*s.data[6],h=this._data[6]*s.data[1]+this._data[7]*s.data[4]+this._data[8]*s.data[7],u=this._data[6]*s.data[2]+this._data[7]*s.data[5]+this._data[8]*s.data[8];return new ii(t,e,i,r,n,a,o,h,u)}scalarMultiply(s){let t=0;for(;t<this._data.length;)this._data[t]=this._data[t]*s,t++}rotateX(s){const t=s*Math.PI/180,e=Math.cos(t),i=Math.sin(t);return new ii(1,0,0,0,e,-i,0,i,e).multiply(this)}rotateY(s){const t=s*Math.PI/180,e=Math.cos(t),i=Math.sin(t);return new ii(e,0,i,0,1,0,-i,0,e).multiply(this)}rotateZ(s){const t=s*Math.PI/180,e=Math.cos(t),i=Math.sin(t);return new ii(e,-i,0,i,e,0,0,0,1).multiply(this)}skew(){}transpose(){return new ii(this._data[0],this._data[3],this._data[6],this._data[1],this._data[4],this._data[7],this._data[2],this._data[5],this._data[8])}equals(s){return!1}get data(){return this._data}};let Lo=ii;Lo.IDENTITY=new ii(1,0,0,0,1,0,0,0,1);Lo.TOLERANS=1e-18;class Uq{constructor(t){this._camera=new Ts(0,0,10),this._avatarSet=new Eg(t.avatarSets[0]),this._geometryTypes=new Map,this._itemIdToBodyPartMap=new Map,this._transformation=new Lo,this._canvases=new Map;const e=t.camera;if(e&&(this._camera.x=parseFloat(e.x),this._camera.y=parseFloat(e.y),this._camera.z=parseFloat(e.z)),t.canvases&&t.canvases.length>0)for(const i of t.canvases){if(!i)continue;const r=i.scale,n=new Map;if(i.geometries&&i.geometries.length>0)for(const a of i.geometries){if(!a)continue;const o=new xD(a,r);n.set(o.id,o)}this._canvases.set(r,n)}if(t.types&&t.types.length>0)for(const i of t.types){if(!i)continue;const r=new Map,n=new Map;if(i.bodyParts&&i.bodyParts.length>0)for(const a of i.bodyParts){if(!a)continue;const o=new Lq(a);r.set(o.id,o);for(const h of o.getPartIds(null))n.set(h,o)}this._geometryTypes.set(i.id,r),this._itemIdToBodyPartMap.set(i.id,n)}}removeDynamicItems(t){for(const e of this._geometryTypes.values())if(e)for(const i of e.values())i&&i.removeDynamicParts(t)}getBodyPartIdsInAvatarSet(t){const e=this._avatarSet.findAvatarSet(t);return e?e.getBodyParts():[]}isMainAvatarSet(t){const e=this._avatarSet.findAvatarSet(t);return e?e.isMain:!1}getCanvas(t,e){const i=this._canvases.get(t);return i&&i.get(e)||null}typeExists(t){return!!this._geometryTypes.get(t)}hasBodyPart(t,e){if(this.typeExists(t)){const i=this._geometryTypes.get(t);if(i&&i.get(e))return!0}return!1}getBodyPartIDs(t){const e=this.getBodyPartsOfType(t),i=[];if(e)for(const r of e.values())r&&i.push(r.id);return i}getBodyPartsOfType(t){return this.typeExists(t)?this._geometryTypes.get(t):new Map}getBodyPart(t,e){return this.getBodyPartsOfType(t).get(e)||null}getBodyPartOfItem(t,e,i){const r=this._itemIdToBodyPartMap.get(t);if(r){const n=r.get(e);if(n)return n;const a=this.getBodyPartsOfType(t);if(a){for(const o of a.values())if(o&&o.hasPart(e,i))return o}}return null}getBodyPartsInAvatarSet(t,e){const i=this.getBodyPartIdsInAvatarSet(e),r=[];for(const n of i){if(!n)continue;const a=t.get(n);a&&r.push(a)}return r}getBodyPartsAtAngle(t,e,i){if(!i)return[];const r=this.getBodyPartsOfType(i),n=this.getBodyPartsInAvatarSet(r,t),a=[],o=[];this._transformation=Lo.getYRotationMatrix(e);for(const h of n.values())h&&(h.applyTransform(this._transformation),a.push([h.getDistance(this._camera),h]));a.sort((h,u)=>{const c=h[0],l=u[0];return c<l?-1:c>l?1:0});for(const h of a)h&&o.push(h[1].id);return o}getParts(t,e,i,r,n){if(this.hasBodyPart(t,e)){const a=this.getBodyPartsOfType(t).get(e);return this._transformation=Lo.getYRotationMatrix(i),a.getParts(this._transformation,this._camera,r,n)}return[]}}class xq extends Rs{constructor(t){super(),this._renderManager=t,this._geometry=null,this._figureData=new BD,this._partSetsData=new HD,this._animationData=new UD,this._animationManager=new CD,this._mandatorySetTypeIds={},this._actionManager=null,this._defaultAction=null}init(){}dispose(){this.disposed||(super.dispose(),this._renderManager=null,this._figureData=null,this._partSetsData=null,this._animationData=null,this._mandatorySetTypeIds=null)}initGeometry(t){t&&(this._geometry=new Uq(t))}initActions(t,e){e&&(this._actionManager=new TD(t,e),this._defaultAction=this._actionManager.getDefaultAction())}updateActions(t){this._actionManager.updateActions(t),this._defaultAction=this._actionManager.getDefaultAction()}initPartSets(t){return t&&this._partSetsData.parse(t)?(this._partSetsData.getPartDefinition("ri").appendToFigure=!0,this._partSetsData.getPartDefinition("li").appendToFigure=!0,!0):!1}initAnimation(t){return t?this._animationData.parse(t):!1}initFigureData(t){return t?this._figureData.parse(t):!1}injectFigureData(t){this._figureData.injectJSON(t)}registerAnimations(t,e="fx",i=200){let r=0;for(;r<i;){const n=t.getCollection(e+r);if(n){const a=n.data;this._animationManager.registerAnimation(this,a.animations)}r++}}registerAnimation(t){this._animationManager.registerAnimation(this,t)}getPartColor(t,e,i=0){const r=t.getPartColorIds(e);if(!r||r.length<i)return null;const n=this._figureData.getSetType(e);if(n==null)return null;const a=this._figureData.getPalette(n.paletteID);return a?a.getColor(r[i]):null}getBodyPartData(t,e,i){return this._animationManager.getLayerData(t,e,i)}getAnimation(t){return this._animationManager.getAnimation(t)}getActionDefinition(t){return this._actionManager.getActionDefinition(t)}getActionDefinitionWithState(t){return this._actionManager.getActionDefinitionWithState(t)}isMainAvatarSet(t){return this._geometry.isMainAvatarSet(t)}sortActions(t){return this._actionManager.sortActions(t)}maxFrames(t){let e=0;for(const i of t)e=Math.max(e,this._animationData.getFrameCount(i.definition));return e}getMandatorySetTypeIds(t,e){return this._mandatorySetTypeIds[t]||(this._mandatorySetTypeIds[t]=[]),this._mandatorySetTypeIds[t][e]?this._mandatorySetTypeIds[t][e]:(this._mandatorySetTypeIds[t][e]=this._figureData.getMandatorySetTypeIds(t,e),this._mandatorySetTypeIds[t][e])}getDefaultPartSet(t,e){return this._figureData.getDefaultPartSet(t,e)}getCanvasOffsets(t,e,i){return this._actionManager.getCanvasOffsets(t,e,i)}getCanvas(t,e){return this._geometry.getCanvas(t,e)}removeDynamicItems(t){this._geometry.removeDynamicItems(t)}getActiveBodyPartIds(t,e){let i=[];const r=[],n=t.definition.geometryType;if(t.definition.isAnimation){const a=t.definition.state+"."+t.actionParameter,o=this._animationManager.getAnimation(a);if(o&&(i=o.getAnimatedBodyPartIds(0,t.overridingAction),o.hasAddData())){const h={id:"",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:1},u={setType:""};for(const c of o.addData){const l=this._geometry.getBodyPart(n,c.align);if(l){h.id=c.id,l.addPart(h,e),u.setType=c.id;const _=this._partSetsData.addPartDefinition(u);_.appendToFigure=!0,c.base===""&&(_.staticId=1),r.indexOf(l.id)===-1&&r.push(l.id)}}}for(const h of i){const u=this._geometry.getBodyPart(n,h);u&&r.indexOf(u.id)===-1&&r.push(u.id)}}else{i=this._partSetsData.getActiveParts(t.definition);for(const a of i){const o=this._geometry.getBodyPartOfItem(n,a,e);o&&r.indexOf(o.id)===-1&&r.push(o.id)}}return r}getBodyPartsUnordered(t){return this._geometry.getBodyPartIdsInAvatarSet(t)}getBodyParts(t,e,i){const r=hi.DIRECTION_TO_ANGLE[i];return this._geometry.getBodyPartsAtAngle(t,r,e)}getFrameBodyPartOffset(t,e,i,r){const n=this._animationData.getAction(t.definition);return n?n.getFrameBodyPartOffset(e,i,r):Ku.DEFAULT_OFFSET}getParts(t,e,i,r,n,a,o,h=null){let u=null,c=[],l=null;if(!i==null)return[];const _=this._partSetsData.getActiveParts(i.definition),d=[];let g=[0];const m=this._animationData.getAction(i.definition);if(i.definition.isAnimation){const O=i.definition.state+"."+i.actionParameter,v=this._animationManager.getAnimation(O);if(v){g=this.getPopulatedArray(v.frameCount(i.overridingAction));for(const y of v.getAnimatedBodyPartIds(0,i.overridingAction))if(y===t){const C=this._geometry.getBodyPart(r,y);if(C)for(const N of C.getDynamicParts(o))_.push(N.id)}}}const p=this._geometry.getParts(r,t,n,_,o),T=e.getPartTypeIds();for(const O of T){if(h&&h.get(O))continue;const v=e.getPartSetId(O),y=e.getPartColorIds(O),C=this._figureData.getSetType(O);if(C){const N=this._figureData.getPalette(C.paletteID);if(N){const L=C.getPartSet(v);if(L){a=a.concat(L.hiddenLayers);for(const P of L.parts)if(p.indexOf(P.type)>-1){if(m){const dt=m.getPart(P.type);dt?c=dt.frames:c=g}else c=g;u=i.definition,_.indexOf(P.type)===-1&&(u=this._defaultAction);const b=this._partSetsData.getPartDefinition(P.type);let w=b?b.flippedSetType:P.type;(!w||w==="")&&(w=P.type),y&&y.length>P.colorLayerIndex-1&&(l=N.getColor(y[P.colorLayerIndex-1]));const q=P.colorLayerIndex>0,ht=new j_(t,P.type,P.id.toString(),l,c,u,q,P.paletteMap,w);d.push(ht)}}}}}const A=[];for(const O of p){let v=null,y=!1;const C=h&&h.get(O);for(const N of d)N.partType===O&&(C?v=N.color:(y=!0,a.indexOf(O)===-1&&A.push(N)));if(!y){if(C){const N=h.get(O);let L=0,P=0;for(;P<N.length;)L=L+N.charCodeAt(P),P++;if(m){const w=m.getPart(O);w?c=w.frames:c=g}else c=g;const b=new j_(t,O,N,v,c,i.definition,v!=null,-1,O,!1,1);A.push(b)}else if(_.indexOf(O)>-1){const N=this._geometry.getBodyPartOfItem(r,O,o);if(t===N.id){const L=this._partSetsData.getPartDefinition(O);let P=!1,b=1;if(L.appendToFigure){let w="1";if(i.actionParameter!==""&&(w=i.actionParameter),L.hasStaticId()&&(w=L.staticId.toString()),m){const ht=m.getPart(O);ht?c=ht.frames:c=g}else c=g;const q=new j_(t,O,w,null,c,i.definition,!1,-1,O,P,b);A.push(q)}}}}}return A}getPopulatedArray(t){const e=[];let i=0;for(;i<t;)e.push(i),i++;return e}getItemIds(){if(this._actionManager){const t=this._actionManager.getActionDefinition("CarryItem").params,e=[];for(const i of t.values())e.push(i);return e}return[]}get renderManager(){return this._renderManager}get figureData(){return this._figureData}get partData(){return this._partSetsData}get animationManager(){return this._animationManager}}const Fq={animations:[{id:"Move",parts:[{setType:"bd",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"bds",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"ss",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"lg",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"sh",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"lh",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"lhs",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"ls",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"lc",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"rh",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"rhs",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"rs",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"rc",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"ch",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]}]},{id:"Wave",parts:[{setType:"lh",frames:[{number:0,assetPartDefinition:"wav"},{number:1,assetPartDefinition:"wav"}]},{setType:"lhs",frames:[{number:0,assetPartDefinition:"wav"},{number:1,assetPartDefinition:"wav"}]},{setType:"ls",frames:[{number:0,assetPartDefinition:"wav"},{number:1,assetPartDefinition:"wav"}]},{setType:"lc",frames:[{number:0,assetPartDefinition:"wav"},{number:1,assetPartDefinition:"wav"}]},{setType:"ch",frames:[{number:0,assetPartDefinition:"wav"},{number:1,assetPartDefinition:"wav"},{number:2,assetPartDefinition:"wav"},{number:3,assetPartDefinition:"wav"}]}]},{id:"Talk",parts:[{setType:"hd",frames:[{number:0,assetPartDefinition:"spk"},{number:1,assetPartDefinition:"spk"}]},{setType:"fc",frames:[{number:0,assetPartDefinition:"spk"},{number:1,assetPartDefinition:"spk"}]},{setType:"fa",frames:[{number:0,assetPartDefinition:"spk"},{number:1,assetPartDefinition:"spk"}]}]},{id:"Sign",parts:[{setType:"lh",frames:[{number:0,assetPartDefinition:"sig"}]},{setType:"li",frames:[{number:0,assetPartDefinition:"sig"}]},{setType:"ls",frames:[{number:0,assetPartDefinition:"wav"}]},{setType:"lc",frames:[{number:0,assetPartDefinition:"wav"}]}]},{id:"Respect",parts:[{setType:"lh",frames:[{number:0,assetPartDefinition:"respect",repeats:15},{number:1,assetPartDefinition:"respect",repeats:15}]},{setType:"ls",frames:[{number:0,assetPartDefinition:"wav",repeats:15},{number:1,assetPartDefinition:"wav",repeats:15}]},{setType:"lc",frames:[{number:0,assetPartDefinition:"wav",repeats:15},{number:1,assetPartDefinition:"wav",repeats:15}]}]},{id:"Blow",parts:[{setType:"rh",frames:[{number:0,assetPartDefinition:"blw",repeats:10},{number:1,assetPartDefinition:"blw",repeats:10}]},{setType:"rs",frames:[{number:0,assetPartDefinition:"drk"}]},{setType:"rc",frames:[{number:0,assetPartDefinition:"drk"}]},{setType:"ri",frames:[{number:0,assetPartDefinition:""}]},{setType:"ey",frames:[{number:0,assetPartDefinition:"std",repeats:10},{number:0,assetPartDefinition:"eyb",repeats:10}]},{setType:"fc",frames:[{number:0,assetPartDefinition:"std",repeats:10},{number:0,assetPartDefinition:"blw",repeats:10}]}]},{id:"Laugh",parts:[{setType:"rh",frames:[{number:0,assetPartDefinition:"blw"}]},{setType:"rs",frames:[{number:0,assetPartDefinition:"drk"}]},{setType:"rc",frames:[{number:0,assetPartDefinition:"drk"}]},{setType:"ri",frames:[{number:0,assetPartDefinition:""}]},{setType:"ey",frames:[{number:0,assetPartDefinition:"std",repeats:2}]},{setType:"fc",frames:[{number:0,assetPartDefinition:"sml"}]}],offsets:{frames:[{id:0,directions:[{id:0,bodyParts:[{id:"head",dx:0,dy:1}]},{id:1,bodyParts:[{id:"head",dx:0,dy:1}]},{id:2,bodyParts:[{id:"head",dx:0,dy:1}]},{id:3,bodyParts:[{id:"head",dx:0,dy:1}]},{id:4,bodyParts:[{id:"head",dx:0,dy:1}]},{id:5,bodyParts:[{id:"head",dx:0,dy:1}]},{id:6,bodyParts:[{id:"head",dx:0,dy:1}]},{id:7,bodyParts:[{id:"head",dx:0,dy:1}]}]},{id:1,directions:[{id:0,bodyParts:[{id:"head",dx:0,dy:0}]},{id:1,bodyParts:[{id:"head",dx:0,dy:0}]},{id:2,bodyParts:[{id:"head",dx:0,dy:0}]},{id:3,bodyParts:[{id:"head",dx:0,dy:0}]},{id:4,bodyParts:[{id:"head",dx:0,dy:0}]},{id:5,bodyParts:[{id:"head",dx:0,dy:0}]},{id:6,bodyParts:[{id:"head",dx:0,dy:0}]},{id:7,bodyParts:[{id:"head",dx:0,dy:0}]}]}]}}]},wq={geometry:{direction:0,camera:{x:0,y:0,z:10},canvases:[{scale:"h",geometries:[{id:"vertical",width:90,height:130,dx:0,dy:0},{id:"sitting",width:90,height:130,dx:0,dy:0},{id:"horizontal",width:128,height:80,dx:30,dy:0},{id:"swhorizontal",width:192,height:120,dx:0,dy:-40}]},{scale:"sh",geometries:[{id:"vertical",width:45,height:72,dx:0,dy:0},{id:"sitting",width:45,height:72,dx:0,dy:0},{id:"horizontal",width:64,height:50,dx:15,dy:-10},{id:"swhorizontal",width:96,height:70,dx:0,dy:-20},{id:"swim",width:64,height:70,dx:25,dy:10}]}],avatarSets:[{id:"full",avatarSets:[{id:"body",main:!0,bodyParts:[{id:"top"},{id:"bottom"},{id:"behind"},{id:"torso"},{id:"leftitem"},{id:"rightitem"},{id:"leftarm"},{id:"rightarm"}]},{id:"head",bodyParts:[{id:"head"}]}]}],types:[{id:"vertical",bodyParts:[{id:"top",x:0,y:0,z:0,radius:2},{id:"bottom",x:0,y:0,z:0,radius:.001},{id:"behind",x:0,y:0,z:.2,radius:.3},{id:"torso",x:0,y:0,z:0,radius:.4,items:[{id:"bd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"bds",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"ch",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!1},{id:"sh",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"lg",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"ss",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!1},{id:"cp",x:0,y:0,z:0,radius:.045,nx:0,ny:0,nz:-1,double:!1},{id:"wa",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!1},{id:"cc",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ca",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1}]},{id:"leftitem",x:0,y:0,z:-.29,radius:.3,items:[{id:"li",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1}]},{id:"rightitem",x:0,y:0,z:-.29,radius:.3,items:[{id:"ri",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1}]},{id:"leftarm",x:-1,y:0,z:-.51,radius:.5,items:[{id:"lh",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"lhs",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"ls",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"lc",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1}]},{id:"rightarm",x:1,y:0,z:-.51,radius:.5,items:[{id:"rh",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"rhs",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"rs",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"rc",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1}]},{id:"head",x:0,y:0,z:0,radius:.5,items:[{id:"hd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"fc",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"ey",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"hr",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!0},{id:"hrb",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!0},{id:"fa",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ea",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1},{id:"ha",x:0,y:0,z:0,radius:.08,nx:0,ny:0,nz:-1,double:!1},{id:"he",x:0,y:0,z:0,radius:.09,nx:0,ny:0,nz:-1,double:!1}]}]},{id:"sitting",bodyParts:[{id:"top",x:0,y:0,z:0,radius:2},{id:"bottom",x:0,y:0,z:0,radius:.001},{id:"behind",x:0,y:0,z:.2,radius:.3},{id:"torso",x:0,y:0,z:0,radius:.4,items:[{id:"bd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"bds",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"ch",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"sh",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!1},{id:"lg",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"ss",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!1},{id:"cp",x:0,y:0,z:0,radius:.045,nx:0,ny:0,nz:-1,double:!1},{id:"wa",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!1},{id:"cc",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ca",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1}]},{id:"leftitem",x:0,y:0,z:-.29,radius:.3,items:[{id:"li",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1}]},{id:"rightitem",x:0,y:0,z:-.29,radius:.3,items:[{id:"ri",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1}]},{id:"leftarm",x:-1,y:0,z:-.51,radius:.5,items:[{id:"lh",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"lhs",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"ls",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"lc",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1}]},{id:"rightarm",x:1,y:0,z:-.51,radius:.5,items:[{id:"rh",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"rhs",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"rs",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"rc",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1}]},{id:"head",x:0,y:0,z:0,radius:.5,items:[{id:"hd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"fc",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"ey",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"hr",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!0},{id:"hrb",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!0},{id:"fa",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ea",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1},{id:"ha",x:0,y:0,z:0,radius:.08,nx:0,ny:0,nz:-1,double:!1},{id:"he",x:0,y:0,z:0,radius:.09,nx:0,ny:0,nz:-1,double:!1}]}]},{id:"horizontal",bodyParts:[{id:"torso",x:0,y:0,z:0,radius:.4,items:[{id:"bd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"bds",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"ch",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"cp",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1},{id:"sh",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!1},{id:"lg",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"ss",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"wa",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!1},{id:"cc",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ca",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1}]},{id:"leftitem",x:0,y:0,z:-.29,radius:.3,items:[{id:"li",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1}]},{id:"rightitem",x:0,y:0,z:-.29,radius:.3,items:[{id:"ri",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1}]},{id:"leftarm",x:-1,y:0,z:-.51,radius:.6,items:[{id:"lh",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"lhs",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"ls",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"lc",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1}]},{id:"rightarm",x:1,y:0,z:-.51,radius:.6,items:[{id:"rh",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"rhs",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"rs",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"rc",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1}]},{id:"head",x:0,y:0,z:0,radius:.5,items:[{id:"hd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"fc",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"ey",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"hr",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!0},{id:"hrb",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!0},{id:"fa",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ea",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1},{id:"ha",x:0,y:0,z:0,radius:.08,nx:0,ny:0,nz:-1,double:!1},{id:"he",x:0,y:0,z:0,radius:.09,nx:0,ny:0,nz:-1,double:!1}]}]},{id:"swhorizontal",bodyParts:[{id:"torso",x:0,y:0,z:0,radius:.4,items:[{id:"bd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"bds",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"ch",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"cp",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1},{id:"sh",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!1},{id:"lg",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"ss",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"wa",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!1},{id:"cc",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ca",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1}]},{id:"leftitem",x:0,y:0,z:-.29,radius:.3,items:[{id:"li",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1}]},{id:"rightitem",x:0,y:0,z:-.29,radius:.3,items:[{id:"ri",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1}]},{id:"leftarm",x:-1,y:0,z:-.51,radius:.6,items:[{id:"lh",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"lhs",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"ls",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"lc",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1}]},{id:"rightarm",x:1,y:0,z:-.51,radius:.6,items:[{id:"rh",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"rhs",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"rs",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"rc",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1}]},{id:"head",x:0,y:0,z:0,radius:.5,items:[{id:"hd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"fc",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"ey",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"hr",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!0},{id:"hrb",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!0},{id:"fa",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ea",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1},{id:"ha",x:0,y:0,z:0,radius:.08,nx:0,ny:0,nz:-1,double:!1},{id:"he",x:0,y:0,z:0,radius:.09,nx:0,ny:0,nz:-1,double:!1}]}]},{id:"swim",bodyParts:[{id:"torso",x:0,y:0,z:0,radius:.4,items:[{id:"bds",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"ss",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1}]},{id:"head",x:0,y:0,z:0,radius:.5,items:[{id:"hd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"fc",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"ey",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"hr",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!0},{id:"hrb",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!0},{id:"fa",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ea",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1},{id:"ha",x:0,y:0,z:0,radius:.08,nx:0,ny:0,nz:-1,double:!1},{id:"he",x:0,y:0,z:0,radius:.09,nx:0,ny:0,nz:-1,double:!1}]}]}]}},Gq={partSets:{partSet:[{setType:"ri",flippedSetType:"ri"},{setType:"ri",flippedSetType:"ri"},{setType:"rh",flippedSetType:"lh"},{setType:"rhs",flippedSetType:"lhs"},{setType:"rs",swim:"0",flippedSetType:"ls"},{setType:"rc",flippedSetType:"lc"},{setType:"bd"},{setType:"bds"},{setType:"ss"},{setType:"sh"},{setType:"lg"},{setType:"ch"},{setType:"cp"},{setType:"cc"},{setType:"hd"},{setType:"fc"},{setType:"ey"},{setType:"hr"},{setType:"hrb",removeSetType:"hr"},{setType:"li",flippedSetType:"li"},{setType:"lh",flippedSetType:"rh"},{setType:"lhs",flippedSetType:"rhs"},{setType:"ls",flippedSetType:"rs"},{setType:"lc",flippedSetType:"rc"},{setType:"wa"},{setType:"ea"},{setType:"ca"},{setType:"fa"},{setType:"ha"},{setType:"he"}],activePartSets:[{id:"figure",activeParts:[{setType:"rh"},{setType:"rh"},{setType:"rhs"},{setType:"rs"},{setType:"rc"},{setType:"bd"},{setType:"bds"},{setType:"ss"},{setType:"sh"},{setType:"lg"},{setType:"ch"},{setType:"cp"},{setType:"cc"},{setType:"wa"},{setType:"hd"},{setType:"fc"},{setType:"ey"},{setType:"hr"},{setType:"hrb"},{setType:"lh"},{setType:"lhs"},{setType:"ls"},{setType:"lc"},{setType:"ea"},{setType:"ca"},{setType:"fa"},{setType:"ha"},{setType:"he"}]},{id:"head",activeParts:[{setType:"hd"},{setType:"fc"},{setType:"ey"},{setType:"hr"},{setType:"hrb"},{setType:"ea"},{setType:"fa"},{setType:"ha"},{setType:"he"}]},{id:"speak",activeParts:[{setType:"hd"},{setType:"hr"},{setType:"hrb"},{setType:"fc"},{setType:"fa"},{setType:"ha"}]},{id:"gesture",activeParts:[{setType:"ey"},{setType:"fc"}]},{id:"eye",activeParts:[{setType:"ey"}]},{id:"handRight",activeParts:[{setType:"rh"},{setType:"rhs"},{setType:"rs"},{setType:"rc"},{setType:"ri"}]},{id:"handRightAndHead",activeParts:[{setType:"rh"},{setType:"rhs"},{setType:"rs"},{setType:"rc"},{setType:"ri"},{setType:"ey"},{setType:"fc"},{setType:"hd"}]},{id:"handLeft",activeParts:[{setType:"lh"},{setType:"lhs"},{setType:"ls"},{setType:"lc"},{setType:"li"}]},{id:"walk",activeParts:[{setType:"bd"},{setType:"bds"},{setType:"ss"},{setType:"lg"},{setType:"lh"},{setType:"lhs"},{setType:"rh"},{setType:"rhs"},{setType:"ls"},{setType:"lc"},{setType:"rs"},{setType:"rc"},{setType:"sh"}]},{id:"sit",activeParts:[{setType:"bd"},{setType:"bds"},{setType:"ss"},{setType:"lg"},{setType:"sh"},{setType:"cc"}]},{id:"itemRight",activeParts:[{setType:"ri"}]}]}},Li=class extends Rs{constructor(s,t,e,i){super(),this._state=Li.NOT_LOADED,this._libraryName=s,this._revision=t,this._downloadUrl=i,this._assets=e,this._animation=null,this._downloadUrl=this._downloadUrl.replace(/%libname%/gi,this._libraryName),this._downloadUrl=this._downloadUrl.replace(/%revision%/gi,this._revision),this._assets.getCollection(this._libraryName)&&(this._state=Li.LOADED)}async downloadAsset(){if(!this._assets||this._state===Li.LOADING||this._state===Li.LOADED)return;if(this._assets.getCollection(this._libraryName)){this._state=Li.LOADED,this.dispatchEvent(new ua(ua.DOWNLOAD_COMPLETE,this));return}if(this._state=Li.LOADING,!await this._assets.downloadAsset(this._downloadUrl))return;this._state=Li.LOADED;const e=this._assets.getCollection(this._libraryName);e&&(this._animation=e.data.animations),this.dispatchEvent(new ua(ua.DOWNLOAD_COMPLETE,this))}get libraryName(){return this._libraryName}get animation(){return this._animation}get isLoaded(){return this._state===Li.LOADED}};let Gh=Li;Gh.DOWNLOAD_COMPLETE="EADL_DOWNLOAD_COMPLETE";Gh.NOT_LOADED=0;Gh.LOADING=1;Gh.LOADED=2;const hf=class extends Rs{constructor(s,t){super(),this._assets=s,this._structure=t,this._missingMandatoryLibs=rt.getValue("avatar.mandatory.effect.libraries"),this._effectMap=new Map,this._effectListeners=new Map,this._incompleteEffects=new Map,this._initDownloadBuffer=[],this._pendingDownloadQueue=[],this._currentDownloads=[],this._libraryNames=[],this._isReady=!1,this.onLibraryLoaded=this.onLibraryLoaded.bind(this),this.onAvatarRenderReady=this.onAvatarRenderReady.bind(this),this.loadEffectMap(),this._structure.renderManager.events.addEventListener(Nl.AVATAR_RENDER_READY,this.onAvatarRenderReady)}loadEffectMap(){const s=new XMLHttpRequest;try{s.open("GET",rt.getValue("avatar.effectmap.url")),s.send(),s.onloadend=t=>{if(s.responseText){const e=JSON.parse(s.responseText);this.processEffectMap(e.effects),this.processMissingLibraries(),this._isReady=!0,this.dispatchEvent(new Rt(hf.DOWNLOADER_READY))}},s.onerror=t=>{throw new Error("invalid_avatar_effect_map")}}catch(t){Y.error(t)}}processEffectMap(s){if(s)for(const t of s){if(!t)continue;const e=t.id,i=t.lib,r=t.revision||"";if(this._libraryNames.indexOf(i)>=0)continue;this._libraryNames.push(i);const n=new Gh(i,r,this._assets,rt.getValue("avatar.asset.effect.url"));n.addEventListener(ua.DOWNLOAD_COMPLETE,this.onLibraryLoaded);let a=this._effectMap.get(e);a||(a=[]),a.push(n),this._effectMap.set(e,a)}}downloadAvatarEffect(s,t){if(!this._isReady||!this._structure.renderManager.isReady){this._initDownloadBuffer.push([s,t]);return}const e=this.getAvatarEffectPendingLibraries(s);if(e&&e.length){if(t&&!t.disposed){let i=this._effectListeners.get(s.toString());i||(i=[]),i.push(t),this._effectListeners.set(s.toString(),i)}this._incompleteEffects.set(s.toString(),e);for(const i of e)i&&this.downloadLibrary(i)}else t&&!t.disposed&&t.resetEffect(s)}onAvatarRenderReady(s){if(s){for(const[t,e]of this._initDownloadBuffer)this.downloadAvatarEffect(t,e);this._initDownloadBuffer=[]}}onLibraryLoaded(s){if(!s||!s.library)return;const t=[];this._structure.registerAnimation(s.library.animation);for(const[i,r]of this._incompleteEffects.entries()){let n=!0;for(const a of r)if(!(!a||a.isLoaded)){n=!1;break}if(n){t.push(i);const a=this._effectListeners.get(i);for(const o of a)!o||o.disposed||o.resetEffect(parseInt(i));this._effectListeners.delete(i),this.dispatchEvent(new Rt(hf.LIBRARY_LOADED))}}for(const i of t)this._incompleteEffects.delete(i);let e=0;for(;e<this._currentDownloads.length;){const i=this._currentDownloads[e];i&&i.libraryName===s.library.libraryName&&this._currentDownloads.splice(e,1),e++}}processMissingLibraries(){const s=this._missingMandatoryLibs.slice();for(const t of s){if(!t)continue;const e=this._effectMap.get(t);if(e)for(const i of e)i&&this.downloadLibrary(i)}}isAvatarEffectReady(s){return!this._isReady||!this._structure.renderManager.isReady?!1:!this.getAvatarEffectPendingLibraries(s).length}getAvatarEffectPendingLibraries(s){const t=[];if(!this._structure)return t;const e=this._effectMap.get(s.toString());if(e)for(const i of e)!i||i.isLoaded||t.indexOf(i)===-1&&t.push(i);return t}downloadLibrary(s){!s||s.isLoaded||this._pendingDownloadQueue.indexOf(s)>=0||this._currentDownloads.indexOf(s)>=0||(this._pendingDownloadQueue.push(s),this.processDownloadQueue())}processDownloadQueue(){for(;this._pendingDownloadQueue.length;)this._pendingDownloadQueue[0].downloadAsset(),this._currentDownloads.push(this._pendingDownloadQueue.shift())}};let Or=hf;Or.DOWNLOADER_READY="EADM_DOWNLOADER_READY";Or.LIBRARY_LOADED="EADM_LIBRARY_LOADED";Or.MAX_DOWNLOADS=2;class Bq extends Ws{constructor(t,e,i,r,n){super(t,e,i,r,n,null)}isPlaceholder(){return!0}}const gv=class extends mi{constructor(){super(),this._structure=null,this._avatarAssetDownloadManager=null,this._placeHolderFigure=null,this._figureMapReady=!1,this._effectMapReady=!1,this._actionsReady=!1,this._geometryReady=!1,this._partSetsReady=!1,this._animationsReady=!1,this._isReady=!1,this.onAvatarAssetDownloaderReady=this.onAvatarAssetDownloaderReady.bind(this),this.onAvatarAssetDownloaded=this.onAvatarAssetDownloaded.bind(this),this.onEffectAssetDownloaderReady=this.onEffectAssetDownloaderReady.bind(this),this.onEffectAssetDownloaded=this.onEffectAssetDownloaded.bind(this),this.onAvatarStructureDownloadDone=this.onAvatarStructureDownloadDone.bind(this)}onInit(){this._structure=new xq(this),this.loadGeometry(),this.loadPartSets(),this.loadActions(),this.loadAnimations(),this.loadFigureData(),this._aliasCollection=new OD(this,ys()),this._aliasCollection.init(),this._avatarAssetDownloadManager||(this._avatarAssetDownloadManager=new Rr(ys(),this._structure),this._avatarAssetDownloadManager.addEventListener(Rr.DOWNLOADER_READY,this.onAvatarAssetDownloaderReady),this._avatarAssetDownloadManager.addEventListener(Rr.LIBRARY_LOADED,this.onAvatarAssetDownloaded)),this._effectAssetDownloadManager||(this._effectAssetDownloadManager=new Or(ys(),this._structure),this._effectAssetDownloadManager.addEventListener(Or.DOWNLOADER_READY,this.onEffectAssetDownloaderReady),this._effectAssetDownloadManager.addEventListener(Or.LIBRARY_LOADED,this.onEffectAssetDownloaded)),this.checkReady()}onDispose(){this._avatarAssetDownloadManager&&(this._avatarAssetDownloadManager.removeEventListener(Rr.DOWNLOADER_READY,this.onAvatarAssetDownloaderReady),this._avatarAssetDownloadManager.removeEventListener(Rr.LIBRARY_LOADED,this.onAvatarAssetDownloaded)),this._effectAssetDownloadManager&&(this._effectAssetDownloadManager.removeEventListener(Or.DOWNLOADER_READY,this.onEffectAssetDownloaderReady),this._effectAssetDownloadManager.removeEventListener(Or.LIBRARY_LOADED,this.onEffectAssetDownloaded))}loadGeometry(){this._structure&&(this._structure.initGeometry(wq.geometry),this._geometryReady=!0,this.checkReady())}loadPartSets(){this._structure&&(this._structure.initPartSets(Gq.partSets),this._partSetsReady=!0,this.checkReady())}loadActions(){const s=rt.getValue("avatar.default.actions");s&&this._structure.initActions(ys(),s);const t=new XMLHttpRequest;try{t.open("GET",rt.getValue("avatar.actions.url")),t.send(),t.onloadend=e=>{this._structure&&(this._structure.updateActions(JSON.parse(t.responseText)),this._actionsReady=!0,this.checkReady())},t.onerror=e=>{throw new Error("invalid_avatar_actions")}}catch(e){Y.error(e)}}loadAnimations(){this._structure&&(this._structure.initAnimation(Fq.animations),this._animationsReady=!0,this.checkReady())}loadFigureData(){const s=rt.getValue("avatar.default.figuredata");if(!s||typeof s=="string"){Y.error("XML figuredata is no longer supported");return}this._structure&&this._structure.initFigureData(s),new Wc(rt.getValue("avatar.figuredata.url"),this._structure.figureData).addEventListener(Wc.AVATAR_STRUCTURE_DONE,this.onAvatarStructureDownloadDone)}onAvatarStructureDownloadDone(s){this._structureReady=!0,this._structure.init(),this.checkReady()}onAvatarAssetDownloaderReady(s){s&&(this._figureMapReady=!0,this.checkReady())}onAvatarAssetDownloaded(s){s&&this._aliasCollection.reset()}onEffectAssetDownloaderReady(s){s&&(this._effectMapReady=!0,this.checkReady())}onEffectAssetDownloaded(s){s&&this._aliasCollection.reset()}checkReady(){this._isReady||!this._geometryReady||!this._partSetsReady||!this._actionsReady||!this._animationsReady||!this._figureMapReady||!this._effectMapReady||!this._structureReady||(this._isReady=!0,this.events&&this.events.dispatchEvent(new Rt(Nl.AVATAR_RENDER_READY)))}createFigureContainer(s){return new Ru(s)}isFigureContainerReady(s){return this._avatarAssetDownloadManager?this._avatarAssetDownloadManager.isAvatarFigureContainerReady(s):!1}createAvatarImage(s,t,e,i=null,r=null){if(!this._structure||!this._avatarAssetDownloadManager)return null;const n=new Ru(s);return e&&this.validateAvatarFigure(n,e),this._avatarAssetDownloadManager.isAvatarFigureContainerReady(n)?new Ws(this._structure,this._aliasCollection,n,t,this._effectAssetDownloadManager,r):(this._placeHolderFigure||(this._placeHolderFigure=new Ru(gv.DEFAULT_FIGURE)),this._avatarAssetDownloadManager.downloadAvatarFigure(n,i),new Bq(this._structure,this._aliasCollection,this._placeHolderFigure,t,this._effectAssetDownloadManager))}downloadAvatarFigure(s,t){this._avatarAssetDownloadManager&&this._avatarAssetDownloadManager.downloadAvatarFigure(s,t)}validateAvatarFigure(s,t){let e=!1;const i=this._structure.getMandatorySetTypeIds(t,2);if(i){const r=this._structure.figureData;for(const n of i)if(s.hasPartType(n)){const a=r.getSetType(n);if(a&&!a.getPartSet(s.getPartSetId(n))){const h=this._structure.getDefaultPartSet(n,t);h&&(s.updatePart(n,h.id,[0]),e=!0)}}else{const a=this._structure.getDefaultPartSet(n,t);a&&(s.updatePart(n,a.id,[0]),e=!0)}}return!e}getFigureClubLevel(s,t,e=null){if(!this._structure)return 0;const i=this._structure.figureData,r=Array.from(s.getPartTypeIds());let n=0;for(const a of r){const o=i.getSetType(a);if(!o)continue;const h=s.getPartSetId(a),u=o.getPartSet(h);if(u){n=Math.max(u.clubLevel,n);const c=i.getPalette(o.paletteID),l=s.getPartColorIds(a);for(const _ of l){const d=c.getColor(_);d&&(n=Math.max(d.clubLevel,n))}}}e||(e=this._structure.getBodyPartsUnordered(We.FULL));for(const a of e){const o=i.getSetType(a);o&&r.indexOf(a)===-1&&(n=Math.max(o.optionalFromClubLevel(t),n))}return n}isValidFigureSetForGender(s,t){const i=this.structureData.getFigurePartSet(s);return!!(i&&(i.gender.toUpperCase()==="U"||i.gender.toUpperCase()===t.toUpperCase()))}getFigureStringWithFigureIds(s,t,e){const i=new Ie;i.loadAvatarData(s,t);const r=this.resolveFigureSets(e);for(const n of r)i.savePartData(n.type,n.id,i.getColourIds(n.type));return i.getFigureString()}resolveFigureSets(s){const t=this.structureData,e=[];for(const i of s){const r=t.getFigurePartSet(i);r&&e.push(r)}return e}getMandatoryAvatarPartSetIds(s,t){return this._structure?this._structure.getMandatorySetTypeIds(s,t):null}getAssetByName(s){return this._aliasCollection.getAsset(s)}get assets(){return ys()}get isReady(){return this._isReady}get structure(){return this._structure}get structureData(){return this._structure?this._structure.figureData:null}get downloadManager(){return this._avatarAssetDownloadManager}};let Ev=gv;Ev.DEFAULT_FIGURE="hd-99999-99999";class Hq{constructor(t,e,i){this._layerId=t,this._partId=e,this._paletteId=i}get layerId(){return this._layerId}set layerId(t){this._layerId=t}get partId(){return this._partId}set partId(t){this._partId=t}get paletteId(){return this._paletteId}set paletteId(t){this._paletteId=t}}class gl{constructor(t){this._typeId=this.getTypeId(t),this._paletteId=this.getPaletteId(t),this._color=this.getColor(t),this._headOnly=this.getHeadOnly(t);const e=this.getCustomData(t);this._customLayerIds=this.getCustomLayerIds(e),this._customPartIds=this.getCustomPartIds(e),this._customPaletteIds=this.getCustomPaletteIds(e),this._customParts=[];let i=0;for(;i<this._customLayerIds.length;)this._customParts.push(new Hq(this._customLayerIds[i],this._customPartIds[i],this._customPaletteIds[i])),i++}get typeId(){return this._typeId}get paletteId(){return this._paletteId}get color(){return this._color}get customLayerIds(){return this._customLayerIds}get customPartIds(){return this._customPartIds}get customPaletteIds(){return this._customPaletteIds}get customParts(){return this._customParts}getCustomPart(t){if(this._customParts){for(const e of this._customParts)if(e.layerId===t)return e}return null}get hasCustomParts(){return this._customLayerIds!=null&&this._customLayerIds.length>0}get headOnly(){return this._headOnly}get figureString(){let t=this.typeId+" "+this.paletteId+" "+this.color.toString(16);t=t+(" "+this.customParts.length);for(const e of this.customParts)t=t+(" "+e.layerId+" "+e.partId+" "+e.paletteId);return t}getCustomData(t){let e=[];if(t){const i=t.split(" "),r=this._headOnly?1:0,n=4+r;if(i.length>n){const a=3+r,o=parseInt(i[a]);e=i.slice(n,n+o*3)}}return e}getCustomLayerIds(t){const e=[];let i=0;for(;i<t.length;)e.push(parseInt(t[i+0])),i=i+3;return e}getCustomPartIds(t){const e=[];let i=0;for(;i<t.length;)e.push(parseInt(t[i+1])),i=i+3;return e}getCustomPaletteIds(t){const e=[];let i=0;for(;i<t.length;)e.push(parseInt(t[i+2])),i=i+3;return e}getTypeId(t){if(t){const e=t.split(" ");if(e.length>=1)return parseInt(e[0])}return 0}getPaletteId(t){if(t){const e=t.split(" ");if(e.length>=2)return parseInt(e[1])}return 0}getColor(t){if(t){const e=t.split(" ");if(e.length>=3)return parseInt(e[2],16)}return 16777215}getHeadOnly(t){if(t){const e=t.split(" ");if(e.length>=4)return e[3]==="head"}return!1}}class n_{constructor(t){this._complete=!0,this._target=t}get running(){return this._running&&!!this._target}get complete(){return this._complete}set target(t){this._target=t}get target(){return this._target}set tag(t){this._tag=t}get tag(){return this._tag}start(){this._running=!0}update(t){}stop(){this._target=null,this._running=!1}tick(t){}}class Qq extends n_{constructor(t){super(t)}tick(t){super.tick(t),this.target&&(this.target.remove(),this.target=null)}}class pg extends n_{constructor(t,e){super(t),this._complete=!1,this._duration=e}get duration(){return this._duration}start(){super.start(),this._complete=!1,this._startTimeMs=_t()}tick(t){super.tick(t);const e=(t-this._startTimeMs)/this._duration;e<1?this.update(e):(this.update(1),this._complete=!0)}}class Jq extends pg{constructor(t,e,i){super(t,e),this._height=i}start(){super.start(),this._offset=0,this.target.style.top=this._offset-this._height+"px"}update(t){super.update(t),this.target.style.top=this._offset-this._height+this.getBounceOffset(t)*this._height+"px"}getBounceOffset(t){return t<.364?7.5625*t*t:t<.727?(t=t-.545,7.5625*t*t+.75):t<.909?(t=t-.9091,7.5625*t*t+.9375):(t=t-.955,7.5625*t*t+.984375)}stop(){this.target.style.top=this._offset+"px",super.stop()}}class Vq extends pg{constructor(t){super(t.target,t.duration),this._interval=t}start(){super.start(),this._interval.start()}update(t){super.update(t),this._interval.update(t)}stop(){super.stop(),this._interval.stop()}}class kq extends Vq{constructor(t,e){super(t),this._rate=e}}class $q extends kq{constructor(t,e){super(t,e)}update(t){this._interval.update(Math.pow(t,1/this._rate))}}class tZ extends pg{constructor(t,e,i,r,n,a){super(t,e),this._deltaX=i,this._deltaY=r,this._height=-n,this._numJumps=a}start(){super.start(),this._startX=this.target.offsetLeft,this._startY=this.target.offsetTop}update(t){super.update(t),this.target.style.left=this._startX+this._deltaX*t+"px",this.target.style.top=this._startY+this._height*Math.abs(Math.sin(t*Math.PI*this._numJumps))+this._deltaY*t+"px"}}const lt=class{static get TIMER_TIME(){return 1e3/Gb()}static runMotion(s){return lt._RUNNING_MOTIONS.indexOf(s)===-1&&lt._QUEUED_MOTIONS.indexOf(s)===-1&&(lt._IS_UPDATING?lt._QUEUED_MOTIONS.push(s):(lt._RUNNING_MOTIONS.push(s),s.start()),lt.startTimer()),s}static removeMotion(s){let t=lt._RUNNING_MOTIONS.indexOf(s);t>-1?lt._IS_UPDATING?(t=lt._REMOVED_MOTIONS.indexOf(s),t==-1&&lt._REMOVED_MOTIONS.push(s)):(lt._RUNNING_MOTIONS.splice(t,1),s.running&&s.stop(),lt._RUNNING_MOTIONS.length||lt.stopTimer()):(t=lt._QUEUED_MOTIONS.indexOf(s),t>-1&&lt._QUEUED_MOTIONS.splice(t,1))}static getMotionByTag(s){for(const t of lt._RUNNING_MOTIONS)if(t.tag==s)return t;for(const t of lt._QUEUED_MOTIONS)if(t.tag==s)return t;return null}static getMotionByTarget(s){for(const t of lt._RUNNING_MOTIONS)if(t.target==s)return t;for(const t of lt._QUEUED_MOTIONS)if(t.target==s)return t;return null}static getMotionByTagAndTarget(s,t){for(const e of lt._RUNNING_MOTIONS)if(e.tag==s&&e.target==t)return e;for(const e of lt._QUEUED_MOTIONS)if(e.tag==s&&e.target==t)return e;return null}static get isRunning(){return!!lt._TIMER}static get isUpdating(){return lt._IS_UPDATING}static onTick(){lt._IS_UPDATING=!0;const s=_t();let t=null;for(;t=lt._QUEUED_MOTIONS.pop();)lt._RUNNING_MOTIONS.push(t);for(;t=lt._REMOVED_MOTIONS.pop();)lt._RUNNING_MOTIONS.splice(lt._RUNNING_MOTIONS.indexOf(t),1),t.running&&t.stop();for(t of lt._RUNNING_MOTIONS)t.running?(t.tick(s),t.complete&&lt.removeMotion(t)):lt.removeMotion(t);lt._RUNNING_MOTIONS.length||lt.stopTimer(),lt._IS_UPDATING=!1}static startTimer(){lt._TIMER||(lt._TIMER=setInterval(lt.onTick,lt.TIMER_TIME))}static stopTimer(){lt._TIMER&&(clearInterval(lt._TIMER),lt._TIMER=null)}getNumRunningMotions(s){let t=0;for(const e of lt._RUNNING_MOTIONS)e.target===s&&t++;return t}};let Bh=lt;Bh._QUEUED_MOTIONS=[];Bh._RUNNING_MOTIONS=[];Bh._REMOVED_MOTIONS=[];Bh._TIMER=null;Bh._IS_UPDATING=!1;class eZ extends n_{constructor(...t){super(t?t[0].target:null),this._queue=[];for(const e of t)this._queue.push(e);this._motion=t[0],this._complete=!this._motion}get running(){return this._running&&this._motion?this._motion.running:!1}start(){super.start(),this._motion.start()}update(t){super.update(t),this._motion.running&&this._motion.update(t)}stop(){super.stop(),this._motion.stop()}tick(t){if(super.tick(t),this._motion.tick(t),this._motion.complete){this._motion.stop();const e=this._queue.indexOf(this._motion);e<this._queue.length-1?(this._motion=this._queue[e+1],this._target=this._motion.target,this._motion.start()):this._complete=!0}}}class sZ extends n_{constructor(t){super(null),this._waitTimeMs=t}get running(){return this._running}start(){super.start(),this._complete=!1,this._startTimeMs=_t()}tick(t){super.tick(t),this._complete=t-this._startTimeMs>=this._waitTimeMs,this._complete&&this.stop()}}export{aj as $,x as A,Rt as B,Zu as C,H5 as D,Rs as E,_8 as F,l5 as G,Ln as H,Me as I,Ml as J,St as K,ph as L,k as M,K as N,vr as O,gl as P,kb as Q,I as R,Ma as S,_h as T,iK as U,S as V,Jo as W,Xq as X,Bi as Y,rj as Z,nj as _,rt as a,NV as a$,xY as a0,bH as a1,jY as a2,Uc as a3,SR as a4,j3 as a5,G3 as a6,H3 as a7,s3 as a8,B3 as a9,QH as aA,vY as aB,qH as aC,Wj as aD,zH as aE,jH as aF,FH as aG,wH as aH,rD as aI,XY as aJ,WY as aK,_s as aL,m5 as aM,mO as aN,r5 as aO,e5 as aP,QY as aQ,KY as aR,Ti as aS,nt as aT,nd as aU,FV as aV,GV as aW,X5 as aX,LV as aY,yV as aZ,CV as a_,h3 as aa,fH as ab,yj as ac,Y3 as ad,K3 as ae,z3 as af,YH as ag,EH as ah,t3 as ai,W3 as aj,gH as ak,dH as al,V3 as am,Z3 as an,Ue as ao,ld as ap,Y as aq,JY as ar,VH as as,HH as at,nV as au,iV as av,rV as aw,$H as ax,sV as ay,hV as az,ms as b,$4 as b$,CT as b0,q5 as b1,W5 as b2,Y5 as b3,tW as b4,Q5 as b5,j5 as b6,k5 as b7,wV as b8,J5 as b9,up as bA,Ej as bB,pj as bC,mj as bD,Ij as bE,Tj as bF,X4 as bG,Sj as bH,vj as bI,Cj as bJ,lp as bK,Mj as bL,dT as bM,Nj as bN,Pj as bO,bj as bP,Dj as bQ,Uj as bR,xj as bS,Fj as bT,wj as bU,Gj as bV,tX as bW,nX as bX,Q4 as bY,iX as bZ,J4 as b_,QV as ba,BV as bb,JV as bc,MT as bd,cW as be,NT as bf,MW as bg,S4 as bh,Gk as bi,ej as bj,T4 as bk,Fk as bl,xk as bm,wk as bn,Uk as bo,SH as bp,Q3 as bq,aX as br,oX as bs,dj as bt,cj as bu,Y4 as bv,W4 as bw,TH as bx,IH as by,OH as bz,fg as c,sI as c$,e3 as c0,Qj as c1,r3 as c2,Jj as c3,Zj as c4,$j as c5,vH as c6,AH as c7,U3 as c8,f3 as c9,MY as cA,oK as cB,aK as cC,D3 as cD,bf as cE,wc as cF,Jm as cG,Mt as cH,Q as cI,bn as cJ,wm as cK,Ub as cL,Vt as cM,at as cN,B as cO,O8 as cP,je as cQ,Pz as cR,tt as cS,w5 as cT,IV as cU,TV as cV,OV as cW,RV as cX,x5 as cY,G5 as cZ,Gc as c_,e6 as ca,t6 as cb,nl as cc,Ys as cd,gR as ce,Tz as cf,mt as cg,Sz as ch,is as ci,yz as cj,wT as ck,ad as cl,rd as cm,id as cn,S3 as co,M3 as cp,w3 as cq,F3 as cr,T3 as cs,A3 as ct,Eh as cu,Iz as cv,y3 as cw,yY as cx,CY as cy,gh as cz,D as d,BY as d$,d8 as d0,Lz as d1,bz as d2,Dz as d3,V5 as d4,g8 as d5,Qf as d6,E8 as d7,j8 as d8,X8 as d9,GI as dA,NI as dB,LI as dC,Wu as dD,It as dE,r8 as dF,hD as dG,Br as dH,Xs as dI,js as dJ,ds as dK,zu as dL,mq as dM,tI as dN,vz as dO,mr as dP,ji as dQ,L3 as dR,ft as dS,da as dT,yO as dU,Fi as dV,wi as dW,ST as dX,mY as dY,P8 as dZ,hi as d_,Ki as da,_v as db,So as dc,gr as dd,Bc as de,wz as df,h8 as dg,Nz as dh,f8 as di,v8 as dj,kz as dk,Vz as dl,Hz as dm,A8 as dn,S8 as dp,Kz as dq,zz as dr,Yz as ds,Wz as dt,B2 as du,B8 as dv,G2 as dw,V8 as dx,w2 as dy,H8 as dz,Wq as e,HW as e$,sK as e0,gj as e1,PY as e2,GY as e3,CH as e4,yH as e5,NH as e6,VY as e7,kY as e8,Zq as e9,Vj as eA,J8 as eB,fY as eC,d5 as eD,v5 as eE,zj as eF,fX as eG,mX as eH,Ae as eI,ys as eJ,Kq as eK,ti as eL,jz as eM,Cd as eN,C8 as eO,y8 as eP,M8 as eQ,yd as eR,bd as eS,PV as eT,K5 as eU,$5 as eV,Z5 as eW,sW as eX,dW as eY,oW as eZ,gW as e_,zY as ea,YY as eb,LH as ec,UH as ed,p5 as ee,KH as ef,$8 as eg,aV as eh,_5 as ei,I5 as ej,hY as ek,z8 as el,Ye as em,s5 as en,cV as eo,_V as ep,O5 as eq,Ll as er,Kj as es,kj as et,IX as eu,pX as ev,cX as ew,EX as ex,lX as ey,Xj as ez,vt as f,sX as f$,VW as f0,kW as f1,DW as f2,fk as f3,PW as f4,NW as f5,BW as f6,Ek as f7,jW as f8,Ns as f9,LT as fA,Zk as fB,qk as fC,Kk as fD,bT as fE,DT as fF,Xk as fG,Qa as fH,NY as fI,hK as fJ,R4 as fK,qf as fL,FY as fM,pH as fN,wY as fO,d4 as fP,l4 as fQ,_4 as fR,c4 as fS,g4 as fT,xH as fU,qY as fV,uz as fW,H6 as fX,Bj as fY,hX as fZ,eX as f_,Ik as fa,FW as fb,pk as fc,gk as fd,Ih as fe,yW as ff,CW as fg,wW as fh,GW as fi,bW as fj,mk as fk,zW as fl,P4 as fm,N4 as fn,b4 as fo,w4 as fp,Qk as fq,L4 as fr,C4 as fs,M4 as ft,F4 as fu,Ds as fv,U4 as fw,nz as fx,zk as fy,Wk as fz,uf as g,eO as g$,UT as g0,a3 as g1,SX as g2,i3 as g3,AX as g4,yh as g5,NX as g6,qj as g7,OX as g8,Wl as g9,i8 as gA,e8 as gB,$z as gC,Qz as gD,Jz as gE,n8 as gF,$R as gG,$6 as gH,sY as gI,a8 as gJ,d6 as gK,jX as gL,T5 as gM,f5 as gN,uV as gO,sd as gP,Tk as gQ,oI as gR,WX as gS,oz as gT,o8 as gU,Hq as gV,qq as gW,Mf as gX,_O as gY,ih as gZ,FR as g_,wX as ga,FX as gb,vh as gc,u3 as gd,CX as ge,RX as gf,bX as gg,xX as gh,PX as gi,jr as gj,DX as gk,MX as gl,o3 as gm,yX as gn,n3 as go,vX as gp,zX as gq,ZX as gr,G8 as gs,N6 as gt,g6 as gu,P6 as gv,fs as gw,nY as gx,t8 as gy,Zz as gz,Hs as h,Fn as h0,FI as h1,HI as h2,EI as h3,EY as h4,rK as h5,D8 as h6,rX as h7,b8 as h8,L8 as h9,uK as hA,_K as hB,lK as hC,cK as hD,Ra as hE,_a as hF,Ve as hG,Tr as hH,Rz as ha,s8 as hb,fI as hc,c3 as hd,l3 as he,_3 as hf,GX as hg,p8 as hh,N8 as hi,Cz as hj,b6 as hk,T6 as hl,Sr as hm,Zt as hn,Fc as ho,Bh as hp,eZ as hq,sZ as hr,Jq as hs,$q as ht,tZ as hu,Qq as hv,pR as hw,ZO as hx,pY as hy,IY as hz,se as i,qt as j,xn as k,ui as l,We as m,Iu as n,_t as o,yf as p,Vs as q,Ee as r,Hr as s,Ru as t,Pl as u,UW as v,YW as w,LW as x,xW as y,QX as z};
